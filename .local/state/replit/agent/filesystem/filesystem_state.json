{"file_contents":{"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/pages/stock.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport SearchBar from \"@/components/search-bar\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Plus,\n  Search,\n  Edit,\n  Trash2,\n  Package,\n  AlertTriangle,\n  ChevronDown,\n  ChevronLeft,\n  ChevronRight,\n  RefreshCw,\n  TrendingUp,\n  TrendingDown,\n  Minus,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport { EnhancedStockItemForm } from \"@/components/enhanced-stock-item-form\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n  usePagination,\n} from \"@/components/ui/pagination\";\n\nexport default function Stock() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingItem, setEditingItem] = useState<any>(null);\n  const [selectedGroup, setSelectedGroup] = useState<string>(\"all\");\n\n  const { toast } = useToast();\n  const { symbol, formatCurrency } = useCurrency();\n\n  const {\n    data: inventoryData,\n    isLoading,\n    error,\n    refetch,\n  } = useQuery({\n    queryKey: [\"/api/inventory\", searchQuery, selectedGroup],\n    queryFn: () =>\n      apiRequest(\n        \"GET\",\n        `/api/inventory?search=${encodeURIComponent(searchQuery)}&group=${selectedGroup}`,\n      ),\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  // Handle both array and object response formats\n  const items = Array.isArray(inventoryData)\n    ? inventoryData\n    : inventoryData?.items || [];\n  const totalCount = Array.isArray(inventoryData)\n    ? inventoryData.length\n    : inventoryData?.totalCount || 0;\n  const totalPages = Array.isArray(inventoryData)\n    ? Math.ceil(inventoryData.length / 10)\n    : inventoryData?.totalPages || 0;\n\n  // Fetch ingredients specifically\n  const { data: ingredients = [] } = useQuery({\n    queryKey: [\"/api/ingredients\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/ingredients\"),\n  });\n\n  // Fetch categories for group filter\n  const { data: categories = [] } = useQuery({\n    queryKey: [\"/api/inventory-categories\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/inventory-categories\"),\n  });\n\n  // Add sorting functionality\n  const { sortedData, sortConfig, requestSort } = useTableSort(items, \"name\");\n\n  // Enhanced pagination - use items instead of sortedData initially\n  const {\n    currentItems: paginatedItems,\n    currentPage: paginationCurrentPage,\n    totalPages: paginationTotalPages,\n    pageSize: paginationPageSize,\n    setPageSize: setPaginationPageSize,\n    goToPage: paginationGoToPage,\n    totalItems: paginationTotalItems,\n  } = usePagination(sortedData || items, 10);\n\n  // Debounced search\n  const [debouncedSearchQuery, setDebouncedSearchQuery] = useState(searchQuery);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setDebouncedSearchQuery(searchQuery);\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [searchQuery]);\n\n  useEffect(() => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n  }, [debouncedSearchQuery]);\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/inventory/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory/all\"] });\n      toast({\n        title: \"Success\",\n        description: \"Stock item deleted successfully\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete stock item\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Sync stock from purchases\n  const syncStockMutation = useMutation({\n    mutationFn: () => apiRequest(\"POST\", \"/api/inventory/sync-from-purchases\"),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n      toast({\n        title: \"Success\",\n        description: \"Stock levels synced with purchases successfully\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to sync stock levels\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const getStockBadge = (item: any) => {\n    const closingStock = parseFloat(\n      item.closingStock || item.currentStock || 0,\n    );\n    const minLevel = parseFloat(item.minLevel || 0);\n\n    if (closingStock <= 0) {\n      return {\n        variant: \"destructive\" as const,\n        text: \"Out of Stock\",\n        icon: <AlertTriangle className=\"h-3 w-3\" />,\n      };\n    } else if (closingStock <= minLevel) {\n      return {\n        variant: \"destructive\" as const,\n        text: \"Low Stock\",\n        icon: <TrendingDown className=\"h-3 w-3\" />,\n      };\n    } else if (closingStock <= minLevel * 1.5) {\n      return {\n        variant: \"secondary\" as const,\n        text: \"Warning\",\n        icon: <Minus className=\"h-3 w-3\" />,\n      };\n    }\n    return {\n      variant: \"default\" as const,\n      text: \"In Stock\",\n      icon: <TrendingUp className=\"h-3 w-3\" />,\n    };\n  };\n\n  const getUnitName = (unitId: number, units: any[] = []) => {\n    if (!unitId || !Array.isArray(units)) return \"Unknown Unit\";\n    const unit = units.find((u: any) => u.id === unitId);\n    return unit ? unit.abbreviation || unit.name : \"Unknown Unit\";\n  };\n\n  const getGroupBadge = (group: string) => {\n    const colors = {\n      ingredients: \"bg-green-100 text-green-800\",\n      \"raw-materials\": \"bg-blue-100 text-blue-800\",\n      packaging: \"bg-purple-100 text-purple-800\",\n      spices: \"bg-orange-100 text-orange-800\",\n      dairy: \"bg-yellow-100 text-yellow-800\",\n      flour: \"bg-amber-100 text-amber-800\",\n      sweeteners: \"bg-pink-100 text-pink-800\",\n      supplies: \"bg-gray-100 text-gray-800\",\n    };\n\n    const colorClass =\n      colors[group as keyof typeof colors] || \"bg-gray-100 text-gray-800\";\n\n    return (\n      <Badge variant=\"outline\" className={`capitalize ${colorClass} border-0`}>\n        {group?.replace(\"-\", \" \") || \"Uncategorized\"}\n      </Badge>\n    );\n  };\n\n  if (error && isUnauthorizedError(error)) {\n    toast({\n      title: \"Unauthorized\",\n      description: \"You are logged out. Logging in again...\",\n      variant: \"destructive\",\n    });\n    setTimeout(() => {\n      window.location.href = \"/api/login\";\n    }, 500);\n    return null;\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600\">\n            Track opening, purchased, consumed, and closing stock with purchase\n            integration\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={() => syncStockMutation.mutate()}\n            disabled={syncStockMutation.isPending}\n            className=\"w-full sm:w-auto\"\n          >\n            <RefreshCw\n              className={`h-4 w-4 mr-2 ${syncStockMutation.isPending ? \"animate-spin\" : \"\"}`}\n            />\n            Sync from Purchases\n          </Button>\n          <Button\n            onClick={() => {\n              setEditingItem(null);\n              setIsDialogOpen(true);\n            }}\n            className=\"w-full sm:w-auto\"\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Item\n          </Button>\n        </div>\n\n        <EnhancedStockItemForm\n          isOpen={isDialogOpen}\n          onClose={() => {\n            setIsDialogOpen(false);\n            setEditingItem(null);\n          }}\n          editingItem={editingItem}\n        />\n      </div>\n\n      {/* Real-time Stock Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-500\">Total Items</p>\n                <p className=\"text-2xl font-bold text-blue-600\">\n                  {items.length}\n                </p>\n              </div>\n              <Package className=\"h-8 w-8 text-blue-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-500\">Low Stock</p>\n                <p className=\"text-2xl font-bold text-red-600\">\n                  {\n                    items.filter((item) => {\n                      const stock = parseFloat(\n                        item.closingStock || item.currentStock || 0,\n                      );\n                      const min = parseFloat(item.minLevel || 0);\n                      return stock <= min && stock > 0;\n                    }).length\n                  }\n                </p>\n              </div>\n              <AlertTriangle className=\"h-8 w-8 text-red-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-500\">\n                  Out of Stock\n                </p>\n                <p className=\"text-2xl font-bold text-gray-600\">\n                  {\n                    items.filter((item) => {\n                      const stock = parseFloat(\n                        item.closingStock || item.currentStock || 0,\n                      );\n                      return stock <= 0;\n                    }).length\n                  }\n                </p>\n              </div>\n              <Minus className=\"h-8 w-8 text-gray-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-500\">Total Value</p>\n                <p className=\"text-2xl font-bold text-green-600\">\n                  {formatCurrency(\n                    items.reduce((total, item) => {\n                      const stock = parseFloat(\n                        item.closingStock || item.currentStock || 0,\n                      );\n                      const cost = parseFloat(\n                        item.averageCost || item.costPerUnit || 0,\n                      );\n                      return total + stock * cost;\n                    }, 0),\n                  )}\n                </p>\n              </div>\n              <TrendingUp className=\"h-8 w-8 text-green-500\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"flex-1\">\n          <SearchBar\n            placeholder=\"Search items, suppliers, or inventory codes...\"\n            value={searchQuery}\n            onChange={setSearchQuery}\n            className=\"w-full\"\n          />\n        </div>\n        <div className=\"w-full sm:w-48\">\n          <Select value={selectedGroup} onValueChange={setSelectedGroup}>\n            <SelectTrigger>\n              <SelectValue placeholder=\"Filter by Group\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Groups</SelectItem>\n              <SelectItem value=\"ingredients\">Ingredients</SelectItem>\n              <SelectItem value=\"raw-materials\">Raw Materials</SelectItem>\n              <SelectItem value=\"packaging\">Packaging</SelectItem>\n              <SelectItem value=\"spices\">Spices</SelectItem>\n              <SelectItem value=\"dairy\">Dairy</SelectItem>\n              <SelectItem value=\"flour\">Flour</SelectItem>\n              <SelectItem value=\"sweeteners\">Sweeteners</SelectItem>\n              <SelectItem value=\"supplies\">Supplies</SelectItem>\n              {categories.map((category: any) => (\n                <SelectItem key={category.id} value={category.id.toString()}>\n                  {category.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <Card>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"invCode\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Inv Code\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"name\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Name\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"unit\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Unit\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"openingStock\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Opening Stock\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"purchasedQuantity\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Purchased\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"consumedQuantity\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Consumed\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"closingStock\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Closing Stock\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"group\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                      className=\"hidden md:table-cell\"\n                    >\n                      Group\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"lastRestocked\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                      className=\"hidden lg:table-cell\"\n                    >\n                      Last Updated\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"status\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Status\n                    </SortableTableHeader>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {paginatedItems.map((item: any) => {\n                    const stockInfo = getStockBadge(item);\n                    const openingStock = parseFloat(\n                      item.openingStock || item.currentStock || 0,\n                    );\n                    const purchasedQuantity = parseFloat(\n                      item.purchasedQuantity || 0,\n                    );\n                    const consumedQuantity = parseFloat(\n                      item.consumedQuantity || 0,\n                    );\n                    const closingStock = parseFloat(\n                      item.closingStock || item.currentStock || 0,\n                    );\n\n                    return (\n                      <TableRow key={item.id}>\n                        <TableCell>\n                          <div className=\"font-mono text-sm\">\n                            {item.invCode || item.id}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center space-x-3\">\n                            <div>\n                              <div className=\"font-medium\">{item.name}</div>\n                              <div className=\"text-sm text-muted-foreground\">\n                                {item.supplier || \"No supplier\"}\n                              </div>\n                              {/* Reorder Level Alert */}\n                              <div className=\"mt-1\">\n                                <div className=\"text-xs text-muted-foreground\">\n                                  Min:{\" \"}\n                                  {parseFloat(item.minLevel || 0).toFixed(2)}\n                                </div>\n                                {closingStock <=\n                                  parseFloat(item.minLevel || 0) && (\n                                  <div className=\"text-xs text-red-600 font-medium\">\n                                    ‚ö†Ô∏è Reorder needed\n                                  </div>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"text-sm\">\n                            <div className=\"font-medium\">\n                              {item.unit || \"kg\"}\n                            </div>\n                            {item.secondaryUnitId && (\n                              <div className=\"text-xs text-muted-foreground\">\n                                {item.secondaryUnit || \"kg\"}\n                              </div>\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"font-medium text-blue-600\">\n                            {openingStock.toFixed(2)}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"font-medium text-green-600\">\n                            +{purchasedQuantity.toFixed(2)}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"font-medium text-red-600\">\n                            -{consumedQuantity.toFixed(2)}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"space-y-1\">\n                            <div\n                              className={`font-bold text-lg ${\n                                closingStock <= 0\n                                  ? \"text-red-600\"\n                                  : closingStock <=\n                                      parseFloat(item.minLevel || 0)\n                                    ? \"text-orange-600\"\n                                    : \"text-green-600\"\n                              }`}\n                            >\n                              {closingStock.toFixed(2)}\n                            </div>\n                            <div className=\"text-xs font-medium text-gray-700\">\n                              Value:{\" \"}\n                              {formatCurrency(\n                                closingStock *\n                                  parseFloat(\n                                    item.averageCost || item.costPerUnit || 0,\n                                  ),\n                              )}\n                            </div>\n                            {closingStock <= parseFloat(item.minLevel || 0) &&\n                              closingStock > 0 && (\n                                <div className=\"text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded\">\n                                  Reorder:{\" \"}\n                                  {(\n                                    parseFloat(item.minLevel || 0) * 2 -\n                                    closingStock\n                                  ).toFixed(2)}{\" \"}\n                                  {item.unit}\n                                </div>\n                              )}\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"hidden md:table-cell\">\n                          {getGroupBadge(\n                            item.group || item.categoryName || \"uncategorized\",\n                          )}\n                        </TableCell>\n                        <TableCell className=\"hidden lg:table-cell\">\n                          <div className=\"text-sm space-y-1\">\n                            <div className=\"font-medium\">\n                              {item.lastRestocked\n                                ? new Date(\n                                    item.lastRestocked,\n                                  ).toLocaleDateString()\n                                : new Date(item.createdAt).toLocaleDateString()}\n                            </div>\n                            <div className=\"text-xs space-y-1\">\n                              <div className=\"text-blue-600\">\n                                Last:{\" \"}\n                                {formatCurrency(\n                                  parseFloat(\n                                    item.lastPurchaseCost ||\n                                      item.costPerUnit ||\n                                      0,\n                                  ),\n                                )}\n                              </div>\n                              <div className=\"text-green-600\">\n                                Avg:{\" \"}\n                                {formatCurrency(\n                                  parseFloat(\n                                    item.averageCost || item.costPerUnit || 0,\n                                  ),\n                                )}\n                              </div>\n                              <div className=\"text-gray-500\">\n                                per {item.unit || \"unit\"}\n                              </div>\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge\n                            variant={stockInfo.variant}\n                            className=\"flex items-center gap-1\"\n                          >\n                            {stockInfo.icon}\n                            {stockInfo.text}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex space-x-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => {\n                                setEditingItem(item);\n                                setIsDialogOpen(true);\n                              }}\n                              className=\"text-blue-600 hover:text-blue-800 focus:outline-none\"\n                              title=\"Edit\"\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <DeleteConfirmationDialog\n                              trigger={\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  className=\"text-red-600 hover:text-red-800 focus:outline-none\"\n                                  title=\"Delete\"\n                                >\n                                  <Trash2 className=\"h-4 w-4\" />\n                                </Button>\n                              }\n                              title=\"Delete Stock Item\"\n                              itemName={item.name}\n                              onConfirm={() => deleteMutation.mutate(item.id)}\n                              isLoading={deleteMutation.isPending}\n                            />\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n              {paginatedItems.length === 0 && !isLoading && (\n                <div className=\"text-center py-8\">\n                  <Package className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold text-muted-foreground mb-2\">\n                    No stock items found\n                  </h3>\n                  <p className=\"text-muted-foreground mb-4\">\n                    {searchQuery\n                      ? \"Try adjusting your search criteria\"\n                      : \"Start by adding your first stock item\"}\n                  </p>\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Enhanced Pagination Controls */}\n          {paginationTotalPages > 1 && (\n            <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 mt-4 px-2 py-4\">\n              <PaginationInfo\n                currentPage={paginationCurrentPage}\n                totalPages={paginationTotalPages}\n                totalItems={paginationTotalItems}\n              />\n              <div className=\"flex items-center gap-4\">\n                <PageSizeSelector\n                  pageSize={paginationPageSize}\n                  onPageSizeChange={setPaginationPageSize}\n                  options={[10, 25, 50, 100]}\n                />\n                <Pagination\n                  currentPage={paginationCurrentPage}\n                  totalPages={paginationTotalPages}\n                  onPageChange={paginationGoToPage}\n                />\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":27665,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/permission-wrapper.tsx":{"content":"import { ReactNode } from \"react\";\nimport { usePermissions } from \"@/hooks/usePermissions\";\nimport { useRoleAccess } from \"@/hooks/useRoleAccess\";\n\ninterface PermissionWrapperProps {\n  resource: string;\n  action: 'read' | 'write' | 'read_write';\n  children: ReactNode;\n  fallback?: ReactNode;\n}\n\nexport function PermissionWrapper({\n  resource,\n  action,\n  children,\n  fallback = null,\n}: PermissionWrapperProps) {\n  const { hasPermission } = usePermissions();\n  const { isSuperAdmin, canBypassAllRestrictions } = useRoleAccess();\n\n  // Super Admin bypasses ALL permission wrappers\n  if (isSuperAdmin() || canBypassAllRestrictions()) {\n    return <>{children}</>;\n  }\n\n  if (!hasPermission(resource, action)) {\n    return <>{fallback}</>;\n  }\n\n  return <>{children}</>;\n}\n\ninterface ReadOnlyWrapperProps {\n  resource: string;\n  children: ReactNode;\n  readOnlyContent?: ReactNode;\n}\n\nexport function ReadOnlyWrapper({\n  resource,\n  children,\n  readOnlyContent,\n}: ReadOnlyWrapperProps) {\n  const { canWrite, canReadWrite } = usePermissions();\n\n  if (canWrite(resource) || canReadWrite(resource)) {\n    return <>{children}</>;\n  }\n\n  return <>{readOnlyContent || children}</>;\n}","path":null,"size_bytes":1175,"size_tokens":null},"client/src/components/notification-settings.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Switch } from '@/components/ui/switch';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { useNotifications } from '@/hooks/useNotifications';\nimport { Bell, BellOff, TestTube } from 'lucide-react';\n\nexport default function NotificationSettings() {\n  const { toast } = useToast();\n  const {\n    isSupported: notificationsSupported,\n    permission,\n    subscription,\n    requestPermission,\n    subscribe,\n    unsubscribe,\n    rules,\n    updateRule,\n    sendTestNotification,\n  } = useNotifications();\n\n  const [isTestingNotification, setIsTestingNotification] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handlePermissionRequest = async () => {\n    setIsLoading(true);\n    const granted = await requestPermission();\n    if (granted) {\n      toast({\n        title: \"Permission Granted\",\n        description: \"You can now receive push notifications.\",\n      });\n    } else {\n      toast({\n        title: \"Permission Denied\",\n        description: \"Please enable notifications in your browser settings.\",\n        variant: \"destructive\",\n      });\n    }\n    setIsLoading(false);\n  };\n\n  const handleTestNotification = async () => {\n    setIsTestingNotification(true);\n    try {\n      await sendTestNotification();\n      toast({\n        title: \"Test Notification Sent\",\n        description: \"Check your notifications to see if it was received.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Test Failed\",\n        description: \"Failed to send test notification. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n    setIsTestingNotification(false);\n  };\n\n  const handleRuleUpdate = async (ruleId: string, enabled: boolean) => {\n    try {\n      await updateRule(ruleId, { enabled });\n      toast({\n        title: \"Rule Updated\",\n        description: \"Notification rule has been updated successfully.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update notification rule. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (!notificationsSupported) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <BellOff className=\"h-5 w-5\" />\n            Notifications Not Supported\n          </CardTitle>\n          <CardDescription>\n            Your browser does not support push notifications.\n          </CardDescription>\n        </CardHeader>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bell className=\"h-5 w-5\" />\n            Push Notifications\n          </CardTitle>\n          <CardDescription>\n            Configure how you want to receive notifications from the system.\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-1\">\n              <Label>Notification Permission</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                Status: {permission === 'granted' ? 'Enabled' : permission === 'denied' ? 'Denied' : 'Not requested'}\n              </p>\n            </div>\n            {permission !== 'granted' && (\n              <Button\n                onClick={handlePermissionRequest}\n                disabled={isLoading}\n                variant=\"outline\"\n              >\n                {isLoading ? 'Requesting...' : 'Enable Notifications'}\n              </Button>\n            )}\n          </div>\n\n          {permission === 'granted' && (\n            <>\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-1\">\n                  <Label>Subscription Status</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {subscription ? 'Active' : 'Inactive'}\n                  </p>\n                </div>\n                <Button\n                  onClick={subscription ? unsubscribe : subscribe}\n                  variant=\"outline\"\n                >\n                  {subscription ? 'Unsubscribe' : 'Subscribe'}\n                </Button>\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-1\">\n                  <Label>Test Notifications</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Send a test notification to verify everything is working\n                  </p>\n                </div>\n                <Button\n                  onClick={handleTestNotification}\n                  disabled={isTestingNotification || !subscription}\n                  variant=\"outline\"\n                >\n                  <TestTube className=\"h-4 w-4 mr-2\" />\n                  {isTestingNotification ? 'Sending...' : 'Send Test'}\n                </Button>\n              </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {permission === 'granted' && subscription && rules && (\n        <Card>\n          <CardHeader>\n            <CardTitle>Notification Rules</CardTitle>\n            <CardDescription>\n              Configure which types of notifications you want to receive.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {rules.map((rule) => (\n              <div key={rule.id} className=\"flex items-center justify-between\">\n                <div className=\"space-y-1\">\n                  <Label>{rule.name}</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {rule.description}\n                  </p>\n                </div>\n                <Switch\n                  checked={rule.enabled}\n                  onCheckedChange={(enabled) => handleRuleUpdate(rule.id, enabled)}\n                />\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","path":null,"size_bytes":6331,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-white text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n);\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n));\nAlert.displayName = \"Alert\";\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n));\nAlertTitle.displayName = \"AlertTitle\";\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n));\nAlertDescription.displayName = \"AlertDescription\";\n\nexport { Alert, AlertTitle, AlertDescription };\n","path":null,"size_bytes":1591,"size_tokens":null},"client/src/components/error-boundary.tsx":{"content":"\nimport React from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error?: Error;\n}\n\ninterface ErrorBoundaryProps {\n  children: React.ReactNode;\n}\n\nclass ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    console.error('Error caught by boundary:', error, errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n          <Card className=\"w-full max-w-md mx-4\">\n            <CardHeader>\n              <CardTitle className=\"text-center text-red-600\">\n                <i className=\"fas fa-exclamation-triangle text-2xl mb-2\"></i>\n                <br />\n                Something went wrong\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"text-center space-y-4\">\n              <p className=\"text-gray-600\">\n                An unexpected error occurred. Please refresh the page to try again.\n              </p>\n              <Button \n                onClick={() => window.location.reload()}\n                className=\"w-full\"\n              >\n                <i className=\"fas fa-refresh mr-2\"></i>\n                Refresh Page\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;\n","path":null,"size_bytes":1795,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(method: string, url: string, data?: any) {\n  const options = {\n    method,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      // Add auth token if needed\n      // Authorization: `Bearer ${getToken()}`\n    },\n    body: data ? JSON.stringify(data) : undefined,\n  };\n\n  const res = await fetch(url, options);\n  \n  // Log the response for debugging\n  console.log(`üì° API Request: ${method} ${url}`, { status: res.status, ok: res.ok });\n\n  if (!res.ok) {\n    const text = await res.text();\n    console.error(`‚ùå API Error Response:`, { status: res.status, body: text.substring(0, 200) });\n    \n    // Try to parse as JSON, fallback to text\n    let errorMessage = res.statusText;\n    try {\n      const error = JSON.parse(text);\n      errorMessage = error.message || error.error || res.statusText;\n    } catch {\n      errorMessage = text || res.statusText;\n    }\n    throw new Error(errorMessage);\n  }\n\n  const text = await res.text();\n  if (!text) {\n    console.warn(`‚ö†Ô∏è API returned empty response for ${method} ${url}`);\n    return {};\n  }\n\n  try {\n    const json = JSON.parse(text);\n    console.log(`‚úÖ API Response parsed successfully:`, { url, dataKeys: Object.keys(json) });\n    return json;\n  } catch (parseError) {\n    console.error(`‚ùå Failed to parse JSON response:`, { \n      url, \n      responseStart: text.substring(0, 200),\n      error: parseError \n    });\n    throw new Error(`Invalid JSON response from ${url}: ${parseError instanceof Error ? parseError.message : 'Unknown error'}`);\n  }\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\n// Define defaultQueryFn to be used in QueryClient\nconst defaultQueryFn: QueryFunction = getQueryFn({ on401: \"throw\" });\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: defaultQueryFn,\n      refetchOnWindowFocus: false,\n      retry: 1,\n      staleTime: 0, // No cache\n      gcTime: 0, // Clear immediately\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});","path":null,"size_bytes":2682,"size_tokens":null},"client/src/hooks/useNotifications.ts":{"content":"import { useState, useEffect } from 'react';\nimport { useAuth } from './useAuth';\n\ninterface NotificationRule {\n  id: string;\n  type: 'low_stock' | 'new_order' | 'production_reminder';\n  enabled: boolean;\n  threshold?: number;\n  dailyLimit: boolean;\n  lastSent?: Date;\n}\n\ninterface UseNotificationsReturn {\n  isSupported: boolean;\n  permission: NotificationPermission | null;\n  subscription: PushSubscription | null;\n  requestPermission: () => Promise<boolean>;\n  subscribe: () => Promise<boolean>;\n  unsubscribe: () => Promise<boolean>;\n  rules: NotificationRule[];\n  updateRule: (id: string, rule: Partial<NotificationRule>) => Promise<void>;\n  sendTestNotification: () => Promise<void>;\n}\n\nconst defaultRules: NotificationRule[] = [\n  {\n    id: 'low_stock',\n    type: 'low_stock',\n    enabled: true,\n    threshold: 10,\n    dailyLimit: true,\n  },\n  {\n    id: 'new_order',\n    type: 'new_order',\n    enabled: true,\n    dailyLimit: false,\n  },\n  {\n    id: 'production_reminder',\n    type: 'production_reminder',\n    enabled: true,\n    dailyLimit: true,\n  },\n];\n\nexport function useNotifications(): UseNotificationsReturn {\n  const [isSupported, setIsSupported] = useState(false);\n  const [permission, setPermission] = useState<NotificationPermission | null>(null);\n  const [subscription, setSubscription] = useState<PushSubscription | null>(null);\n  const [rules, setRules] = useState<NotificationRule[]>(defaultRules);\n  const { user } = useAuth();\n\n  // Check if user has admin, supervisor, or manager role\n  const hasNotificationAccess = user?.role === 'admin' || user?.role === 'supervisor' || user?.role === 'manager';\n\n  useEffect(() => {\n    if ('serviceWorker' in navigator && 'PushManager' in window) {\n      setIsSupported(true);\n      setPermission(Notification.permission);\n      \n      // Register service worker\n      navigator.serviceWorker.register('/sw.js')\n        .then((registration) => {\n          console.log('Service Worker registered:', registration);\n          return registration.pushManager.getSubscription();\n        })\n        .then((sub) => {\n          setSubscription(sub);\n        })\n        .catch((error) => {\n          console.error('Service Worker registration failed:', error);\n        });\n\n      // Load saved rules from localStorage\n      const savedRules = localStorage.getItem('notificationRules');\n      if (savedRules) {\n        setRules(JSON.parse(savedRules));\n      }\n    }\n  }, []);\n\n  const requestPermission = async (): Promise<boolean> => {\n    if (!isSupported || !hasNotificationAccess) return false;\n\n    try {\n      const permission = await Notification.requestPermission();\n      setPermission(permission);\n      return permission === 'granted';\n    } catch (error) {\n      console.error('Error requesting notification permission:', error);\n      return false;\n    }\n  };\n\n  const subscribe = async (): Promise<boolean> => {\n    if (!isSupported || permission !== 'granted' || !hasNotificationAccess) return false;\n\n    try {\n      const registration = await navigator.serviceWorker.ready;\n      const subscription = await registration.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey: urlBase64ToUint8Array(\n          // This would be your VAPID public key - you'll need to generate one\n          'BEl62iUYgUivxIkv69yViEuiBIa0aEOkOyK2u6M4jFm8u2J7sCvk1fOY1PzTF8yHrFH3o8yl-F3K_mzRYhR1QQs'\n        ),\n      });\n\n      setSubscription(subscription);\n\n      // Send subscription to server\n      await fetch('/api/notifications/subscribe', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          subscription,\n          userId: user?.id,\n        }),\n      });\n\n      return true;\n    } catch (error) {\n      console.error('Error subscribing to push notifications:', error);\n      return false;\n    }\n  };\n\n  const unsubscribe = async (): Promise<boolean> => {\n    if (!subscription) return false;\n\n    try {\n      await subscription.unsubscribe();\n      setSubscription(null);\n\n      // Remove subscription from server\n      await fetch('/api/notifications/unsubscribe', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          userId: user?.id,\n        }),\n      });\n\n      return true;\n    } catch (error) {\n      console.error('Error unsubscribing from push notifications:', error);\n      return false;\n    }\n  };\n\n  const updateRule = async (id: string, updatedRule: Partial<NotificationRule>): Promise<void> => {\n    const newRules = rules.map(rule => \n      rule.id === id ? { ...rule, ...updatedRule } : rule\n    );\n    setRules(newRules);\n    localStorage.setItem('notificationRules', JSON.stringify(newRules));\n\n    // Send updated rules to server\n    await fetch('/api/notifications/rules', {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      credentials: 'include',\n      body: JSON.stringify({\n        userId: user?.id,\n        rules: newRules,\n      }),\n    });\n  };\n\n  const sendTestNotification = async (): Promise<void> => {\n    if (!hasNotificationAccess) return;\n\n    await fetch('/api/notifications/test', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      credentials: 'include',\n      body: JSON.stringify({\n        userId: user?.id,\n      }),\n    });\n  };\n\n  return {\n    isSupported: isSupported && hasNotificationAccess,\n    permission,\n    subscription,\n    requestPermission,\n    subscribe,\n    unsubscribe,\n    rules,\n    updateRule,\n    sendTestNotification,\n  };\n}\n\nfunction urlBase64ToUint8Array(base64String: string): Uint8Array {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4);\n  const base64 = (base64String + padding)\n    .replace(/-/g, '+')\n    .replace(/_/g, '/');\n\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}","path":null,"size_bytes":6147,"size_tokens":null},"client/src/components/dynamic-price-display.tsx":{"content":"\nimport React from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { usePricing } from \"@/hooks/usePricing\";\nimport { Banknote, Star, Award } from \"lucide-react\";\n\ninterface DynamicPriceDisplayProps {\n  variant?: \"badge\" | \"card\" | \"inline\" | \"large\";\n  showDescription?: boolean;\n  showCurrency?: boolean;\n  className?: string;\n  prefix?: string;\n  suffix?: string;\n}\n\nexport function DynamicPriceDisplay({\n  variant = \"inline\",\n  showDescription = false,\n  showCurrency = true,\n  className = \"\",\n  prefix = \"\",\n  suffix = \"\",\n}: DynamicPriceDisplayProps) {\n  const { \n    pricingSettings, \n    isLoading, \n    formatPrice, \n    formatPriceWithCurrency, \n    displayEnabled \n  } = usePricing();\n\n  // Don't render if pricing display is disabled\n  if (!displayEnabled && !isLoading) {\n    return null;\n  }\n\n  if (isLoading) {\n    return <Skeleton className={`h-6 w-24 ${className}`} />;\n  }\n\n  const priceText = showCurrency \n    ? formatPriceWithCurrency() \n    : formatPrice();\n\n  const fullText = `${prefix}${priceText}${suffix}`;\n\n  switch (variant) {\n    case \"badge\":\n      return (\n        <Badge variant=\"secondary\" className={`font-semibold ${className}`}>\n          <Banknote className=\"h-3 w-3 mr-1\" />\n          {fullText}\n        </Badge>\n      );\n\n    case \"card\":\n      return (\n        <Card className={className}>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"flex items-center gap-2 text-lg\">\n              <Star className=\"h-5 w-5 text-yellow-500\" />\n              Overall System Cost\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold text-primary mb-2\">\n              {fullText}\n            </div>\n            {showDescription && pricingSettings?.description && (\n              <p className=\"text-sm text-muted-foreground\">\n                {pricingSettings.description}\n              </p>\n            )}\n          </CardContent>\n        </Card>\n      );\n\n    case \"large\":\n      return (\n        <div className={`text-center ${className}`}>\n          <div className=\"flex items-center justify-center gap-2 mb-2\">\n            <Award className=\"h-6 w-6 text-primary\" />\n            <span className=\"text-lg font-medium text-gray-700\">\n              Overall System Cost\n            </span>\n          </div>\n          <div className=\"text-4xl font-bold text-primary mb-2\">\n            {fullText}\n          </div>\n          {showDescription && pricingSettings?.description && (\n            <p className=\"text-gray-600 max-w-md mx-auto\">\n              {pricingSettings.description}\n            </p>\n          )}\n        </div>\n      );\n\n    case \"inline\":\n    default:\n      return (\n        <span className={`font-semibold text-primary ${className}`}>\n          {fullText}\n        </span>\n      );\n  }\n}\n\n// Specialized components for common use cases\nexport function SystemPriceBadge({ className }: { className?: string }) {\n  return (\n    <DynamicPriceDisplay\n      variant=\"badge\"\n      className={className}\n    />\n  );\n}\n\nexport function SystemPriceCard({ \n  showDescription = true, \n  className \n}: { \n  showDescription?: boolean; \n  className?: string; \n}) {\n  return (\n    <DynamicPriceDisplay\n      variant=\"card\"\n      showDescription={showDescription}\n      className={className}\n    />\n  );\n}\n\nexport function SystemPriceLarge({ \n  showDescription = true, \n  className \n}: { \n  showDescription?: boolean; \n  className?: string; \n}) {\n  return (\n    <DynamicPriceDisplay\n      variant=\"large\"\n      showDescription={showDescription}\n      className={className}\n    />\n  );\n}\n","path":null,"size_bytes":3748,"size_tokens":null},"client/src/pages/admin-roles.tsx":{"content":"\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { ProtectedRoute } from \"@/components/protected-route\";\nimport { \n  Users, \n  Shield, \n  Settings, \n  Save, \n  RefreshCw, \n  CheckCircle, \n  AlertTriangle,\n  Info\n} from \"lucide-react\";\nimport { SYSTEM_MODULES, getModulesByCategory, type ModuleDefinition } from \"../../../shared/modules\";\n\ninterface RoleModule {\n  id: number;\n  role: string;\n  moduleId: string;\n  granted: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nconst AVAILABLE_ROLES = [\n  { value: \"admin\", label: \"Administrator\", description: \"Full system access except super admin features\" },\n  { value: \"manager\", label: \"Manager\", description: \"Departmental management and reporting access\" },\n  { value: \"supervisor\", label: \"Supervisor\", description: \"Team supervision and operational oversight\" },\n  { value: \"marketer\", label: \"Marketer\", description: \"Sales, customer management, and marketing tools\" },\n  { value: \"staff\", label: \"Staff\", description: \"Basic operational access for daily tasks\" },\n];\n\nexport default function AdminRoles() {\n  const [selectedRole, setSelectedRole] = useState<string>(\"admin\");\n  const [selectedModules, setSelectedModules] = useState<Set<string>>(new Set());\n  const queryClient = useQueryClient();\n\n  // Fetch role modules\n  const { data: roleModulesResponse, isLoading: roleModulesLoading, error: roleModulesError } = useQuery({\n    queryKey: [\"admin\", \"role-modules\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/admin/role-modules\");\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch role modules\");\n      }\n      return response.json();\n    },\n  });\n\n  // Fetch modules for specific role\n  const { data: currentRoleModulesResponse, isLoading: currentRoleLoading } = useQuery({\n    queryKey: [\"admin\", \"role-modules\", selectedRole],\n    queryFn: async () => {\n      const response = await fetch(`/api/admin/role-modules/${selectedRole}`);\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch role modules\");\n      }\n      return response.json();\n    },\n    enabled: !!selectedRole,\n  });\n\n  // Update role modules mutation\n  const updateRoleModulesMutation = useMutation({\n    mutationFn: async ({ role, moduleIds }: { role: string; moduleIds: string[] }) => {\n      const response = await fetch(\"/api/admin/role-modules\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ role, moduleIds }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to update role modules\");\n      }\n\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"admin\", \"role-modules\"] });\n      toast({\n        title: \"Role Updated\",\n        description: `Successfully updated modules for ${data.data.role}`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update role modules\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update selected modules when role changes\n  React.useEffect(() => {\n    if (currentRoleModulesResponse?.success && currentRoleModulesResponse.data) {\n      const grantedModules = currentRoleModulesResponse.data\n        .filter((rm: RoleModule) => rm.granted)\n        .map((rm: RoleModule) => rm.moduleId);\n      setSelectedModules(new Set(grantedModules));\n    }\n  }, [currentRoleModulesResponse]);\n\n  const handleModuleToggle = (moduleId: string, checked: boolean) => {\n    const newSelected = new Set(selectedModules);\n    if (checked) {\n      newSelected.add(moduleId);\n    } else {\n      newSelected.delete(moduleId);\n    }\n    setSelectedModules(newSelected);\n  };\n\n  const handleCategoryToggle = (category: ModuleDefinition['category'], checked: boolean) => {\n    const categoryModules = getModulesByCategory(category);\n    const newSelected = new Set(selectedModules);\n    \n    categoryModules.forEach(module => {\n      // Skip super admin only modules for non-super-admin roles\n      if (module.requiredRole === 'super_admin' && selectedRole !== 'super_admin') {\n        return;\n      }\n      \n      if (checked) {\n        newSelected.add(module.id);\n      } else {\n        newSelected.delete(module.id);\n      }\n    });\n    \n    setSelectedModules(newSelected);\n  };\n\n  const handleSaveRoleModules = () => {\n    const moduleIds = Array.from(selectedModules);\n    updateRoleModulesMutation.mutate({ role: selectedRole, moduleIds });\n  };\n\n  const getCategoryModules = (category: ModuleDefinition['category']) => {\n    return getModulesByCategory(category).filter(module => {\n      // Hide super admin only modules for non-super-admin roles\n      if (module.requiredRole === 'super_admin' && selectedRole !== 'super_admin') {\n        return false;\n      }\n      return true;\n    });\n  };\n\n  const isCategoryFullySelected = (category: ModuleDefinition['category']) => {\n    const categoryModules = getCategoryModules(category);\n    return categoryModules.length > 0 && categoryModules.every(module => selectedModules.has(module.id));\n  };\n\n  const isCategoryPartiallySelected = (category: ModuleDefinition['category']) => {\n    const categoryModules = getCategoryModules(category);\n    return categoryModules.some(module => selectedModules.has(module.id)) && !isCategoryFullySelected(category);\n  };\n\n  const getModuleStats = () => {\n    const totalAvailable = SYSTEM_MODULES.filter(module => {\n      if (module.requiredRole === 'super_admin' && selectedRole !== 'super_admin') {\n        return false;\n      }\n      return true;\n    }).length;\n    \n    const selected = selectedModules.size;\n    return { selected, totalAvailable };\n  };\n\n  const categories: { id: ModuleDefinition['category']; name: string; icon: React.ReactNode; description: string }[] = [\n    { id: 'core', name: 'Core System', icon: <Shield className=\"h-4 w-4\" />, description: 'Essential system features' },\n    { id: 'finance', name: 'Financial Management', icon: <Users className=\"h-4 w-4\" />, description: 'Sales, purchases, expenses' },\n    { id: 'inventory', name: 'Inventory & Production', icon: <Settings className=\"h-4 w-4\" />, description: 'Stock and manufacturing' },\n    { id: 'crm', name: 'Customer Relations', icon: <Users className=\"h-4 w-4\" />, description: 'Customer and supplier management' },\n    { id: 'hr', name: 'Human Resources', icon: <Users className=\"h-4 w-4\" />, description: 'Staff and payroll management' },\n    { id: 'reports', name: 'Reports & Analytics', icon: <Settings className=\"h-4 w-4\" />, description: 'Business intelligence' },\n    { id: 'admin', name: 'Administration', icon: <Shield className=\"h-4 w-4\" />, description: 'System administration' },\n    ...(selectedRole === 'super_admin' ? [\n      { id: 'developer' as const, name: 'Developer Tools', icon: <Settings className=\"h-4 w-4\" />, description: 'Development utilities' },\n      { id: 'security' as const, name: 'Security & Monitoring', icon: <Shield className=\"h-4 w-4\" />, description: 'Advanced security features' }\n    ] : [])\n  ];\n\n  if (roleModulesLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"text-center\">\n          <RefreshCw className=\"h-8 w-8 animate-spin mx-auto mb-4 text-primary\" />\n          <p className=\"text-muted-foreground\">Loading role modules...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <ProtectedRoute resource=\"users\" action=\"read_write\">\n      <div className=\"container mx-auto p-6 space-y-6\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Role Management</h1>\n            <p className=\"text-muted-foreground\">\n              Configure module access permissions for user roles\n            </p>\n          </div>\n        </div>\n\n        {roleModulesError && (\n          <Alert variant=\"destructive\">\n            <AlertTriangle className=\"h-4 w-4\" />\n            <AlertDescription>\n              Failed to load role modules: {roleModulesError.message}\n            </AlertDescription>\n          </Alert>\n        )}\n\n        <Tabs defaultValue=\"modules\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"modules\" className=\"flex items-center gap-2\">\n              <Settings className=\"h-4 w-4\" />\n              Module Assignment\n            </TabsTrigger>\n            <TabsTrigger value=\"overview\" className=\"flex items-center gap-2\">\n              <Users className=\"h-4 w-4\" />\n              Role Overview\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"modules\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n                  <div>\n                    <CardTitle>Module Assignment</CardTitle>\n                    <CardDescription>\n                      Select which modules each role can access\n                    </CardDescription>\n                  </div>\n                  <div className=\"flex items-center gap-4\">\n                    <Select value={selectedRole} onValueChange={setSelectedRole}>\n                      <SelectTrigger className=\"w-[200px]\">\n                        <SelectValue placeholder=\"Select a role\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {AVAILABLE_ROLES.map((role) => (\n                          <SelectItem key={role.value} value={role.value}>\n                            {role.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {selectedRole && (\n                  <>\n                    <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                      <div>\n                        <h3 className=\"font-medium\">\n                          {AVAILABLE_ROLES.find(r => r.value === selectedRole)?.label}\n                        </h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {AVAILABLE_ROLES.find(r => r.value === selectedRole)?.description}\n                        </p>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"text-lg font-semibold\">\n                          {getModuleStats().selected} / {getModuleStats().totalAvailable}\n                        </div>\n                        <p className=\"text-sm text-muted-foreground\">Modules assigned</p>\n                      </div>\n                    </div>\n\n                    {selectedRole === 'super_admin' && (\n                      <Alert>\n                        <Info className=\"h-4 w-4\" />\n                        <AlertDescription>\n                          Super Admin role has automatic access to all system modules and cannot be modified.\n                        </AlertDescription>\n                      </Alert>\n                    )}\n\n                    {currentRoleLoading ? (\n                      <div className=\"text-center py-8\">\n                        <RefreshCw className=\"h-6 w-6 animate-spin mx-auto mb-2\" />\n                        <p className=\"text-sm text-muted-foreground\">Loading current permissions...</p>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-6\">\n                        {categories.map((category) => {\n                          const categoryModules = getCategoryModules(category.id);\n                          if (categoryModules.length === 0) return null;\n\n                          const isFullySelected = isCategoryFullySelected(category.id);\n                          const isPartiallySelected = isCategoryPartiallySelected(category.id);\n\n                          return (\n                            <div key={category.id} className=\"space-y-3\">\n                              <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center space-x-3\">\n                                  <Checkbox\n                                    id={`category-${category.id}`}\n                                    checked={isFullySelected}\n                                    onCheckedChange={(checked) => handleCategoryToggle(category.id, checked as boolean)}\n                                    disabled={selectedRole === 'super_admin'}\n                                    className={isPartiallySelected ? \"data-[state=checked]:bg-orange-600\" : \"\"}\n                                  />\n                                  <div className=\"flex items-center space-x-2\">\n                                    {category.icon}\n                                    <div>\n                                      <h4 className=\"font-medium\">{category.name}</h4>\n                                      <p className=\"text-sm text-muted-foreground\">{category.description}</p>\n                                    </div>\n                                  </div>\n                                </div>\n                                <Badge variant={isFullySelected ? \"default\" : isPartiallySelected ? \"secondary\" : \"outline\"}>\n                                  {categoryModules.filter(m => selectedModules.has(m.id)).length} / {categoryModules.length}\n                                </Badge>\n                              </div>\n                              \n                              <div className=\"ml-6 space-y-2\">\n                                {categoryModules.map((module) => (\n                                  <div key={module.id} className=\"flex items-center space-x-3 py-2\">\n                                    <Checkbox\n                                      id={`module-${module.id}`}\n                                      checked={selectedModules.has(module.id)}\n                                      onCheckedChange={(checked) => handleModuleToggle(module.id, checked as boolean)}\n                                      disabled={selectedRole === 'super_admin'}\n                                    />\n                                    <div className=\"flex-1\">\n                                      <label\n                                        htmlFor={`module-${module.id}`}\n                                        className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                                      >\n                                        {module.name}\n                                      </label>\n                                      <p className=\"text-xs text-muted-foreground mt-1\">\n                                        {module.description}\n                                      </p>\n                                      <div className=\"flex flex-wrap gap-1 mt-1\">\n                                        {module.routes.map((route, index) => (\n                                          <Badge key={index} variant=\"outline\" className=\"text-xs\">\n                                            {route}\n                                          </Badge>\n                                        ))}\n                                      </div>\n                                    </div>\n                                  </div>\n                                ))}\n                              </div>\n                              <Separator />\n                            </div>\n                          );\n                        })}\n\n                        {selectedRole !== 'super_admin' && (\n                          <div className=\"flex items-center justify-end space-x-3 pt-4\">\n                            <Button\n                              variant=\"outline\"\n                              onClick={() => {\n                                if (currentRoleModulesResponse?.success && currentRoleModulesResponse.data) {\n                                  const grantedModules = currentRoleModulesResponse.data\n                                    .filter((rm: RoleModule) => rm.granted)\n                                    .map((rm: RoleModule) => rm.moduleId);\n                                  setSelectedModules(new Set(grantedModules));\n                                }\n                              }}\n                            >\n                              <RefreshCw className=\"h-4 w-4 mr-2\" />\n                              Reset Changes\n                            </Button>\n                            <Button\n                              onClick={handleSaveRoleModules}\n                              disabled={updateRoleModulesMutation.isPending}\n                            >\n                              {updateRoleModulesMutation.isPending ? (\n                                <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\n                              ) : (\n                                <Save className=\"h-4 w-4 mr-2\" />\n                              )}\n                              Save Changes\n                            </Button>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"overview\" className=\"space-y-6\">\n            <div className=\"grid gap-4\">\n              {AVAILABLE_ROLES.map((role) => (\n                <Card key={role.value}>\n                  <CardHeader>\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <CardTitle className=\"flex items-center gap-2\">\n                          <Shield className=\"h-5 w-5\" />\n                          {role.label}\n                        </CardTitle>\n                        <CardDescription>{role.description}</CardDescription>\n                      </div>\n                      <Badge variant=\"outline\">\n                        {roleModulesResponse?.data?.filter((rm: RoleModule) => rm.role === role.value && rm.granted).length || 0} modules\n                      </Badge>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {roleModulesResponse?.data\n                        ?.filter((rm: RoleModule) => rm.role === role.value && rm.granted)\n                        .map((rm: RoleModule) => {\n                          const module = SYSTEM_MODULES.find(m => m.id === rm.moduleId);\n                          return module ? (\n                            <Badge key={rm.moduleId} variant=\"secondary\">\n                              {module.name}\n                            </Badge>\n                          ) : null;\n                        })}\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </ProtectedRoute>\n  );\n}\n","path":null,"size_bytes":20047,"size_tokens":null},"server/lib/unitHelper.ts":{"content":"\nexport class UnitHelper {\n  /**\n   * Convert quantity from secondary unit to primary unit\n   */\n  static convertSecondaryToPrimary(\n    secondaryQuantity: number,\n    conversionRate: number\n  ): number {\n    return secondaryQuantity * conversionRate;\n  }\n\n  /**\n   * Convert quantity from primary unit to secondary unit\n   */\n  static convertPrimaryToSecondary(\n    primaryQuantity: number,\n    conversionRate: number\n  ): number {\n    return primaryQuantity / conversionRate;\n  }\n\n  /**\n   * Get display string for dual units\n   */\n  static getUnitDisplayString(\n    primaryQuantity: number,\n    primaryUnit: string,\n    secondaryQuantity?: number,\n    secondaryUnit?: string\n  ): string {\n    let display = `${primaryQuantity} ${primaryUnit}`;\n    if (secondaryQuantity !== undefined && secondaryUnit) {\n      display += ` (${secondaryQuantity} ${secondaryUnit})`;\n    }\n    return display;\n  }\n\n  /**\n   * Calculate stock in both units\n   */\n  static calculateDualUnitStock(\n    primaryStock: number,\n    conversionRate: number\n  ): {\n    primaryStock: number;\n    secondaryStock: number;\n  } {\n    return {\n      primaryStock,\n      secondaryStock: this.convertPrimaryToSecondary(primaryStock, conversionRate),\n    };\n  }\n}\n","path":null,"size_bytes":1229,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/pages/recipes.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { SearchBar } from \"@/components/search-bar\";\nimport Recipe from \"@/components/recipe\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n  usePagination,\n} from \"@/components/ui/pagination\";\nimport {\n  Plus,\n  Edit,\n  Trash2,\n  Package,\n  Calculator,\n  ChefHat,\n  Eye,\n} from \"lucide-react\";\n\nexport default function Recipes() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingRecipe, setEditingRecipe] = useState<any>(null);\n  const [viewingRecipe, setViewingRecipe] = useState<any>(null);\n  const { toast } = useToast();\n  const { formatCurrency } = useCurrency();\n  const queryClient = useQueryClient();\n\n  // Fetch recipes (products with recipe data)\n  const { data: recipes = [], isLoading } = useQuery({\n    queryKey: [\"/api/products\"],\n    queryFn: async () => {\n      try {\n        console.log(\"üîç Fetching recipes...\");\n        const response = await apiRequest(\"GET\", \"/api/products\");\n        console.log(\"üì¶ Recipes response:\", response);\n        \n        // Handle wrapped response with success flag\n        if (response?.success && response?.data) {\n          const products = Array.isArray(response.data) ? response.data : [];\n          console.log(`‚úÖ Found ${products.length} recipes in success response`);\n          return products;\n        }\n        \n        // Handle direct array response\n        if (Array.isArray(response)) {\n          console.log(`‚úÖ Found ${response.length} recipes in direct array`);\n          return response;\n        }\n        \n        console.warn(\"‚ö†Ô∏è No recipes found in response\");\n        return [];\n      } catch (error) {\n        console.error(\"‚ùå Failed to fetch recipes:\", error);\n        if (isUnauthorizedError(error)) {\n          throw error;\n        }\n        return [];\n      }\n    },\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  // Filter recipes based on search\n  const filteredProducts = recipes.filter((recipe: any) => {\n    const matchesSearch = recipe.name\n      .toLowerCase()\n      .includes(searchQuery.toLowerCase());\n    return matchesSearch;\n  });\n\n  // Add sorting functionality\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredProducts,\n    \"name\",\n  );\n\n  // Add pagination functionality\n  const {\n    currentItems,\n    currentPage,\n    totalPages,\n    pageSize,\n    setPageSize,\n    goToPage,\n    totalItems,\n  } = usePagination(sortedData, 6);\n\n  const handleSaveProduct = async (productData: any) => {\n    try {\n      // The Recipe component already handles the API call and saves the product\n      // Just close the dialog and refresh\n      setIsDialogOpen(false);\n      setEditingRecipe(null);\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n    } catch (error) {\n      console.error(\"Error in handleSaveProduct:\", error);\n    }\n  };\n\n  const handleEdit = (recipe: any) => {\n    setEditingRecipe(recipe);\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (recipe: any) => {\n    if (\n      window.confirm(\n        `Are you sure you want to delete the recipe \"${recipe.name}\"?`,\n      )\n    ) {\n      deleteMutation.mutate(recipe.id);\n    }\n  };\n\n  const handleAddNew = () => {\n    setEditingRecipe(null);\n    setIsDialogOpen(true);\n  };\n\n  const getStatusBadge = (recipe: any) => {\n    if (recipe.cost && recipe.price) {\n      const margin = ((recipe.price - recipe.cost) / recipe.price) * 100;\n      if (margin > 30) {\n        return (\n          <Badge className=\"bg-green-100 text-green-800\">Profitable</Badge>\n        );\n      } else if (margin > 10) {\n        return (\n          <Badge className=\"bg-yellow-100 text-yellow-800\">Moderate</Badge>\n        );\n      } else {\n        return <Badge className=\"bg-red-100 text-red-800\">Low Margin</Badge>;\n      }\n    }\n    return <Badge variant=\"outline\">No Costing</Badge>;\n  };\n\n  // Create/Update mutation\n  const saveMutation = useMutation({\n    mutationFn: async (productData: any) => {\n      const url = editingRecipe\n        ? `/api/products/${editingRecipe.id}`\n        : \"/api/products\";\n\n      const response = await fetch(url, {\n        method: editingRecipe ? \"PUT\" : \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(productData),\n      });\n\n      if (!response.ok) {\n        throw new Error(\n          `Failed to ${editingRecipe ? \"update\" : \"create\"} recipe`,\n        );\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setIsDialogOpen(false);\n      setEditingRecipe(null);\n      toast({\n        title: \"Success\",\n        description: `Recipe ${editingRecipe ? \"updated\" : \"created\"} successfully`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description:\n          error.message ||\n          `Failed to ${editingRecipe ? \"update\" : \"create\"} recipe`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await fetch(`/api/products/${id}`, {\n        method: \"DELETE\",\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to delete recipe\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      toast({\n        title: \"Success\",\n        description: \"Recipe deleted successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete recipe\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-muted-foreground\">\n            Create and manage product recipes with automatic cost calculations\n          </p>\n        </div>\n\n        <Dialog\n          open={isDialogOpen}\n          onOpenChange={(open) => {\n            setIsDialogOpen(open);\n            if (!open) {\n              setEditingRecipe(null);\n            }\n          }}\n        >\n          <DialogTrigger asChild>\n            <Button onClick={handleAddNew} className=\"w-full sm:w-auto\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Create Recipe\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-7xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Package className=\"h-5 w-5\" />\n                {editingRecipe ? \"Edit Recipe\" : \"Create New Recipe\"}\n              </DialogTitle>\n            </DialogHeader>\n            <Recipe product={editingRecipe} onSave={handleSaveProduct} />\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Recipes List */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <Package className=\"h-5 w-5\" />\n              Recipes ({totalItems})\n            </CardTitle>\n            <div className=\"w-full sm:w-64\">\n              <SearchBar\n                placeholder=\"Search recipes...\"\n                value={searchQuery}\n                onChange={setSearchQuery}\n                className=\"w-full\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : recipes.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <Package className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold text-muted-foreground mb-2\">\n                No recipes found\n              </h3>\n              <p className=\"text-muted-foreground mb-4\">\n                {searchQuery\n                  ? \"Try adjusting your search criteria\"\n                  : \"Start by creating your first recipe\"}\n              </p>\n              <Button onClick={handleAddNew}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Create Recipe\n              </Button>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"name\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Recipe Name\n                    </SortableTableHeader>\n                    <TableHead>Cost per Unit</TableHead>\n                    <TableHead>Selling Price</TableHead>\n                    <TableHead>Margin</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Ingredients</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {currentItems.map((recipe: any) => {\n                    const margin =\n                      recipe.cost && recipe.price\n                        ? ((recipe.price - recipe.cost) / recipe.price) * 100\n                        : 0;\n\n                    return (\n                      <TableRow key={recipe.id}>\n                        <TableCell>\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">{recipe.name}</span>\n                            {recipe.description && (\n                              <span className=\"text-sm text-gray-500 truncate max-w-[200px]\">\n                                {recipe.description}\n                              </span>\n                            )}\n                          </div>\n                        </TableCell>\n\n                        <TableCell>\n                          {recipe.cost ? formatCurrency(recipe.cost) : \"-\"}\n                        </TableCell>\n                        <TableCell>\n                          {recipe.price ? formatCurrency(recipe.price) : \"-\"}\n                        </TableCell>\n                        <TableCell>\n                          {margin > 0 ? (\n                            <span\n                              className={`font-medium ${\n                                margin > 30\n                                  ? \"text-green-600\"\n                                  : margin > 10\n                                    ? \"text-yellow-600\"\n                                    : \"text-red-600\"\n                              }`}\n                            >\n                              {margin.toFixed(1)}%\n                            </span>\n                          ) : (\n                            \"-\"\n                          )}\n                        </TableCell>\n                        <TableCell>{getStatusBadge(recipe)}</TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-1\">\n                            <Calculator className=\"h-4 w-4 text-gray-400\" />\n                            <span className=\"text-sm text-gray-600\">\n                              {recipe.ingredients?.length || 0} items\n                            </span>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => setViewingRecipe(recipe)}\n                              className=\"text-blue-600 hover:text-blue-800\"\n                            >\n                              <Eye className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => handleEdit(recipe)}\n                              className=\"text-blue-600 hover:text-blue-800\"\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => handleDelete(recipe)}\n                              className=\"text-red-600 hover:text-red-800\"\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Pagination Controls */}\n      {filteredProducts.length > 0 && (\n        <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 mt-6\">\n          <PaginationInfo\n            currentPage={currentPage}\n            totalPages={totalPages}\n            totalItems={totalItems}\n          />\n          <div className=\"flex items-center gap-4\">\n            <PageSizeSelector\n              pageSize={pageSize}\n              onPageSizeChange={setPageSize}\n              options={[6, 12, 18, 24]}\n            />\n            <Pagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              onPageChange={goToPage}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Recipe View Dialog */}\n      <Dialog\n        open={!!viewingRecipe}\n        onOpenChange={(open) => !open && setViewingRecipe(null)}\n      >\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Eye className=\"h-5 w-5\" />\n              Recipe Details: {viewingRecipe?.name}\n            </DialogTitle>\n          </DialogHeader>\n          {viewingRecipe && (\n            <div className=\"space-y-6\">\n              {/* Basic Info */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-gray-600\">\n                    Status\n                  </label>\n                  <div className=\"mt-1\">{getStatusBadge(viewingRecipe)}</div>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium text-gray-600\">\n                    Cost per Unit\n                  </label>\n                  <p className=\"text-sm font-medium\">\n                    {viewingRecipe.cost\n                      ? formatCurrency(viewingRecipe.cost)\n                      : \"Not calculated\"}\n                  </p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium text-gray-600\">\n                    Selling Price\n                  </label>\n                  <p className=\"text-sm font-medium\">\n                    {viewingRecipe.price\n                      ? formatCurrency(viewingRecipe.price)\n                      : \"Not set\"}\n                  </p>\n                </div>\n              </div>\n\n              {/* Description */}\n              {viewingRecipe.description && (\n                <div>\n                  <label className=\"text-sm font-medium text-gray-600\">\n                    Description\n                  </label>\n                  <p className=\"text-sm mt-1\">{viewingRecipe.description}</p>\n                </div>\n              )}\n\n              {/* Ingredients */}\n              {viewingRecipe.ingredients &&\n                viewingRecipe.ingredients.length > 0 && (\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-600 mb-3 block\">\n                      Ingredients ({viewingRecipe.ingredients.length})\n                    </label>\n                    <div className=\"border rounded-lg overflow-hidden\">\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead>Ingredient</TableHead>\n                            <TableHead>Quantity</TableHead>\n                            <TableHead>Unit</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {viewingRecipe.ingredients.map(\n                            (ingredient: any, index: number) => (\n                              <TableRow key={index}>\n                                <TableCell>\n                                  {ingredient.name || \"Unknown\"}\n                                </TableCell>\n                                <TableCell>{ingredient.quantity}</TableCell>\n                                <TableCell>\n                                  {ingredient.unit || \"unit\"}\n                                </TableCell>\n                              </TableRow>\n                            ),\n                          )}\n                        </TableBody>\n                      </Table>\n                    </div>\n                  </div>\n                )}\n\n              <div className=\"flex justify-end gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setViewingRecipe(null)}\n                >\n                  Close\n                </Button>\n                <Button\n                  onClick={() => {\n                    setViewingRecipe(null);\n                    handleEdit(viewingRecipe);\n                  }}\n                >\n                  <Edit className=\"h-4 w-4 mr-2\" />\n                  Edit Recipe\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":19200,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\";\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\";\nimport React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nconst Collapsible = CollapsiblePrimitive.Root;\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger;\n\nconst CollapsibleContent = React.forwardRef<\n  React.ElementRef<typeof CollapsiblePrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof CollapsiblePrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <CollapsiblePrimitive.Content\n    ref={ref}\n    className={cn(\n      \"overflow-hidden\",\n      \"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\",\n      \"transition-all duration-300 ease-out\",\n      className,\n    )}\n    {...props}\n  >\n    <div className=\"pb-2 pt-1 space-y-1\">{children}</div>\n  </CollapsiblePrimitive.Content>\n));\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent };\n","path":null,"size_bytes":914,"size_tokens":null},"client/src/components/ui/empty-state.tsx":{"content":"import { Button } from \"@/components/ui/button\"\n\ninterface EmptyStateProps {\n  icon: string\n  title: string\n  description: string\n  actionLabel?: string\n  onAction?: () => void\n}\n\nexport function EmptyState({ \n  icon, \n  title, \n  description, \n  actionLabel, \n  onAction \n}: EmptyStateProps) {\n  return (\n    <div className=\"flex flex-col items-center justify-center p-12 text-center\">\n      <div className=\"w-20 h-20 bg-gradient-to-r from-gray-100 to-gray-200 rounded-full flex items-center justify-center mb-6\">\n        <i className={`${icon} text-3xl text-gray-400`} />\n      </div>\n      <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">\n        {title}\n      </h3>\n      <p className=\"text-gray-500 dark:text-gray-400 mb-6 max-w-sm\">\n        {description}\n      </p>\n      {actionLabel && onAction && (\n        <Button \n          onClick={onAction}\n          className=\"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700\"\n        >\n          <i className=\"fas fa-plus mr-2\" />\n          {actionLabel}\n        </Button>\n      )}\n    </div>\n  )\n}","path":null,"size_bytes":1108,"size_tokens":null},"client/src/components/protected-route.tsx":{"content":"import { ReactNode, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { usePermissions } from \"@/hooks/usePermissions\";\nimport { useRoleAccess } from \"@/hooks/useRoleAccess\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Shield, AlertTriangle } from \"lucide-react\";\n\ninterface ProtectedRouteProps {\n  resource: string;\n  action: \"read\" | \"write\" | \"read_write\";\n  children: ReactNode;\n  fallback?: ReactNode;\n}\n\nexport function ProtectedRoute({\n  resource,\n  action,\n  children,\n  fallback,\n}: ProtectedRouteProps) {\n  const [, setLocation] = useLocation();\n  const { hasPermission, isLoading } = usePermissions();\n  const { isSuperAdmin, canAccessPage, canBypassAllRestrictions } = useRoleAccess();\n\n  // Super Admin bypasses ALL restrictions and guards immediately - no loading checks\n  if (isSuperAdmin() || canBypassAllRestrictions()) {\n    return <>{children}</>;\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Checking permissions...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const hasAccess = canAccessPage(resource, action) && hasPermission(resource, action);\n\n  // Redirect to unauthorized page if no access\n  useEffect(() => {\n    if (!isLoading && !hasAccess) {\n      setLocation(\"/unauthorized\");\n    }\n  }, [hasAccess, isLoading, resource, action, setLocation]);\n\n  // Check permissions using the role access hook\n  if (!hasAccess) {\n    return (\n      fallback || (\n        <div className=\"flex items-center justify-center min-h-[400px] p-6\">\n          <Card className=\"w-full max-w-md\">\n            <CardContent className=\"pt-6\">\n              <div className=\"text-center space-y-4\">\n                <div className=\"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center\">\n                  <Shield className=\"h-8 w-8 text-red-600\" />\n                </div>\n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900\">\n                    Access Denied\n                  </h3>\n                  <p className=\"text-gray-500 mt-2\">\n                    You don't have permission to access this page. Contact your\n                    administrator for access.\n                  </p>\n                </div>\n                <div className=\"flex items-center justify-center text-sm text-amber-600 bg-amber-50 p-2 rounded-lg\">\n                  <AlertTriangle className=\"h-4 w-4 mr-2\" />\n                  Required: {action.replace(\"_\", \" & \")} access to{\" \"}\n                  {resource.replace(\"_\", \" \")}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )\n    );\n  }\n\n  if (!hasPermission(resource, action)) {\n    return (\n      fallback || (\n        <div className=\"flex items-center justify-center min-h-[400px] p-6\">\n          <Card className=\"w-full max-w-md\">\n            <CardContent className=\"pt-6\">\n              <div className=\"text-center space-y-4\">\n                <div className=\"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center\">\n                  <Shield className=\"h-8 w-8 text-red-600\" />\n                </div>\n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900\">\n                    Access Denied\n                  </h3>\n                  <p className=\"text-gray-500 mt-2\">\n                    You don't have permission to {action}{\" \"}\n                    {resource.replace(\"_\", \" \")}. Contact your administrator for\n                    access.\n                  </p>\n                </div>\n                <div className=\"flex items-center justify-center text-sm text-amber-600 bg-amber-50 p-2 rounded-lg\">\n                  <AlertTriangle className=\"h-4 w-4 mr-2\" />\n                  Required: {action.replace(\"_\", \" & \")} access to{\" \"}\n                  {resource.replace(\"_\", \" \")}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )\n    );\n  }\n\n  return <>{children}</>;\n}\n","path":null,"size_bytes":4248,"size_tokens":null},"client/src/components/footer.tsx":{"content":"import { Facebook, Instagram, Linkedin, Globe } from \"lucide-react\";\n\nexport default function Footer() {\n  return (\n    <footer className=\"bg-white border-t border-gray-200 px-4 py-3 text-center text-sm text-gray-600\">\n      {/* Copyright */}\n      <p className=\"mb-2\">\n        ¬© {new Date().getFullYear()} M.A.P. Tech Pvt. Ltd. All rights reserved.\n      </p>\n\n      {/* Social Media Links */}\n      <a\n        href=\"https://facebook.com/maptechnepal \"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        aria-label=\"Facebook\"\n      >\n        <Facebook className=\"h-5 w-5 text-gray-500 hover:text-blue-600\" />\n      </a>\n      <a\n        href=\"https://instagram.com/maptechnepal \"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        aria-label=\"Instagram\"\n      >\n        <Instagram className=\"h-5 w-5 text-gray-500 hover:text-pink-600\" />\n      </a>\n      <a\n        href=\"https://linkedin.com/company/maptech-nepal \"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        aria-label=\"LinkedIn\"\n      >\n        <Linkedin className=\"h-5 w-5 text-gray-500 hover:text-blue-700\" />\n      </a>\n      <a\n        href=\"https://maptech.com.np \"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        aria-label=\"Website\"\n      >\n        <Globe className=\"h-5 w-5 text-gray-500 hover:text-green-600\" />\n      </a>\n    </footer>\n  );\n}\n","path":null,"size_bytes":1379,"size_tokens":null},"pnpm-lock.yaml":{"content":"lockfileVersion: '9.0'\n\nsettings:\n  autoInstallPeers: true\n  excludeLinksFromLockfile: false\n\nimporters:\n\n  .:\n    dependencies:\n      '@hookform/resolvers':\n        specifier: ^3.10.0\n        version: 3.10.0(react-hook-form@7.66.1(react@18.3.1))\n      '@jridgewell/trace-mapping':\n        specifier: ^0.3.25\n        version: 0.3.31\n      '@neondatabase/serverless':\n        specifier: ^0.10.4\n        version: 0.10.4\n      '@radix-ui/react-accordion':\n        specifier: ^1.2.4\n        version: 1.2.12(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-alert-dialog':\n        specifier: ^1.1.7\n        version: 1.1.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-aspect-ratio':\n        specifier: ^1.1.3\n        version: 1.1.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-avatar':\n        specifier: ^1.1.4\n        version: 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-checkbox':\n        specifier: ^1.1.5\n        version: 1.3.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-collapsible':\n        specifier: ^1.1.4\n        version: 1.1.12(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-context-menu':\n        specifier: ^2.2.7\n        version: 2.2.16(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-dialog':\n        specifier: ^1.1.7\n        version: 1.1.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-dropdown-menu':\n        specifier: ^2.1.7\n        version: 2.1.16(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-hover-card':\n        specifier: ^1.1.7\n        version: 1.1.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-label':\n        specifier: ^2.1.3\n        version: 2.1.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-menubar':\n        specifier: ^1.1.7\n        version: 1.1.16(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-navigation-menu':\n        specifier: ^1.2.6\n        version: 1.2.14(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-popover':\n        specifier: ^1.1.7\n        version: 1.1.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-progress':\n        specifier: ^1.1.3\n        version: 1.1.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-radio-group':\n        specifier: ^1.2.4\n        version: 1.3.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-scroll-area':\n        specifier: ^1.2.4\n        version: 1.2.10(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-select':\n        specifier: ^2.1.7\n        version: 2.2.6(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-separator':\n        specifier: ^1.1.3\n        version: 1.1.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-slider':\n        specifier: ^1.2.4\n        version: 1.3.6(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-slot':\n        specifier: ^1.2.0\n        version: 1.2.4(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-switch':\n        specifier: ^1.1.4\n        version: 1.2.6(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-tabs':\n        specifier: ^1.1.4\n        version: 1.1.13(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-toast':\n        specifier: ^1.2.7\n        version: 1.2.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-toggle':\n        specifier: ^1.1.3\n        version: 1.1.10(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-toggle-group':\n        specifier: ^1.1.3\n        version: 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-tooltip':\n        specifier: ^1.2.0\n        version: 1.2.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@tanstack/react-query':\n        specifier: ^5.60.5\n        version: 5.90.10(react@18.3.1)\n      '@tanstack/react-query-devtools':\n        specifier: ^5.85.6\n        version: 5.90.2(@tanstack/react-query@5.90.10(react@18.3.1))(react@18.3.1)\n      '@types/bcrypt':\n        specifier: ^5.0.2\n        version: 5.0.2\n      '@types/cors':\n        specifier: ^2.8.19\n        version: 2.8.19\n      '@types/express-fileupload':\n        specifier: ^1.5.1\n        version: 1.5.1\n      '@types/memoizee':\n        specifier: ^0.4.12\n        version: 0.4.12\n      '@types/multer':\n        specifier: ^2.0.0\n        version: 2.0.0\n      bcrypt:\n        specifier: ^6.0.0\n        version: 6.0.0\n      bcryptjs:\n        specifier: ^3.0.2\n        version: 3.0.3\n      class-variance-authority:\n        specifier: ^0.7.1\n        version: 0.7.1\n      clsx:\n        specifier: ^2.1.1\n        version: 2.1.1\n      cmdk:\n        specifier: ^1.1.1\n        version: 1.1.1(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      connect-pg-simple:\n        specifier: ^10.0.0\n        version: 10.0.0\n      cors:\n        specifier: ^2.8.5\n        version: 2.8.5\n      date-fns:\n        specifier: ^3.6.0\n        version: 3.6.0\n      dotenv:\n        specifier: ^17.2.3\n        version: 17.2.3\n      drizzle-orm:\n        specifier: ^0.39.1\n        version: 0.39.3(@neondatabase/serverless@0.10.4)(@types/pg@8.15.6)(pg@8.16.3)(postgres@3.4.7)\n      drizzle-zod:\n        specifier: ^0.7.0\n        version: 0.7.1(drizzle-orm@0.39.3(@neondatabase/serverless@0.10.4)(@types/pg@8.15.6)(pg@8.16.3)(postgres@3.4.7))(zod@3.25.76)\n      embla-carousel-react:\n        specifier: ^8.6.0\n        version: 8.6.0(react@18.3.1)\n      express:\n        specifier: ^4.21.2\n        version: 4.21.2\n      express-fileupload:\n        specifier: ^1.5.1\n        version: 1.5.2\n      express-rate-limit:\n        specifier: ^8.1.0\n        version: 8.2.1(express@4.21.2)\n      express-session:\n        specifier: ^1.18.2\n        version: 1.18.2\n      framer-motion:\n        specifier: ^11.13.1\n        version: 11.18.2(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      input-otp:\n        specifier: ^1.4.2\n        version: 1.4.2(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      lucide-react:\n        specifier: ^0.453.0\n        version: 0.453.0(react@18.3.1)\n      memoizee:\n        specifier: ^0.4.17\n        version: 0.4.17\n      memorystore:\n        specifier: ^1.6.7\n        version: 1.6.7\n      multer:\n        specifier: ^2.0.1\n        version: 2.0.2\n      nanoid:\n        specifier: ^5.1.6\n        version: 5.1.6\n      openid-client:\n        specifier: ^6.6.2\n        version: 6.8.1\n      passport:\n        specifier: ^0.7.0\n        version: 0.7.0\n      passport-local:\n        specifier: ^1.0.0\n        version: 1.0.0\n      pg:\n        specifier: ^8.16.3\n        version: 8.16.3\n      postgres:\n        specifier: ^3.4.7\n        version: 3.4.7\n      react:\n        specifier: ^18.3.1\n        version: 18.3.1\n      react-day-picker:\n        specifier: ^8.10.1\n        version: 8.10.1(date-fns@3.6.0)(react@18.3.1)\n      react-dom:\n        specifier: ^18.3.1\n        version: 18.3.1(react@18.3.1)\n      react-hook-form:\n        specifier: ^7.55.0\n        version: 7.66.1(react@18.3.1)\n      react-icons:\n        specifier: ^5.4.0\n        version: 5.5.0(react@18.3.1)\n      react-resizable-panels:\n        specifier: ^2.1.7\n        version: 2.1.9(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      recharts:\n        specifier: ^2.15.2\n        version: 2.15.4(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      tailwind-merge:\n        specifier: ^2.6.0\n        version: 2.6.0\n      tailwindcss-animate:\n        specifier: ^1.0.7\n        version: 1.0.7(tailwindcss@3.4.18(tsx@4.20.6))\n      tw-animate-css:\n        specifier: ^1.2.5\n        version: 1.4.0\n      vaul:\n        specifier: ^1.1.2\n        version: 1.1.2(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      wouter:\n        specifier: ^3.3.5\n        version: 3.7.1(react@18.3.1)\n      ws:\n        specifier: ^8.18.0\n        version: 8.18.3(bufferutil@4.0.9)\n      zod:\n        specifier: ^3.24.2\n        version: 3.25.76\n      zod-validation-error:\n        specifier: ^3.4.0\n        version: 3.5.4(zod@3.25.76)\n    devDependencies:\n      '@replit/vite-plugin-cartographer':\n        specifier: ^0.2.7\n        version: 0.2.8\n      '@replit/vite-plugin-runtime-error-modal':\n        specifier: ^0.0.3\n        version: 0.0.3\n      '@tailwindcss/typography':\n        specifier: ^0.5.15\n        version: 0.5.19(tailwindcss@3.4.18(tsx@4.20.6))\n      '@tailwindcss/vite':\n        specifier: ^4.1.3\n        version: 4.1.17(vite@5.4.21(@types/node@20.16.11)(lightningcss@1.30.2))\n      '@types/connect-pg-simple':\n        specifier: ^7.0.3\n        version: 7.0.3\n      '@types/express':\n        specifier: 4.17.21\n        version: 4.17.21\n      '@types/express-session':\n        specifier: ^1.18.0\n        version: 1.18.2\n      '@types/node':\n        specifier: 20.16.11\n        version: 20.16.11\n      '@types/passport':\n        specifier: ^1.0.16\n        version: 1.0.17\n      '@types/passport-local':\n        specifier: ^1.0.38\n        version: 1.0.38\n      '@types/react':\n        specifier: ^18.3.11\n        version: 18.3.27\n      '@types/react-dom':\n        specifier: ^18.3.1\n        version: 18.3.7(@types/react@18.3.27)\n      '@types/ws':\n        specifier: ^8.5.13\n        version: 8.18.1\n      '@vitejs/plugin-react':\n        specifier: ^4.3.2\n        version: 4.7.0(vite@5.4.21(@types/node@20.16.11)(lightningcss@1.30.2))\n      autoprefixer:\n        specifier: ^10.4.20\n        version: 10.4.22(postcss@8.5.6)\n      drizzle-kit:\n        specifier: ^0.30.6\n        version: 0.30.6\n      esbuild:\n        specifier: ^0.25.0\n        version: 0.25.12\n      postcss:\n        specifier: ^8.4.47\n        version: 8.5.6\n      tailwindcss:\n        specifier: ^3.4.17\n        version: 3.4.18(tsx@4.20.6)\n      ts-node:\n        specifier: ^10.9.2\n        version: 10.9.2(@types/node@20.16.11)(typescript@5.9.3)\n      tsx:\n        specifier: ^4.20.5\n        version: 4.20.6\n      typescript:\n        specifier: ^5.6.3\n        version: 5.9.3\n      vite:\n        specifier: ^5.4.14\n        version: 5.4.21(@types/node@20.16.11)(lightningcss@1.30.2)\n    optionalDependencies:\n      bufferutil:\n        specifier: ^4.0.8\n        version: 4.0.9\n\npackages:\n\n  '@alloc/quick-lru@5.2.0':\n    resolution: {integrity: sha512-UrcABB+4bUrFABwbluTIBErXwvbsU/V7TZWfmbgJfbkwiBuziS9gxdODUyuiecfdGQ85jglMW6juS3+z5TsKLw==}\n    engines: {node: '>=10'}\n\n  '@babel/code-frame@7.27.1':\n    resolution: {integrity: sha512-cjQ7ZlQ0Mv3b47hABuTevyTuYN4i+loJKGeV9flcCgIK37cCXRh+L1bd3iBHlynerhQ7BhCkn2BPbQUL+rGqFg==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/compat-data@7.28.5':\n    resolution: {integrity: sha512-6uFXyCayocRbqhZOB+6XcuZbkMNimwfVGFji8CTZnCzOHVGvDqzvitu1re2AU5LROliz7eQPhB8CpAMvnx9EjA==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/core@7.28.5':\n    resolution: {integrity: sha512-e7jT4DxYvIDLk1ZHmU/m/mB19rex9sv0c2ftBtjSBv+kVM/902eh0fINUzD7UwLLNR+jU585GxUJ8/EBfAM5fw==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/generator@7.28.5':\n    resolution: {integrity: sha512-3EwLFhZ38J4VyIP6WNtt2kUdW9dokXA9Cr4IVIFHuCpZ3H8/YFOl5JjZHisrn1fATPBmKKqXzDFvh9fUwHz6CQ==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/helper-compilation-targets@7.27.2':\n    resolution: {integrity: sha512-2+1thGUUWWjLTYTHZWK1n8Yga0ijBz1XAhUXcKy81rd5g6yh7hGqMp45v7cadSbEHc9G3OTv45SyneRN3ps4DQ==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/helper-globals@7.28.0':\n    resolution: {integrity: sha512-+W6cISkXFa1jXsDEdYA8HeevQT/FULhxzR99pxphltZcVaugps53THCeiWA8SguxxpSp3gKPiuYfSWopkLQ4hw==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/helper-module-imports@7.27.1':\n    resolution: {integrity: sha512-0gSFWUPNXNopqtIPQvlD5WgXYI5GY2kP2cCvoT8kczjbfcfuIljTbcWrulD1CIPIX2gt1wghbDy08yE1p+/r3w==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/helper-module-transforms@7.28.3':\n    resolution: {integrity: sha512-gytXUbs8k2sXS9PnQptz5o0QnpLL51SwASIORY6XaBKF88nsOT0Zw9szLqlSGQDP/4TljBAD5y98p2U1fqkdsw==}\n    engines: {node: '>=6.9.0'}\n    peerDependencies:\n      '@babel/core': ^7.0.0\n\n  '@babel/helper-plugin-utils@7.27.1':\n    resolution: {integrity: sha512-1gn1Up5YXka3YYAHGKpbideQ5Yjf1tDa9qYcgysz+cNCXukyLl6DjPXhD3VRwSb8c0J9tA4b2+rHEZtc6R0tlw==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/helper-string-parser@7.27.1':\n    resolution: {integrity: sha512-qMlSxKbpRlAridDExk92nSobyDdpPijUq2DW6oDnUqd0iOGxmQjyqhMIihI9+zv4LPyZdRje2cavWPbCbWm3eA==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/helper-validator-identifier@7.28.5':\n    resolution: {integrity: sha512-qSs4ifwzKJSV39ucNjsvc6WVHs6b7S03sOh2OcHF9UHfVPqWWALUsNUVzhSBiItjRZoLHx7nIarVjqKVusUZ1Q==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/helper-validator-option@7.27.1':\n    resolution: {integrity: sha512-YvjJow9FxbhFFKDSuFnVCe2WxXk1zWc22fFePVNEaWJEu8IrZVlda6N0uHwzZrUM1il7NC9Mlp4MaJYbYd9JSg==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/helpers@7.28.4':\n    resolution: {integrity: sha512-HFN59MmQXGHVyYadKLVumYsA9dBFun/ldYxipEjzA4196jpLZd8UjEEBLkbEkvfYreDqJhZxYAWFPtrfhNpj4w==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/parser@7.28.5':\n    resolution: {integrity: sha512-KKBU1VGYR7ORr3At5HAtUQ+TV3SzRCXmA/8OdDZiLDBIZxVyzXuztPjfLd3BV1PRAQGCMWWSHYhL0F8d5uHBDQ==}\n    engines: {node: '>=6.0.0'}\n    hasBin: true\n\n  '@babel/plugin-transform-react-jsx-self@7.27.1':\n    resolution: {integrity: sha512-6UzkCs+ejGdZ5mFFC/OCUrv028ab2fp1znZmCZjAOBKiBK2jXD1O+BPSfX8X2qjJ75fZBMSnQn3Rq2mrBJK2mw==}\n    engines: {node: '>=6.9.0'}\n    peerDependencies:\n      '@babel/core': ^7.0.0-0\n\n  '@babel/plugin-transform-react-jsx-source@7.27.1':\n    resolution: {integrity: sha512-zbwoTsBruTeKB9hSq73ha66iFeJHuaFkUbwvqElnygoNbj/jHRsSeokowZFN3CZ64IvEqcmmkVe89OPXc7ldAw==}\n    engines: {node: '>=6.9.0'}\n    peerDependencies:\n      '@babel/core': ^7.0.0-0\n\n  '@babel/runtime@7.28.4':\n    resolution: {integrity: sha512-Q/N6JNWvIvPnLDvjlE1OUBLPQHH6l3CltCEsHIujp45zQUSSh8K+gHnaEX45yAT1nyngnINhvWtzN+Nb9D8RAQ==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/template@7.27.2':\n    resolution: {integrity: sha512-LPDZ85aEJyYSd18/DkjNh4/y1ntkE5KwUHWTiqgRxruuZL2F1yuHligVHLvcHY2vMHXttKFpJn6LwfI7cw7ODw==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/traverse@7.28.5':\n    resolution: {integrity: sha512-TCCj4t55U90khlYkVV/0TfkJkAkUg3jZFA3Neb7unZT8CPok7iiRfaX0F+WnqWqt7OxhOn0uBKXCw4lbL8W0aQ==}\n    engines: {node: '>=6.9.0'}\n\n  '@babel/types@7.28.5':\n    resolution: {integrity: sha512-qQ5m48eI/MFLQ5PxQj4PFaprjyCTLI37ElWMmNs0K8Lk3dVeOdNpB3ks8jc7yM5CDmVC73eMVk/trk3fgmrUpA==}\n    engines: {node: '>=6.9.0'}\n\n  '@cspotcode/source-map-support@0.8.1':\n    resolution: {integrity: sha512-IchNf6dN4tHoMFIn/7OE8LWZ19Y6q/67Bmf6vnGREv8RSbBVb9LPJxEcnwrcwX6ixSvaiGoomAUvu4YSxXrVgw==}\n    engines: {node: '>=12'}\n\n  '@drizzle-team/brocli@0.10.2':\n    resolution: {integrity: sha512-z33Il7l5dKjUgGULTqBsQBQwckHh5AbIuxhdsIxDDiZAzBOrZO6q9ogcWC65kU382AfynTfgNumVcNIjuIua6w==}\n\n  '@esbuild-kit/core-utils@3.3.2':\n    resolution: {integrity: sha512-sPRAnw9CdSsRmEtnsl2WXWdyquogVpB3yZ3dgwJfe8zrOzTsV7cJvmwrKVa+0ma5BoiGJ+BoqkMvawbayKUsqQ==}\n    deprecated: 'Merged into tsx: https://tsx.is'\n\n  '@esbuild-kit/esm-loader@2.6.5':\n    resolution: {integrity: sha512-FxEMIkJKnodyA1OaCUoEvbYRkoZlLZ4d/eXFu9Fh8CbBBgP5EmZxrfTRyN0qpXZ4vOvqnE5YdRdcrmUUXuU+dA==}\n    deprecated: 'Merged into tsx: https://tsx.is'\n\n  '@esbuild/aix-ppc64@0.19.12':\n    resolution: {integrity: sha512-bmoCYyWdEL3wDQIVbcyzRyeKLgk2WtWLTWz1ZIAZF/EGbNOwSA6ew3PftJ1PqMiOOGu0OyFMzG53L0zqIpPeNA==}\n    engines: {node: '>=12'}\n    cpu: [ppc64]\n    os: [aix]\n\n  '@esbuild/aix-ppc64@0.21.5':\n    resolution: {integrity: sha512-1SDgH6ZSPTlggy1yI6+Dbkiz8xzpHJEVAlF/AM1tHPLsf5STom9rwtjE4hKAF20FfXXNTFqEYXyJNWh1GiZedQ==}\n    engines: {node: '>=12'}\n    cpu: [ppc64]\n    os: [aix]\n\n  '@esbuild/aix-ppc64@0.25.12':\n    resolution: {integrity: sha512-Hhmwd6CInZ3dwpuGTF8fJG6yoWmsToE+vYgD4nytZVxcu1ulHpUQRAB1UJ8+N1Am3Mz4+xOByoQoSZf4D+CpkA==}\n    engines: {node: '>=18'}\n    cpu: [ppc64]\n    os: [aix]\n\n  '@esbuild/android-arm64@0.18.20':\n    resolution: {integrity: sha512-Nz4rJcchGDtENV0eMKUNa6L12zz2zBDXuhj/Vjh18zGqB44Bi7MBMSXjgunJgjRhCmKOjnPuZp4Mb6OKqtMHLQ==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [android]\n\n  '@esbuild/android-arm64@0.19.12':\n    resolution: {integrity: sha512-P0UVNGIienjZv3f5zq0DP3Nt2IE/3plFzuaS96vihvD0Hd6H/q4WXUGpCxD/E8YrSXfNyRPbpTq+T8ZQioSuPA==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [android]\n\n  '@esbuild/android-arm64@0.21.5':\n    resolution: {integrity: sha512-c0uX9VAUBQ7dTDCjq+wdyGLowMdtR/GoC2U5IYk/7D1H1JYC0qseD7+11iMP2mRLN9RcCMRcjC4YMclCzGwS/A==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [android]\n\n  '@esbuild/android-arm64@0.25.12':\n    resolution: {integrity: sha512-6AAmLG7zwD1Z159jCKPvAxZd4y/VTO0VkprYy+3N2FtJ8+BQWFXU+OxARIwA46c5tdD9SsKGZ/1ocqBS/gAKHg==}\n    engines: {node: '>=18'}\n    cpu: [arm64]\n    os: [android]\n\n  '@esbuild/android-arm@0.18.20':\n    resolution: {integrity: sha512-fyi7TDI/ijKKNZTUJAQqiG5T7YjJXgnzkURqmGj13C6dCqckZBLdl4h7bkhHt/t0WP+zO9/zwroDvANaOqO5Sw==}\n    engines: {node: '>=12'}\n    cpu: [arm]\n    os: [android]\n\n  '@esbuild/android-arm@0.19.12':\n    resolution: {integrity: sha512-qg/Lj1mu3CdQlDEEiWrlC4eaPZ1KztwGJ9B6J+/6G+/4ewxJg7gqj8eVYWvao1bXrqGiW2rsBZFSX3q2lcW05w==}\n    engines: {node: '>=12'}\n    cpu: [arm]\n    os: [android]\n\n  '@esbuild/android-arm@0.21.5':\n    resolution: {integrity: sha512-vCPvzSjpPHEi1siZdlvAlsPxXl7WbOVUBBAowWug4rJHb68Ox8KualB+1ocNvT5fjv6wpkX6o/iEpbDrf68zcg==}\n    engines: {node: '>=12'}\n    cpu: [arm]\n    os: [android]\n\n  '@esbuild/android-arm@0.25.12':\n    resolution: {integrity: sha512-VJ+sKvNA/GE7Ccacc9Cha7bpS8nyzVv0jdVgwNDaR4gDMC/2TTRc33Ip8qrNYUcpkOHUT5OZ0bUcNNVZQ9RLlg==}\n    engines: {node: '>=18'}\n    cpu: [arm]\n    os: [android]\n\n  '@esbuild/android-x64@0.18.20':\n    resolution: {integrity: sha512-8GDdlePJA8D6zlZYJV/jnrRAi6rOiNaCC/JclcXpB+KIuvfBN4owLtgzY2bsxnx666XjJx2kDPUmnTtR8qKQUg==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [android]\n\n  '@esbuild/android-x64@0.19.12':\n    resolution: {integrity: sha512-3k7ZoUW6Q6YqhdhIaq/WZ7HwBpnFBlW905Fa4s4qWJyiNOgT1dOqDiVAQFwBH7gBRZr17gLrlFCRzF6jFh7Kew==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [android]\n\n  '@esbuild/android-x64@0.21.5':\n    resolution: {integrity: sha512-D7aPRUUNHRBwHxzxRvp856rjUHRFW1SdQATKXH2hqA0kAZb1hKmi02OpYRacl0TxIGz/ZmXWlbZgjwWYaCakTA==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [android]\n\n  '@esbuild/android-x64@0.25.12':\n    resolution: {integrity: sha512-5jbb+2hhDHx5phYR2By8GTWEzn6I9UqR11Kwf22iKbNpYrsmRB18aX/9ivc5cabcUiAT/wM+YIZ6SG9QO6a8kg==}\n    engines: {node: '>=18'}\n    cpu: [x64]\n    os: [android]\n\n  '@esbuild/darwin-arm64@0.18.20':\n    resolution: {integrity: sha512-bxRHW5kHU38zS2lPTPOyuyTm+S+eobPUnTNkdJEfAddYgEcll4xkT8DB9d2008DtTbl7uJag2HuE5NZAZgnNEA==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [darwin]\n\n  '@esbuild/darwin-arm64@0.19.12':\n    resolution: {integrity: sha512-B6IeSgZgtEzGC42jsI+YYu9Z3HKRxp8ZT3cqhvliEHovq8HSX2YX8lNocDn79gCKJXOSaEot9MVYky7AKjCs8g==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [darwin]\n\n  '@esbuild/darwin-arm64@0.21.5':\n    resolution: {integrity: sha512-DwqXqZyuk5AiWWf3UfLiRDJ5EDd49zg6O9wclZ7kUMv2WRFr4HKjXp/5t8JZ11QbQfUS6/cRCKGwYhtNAY88kQ==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [darwin]\n\n  '@esbuild/darwin-arm64@0.25.12':\n    resolution: {integrity: sha512-N3zl+lxHCifgIlcMUP5016ESkeQjLj/959RxxNYIthIg+CQHInujFuXeWbWMgnTo4cp5XVHqFPmpyu9J65C1Yg==}\n    engines: {node: '>=18'}\n    cpu: [arm64]\n    os: [darwin]\n\n  '@esbuild/darwin-x64@0.18.20':\n    resolution: {integrity: sha512-pc5gxlMDxzm513qPGbCbDukOdsGtKhfxD1zJKXjCCcU7ju50O7MeAZ8c4krSJcOIJGFR+qx21yMMVYwiQvyTyQ==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [darwin]\n\n  '@esbuild/darwin-x64@0.19.12':\n    resolution: {integrity: sha512-hKoVkKzFiToTgn+41qGhsUJXFlIjxI/jSYeZf3ugemDYZldIXIxhvwN6erJGlX4t5h417iFuheZ7l+YVn05N3A==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [darwin]\n\n  '@esbuild/darwin-x64@0.21.5':\n    resolution: {integrity: sha512-se/JjF8NlmKVG4kNIuyWMV/22ZaerB+qaSi5MdrXtd6R08kvs2qCN4C09miupktDitvh8jRFflwGFBQcxZRjbw==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [darwin]\n\n  '@esbuild/darwin-x64@0.25.12':\n    resolution: {integrity: sha512-HQ9ka4Kx21qHXwtlTUVbKJOAnmG1ipXhdWTmNXiPzPfWKpXqASVcWdnf2bnL73wgjNrFXAa3yYvBSd9pzfEIpA==}\n    engines: {node: '>=18'}\n    cpu: [x64]\n    os: [darwin]\n\n  '@esbuild/freebsd-arm64@0.18.20':\n    resolution: {integrity: sha512-yqDQHy4QHevpMAaxhhIwYPMv1NECwOvIpGCZkECn8w2WFHXjEwrBn3CeNIYsibZ/iZEUemj++M26W3cNR5h+Tw==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [freebsd]\n\n  '@esbuild/freebsd-arm64@0.19.12':\n    resolution: {integrity: sha512-4aRvFIXmwAcDBw9AueDQ2YnGmz5L6obe5kmPT8Vd+/+x/JMVKCgdcRwH6APrbpNXsPz+K653Qg8HB/oXvXVukA==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [freebsd]\n\n  '@esbuild/freebsd-arm64@0.21.5':\n    resolution: {integrity: sha512-5JcRxxRDUJLX8JXp/wcBCy3pENnCgBR9bN6JsY4OmhfUtIHe3ZW0mawA7+RDAcMLrMIZaf03NlQiX9DGyB8h4g==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [freebsd]\n\n  '@esbuild/freebsd-arm64@0.25.12':\n    resolution: {integrity: sha512-gA0Bx759+7Jve03K1S0vkOu5Lg/85dou3EseOGUes8flVOGxbhDDh/iZaoek11Y8mtyKPGF3vP8XhnkDEAmzeg==}\n    engines: {node: '>=18'}\n    cpu: [arm64]\n    os: [freebsd]\n\n  '@esbuild/freebsd-x64@0.18.20':\n    resolution: {integrity: sha512-tgWRPPuQsd3RmBZwarGVHZQvtzfEBOreNuxEMKFcd5DaDn2PbBxfwLcj4+aenoh7ctXcbXmOQIn8HI6mCSw5MQ==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [freebsd]\n\n  '@esbuild/freebsd-x64@0.19.12':\n    resolution: {integrity: sha512-EYoXZ4d8xtBoVN7CEwWY2IN4ho76xjYXqSXMNccFSx2lgqOG/1TBPW0yPx1bJZk94qu3tX0fycJeeQsKovA8gg==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [freebsd]\n\n  '@esbuild/freebsd-x64@0.21.5':\n    resolution: {integrity: sha512-J95kNBj1zkbMXtHVH29bBriQygMXqoVQOQYA+ISs0/2l3T9/kj42ow2mpqerRBxDJnmkUDCaQT/dfNXWX/ZZCQ==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [freebsd]\n\n  '@esbuild/freebsd-x64@0.25.12':\n    resolution: {integrity: sha512-TGbO26Yw2xsHzxtbVFGEXBFH0FRAP7gtcPE7P5yP7wGy7cXK2oO7RyOhL5NLiqTlBh47XhmIUXuGciXEqYFfBQ==}\n    engines: {node: '>=18'}\n    cpu: [x64]\n    os: [freebsd]\n\n  '@esbuild/linux-arm64@0.18.20':\n    resolution: {integrity: sha512-2YbscF+UL7SQAVIpnWvYwM+3LskyDmPhe31pE7/aoTMFKKzIc9lLbyGUpmmb8a8AixOL61sQ/mFh3jEjHYFvdA==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [linux]\n\n  '@esbuild/linux-arm64@0.19.12':\n    resolution: {integrity: sha512-EoTjyYyLuVPfdPLsGVVVC8a0p1BFFvtpQDB/YLEhaXyf/5bczaGeN15QkR+O4S5LeJ92Tqotve7i1jn35qwvdA==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [linux]\n\n  '@esbuild/linux-arm64@0.21.5':\n    resolution: {integrity: sha512-ibKvmyYzKsBeX8d8I7MH/TMfWDXBF3db4qM6sy+7re0YXya+K1cem3on9XgdT2EQGMu4hQyZhan7TeQ8XkGp4Q==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [linux]\n\n  '@esbuild/linux-arm64@0.25.12':\n    resolution: {integrity: sha512-8bwX7a8FghIgrupcxb4aUmYDLp8pX06rGh5HqDT7bB+8Rdells6mHvrFHHW2JAOPZUbnjUpKTLg6ECyzvas2AQ==}\n    engines: {node: '>=18'}\n    cpu: [arm64]\n    os: [linux]\n\n  '@esbuild/linux-arm@0.18.20':\n    resolution: {integrity: sha512-/5bHkMWnq1EgKr1V+Ybz3s1hWXok7mDFUMQ4cG10AfW3wL02PSZi5kFpYKrptDsgb2WAJIvRcDm+qIvXf/apvg==}\n    engines: {node: '>=12'}\n    cpu: [arm]\n    os: [linux]\n\n  '@esbuild/linux-arm@0.19.12':\n    resolution: {integrity: sha512-J5jPms//KhSNv+LO1S1TX1UWp1ucM6N6XuL6ITdKWElCu8wXP72l9MM0zDTzzeikVyqFE6U8YAV9/tFyj0ti+w==}\n    engines: {node: '>=12'}\n    cpu: [arm]\n    os: [linux]\n\n  '@esbuild/linux-arm@0.21.5':\n    resolution: {integrity: sha512-bPb5AHZtbeNGjCKVZ9UGqGwo8EUu4cLq68E95A53KlxAPRmUyYv2D6F0uUI65XisGOL1hBP5mTronbgo+0bFcA==}\n    engines: {node: '>=12'}\n    cpu: [arm]\n    os: [linux]\n\n  '@esbuild/linux-arm@0.25.12':\n    resolution: {integrity: sha512-lPDGyC1JPDou8kGcywY0YILzWlhhnRjdof3UlcoqYmS9El818LLfJJc3PXXgZHrHCAKs/Z2SeZtDJr5MrkxtOw==}\n    engines: {node: '>=18'}\n    cpu: [arm]\n    os: [linux]\n\n  '@esbuild/linux-ia32@0.18.20':\n    resolution: {integrity: sha512-P4etWwq6IsReT0E1KHU40bOnzMHoH73aXp96Fs8TIT6z9Hu8G6+0SHSw9i2isWrD2nbx2qo5yUqACgdfVGx7TA==}\n    engines: {node: '>=12'}\n    cpu: [ia32]\n    os: [linux]\n\n  '@esbuild/linux-ia32@0.19.12':\n    resolution: {integrity: sha512-Thsa42rrP1+UIGaWz47uydHSBOgTUnwBwNq59khgIwktK6x60Hivfbux9iNR0eHCHzOLjLMLfUMLCypBkZXMHA==}\n    engines: {node: '>=12'}\n    cpu: [ia32]\n    os: [linux]\n\n  '@esbuild/linux-ia32@0.21.5':\n    resolution: {integrity: sha512-YvjXDqLRqPDl2dvRODYmmhz4rPeVKYvppfGYKSNGdyZkA01046pLWyRKKI3ax8fbJoK5QbxblURkwK/MWY18Tg==}\n    engines: {node: '>=12'}\n    cpu: [ia32]\n    os: [linux]\n\n  '@esbuild/linux-ia32@0.25.12':\n    resolution: {integrity: sha512-0y9KrdVnbMM2/vG8KfU0byhUN+EFCny9+8g202gYqSSVMonbsCfLjUO+rCci7pM0WBEtz+oK/PIwHkzxkyharA==}\n    engines: {node: '>=18'}\n    cpu: [ia32]\n    os: [linux]\n\n  '@esbuild/linux-loong64@0.18.20':\n    resolution: {integrity: sha512-nXW8nqBTrOpDLPgPY9uV+/1DjxoQ7DoB2N8eocyq8I9XuqJ7BiAMDMf9n1xZM9TgW0J8zrquIb/A7s3BJv7rjg==}\n    engines: {node: '>=12'}\n    cpu: [loong64]\n    os: [linux]\n\n  '@esbuild/linux-loong64@0.19.12':\n    resolution: {integrity: sha512-LiXdXA0s3IqRRjm6rV6XaWATScKAXjI4R4LoDlvO7+yQqFdlr1Bax62sRwkVvRIrwXxvtYEHHI4dm50jAXkuAA==}\n    engines: {node: '>=12'}\n    cpu: [loong64]\n    os: [linux]\n\n  '@esbuild/linux-loong64@0.21.5':\n    resolution: {integrity: sha512-uHf1BmMG8qEvzdrzAqg2SIG/02+4/DHB6a9Kbya0XDvwDEKCoC8ZRWI5JJvNdUjtciBGFQ5PuBlpEOXQj+JQSg==}\n    engines: {node: '>=12'}\n    cpu: [loong64]\n    os: [linux]\n\n  '@esbuild/linux-loong64@0.25.12':\n    resolution: {integrity: sha512-h///Lr5a9rib/v1GGqXVGzjL4TMvVTv+s1DPoxQdz7l/AYv6LDSxdIwzxkrPW438oUXiDtwM10o9PmwS/6Z0Ng==}\n    engines: {node: '>=18'}\n    cpu: [loong64]\n    os: [linux]\n\n  '@esbuild/linux-mips64el@0.18.20':\n    resolution: {integrity: sha512-d5NeaXZcHp8PzYy5VnXV3VSd2D328Zb+9dEq5HE6bw6+N86JVPExrA6O68OPwobntbNJ0pzCpUFZTo3w0GyetQ==}\n    engines: {node: '>=12'}\n    cpu: [mips64el]\n    os: [linux]\n\n  '@esbuild/linux-mips64el@0.19.12':\n    resolution: {integrity: sha512-fEnAuj5VGTanfJ07ff0gOA6IPsvrVHLVb6Lyd1g2/ed67oU1eFzL0r9WL7ZzscD+/N6i3dWumGE1Un4f7Amf+w==}\n    engines: {node: '>=12'}\n    cpu: [mips64el]\n    os: [linux]\n\n  '@esbuild/linux-mips64el@0.21.5':\n    resolution: {integrity: sha512-IajOmO+KJK23bj52dFSNCMsz1QP1DqM6cwLUv3W1QwyxkyIWecfafnI555fvSGqEKwjMXVLokcV5ygHW5b3Jbg==}\n    engines: {node: '>=12'}\n    cpu: [mips64el]\n    os: [linux]\n\n  '@esbuild/linux-mips64el@0.25.12':\n    resolution: {integrity: sha512-iyRrM1Pzy9GFMDLsXn1iHUm18nhKnNMWscjmp4+hpafcZjrr2WbT//d20xaGljXDBYHqRcl8HnxbX6uaA/eGVw==}\n    engines: {node: '>=18'}\n    cpu: [mips64el]\n    os: [linux]\n\n  '@esbuild/linux-ppc64@0.18.20':\n    resolution: {integrity: sha512-WHPyeScRNcmANnLQkq6AfyXRFr5D6N2sKgkFo2FqguP44Nw2eyDlbTdZwd9GYk98DZG9QItIiTlFLHJHjxP3FA==}\n    engines: {node: '>=12'}\n    cpu: [ppc64]\n    os: [linux]\n\n  '@esbuild/linux-ppc64@0.19.12':\n    resolution: {integrity: sha512-nYJA2/QPimDQOh1rKWedNOe3Gfc8PabU7HT3iXWtNUbRzXS9+vgB0Fjaqr//XNbd82mCxHzik2qotuI89cfixg==}\n    engines: {node: '>=12'}\n    cpu: [ppc64]\n    os: [linux]\n\n  '@esbuild/linux-ppc64@0.21.5':\n    resolution: {integrity: sha512-1hHV/Z4OEfMwpLO8rp7CvlhBDnjsC3CttJXIhBi+5Aj5r+MBvy4egg7wCbe//hSsT+RvDAG7s81tAvpL2XAE4w==}\n    engines: {node: '>=12'}\n    cpu: [ppc64]\n    os: [linux]\n\n  '@esbuild/linux-ppc64@0.25.12':\n    resolution: {integrity: sha512-9meM/lRXxMi5PSUqEXRCtVjEZBGwB7P/D4yT8UG/mwIdze2aV4Vo6U5gD3+RsoHXKkHCfSxZKzmDssVlRj1QQA==}\n    engines: {node: '>=18'}\n    cpu: [ppc64]\n    os: [linux]\n\n  '@esbuild/linux-riscv64@0.18.20':\n    resolution: {integrity: sha512-WSxo6h5ecI5XH34KC7w5veNnKkju3zBRLEQNY7mv5mtBmrP/MjNBCAlsM2u5hDBlS3NGcTQpoBvRzqBcRtpq1A==}\n    engines: {node: '>=12'}\n    cpu: [riscv64]\n    os: [linux]\n\n  '@esbuild/linux-riscv64@0.19.12':\n    resolution: {integrity: sha512-2MueBrlPQCw5dVJJpQdUYgeqIzDQgw3QtiAHUC4RBz9FXPrskyyU3VI1hw7C0BSKB9OduwSJ79FTCqtGMWqJHg==}\n    engines: {node: '>=12'}\n    cpu: [riscv64]\n    os: [linux]\n\n  '@esbuild/linux-riscv64@0.21.5':\n    resolution: {integrity: sha512-2HdXDMd9GMgTGrPWnJzP2ALSokE/0O5HhTUvWIbD3YdjME8JwvSCnNGBnTThKGEB91OZhzrJ4qIIxk/SBmyDDA==}\n    engines: {node: '>=12'}\n    cpu: [riscv64]\n    os: [linux]\n\n  '@esbuild/linux-riscv64@0.25.12':\n    resolution: {integrity: sha512-Zr7KR4hgKUpWAwb1f3o5ygT04MzqVrGEGXGLnj15YQDJErYu/BGg+wmFlIDOdJp0PmB0lLvxFIOXZgFRrdjR0w==}\n    engines: {node: '>=18'}\n    cpu: [riscv64]\n    os: [linux]\n\n  '@esbuild/linux-s390x@0.18.20':\n    resolution: {integrity: sha512-+8231GMs3mAEth6Ja1iK0a1sQ3ohfcpzpRLH8uuc5/KVDFneH6jtAJLFGafpzpMRO6DzJ6AvXKze9LfFMrIHVQ==}\n    engines: {node: '>=12'}\n    cpu: [s390x]\n    os: [linux]\n\n  '@esbuild/linux-s390x@0.19.12':\n    resolution: {integrity: sha512-+Pil1Nv3Umes4m3AZKqA2anfhJiVmNCYkPchwFJNEJN5QxmTs1uzyy4TvmDrCRNT2ApwSari7ZIgrPeUx4UZDg==}\n    engines: {node: '>=12'}\n    cpu: [s390x]\n    os: [linux]\n\n  '@esbuild/linux-s390x@0.21.5':\n    resolution: {integrity: sha512-zus5sxzqBJD3eXxwvjN1yQkRepANgxE9lgOW2qLnmr8ikMTphkjgXu1HR01K4FJg8h1kEEDAqDcZQtbrRnB41A==}\n    engines: {node: '>=12'}\n    cpu: [s390x]\n    os: [linux]\n\n  '@esbuild/linux-s390x@0.25.12':\n    resolution: {integrity: sha512-MsKncOcgTNvdtiISc/jZs/Zf8d0cl/t3gYWX8J9ubBnVOwlk65UIEEvgBORTiljloIWnBzLs4qhzPkJcitIzIg==}\n    engines: {node: '>=18'}\n    cpu: [s390x]\n    os: [linux]\n\n  '@esbuild/linux-x64@0.18.20':\n    resolution: {integrity: sha512-UYqiqemphJcNsFEskc73jQ7B9jgwjWrSayxawS6UVFZGWrAAtkzjxSqnoclCXxWtfwLdzU+vTpcNYhpn43uP1w==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [linux]\n\n  '@esbuild/linux-x64@0.19.12':\n    resolution: {integrity: sha512-B71g1QpxfwBvNrfyJdVDexenDIt1CiDN1TIXLbhOw0KhJzE78KIFGX6OJ9MrtC0oOqMWf+0xop4qEU8JrJTwCg==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [linux]\n\n  '@esbuild/linux-x64@0.21.5':\n    resolution: {integrity: sha512-1rYdTpyv03iycF1+BhzrzQJCdOuAOtaqHTWJZCWvijKD2N5Xu0TtVC8/+1faWqcP9iBCWOmjmhoH94dH82BxPQ==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [linux]\n\n  '@esbuild/linux-x64@0.25.12':\n    resolution: {integrity: sha512-uqZMTLr/zR/ed4jIGnwSLkaHmPjOjJvnm6TVVitAa08SLS9Z0VM8wIRx7gWbJB5/J54YuIMInDquWyYvQLZkgw==}\n    engines: {node: '>=18'}\n    cpu: [x64]\n    os: [linux]\n\n  '@esbuild/netbsd-arm64@0.25.12':\n    resolution: {integrity: sha512-xXwcTq4GhRM7J9A8Gv5boanHhRa/Q9KLVmcyXHCTaM4wKfIpWkdXiMog/KsnxzJ0A1+nD+zoecuzqPmCRyBGjg==}\n    engines: {node: '>=18'}\n    cpu: [arm64]\n    os: [netbsd]\n\n  '@esbuild/netbsd-x64@0.18.20':\n    resolution: {integrity: sha512-iO1c++VP6xUBUmltHZoMtCUdPlnPGdBom6IrO4gyKPFFVBKioIImVooR5I83nTew5UOYrk3gIJhbZh8X44y06A==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [netbsd]\n\n  '@esbuild/netbsd-x64@0.19.12':\n    resolution: {integrity: sha512-3ltjQ7n1owJgFbuC61Oj++XhtzmymoCihNFgT84UAmJnxJfm4sYCiSLTXZtE00VWYpPMYc+ZQmB6xbSdVh0JWA==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [netbsd]\n\n  '@esbuild/netbsd-x64@0.21.5':\n    resolution: {integrity: sha512-Woi2MXzXjMULccIwMnLciyZH4nCIMpWQAs049KEeMvOcNADVxo0UBIQPfSmxB3CWKedngg7sWZdLvLczpe0tLg==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [netbsd]\n\n  '@esbuild/netbsd-x64@0.25.12':\n    resolution: {integrity: sha512-Ld5pTlzPy3YwGec4OuHh1aCVCRvOXdH8DgRjfDy/oumVovmuSzWfnSJg+VtakB9Cm0gxNO9BzWkj6mtO1FMXkQ==}\n    engines: {node: '>=18'}\n    cpu: [x64]\n    os: [netbsd]\n\n  '@esbuild/openbsd-arm64@0.25.12':\n    resolution: {integrity: sha512-fF96T6KsBo/pkQI950FARU9apGNTSlZGsv1jZBAlcLL1MLjLNIWPBkj5NlSz8aAzYKg+eNqknrUJ24QBybeR5A==}\n    engines: {node: '>=18'}\n    cpu: [arm64]\n    os: [openbsd]\n\n  '@esbuild/openbsd-x64@0.18.20':\n    resolution: {integrity: sha512-e5e4YSsuQfX4cxcygw/UCPIEP6wbIL+se3sxPdCiMbFLBWu0eiZOJ7WoD+ptCLrmjZBK1Wk7I6D/I3NglUGOxg==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [openbsd]\n\n  '@esbuild/openbsd-x64@0.19.12':\n    resolution: {integrity: sha512-RbrfTB9SWsr0kWmb9srfF+L933uMDdu9BIzdA7os2t0TXhCRjrQyCeOt6wVxr79CKD4c+p+YhCj31HBkYcXebw==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [openbsd]\n\n  '@esbuild/openbsd-x64@0.21.5':\n    resolution: {integrity: sha512-HLNNw99xsvx12lFBUwoT8EVCsSvRNDVxNpjZ7bPn947b8gJPzeHWyNVhFsaerc0n3TsbOINvRP2byTZ5LKezow==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [openbsd]\n\n  '@esbuild/openbsd-x64@0.25.12':\n    resolution: {integrity: sha512-MZyXUkZHjQxUvzK7rN8DJ3SRmrVrke8ZyRusHlP+kuwqTcfWLyqMOE3sScPPyeIXN/mDJIfGXvcMqCgYKekoQw==}\n    engines: {node: '>=18'}\n    cpu: [x64]\n    os: [openbsd]\n\n  '@esbuild/openharmony-arm64@0.25.12':\n    resolution: {integrity: sha512-rm0YWsqUSRrjncSXGA7Zv78Nbnw4XL6/dzr20cyrQf7ZmRcsovpcRBdhD43Nuk3y7XIoW2OxMVvwuRvk9XdASg==}\n    engines: {node: '>=18'}\n    cpu: [arm64]\n    os: [openharmony]\n\n  '@esbuild/sunos-x64@0.18.20':\n    resolution: {integrity: sha512-kDbFRFp0YpTQVVrqUd5FTYmWo45zGaXe0X8E1G/LKFC0v8x0vWrhOWSLITcCn63lmZIxfOMXtCfti/RxN/0wnQ==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [sunos]\n\n  '@esbuild/sunos-x64@0.19.12':\n    resolution: {integrity: sha512-HKjJwRrW8uWtCQnQOz9qcU3mUZhTUQvi56Q8DPTLLB+DawoiQdjsYq+j+D3s9I8VFtDr+F9CjgXKKC4ss89IeA==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [sunos]\n\n  '@esbuild/sunos-x64@0.21.5':\n    resolution: {integrity: sha512-6+gjmFpfy0BHU5Tpptkuh8+uw3mnrvgs+dSPQXQOv3ekbordwnzTVEb4qnIvQcYXq6gzkyTnoZ9dZG+D4garKg==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [sunos]\n\n  '@esbuild/sunos-x64@0.25.12':\n    resolution: {integrity: sha512-3wGSCDyuTHQUzt0nV7bocDy72r2lI33QL3gkDNGkod22EsYl04sMf0qLb8luNKTOmgF/eDEDP5BFNwoBKH441w==}\n    engines: {node: '>=18'}\n    cpu: [x64]\n    os: [sunos]\n\n  '@esbuild/win32-arm64@0.18.20':\n    resolution: {integrity: sha512-ddYFR6ItYgoaq4v4JmQQaAI5s7npztfV4Ag6NrhiaW0RrnOXqBkgwZLofVTlq1daVTQNhtI5oieTvkRPfZrePg==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [win32]\n\n  '@esbuild/win32-arm64@0.19.12':\n    resolution: {integrity: sha512-URgtR1dJnmGvX864pn1B2YUYNzjmXkuJOIqG2HdU62MVS4EHpU2946OZoTMnRUHklGtJdJZ33QfzdjGACXhn1A==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [win32]\n\n  '@esbuild/win32-arm64@0.21.5':\n    resolution: {integrity: sha512-Z0gOTd75VvXqyq7nsl93zwahcTROgqvuAcYDUr+vOv8uHhNSKROyU961kgtCD1e95IqPKSQKH7tBTslnS3tA8A==}\n    engines: {node: '>=12'}\n    cpu: [arm64]\n    os: [win32]\n\n  '@esbuild/win32-arm64@0.25.12':\n    resolution: {integrity: sha512-rMmLrur64A7+DKlnSuwqUdRKyd3UE7oPJZmnljqEptesKM8wx9J8gx5u0+9Pq0fQQW8vqeKebwNXdfOyP+8Bsg==}\n    engines: {node: '>=18'}\n    cpu: [arm64]\n    os: [win32]\n\n  '@esbuild/win32-ia32@0.18.20':\n    resolution: {integrity: sha512-Wv7QBi3ID/rROT08SABTS7eV4hX26sVduqDOTe1MvGMjNd3EjOz4b7zeexIR62GTIEKrfJXKL9LFxTYgkyeu7g==}\n    engines: {node: '>=12'}\n    cpu: [ia32]\n    os: [win32]\n\n  '@esbuild/win32-ia32@0.19.12':\n    resolution: {integrity: sha512-+ZOE6pUkMOJfmxmBZElNOx72NKpIa/HFOMGzu8fqzQJ5kgf6aTGrcJaFsNiVMH4JKpMipyK+7k0n2UXN7a8YKQ==}\n    engines: {node: '>=12'}\n    cpu: [ia32]\n    os: [win32]\n\n  '@esbuild/win32-ia32@0.21.5':\n    resolution: {integrity: sha512-SWXFF1CL2RVNMaVs+BBClwtfZSvDgtL//G/smwAc5oVK/UPu2Gu9tIaRgFmYFFKrmg3SyAjSrElf0TiJ1v8fYA==}\n    engines: {node: '>=12'}\n    cpu: [ia32]\n    os: [win32]\n\n  '@esbuild/win32-ia32@0.25.12':\n    resolution: {integrity: sha512-HkqnmmBoCbCwxUKKNPBixiWDGCpQGVsrQfJoVGYLPT41XWF8lHuE5N6WhVia2n4o5QK5M4tYr21827fNhi4byQ==}\n    engines: {node: '>=18'}\n    cpu: [ia32]\n    os: [win32]\n\n  '@esbuild/win32-x64@0.18.20':\n    resolution: {integrity: sha512-kTdfRcSiDfQca/y9QIkng02avJ+NCaQvrMejlsB3RRv5sE9rRoeBPISaZpKxHELzRxZyLvNts1P27W3wV+8geQ==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [win32]\n\n  '@esbuild/win32-x64@0.19.12':\n    resolution: {integrity: sha512-T1QyPSDCyMXaO3pzBkF96E8xMkiRYbUEZADd29SyPGabqxMViNoii+NcK7eWJAEoU6RZyEm5lVSIjTmcdoB9HA==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [win32]\n\n  '@esbuild/win32-x64@0.21.5':\n    resolution: {integrity: sha512-tQd/1efJuzPC6rCFwEvLtci/xNFcTZknmXs98FYDfGE4wP9ClFV98nyKrzJKVPMhdDnjzLhdUyMX4PsQAPjwIw==}\n    engines: {node: '>=12'}\n    cpu: [x64]\n    os: [win32]\n\n  '@esbuild/win32-x64@0.25.12':\n    resolution: {integrity: sha512-alJC0uCZpTFrSL0CCDjcgleBXPnCrEAhTBILpeAp7M/OFgoqtAetfBzX0xM00MUsVVPpVjlPuMbREqnZCXaTnA==}\n    engines: {node: '>=18'}\n    cpu: [x64]\n    os: [win32]\n\n  '@floating-ui/core@1.7.3':\n    resolution: {integrity: sha512-sGnvb5dmrJaKEZ+LDIpguvdX3bDlEllmv4/ClQ9awcmCZrlx5jQyyMWFM5kBI+EyNOCDDiKk8il0zeuX3Zlg/w==}\n\n  '@floating-ui/dom@1.7.4':\n    resolution: {integrity: sha512-OOchDgh4F2CchOX94cRVqhvy7b3AFb+/rQXyswmzmGakRfkMgoWVjfnLWkRirfLEfuD4ysVW16eXzwt3jHIzKA==}\n\n  '@floating-ui/react-dom@2.1.6':\n    resolution: {integrity: sha512-4JX6rEatQEvlmgU80wZyq9RT96HZJa88q8hp0pBd+LrczeDI4o6uA2M+uvxngVHo4Ihr8uibXxH6+70zhAFrVw==}\n    peerDependencies:\n      react: '>=16.8.0'\n      react-dom: '>=16.8.0'\n\n  '@floating-ui/utils@0.2.10':\n    resolution: {integrity: sha512-aGTxbpbg8/b5JfU1HXSrbH3wXZuLPJcNEcZQFMxLs3oSzgtVu6nFPkbbGGUvBcUjKV2YyB9Wxxabo+HEH9tcRQ==}\n\n  '@hookform/resolvers@3.10.0':\n    resolution: {integrity: sha512-79Dv+3mDF7i+2ajj7SkypSKHhl1cbln1OGavqrsF7p6mbUv11xpqpacPsGDCTRvCSjEEIez2ef1NveSVL3b0Ag==}\n    peerDependencies:\n      react-hook-form: ^7.0.0\n\n  '@isaacs/cliui@8.0.2':\n    resolution: {integrity: sha512-O8jcjabXaleOG9DQ0+ARXWZBTfnP4WNAqzuiJK7ll44AmxGKv/J2M4TPjxjY3znBCfvBXFzucm1twdyFybFqEA==}\n    engines: {node: '>=12'}\n\n  '@jridgewell/gen-mapping@0.3.13':\n    resolution: {integrity: sha512-2kkt/7niJ6MgEPxF0bYdQ6etZaA+fQvDcLKckhy1yIQOzaoKjBBjSj63/aLVjYE3qhRt5dvM+uUyfCg6UKCBbA==}\n\n  '@jridgewell/remapping@2.3.5':\n    resolution: {integrity: sha512-LI9u/+laYG4Ds1TDKSJW2YPrIlcVYOwi2fUC6xB43lueCjgxV4lffOCZCtYFiH6TNOX+tQKXx97T4IKHbhyHEQ==}\n\n  '@jridgewell/resolve-uri@3.1.2':\n    resolution: {integrity: sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==}\n    engines: {node: '>=6.0.0'}\n\n  '@jridgewell/sourcemap-codec@1.5.5':\n    resolution: {integrity: sha512-cYQ9310grqxueWbl+WuIUIaiUaDcj7WOq5fVhEljNVgRfOUhY9fy2zTvfoqWsnebh8Sl70VScFbICvJnLKB0Og==}\n\n  '@jridgewell/trace-mapping@0.3.31':\n    resolution: {integrity: sha512-zzNR+SdQSDJzc8joaeP8QQoCQr8NuYx2dIIytl1QeBEZHJ9uW6hebsrYgbz8hJwUQao3TWCMtmfV8Nu1twOLAw==}\n\n  '@jridgewell/trace-mapping@0.3.9':\n    resolution: {integrity: sha512-3Belt6tdc8bPgAtbcmdtNJlirVoTmEb5e2gC94PnkwEW9jI6CAHUeoG85tjWP5WquqfavoMtMwiG4P926ZKKuQ==}\n\n  '@neondatabase/serverless@0.10.4':\n    resolution: {integrity: sha512-2nZuh3VUO9voBauuh+IGYRhGU/MskWHt1IuZvHcJw6GLjDgtqj/KViKo7SIrLdGLdot7vFbiRRw+BgEy3wT9HA==}\n\n  '@nodelib/fs.scandir@2.1.5':\n    resolution: {integrity: sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g==}\n    engines: {node: '>= 8'}\n\n  '@nodelib/fs.stat@2.0.5':\n    resolution: {integrity: sha512-RkhPPp2zrqDAQA/2jNhnztcPAlv64XdhIp7a7454A5ovI7Bukxgt7MX7udwAu3zg1DcpPU0rz3VV1SeaqvY4+A==}\n    engines: {node: '>= 8'}\n\n  '@nodelib/fs.walk@1.2.8':\n    resolution: {integrity: sha512-oGB+UxlgWcgQkgwo8GcEGwemoTFt3FIO9ababBmaGwXIoBKZ+GTy0pP185beGg7Llih/NSHSV2XAs1lnznocSg==}\n    engines: {node: '>= 8'}\n\n  '@petamoriken/float16@3.9.3':\n    resolution: {integrity: sha512-8awtpHXCx/bNpFt4mt2xdkgtgVvKqty8VbjHI/WWWQuEw+KLzFot3f4+LkQY9YmOtq7A5GdOnqoIC8Pdygjk2g==}\n\n  '@pkgjs/parseargs@0.11.0':\n    resolution: {integrity: sha512-+1VkjdD0QBLPodGrJUeqarH8VAIvQODIbwh9XpP5Syisf7YoQgsJKPNFoqqLQlu+VQ/tVSshMR6loPMn8U+dPg==}\n    engines: {node: '>=14'}\n\n  '@radix-ui/number@1.1.1':\n    resolution: {integrity: sha512-MkKCwxlXTgz6CFoJx3pCwn07GKp36+aZyu/u2Ln2VrA5DcdyCZkASEDBTd8x5whTQQL5CiYf4prXKLcgQdv29g==}\n\n  '@radix-ui/primitive@1.1.3':\n    resolution: {integrity: sha512-JTF99U/6XIjCBo0wqkU5sK10glYe27MRRsfwoiq5zzOEZLHU3A3KCMa5X/azekYRCJ0HlwI0crAXS/5dEHTzDg==}\n\n  '@radix-ui/react-accordion@1.2.12':\n    resolution: {integrity: sha512-T4nygeh9YE9dLRPhAHSeOZi7HBXo+0kYIPJXayZfvWOWA0+n3dESrZbjfDPUABkUNym6Hd+f2IR113To8D2GPA==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-alert-dialog@1.1.15':\n    resolution: {integrity: sha512-oTVLkEw5GpdRe29BqJ0LSDFWI3qu0vR1M0mUkOQWDIUnY/QIkLpgDMWuKxP94c2NAC2LGcgVhG1ImF3jkZ5wXw==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-arrow@1.1.7':\n    resolution: {integrity: sha512-F+M1tLhO+mlQaOWspE8Wstg+z6PwxwRd8oQ8IXceWz92kfAmalTRf0EjrouQeo7QssEPfCn05B4Ihs1K9WQ/7w==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-aspect-ratio@1.1.8':\n    resolution: {integrity: sha512-5nZrJTF7gH+e0nZS7/QxFz6tJV4VimhQb1avEgtsJxvvIp5JilL+c58HICsKzPxghdwaDt48hEfPM1au4zGy+w==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-avatar@1.1.11':\n    resolution: {integrity: sha512-0Qk603AHGV28BOBO34p7IgD5m+V5Sg/YovfayABkoDDBM5d3NCx0Mp4gGrjzLGes1jV5eNOE1r3itqOR33VC6Q==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-checkbox@1.3.3':\n    resolution: {integrity: sha512-wBbpv+NQftHDdG86Qc0pIyXk5IR3tM8Vd0nWLKDcX8nNn4nXFOFwsKuqw2okA/1D/mpaAkmuyndrPJTYDNZtFw==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-collapsible@1.1.12':\n    resolution: {integrity: sha512-Uu+mSh4agx2ib1uIGPP4/CKNULyajb3p92LsVXmH2EHVMTfZWpll88XJ0j4W0z3f8NK1eYl1+Mf/szHPmcHzyA==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-collection@1.1.7':\n    resolution: {integrity: sha512-Fh9rGN0MoI4ZFUNyfFVNU4y9LUz93u9/0K+yLgA2bwRojxM8JU1DyvvMBabnZPBgMWREAJvU2jjVzq+LrFUglw==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-compose-refs@1.1.2':\n    resolution: {integrity: sha512-z4eqJvfiNnFMHIIvXP3CY57y2WJs5g2v3X0zm9mEJkrkNv4rDxu+sg9Jh8EkXyeqBkB7SOcboo9dMVqhyrACIg==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-context-menu@2.2.16':\n    resolution: {integrity: sha512-O8morBEW+HsVG28gYDZPTrT9UUovQUlJue5YO836tiTJhuIWBm/zQHc7j388sHWtdH/xUZurK9olD2+pcqx5ww==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-context@1.1.2':\n    resolution: {integrity: sha512-jCi/QKUM2r1Ju5a3J64TH2A5SpKAgh0LpknyqdQ4m6DCV0xJ2HG1xARRwNGPQfi1SLdLWZ1OJz6F4OMBBNiGJA==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-context@1.1.3':\n    resolution: {integrity: sha512-ieIFACdMpYfMEjF0rEf5KLvfVyIkOz6PDGyNnP+u+4xQ6jny3VCgA4OgXOwNx2aUkxn8zx9fiVcM8CfFYv9Lxw==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-dialog@1.1.15':\n    resolution: {integrity: sha512-TCglVRtzlffRNxRMEyR36DGBLJpeusFcgMVD9PZEzAKnUs1lKCgX5u9BmC2Yg+LL9MgZDugFFs1Vl+Jp4t/PGw==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-direction@1.1.1':\n    resolution: {integrity: sha512-1UEWRX6jnOA2y4H5WczZ44gOOjTEmlqv1uNW4GAJEO5+bauCBhv8snY65Iw5/VOS/ghKN9gr2KjnLKxrsvoMVw==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-dismissable-layer@1.1.11':\n    resolution: {integrity: sha512-Nqcp+t5cTB8BinFkZgXiMJniQH0PsUt2k51FUhbdfeKvc4ACcG2uQniY/8+h1Yv6Kza4Q7lD7PQV0z0oicE0Mg==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-dropdown-menu@2.1.16':\n    resolution: {integrity: sha512-1PLGQEynI/3OX/ftV54COn+3Sud/Mn8vALg2rWnBLnRaGtJDduNW/22XjlGgPdpcIbiQxjKtb7BkcjP00nqfJw==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-focus-guards@1.1.3':\n    resolution: {integrity: sha512-0rFg/Rj2Q62NCm62jZw0QX7a3sz6QCQU0LpZdNrJX8byRGaGVTqbrW9jAoIAHyMQqsNpeZ81YgSizOt5WXq0Pw==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-focus-scope@1.1.7':\n    resolution: {integrity: sha512-t2ODlkXBQyn7jkl6TNaw/MtVEVvIGelJDCG41Okq/KwUsJBwQ4XVZsHAVUkK4mBv3ewiAS3PGuUWuY2BoK4ZUw==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-hover-card@1.1.15':\n    resolution: {integrity: sha512-qgTkjNT1CfKMoP0rcasmlH2r1DAiYicWsDsufxl940sT2wHNEWWv6FMWIQXWhVdmC1d/HYfbhQx60KYyAtKxjg==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-id@1.1.1':\n    resolution: {integrity: sha512-kGkGegYIdQsOb4XjsfM97rXsiHaBwco+hFI66oO4s9LU+PLAC5oJ7khdOVFxkhsmlbpUqDAvXw11CluXP+jkHg==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-label@2.1.8':\n    resolution: {integrity: sha512-FmXs37I6hSBVDlO4y764TNz1rLgKwjJMQ0EGte6F3Cb3f4bIuHB/iLa/8I9VKkmOy+gNHq8rql3j686ACVV21A==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-menu@2.1.16':\n    resolution: {integrity: sha512-72F2T+PLlphrqLcAotYPp0uJMr5SjP5SL01wfEspJbru5Zs5vQaSHb4VB3ZMJPimgHHCHG7gMOeOB9H3Hdmtxg==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-menubar@1.1.16':\n    resolution: {integrity: sha512-EB1FktTz5xRRi2Er974AUQZWg2yVBb1yjip38/lgwtCVRd3a+maUoGHN/xs9Yv8SY8QwbSEb+YrxGadVWbEutA==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-navigation-menu@1.2.14':\n    resolution: {integrity: sha512-YB9mTFQvCOAQMHU+C/jVl96WmuWeltyUEpRJJky51huhds5W2FQr1J8D/16sQlf0ozxkPK8uF3niQMdUwZPv5w==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-popover@1.1.15':\n    resolution: {integrity: sha512-kr0X2+6Yy/vJzLYJUPCZEc8SfQcf+1COFoAqauJm74umQhta9M7lNJHP7QQS3vkvcGLQUbWpMzwrXYwrYztHKA==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-popper@1.2.8':\n    resolution: {integrity: sha512-0NJQ4LFFUuWkE7Oxf0htBKS6zLkkjBH+hM1uk7Ng705ReR8m/uelduy1DBo0PyBXPKVnBA6YBlU94MBGXrSBCw==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-portal@1.1.9':\n    resolution: {integrity: sha512-bpIxvq03if6UNwXZ+HTK71JLh4APvnXntDc6XOX8UVq4XQOVl7lwok0AvIl+b8zgCw3fSaVTZMpAPPagXbKmHQ==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-presence@1.1.5':\n    resolution: {integrity: sha512-/jfEwNDdQVBCNvjkGit4h6pMOzq8bHkopq458dPt2lMjx+eBQUohZNG9A7DtO/O5ukSbxuaNGXMjHicgwy6rQQ==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-primitive@2.1.3':\n    resolution: {integrity: sha512-m9gTwRkhy2lvCPe6QJp4d3G1TYEUHn/FzJUtq9MjH46an1wJU+GdoGC5VLof8RX8Ft/DlpshApkhswDLZzHIcQ==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-primitive@2.1.4':\n    resolution: {integrity: sha512-9hQc4+GNVtJAIEPEqlYqW5RiYdrr8ea5XQ0ZOnD6fgru+83kqT15mq2OCcbe8KnjRZl5vF3ks69AKz3kh1jrhg==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-progress@1.1.8':\n    resolution: {integrity: sha512-+gISHcSPUJ7ktBy9RnTqbdKW78bcGke3t6taawyZ71pio1JewwGSJizycs7rLhGTvMJYCQB1DBK4KQsxs7U8dA==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-radio-group@1.3.8':\n    resolution: {integrity: sha512-VBKYIYImA5zsxACdisNQ3BjCBfmbGH3kQlnFVqlWU4tXwjy7cGX8ta80BcrO+WJXIn5iBylEH3K6ZTlee//lgQ==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-roving-focus@1.1.11':\n    resolution: {integrity: sha512-7A6S9jSgm/S+7MdtNDSb+IU859vQqJ/QAtcYQcfFC6W8RS4IxIZDldLR0xqCFZ6DCyrQLjLPsxtTNch5jVA4lA==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-scroll-area@1.2.10':\n    resolution: {integrity: sha512-tAXIa1g3sM5CGpVT0uIbUx/U3Gs5N8T52IICuCtObaos1S8fzsrPXG5WObkQN3S6NVl6wKgPhAIiBGbWnvc97A==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-select@2.2.6':\n    resolution: {integrity: sha512-I30RydO+bnn2PQztvo25tswPH+wFBjehVGtmagkU78yMdwTwVf12wnAOF+AeP8S2N8xD+5UPbGhkUfPyvT+mwQ==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-separator@1.1.8':\n    resolution: {integrity: sha512-sDvqVY4itsKwwSMEe0jtKgfTh+72Sy3gPmQpjqcQneqQ4PFmr/1I0YA+2/puilhggCe2gJcx5EBAYFkWkdpa5g==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-slider@1.3.6':\n    resolution: {integrity: sha512-JPYb1GuM1bxfjMRlNLE+BcmBC8onfCi60Blk7OBqi2MLTFdS+8401U4uFjnwkOr49BLmXxLC6JHkvAsx5OJvHw==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-slot@1.2.3':\n    resolution: {integrity: sha512-aeNmHnBxbi2St0au6VBVC7JXFlhLlOnvIIlePNniyUNAClzmtAUEY8/pBiK3iHjufOlwA+c20/8jngo7xcrg8A==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-slot@1.2.4':\n    resolution: {integrity: sha512-Jl+bCv8HxKnlTLVrcDE8zTMJ09R9/ukw4qBs/oZClOfoQk/cOTbDn+NceXfV7j09YPVQUryJPHurafcSg6EVKA==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-switch@1.2.6':\n    resolution: {integrity: sha512-bByzr1+ep1zk4VubeEVViV592vu2lHE2BZY5OnzehZqOOgogN80+mNtCqPkhn2gklJqOpxWgPoYTSnhBCqpOXQ==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-tabs@1.1.13':\n    resolution: {integrity: sha512-7xdcatg7/U+7+Udyoj2zodtI9H/IIopqo+YOIcZOq1nJwXWBZ9p8xiu5llXlekDbZkca79a/fozEYQXIA4sW6A==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-toast@1.2.15':\n    resolution: {integrity: sha512-3OSz3TacUWy4WtOXV38DggwxoqJK4+eDkNMl5Z/MJZaoUPaP4/9lf81xXMe1I2ReTAptverZUpbPY4wWwWyL5g==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-toggle-group@1.1.11':\n    resolution: {integrity: sha512-5umnS0T8JQzQT6HbPyO7Hh9dgd82NmS36DQr+X/YJ9ctFNCiiQd6IJAYYZ33LUwm8M+taCz5t2ui29fHZc4Y6Q==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-toggle@1.1.10':\n    resolution: {integrity: sha512-lS1odchhFTeZv3xwHH31YPObmJn8gOg7Lq12inrr0+BH/l3Tsq32VfjqH1oh80ARM3mlkfMic15n0kg4sD1poQ==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-tooltip@1.2.8':\n    resolution: {integrity: sha512-tY7sVt1yL9ozIxvmbtN5qtmH2krXcBCfjEiCgKGLqunJHvgvZG2Pcl2oQ3kbcZARb1BGEHdkLzcYGO8ynVlieg==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/react-use-callback-ref@1.1.1':\n    resolution: {integrity: sha512-FkBMwD+qbGQeMu1cOHnuGB6x4yzPjho8ap5WtbEJ26umhgqVXbhekKUQO+hZEL1vU92a3wHwdp0HAcqAUF5iDg==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-use-controllable-state@1.2.2':\n    resolution: {integrity: sha512-BjasUjixPFdS+NKkypcyyN5Pmg83Olst0+c6vGov0diwTEo6mgdqVR6hxcEgFuh4QrAs7Rc+9KuGJ9TVCj0Zzg==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-use-effect-event@0.0.2':\n    resolution: {integrity: sha512-Qp8WbZOBe+blgpuUT+lw2xheLP8q0oatc9UpmiemEICxGvFLYmHm9QowVZGHtJlGbS6A6yJ3iViad/2cVjnOiA==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-use-escape-keydown@1.1.1':\n    resolution: {integrity: sha512-Il0+boE7w/XebUHyBjroE+DbByORGR9KKmITzbR7MyQ4akpORYP/ZmbhAr0DG7RmmBqoOnZdy2QlvajJ2QA59g==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-use-is-hydrated@0.1.0':\n    resolution: {integrity: sha512-U+UORVEq+cTnRIaostJv9AGdV3G6Y+zbVd+12e18jQ5A3c0xL03IhnHuiU4UV69wolOQp5GfR58NW/EgdQhwOA==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-use-layout-effect@1.1.1':\n    resolution: {integrity: sha512-RbJRS4UWQFkzHTTwVymMTUv8EqYhOp8dOOviLj2ugtTiXRaRQS7GLGxZTLL1jWhMeoSCf5zmcZkqTl9IiYfXcQ==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-use-previous@1.1.1':\n    resolution: {integrity: sha512-2dHfToCj/pzca2Ck724OZ5L0EVrr3eHRNsG/b3xQJLA2hZpVCS99bLAX+hm1IHXDEnzU6by5z/5MIY794/a8NQ==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-use-rect@1.1.1':\n    resolution: {integrity: sha512-QTYuDesS0VtuHNNvMh+CjlKJ4LJickCMUAqjlE3+j8w+RlRpwyX3apEQKGFzbZGdo7XNG1tXa+bQqIE7HIXT2w==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-use-size@1.1.1':\n    resolution: {integrity: sha512-ewrXRDTAqAXlkl6t/fkXWNAhFX9I+CkKlw6zjEwk86RSPKwZr3xpBRso655aqYafwtnbpHLj6toFzmd6xdVptQ==}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  '@radix-ui/react-visually-hidden@1.2.3':\n    resolution: {integrity: sha512-pzJq12tEaaIhqjbzpCuv/OypJY/BPavOofm+dbab+MHLajy277+1lLm6JFcGgF5eskJ6mquGirhXY2GD/8u8Ug==}\n    peerDependencies:\n      '@types/react': '*'\n      '@types/react-dom': '*'\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n      '@types/react-dom':\n        optional: true\n\n  '@radix-ui/rect@1.1.1':\n    resolution: {integrity: sha512-HPwpGIzkl28mWyZqG52jiqDJ12waP11Pa1lGoiyUkIEuMLBP0oeK/C89esbXrxsky5we7dfd8U58nm0SgAWpVw==}\n\n  '@replit/vite-plugin-cartographer@0.2.8':\n    resolution: {integrity: sha512-eNr3OAhJFv5b6tbDZ0Bc7DR4O0jxBN17LtBhHagf6FWdpOStNw8Pxsnd8pood7veHRDFbMB9+nsKsWKcB/j1xw==}\n\n  '@replit/vite-plugin-runtime-error-modal@0.0.3':\n    resolution: {integrity: sha512-4wZHGuI9W4o9p8g4Ma/qj++7SP015+FMDGYobj7iap5oEsxXMm0B02TO5Y5PW8eqBPd4wX5l3UGco/hlC0qapw==}\n\n  '@rolldown/pluginutils@1.0.0-beta.27':\n    resolution: {integrity: sha512-+d0F4MKMCbeVUJwG96uQ4SgAznZNSq93I3V+9NHA4OpvqG8mRCpGdKmK8l/dl02h2CCDHwW2FqilnTyDcAnqjA==}\n\n  '@rollup/rollup-android-arm-eabi@4.53.3':\n    resolution: {integrity: sha512-mRSi+4cBjrRLoaal2PnqH82Wqyb+d3HsPUN/W+WslCXsZsyHa9ZeQQX/pQsZaVIWDkPcpV6jJ+3KLbTbgnwv8w==}\n    cpu: [arm]\n    os: [android]\n\n  '@rollup/rollup-android-arm64@4.53.3':\n    resolution: {integrity: sha512-CbDGaMpdE9sh7sCmTrTUyllhrg65t6SwhjlMJsLr+J8YjFuPmCEjbBSx4Z/e4SmDyH3aB5hGaJUP2ltV/vcs4w==}\n    cpu: [arm64]\n    os: [android]\n\n  '@rollup/rollup-darwin-arm64@4.53.3':\n    resolution: {integrity: sha512-Nr7SlQeqIBpOV6BHHGZgYBuSdanCXuw09hon14MGOLGmXAFYjx1wNvquVPmpZnl0tLjg25dEdr4IQ6GgyToCUA==}\n    cpu: [arm64]\n    os: [darwin]\n\n  '@rollup/rollup-darwin-x64@4.53.3':\n    resolution: {integrity: sha512-DZ8N4CSNfl965CmPktJ8oBnfYr3F8dTTNBQkRlffnUarJ2ohudQD17sZBa097J8xhQ26AwhHJ5mvUyQW8ddTsQ==}\n    cpu: [x64]\n    os: [darwin]\n\n  '@rollup/rollup-freebsd-arm64@4.53.3':\n    resolution: {integrity: sha512-yMTrCrK92aGyi7GuDNtGn2sNW+Gdb4vErx4t3Gv/Tr+1zRb8ax4z8GWVRfr3Jw8zJWvpGHNpss3vVlbF58DZ4w==}\n    cpu: [arm64]\n    os: [freebsd]\n\n  '@rollup/rollup-freebsd-x64@4.53.3':\n    resolution: {integrity: sha512-lMfF8X7QhdQzseM6XaX0vbno2m3hlyZFhwcndRMw8fbAGUGL3WFMBdK0hbUBIUYcEcMhVLr1SIamDeuLBnXS+Q==}\n    cpu: [x64]\n    os: [freebsd]\n\n  '@rollup/rollup-linux-arm-gnueabihf@4.53.3':\n    resolution: {integrity: sha512-k9oD15soC/Ln6d2Wv/JOFPzZXIAIFLp6B+i14KhxAfnq76ajt0EhYc5YPeX6W1xJkAdItcVT+JhKl1QZh44/qw==}\n    cpu: [arm]\n    os: [linux]\n\n  '@rollup/rollup-linux-arm-musleabihf@4.53.3':\n    resolution: {integrity: sha512-vTNlKq+N6CK/8UktsrFuc+/7NlEYVxgaEgRXVUVK258Z5ymho29skzW1sutgYjqNnquGwVUObAaxae8rZ6YMhg==}\n    cpu: [arm]\n    os: [linux]\n\n  '@rollup/rollup-linux-arm64-gnu@4.53.3':\n    resolution: {integrity: sha512-RGrFLWgMhSxRs/EWJMIFM1O5Mzuz3Xy3/mnxJp/5cVhZ2XoCAxJnmNsEyeMJtpK+wu0FJFWz+QF4mjCA7AUQ3w==}\n    cpu: [arm64]\n    os: [linux]\n\n  '@rollup/rollup-linux-arm64-musl@4.53.3':\n    resolution: {integrity: sha512-kASyvfBEWYPEwe0Qv4nfu6pNkITLTb32p4yTgzFCocHnJLAHs+9LjUu9ONIhvfT/5lv4YS5muBHyuV84epBo/A==}\n    cpu: [arm64]\n    os: [linux]\n\n  '@rollup/rollup-linux-loong64-gnu@4.53.3':\n    resolution: {integrity: sha512-JiuKcp2teLJwQ7vkJ95EwESWkNRFJD7TQgYmCnrPtlu50b4XvT5MOmurWNrCj3IFdyjBQ5p9vnrX4JM6I8OE7g==}\n    cpu: [loong64]\n    os: [linux]\n\n  '@rollup/rollup-linux-ppc64-gnu@4.53.3':\n    resolution: {integrity: sha512-EoGSa8nd6d3T7zLuqdojxC20oBfNT8nexBbB/rkxgKj5T5vhpAQKKnD+h3UkoMuTyXkP5jTjK/ccNRmQrPNDuw==}\n    cpu: [ppc64]\n    os: [linux]\n\n  '@rollup/rollup-linux-riscv64-gnu@4.53.3':\n    resolution: {integrity: sha512-4s+Wped2IHXHPnAEbIB0YWBv7SDohqxobiiPA1FIWZpX+w9o2i4LezzH/NkFUl8LRci/8udci6cLq+jJQlh+0g==}\n    cpu: [riscv64]\n    os: [linux]\n\n  '@rollup/rollup-linux-riscv64-musl@4.53.3':\n    resolution: {integrity: sha512-68k2g7+0vs2u9CxDt5ktXTngsxOQkSEV/xBbwlqYcUrAVh6P9EgMZvFsnHy4SEiUl46Xf0IObWVbMvPrr2gw8A==}\n    cpu: [riscv64]\n    os: [linux]\n\n  '@rollup/rollup-linux-s390x-gnu@4.53.3':\n    resolution: {integrity: sha512-VYsFMpULAz87ZW6BVYw3I6sWesGpsP9OPcyKe8ofdg9LHxSbRMd7zrVrr5xi/3kMZtpWL/wC+UIJWJYVX5uTKg==}\n    cpu: [s390x]\n    os: [linux]\n\n  '@rollup/rollup-linux-x64-gnu@4.53.3':\n    resolution: {integrity: sha512-3EhFi1FU6YL8HTUJZ51imGJWEX//ajQPfqWLI3BQq4TlvHy4X0MOr5q3D2Zof/ka0d5FNdPwZXm3Yyib/UEd+w==}\n    cpu: [x64]\n    os: [linux]\n\n  '@rollup/rollup-linux-x64-musl@4.53.3':\n    resolution: {integrity: sha512-eoROhjcc6HbZCJr+tvVT8X4fW3/5g/WkGvvmwz/88sDtSJzO7r/blvoBDgISDiCjDRZmHpwud7h+6Q9JxFwq1Q==}\n    cpu: [x64]\n    os: [linux]\n\n  '@rollup/rollup-openharmony-arm64@4.53.3':\n    resolution: {integrity: sha512-OueLAWgrNSPGAdUdIjSWXw+u/02BRTcnfw9PN41D2vq/JSEPnJnVuBgw18VkN8wcd4fjUs+jFHVM4t9+kBSNLw==}\n    cpu: [arm64]\n    os: [openharmony]\n\n  '@rollup/rollup-win32-arm64-msvc@4.53.3':\n    resolution: {integrity: sha512-GOFuKpsxR/whszbF/bzydebLiXIHSgsEUp6M0JI8dWvi+fFa1TD6YQa4aSZHtpmh2/uAlj/Dy+nmby3TJ3pkTw==}\n    cpu: [arm64]\n    os: [win32]\n\n  '@rollup/rollup-win32-ia32-msvc@4.53.3':\n    resolution: {integrity: sha512-iah+THLcBJdpfZ1TstDFbKNznlzoxa8fmnFYK4V67HvmuNYkVdAywJSoteUszvBQ9/HqN2+9AZghbajMsFT+oA==}\n    cpu: [ia32]\n    os: [win32]\n\n  '@rollup/rollup-win32-x64-gnu@4.53.3':\n    resolution: {integrity: sha512-J9QDiOIZlZLdcot5NXEepDkstocktoVjkaKUtqzgzpt2yWjGlbYiKyp05rWwk4nypbYUNoFAztEgixoLaSETkg==}\n    cpu: [x64]\n    os: [win32]\n\n  '@rollup/rollup-win32-x64-msvc@4.53.3':\n    resolution: {integrity: sha512-UhTd8u31dXadv0MopwGgNOBpUVROFKWVQgAg5N1ESyCz8AuBcMqm4AuTjrwgQKGDfoFuz02EuMRHQIw/frmYKQ==}\n    cpu: [x64]\n    os: [win32]\n\n  '@tailwindcss/node@4.1.17':\n    resolution: {integrity: sha512-csIkHIgLb3JisEFQ0vxr2Y57GUNYh447C8xzwj89U/8fdW8LhProdxvnVH6U8M2Y73QKiTIH+LWbK3V2BBZsAg==}\n\n  '@tailwindcss/oxide-android-arm64@4.1.17':\n    resolution: {integrity: sha512-BMqpkJHgOZ5z78qqiGE6ZIRExyaHyuxjgrJ6eBO5+hfrfGkuya0lYfw8fRHG77gdTjWkNWEEm+qeG2cDMxArLQ==}\n    engines: {node: '>= 10'}\n    cpu: [arm64]\n    os: [android]\n\n  '@tailwindcss/oxide-darwin-arm64@4.1.17':\n    resolution: {integrity: sha512-EquyumkQweUBNk1zGEU/wfZo2qkp/nQKRZM8bUYO0J+Lums5+wl2CcG1f9BgAjn/u9pJzdYddHWBiFXJTcxmOg==}\n    engines: {node: '>= 10'}\n    cpu: [arm64]\n    os: [darwin]\n\n  '@tailwindcss/oxide-darwin-x64@4.1.17':\n    resolution: {integrity: sha512-gdhEPLzke2Pog8s12oADwYu0IAw04Y2tlmgVzIN0+046ytcgx8uZmCzEg4VcQh+AHKiS7xaL8kGo/QTiNEGRog==}\n    engines: {node: '>= 10'}\n    cpu: [x64]\n    os: [darwin]\n\n  '@tailwindcss/oxide-freebsd-x64@4.1.17':\n    resolution: {integrity: sha512-hxGS81KskMxML9DXsaXT1H0DyA+ZBIbyG/sSAjWNe2EDl7TkPOBI42GBV3u38itzGUOmFfCzk1iAjDXds8Oh0g==}\n    engines: {node: '>= 10'}\n    cpu: [x64]\n    os: [freebsd]\n\n  '@tailwindcss/oxide-linux-arm-gnueabihf@4.1.17':\n    resolution: {integrity: sha512-k7jWk5E3ldAdw0cNglhjSgv501u7yrMf8oeZ0cElhxU6Y2o7f8yqelOp3fhf7evjIS6ujTI3U8pKUXV2I4iXHQ==}\n    engines: {node: '>= 10'}\n    cpu: [arm]\n    os: [linux]\n\n  '@tailwindcss/oxide-linux-arm64-gnu@4.1.17':\n    resolution: {integrity: sha512-HVDOm/mxK6+TbARwdW17WrgDYEGzmoYayrCgmLEw7FxTPLcp/glBisuyWkFz/jb7ZfiAXAXUACfyItn+nTgsdQ==}\n    engines: {node: '>= 10'}\n    cpu: [arm64]\n    os: [linux]\n\n  '@tailwindcss/oxide-linux-arm64-musl@4.1.17':\n    resolution: {integrity: sha512-HvZLfGr42i5anKtIeQzxdkw/wPqIbpeZqe7vd3V9vI3RQxe3xU1fLjss0TjyhxWcBaipk7NYwSrwTwK1hJARMg==}\n    engines: {node: '>= 10'}\n    cpu: [arm64]\n    os: [linux]\n\n  '@tailwindcss/oxide-linux-x64-gnu@4.1.17':\n    resolution: {integrity: sha512-M3XZuORCGB7VPOEDH+nzpJ21XPvK5PyjlkSFkFziNHGLc5d6g3di2McAAblmaSUNl8IOmzYwLx9NsE7bplNkwQ==}\n    engines: {node: '>= 10'}\n    cpu: [x64]\n    os: [linux]\n\n  '@tailwindcss/oxide-linux-x64-musl@4.1.17':\n    resolution: {integrity: sha512-k7f+pf9eXLEey4pBlw+8dgfJHY4PZ5qOUFDyNf7SI6lHjQ9Zt7+NcscjpwdCEbYi6FI5c2KDTDWyf2iHcCSyyQ==}\n    engines: {node: '>= 10'}\n    cpu: [x64]\n    os: [linux]\n\n  '@tailwindcss/oxide-wasm32-wasi@4.1.17':\n    resolution: {integrity: sha512-cEytGqSSoy7zK4JRWiTCx43FsKP/zGr0CsuMawhH67ONlH+T79VteQeJQRO/X7L0juEUA8ZyuYikcRBf0vsxhg==}\n    engines: {node: '>=14.0.0'}\n    cpu: [wasm32]\n    bundledDependencies:\n      - '@napi-rs/wasm-runtime'\n      - '@emnapi/core'\n      - '@emnapi/runtime'\n      - '@tybys/wasm-util'\n      - '@emnapi/wasi-threads'\n      - tslib\n\n  '@tailwindcss/oxide-win32-arm64-msvc@4.1.17':\n    resolution: {integrity: sha512-JU5AHr7gKbZlOGvMdb4722/0aYbU+tN6lv1kONx0JK2cGsh7g148zVWLM0IKR3NeKLv+L90chBVYcJ8uJWbC9A==}\n    engines: {node: '>= 10'}\n    cpu: [arm64]\n    os: [win32]\n\n  '@tailwindcss/oxide-win32-x64-msvc@4.1.17':\n    resolution: {integrity: sha512-SKWM4waLuqx0IH+FMDUw6R66Hu4OuTALFgnleKbqhgGU30DY20NORZMZUKgLRjQXNN2TLzKvh48QXTig4h4bGw==}\n    engines: {node: '>= 10'}\n    cpu: [x64]\n    os: [win32]\n\n  '@tailwindcss/oxide@4.1.17':\n    resolution: {integrity: sha512-F0F7d01fmkQhsTjXezGBLdrl1KresJTcI3DB8EkScCldyKp3Msz4hub4uyYaVnk88BAS1g5DQjjF6F5qczheLA==}\n    engines: {node: '>= 10'}\n\n  '@tailwindcss/typography@0.5.19':\n    resolution: {integrity: sha512-w31dd8HOx3k9vPtcQh5QHP9GwKcgbMp87j58qi6xgiBnFFtKEAgCWnDw4qUT8aHwkCp8bKvb/KGKWWHedP0AAg==}\n    peerDependencies:\n      tailwindcss: '>=3.0.0 || insiders || >=4.0.0-alpha.20 || >=4.0.0-beta.1'\n\n  '@tailwindcss/vite@4.1.17':\n    resolution: {integrity: sha512-4+9w8ZHOiGnpcGI6z1TVVfWaX/koK7fKeSYF3qlYg2xpBtbteP2ddBxiarL+HVgfSJGeK5RIxRQmKm4rTJJAwA==}\n    peerDependencies:\n      vite: ^5.2.0 || ^6 || ^7\n\n  '@tanstack/query-core@5.90.10':\n    resolution: {integrity: sha512-EhZVFu9rl7GfRNuJLJ3Y7wtbTnENsvzp+YpcAV7kCYiXni1v8qZh++lpw4ch4rrwC0u/EZRnBHIehzCGzwXDSQ==}\n\n  '@tanstack/query-devtools@5.90.1':\n    resolution: {integrity: sha512-GtINOPjPUH0OegJExZ70UahT9ykmAhmtNVcmtdnOZbxLwT7R5OmRztR5Ahe3/Cu7LArEmR6/588tAycuaWb1xQ==}\n\n  '@tanstack/react-query-devtools@5.90.2':\n    resolution: {integrity: sha512-vAXJzZuBXtCQtrY3F/yUNJCV4obT/A/n81kb3+YqLbro5Z2+phdAbceO+deU3ywPw8B42oyJlp4FhO0SoivDFQ==}\n    peerDependencies:\n      '@tanstack/react-query': ^5.90.2\n      react: ^18 || ^19\n\n  '@tanstack/react-query@5.90.10':\n    resolution: {integrity: sha512-BKLss9Y8PQ9IUjPYQiv3/Zmlx92uxffUOX8ZZNoQlCIZBJPT5M+GOMQj7xislvVQ6l1BstBjcX0XB/aHfFYVNw==}\n    peerDependencies:\n      react: ^18 || ^19\n\n  '@tsconfig/node10@1.0.12':\n    resolution: {integrity: sha512-UCYBaeFvM11aU2y3YPZ//O5Rhj+xKyzy7mvcIoAjASbigy8mHMryP5cK7dgjlz2hWxh1g5pLw084E0a/wlUSFQ==}\n\n  '@tsconfig/node12@1.0.11':\n    resolution: {integrity: sha512-cqefuRsh12pWyGsIoBKJA9luFu3mRxCA+ORZvA4ktLSzIuCUtWVxGIuXigEwO5/ywWFMZ2QEGKWvkZG1zDMTag==}\n\n  '@tsconfig/node14@1.0.3':\n    resolution: {integrity: sha512-ysT8mhdixWK6Hw3i1V2AeRqZ5WfXg1G43mqoYlM2nc6388Fq5jcXyr5mRsqViLx/GJYdoL0bfXD8nmF+Zn/Iow==}\n\n  '@tsconfig/node16@1.0.4':\n    resolution: {integrity: sha512-vxhUy4J8lyeyinH7Azl1pdd43GJhZH/tP2weN8TntQblOY+A0XbT8DJk1/oCPuOOyg/Ja757rG0CgHcWC8OfMA==}\n\n  '@types/babel__core@7.20.5':\n    resolution: {integrity: sha512-qoQprZvz5wQFJwMDqeseRXWv3rqMvhgpbXFfVyWhbx9X47POIA6i/+dXefEmZKoAgOaTdaIgNSMqMIU61yRyzA==}\n\n  '@types/babel__generator@7.27.0':\n    resolution: {integrity: sha512-ufFd2Xi92OAVPYsy+P4n7/U7e68fex0+Ee8gSG9KX7eo084CWiQ4sdxktvdl0bOPupXtVJPY19zk6EwWqUQ8lg==}\n\n  '@types/babel__template@7.4.4':\n    resolution: {integrity: sha512-h/NUaSyG5EyxBIp8YRxo4RMe2/qQgvyowRwVMzhYhBCONbW8PUsg4lkFMrhgZhUe5z3L3MiLDuvyJ/CaPa2A8A==}\n\n  '@types/babel__traverse@7.28.0':\n    resolution: {integrity: sha512-8PvcXf70gTDZBgt9ptxJ8elBeBjcLOAcOtoO/mPJjtji1+CdGbHgm77om1GrsPxsiE+uXIpNSK64UYaIwQXd4Q==}\n\n  '@types/bcrypt@5.0.2':\n    resolution: {integrity: sha512-6atioO8Y75fNcbmj0G7UjI9lXN2pQ/IGJ2FWT4a/btd0Lk9lQalHLKhkgKVZ3r+spnmWUKfbMi1GEe9wyHQfNQ==}\n\n  '@types/body-parser@1.19.6':\n    resolution: {integrity: sha512-HLFeCYgz89uk22N5Qg3dvGvsv46B8GLvKKo1zKG4NybA8U2DiEO3w9lqGg29t/tfLRJpJ6iQxnVw4OnB7MoM9g==}\n\n  '@types/busboy@1.5.4':\n    resolution: {integrity: sha512-kG7WrUuAKK0NoyxfQHsVE6j1m01s6kMma64E+OZenQABMQyTJop1DumUWcLwAQ2JzpefU7PDYoRDKl8uZosFjw==}\n\n  '@types/connect-pg-simple@7.0.3':\n    resolution: {integrity: sha512-NGCy9WBlW2bw+J/QlLnFZ9WjoGs6tMo3LAut6mY4kK+XHzue//lpNVpAvYRpIwM969vBRAM2Re0izUvV6kt+NA==}\n\n  '@types/connect@3.4.38':\n    resolution: {integrity: sha512-K6uROf1LD88uDQqJCktA4yzL1YYAK6NgfsI0v/mTgyPKWsX1CnJ0XPSDhViejru1GcRkLWb8RlzFYJRqGUbaug==}\n\n  '@types/cors@2.8.19':\n    resolution: {integrity: sha512-mFNylyeyqN93lfe/9CSxOGREz8cpzAhH+E93xJ4xWQf62V8sQ/24reV2nyzUWM6H6Xji+GGHpkbLe7pVoUEskg==}\n\n  '@types/d3-array@3.2.2':\n    resolution: {integrity: sha512-hOLWVbm7uRza0BYXpIIW5pxfrKe0W+D5lrFiAEYR+pb6w3N2SwSMaJbXdUfSEv+dT4MfHBLtn5js0LAWaO6otw==}\n\n  '@types/d3-color@3.1.3':\n    resolution: {integrity: sha512-iO90scth9WAbmgv7ogoq57O9YpKmFBbmoEoCHDB2xMBY0+/KVrqAaCDyCE16dUspeOvIxFFRI+0sEtqDqy2b4A==}\n\n  '@types/d3-ease@3.0.2':\n    resolution: {integrity: sha512-NcV1JjO5oDzoK26oMzbILE6HW7uVXOHLQvHshBUW4UMdZGfiY6v5BeQwh9a9tCzv+CeefZQHJt5SRgK154RtiA==}\n\n  '@types/d3-interpolate@3.0.4':\n    resolution: {integrity: sha512-mgLPETlrpVV1YRJIglr4Ez47g7Yxjl1lj7YKsiMCb27VJH9W8NVM6Bb9d8kkpG/uAQS5AmbA48q2IAolKKo1MA==}\n\n  '@types/d3-path@3.1.1':\n    resolution: {integrity: sha512-VMZBYyQvbGmWyWVea0EHs/BwLgxc+MKi1zLDCONksozI4YJMcTt8ZEuIR4Sb1MMTE8MMW49v0IwI5+b7RmfWlg==}\n\n  '@types/d3-scale@4.0.9':\n    resolution: {integrity: sha512-dLmtwB8zkAeO/juAMfnV+sItKjlsw2lKdZVVy6LRr0cBmegxSABiLEpGVmSJJ8O08i4+sGR6qQtb6WtuwJdvVw==}\n\n  '@types/d3-shape@3.1.7':\n    resolution: {integrity: sha512-VLvUQ33C+3J+8p+Daf+nYSOsjB4GXp19/S/aGo60m9h1v6XaxjiT82lKVWJCfzhtuZ3yD7i/TPeC/fuKLLOSmg==}\n\n  '@types/d3-time@3.0.4':\n    resolution: {integrity: sha512-yuzZug1nkAAaBlBBikKZTgzCeA+k1uy4ZFwWANOfKw5z5LRhV0gNA7gNkKm7HoK+HRN0wX3EkxGk0fpbWhmB7g==}\n\n  '@types/d3-timer@3.0.2':\n    resolution: {integrity: sha512-Ps3T8E8dZDam6fUyNiMkekK3XUsaUEik+idO9/YjPtfj2qruF8tFBXS7XhtE4iIXBLxhmLjP3SXpLhVf21I9Lw==}\n\n  '@types/estree@1.0.8':\n    resolution: {integrity: sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w==}\n\n  '@types/express-fileupload@1.5.1':\n    resolution: {integrity: sha512-DllImBVI1lCyjl2klky/TEwk60mbNebgXv1669h66g9TfptWSrEFq5a/raHSutaFzjSm1tmn9ypdNfu4jPSixQ==}\n\n  '@types/express-serve-static-core@4.19.7':\n    resolution: {integrity: sha512-FvPtiIf1LfhzsaIXhv/PHan/2FeQBbtBDtfX2QfvPxdUelMDEckK08SM6nqo1MIZY3RUlfA+HV8+hFUSio78qg==}\n\n  '@types/express-session@1.18.2':\n    resolution: {integrity: sha512-k+I0BxwVXsnEU2hV77cCobC08kIsn4y44C3gC0b46uxZVMaXA04lSPgRLR/bSL2w0t0ShJiG8o4jPzRG/nscFg==}\n\n  '@types/express@4.17.21':\n    resolution: {integrity: sha512-ejlPM315qwLpaQlQDTjPdsUFSc6ZsP4AN6AlWnogPjQ7CVi7PYF3YVz+CY3jE2pwYf7E/7HlDAN0rV2GxTG0HQ==}\n\n  '@types/http-errors@2.0.5':\n    resolution: {integrity: sha512-r8Tayk8HJnX0FztbZN7oVqGccWgw98T/0neJphO91KkmOzug1KkofZURD4UaD5uH8AqcFLfdPErnBod0u71/qg==}\n\n  '@types/memoizee@0.4.12':\n    resolution: {integrity: sha512-EdtpwNYNhe3kZ+4TlXj/++pvBoU0KdrAICMzgI7vjWgu9sIvvUhu9XR8Ks4L6Wh3sxpZ22wkZR7yCLAqUjnZuQ==}\n\n  '@types/multer@2.0.0':\n    resolution: {integrity: sha512-C3Z9v9Evij2yST3RSBktxP9STm6OdMc5uR1xF1SGr98uv8dUlAL2hqwrZ3GVB3uyMyiegnscEK6PGtYvNrjTjw==}\n\n  '@types/node@20.16.11':\n    resolution: {integrity: sha512-y+cTCACu92FyA5fgQSAI8A1H429g7aSK2HsO7K4XYUWc4dY5IUz55JSDIYT6/VsOLfGy8vmvQYC2hfb0iF16Uw==}\n\n  '@types/passport-local@1.0.38':\n    resolution: {integrity: sha512-nsrW4A963lYE7lNTv9cr5WmiUD1ibYJvWrpE13oxApFsRt77b0RdtZvKbCdNIY4v/QZ6TRQWaDDEwV1kCTmcXg==}\n\n  '@types/passport-strategy@0.2.38':\n    resolution: {integrity: sha512-GC6eMqqojOooq993Tmnmp7AUTbbQSgilyvpCYQjT+H6JfG/g6RGc7nXEniZlp0zyKJ0WUdOiZWLBZft9Yug1uA==}\n\n  '@types/passport@1.0.17':\n    resolution: {integrity: sha512-aciLyx+wDwT2t2/kJGJR2AEeBz0nJU4WuRX04Wu9Dqc5lSUtwu0WERPHYsLhF9PtseiAMPBGNUOtFjxZ56prsg==}\n\n  '@types/pg@8.11.6':\n    resolution: {integrity: sha512-/2WmmBXHLsfRqzfHW7BNZ8SbYzE8OSk7i3WjFYvfgRHj7S1xj+16Je5fUKv3lVdVzk/zn9TXOqf+avFCFIE0yQ==}\n\n  '@types/pg@8.15.6':\n    resolution: {integrity: sha512-NoaMtzhxOrubeL/7UZuNTrejB4MPAJ0RpxZqXQf2qXuVlTPuG6Y8p4u9dKRaue4yjmC7ZhzVO2/Yyyn25znrPQ==}\n\n  '@types/prop-types@15.7.15':\n    resolution: {integrity: sha512-F6bEyamV9jKGAFBEmlQnesRPGOQqS2+Uwi0Em15xenOxHaf2hv6L8YCVn3rPdPJOiJfPiCnLIRyvwVaqMY3MIw==}\n\n  '@types/qs@6.14.0':\n    resolution: {integrity: sha512-eOunJqu0K1923aExK6y8p6fsihYEn/BYuQ4g0CxAAgFc4b/ZLN4CrsRZ55srTdqoiLzU2B2evC+apEIxprEzkQ==}\n\n  '@types/range-parser@1.2.7':\n    resolution: {integrity: sha512-hKormJbkJqzQGhziax5PItDUTMAM9uE2XXQmM37dyd4hVM+5aVl7oVxMVUiVQn2oCQFN/LKCZdvSM0pFRqbSmQ==}\n\n  '@types/react-dom@18.3.7':\n    resolution: {integrity: sha512-MEe3UeoENYVFXzoXEWsvcpg6ZvlrFNlOQ7EOsvhI3CfAXwzPfO8Qwuxd40nepsYKqyyVQnTdEfv68q91yLcKrQ==}\n    peerDependencies:\n      '@types/react': ^18.0.0\n\n  '@types/react@18.3.27':\n    resolution: {integrity: sha512-cisd7gxkzjBKU2GgdYrTdtQx1SORymWyaAFhaxQPK9bYO9ot3Y5OikQRvY0VYQtvwjeQnizCINJAenh/V7MK2w==}\n\n  '@types/send@1.2.1':\n    resolution: {integrity: sha512-arsCikDvlU99zl1g69TcAB3mzZPpxgw0UQnaHeC1Nwb015xp8bknZv5rIfri9xTOcMuaVgvabfIRA7PSZVuZIQ==}\n\n  '@types/serve-static@2.2.0':\n    resolution: {integrity: sha512-8mam4H1NHLtu7nmtalF7eyBH14QyOASmcxHhSfEoRyr0nP/YdoesEtU+uSRvMe96TW/HPTtkoKqQLl53N7UXMQ==}\n\n  '@types/ws@8.18.1':\n    resolution: {integrity: sha512-ThVF6DCVhA8kUGy+aazFQ4kXQ7E1Ty7A3ypFOe0IcJV8O/M511G99AW24irKrW56Wt44yG9+ij8FaqoBGkuBXg==}\n\n  '@vitejs/plugin-react@4.7.0':\n    resolution: {integrity: sha512-gUu9hwfWvvEDBBmgtAowQCojwZmJ5mcLn3aufeCsitijs3+f2NsrPtlAWIR6OPiqljl96GVCUbLe0HyqIpVaoA==}\n    engines: {node: ^14.18.0 || >=16.0.0}\n    peerDependencies:\n      vite: ^4.2.0 || ^5.0.0 || ^6.0.0 || ^7.0.0\n\n  accepts@1.3.8:\n    resolution: {integrity: sha512-PYAthTa2m2VKxuvSD3DPC/Gy+U+sOA1LAuT8mkmRuvw+NACSaeXEQ+NHcVF7rONl6qcaxV3Uuemwawk+7+SJLw==}\n    engines: {node: '>= 0.6'}\n\n  acorn-walk@8.3.4:\n    resolution: {integrity: sha512-ueEepnujpqee2o5aIYnvHU6C0A42MNdsIDeqy5BydrkuC5R1ZuUFnm27EeFJGoEHJQgn3uleRvmTXaJgfXbt4g==}\n    engines: {node: '>=0.4.0'}\n\n  acorn@8.15.0:\n    resolution: {integrity: sha512-NZyJarBfL7nWwIq+FDL6Zp/yHEhePMNnnJ0y3qfieCrmNvYct8uvtiV41UvlSe6apAfk0fY1FbWx+NwfmpvtTg==}\n    engines: {node: '>=0.4.0'}\n    hasBin: true\n\n  ansi-regex@5.0.1:\n    resolution: {integrity: sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==}\n    engines: {node: '>=8'}\n\n  ansi-regex@6.2.2:\n    resolution: {integrity: sha512-Bq3SmSpyFHaWjPk8If9yc6svM8c56dB5BAtW4Qbw5jHTwwXXcTLoRMkpDJp6VL0XzlWaCHTXrkFURMYmD0sLqg==}\n    engines: {node: '>=12'}\n\n  ansi-styles@4.3.0:\n    resolution: {integrity: sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==}\n    engines: {node: '>=8'}\n\n  ansi-styles@6.2.3:\n    resolution: {integrity: sha512-4Dj6M28JB+oAH8kFkTLUo+a2jwOFkuqb3yucU0CANcRRUbxS0cP0nZYCGjcc3BNXwRIsUVmDGgzawme7zvJHvg==}\n    engines: {node: '>=12'}\n\n  any-promise@1.3.0:\n    resolution: {integrity: sha512-7UvmKalWRt1wgjL1RrGxoSJW/0QZFIegpeGvZG9kjp8vrRu55XTHbwnqq2GpXm9uLbcuhxm3IqX9OB4MZR1b2A==}\n\n  anymatch@3.1.3:\n    resolution: {integrity: sha512-KMReFUr0B4t+D+OBkjR3KYqvocp2XaSzO55UcB6mgQMd3KbcE+mWTyvVV7D/zsdEbNnV6acZUutkiHQXvTr1Rw==}\n    engines: {node: '>= 8'}\n\n  append-field@1.0.0:\n    resolution: {integrity: sha512-klpgFSWLW1ZEs8svjfb7g4qWY0YS5imI82dTg+QahUvJ8YqAY0P10Uk8tTyh9ZGuYEZEMaeJYCF5BFuX552hsw==}\n\n  arg@4.1.3:\n    resolution: {integrity: sha512-58S9QDqG0Xx27YwPSt9fJxivjYl432YCwfDMfZ+71RAqUrZef7LrKQZ3LHLOwCS4FLNBplP533Zx895SeOCHvA==}\n\n  arg@5.0.2:\n    resolution: {integrity: sha512-PYjyFOLKQ9y57JvQ6QLo8dAgNqswh8M1RMJYdQduT6xbWSgK36P/Z/v+p888pM69jMMfS8Xd8F6I1kQ/I9HUGg==}\n\n  aria-hidden@1.2.6:\n    resolution: {integrity: sha512-ik3ZgC9dY/lYVVM++OISsaYDeg1tb0VtP5uL3ouh1koGOaUMDPpbFIei4JkFimWUFPn90sbMNMXQAIVOlnYKJA==}\n    engines: {node: '>=10'}\n\n  array-flatten@1.1.1:\n    resolution: {integrity: sha512-PCVAQswWemu6UdxsDFFX/+gVeYqKAod3D3UVm91jHwynguOwAvYPhx8nNlM++NqRcK6CxxpUafjmhIdKiHibqg==}\n\n  autoprefixer@10.4.22:\n    resolution: {integrity: sha512-ARe0v/t9gO28Bznv6GgqARmVqcWOV3mfgUPn9becPHMiD3o9BwlRgaeccZnwTpZ7Zwqrm+c1sUSsMxIzQzc8Xg==}\n    engines: {node: ^10 || ^12 || >=14}\n    hasBin: true\n    peerDependencies:\n      postcss: ^8.1.0\n\n  balanced-match@1.0.2:\n    resolution: {integrity: sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==}\n\n  baseline-browser-mapping@2.8.29:\n    resolution: {integrity: sha512-sXdt2elaVnhpDNRDz+1BDx1JQoJRuNk7oVlAlbGiFkLikHCAQiccexF/9e91zVi6RCgqspl04aP+6Cnl9zRLrA==}\n    hasBin: true\n\n  bcrypt@6.0.0:\n    resolution: {integrity: sha512-cU8v/EGSrnH+HnxV2z0J7/blxH8gq7Xh2JFT6Aroax7UohdmiJJlxApMxtKfuI7z68NvvVcmR78k2LbT6efhRg==}\n    engines: {node: '>= 18'}\n\n  bcryptjs@3.0.3:\n    resolution: {integrity: sha512-GlF5wPWnSa/X5LKM1o0wz0suXIINz1iHRLvTS+sLyi7XPbe5ycmYI3DlZqVGZZtDgl4DmasFg7gOB3JYbphV5g==}\n    hasBin: true\n\n  binary-extensions@2.3.0:\n    resolution: {integrity: sha512-Ceh+7ox5qe7LJuLHoY0feh3pHuUDHAcRUeyL2VYghZwfpkNIy/+8Ocg0a3UuSoYzavmylwuLWQOf3hl0jjMMIw==}\n    engines: {node: '>=8'}\n\n  body-parser@1.20.3:\n    resolution: {integrity: sha512-7rAxByjUMqQ3/bHJy7D6OGXvx/MMc4IqBn/X0fcM1QUcAItpZrBEYhWGem+tzXH90c+G01ypMcYJBO9Y30203g==}\n    engines: {node: '>= 0.8', npm: 1.2.8000 || >= 1.4.16}\n\n  brace-expansion@2.0.2:\n    resolution: {integrity: sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==}\n\n  braces@3.0.3:\n    resolution: {integrity: sha512-yQbXgO/OSZVD2IsiLlro+7Hf6Q18EJrKSEsdoMzKePKXct3gvD8oLcOQdIzGupr5Fj+EDe8gO/lxc1BzfMpxvA==}\n    engines: {node: '>=8'}\n\n  browserslist@4.28.0:\n    resolution: {integrity: sha512-tbydkR/CxfMwelN0vwdP/pLkDwyAASZ+VfWm4EOwlB6SWhx1sYnWLqo8N5j0rAzPfzfRaxt0mM/4wPU/Su84RQ==}\n    engines: {node: ^6 || ^7 || ^8 || ^9 || ^10 || ^11 || ^12 || >=13.7}\n    hasBin: true\n\n  buffer-from@1.1.2:\n    resolution: {integrity: sha512-E+XQCRwSbaaiChtv6k6Dwgc+bx+Bs6vuKJHHl5kox/BaKbhiXzqQOwK4cO22yElGp2OCmjwVhT3HmxgyPGnJfQ==}\n\n  bufferutil@4.0.9:\n    resolution: {integrity: sha512-WDtdLmJvAuNNPzByAYpRo2rF1Mmradw6gvWsQKf63476DDXmomT9zUiGypLcG4ibIM67vhAj8jJRdbmEws2Aqw==}\n    engines: {node: '>=6.14.2'}\n\n  busboy@1.6.0:\n    resolution: {integrity: sha512-8SFQbg/0hQ9xy3UNTB0YEnsNBbWfhf7RtnzpL7TkBiTBRfrQ9Fxcnz7VJsleJpyp6rVLvXiuORqjlHi5q+PYuA==}\n    engines: {node: '>=10.16.0'}\n\n  bytes@3.1.2:\n    resolution: {integrity: sha512-/Nf7TyzTx6S3yRJObOAV7956r8cr2+Oj8AC5dt8wSP3BQAoeX58NoHyCU8P8zGkNXStjTSi6fzO6F0pBdcYbEg==}\n    engines: {node: '>= 0.8'}\n\n  call-bind-apply-helpers@1.0.2:\n    resolution: {integrity: sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==}\n    engines: {node: '>= 0.4'}\n\n  call-bound@1.0.4:\n    resolution: {integrity: sha512-+ys997U96po4Kx/ABpBCqhA9EuxJaQWDQg7295H4hBphv3IZg0boBKuwYpt4YXp6MZ5AmZQnU/tyMTlRpaSejg==}\n    engines: {node: '>= 0.4'}\n\n  camelcase-css@2.0.1:\n    resolution: {integrity: sha512-QOSvevhslijgYwRx6Rv7zKdMF8lbRmx+uQGx2+vDc+KI/eBnsy9kit5aj23AgGu3pa4t9AgwbnXWqS+iOY+2aA==}\n    engines: {node: '>= 6'}\n\n  caniuse-lite@1.0.30001756:\n    resolution: {integrity: sha512-4HnCNKbMLkLdhJz3TToeVWHSnfJvPaq6vu/eRP0Ahub/07n484XHhBF5AJoSGHdVrS8tKFauUQz8Bp9P7LVx7A==}\n\n  chokidar@3.6.0:\n    resolution: {integrity: sha512-7VT13fmjotKpGipCW9JEQAusEPE+Ei8nl6/g4FBAmIm0GOOLMua9NDDo/DWp0ZAxCr3cPq5ZpBqmPAQgDda2Pw==}\n    engines: {node: '>= 8.10.0'}\n\n  class-variance-authority@0.7.1:\n    resolution: {integrity: sha512-Ka+9Trutv7G8M6WT6SeiRWz792K5qEqIGEGzXKhAE6xOWAY6pPH8U+9IY3oCMv6kqTmLsv7Xh/2w2RigkePMsg==}\n\n  clsx@2.1.1:\n    resolution: {integrity: sha512-eYm0QWBtUrBWZWG0d386OGAw16Z995PiOVo2B7bjWSbHedGl5e0ZWaq65kOGgUSNesEIDkB9ISbTg/JK9dhCZA==}\n    engines: {node: '>=6'}\n\n  cmdk@1.1.1:\n    resolution: {integrity: sha512-Vsv7kFaXm+ptHDMZ7izaRsP70GgrW9NBNGswt9OZaVBLlE0SNpDq8eu/VGXyF9r7M0azK3Wy7OlYXsuyYLFzHg==}\n    peerDependencies:\n      react: ^18 || ^19 || ^19.0.0-rc\n      react-dom: ^18 || ^19 || ^19.0.0-rc\n\n  color-convert@2.0.1:\n    resolution: {integrity: sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==}\n    engines: {node: '>=7.0.0'}\n\n  color-name@1.1.4:\n    resolution: {integrity: sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==}\n\n  commander@4.1.1:\n    resolution: {integrity: sha512-NOKm8xhkzAjzFx8B2v5OAHT+u5pRQc2UCa2Vq9jYL/31o2wi9mxBA7LIFs3sV5VSC49z6pEhfbMULvShKj26WA==}\n    engines: {node: '>= 6'}\n\n  concat-stream@2.0.0:\n    resolution: {integrity: sha512-MWufYdFw53ccGjCA+Ol7XJYpAlW6/prSMzuPOTRnJGcGzuhLn4Scrz7qf6o8bROZ514ltazcIFJZevcfbo0x7A==}\n    engines: {'0': node >= 6.0}\n\n  connect-pg-simple@10.0.0:\n    resolution: {integrity: sha512-pBGVazlqiMrackzCr0eKhn4LO5trJXsOX0nQoey9wCOayh80MYtThCbq8eoLsjpiWgiok/h+1/uti9/2/Una8A==}\n    engines: {node: ^18.18.0 || ^20.9.0 || >=22.0.0}\n\n  content-disposition@0.5.4:\n    resolution: {integrity: sha512-FveZTNuGw04cxlAiWbzi6zTAL/lhehaWbTtgluJh4/E95DqMwTmha3KZN1aAWA8cFIhHzMZUvLevkw5Rqk+tSQ==}\n    engines: {node: '>= 0.6'}\n\n  content-type@1.0.5:\n    resolution: {integrity: sha512-nTjqfcBFEipKdXCv4YDQWCfmcLZKm81ldF0pAopTvyrFGVbcR6P/VAAd5G7N+0tTr8QqiU0tFadD6FK4NtJwOA==}\n    engines: {node: '>= 0.6'}\n\n  convert-source-map@2.0.0:\n    resolution: {integrity: sha512-Kvp459HrV2FEJ1CAsi1Ku+MY3kasH19TFykTz2xWmMeq6bk2NU3XXvfJ+Q61m0xktWwt+1HSYf3JZsTms3aRJg==}\n\n  cookie-signature@1.0.6:\n    resolution: {integrity: sha512-QADzlaHc8icV8I7vbaJXJwod9HWYp8uCqf1xa4OfNu1T7JVxQIrUgOWtHdNDtPiywmFbiS12VjotIXLrKM3orQ==}\n\n  cookie-signature@1.0.7:\n    resolution: {integrity: sha512-NXdYc3dLr47pBkpUCHtKSwIOQXLVn8dZEuywboCOJY/osA0wFSLlSawr3KN8qXJEyX66FcONTH8EIlVuK0yyFA==}\n\n  cookie@0.7.1:\n    resolution: {integrity: sha512-6DnInpx7SJ2AK3+CTUE/ZM0vWTUboZCegxhC2xiIydHR9jNuTAASBrfEpHhiGOZw/nX51bHt6YQl8jsGo4y/0w==}\n    engines: {node: '>= 0.6'}\n\n  cookie@0.7.2:\n    resolution: {integrity: sha512-yki5XnKuf750l50uGTllt6kKILY4nQ1eNIQatoXEByZ5dWgnKqbnqmTrBE5B4N7lrMJKQ2ytWMiTO2o0v6Ew/w==}\n    engines: {node: '>= 0.6'}\n\n  cors@2.8.5:\n    resolution: {integrity: sha512-KIHbLJqu73RGr/hnbrO9uBeixNGuvSQjul/jdFvS/KFSIH1hWVd1ng7zOHx+YrEfInLG7q4n6GHQ9cDtxv/P6g==}\n    engines: {node: '>= 0.10'}\n\n  create-require@1.1.1:\n    resolution: {integrity: sha512-dcKFX3jn0MpIaXjisoRvexIJVEKzaq7z2rZKxf+MSr9TkdmHmsU4m2lcLojrj/FHl8mk5VxMmYA+ftRkP/3oKQ==}\n\n  cross-spawn@7.0.6:\n    resolution: {integrity: sha512-uV2QOWP2nWzsy2aMp8aRibhi9dlzF5Hgh5SHaB9OiTGEyDTiJJyx0uy51QXdyWbtAHNua4XJzUKca3OzKUd3vA==}\n    engines: {node: '>= 8'}\n\n  cssesc@3.0.0:\n    resolution: {integrity: sha512-/Tb/JcjK111nNScGob5MNtsntNM1aCNUDipB/TkwZFhyDrrE47SOx/18wF2bbjgc3ZzCSKW1T5nt5EbFoAz/Vg==}\n    engines: {node: '>=4'}\n    hasBin: true\n\n  csstype@3.2.3:\n    resolution: {integrity: sha512-z1HGKcYy2xA8AGQfwrn0PAy+PB7X/GSj3UVJW9qKyn43xWa+gl5nXmU4qqLMRzWVLFC8KusUX8T/0kCiOYpAIQ==}\n\n  d3-array@3.2.4:\n    resolution: {integrity: sha512-tdQAmyA18i4J7wprpYq8ClcxZy3SC31QMeByyCFyRt7BVHdREQZ5lpzoe5mFEYZUWe+oq8HBvk9JjpibyEV4Jg==}\n    engines: {node: '>=12'}\n\n  d3-color@3.1.0:\n    resolution: {integrity: sha512-zg/chbXyeBtMQ1LbD/WSoW2DpC3I0mpmPdW+ynRTj/x2DAWYrIY7qeZIHidozwV24m4iavr15lNwIwLxRmOxhA==}\n    engines: {node: '>=12'}\n\n  d3-ease@3.0.1:\n    resolution: {integrity: sha512-wR/XK3D3XcLIZwpbvQwQ5fK+8Ykds1ip7A2Txe0yxncXSdq1L9skcG7blcedkOX+ZcgxGAmLX1FrRGbADwzi0w==}\n    engines: {node: '>=12'}\n\n  d3-format@3.1.0:\n    resolution: {integrity: sha512-YyUI6AEuY/Wpt8KWLgZHsIU86atmikuoOmCfommt0LYHiQSPjvX2AcFc38PX0CBpr2RCyZhjex+NS/LPOv6YqA==}\n    engines: {node: '>=12'}\n\n  d3-interpolate@3.0.1:\n    resolution: {integrity: sha512-3bYs1rOD33uo8aqJfKP3JWPAibgw8Zm2+L9vBKEHJ2Rg+viTR7o5Mmv5mZcieN+FRYaAOWX5SJATX6k1PWz72g==}\n    engines: {node: '>=12'}\n\n  d3-path@3.1.0:\n    resolution: {integrity: sha512-p3KP5HCf/bvjBSSKuXid6Zqijx7wIfNW+J/maPs+iwR35at5JCbLUT0LzF1cnjbCHWhqzQTIN2Jpe8pRebIEFQ==}\n    engines: {node: '>=12'}\n\n  d3-scale@4.0.2:\n    resolution: {integrity: sha512-GZW464g1SH7ag3Y7hXjf8RoUuAFIqklOAq3MRl4OaWabTFJY9PN/E1YklhXLh+OQ3fM9yS2nOkCoS+WLZ6kvxQ==}\n    engines: {node: '>=12'}\n\n  d3-shape@3.2.0:\n    resolution: {integrity: sha512-SaLBuwGm3MOViRq2ABk3eLoxwZELpH6zhl3FbAoJ7Vm1gofKx6El1Ib5z23NUEhF9AsGl7y+dzLe5Cw2AArGTA==}\n    engines: {node: '>=12'}\n\n  d3-time-format@4.1.0:\n    resolution: {integrity: sha512-dJxPBlzC7NugB2PDLwo9Q8JiTR3M3e4/XANkreKSUxF8vvXKqm1Yfq4Q5dl8budlunRVlUUaDUgFt7eA8D6NLg==}\n    engines: {node: '>=12'}\n\n  d3-time@3.1.0:\n    resolution: {integrity: sha512-VqKjzBLejbSMT4IgbmVgDjpkYrNWUYJnbCGo874u7MMKIWsILRX+OpX/gTk8MqjpT1A/c6HY2dCA77ZN0lkQ2Q==}\n    engines: {node: '>=12'}\n\n  d3-timer@3.0.1:\n    resolution: {integrity: sha512-ndfJ/JxxMd3nw31uyKoY2naivF+r29V+Lc0svZxe1JvvIRmi8hUsrMvdOwgS1o6uBHmiz91geQ0ylPP0aj1VUA==}\n    engines: {node: '>=12'}\n\n  d@1.0.2:\n    resolution: {integrity: sha512-MOqHvMWF9/9MX6nza0KgvFH4HpMU0EF5uUDXqX/BtxtU8NfB0QzRtJ8Oe/6SuS4kbhyzVJwjd97EA4PKrzJ8bw==}\n    engines: {node: '>=0.12'}\n\n  date-fns@3.6.0:\n    resolution: {integrity: sha512-fRHTG8g/Gif+kSh50gaGEdToemgfj74aRX3swtiouboip5JDLAyDE9F11nHMIcvOaXeOC6D7SpNhi7uFyB7Uww==}\n\n  debug@2.6.9:\n    resolution: {integrity: sha512-bC7ElrdJaJnPbAP+1EotYvqZsb3ecl5wi6Bfi6BJTUcNowp6cvspg0jXznRTKDjm/E7AdgFBVeAPVMNcKGsHMA==}\n    peerDependencies:\n      supports-color: '*'\n    peerDependenciesMeta:\n      supports-color:\n        optional: true\n\n  debug@4.4.3:\n    resolution: {integrity: sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==}\n    engines: {node: '>=6.0'}\n    peerDependencies:\n      supports-color: '*'\n    peerDependenciesMeta:\n      supports-color:\n        optional: true\n\n  decimal.js-light@2.5.1:\n    resolution: {integrity: sha512-qIMFpTMZmny+MMIitAB6D7iVPEorVw6YQRWkvarTkT4tBeSLLiHzcwj6q0MmYSFCiVpiqPJTJEYIrpcPzVEIvg==}\n\n  depd@2.0.0:\n    resolution: {integrity: sha512-g7nH6P6dyDioJogAAGprGpCtVImJhpPk/roCzdb3fIh61/s/nPsfR6onyMwkCAR/OlC3yBC0lESvUoQEAssIrw==}\n    engines: {node: '>= 0.8'}\n\n  destroy@1.2.0:\n    resolution: {integrity: sha512-2sJGJTaXIIaR1w4iJSNoN0hnMY7Gpc/n8D4qSCJw8QqFWXf7cuAgnEHxBpweaVcPevC2l3KpjYCx3NypQQgaJg==}\n    engines: {node: '>= 0.8', npm: 1.2.8000 || >= 1.4.16}\n\n  detect-libc@2.1.2:\n    resolution: {integrity: sha512-Btj2BOOO83o3WyH59e8MgXsxEQVcarkUOpEYrubB0urwnN10yQ364rsiByU11nZlqWYZm05i/of7io4mzihBtQ==}\n    engines: {node: '>=8'}\n\n  detect-node-es@1.1.0:\n    resolution: {integrity: sha512-ypdmJU/TbBby2Dxibuv7ZLW3Bs1QEmM7nHjEANfohJLvE0XVujisn1qPJcZxg+qDucsr+bP6fLD1rPS3AhJ7EQ==}\n\n  didyoumean@1.2.2:\n    resolution: {integrity: sha512-gxtyfqMg7GKyhQmb056K7M3xszy/myH8w+B4RT+QXBQsvAOdc3XymqDDPHx1BgPgsdAA5SIifona89YtRATDzw==}\n\n  diff@4.0.2:\n    resolution: {integrity: sha512-58lmxKSA4BNyLz+HHMUzlOEpg09FV+ev6ZMe3vJihgdxzgcwZ8VoEEPmALCZG9LmqfVoNMMKpttIYTVG6uDY7A==}\n    engines: {node: '>=0.3.1'}\n\n  dlv@1.1.3:\n    resolution: {integrity: sha512-+HlytyjlPKnIG8XuRG8WvmBP8xs8P71y+SKKS6ZXWoEgLuePxtDoUEiH7WkdePWrQ5JBpE6aoVqfZfJUQkjXwA==}\n\n  dom-helpers@5.2.1:\n    resolution: {integrity: sha512-nRCa7CK3VTrM2NmGkIy4cbK7IZlgBE/PYMn55rrXefr5xXDP0LdtfPnblFDoVdcAfslJ7or6iqAUnx0CCGIWQA==}\n\n  dotenv@17.2.3:\n    resolution: {integrity: sha512-JVUnt+DUIzu87TABbhPmNfVdBDt18BLOWjMUFJMSi/Qqg7NTYtabbvSNJGOJ7afbRuv9D/lngizHtP7QyLQ+9w==}\n    engines: {node: '>=12'}\n\n  drizzle-kit@0.30.6:\n    resolution: {integrity: sha512-U4wWit0fyZuGuP7iNmRleQyK2V8wCuv57vf5l3MnG4z4fzNTjY/U13M8owyQ5RavqvqxBifWORaR3wIUzlN64g==}\n    hasBin: true\n\n  drizzle-orm@0.39.3:\n    resolution: {integrity: sha512-EZ8ZpYvDIvKU9C56JYLOmUskazhad+uXZCTCRN4OnRMsL+xAJ05dv1eCpAG5xzhsm1hqiuC5kAZUCS924u2DTw==}\n    peerDependencies:\n      '@aws-sdk/client-rds-data': '>=3'\n      '@cloudflare/workers-types': '>=4'\n      '@electric-sql/pglite': '>=0.2.0'\n      '@libsql/client': '>=0.10.0'\n      '@libsql/client-wasm': '>=0.10.0'\n      '@neondatabase/serverless': '>=0.10.0'\n      '@op-engineering/op-sqlite': '>=2'\n      '@opentelemetry/api': ^1.4.1\n      '@planetscale/database': '>=1'\n      '@prisma/client': '*'\n      '@tidbcloud/serverless': '*'\n      '@types/better-sqlite3': '*'\n      '@types/pg': '*'\n      '@types/sql.js': '*'\n      '@vercel/postgres': '>=0.8.0'\n      '@xata.io/client': '*'\n      better-sqlite3: '>=7'\n      bun-types: '*'\n      expo-sqlite: '>=14.0.0'\n      knex: '*'\n      kysely: '*'\n      mysql2: '>=2'\n      pg: '>=8'\n      postgres: '>=3'\n      prisma: '*'\n      sql.js: '>=1'\n      sqlite3: '>=5'\n    peerDependenciesMeta:\n      '@aws-sdk/client-rds-data':\n        optional: true\n      '@cloudflare/workers-types':\n        optional: true\n      '@electric-sql/pglite':\n        optional: true\n      '@libsql/client':\n        optional: true\n      '@libsql/client-wasm':\n        optional: true\n      '@neondatabase/serverless':\n        optional: true\n      '@op-engineering/op-sqlite':\n        optional: true\n      '@opentelemetry/api':\n        optional: true\n      '@planetscale/database':\n        optional: true\n      '@prisma/client':\n        optional: true\n      '@tidbcloud/serverless':\n        optional: true\n      '@types/better-sqlite3':\n        optional: true\n      '@types/pg':\n        optional: true\n      '@types/sql.js':\n        optional: true\n      '@vercel/postgres':\n        optional: true\n      '@xata.io/client':\n        optional: true\n      better-sqlite3:\n        optional: true\n      bun-types:\n        optional: true\n      expo-sqlite:\n        optional: true\n      knex:\n        optional: true\n      kysely:\n        optional: true\n      mysql2:\n        optional: true\n      pg:\n        optional: true\n      postgres:\n        optional: true\n      prisma:\n        optional: true\n      sql.js:\n        optional: true\n      sqlite3:\n        optional: true\n\n  drizzle-zod@0.7.1:\n    resolution: {integrity: sha512-nZzALOdz44/AL2U005UlmMqaQ1qe5JfanvLujiTHiiT8+vZJTBFhj3pY4Vk+L6UWyKFfNmLhk602Hn4kCTynKQ==}\n    peerDependencies:\n      drizzle-orm: '>=0.36.0'\n      zod: '>=3.0.0'\n\n  dunder-proto@1.0.1:\n    resolution: {integrity: sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==}\n    engines: {node: '>= 0.4'}\n\n  eastasianwidth@0.2.0:\n    resolution: {integrity: sha512-I88TYZWc9XiYHRQ4/3c5rjjfgkjhLyW2luGIheGERbNQ6OY7yTybanSpDXZa8y7VUP9YmDcYa+eyq4ca7iLqWA==}\n\n  ee-first@1.1.1:\n    resolution: {integrity: sha512-WMwm9LhRUo+WUaRN+vRuETqG89IgZphVSNkdFgeb6sS/E4OrDIN7t48CAewSHXc6C8lefD8KKfr5vY61brQlow==}\n\n  electron-to-chromium@1.5.256:\n    resolution: {integrity: sha512-uqYq1IQhpXXLX+HgiXdyOZml7spy4xfy42yPxcCCRjswp0fYM2X+JwCON07lqnpLEGVCj739B7Yr+FngmHBMEQ==}\n\n  embla-carousel-react@8.6.0:\n    resolution: {integrity: sha512-0/PjqU7geVmo6F734pmPqpyHqiM99olvyecY7zdweCw+6tKEXnrE90pBiBbMMU8s5tICemzpQ3hi5EpxzGW+JA==}\n    peerDependencies:\n      react: ^16.8.0 || ^17.0.1 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc\n\n  embla-carousel-reactive-utils@8.6.0:\n    resolution: {integrity: sha512-fMVUDUEx0/uIEDM0Mz3dHznDhfX+znCCDCeIophYb1QGVM7YThSWX+wz11zlYwWFOr74b4QLGg0hrGPJeG2s4A==}\n    peerDependencies:\n      embla-carousel: 8.6.0\n\n  embla-carousel@8.6.0:\n    resolution: {integrity: sha512-SjWyZBHJPbqxHOzckOfo8lHisEaJWmwd23XppYFYVh10bU66/Pn5tkVkbkCMZVdbUE5eTCI2nD8OyIP4Z+uwkA==}\n\n  emoji-regex@8.0.0:\n    resolution: {integrity: sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==}\n\n  emoji-regex@9.2.2:\n    resolution: {integrity: sha512-L18DaJsXSUk2+42pv8mLs5jJT2hqFkFE4j21wOmgbUqsZ2hL72NsUU785g9RXgo3s0ZNgVl42TiHp3ZtOv/Vyg==}\n\n  encodeurl@1.0.2:\n    resolution: {integrity: sha512-TPJXq8JqFaVYm2CWmPvnP2Iyo4ZSM7/QKcSmuMLDObfpH5fi7RUGmd/rTDf+rut/saiDiQEeVTNgAmJEdAOx0w==}\n    engines: {node: '>= 0.8'}\n\n  encodeurl@2.0.0:\n    resolution: {integrity: sha512-Q0n9HRi4m6JuGIV1eFlmvJB7ZEVxu93IrMyiMsGC0lrMJMWzRgx6WGquyfQgZVb31vhGgXnfmPNNXmxnOkRBrg==}\n    engines: {node: '>= 0.8'}\n\n  enhanced-resolve@5.18.3:\n    resolution: {integrity: sha512-d4lC8xfavMeBjzGr2vECC3fsGXziXZQyJxD868h2M/mBI3PwAuODxAkLkq5HYuvrPYcUtiLzsTo8U3PgX3Ocww==}\n    engines: {node: '>=10.13.0'}\n\n  env-paths@3.0.0:\n    resolution: {integrity: sha512-dtJUTepzMW3Lm/NPxRf3wP4642UWhjL2sQxc+ym2YMj1m/H2zDNQOlezafzkHwn6sMstjHTwG6iQQsctDW/b1A==}\n    engines: {node: ^12.20.0 || ^14.13.1 || >=16.0.0}\n\n  es-define-property@1.0.1:\n    resolution: {integrity: sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==}\n    engines: {node: '>= 0.4'}\n\n  es-errors@1.3.0:\n    resolution: {integrity: sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==}\n    engines: {node: '>= 0.4'}\n\n  es-object-atoms@1.1.1:\n    resolution: {integrity: sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==}\n    engines: {node: '>= 0.4'}\n\n  es5-ext@0.10.64:\n    resolution: {integrity: sha512-p2snDhiLaXe6dahss1LddxqEm+SkuDvV8dnIQG0MWjyHpcMNfXKPE+/Cc0y+PhxJX3A4xGNeFCj5oc0BUh6deg==}\n    engines: {node: '>=0.10'}\n\n  es6-iterator@2.0.3:\n    resolution: {integrity: sha512-zw4SRzoUkd+cl+ZoE15A9o1oQd920Bb0iOJMQkQhl3jNc03YqVjAhG7scf9C5KWRU/R13Orf588uCC6525o02g==}\n\n  es6-symbol@3.1.4:\n    resolution: {integrity: sha512-U9bFFjX8tFiATgtkJ1zg25+KviIXpgRvRHS8sau3GfhVzThRQrOeksPeT0BWW2MNZs1OEWJ1DPXOQMn0KKRkvg==}\n    engines: {node: '>=0.12'}\n\n  es6-weak-map@2.0.3:\n    resolution: {integrity: sha512-p5um32HOTO1kP+w7PRnB+5lQ43Z6muuMuIMffvDN8ZB4GcnjLBV6zGStpbASIMk4DCAvEaamhe2zhyCb/QXXsA==}\n\n  esbuild-register@3.6.0:\n    resolution: {integrity: sha512-H2/S7Pm8a9CL1uhp9OvjwrBh5Pvx0H8qVOxNu8Wed9Y7qv56MPtq+GGM8RJpq6glYJn9Wspr8uw7l55uyinNeg==}\n    peerDependencies:\n      esbuild: '>=0.12 <1'\n\n  esbuild@0.18.20:\n    resolution: {integrity: sha512-ceqxoedUrcayh7Y7ZX6NdbbDzGROiyVBgC4PriJThBKSVPWnnFHZAkfI1lJT8QFkOwH4qOS2SJkS4wvpGl8BpA==}\n    engines: {node: '>=12'}\n    hasBin: true\n\n  esbuild@0.19.12:\n    resolution: {integrity: sha512-aARqgq8roFBj054KvQr5f1sFu0D65G+miZRCuJyJ0G13Zwx7vRar5Zhn2tkQNzIXcBrNVsv/8stehpj+GAjgbg==}\n    engines: {node: '>=12'}\n    hasBin: true\n\n  esbuild@0.21.5:\n    resolution: {integrity: sha512-mg3OPMV4hXywwpoDxu3Qda5xCKQi+vCTZq8S9J/EpkhB2HzKXq4SNFZE3+NK93JYxc8VMSep+lOUSC/RVKaBqw==}\n    engines: {node: '>=12'}\n    hasBin: true\n\n  esbuild@0.25.12:\n    resolution: {integrity: sha512-bbPBYYrtZbkt6Os6FiTLCTFxvq4tt3JKall1vRwshA3fdVztsLAatFaZobhkBC8/BrPetoa0oksYoKXoG4ryJg==}\n    engines: {node: '>=18'}\n    hasBin: true\n\n  escalade@3.2.0:\n    resolution: {integrity: sha512-WUj2qlxaQtO4g6Pq5c29GTcWGDyd8itL8zTlipgECz3JesAiiOKotd8JU6otB3PACgG6xkJUyVhboMS+bje/jA==}\n    engines: {node: '>=6'}\n\n  escape-html@1.0.3:\n    resolution: {integrity: sha512-NiSupZ4OeuGwr68lGIeym/ksIZMJodUGOSCZ/FSnTxcrekbvqrgdUxlJOMpijaKZVjAJrWrGs/6Jy8OMuyj9ow==}\n\n  esniff@2.0.1:\n    resolution: {integrity: sha512-kTUIGKQ/mDPFoJ0oVfcmyJn4iBDRptjNVIzwIFR7tqWXdVI9xfA2RMwY/gbSpJG3lkdWNEjLap/NqVHZiJsdfg==}\n    engines: {node: '>=0.10'}\n\n  etag@1.8.1:\n    resolution: {integrity: sha512-aIL5Fx7mawVa300al2BnEE4iNvo1qETxLrPI/o05L7z6go7fCw1J6EQmbK4FmJ2AS7kgVF/KEZWufBfdClMcPg==}\n    engines: {node: '>= 0.6'}\n\n  event-emitter@0.3.5:\n    resolution: {integrity: sha512-D9rRn9y7kLPnJ+hMq7S/nhvoKwwvVJahBi2BPmx3bvbsEdK3W9ii8cBSGjP+72/LnM4n6fo3+dkCX5FeTQruXA==}\n\n  eventemitter3@4.0.7:\n    resolution: {integrity: sha512-8guHBZCwKnFhYdHr2ysuRWErTwhoN2X8XELRlrRwpmfeY2jjuUN4taQMsULKUVo1K4DvZl+0pgfyoysHxvmvEw==}\n\n  express-fileupload@1.5.2:\n    resolution: {integrity: sha512-wxUJn2vTHvj/kZCVmc5/bJO15C7aSMyHeuXYY3geKpeKibaAoQGcEv5+sM6nHS2T7VF+QHS4hTWPiY2mKofEdg==}\n    engines: {node: '>=12.0.0'}\n\n  express-rate-limit@8.2.1:\n    resolution: {integrity: sha512-PCZEIEIxqwhzw4KF0n7QF4QqruVTcF73O5kFKUnGOyjbCCgizBBiFaYpd/fnBLUMPw/BWw9OsiN7GgrNYr7j6g==}\n    engines: {node: '>= 16'}\n    peerDependencies:\n      express: '>= 4.11'\n\n  express-session@1.18.2:\n    resolution: {integrity: sha512-SZjssGQC7TzTs9rpPDuUrR23GNZ9+2+IkA/+IJWmvQilTr5OSliEHGF+D9scbIpdC6yGtTI0/VhaHoVes2AN/A==}\n    engines: {node: '>= 0.8.0'}\n\n  express@4.21.2:\n    resolution: {integrity: sha512-28HqgMZAmih1Czt9ny7qr6ek2qddF4FclbMzwhCREB6OFfH+rXAnuNCwo1/wFvrtbgsQDb4kSbX9de9lFbrXnA==}\n    engines: {node: '>= 0.10.0'}\n\n  ext@1.7.0:\n    resolution: {integrity: sha512-6hxeJYaL110a9b5TEJSj0gojyHQAmA2ch5Os+ySCiA1QGdS697XWY1pzsrSjqA9LDEEgdB/KypIlR59RcLuHYw==}\n\n  fast-equals@5.3.3:\n    resolution: {integrity: sha512-/boTcHZeIAQ2r/tL11voclBHDeP9WPxLt+tyAbVSyyXuUFyh0Tne7gJZTqGbxnvj79TjLdCXLOY7UIPhyG5MTw==}\n    engines: {node: '>=6.0.0'}\n\n  fast-glob@3.3.3:\n    resolution: {integrity: sha512-7MptL8U0cqcFdzIzwOTHoilX9x5BrNqye7Z/LuC7kCMRio1EMSyqRK3BEAUD7sXRq4iT4AzTVuZdhgQ2TCvYLg==}\n    engines: {node: '>=8.6.0'}\n\n  fastq@1.19.1:\n    resolution: {integrity: sha512-GwLTyxkCXjXbxqIhTsMI2Nui8huMPtnxg7krajPJAjnEG/iiOS7i+zCtWGZR9G0NBKbXKh6X9m9UIsYX/N6vvQ==}\n\n  fill-range@7.1.1:\n    resolution: {integrity: sha512-YsGpe3WHLK8ZYi4tWDg2Jy3ebRz2rXowDxnld4bkQB00cc/1Zw9AWnC0i9ztDJitivtQvaI9KaLyKrc+hBW0yg==}\n    engines: {node: '>=8'}\n\n  finalhandler@1.3.1:\n    resolution: {integrity: sha512-6BN9trH7bp3qvnrRyzsBz+g3lZxTNZTbVO2EV1CS0WIcDbawYVdYvGflME/9QP0h0pYlCDBCTjYa9nZzMDpyxQ==}\n    engines: {node: '>= 0.8'}\n\n  foreground-child@3.3.1:\n    resolution: {integrity: sha512-gIXjKqtFuWEgzFRJA9WCQeSJLZDjgJUOMCMzxtvFq/37KojM1BFGufqsCy0r4qSQmYLsZYMeyRqzIWOMup03sw==}\n    engines: {node: '>=14'}\n\n  forwarded@0.2.0:\n    resolution: {integrity: sha512-buRG0fpBtRHSTCOASe6hD258tEubFoRLb4ZNA6NxMVHNw2gOcwHo9wyablzMzOA5z9xA9L1KNjk/Nt6MT9aYow==}\n    engines: {node: '>= 0.6'}\n\n  fraction.js@5.3.4:\n    resolution: {integrity: sha512-1X1NTtiJphryn/uLQz3whtY6jK3fTqoE3ohKs0tT+Ujr1W59oopxmoEh7Lu5p6vBaPbgoM0bzveAW4Qi5RyWDQ==}\n\n  framer-motion@11.18.2:\n    resolution: {integrity: sha512-5F5Och7wrvtLVElIpclDT0CBzMVg3dL22B64aZwHtsIY8RB4mXICLrkajK4G9R+ieSAGcgrLeae2SeUTg2pr6w==}\n    peerDependencies:\n      '@emotion/is-prop-valid': '*'\n      react: ^18.0.0 || ^19.0.0\n      react-dom: ^18.0.0 || ^19.0.0\n    peerDependenciesMeta:\n      '@emotion/is-prop-valid':\n        optional: true\n      react:\n        optional: true\n      react-dom:\n        optional: true\n\n  fresh@0.5.2:\n    resolution: {integrity: sha512-zJ2mQYM18rEFOudeV4GShTGIQ7RbzA7ozbU9I/XBpm7kqgMywgmylMwXHxZJmkVoYkna9d2pVXVXPdYTP9ej8Q==}\n    engines: {node: '>= 0.6'}\n\n  fsevents@2.3.3:\n    resolution: {integrity: sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==}\n    engines: {node: ^8.16.0 || ^10.6.0 || >=11.0.0}\n    os: [darwin]\n\n  function-bind@1.1.2:\n    resolution: {integrity: sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==}\n\n  gel@2.2.0:\n    resolution: {integrity: sha512-q0ma7z2swmoamHQusey8ayo8+ilVdzDt4WTxSPzq/yRqvucWRfymRVMvNgmSC0XK7eNjjEZEcplxpgaNojKdmQ==}\n    engines: {node: '>= 18.0.0'}\n    hasBin: true\n\n  gensync@1.0.0-beta.2:\n    resolution: {integrity: sha512-3hN7NaskYvMDLQY55gnW3NQ+mesEAepTqlg+VEbj7zzqEMBVNhzcGYYeqFo/TlYz6eQiFcp1HcsCZO+nGgS8zg==}\n    engines: {node: '>=6.9.0'}\n\n  get-intrinsic@1.3.0:\n    resolution: {integrity: sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==}\n    engines: {node: '>= 0.4'}\n\n  get-nonce@1.0.1:\n    resolution: {integrity: sha512-FJhYRoDaiatfEkUK8HKlicmu/3SGFD51q3itKDGoSTysQJBnfOcxU5GxnhE1E6soB76MbT0MBtnKJuXyAx+96Q==}\n    engines: {node: '>=6'}\n\n  get-proto@1.0.1:\n    resolution: {integrity: sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==}\n    engines: {node: '>= 0.4'}\n\n  get-tsconfig@4.13.0:\n    resolution: {integrity: sha512-1VKTZJCwBrvbd+Wn3AOgQP/2Av+TfTCOlE4AcRJE72W1ksZXbAx8PPBR9RzgTeSPzlPMHrbANMH3LbltH73wxQ==}\n\n  glob-parent@5.1.2:\n    resolution: {integrity: sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==}\n    engines: {node: '>= 6'}\n\n  glob-parent@6.0.2:\n    resolution: {integrity: sha512-XxwI8EOhVQgWp6iDL+3b0r86f4d6AX6zSU55HfB4ydCEuXLXc5FcYeOu+nnGftS4TEju/11rt4KJPTMgbfmv4A==}\n    engines: {node: '>=10.13.0'}\n\n  glob@10.5.0:\n    resolution: {integrity: sha512-DfXN8DfhJ7NH3Oe7cFmu3NCu1wKbkReJ8TorzSAFbSKrlNaQSKfIzqYqVY8zlbs2NLBbWpRiU52GX2PbaBVNkg==}\n    hasBin: true\n\n  gopd@1.2.0:\n    resolution: {integrity: sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==}\n    engines: {node: '>= 0.4'}\n\n  graceful-fs@4.2.11:\n    resolution: {integrity: sha512-RbJ5/jmFcNNCcDV5o9eTnBLJ/HszWV0P73bc+Ff4nS/rJj+YaS6IGyiOL0VoBYX+l1Wrl3k63h/KrH+nhJ0XvQ==}\n\n  has-symbols@1.1.0:\n    resolution: {integrity: sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==}\n    engines: {node: '>= 0.4'}\n\n  hasown@2.0.2:\n    resolution: {integrity: sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==}\n    engines: {node: '>= 0.4'}\n\n  http-errors@2.0.0:\n    resolution: {integrity: sha512-FtwrG/euBzaEjYeRqOgly7G0qviiXoJWnvEH2Z1plBdXgbyjv34pHTSb9zoeHMyDy33+DWy5Wt9Wo+TURtOYSQ==}\n    engines: {node: '>= 0.8'}\n\n  iconv-lite@0.4.24:\n    resolution: {integrity: sha512-v3MXnZAcvnywkTUEZomIActle7RXXeedOR31wwl7VlyoXO4Qi9arvSenNQWne1TcRwhCL1HwLI21bEqdpj8/rA==}\n    engines: {node: '>=0.10.0'}\n\n  inherits@2.0.4:\n    resolution: {integrity: sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==}\n\n  input-otp@1.4.2:\n    resolution: {integrity: sha512-l3jWwYNvrEa6NTCt7BECfCm48GvwuZzkoeG3gBL2w4CHeOXW3eKFmf9UNYkNfYc3mxMrthMnxjIE07MT0zLBQA==}\n    peerDependencies:\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0.0 || ^19.0.0-rc\n\n  internmap@2.0.3:\n    resolution: {integrity: sha512-5Hh7Y1wQbvY5ooGgPbDaL5iYLAPzMTUrjMulskHLH6wnv/A+1q5rgEaiuqEjB+oxGXIVZs1FF+R/KPN3ZSQYYg==}\n    engines: {node: '>=12'}\n\n  ip-address@10.0.1:\n    resolution: {integrity: sha512-NWv9YLW4PoW2B7xtzaS3NCot75m6nK7Icdv0o3lfMceJVRfSoQwqD4wEH5rLwoKJwUiZ/rfpiVBhnaF0FK4HoA==}\n    engines: {node: '>= 12'}\n\n  ipaddr.js@1.9.1:\n    resolution: {integrity: sha512-0KI/607xoxSToH7GjN1FfSbLoU0+btTicjsQSWQlh/hZykN8KpmMf7uYwPW3R+akZ6R/w18ZlXSHBYXiYUPO3g==}\n    engines: {node: '>= 0.10'}\n\n  is-binary-path@2.1.0:\n    resolution: {integrity: sha512-ZMERYes6pDydyuGidse7OsHxtbI7WVeUEozgR/g7rd0xUimYNlvZRE/K2MgZTjWy725IfelLeVcEM97mmtRGXw==}\n    engines: {node: '>=8'}\n\n  is-core-module@2.16.1:\n    resolution: {integrity: sha512-UfoeMA6fIJ8wTYFEUjelnaGI67v6+N7qXJEvQuIGa99l4xsCruSYOVSQ0uPANn4dAzm8lkYPaKLrrijLq7x23w==}\n    engines: {node: '>= 0.4'}\n\n  is-extglob@2.1.1:\n    resolution: {integrity: sha512-SbKbANkN603Vi4jEZv49LeVJMn4yGwsbzZworEoyEiutsN3nJYdbO36zfhGJ6QEDpOZIFkDtnq5JRxmvl3jsoQ==}\n    engines: {node: '>=0.10.0'}\n\n  is-fullwidth-code-point@3.0.0:\n    resolution: {integrity: sha512-zymm5+u+sCsSWyD9qNaejV3DFvhCKclKdizYaJUuHA83RLjb7nSuGnddCHGv0hk+KY7BMAlsWeK4Ueg6EV6XQg==}\n    engines: {node: '>=8'}\n\n  is-glob@4.0.3:\n    resolution: {integrity: sha512-xelSayHH36ZgE7ZWhli7pW34hNbNl8Ojv5KVmkJD4hBdD3th8Tfk9vYasLM+mXWOZhFkgZfxhLSnrwRr4elSSg==}\n    engines: {node: '>=0.10.0'}\n\n  is-number@7.0.0:\n    resolution: {integrity: sha512-41Cifkg6e8TylSpdtTpeLVMqvSBEVzTttHvERD741+pnZ8ANv0004MRL43QKPDlK9cGvNp6NZWZUBlbGXYxxng==}\n    engines: {node: '>=0.12.0'}\n\n  is-promise@2.2.2:\n    resolution: {integrity: sha512-+lP4/6lKUBfQjZ2pdxThZvLUAafmZb8OAxFb8XXtiQmS35INgr85hdOGoEs124ez1FCnZJt6jau/T+alh58QFQ==}\n\n  isexe@2.0.0:\n    resolution: {integrity: sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==}\n\n  isexe@3.1.1:\n    resolution: {integrity: sha512-LpB/54B+/2J5hqQ7imZHfdU31OlgQqx7ZicVlkm9kzg9/w8GKLEcFfJl/t7DCEDueOyBAD6zCCwTO6Fzs0NoEQ==}\n    engines: {node: '>=16'}\n\n  jackspeak@3.4.3:\n    resolution: {integrity: sha512-OGlZQpz2yfahA/Rd1Y8Cd9SIEsqvXkLVoSw/cgwhnhFMDbsQFeZYoJJ7bIZBS9BcamUW96asq/npPWugM+RQBw==}\n\n  jiti@1.21.7:\n    resolution: {integrity: sha512-/imKNG4EbWNrVjoNC/1H5/9GFy+tqjGBHCaSsN+P2RnPqjsLmv6UD3Ej+Kj8nBWaRAwyk7kK5ZUc+OEatnTR3A==}\n    hasBin: true\n\n  jiti@2.6.1:\n    resolution: {integrity: sha512-ekilCSN1jwRvIbgeg/57YFh8qQDNbwDb9xT/qu2DAHbFFZUicIl4ygVaAvzveMhMVr3LnpSKTNnwt8PoOfmKhQ==}\n    hasBin: true\n\n  jose@6.1.2:\n    resolution: {integrity: sha512-MpcPtHLE5EmztuFIqB0vzHAWJPpmN1E6L4oo+kze56LIs3MyXIj9ZHMDxqOvkP38gBR7K1v3jqd4WU2+nrfONQ==}\n\n  js-tokens@4.0.0:\n    resolution: {integrity: sha512-RdJUflcE3cUzKiMqQgsCu06FPu9UdIJO0beYbPhHN4k6apgJtifcoCtT9bcxOpYBtpD2kCM6Sbzg4CausW/PKQ==}\n\n  jsesc@3.1.0:\n    resolution: {integrity: sha512-/sM3dO2FOzXjKQhJuo0Q173wf2KOo8t4I8vHy6lF9poUp7bKT0/NHE8fPX23PwfhnykfqnC2xRxOnVw5XuGIaA==}\n    engines: {node: '>=6'}\n    hasBin: true\n\n  json5@2.2.3:\n    resolution: {integrity: sha512-XmOWe7eyHYH14cLdVPoyg+GOH3rYX++KpzrylJwSW98t3Nk+U8XOl8FWKOgwtzdb8lXGf6zYwDUzeHMWfxasyg==}\n    engines: {node: '>=6'}\n    hasBin: true\n\n  lightningcss-android-arm64@1.30.2:\n    resolution: {integrity: sha512-BH9sEdOCahSgmkVhBLeU7Hc9DWeZ1Eb6wNS6Da8igvUwAe0sqROHddIlvU06q3WyXVEOYDZ6ykBZQnjTbmo4+A==}\n    engines: {node: '>= 12.0.0'}\n    cpu: [arm64]\n    os: [android]\n\n  lightningcss-darwin-arm64@1.30.2:\n    resolution: {integrity: sha512-ylTcDJBN3Hp21TdhRT5zBOIi73P6/W0qwvlFEk22fkdXchtNTOU4Qc37SkzV+EKYxLouZ6M4LG9NfZ1qkhhBWA==}\n    engines: {node: '>= 12.0.0'}\n    cpu: [arm64]\n    os: [darwin]\n\n  lightningcss-darwin-x64@1.30.2:\n    resolution: {integrity: sha512-oBZgKchomuDYxr7ilwLcyms6BCyLn0z8J0+ZZmfpjwg9fRVZIR5/GMXd7r9RH94iDhld3UmSjBM6nXWM2TfZTQ==}\n    engines: {node: '>= 12.0.0'}\n    cpu: [x64]\n    os: [darwin]\n\n  lightningcss-freebsd-x64@1.30.2:\n    resolution: {integrity: sha512-c2bH6xTrf4BDpK8MoGG4Bd6zAMZDAXS569UxCAGcA7IKbHNMlhGQ89eRmvpIUGfKWNVdbhSbkQaWhEoMGmGslA==}\n    engines: {node: '>= 12.0.0'}\n    cpu: [x64]\n    os: [freebsd]\n\n  lightningcss-linux-arm-gnueabihf@1.30.2:\n    resolution: {integrity: sha512-eVdpxh4wYcm0PofJIZVuYuLiqBIakQ9uFZmipf6LF/HRj5Bgm0eb3qL/mr1smyXIS1twwOxNWndd8z0E374hiA==}\n    engines: {node: '>= 12.0.0'}\n    cpu: [arm]\n    os: [linux]\n\n  lightningcss-linux-arm64-gnu@1.30.2:\n    resolution: {integrity: sha512-UK65WJAbwIJbiBFXpxrbTNArtfuznvxAJw4Q2ZGlU8kPeDIWEX1dg3rn2veBVUylA2Ezg89ktszWbaQnxD/e3A==}\n    engines: {node: '>= 12.0.0'}\n    cpu: [arm64]\n    os: [linux]\n\n  lightningcss-linux-arm64-musl@1.30.2:\n    resolution: {integrity: sha512-5Vh9dGeblpTxWHpOx8iauV02popZDsCYMPIgiuw97OJ5uaDsL86cnqSFs5LZkG3ghHoX5isLgWzMs+eD1YzrnA==}\n    engines: {node: '>= 12.0.0'}\n    cpu: [arm64]\n    os: [linux]\n\n  lightningcss-linux-x64-gnu@1.30.2:\n    resolution: {integrity: sha512-Cfd46gdmj1vQ+lR6VRTTadNHu6ALuw2pKR9lYq4FnhvgBc4zWY1EtZcAc6EffShbb1MFrIPfLDXD6Xprbnni4w==}\n    engines: {node: '>= 12.0.0'}\n    cpu: [x64]\n    os: [linux]\n\n  lightningcss-linux-x64-musl@1.30.2:\n    resolution: {integrity: sha512-XJaLUUFXb6/QG2lGIW6aIk6jKdtjtcffUT0NKvIqhSBY3hh9Ch+1LCeH80dR9q9LBjG3ewbDjnumefsLsP6aiA==}\n    engines: {node: '>= 12.0.0'}\n    cpu: [x64]\n    os: [linux]\n\n  lightningcss-win32-arm64-msvc@1.30.2:\n    resolution: {integrity: sha512-FZn+vaj7zLv//D/192WFFVA0RgHawIcHqLX9xuWiQt7P0PtdFEVaxgF9rjM/IRYHQXNnk61/H/gb2Ei+kUQ4xQ==}\n    engines: {node: '>= 12.0.0'}\n    cpu: [arm64]\n    os: [win32]\n\n  lightningcss-win32-x64-msvc@1.30.2:\n    resolution: {integrity: sha512-5g1yc73p+iAkid5phb4oVFMB45417DkRevRbt/El/gKXJk4jid+vPFF/AXbxn05Aky8PapwzZrdJShv5C0avjw==}\n    engines: {node: '>= 12.0.0'}\n    cpu: [x64]\n    os: [win32]\n\n  lightningcss@1.30.2:\n    resolution: {integrity: sha512-utfs7Pr5uJyyvDETitgsaqSyjCb2qNRAtuqUeWIAKztsOYdcACf2KtARYXg2pSvhkt+9NfoaNY7fxjl6nuMjIQ==}\n    engines: {node: '>= 12.0.0'}\n\n  lilconfig@3.1.3:\n    resolution: {integrity: sha512-/vlFKAoH5Cgt3Ie+JLhRbwOsCQePABiU3tJ1egGvyQ+33R/vcwM2Zl2QR/LzjsBeItPt3oSVXapn+m4nQDvpzw==}\n    engines: {node: '>=14'}\n\n  lines-and-columns@1.2.4:\n    resolution: {integrity: sha512-7ylylesZQ/PV29jhEDl3Ufjo6ZX7gCqJr5F7PKrqc93v7fzSymt1BpwEU8nAUXs8qzzvqhbjhK5QZg6Mt/HkBg==}\n\n  lodash@4.17.21:\n    resolution: {integrity: sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==}\n\n  loose-envify@1.4.0:\n    resolution: {integrity: sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==}\n    hasBin: true\n\n  lru-cache@10.4.3:\n    resolution: {integrity: sha512-JNAzZcXrCt42VGLuYz0zfAzDfAvJWW6AfYlDBQyDV5DClI2m5sAmK+OIO7s59XfsRsWHp02jAJrRadPRGTt6SQ==}\n\n  lru-cache@4.1.5:\n    resolution: {integrity: sha512-sWZlbEP2OsHNkXrMl5GYk/jKk70MBng6UU4YI/qGDYbgf6YbP4EvmqISbXCoJiRKs+1bSpFHVgQxvJ17F2li5g==}\n\n  lru-cache@5.1.1:\n    resolution: {integrity: sha512-KpNARQA3Iwv+jTA0utUVVbrh+Jlrr1Fv0e56GGzAFOXN7dk/FviaDW8LHmK52DlcH4WP2n6gI8vN1aesBFgo9w==}\n\n  lru-queue@0.1.0:\n    resolution: {integrity: sha512-BpdYkt9EvGl8OfWHDQPISVpcl5xZthb+XPsbELj5AQXxIC8IriDZIQYjBJPEm5rS420sjZ0TLEzRcq5KdBhYrQ==}\n\n  lucide-react@0.453.0:\n    resolution: {integrity: sha512-kL+RGZCcJi9BvJtzg2kshO192Ddy9hv3ij+cPrVPWSRzgCWCVazoQJxOjAwgK53NomL07HB7GPHW120FimjNhQ==}\n    peerDependencies:\n      react: ^16.5.1 || ^17.0.0 || ^18.0.0 || ^19.0.0-rc\n\n  magic-string@0.30.21:\n    resolution: {integrity: sha512-vd2F4YUyEXKGcLHoq+TEyCjxueSeHnFxyyjNp80yg0XV4vUhnDer/lvvlqM/arB5bXQN5K2/3oinyCRyx8T2CQ==}\n\n  make-error@1.3.6:\n    resolution: {integrity: sha512-s8UhlNe7vPKomQhC1qFelMokr/Sc3AgNbso3n74mVPA5LTZwkB9NlXf4XPamLxJE8h0gh73rM94xvwRT2CVInw==}\n\n  math-intrinsics@1.1.0:\n    resolution: {integrity: sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==}\n    engines: {node: '>= 0.4'}\n\n  media-typer@0.3.0:\n    resolution: {integrity: sha512-dq+qelQ9akHpcOl/gUVRTxVIOkAJ1wR3QAvb4RsVjS8oVoFjDGTc679wJYmUmknUF5HwMLOgb5O+a3KxfWapPQ==}\n    engines: {node: '>= 0.6'}\n\n  memoizee@0.4.17:\n    resolution: {integrity: sha512-DGqD7Hjpi/1or4F/aYAspXKNm5Yili0QDAFAY4QYvpqpgiY6+1jOfqpmByzjxbWd/T9mChbCArXAbDAsTm5oXA==}\n    engines: {node: '>=0.12'}\n\n  memorystore@1.6.7:\n    resolution: {integrity: sha512-OZnmNY/NDrKohPQ+hxp0muBcBKrzKNtHr55DbqSx9hLsYVNnomSAMRAtI7R64t3gf3ID7tHQA7mG4oL3Hu9hdw==}\n    engines: {node: '>=0.10'}\n\n  merge-descriptors@1.0.3:\n    resolution: {integrity: sha512-gaNvAS7TZ897/rVaZ0nMtAyxNyi/pdbjbAwUpFQpN70GqnVfOiXpeUUMKRBmzXaSQ8DdTX4/0ms62r2K+hE6mQ==}\n\n  merge2@1.4.1:\n    resolution: {integrity: sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==}\n    engines: {node: '>= 8'}\n\n  methods@1.1.2:\n    resolution: {integrity: sha512-iclAHeNqNm68zFtnZ0e+1L2yUIdvzNoauKU4WBA3VvH/vPFieF7qfRlwUZU+DA9P9bPXIS90ulxoUoCH23sV2w==}\n    engines: {node: '>= 0.6'}\n\n  micromatch@4.0.8:\n    resolution: {integrity: sha512-PXwfBhYu0hBCPw8Dn0E+WDYb7af3dSLVWKi3HGv84IdF4TyFoC0ysxFd0Goxw7nSv4T/PzEJQxsYsEiFCKo2BA==}\n    engines: {node: '>=8.6'}\n\n  mime-db@1.52.0:\n    resolution: {integrity: sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==}\n    engines: {node: '>= 0.6'}\n\n  mime-types@2.1.35:\n    resolution: {integrity: sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==}\n    engines: {node: '>= 0.6'}\n\n  mime@1.6.0:\n    resolution: {integrity: sha512-x0Vn8spI+wuJ1O6S7gnbaQg8Pxh4NNHb7KSINmEWKiPE4RKOplvijn+NkmYmmRgP68mc70j2EbeTFRsrswaQeg==}\n    engines: {node: '>=4'}\n    hasBin: true\n\n  minimatch@9.0.5:\n    resolution: {integrity: sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==}\n    engines: {node: '>=16 || 14 >=14.17'}\n\n  minimist@1.2.8:\n    resolution: {integrity: sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==}\n\n  minipass@7.1.2:\n    resolution: {integrity: sha512-qOOzS1cBTWYF4BH8fVePDBOO9iptMnGUEZwNc/cMWnTV2nVLZ7VoNWEPHkYczZA0pdoA7dl6e7FL659nX9S2aw==}\n    engines: {node: '>=16 || 14 >=14.17'}\n\n  mitt@3.0.1:\n    resolution: {integrity: sha512-vKivATfr97l2/QBCYAkXYDbrIWPM2IIKEl7YPhjCvKlG3kE2gm+uBo6nEXK3M5/Ffh/FLpKExzOQ3JJoJGFKBw==}\n\n  mkdirp@0.5.6:\n    resolution: {integrity: sha512-FP+p8RB8OWpF3YZBCrP5gtADmtXApB5AMLn+vdyA+PyxCjrCs00mjyUozssO33cwDeT3wNGdLxJ5M//YqtHAJw==}\n    hasBin: true\n\n  modern-screenshot@4.6.7:\n    resolution: {integrity: sha512-0GhgI6i6le4AhKzCvLYjwEmsP47kTsX45iT5yuAzsLTi/7i3Rjxe8fbH2VjGJLuyOThwsa0CdQAPd4auoEtsZg==}\n\n  motion-dom@11.18.1:\n    resolution: {integrity: sha512-g76KvA001z+atjfxczdRtw/RXOM3OMSdd1f4DL77qCTF/+avrRJiawSG4yDibEQ215sr9kpinSlX2pCTJ9zbhw==}\n\n  motion-utils@11.18.1:\n    resolution: {integrity: sha512-49Kt+HKjtbJKLtgO/LKj9Ld+6vw9BjH5d9sc40R/kVyH8GLAXgT42M2NnuPcJNuA3s9ZfZBUcwIgpmZWGEE+hA==}\n\n  ms@2.0.0:\n    resolution: {integrity: sha512-Tpp60P6IUJDTuOq/5Z8cdskzJujfwqfOTkrwIwj7IRISpnkJnT6SyJ4PCPnGMoFjC9ddhal5KVIYtAt97ix05A==}\n\n  ms@2.1.3:\n    resolution: {integrity: sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==}\n\n  multer@2.0.2:\n    resolution: {integrity: sha512-u7f2xaZ/UG8oLXHvtF/oWTRvT44p9ecwBBqTwgJVq0+4BW1g8OW01TyMEGWBHbyMOYVHXslaut7qEQ1meATXgw==}\n    engines: {node: '>= 10.16.0'}\n\n  mz@2.7.0:\n    resolution: {integrity: sha512-z81GNO7nnYMEhrGh9LeymoE4+Yr0Wn5McHIZMK5cfQCl+NDX08sCZgUc9/6MHni9IWuFLm1Z3HTCXu2z9fN62Q==}\n\n  nanoid@3.3.11:\n    resolution: {integrity: sha512-N8SpfPUnUp1bK+PMYW8qSWdl9U+wwNWI4QKxOYDy9JAro3WMX7p2OeVRF9v+347pnakNevPmiHhNmZ2HbFA76w==}\n    engines: {node: ^10 || ^12 || ^13.7 || ^14 || >=15.0.1}\n    hasBin: true\n\n  nanoid@5.1.6:\n    resolution: {integrity: sha512-c7+7RQ+dMB5dPwwCp4ee1/iV/q2P6aK1mTZcfr1BTuVlyW9hJYiMPybJCcnBlQtuSmTIWNeazm/zqNoZSSElBg==}\n    engines: {node: ^18 || >=20}\n    hasBin: true\n\n  negotiator@0.6.3:\n    resolution: {integrity: sha512-+EUsqGPLsM+j/zdChZjsnX51g4XrHFOIXwfnCVPGlQk/k5giakcKsuxCObBRu6DSm9opw/O6slWbJdghQM4bBg==}\n    engines: {node: '>= 0.6'}\n\n  next-tick@1.1.0:\n    resolution: {integrity: sha512-CXdUiJembsNjuToQvxayPZF9Vqht7hewsvy2sOWafLvi2awflj9mOC6bHIg50orX8IJvWKY9wYQ/zB2kogPslQ==}\n\n  node-addon-api@8.5.0:\n    resolution: {integrity: sha512-/bRZty2mXUIFY/xU5HLvveNHlswNJej+RnxBjOMkidWfwZzgTbPG1E3K5TOxRLOR+5hX7bSofy8yf1hZevMS8A==}\n    engines: {node: ^18 || ^20 || >= 21}\n\n  node-gyp-build@4.8.4:\n    resolution: {integrity: sha512-LA4ZjwlnUblHVgq0oBF3Jl/6h/Nvs5fzBLwdEF4nuxnFdsfajde4WfxtJr3CaiH+F6ewcIB/q4jQ4UzPyid+CQ==}\n    hasBin: true\n\n  node-releases@2.0.27:\n    resolution: {integrity: sha512-nmh3lCkYZ3grZvqcCH+fjmQ7X+H0OeZgP40OierEaAptX4XofMh5kwNbWh7lBduUzCcV/8kZ+NDLCwm2iorIlA==}\n\n  normalize-path@3.0.0:\n    resolution: {integrity: sha512-6eZs5Ls3WtCisHWp9S2GUy8dqkpGi4BVSz3GaqiE6ezub0512ESztXUwUB6C6IKbQkY2Pnb/mD4WYojCRwcwLA==}\n    engines: {node: '>=0.10.0'}\n\n  normalize-range@0.1.2:\n    resolution: {integrity: sha512-bdok/XvKII3nUpklnV6P2hxtMNrCboOjAcyBuQnWEhO665FwrSNRxU+AqpsyvO6LgGYPspN+lu5CLtw4jPRKNA==}\n    engines: {node: '>=0.10.0'}\n\n  oauth4webapi@3.8.2:\n    resolution: {integrity: sha512-FzZZ+bht5X0FKe7Mwz3DAVAmlH1BV5blSak/lHMBKz0/EBMhX6B10GlQYI51+oRp8ObJaX0g6pXrAxZh5s8rjw==}\n\n  object-assign@4.1.1:\n    resolution: {integrity: sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==}\n    engines: {node: '>=0.10.0'}\n\n  object-hash@3.0.0:\n    resolution: {integrity: sha512-RSn9F68PjH9HqtltsSnqYC1XXoWe9Bju5+213R98cNGttag9q9yAOTzdbsqvIa7aNm5WffBZFpWYr2aWrklWAw==}\n    engines: {node: '>= 6'}\n\n  object-inspect@1.13.4:\n    resolution: {integrity: sha512-W67iLl4J2EXEGTbfeHCffrjDfitvLANg0UlX3wFUUSTx92KXRFegMHUVgSqE+wvhAbi4WqjGg9czysTV2Epbew==}\n    engines: {node: '>= 0.4'}\n\n  obuf@1.1.2:\n    resolution: {integrity: sha512-PX1wu0AmAdPqOL1mWhqmlOd8kOIZQwGZw6rh7uby9fTc5lhaOWFLX3I6R1hrF9k3zUY40e6igsLGkDXK92LJNg==}\n\n  on-finished@2.4.1:\n    resolution: {integrity: sha512-oVlzkg3ENAhCk2zdv7IJwd/QUD4z2RxRwpkcGY8psCVcCYZNq4wYnVWALHM+brtuJjePWiYF/ClmuDr8Ch5+kg==}\n    engines: {node: '>= 0.8'}\n\n  on-headers@1.1.0:\n    resolution: {integrity: sha512-737ZY3yNnXy37FHkQxPzt4UZ2UWPWiCZWLvFZ4fu5cueciegX0zGPnrlY6bwRg4FdQOe9YU8MkmJwGhoMybl8A==}\n    engines: {node: '>= 0.8'}\n\n  openid-client@6.8.1:\n    resolution: {integrity: sha512-VoYT6enBo6Vj2j3Q5Ec0AezS+9YGzQo1f5Xc42lreMGlfP4ljiXPKVDvCADh+XHCV/bqPu/wWSiCVXbJKvrODw==}\n\n  package-json-from-dist@1.0.1:\n    resolution: {integrity: sha512-UEZIS3/by4OC8vL3P2dTXRETpebLI2NiI5vIrjaD/5UtrkFX/tNbwjTSRAGC/+7CAo2pIcBaRgWmcBBHcsaCIw==}\n\n  parseurl@1.3.3:\n    resolution: {integrity: sha512-CiyeOxFT/JZyN5m0z9PfXw4SCBJ6Sygz1Dpl0wqjlhDEGGBP1GnsUVEL0p63hoG1fcj3fHynXi9NYO4nWOL+qQ==}\n    engines: {node: '>= 0.8'}\n\n  passport-local@1.0.0:\n    resolution: {integrity: sha512-9wCE6qKznvf9mQYYbgJ3sVOHmCWoUNMVFoZzNoznmISbhnNNPhN9xfY3sLmScHMetEJeoY7CXwfhCe7argfQow==}\n    engines: {node: '>= 0.4.0'}\n\n  passport-strategy@1.0.0:\n    resolution: {integrity: sha512-CB97UUvDKJde2V0KDWWB3lyf6PC3FaZP7YxZ2G8OAtn9p4HI9j9JLP9qjOGZFvyl8uwNT8qM+hGnz/n16NI7oA==}\n    engines: {node: '>= 0.4.0'}\n\n  passport@0.7.0:\n    resolution: {integrity: sha512-cPLl+qZpSc+ireUvt+IzqbED1cHHkDoVYMo30jbJIdOOjQ1MQYZBPiNvmi8UM6lJuOpTPXJGZQk0DtC4y61MYQ==}\n    engines: {node: '>= 0.4.0'}\n\n  path-key@3.1.1:\n    resolution: {integrity: sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==}\n    engines: {node: '>=8'}\n\n  path-parse@1.0.7:\n    resolution: {integrity: sha512-LDJzPVEEEPR+y48z93A0Ed0yXb8pAByGWo/k5YYdYgpY2/2EsOsksJrq7lOHxryrVOn1ejG6oAp8ahvOIQD8sw==}\n\n  path-scurry@1.11.1:\n    resolution: {integrity: sha512-Xa4Nw17FS9ApQFJ9umLiJS4orGjm7ZzwUrwamcGQuHSzDyth9boKDaycYdDcZDuqYATXw4HFXgaqWTctW/v1HA==}\n    engines: {node: '>=16 || 14 >=14.18'}\n\n  path-to-regexp@0.1.12:\n    resolution: {integrity: sha512-RA1GjUVMnvYFxuqovrEqZoxxW5NUZqbwKtYz/Tt7nXerk0LbLblQmrsgdeOxV5SFHf0UDggjS/bSeOZwt1pmEQ==}\n\n  pause@0.0.1:\n    resolution: {integrity: sha512-KG8UEiEVkR3wGEb4m5yZkVCzigAD+cVEJck2CzYZO37ZGJfctvVptVO192MwrtPhzONn6go8ylnOdMhKqi4nfg==}\n\n  pg-cloudflare@1.2.7:\n    resolution: {integrity: sha512-YgCtzMH0ptvZJslLM1ffsY4EuGaU0cx4XSdXLRFae8bPP4dS5xL1tNB3k2o/N64cHJpwU7dxKli/nZ2lUa5fLg==}\n\n  pg-connection-string@2.9.1:\n    resolution: {integrity: sha512-nkc6NpDcvPVpZXxrreI/FOtX3XemeLl8E0qFr6F2Lrm/I8WOnaWNhIPK2Z7OHpw7gh5XJThi6j6ppgNoaT1w4w==}\n\n  pg-int8@1.0.1:\n    resolution: {integrity: sha512-WCtabS6t3c8SkpDBUlb1kjOs7l66xsGdKpIPZsg4wR+B3+u9UAum2odSsF9tnvxg80h4ZxLWMy4pRjOsFIqQpw==}\n    engines: {node: '>=4.0.0'}\n\n  pg-numeric@1.0.2:\n    resolution: {integrity: sha512-BM/Thnrw5jm2kKLE5uJkXqqExRUY/toLHda65XgFTBTFYZyopbKjBe29Ii3RbkvlsMoFwD+tHeGaCjjv0gHlyw==}\n    engines: {node: '>=4'}\n\n  pg-pool@3.10.1:\n    resolution: {integrity: sha512-Tu8jMlcX+9d8+QVzKIvM/uJtp07PKr82IUOYEphaWcoBhIYkoHpLXN3qO59nAI11ripznDsEzEv8nUxBVWajGg==}\n    peerDependencies:\n      pg: '>=8.0'\n\n  pg-protocol@1.10.3:\n    resolution: {integrity: sha512-6DIBgBQaTKDJyxnXaLiLR8wBpQQcGWuAESkRBX/t6OwA8YsqP+iVSiond2EDy6Y/dsGk8rh/jtax3js5NeV7JQ==}\n\n  pg-types@2.2.0:\n    resolution: {integrity: sha512-qTAAlrEsl8s4OiEQY69wDvcMIdQN6wdz5ojQiOy6YRMuynxenON0O5oCpJI6lshc6scgAY8qvJ2On/p+CXY0GA==}\n    engines: {node: '>=4'}\n\n  pg-types@4.1.0:\n    resolution: {integrity: sha512-o2XFanIMy/3+mThw69O8d4n1E5zsLhdO+OPqswezu7Z5ekP4hYDqlDjlmOpYMbzY2Br0ufCwJLdDIXeNVwcWFg==}\n    engines: {node: '>=10'}\n\n  pg@8.16.3:\n    resolution: {integrity: sha512-enxc1h0jA/aq5oSDMvqyW3q89ra6XIIDZgCX9vkMrnz5DFTw/Ny3Li2lFQ+pt3L6MCgm/5o2o8HW9hiJji+xvw==}\n    engines: {node: '>= 16.0.0'}\n    peerDependencies:\n      pg-native: '>=3.0.1'\n    peerDependenciesMeta:\n      pg-native:\n        optional: true\n\n  pgpass@1.0.5:\n    resolution: {integrity: sha512-FdW9r/jQZhSeohs1Z3sI1yxFQNFvMcnmfuj4WBMUTxOrAyLMaTcE1aAMBiTlbMNaXvBCQuVi0R7hd8udDSP7ug==}\n\n  picocolors@1.1.1:\n    resolution: {integrity: sha512-xceH2snhtb5M9liqDsmEw56le376mTZkEX/jEb/RxNFyegNul7eNslCXP9FDj/Lcu0X8KEyMceP2ntpaHrDEVA==}\n\n  picomatch@2.3.1:\n    resolution: {integrity: sha512-JU3teHTNjmE2VCGFzuY8EXzCDVwEqB2a8fsIvwaStHhAWJEeVd1o1QD80CU6+ZdEXXSLbSsuLwJjkCBWqRQUVA==}\n    engines: {node: '>=8.6'}\n\n  pify@2.3.0:\n    resolution: {integrity: sha512-udgsAY+fTnvv7kI7aaxbqwWNb0AHiB0qBO89PZKPkoTmGOgdbrHDKD+0B2X4uTfJ/FT1R09r9gTsjUjNJotuog==}\n    engines: {node: '>=0.10.0'}\n\n  pirates@4.0.7:\n    resolution: {integrity: sha512-TfySrs/5nm8fQJDcBDuUng3VOUKsd7S+zqvbOTiGXHfxX4wK31ard+hoNuvkicM/2YFzlpDgABOevKSsB4G/FA==}\n    engines: {node: '>= 6'}\n\n  postcss-import@15.1.0:\n    resolution: {integrity: sha512-hpr+J05B2FVYUAXHeK1YyI267J/dDDhMU6B6civm8hSY1jYJnBXxzKDKDswzJmtLHryrjhnDjqqp/49t8FALew==}\n    engines: {node: '>=14.0.0'}\n    peerDependencies:\n      postcss: ^8.0.0\n\n  postcss-js@4.1.0:\n    resolution: {integrity: sha512-oIAOTqgIo7q2EOwbhb8UalYePMvYoIeRY2YKntdpFQXNosSu3vLrniGgmH9OKs/qAkfoj5oB3le/7mINW1LCfw==}\n    engines: {node: ^12 || ^14 || >= 16}\n    peerDependencies:\n      postcss: ^8.4.21\n\n  postcss-load-config@6.0.1:\n    resolution: {integrity: sha512-oPtTM4oerL+UXmx+93ytZVN82RrlY/wPUV8IeDxFrzIjXOLF1pN+EmKPLbubvKHT2HC20xXsCAH2Z+CKV6Oz/g==}\n    engines: {node: '>= 18'}\n    peerDependencies:\n      jiti: '>=1.21.0'\n      postcss: '>=8.0.9'\n      tsx: ^4.8.1\n      yaml: ^2.4.2\n    peerDependenciesMeta:\n      jiti:\n        optional: true\n      postcss:\n        optional: true\n      tsx:\n        optional: true\n      yaml:\n        optional: true\n\n  postcss-nested@6.2.0:\n    resolution: {integrity: sha512-HQbt28KulC5AJzG+cZtj9kvKB93CFCdLvog1WFLf1D+xmMvPGlBstkpTEZfK5+AN9hfJocyBFCNiqyS48bpgzQ==}\n    engines: {node: '>=12.0'}\n    peerDependencies:\n      postcss: ^8.2.14\n\n  postcss-selector-parser@6.0.10:\n    resolution: {integrity: sha512-IQ7TZdoaqbT+LCpShg46jnZVlhWD2w6iQYAcYXfHARZ7X1t/UGhhceQDs5X0cGqKvYlHNOuv7Oa1xmb0oQuA3w==}\n    engines: {node: '>=4'}\n\n  postcss-selector-parser@6.1.2:\n    resolution: {integrity: sha512-Q8qQfPiZ+THO/3ZrOrO0cJJKfpYCagtMUkXbnEfmgUjwXg6z/WBeOyS9APBBPCTSiDV+s4SwQGu8yFsiMRIudg==}\n    engines: {node: '>=4'}\n\n  postcss-value-parser@4.2.0:\n    resolution: {integrity: sha512-1NNCs6uurfkVbeXG4S8JFT9t19m45ICnif8zWLd5oPSZ50QnwMfK+H3jv408d4jw/7Bttv5axS5IiHoLaVNHeQ==}\n\n  postcss@8.5.6:\n    resolution: {integrity: sha512-3Ybi1tAuwAP9s0r1UQ2J4n5Y0G05bJkpUIO0/bI9MhwmD70S5aTWbXGBwxHrelT+XM1k6dM0pk+SwNkpTRN7Pg==}\n    engines: {node: ^10 || ^12 || >=14}\n\n  postgres-array@2.0.0:\n    resolution: {integrity: sha512-VpZrUqU5A69eQyW2c5CA1jtLecCsN2U/bD6VilrFDWq5+5UIEVO7nazS3TEcHf1zuPYO/sqGvUvW62g86RXZuA==}\n    engines: {node: '>=4'}\n\n  postgres-array@3.0.4:\n    resolution: {integrity: sha512-nAUSGfSDGOaOAEGwqsRY27GPOea7CNipJPOA7lPbdEpx5Kg3qzdP0AaWC5MlhTWV9s4hFX39nomVZ+C4tnGOJQ==}\n    engines: {node: '>=12'}\n\n  postgres-bytea@1.0.0:\n    resolution: {integrity: sha512-xy3pmLuQqRBZBXDULy7KbaitYqLcmxigw14Q5sj8QBVLqEwXfeybIKVWiqAXTlcvdvb0+xkOtDbfQMOf4lST1w==}\n    engines: {node: '>=0.10.0'}\n\n  postgres-bytea@3.0.0:\n    resolution: {integrity: sha512-CNd4jim9RFPkObHSjVHlVrxoVQXz7quwNFpz7RY1okNNme49+sVyiTvTRobiLV548Hx/hb1BG+iE7h9493WzFw==}\n    engines: {node: '>= 6'}\n\n  postgres-date@1.0.7:\n    resolution: {integrity: sha512-suDmjLVQg78nMK2UZ454hAG+OAW+HQPZ6n++TNDUX+L0+uUlLywnoxJKDou51Zm+zTCjrCl0Nq6J9C5hP9vK/Q==}\n    engines: {node: '>=0.10.0'}\n\n  postgres-date@2.1.0:\n    resolution: {integrity: sha512-K7Juri8gtgXVcDfZttFKVmhglp7epKb1K4pgrkLxehjqkrgPhfG6OO8LHLkfaqkbpjNRnra018XwAr1yQFWGcA==}\n    engines: {node: '>=12'}\n\n  postgres-interval@1.2.0:\n    resolution: {integrity: sha512-9ZhXKM/rw350N1ovuWHbGxnGh/SNJ4cnxHiM0rxE4VN41wsg8P8zWn9hv/buK00RP4WvlOyr/RBDiptyxVbkZQ==}\n    engines: {node: '>=0.10.0'}\n\n  postgres-interval@3.0.0:\n    resolution: {integrity: sha512-BSNDnbyZCXSxgA+1f5UU2GmwhoI0aU5yMxRGO8CdFEcY2BQF9xm/7MqKnYoM1nJDk8nONNWDk9WeSmePFhQdlw==}\n    engines: {node: '>=12'}\n\n  postgres-range@1.1.4:\n    resolution: {integrity: sha512-i/hbxIE9803Alj/6ytL7UHQxRvZkI9O4Sy+J3HGc4F4oo/2eQAjTSNJ0bfxyse3bH0nuVesCk+3IRLaMtG3H6w==}\n\n  postgres@3.4.7:\n    resolution: {integrity: sha512-Jtc2612XINuBjIl/QTWsV5UvE8UHuNblcO3vVADSrKsrc6RqGX6lOW1cEo3CM2v0XG4Nat8nI+YM7/f26VxXLw==}\n    engines: {node: '>=12'}\n\n  prop-types@15.8.1:\n    resolution: {integrity: sha512-oj87CgZICdulUohogVAR7AjlC0327U4el4L6eAvOqCeudMDVU0NThNaV+b9Df4dXgSP1gXMTnPdhfe/2qDH5cg==}\n\n  proxy-addr@2.0.7:\n    resolution: {integrity: sha512-llQsMLSUDUPT44jdrU/O37qlnifitDP+ZwrmmZcoSKyLKvtZxpyV0n2/bD/N4tBAAZ/gJEdZU7KMraoK1+XYAg==}\n    engines: {node: '>= 0.10'}\n\n  pseudomap@1.0.2:\n    resolution: {integrity: sha512-b/YwNhb8lk1Zz2+bXXpS/LK9OisiZZ1SNsSLxN1x2OXVEhW2Ckr/7mWE5vrC1ZTiJlD9g19jWszTmJsB+oEpFQ==}\n\n  qs@6.13.0:\n    resolution: {integrity: sha512-+38qI9SOr8tfZ4QmJNplMUxqjbe7LKvvZgWdExBOmd+egZTtjLB67Gu0HRX3u/XOq7UU2Nx6nsjvS16Z9uwfpg==}\n    engines: {node: '>=0.6'}\n\n  queue-microtask@1.2.3:\n    resolution: {integrity: sha512-NuaNSa6flKT5JaSYQzJok04JzTL1CA6aGhv5rfLW3PgqA+M2ChpZQnAC8h8i4ZFkBS8X5RqkDBHA7r4hej3K9A==}\n\n  random-bytes@1.0.0:\n    resolution: {integrity: sha512-iv7LhNVO047HzYR3InF6pUcUsPQiHTM1Qal51DcGSuZFBil1aBBWG5eHPNek7bvILMaYJ/8RU1e8w1AMdHmLQQ==}\n    engines: {node: '>= 0.8'}\n\n  range-parser@1.2.1:\n    resolution: {integrity: sha512-Hrgsx+orqoygnmhFbKaHE6c296J+HTAQXoxEF6gNupROmmGJRoyzfG3ccAveqCBrwr/2yxQ5BVd/GTl5agOwSg==}\n    engines: {node: '>= 0.6'}\n\n  raw-body@2.5.2:\n    resolution: {integrity: sha512-8zGqypfENjCIqGhgXToC8aB2r7YrBX+AQAfIPs/Mlk+BtPTztOvTS01NRW/3Eh60J+a48lt8qsCzirQ6loCVfA==}\n    engines: {node: '>= 0.8'}\n\n  react-day-picker@8.10.1:\n    resolution: {integrity: sha512-TMx7fNbhLk15eqcMt+7Z7S2KF7mfTId/XJDjKE8f+IUcFn0l08/kI4FiYTL/0yuOLmEcbR4Fwe3GJf/NiiMnPA==}\n    peerDependencies:\n      date-fns: ^2.28.0 || ^3.0.0\n      react: ^16.8.0 || ^17.0.0 || ^18.0.0\n\n  react-dom@18.3.1:\n    resolution: {integrity: sha512-5m4nQKp+rZRb09LNH59GM4BxTh9251/ylbKIbpe7TpGxfJ+9kv6BLkLBXIjjspbgbnIBNqlI23tRnTWT0snUIw==}\n    peerDependencies:\n      react: ^18.3.1\n\n  react-hook-form@7.66.1:\n    resolution: {integrity: sha512-2KnjpgG2Rhbi+CIiIBQQ9Df6sMGH5ExNyFl4Hw9qO7pIqMBR8Bvu9RQyjl3JM4vehzCh9soiNUM/xYMswb2EiA==}\n    engines: {node: '>=18.0.0'}\n    peerDependencies:\n      react: ^16.8.0 || ^17 || ^18 || ^19\n\n  react-icons@5.5.0:\n    resolution: {integrity: sha512-MEFcXdkP3dLo8uumGI5xN3lDFNsRtrjbOEKDLD7yv76v4wpnEq2Lt2qeHaQOr34I/wPN3s3+N08WkQ+CW37Xiw==}\n    peerDependencies:\n      react: '*'\n\n  react-is@16.13.1:\n    resolution: {integrity: sha512-24e6ynE2H+OKt4kqsOvNd8kBpV65zoxbA4BVsEOB3ARVWQki/DHzaUoC5KuON/BiccDaCCTZBuOcfZs70kR8bQ==}\n\n  react-is@18.3.1:\n    resolution: {integrity: sha512-/LLMVyas0ljjAtoYiPqYiL8VWXzUUdThrmU5+n20DZv+a+ClRoevUzw5JxU+Ieh5/c87ytoTBV9G1FiKfNJdmg==}\n\n  react-refresh@0.17.0:\n    resolution: {integrity: sha512-z6F7K9bV85EfseRCp2bzrpyQ0Gkw1uLoCel9XBVWPg/TjRj94SkJzUTGfOa4bs7iJvBWtQG0Wq7wnI0syw3EBQ==}\n    engines: {node: '>=0.10.0'}\n\n  react-remove-scroll-bar@2.3.8:\n    resolution: {integrity: sha512-9r+yi9+mgU33AKcj6IbT9oRCO78WriSj6t/cF8DWBZJ9aOGPOTEDvdUDz1FwKim7QXWwmHqtdHnRJfhAxEG46Q==}\n    engines: {node: '>=10'}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  react-remove-scroll@2.7.1:\n    resolution: {integrity: sha512-HpMh8+oahmIdOuS5aFKKY6Pyog+FNaZV/XyJOq7b4YFwsFHe5yYfdbIalI4k3vU2nSDql7YskmUseHsRrJqIPA==}\n    engines: {node: '>=10'}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  react-resizable-panels@2.1.9:\n    resolution: {integrity: sha512-z77+X08YDIrgAes4jl8xhnUu1LNIRp4+E7cv4xHmLOxxUPO/ML7PSrE813b90vj7xvQ1lcf7g2uA9GeMZonjhQ==}\n    peerDependencies:\n      react: ^16.14.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc\n      react-dom: ^16.14.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc\n\n  react-smooth@4.0.4:\n    resolution: {integrity: sha512-gnGKTpYwqL0Iii09gHobNolvX4Kiq4PKx6eWBCYYix+8cdw+cGo3do906l1NBPKkSWx1DghC1dlWG9L2uGd61Q==}\n    peerDependencies:\n      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n      react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n\n  react-style-singleton@2.2.3:\n    resolution: {integrity: sha512-b6jSvxvVnyptAiLjbkWLE/lOnR4lfTtDAl+eUC7RZy+QQWc6wRzIV2CE6xBuMmDxc2qIihtDCZD5NPOFl7fRBQ==}\n    engines: {node: '>=10'}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  react-transition-group@4.4.5:\n    resolution: {integrity: sha512-pZcd1MCJoiKiBR2NRxeCRg13uCXbydPnmB4EOeRrY7480qNWO8IIgQG6zlDkm6uRMsURXPuKq0GWtiM59a5Q6g==}\n    peerDependencies:\n      react: '>=16.6.0'\n      react-dom: '>=16.6.0'\n\n  react@18.3.1:\n    resolution: {integrity: sha512-wS+hAgJShR0KhEvPJArfuPVN1+Hz1t0Y6n5jLrGQbkb4urgPE/0Rve+1kMB1v/oWgHgm4WIcV+i7F2pTVj+2iQ==}\n    engines: {node: '>=0.10.0'}\n\n  read-cache@1.0.0:\n    resolution: {integrity: sha512-Owdv/Ft7IjOgm/i0xvNDZ1LrRANRfew4b2prF3OWMQLxLfu3bS8FVhCsrSCMK4lR56Y9ya+AThoTpDCTxCmpRA==}\n\n  readable-stream@3.6.2:\n    resolution: {integrity: sha512-9u/sniCrY3D5WdsERHzHE4G2YCXqoG5FTHUiCC4SIbr6XcLZBY05ya9EKjYek9O5xOAwjGq+1JdGBAS7Q9ScoA==}\n    engines: {node: '>= 6'}\n\n  readdirp@3.6.0:\n    resolution: {integrity: sha512-hOS089on8RduqdbhvQ5Z37A0ESjsqz6qnRcffsMU3495FuTdqSm+7bhJ29JvIOsBDEEnan5DPu9t3To9VRlMzA==}\n    engines: {node: '>=8.10.0'}\n\n  recharts-scale@0.4.5:\n    resolution: {integrity: sha512-kivNFO+0OcUNu7jQquLXAxz1FIwZj8nrj+YkOKc5694NbjCvcT6aSZiIzNzd2Kul4o4rTto8QVR9lMNtxD4G1w==}\n\n  recharts@2.15.4:\n    resolution: {integrity: sha512-UT/q6fwS3c1dHbXv2uFgYJ9BMFHu3fwnd7AYZaEQhXuYQ4hgsxLvsUXzGdKeZrW5xopzDCvuA2N41WJ88I7zIw==}\n    engines: {node: '>=14'}\n    peerDependencies:\n      react: ^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n      react-dom: ^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n\n  regexparam@3.0.0:\n    resolution: {integrity: sha512-RSYAtP31mvYLkAHrOlh25pCNQ5hWnT106VukGaaFfuJrZFkGRX5GhUAdPqpSDXxOhA2c4akmRuplv1mRqnBn6Q==}\n    engines: {node: '>=8'}\n\n  resolve-pkg-maps@1.0.0:\n    resolution: {integrity: sha512-seS2Tj26TBVOC2NIc2rOe2y2ZO7efxITtLZcGSOnHHNOQ7CkiUBfw0Iw2ck6xkIhPwLhKNLS8BO+hEpngQlqzw==}\n\n  resolve@1.22.11:\n    resolution: {integrity: sha512-RfqAvLnMl313r7c9oclB1HhUEAezcpLjz95wFH4LVuhk9JF/r22qmVP9AMmOU4vMX7Q8pN8jwNg/CSpdFnMjTQ==}\n    engines: {node: '>= 0.4'}\n    hasBin: true\n\n  reusify@1.1.0:\n    resolution: {integrity: sha512-g6QUff04oZpHs0eG5p83rFLhHeV00ug/Yf9nZM6fLeUrPguBTkTQOdpAWWspMh55TZfVQDPaN3NQJfbVRAxdIw==}\n    engines: {iojs: '>=1.0.0', node: '>=0.10.0'}\n\n  rollup@4.53.3:\n    resolution: {integrity: sha512-w8GmOxZfBmKknvdXU1sdM9NHcoQejwF/4mNgj2JuEEdRaHwwF12K7e9eXn1nLZ07ad+du76mkVsyeb2rKGllsA==}\n    engines: {node: '>=18.0.0', npm: '>=8.0.0'}\n    hasBin: true\n\n  run-parallel@1.2.0:\n    resolution: {integrity: sha512-5l4VyZR86LZ/lDxZTR6jqL8AFE2S0IFLMP26AbjsLVADxHdhB/c0GUsH+y39UfCi3dzz8OlQuPmnaJOMoDHQBA==}\n\n  safe-buffer@5.2.1:\n    resolution: {integrity: sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==}\n\n  safer-buffer@2.1.2:\n    resolution: {integrity: sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==}\n\n  scheduler@0.23.2:\n    resolution: {integrity: sha512-UOShsPwz7NrMUqhR6t0hWjFduvOzbtv7toDH1/hIrfRNIDBnnBWd0CwJTGvTpngVlmwGCdP9/Zl/tVrDqcuYzQ==}\n\n  semver@6.3.1:\n    resolution: {integrity: sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==}\n    hasBin: true\n\n  semver@7.7.3:\n    resolution: {integrity: sha512-SdsKMrI9TdgjdweUSR9MweHA4EJ8YxHn8DFaDisvhVlUOe4BF1tLD7GAj0lIqWVl+dPb/rExr0Btby5loQm20Q==}\n    engines: {node: '>=10'}\n    hasBin: true\n\n  send@0.19.0:\n    resolution: {integrity: sha512-dW41u5VfLXu8SJh5bwRmyYUbAoSB3c9uQh6L8h/KtsFREPWpbX1lrljJo186Jc4nmci/sGUZ9a0a0J2zgfq2hw==}\n    engines: {node: '>= 0.8.0'}\n\n  serve-static@1.16.2:\n    resolution: {integrity: sha512-VqpjJZKadQB/PEbEwvFdO43Ax5dFBZ2UECszz8bQ7pi7wt//PWe1P6MN7eCnjsatYtBT6EuiClbjSWP2WrIoTw==}\n    engines: {node: '>= 0.8.0'}\n\n  setprototypeof@1.2.0:\n    resolution: {integrity: sha512-E5LDX7Wrp85Kil5bhZv46j8jOeboKq5JMmYM3gVGdGH8xFpPWXUMsNrlODCrkoxMEeNi/XZIwuRvY4XNwYMJpw==}\n\n  shebang-command@2.0.0:\n    resolution: {integrity: sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==}\n    engines: {node: '>=8'}\n\n  shebang-regex@3.0.0:\n    resolution: {integrity: sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==}\n    engines: {node: '>=8'}\n\n  shell-quote@1.8.3:\n    resolution: {integrity: sha512-ObmnIF4hXNg1BqhnHmgbDETF8dLPCggZWBjkQfhZpbszZnYur5DUljTcCHii5LC3J5E0yeO/1LIMyH+UvHQgyw==}\n    engines: {node: '>= 0.4'}\n\n  side-channel-list@1.0.0:\n    resolution: {integrity: sha512-FCLHtRD/gnpCiCHEiJLOwdmFP+wzCmDEkc9y7NsYxeF4u7Btsn1ZuwgwJGxImImHicJArLP4R0yX4c2KCrMrTA==}\n    engines: {node: '>= 0.4'}\n\n  side-channel-map@1.0.1:\n    resolution: {integrity: sha512-VCjCNfgMsby3tTdo02nbjtM/ewra6jPHmpThenkTYh8pG9ucZ/1P8So4u4FGBek/BjpOVsDCMoLA/iuBKIFXRA==}\n    engines: {node: '>= 0.4'}\n\n  side-channel-weakmap@1.0.2:\n    resolution: {integrity: sha512-WPS/HvHQTYnHisLo9McqBHOJk2FkHO/tlpvldyrnem4aeQp4hai3gythswg6p01oSoTl58rcpiFAjF2br2Ak2A==}\n    engines: {node: '>= 0.4'}\n\n  side-channel@1.1.0:\n    resolution: {integrity: sha512-ZX99e6tRweoUXqR+VBrslhda51Nh5MTQwou5tnUDgbtyM0dBgmhEDtWGP/xbKn6hqfPRHujUNwz5fy/wbbhnpw==}\n    engines: {node: '>= 0.4'}\n\n  signal-exit@4.1.0:\n    resolution: {integrity: sha512-bzyZ1e88w9O1iNJbKnOlvYTrWPDl46O1bG0D3XInv+9tkPrxrN8jUUTiFlDkkmKWgn1M6CfIA13SuGqOa9Korw==}\n    engines: {node: '>=14'}\n\n  source-map-js@1.2.1:\n    resolution: {integrity: sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==}\n    engines: {node: '>=0.10.0'}\n\n  source-map-support@0.5.21:\n    resolution: {integrity: sha512-uBHU3L3czsIyYXKX88fdrGovxdSCoTGDRZ6SYXtSRxLZUzHg5P/66Ht6uoUlHu9EZod+inXhKo3qQgwXUT/y1w==}\n\n  source-map@0.6.1:\n    resolution: {integrity: sha512-UjgapumWlbMhkBgzT7Ykc5YXUT46F0iKu8SGXq0bcwP5dz/h0Plj6enJqjz1Zbq2l5WaqYnrVbwWOWMyF3F47g==}\n    engines: {node: '>=0.10.0'}\n\n  split2@4.2.0:\n    resolution: {integrity: sha512-UcjcJOWknrNkF6PLX83qcHM6KHgVKNkV62Y8a5uYDVv9ydGQVwAHMKqHdJje1VTWpljG0WYpCDhrCdAOYH4TWg==}\n    engines: {node: '>= 10.x'}\n\n  statuses@2.0.1:\n    resolution: {integrity: sha512-RwNA9Z/7PrK06rYLIzFMlaF+l73iwpzsqRIFgbMLbTcLD6cOao82TaWefPXQvB2fOC4AjuYSEndS7N/mTCbkdQ==}\n    engines: {node: '>= 0.8'}\n\n  streamsearch@1.1.0:\n    resolution: {integrity: sha512-Mcc5wHehp9aXz1ax6bZUyY5afg9u2rv5cqQI3mRrYkGC8rW2hM02jWuwjtL++LS5qinSyhj2QfLyNsuc+VsExg==}\n    engines: {node: '>=10.0.0'}\n\n  string-width@4.2.3:\n    resolution: {integrity: sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==}\n    engines: {node: '>=8'}\n\n  string-width@5.1.2:\n    resolution: {integrity: sha512-HnLOCR3vjcY8beoNLtcjZ5/nxn2afmME6lhrDrebokqMap+XbeW8n9TXpPDOqdGK5qcI3oT0GKTW6wC7EMiVqA==}\n    engines: {node: '>=12'}\n\n  string_decoder@1.3.0:\n    resolution: {integrity: sha512-hkRX8U1WjJFd8LsDJ2yQ/wWWxaopEsABU1XfkM8A+j0+85JAGppt16cr1Whg6KIbb4okU6Mql6BOj+uup/wKeA==}\n\n  strip-ansi@6.0.1:\n    resolution: {integrity: sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==}\n    engines: {node: '>=8'}\n\n  strip-ansi@7.1.2:\n    resolution: {integrity: sha512-gmBGslpoQJtgnMAvOVqGZpEz9dyoKTCzy2nfz/n8aIFhN/jCE/rCmcxabB6jOOHV+0WNnylOxaxBQPSvcWklhA==}\n    engines: {node: '>=12'}\n\n  sucrase@3.35.0:\n    resolution: {integrity: sha512-8EbVDiu9iN/nESwxeSxDKe0dunta1GOlHufmSSXxMD2z2/tMZpDMpvXQGsc+ajGo8y2uYUmixaSRUc/QPoQ0GA==}\n    engines: {node: '>=16 || 14 >=14.17'}\n    hasBin: true\n\n  supports-preserve-symlinks-flag@1.0.0:\n    resolution: {integrity: sha512-ot0WnXS9fgdkgIcePe6RHNk1WA8+muPa6cSjeR3V8K27q9BB1rTE3R1p7Hv0z1ZyAc8s6Vvv8DIyWf681MAt0w==}\n    engines: {node: '>= 0.4'}\n\n  tailwind-merge@2.6.0:\n    resolution: {integrity: sha512-P+Vu1qXfzediirmHOC3xKGAYeZtPcV9g76X+xg2FD4tYgR71ewMA35Y3sCz3zhiN/dwefRpJX0yBcgwi1fXNQA==}\n\n  tailwindcss-animate@1.0.7:\n    resolution: {integrity: sha512-bl6mpH3T7I3UFxuvDEXLxy/VuFxBk5bbzplh7tXI68mwMokNYd1t9qPBHlnyTwfa4JGC4zP516I1hYYtQ/vspA==}\n    peerDependencies:\n      tailwindcss: '>=3.0.0 || insiders'\n\n  tailwindcss@3.4.18:\n    resolution: {integrity: sha512-6A2rnmW5xZMdw11LYjhcI5846rt9pbLSabY5XPxo+XWdxwZaFEn47Go4NzFiHu9sNNmr/kXivP1vStfvMaK1GQ==}\n    engines: {node: '>=14.0.0'}\n    hasBin: true\n\n  tailwindcss@4.1.17:\n    resolution: {integrity: sha512-j9Ee2YjuQqYT9bbRTfTZht9W/ytp5H+jJpZKiYdP/bpnXARAuELt9ofP0lPnmHjbga7SNQIxdTAXCmtKVYjN+Q==}\n\n  tapable@2.3.0:\n    resolution: {integrity: sha512-g9ljZiwki/LfxmQADO3dEY1CbpmXT5Hm2fJ+QaGKwSXUylMybePR7/67YW7jOrrvjEgL1Fmz5kzyAjWVWLlucg==}\n    engines: {node: '>=6'}\n\n  thenify-all@1.6.0:\n    resolution: {integrity: sha512-RNxQH/qI8/t3thXJDwcstUO4zeqo64+Uy/+sNVRBx4Xn2OX+OZ9oP+iJnNFqplFra2ZUVeKCSa2oVWi3T4uVmA==}\n    engines: {node: '>=0.8'}\n\n  thenify@3.3.1:\n    resolution: {integrity: sha512-RVZSIV5IG10Hk3enotrhvz0T9em6cyHBLkH/YAZuKqd8hRkKhSfCGIcP2KUY0EPxndzANBmNllzWPwak+bheSw==}\n\n  timers-ext@0.1.8:\n    resolution: {integrity: sha512-wFH7+SEAcKfJpfLPkrgMPvvwnEtj8W4IurvEyrKsDleXnKLCDw71w8jltvfLa8Rm4qQxxT4jmDBYbJG/z7qoww==}\n    engines: {node: '>=0.12'}\n\n  tiny-invariant@1.3.3:\n    resolution: {integrity: sha512-+FbBPE1o9QAYvviau/qC5SE3caw21q3xkvWKBtja5vgqOWIHHJ3ioaq1VPfn/Szqctz2bU/oYeKd9/z5BL+PVg==}\n\n  to-regex-range@5.0.1:\n    resolution: {integrity: sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li/Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==}\n    engines: {node: '>=8.0'}\n\n  toidentifier@1.0.1:\n    resolution: {integrity: sha512-o5sSPKEkg/DIQNmH43V0/uerLrpzVedkUh8tGNvaeXpfpuwjKenlSox/2O/BTlZUtEe+JG7s5YhEz608PlAHRA==}\n    engines: {node: '>=0.6'}\n\n  ts-interface-checker@0.1.13:\n    resolution: {integrity: sha512-Y/arvbn+rrz3JCKl9C4kVNfTfSm2/mEp5FSz5EsZSANGPSlQrpRI5M4PKF+mJnE52jOO90PnPSc3Ur3bTQw0gA==}\n\n  ts-node@10.9.2:\n    resolution: {integrity: sha512-f0FFpIdcHgn8zcPSbf1dRevwt047YMnaiJM3u2w2RewrB+fob/zePZcrOyQoLMMO7aBIddLcQIEK5dYjkLnGrQ==}\n    hasBin: true\n    peerDependencies:\n      '@swc/core': '>=1.2.50'\n      '@swc/wasm': '>=1.2.50'\n      '@types/node': '*'\n      typescript: '>=2.7'\n    peerDependenciesMeta:\n      '@swc/core':\n        optional: true\n      '@swc/wasm':\n        optional: true\n\n  tslib@2.8.1:\n    resolution: {integrity: sha512-oJFu94HQb+KVduSUQL7wnpmqnfmLsOA/nAh6b6EH0wCEoK0/mPeXU6c3wKDV83MkOuHPRHtSXKKU99IBazS/2w==}\n\n  tsx@4.20.6:\n    resolution: {integrity: sha512-ytQKuwgmrrkDTFP4LjR0ToE2nqgy886GpvRSpU0JAnrdBYppuY5rLkRUYPU1yCryb24SsKBTL/hlDQAEFVwtZg==}\n    engines: {node: '>=18.0.0'}\n    hasBin: true\n\n  tw-animate-css@1.4.0:\n    resolution: {integrity: sha512-7bziOlRqH0hJx80h/3mbicLW7o8qLsH5+RaLR2t+OHM3D0JlWGODQKQ4cxbK7WlvmUxpcj6Kgu6EKqjrGFe3QQ==}\n\n  type-is@1.6.18:\n    resolution: {integrity: sha512-TkRKr9sUTxEH8MdfuCSP7VizJyzRNMjj2J2do2Jr3Kym598JVdEksuzPQCnlFPW4ky9Q+iA+ma9BGm06XQBy8g==}\n    engines: {node: '>= 0.6'}\n\n  type@2.7.3:\n    resolution: {integrity: sha512-8j+1QmAbPvLZow5Qpi6NCaN8FB60p/6x8/vfNqOk/hC+HuvFZhL4+WfekuhQLiqFZXOgQdrs3B+XxEmCc6b3FQ==}\n\n  typedarray@0.0.6:\n    resolution: {integrity: sha512-/aCDEGatGvZ2BIk+HmLf4ifCJFwvKFNb9/JeZPMulfgFracn9QFcAf5GO8B/mweUjSoblS5In0cWhqpfs/5PQA==}\n\n  typescript@5.9.3:\n    resolution: {integrity: sha512-jl1vZzPDinLr9eUt3J/t7V6FgNEw9QjvBPdysz9KfQDD41fQrC2Y4vKQdiaUpFT4bXlb1RHhLpp8wtm6M5TgSw==}\n    engines: {node: '>=14.17'}\n    hasBin: true\n\n  uid-safe@2.1.5:\n    resolution: {integrity: sha512-KPHm4VL5dDXKz01UuEd88Df+KzynaohSL9fBh096KWAxSKZQDI2uBrVqtvRM4rwrIrRRKsdLNML/lnaaVSRioA==}\n    engines: {node: '>= 0.8'}\n\n  undici-types@6.19.8:\n    resolution: {integrity: sha512-ve2KP6f/JnbPBFyobGHuerC9g1FYGn/F8n1LWTwNxCEzd6IfqTwUQcNXgEtmmQ6DlRrC1hrSrBnCZPokRrDHjw==}\n\n  unpipe@1.0.0:\n    resolution: {integrity: sha512-pjy2bYhSsufwWlKwPc+l3cN7+wuJlK6uz0YdJEOlQDbl6jo/YlPi4mb8agUkVC8BF7V8NuzeyPNqRksA3hztKQ==}\n    engines: {node: '>= 0.8'}\n\n  update-browserslist-db@1.1.4:\n    resolution: {integrity: sha512-q0SPT4xyU84saUX+tomz1WLkxUbuaJnR1xWt17M7fJtEJigJeWUNGUqrauFXsHnqev9y9JTRGwk13tFBuKby4A==}\n    hasBin: true\n    peerDependencies:\n      browserslist: '>= 4.21.0'\n\n  use-callback-ref@1.3.3:\n    resolution: {integrity: sha512-jQL3lRnocaFtu3V00JToYz/4QkNWswxijDaCVNZRiRTO3HQDLsdu1ZtmIUvV4yPp+rvWm5j0y0TG/S61cuijTg==}\n    engines: {node: '>=10'}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  use-sidecar@1.1.3:\n    resolution: {integrity: sha512-Fedw0aZvkhynoPYlA5WXrMCAMm+nSWdZt6lzJQ7Ok8S6Q+VsHmHpRWndVRJ8Be0ZbkfPc5LRYH+5XrzXcEeLRQ==}\n    engines: {node: '>=10'}\n    peerDependencies:\n      '@types/react': '*'\n      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc\n    peerDependenciesMeta:\n      '@types/react':\n        optional: true\n\n  use-sync-external-store@1.6.0:\n    resolution: {integrity: sha512-Pp6GSwGP/NrPIrxVFAIkOQeyw8lFenOHijQWkUTrDvrF4ALqylP2C/KCkeS9dpUM3KvYRQhna5vt7IL95+ZQ9w==}\n    peerDependencies:\n      react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n\n  util-deprecate@1.0.2:\n    resolution: {integrity: sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==}\n\n  utils-merge@1.0.1:\n    resolution: {integrity: sha512-pMZTvIkT1d+TFGvDOqodOclx0QWkkgi6Tdoa8gC8ffGAAqz9pzPTZWAybbsHHoED/ztMtkv/VoYTYyShUn81hA==}\n    engines: {node: '>= 0.4.0'}\n\n  v8-compile-cache-lib@3.0.1:\n    resolution: {integrity: sha512-wa7YjyUGfNZngI/vtK0UHAN+lgDCxBPCylVXGp0zu59Fz5aiGtNXaq3DhIov063MorB+VfufLh3JlF2KdTK3xg==}\n\n  vary@1.1.2:\n    resolution: {integrity: sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg==}\n    engines: {node: '>= 0.8'}\n\n  vaul@1.1.2:\n    resolution: {integrity: sha512-ZFkClGpWyI2WUQjdLJ/BaGuV6AVQiJ3uELGk3OYtP+B6yCO7Cmn9vPFXVJkRaGkOJu3m8bQMgtyzNHixULceQA==}\n    peerDependencies:\n      react: ^16.8 || ^17.0 || ^18.0 || ^19.0.0 || ^19.0.0-rc\n      react-dom: ^16.8 || ^17.0 || ^18.0 || ^19.0.0 || ^19.0.0-rc\n\n  victory-vendor@36.9.2:\n    resolution: {integrity: sha512-PnpQQMuxlwYdocC8fIJqVXvkeViHYzotI+NJrCuav0ZYFoq912ZHBk3mCeuj+5/VpodOjPe1z0Fk2ihgzlXqjQ==}\n\n  vite@5.4.21:\n    resolution: {integrity: sha512-o5a9xKjbtuhY6Bi5S3+HvbRERmouabWbyUcpXXUA1u+GNUKoROi9byOJ8M0nHbHYHkYICiMlqxkg1KkYmm25Sw==}\n    engines: {node: ^18.0.0 || >=20.0.0}\n    hasBin: true\n    peerDependencies:\n      '@types/node': ^18.0.0 || >=20.0.0\n      less: '*'\n      lightningcss: ^1.21.0\n      sass: '*'\n      sass-embedded: '*'\n      stylus: '*'\n      sugarss: '*'\n      terser: ^5.4.0\n    peerDependenciesMeta:\n      '@types/node':\n        optional: true\n      less:\n        optional: true\n      lightningcss:\n        optional: true\n      sass:\n        optional: true\n      sass-embedded:\n        optional: true\n      stylus:\n        optional: true\n      sugarss:\n        optional: true\n      terser:\n        optional: true\n\n  which@2.0.2:\n    resolution: {integrity: sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==}\n    engines: {node: '>= 8'}\n    hasBin: true\n\n  which@4.0.0:\n    resolution: {integrity: sha512-GlaYyEb07DPxYCKhKzplCWBJtvxZcZMrL+4UkrTSJHHPyZU4mYYTv3qaOe77H7EODLSSopAUFAc6W8U4yqvscg==}\n    engines: {node: ^16.13.0 || >=18.0.0}\n    hasBin: true\n\n  wouter@3.7.1:\n    resolution: {integrity: sha512-od5LGmndSUzntZkE2R5CHhoiJ7YMuTIbiXsa0Anytc2RATekgv4sfWRAxLEULBrp7ADzinWQw8g470lkT8+fOw==}\n    peerDependencies:\n      react: '>=16.8.0'\n\n  wrap-ansi@7.0.0:\n    resolution: {integrity: sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==}\n    engines: {node: '>=10'}\n\n  wrap-ansi@8.1.0:\n    resolution: {integrity: sha512-si7QWI6zUMq56bESFvagtmzMdGOtoxfR+Sez11Mobfc7tm+VkUckk9bW2UeffTGVUbOksxmSw0AA2gs8g71NCQ==}\n    engines: {node: '>=12'}\n\n  ws@8.18.3:\n    resolution: {integrity: sha512-PEIGCY5tSlUt50cqyMXfCzX+oOPqN0vuGqWzbcJ2xvnkzkq46oOpz7dQaTDBdfICb4N14+GARUDw2XV2N4tvzg==}\n    engines: {node: '>=10.0.0'}\n    peerDependencies:\n      bufferutil: ^4.0.1\n      utf-8-validate: '>=5.0.2'\n    peerDependenciesMeta:\n      bufferutil:\n        optional: true\n      utf-8-validate:\n        optional: true\n\n  xtend@4.0.2:\n    resolution: {integrity: sha512-LKYU1iAXJXUgAXn9URjiu+MWhyUXHsvfp7mcuYm9dSUKK0/CjtrUwFAxD82/mCWbtLsGjFIad0wIsod4zrTAEQ==}\n    engines: {node: '>=0.4'}\n\n  yallist@2.1.2:\n    resolution: {integrity: sha512-ncTzHV7NvsQZkYe1DW7cbDLm0YpzHmZF5r/iyP3ZnQtMiJ+pjzisCiMNI+Sj+xQF5pXhSHxSB3uDbsBTzY/c2A==}\n\n  yallist@3.1.1:\n    resolution: {integrity: sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==}\n\n  yn@3.1.1:\n    resolution: {integrity: sha512-Ux4ygGWsu2c7isFWe8Yu1YluJmqVhxqK2cLXNQA5AcC3QfbGNpM7fu0Y8b/z16pXLnFxZYvWhd3fhBY9DLmC6Q==}\n    engines: {node: '>=6'}\n\n  zod-validation-error@3.5.4:\n    resolution: {integrity: sha512-+hEiRIiPobgyuFlEojnqjJnhFvg4r/i3cqgcm67eehZf/WBaK3g6cD02YU9mtdVxZjv8CzCA9n/Rhrs3yAAvAw==}\n    engines: {node: '>=18.0.0'}\n    peerDependencies:\n      zod: ^3.24.4\n\n  zod@3.25.76:\n    resolution: {integrity: sha512-gzUt/qt81nXsFGKIFcC3YnfEAx5NkunCfnDlvuBSSFS02bcXu4Lmea0AFIUwbLWxWPx3d9p8S5QoaujKcNQxcQ==}\n\nsnapshots:\n\n  '@alloc/quick-lru@5.2.0': {}\n\n  '@babel/code-frame@7.27.1':\n    dependencies:\n      '@babel/helper-validator-identifier': 7.28.5\n      js-tokens: 4.0.0\n      picocolors: 1.1.1\n\n  '@babel/compat-data@7.28.5': {}\n\n  '@babel/core@7.28.5':\n    dependencies:\n      '@babel/code-frame': 7.27.1\n      '@babel/generator': 7.28.5\n      '@babel/helper-compilation-targets': 7.27.2\n      '@babel/helper-module-transforms': 7.28.3(@babel/core@7.28.5)\n      '@babel/helpers': 7.28.4\n      '@babel/parser': 7.28.5\n      '@babel/template': 7.27.2\n      '@babel/traverse': 7.28.5\n      '@babel/types': 7.28.5\n      '@jridgewell/remapping': 2.3.5\n      convert-source-map: 2.0.0\n      debug: 4.4.3\n      gensync: 1.0.0-beta.2\n      json5: 2.2.3\n      semver: 6.3.1\n    transitivePeerDependencies:\n      - supports-color\n\n  '@babel/generator@7.28.5':\n    dependencies:\n      '@babel/parser': 7.28.5\n      '@babel/types': 7.28.5\n      '@jridgewell/gen-mapping': 0.3.13\n      '@jridgewell/trace-mapping': 0.3.31\n      jsesc: 3.1.0\n\n  '@babel/helper-compilation-targets@7.27.2':\n    dependencies:\n      '@babel/compat-data': 7.28.5\n      '@babel/helper-validator-option': 7.27.1\n      browserslist: 4.28.0\n      lru-cache: 5.1.1\n      semver: 6.3.1\n\n  '@babel/helper-globals@7.28.0': {}\n\n  '@babel/helper-module-imports@7.27.1':\n    dependencies:\n      '@babel/traverse': 7.28.5\n      '@babel/types': 7.28.5\n    transitivePeerDependencies:\n      - supports-color\n\n  '@babel/helper-module-transforms@7.28.3(@babel/core@7.28.5)':\n    dependencies:\n      '@babel/core': 7.28.5\n      '@babel/helper-module-imports': 7.27.1\n      '@babel/helper-validator-identifier': 7.28.5\n      '@babel/traverse': 7.28.5\n    transitivePeerDependencies:\n      - supports-color\n\n  '@babel/helper-plugin-utils@7.27.1': {}\n\n  '@babel/helper-string-parser@7.27.1': {}\n\n  '@babel/helper-validator-identifier@7.28.5': {}\n\n  '@babel/helper-validator-option@7.27.1': {}\n\n  '@babel/helpers@7.28.4':\n    dependencies:\n      '@babel/template': 7.27.2\n      '@babel/types': 7.28.5\n\n  '@babel/parser@7.28.5':\n    dependencies:\n      '@babel/types': 7.28.5\n\n  '@babel/plugin-transform-react-jsx-self@7.27.1(@babel/core@7.28.5)':\n    dependencies:\n      '@babel/core': 7.28.5\n      '@babel/helper-plugin-utils': 7.27.1\n\n  '@babel/plugin-transform-react-jsx-source@7.27.1(@babel/core@7.28.5)':\n    dependencies:\n      '@babel/core': 7.28.5\n      '@babel/helper-plugin-utils': 7.27.1\n\n  '@babel/runtime@7.28.4': {}\n\n  '@babel/template@7.27.2':\n    dependencies:\n      '@babel/code-frame': 7.27.1\n      '@babel/parser': 7.28.5\n      '@babel/types': 7.28.5\n\n  '@babel/traverse@7.28.5':\n    dependencies:\n      '@babel/code-frame': 7.27.1\n      '@babel/generator': 7.28.5\n      '@babel/helper-globals': 7.28.0\n      '@babel/parser': 7.28.5\n      '@babel/template': 7.27.2\n      '@babel/types': 7.28.5\n      debug: 4.4.3\n    transitivePeerDependencies:\n      - supports-color\n\n  '@babel/types@7.28.5':\n    dependencies:\n      '@babel/helper-string-parser': 7.27.1\n      '@babel/helper-validator-identifier': 7.28.5\n\n  '@cspotcode/source-map-support@0.8.1':\n    dependencies:\n      '@jridgewell/trace-mapping': 0.3.9\n\n  '@drizzle-team/brocli@0.10.2': {}\n\n  '@esbuild-kit/core-utils@3.3.2':\n    dependencies:\n      esbuild: 0.18.20\n      source-map-support: 0.5.21\n\n  '@esbuild-kit/esm-loader@2.6.5':\n    dependencies:\n      '@esbuild-kit/core-utils': 3.3.2\n      get-tsconfig: 4.13.0\n\n  '@esbuild/aix-ppc64@0.19.12':\n    optional: true\n\n  '@esbuild/aix-ppc64@0.21.5':\n    optional: true\n\n  '@esbuild/aix-ppc64@0.25.12':\n    optional: true\n\n  '@esbuild/android-arm64@0.18.20':\n    optional: true\n\n  '@esbuild/android-arm64@0.19.12':\n    optional: true\n\n  '@esbuild/android-arm64@0.21.5':\n    optional: true\n\n  '@esbuild/android-arm64@0.25.12':\n    optional: true\n\n  '@esbuild/android-arm@0.18.20':\n    optional: true\n\n  '@esbuild/android-arm@0.19.12':\n    optional: true\n\n  '@esbuild/android-arm@0.21.5':\n    optional: true\n\n  '@esbuild/android-arm@0.25.12':\n    optional: true\n\n  '@esbuild/android-x64@0.18.20':\n    optional: true\n\n  '@esbuild/android-x64@0.19.12':\n    optional: true\n\n  '@esbuild/android-x64@0.21.5':\n    optional: true\n\n  '@esbuild/android-x64@0.25.12':\n    optional: true\n\n  '@esbuild/darwin-arm64@0.18.20':\n    optional: true\n\n  '@esbuild/darwin-arm64@0.19.12':\n    optional: true\n\n  '@esbuild/darwin-arm64@0.21.5':\n    optional: true\n\n  '@esbuild/darwin-arm64@0.25.12':\n    optional: true\n\n  '@esbuild/darwin-x64@0.18.20':\n    optional: true\n\n  '@esbuild/darwin-x64@0.19.12':\n    optional: true\n\n  '@esbuild/darwin-x64@0.21.5':\n    optional: true\n\n  '@esbuild/darwin-x64@0.25.12':\n    optional: true\n\n  '@esbuild/freebsd-arm64@0.18.20':\n    optional: true\n\n  '@esbuild/freebsd-arm64@0.19.12':\n    optional: true\n\n  '@esbuild/freebsd-arm64@0.21.5':\n    optional: true\n\n  '@esbuild/freebsd-arm64@0.25.12':\n    optional: true\n\n  '@esbuild/freebsd-x64@0.18.20':\n    optional: true\n\n  '@esbuild/freebsd-x64@0.19.12':\n    optional: true\n\n  '@esbuild/freebsd-x64@0.21.5':\n    optional: true\n\n  '@esbuild/freebsd-x64@0.25.12':\n    optional: true\n\n  '@esbuild/linux-arm64@0.18.20':\n    optional: true\n\n  '@esbuild/linux-arm64@0.19.12':\n    optional: true\n\n  '@esbuild/linux-arm64@0.21.5':\n    optional: true\n\n  '@esbuild/linux-arm64@0.25.12':\n    optional: true\n\n  '@esbuild/linux-arm@0.18.20':\n    optional: true\n\n  '@esbuild/linux-arm@0.19.12':\n    optional: true\n\n  '@esbuild/linux-arm@0.21.5':\n    optional: true\n\n  '@esbuild/linux-arm@0.25.12':\n    optional: true\n\n  '@esbuild/linux-ia32@0.18.20':\n    optional: true\n\n  '@esbuild/linux-ia32@0.19.12':\n    optional: true\n\n  '@esbuild/linux-ia32@0.21.5':\n    optional: true\n\n  '@esbuild/linux-ia32@0.25.12':\n    optional: true\n\n  '@esbuild/linux-loong64@0.18.20':\n    optional: true\n\n  '@esbuild/linux-loong64@0.19.12':\n    optional: true\n\n  '@esbuild/linux-loong64@0.21.5':\n    optional: true\n\n  '@esbuild/linux-loong64@0.25.12':\n    optional: true\n\n  '@esbuild/linux-mips64el@0.18.20':\n    optional: true\n\n  '@esbuild/linux-mips64el@0.19.12':\n    optional: true\n\n  '@esbuild/linux-mips64el@0.21.5':\n    optional: true\n\n  '@esbuild/linux-mips64el@0.25.12':\n    optional: true\n\n  '@esbuild/linux-ppc64@0.18.20':\n    optional: true\n\n  '@esbuild/linux-ppc64@0.19.12':\n    optional: true\n\n  '@esbuild/linux-ppc64@0.21.5':\n    optional: true\n\n  '@esbuild/linux-ppc64@0.25.12':\n    optional: true\n\n  '@esbuild/linux-riscv64@0.18.20':\n    optional: true\n\n  '@esbuild/linux-riscv64@0.19.12':\n    optional: true\n\n  '@esbuild/linux-riscv64@0.21.5':\n    optional: true\n\n  '@esbuild/linux-riscv64@0.25.12':\n    optional: true\n\n  '@esbuild/linux-s390x@0.18.20':\n    optional: true\n\n  '@esbuild/linux-s390x@0.19.12':\n    optional: true\n\n  '@esbuild/linux-s390x@0.21.5':\n    optional: true\n\n  '@esbuild/linux-s390x@0.25.12':\n    optional: true\n\n  '@esbuild/linux-x64@0.18.20':\n    optional: true\n\n  '@esbuild/linux-x64@0.19.12':\n    optional: true\n\n  '@esbuild/linux-x64@0.21.5':\n    optional: true\n\n  '@esbuild/linux-x64@0.25.12':\n    optional: true\n\n  '@esbuild/netbsd-arm64@0.25.12':\n    optional: true\n\n  '@esbuild/netbsd-x64@0.18.20':\n    optional: true\n\n  '@esbuild/netbsd-x64@0.19.12':\n    optional: true\n\n  '@esbuild/netbsd-x64@0.21.5':\n    optional: true\n\n  '@esbuild/netbsd-x64@0.25.12':\n    optional: true\n\n  '@esbuild/openbsd-arm64@0.25.12':\n    optional: true\n\n  '@esbuild/openbsd-x64@0.18.20':\n    optional: true\n\n  '@esbuild/openbsd-x64@0.19.12':\n    optional: true\n\n  '@esbuild/openbsd-x64@0.21.5':\n    optional: true\n\n  '@esbuild/openbsd-x64@0.25.12':\n    optional: true\n\n  '@esbuild/openharmony-arm64@0.25.12':\n    optional: true\n\n  '@esbuild/sunos-x64@0.18.20':\n    optional: true\n\n  '@esbuild/sunos-x64@0.19.12':\n    optional: true\n\n  '@esbuild/sunos-x64@0.21.5':\n    optional: true\n\n  '@esbuild/sunos-x64@0.25.12':\n    optional: true\n\n  '@esbuild/win32-arm64@0.18.20':\n    optional: true\n\n  '@esbuild/win32-arm64@0.19.12':\n    optional: true\n\n  '@esbuild/win32-arm64@0.21.5':\n    optional: true\n\n  '@esbuild/win32-arm64@0.25.12':\n    optional: true\n\n  '@esbuild/win32-ia32@0.18.20':\n    optional: true\n\n  '@esbuild/win32-ia32@0.19.12':\n    optional: true\n\n  '@esbuild/win32-ia32@0.21.5':\n    optional: true\n\n  '@esbuild/win32-ia32@0.25.12':\n    optional: true\n\n  '@esbuild/win32-x64@0.18.20':\n    optional: true\n\n  '@esbuild/win32-x64@0.19.12':\n    optional: true\n\n  '@esbuild/win32-x64@0.21.5':\n    optional: true\n\n  '@esbuild/win32-x64@0.25.12':\n    optional: true\n\n  '@floating-ui/core@1.7.3':\n    dependencies:\n      '@floating-ui/utils': 0.2.10\n\n  '@floating-ui/dom@1.7.4':\n    dependencies:\n      '@floating-ui/core': 1.7.3\n      '@floating-ui/utils': 0.2.10\n\n  '@floating-ui/react-dom@2.1.6(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@floating-ui/dom': 1.7.4\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n\n  '@floating-ui/utils@0.2.10': {}\n\n  '@hookform/resolvers@3.10.0(react-hook-form@7.66.1(react@18.3.1))':\n    dependencies:\n      react-hook-form: 7.66.1(react@18.3.1)\n\n  '@isaacs/cliui@8.0.2':\n    dependencies:\n      string-width: 5.1.2\n      string-width-cjs: string-width@4.2.3\n      strip-ansi: 7.1.2\n      strip-ansi-cjs: strip-ansi@6.0.1\n      wrap-ansi: 8.1.0\n      wrap-ansi-cjs: wrap-ansi@7.0.0\n\n  '@jridgewell/gen-mapping@0.3.13':\n    dependencies:\n      '@jridgewell/sourcemap-codec': 1.5.5\n      '@jridgewell/trace-mapping': 0.3.31\n\n  '@jridgewell/remapping@2.3.5':\n    dependencies:\n      '@jridgewell/gen-mapping': 0.3.13\n      '@jridgewell/trace-mapping': 0.3.31\n\n  '@jridgewell/resolve-uri@3.1.2': {}\n\n  '@jridgewell/sourcemap-codec@1.5.5': {}\n\n  '@jridgewell/trace-mapping@0.3.31':\n    dependencies:\n      '@jridgewell/resolve-uri': 3.1.2\n      '@jridgewell/sourcemap-codec': 1.5.5\n\n  '@jridgewell/trace-mapping@0.3.9':\n    dependencies:\n      '@jridgewell/resolve-uri': 3.1.2\n      '@jridgewell/sourcemap-codec': 1.5.5\n\n  '@neondatabase/serverless@0.10.4':\n    dependencies:\n      '@types/pg': 8.11.6\n\n  '@nodelib/fs.scandir@2.1.5':\n    dependencies:\n      '@nodelib/fs.stat': 2.0.5\n      run-parallel: 1.2.0\n\n  '@nodelib/fs.stat@2.0.5': {}\n\n  '@nodelib/fs.walk@1.2.8':\n    dependencies:\n      '@nodelib/fs.scandir': 2.1.5\n      fastq: 1.19.1\n\n  '@petamoriken/float16@3.9.3': {}\n\n  '@pkgjs/parseargs@0.11.0':\n    optional: true\n\n  '@radix-ui/number@1.1.1': {}\n\n  '@radix-ui/primitive@1.1.3': {}\n\n  '@radix-ui/react-accordion@1.2.12(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-collapsible': 1.1.12(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-collection': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-direction': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-alert-dialog@1.1.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-dialog': 1.1.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-slot': 1.2.3(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-arrow@1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-aspect-ratio@1.1.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-primitive': 2.1.4(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-avatar@1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-context': 1.1.3(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.4(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-is-hydrated': 0.1.0(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-checkbox@1.3.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-previous': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-size': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-collapsible@1.1.12(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-collection@1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-slot': 1.2.3(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-compose-refs@1.1.2(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-context-menu@2.2.16(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-menu': 2.1.16(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-context@1.1.2(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-context@1.1.3(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-dialog@1.1.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-dismissable-layer': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-focus-guards': 1.1.3(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-focus-scope': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-portal': 1.1.9(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-slot': 1.2.3(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      aria-hidden: 1.2.6\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n      react-remove-scroll: 2.7.1(@types/react@18.3.27)(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-direction@1.1.1(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-dismissable-layer@1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-escape-keydown': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-dropdown-menu@2.1.16(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-menu': 2.1.16(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-focus-guards@1.1.3(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-focus-scope@1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-hover-card@1.1.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-dismissable-layer': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-popper': 1.2.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-portal': 1.1.9(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-id@1.1.1(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-label@2.1.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-primitive': 2.1.4(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-menu@2.1.16(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-collection': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-direction': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-dismissable-layer': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-focus-guards': 1.1.3(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-focus-scope': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-popper': 1.2.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-portal': 1.1.9(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-roving-focus': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-slot': 1.2.3(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      aria-hidden: 1.2.6\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n      react-remove-scroll: 2.7.1(@types/react@18.3.27)(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-menubar@1.1.16(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-collection': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-direction': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-menu': 2.1.16(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-roving-focus': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-navigation-menu@1.2.14(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-collection': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-direction': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-dismissable-layer': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-previous': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-visually-hidden': 1.2.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-popover@1.1.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-dismissable-layer': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-focus-guards': 1.1.3(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-focus-scope': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-popper': 1.2.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-portal': 1.1.9(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-slot': 1.2.3(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      aria-hidden: 1.2.6\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n      react-remove-scroll: 2.7.1(@types/react@18.3.27)(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-popper@1.2.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@floating-ui/react-dom': 2.1.6(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-arrow': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-rect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-size': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/rect': 1.1.1\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-portal@1.1.9(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-presence@1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-primitive@2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-slot': 1.2.3(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-primitive@2.1.4(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-slot': 1.2.4(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-progress@1.1.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-context': 1.1.3(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.4(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-radio-group@1.3.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-direction': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-roving-focus': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-previous': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-size': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-roving-focus@1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-collection': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-direction': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-scroll-area@1.2.10(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/number': 1.1.1\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-direction': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-select@2.2.6(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/number': 1.1.1\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-collection': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-direction': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-dismissable-layer': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-focus-guards': 1.1.3(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-focus-scope': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-popper': 1.2.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-portal': 1.1.9(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-slot': 1.2.3(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-previous': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-visually-hidden': 1.2.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      aria-hidden: 1.2.6\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n      react-remove-scroll: 2.7.1(@types/react@18.3.27)(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-separator@1.1.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-primitive': 2.1.4(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-slider@1.3.6(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/number': 1.1.1\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-collection': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-direction': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-previous': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-size': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-slot@1.2.3(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-slot@1.2.4(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-switch@1.2.6(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-previous': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-size': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-tabs@1.1.13(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-direction': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-roving-focus': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-toast@1.2.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-collection': 1.1.7(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-dismissable-layer': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-portal': 1.1.9(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-visually-hidden': 1.2.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-toggle-group@1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-direction': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-roving-focus': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-toggle': 1.1.10(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-toggle@1.1.10(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-tooltip@1.2.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/primitive': 1.1.3\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-context': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-dismissable-layer': 1.1.11(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-popper': 1.2.8(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-portal': 1.1.9(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-presence': 1.1.5(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-slot': 1.2.3(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-controllable-state': 1.2.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-visually-hidden': 1.2.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/react-use-callback-ref@1.1.1(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-use-controllable-state@1.2.2(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-use-effect-event': 0.0.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-use-effect-event@0.0.2(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-use-escape-keydown@1.1.1(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-use-callback-ref': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-use-is-hydrated@0.1.0(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      react: 18.3.1\n      use-sync-external-store: 1.6.0(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-use-layout-effect@1.1.1(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-use-previous@1.1.1(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-use-rect@1.1.1(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      '@radix-ui/rect': 1.1.1\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-use-size@1.1.1(@types/react@18.3.27)(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-use-layout-effect': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      react: 18.3.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  '@radix-ui/react-visually-hidden@1.2.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@radix-ui/react-primitive': 2.1.3(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n      '@types/react-dom': 18.3.7(@types/react@18.3.27)\n\n  '@radix-ui/rect@1.1.1': {}\n\n  '@replit/vite-plugin-cartographer@0.2.8':\n    dependencies:\n      '@babel/parser': 7.28.5\n      '@babel/traverse': 7.28.5\n      '@babel/types': 7.28.5\n      magic-string: 0.30.21\n      modern-screenshot: 4.6.7\n    transitivePeerDependencies:\n      - supports-color\n\n  '@replit/vite-plugin-runtime-error-modal@0.0.3':\n    dependencies:\n      '@jridgewell/trace-mapping': 0.3.31\n\n  '@rolldown/pluginutils@1.0.0-beta.27': {}\n\n  '@rollup/rollup-android-arm-eabi@4.53.3':\n    optional: true\n\n  '@rollup/rollup-android-arm64@4.53.3':\n    optional: true\n\n  '@rollup/rollup-darwin-arm64@4.53.3':\n    optional: true\n\n  '@rollup/rollup-darwin-x64@4.53.3':\n    optional: true\n\n  '@rollup/rollup-freebsd-arm64@4.53.3':\n    optional: true\n\n  '@rollup/rollup-freebsd-x64@4.53.3':\n    optional: true\n\n  '@rollup/rollup-linux-arm-gnueabihf@4.53.3':\n    optional: true\n\n  '@rollup/rollup-linux-arm-musleabihf@4.53.3':\n    optional: true\n\n  '@rollup/rollup-linux-arm64-gnu@4.53.3':\n    optional: true\n\n  '@rollup/rollup-linux-arm64-musl@4.53.3':\n    optional: true\n\n  '@rollup/rollup-linux-loong64-gnu@4.53.3':\n    optional: true\n\n  '@rollup/rollup-linux-ppc64-gnu@4.53.3':\n    optional: true\n\n  '@rollup/rollup-linux-riscv64-gnu@4.53.3':\n    optional: true\n\n  '@rollup/rollup-linux-riscv64-musl@4.53.3':\n    optional: true\n\n  '@rollup/rollup-linux-s390x-gnu@4.53.3':\n    optional: true\n\n  '@rollup/rollup-linux-x64-gnu@4.53.3':\n    optional: true\n\n  '@rollup/rollup-linux-x64-musl@4.53.3':\n    optional: true\n\n  '@rollup/rollup-openharmony-arm64@4.53.3':\n    optional: true\n\n  '@rollup/rollup-win32-arm64-msvc@4.53.3':\n    optional: true\n\n  '@rollup/rollup-win32-ia32-msvc@4.53.3':\n    optional: true\n\n  '@rollup/rollup-win32-x64-gnu@4.53.3':\n    optional: true\n\n  '@rollup/rollup-win32-x64-msvc@4.53.3':\n    optional: true\n\n  '@tailwindcss/node@4.1.17':\n    dependencies:\n      '@jridgewell/remapping': 2.3.5\n      enhanced-resolve: 5.18.3\n      jiti: 2.6.1\n      lightningcss: 1.30.2\n      magic-string: 0.30.21\n      source-map-js: 1.2.1\n      tailwindcss: 4.1.17\n\n  '@tailwindcss/oxide-android-arm64@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide-darwin-arm64@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide-darwin-x64@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide-freebsd-x64@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide-linux-arm-gnueabihf@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide-linux-arm64-gnu@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide-linux-arm64-musl@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide-linux-x64-gnu@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide-linux-x64-musl@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide-wasm32-wasi@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide-win32-arm64-msvc@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide-win32-x64-msvc@4.1.17':\n    optional: true\n\n  '@tailwindcss/oxide@4.1.17':\n    optionalDependencies:\n      '@tailwindcss/oxide-android-arm64': 4.1.17\n      '@tailwindcss/oxide-darwin-arm64': 4.1.17\n      '@tailwindcss/oxide-darwin-x64': 4.1.17\n      '@tailwindcss/oxide-freebsd-x64': 4.1.17\n      '@tailwindcss/oxide-linux-arm-gnueabihf': 4.1.17\n      '@tailwindcss/oxide-linux-arm64-gnu': 4.1.17\n      '@tailwindcss/oxide-linux-arm64-musl': 4.1.17\n      '@tailwindcss/oxide-linux-x64-gnu': 4.1.17\n      '@tailwindcss/oxide-linux-x64-musl': 4.1.17\n      '@tailwindcss/oxide-wasm32-wasi': 4.1.17\n      '@tailwindcss/oxide-win32-arm64-msvc': 4.1.17\n      '@tailwindcss/oxide-win32-x64-msvc': 4.1.17\n\n  '@tailwindcss/typography@0.5.19(tailwindcss@3.4.18(tsx@4.20.6))':\n    dependencies:\n      postcss-selector-parser: 6.0.10\n      tailwindcss: 3.4.18(tsx@4.20.6)\n\n  '@tailwindcss/vite@4.1.17(vite@5.4.21(@types/node@20.16.11)(lightningcss@1.30.2))':\n    dependencies:\n      '@tailwindcss/node': 4.1.17\n      '@tailwindcss/oxide': 4.1.17\n      tailwindcss: 4.1.17\n      vite: 5.4.21(@types/node@20.16.11)(lightningcss@1.30.2)\n\n  '@tanstack/query-core@5.90.10': {}\n\n  '@tanstack/query-devtools@5.90.1': {}\n\n  '@tanstack/react-query-devtools@5.90.2(@tanstack/react-query@5.90.10(react@18.3.1))(react@18.3.1)':\n    dependencies:\n      '@tanstack/query-devtools': 5.90.1\n      '@tanstack/react-query': 5.90.10(react@18.3.1)\n      react: 18.3.1\n\n  '@tanstack/react-query@5.90.10(react@18.3.1)':\n    dependencies:\n      '@tanstack/query-core': 5.90.10\n      react: 18.3.1\n\n  '@tsconfig/node10@1.0.12': {}\n\n  '@tsconfig/node12@1.0.11': {}\n\n  '@tsconfig/node14@1.0.3': {}\n\n  '@tsconfig/node16@1.0.4': {}\n\n  '@types/babel__core@7.20.5':\n    dependencies:\n      '@babel/parser': 7.28.5\n      '@babel/types': 7.28.5\n      '@types/babel__generator': 7.27.0\n      '@types/babel__template': 7.4.4\n      '@types/babel__traverse': 7.28.0\n\n  '@types/babel__generator@7.27.0':\n    dependencies:\n      '@babel/types': 7.28.5\n\n  '@types/babel__template@7.4.4':\n    dependencies:\n      '@babel/parser': 7.28.5\n      '@babel/types': 7.28.5\n\n  '@types/babel__traverse@7.28.0':\n    dependencies:\n      '@babel/types': 7.28.5\n\n  '@types/bcrypt@5.0.2':\n    dependencies:\n      '@types/node': 20.16.11\n\n  '@types/body-parser@1.19.6':\n    dependencies:\n      '@types/connect': 3.4.38\n      '@types/node': 20.16.11\n\n  '@types/busboy@1.5.4':\n    dependencies:\n      '@types/node': 20.16.11\n\n  '@types/connect-pg-simple@7.0.3':\n    dependencies:\n      '@types/express': 4.17.21\n      '@types/express-session': 1.18.2\n      '@types/pg': 8.15.6\n\n  '@types/connect@3.4.38':\n    dependencies:\n      '@types/node': 20.16.11\n\n  '@types/cors@2.8.19':\n    dependencies:\n      '@types/node': 20.16.11\n\n  '@types/d3-array@3.2.2': {}\n\n  '@types/d3-color@3.1.3': {}\n\n  '@types/d3-ease@3.0.2': {}\n\n  '@types/d3-interpolate@3.0.4':\n    dependencies:\n      '@types/d3-color': 3.1.3\n\n  '@types/d3-path@3.1.1': {}\n\n  '@types/d3-scale@4.0.9':\n    dependencies:\n      '@types/d3-time': 3.0.4\n\n  '@types/d3-shape@3.1.7':\n    dependencies:\n      '@types/d3-path': 3.1.1\n\n  '@types/d3-time@3.0.4': {}\n\n  '@types/d3-timer@3.0.2': {}\n\n  '@types/estree@1.0.8': {}\n\n  '@types/express-fileupload@1.5.1':\n    dependencies:\n      '@types/busboy': 1.5.4\n      '@types/express': 4.17.21\n\n  '@types/express-serve-static-core@4.19.7':\n    dependencies:\n      '@types/node': 20.16.11\n      '@types/qs': 6.14.0\n      '@types/range-parser': 1.2.7\n      '@types/send': 1.2.1\n\n  '@types/express-session@1.18.2':\n    dependencies:\n      '@types/express': 4.17.21\n\n  '@types/express@4.17.21':\n    dependencies:\n      '@types/body-parser': 1.19.6\n      '@types/express-serve-static-core': 4.19.7\n      '@types/qs': 6.14.0\n      '@types/serve-static': 2.2.0\n\n  '@types/http-errors@2.0.5': {}\n\n  '@types/memoizee@0.4.12': {}\n\n  '@types/multer@2.0.0':\n    dependencies:\n      '@types/express': 4.17.21\n\n  '@types/node@20.16.11':\n    dependencies:\n      undici-types: 6.19.8\n\n  '@types/passport-local@1.0.38':\n    dependencies:\n      '@types/express': 4.17.21\n      '@types/passport': 1.0.17\n      '@types/passport-strategy': 0.2.38\n\n  '@types/passport-strategy@0.2.38':\n    dependencies:\n      '@types/express': 4.17.21\n      '@types/passport': 1.0.17\n\n  '@types/passport@1.0.17':\n    dependencies:\n      '@types/express': 4.17.21\n\n  '@types/pg@8.11.6':\n    dependencies:\n      '@types/node': 20.16.11\n      pg-protocol: 1.10.3\n      pg-types: 4.1.0\n\n  '@types/pg@8.15.6':\n    dependencies:\n      '@types/node': 20.16.11\n      pg-protocol: 1.10.3\n      pg-types: 2.2.0\n\n  '@types/prop-types@15.7.15': {}\n\n  '@types/qs@6.14.0': {}\n\n  '@types/range-parser@1.2.7': {}\n\n  '@types/react-dom@18.3.7(@types/react@18.3.27)':\n    dependencies:\n      '@types/react': 18.3.27\n\n  '@types/react@18.3.27':\n    dependencies:\n      '@types/prop-types': 15.7.15\n      csstype: 3.2.3\n\n  '@types/send@1.2.1':\n    dependencies:\n      '@types/node': 20.16.11\n\n  '@types/serve-static@2.2.0':\n    dependencies:\n      '@types/http-errors': 2.0.5\n      '@types/node': 20.16.11\n\n  '@types/ws@8.18.1':\n    dependencies:\n      '@types/node': 20.16.11\n\n  '@vitejs/plugin-react@4.7.0(vite@5.4.21(@types/node@20.16.11)(lightningcss@1.30.2))':\n    dependencies:\n      '@babel/core': 7.28.5\n      '@babel/plugin-transform-react-jsx-self': 7.27.1(@babel/core@7.28.5)\n      '@babel/plugin-transform-react-jsx-source': 7.27.1(@babel/core@7.28.5)\n      '@rolldown/pluginutils': 1.0.0-beta.27\n      '@types/babel__core': 7.20.5\n      react-refresh: 0.17.0\n      vite: 5.4.21(@types/node@20.16.11)(lightningcss@1.30.2)\n    transitivePeerDependencies:\n      - supports-color\n\n  accepts@1.3.8:\n    dependencies:\n      mime-types: 2.1.35\n      negotiator: 0.6.3\n\n  acorn-walk@8.3.4:\n    dependencies:\n      acorn: 8.15.0\n\n  acorn@8.15.0: {}\n\n  ansi-regex@5.0.1: {}\n\n  ansi-regex@6.2.2: {}\n\n  ansi-styles@4.3.0:\n    dependencies:\n      color-convert: 2.0.1\n\n  ansi-styles@6.2.3: {}\n\n  any-promise@1.3.0: {}\n\n  anymatch@3.1.3:\n    dependencies:\n      normalize-path: 3.0.0\n      picomatch: 2.3.1\n\n  append-field@1.0.0: {}\n\n  arg@4.1.3: {}\n\n  arg@5.0.2: {}\n\n  aria-hidden@1.2.6:\n    dependencies:\n      tslib: 2.8.1\n\n  array-flatten@1.1.1: {}\n\n  autoprefixer@10.4.22(postcss@8.5.6):\n    dependencies:\n      browserslist: 4.28.0\n      caniuse-lite: 1.0.30001756\n      fraction.js: 5.3.4\n      normalize-range: 0.1.2\n      picocolors: 1.1.1\n      postcss: 8.5.6\n      postcss-value-parser: 4.2.0\n\n  balanced-match@1.0.2: {}\n\n  baseline-browser-mapping@2.8.29: {}\n\n  bcrypt@6.0.0:\n    dependencies:\n      node-addon-api: 8.5.0\n      node-gyp-build: 4.8.4\n\n  bcryptjs@3.0.3: {}\n\n  binary-extensions@2.3.0: {}\n\n  body-parser@1.20.3:\n    dependencies:\n      bytes: 3.1.2\n      content-type: 1.0.5\n      debug: 2.6.9\n      depd: 2.0.0\n      destroy: 1.2.0\n      http-errors: 2.0.0\n      iconv-lite: 0.4.24\n      on-finished: 2.4.1\n      qs: 6.13.0\n      raw-body: 2.5.2\n      type-is: 1.6.18\n      unpipe: 1.0.0\n    transitivePeerDependencies:\n      - supports-color\n\n  brace-expansion@2.0.2:\n    dependencies:\n      balanced-match: 1.0.2\n\n  braces@3.0.3:\n    dependencies:\n      fill-range: 7.1.1\n\n  browserslist@4.28.0:\n    dependencies:\n      baseline-browser-mapping: 2.8.29\n      caniuse-lite: 1.0.30001756\n      electron-to-chromium: 1.5.256\n      node-releases: 2.0.27\n      update-browserslist-db: 1.1.4(browserslist@4.28.0)\n\n  buffer-from@1.1.2: {}\n\n  bufferutil@4.0.9:\n    dependencies:\n      node-gyp-build: 4.8.4\n    optional: true\n\n  busboy@1.6.0:\n    dependencies:\n      streamsearch: 1.1.0\n\n  bytes@3.1.2: {}\n\n  call-bind-apply-helpers@1.0.2:\n    dependencies:\n      es-errors: 1.3.0\n      function-bind: 1.1.2\n\n  call-bound@1.0.4:\n    dependencies:\n      call-bind-apply-helpers: 1.0.2\n      get-intrinsic: 1.3.0\n\n  camelcase-css@2.0.1: {}\n\n  caniuse-lite@1.0.30001756: {}\n\n  chokidar@3.6.0:\n    dependencies:\n      anymatch: 3.1.3\n      braces: 3.0.3\n      glob-parent: 5.1.2\n      is-binary-path: 2.1.0\n      is-glob: 4.0.3\n      normalize-path: 3.0.0\n      readdirp: 3.6.0\n    optionalDependencies:\n      fsevents: 2.3.3\n\n  class-variance-authority@0.7.1:\n    dependencies:\n      clsx: 2.1.1\n\n  clsx@2.1.1: {}\n\n  cmdk@1.1.1(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n    dependencies:\n      '@radix-ui/react-compose-refs': 1.1.2(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-dialog': 1.1.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      '@radix-ui/react-id': 1.1.1(@types/react@18.3.27)(react@18.3.1)\n      '@radix-ui/react-primitive': 2.1.4(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    transitivePeerDependencies:\n      - '@types/react'\n      - '@types/react-dom'\n\n  color-convert@2.0.1:\n    dependencies:\n      color-name: 1.1.4\n\n  color-name@1.1.4: {}\n\n  commander@4.1.1: {}\n\n  concat-stream@2.0.0:\n    dependencies:\n      buffer-from: 1.1.2\n      inherits: 2.0.4\n      readable-stream: 3.6.2\n      typedarray: 0.0.6\n\n  connect-pg-simple@10.0.0:\n    dependencies:\n      pg: 8.16.3\n    transitivePeerDependencies:\n      - pg-native\n\n  content-disposition@0.5.4:\n    dependencies:\n      safe-buffer: 5.2.1\n\n  content-type@1.0.5: {}\n\n  convert-source-map@2.0.0: {}\n\n  cookie-signature@1.0.6: {}\n\n  cookie-signature@1.0.7: {}\n\n  cookie@0.7.1: {}\n\n  cookie@0.7.2: {}\n\n  cors@2.8.5:\n    dependencies:\n      object-assign: 4.1.1\n      vary: 1.1.2\n\n  create-require@1.1.1: {}\n\n  cross-spawn@7.0.6:\n    dependencies:\n      path-key: 3.1.1\n      shebang-command: 2.0.0\n      which: 2.0.2\n\n  cssesc@3.0.0: {}\n\n  csstype@3.2.3: {}\n\n  d3-array@3.2.4:\n    dependencies:\n      internmap: 2.0.3\n\n  d3-color@3.1.0: {}\n\n  d3-ease@3.0.1: {}\n\n  d3-format@3.1.0: {}\n\n  d3-interpolate@3.0.1:\n    dependencies:\n      d3-color: 3.1.0\n\n  d3-path@3.1.0: {}\n\n  d3-scale@4.0.2:\n    dependencies:\n      d3-array: 3.2.4\n      d3-format: 3.1.0\n      d3-interpolate: 3.0.1\n      d3-time: 3.1.0\n      d3-time-format: 4.1.0\n\n  d3-shape@3.2.0:\n    dependencies:\n      d3-path: 3.1.0\n\n  d3-time-format@4.1.0:\n    dependencies:\n      d3-time: 3.1.0\n\n  d3-time@3.1.0:\n    dependencies:\n      d3-array: 3.2.4\n\n  d3-timer@3.0.1: {}\n\n  d@1.0.2:\n    dependencies:\n      es5-ext: 0.10.64\n      type: 2.7.3\n\n  date-fns@3.6.0: {}\n\n  debug@2.6.9:\n    dependencies:\n      ms: 2.0.0\n\n  debug@4.4.3:\n    dependencies:\n      ms: 2.1.3\n\n  decimal.js-light@2.5.1: {}\n\n  depd@2.0.0: {}\n\n  destroy@1.2.0: {}\n\n  detect-libc@2.1.2: {}\n\n  detect-node-es@1.1.0: {}\n\n  didyoumean@1.2.2: {}\n\n  diff@4.0.2: {}\n\n  dlv@1.1.3: {}\n\n  dom-helpers@5.2.1:\n    dependencies:\n      '@babel/runtime': 7.28.4\n      csstype: 3.2.3\n\n  dotenv@17.2.3: {}\n\n  drizzle-kit@0.30.6:\n    dependencies:\n      '@drizzle-team/brocli': 0.10.2\n      '@esbuild-kit/esm-loader': 2.6.5\n      esbuild: 0.19.12\n      esbuild-register: 3.6.0(esbuild@0.19.12)\n      gel: 2.2.0\n    transitivePeerDependencies:\n      - supports-color\n\n  drizzle-orm@0.39.3(@neondatabase/serverless@0.10.4)(@types/pg@8.15.6)(pg@8.16.3)(postgres@3.4.7):\n    optionalDependencies:\n      '@neondatabase/serverless': 0.10.4\n      '@types/pg': 8.15.6\n      pg: 8.16.3\n      postgres: 3.4.7\n\n  drizzle-zod@0.7.1(drizzle-orm@0.39.3(@neondatabase/serverless@0.10.4)(@types/pg@8.15.6)(pg@8.16.3)(postgres@3.4.7))(zod@3.25.76):\n    dependencies:\n      drizzle-orm: 0.39.3(@neondatabase/serverless@0.10.4)(@types/pg@8.15.6)(pg@8.16.3)(postgres@3.4.7)\n      zod: 3.25.76\n\n  dunder-proto@1.0.1:\n    dependencies:\n      call-bind-apply-helpers: 1.0.2\n      es-errors: 1.3.0\n      gopd: 1.2.0\n\n  eastasianwidth@0.2.0: {}\n\n  ee-first@1.1.1: {}\n\n  electron-to-chromium@1.5.256: {}\n\n  embla-carousel-react@8.6.0(react@18.3.1):\n    dependencies:\n      embla-carousel: 8.6.0\n      embla-carousel-reactive-utils: 8.6.0(embla-carousel@8.6.0)\n      react: 18.3.1\n\n  embla-carousel-reactive-utils@8.6.0(embla-carousel@8.6.0):\n    dependencies:\n      embla-carousel: 8.6.0\n\n  embla-carousel@8.6.0: {}\n\n  emoji-regex@8.0.0: {}\n\n  emoji-regex@9.2.2: {}\n\n  encodeurl@1.0.2: {}\n\n  encodeurl@2.0.0: {}\n\n  enhanced-resolve@5.18.3:\n    dependencies:\n      graceful-fs: 4.2.11\n      tapable: 2.3.0\n\n  env-paths@3.0.0: {}\n\n  es-define-property@1.0.1: {}\n\n  es-errors@1.3.0: {}\n\n  es-object-atoms@1.1.1:\n    dependencies:\n      es-errors: 1.3.0\n\n  es5-ext@0.10.64:\n    dependencies:\n      es6-iterator: 2.0.3\n      es6-symbol: 3.1.4\n      esniff: 2.0.1\n      next-tick: 1.1.0\n\n  es6-iterator@2.0.3:\n    dependencies:\n      d: 1.0.2\n      es5-ext: 0.10.64\n      es6-symbol: 3.1.4\n\n  es6-symbol@3.1.4:\n    dependencies:\n      d: 1.0.2\n      ext: 1.7.0\n\n  es6-weak-map@2.0.3:\n    dependencies:\n      d: 1.0.2\n      es5-ext: 0.10.64\n      es6-iterator: 2.0.3\n      es6-symbol: 3.1.4\n\n  esbuild-register@3.6.0(esbuild@0.19.12):\n    dependencies:\n      debug: 4.4.3\n      esbuild: 0.19.12\n    transitivePeerDependencies:\n      - supports-color\n\n  esbuild@0.18.20:\n    optionalDependencies:\n      '@esbuild/android-arm': 0.18.20\n      '@esbuild/android-arm64': 0.18.20\n      '@esbuild/android-x64': 0.18.20\n      '@esbuild/darwin-arm64': 0.18.20\n      '@esbuild/darwin-x64': 0.18.20\n      '@esbuild/freebsd-arm64': 0.18.20\n      '@esbuild/freebsd-x64': 0.18.20\n      '@esbuild/linux-arm': 0.18.20\n      '@esbuild/linux-arm64': 0.18.20\n      '@esbuild/linux-ia32': 0.18.20\n      '@esbuild/linux-loong64': 0.18.20\n      '@esbuild/linux-mips64el': 0.18.20\n      '@esbuild/linux-ppc64': 0.18.20\n      '@esbuild/linux-riscv64': 0.18.20\n      '@esbuild/linux-s390x': 0.18.20\n      '@esbuild/linux-x64': 0.18.20\n      '@esbuild/netbsd-x64': 0.18.20\n      '@esbuild/openbsd-x64': 0.18.20\n      '@esbuild/sunos-x64': 0.18.20\n      '@esbuild/win32-arm64': 0.18.20\n      '@esbuild/win32-ia32': 0.18.20\n      '@esbuild/win32-x64': 0.18.20\n\n  esbuild@0.19.12:\n    optionalDependencies:\n      '@esbuild/aix-ppc64': 0.19.12\n      '@esbuild/android-arm': 0.19.12\n      '@esbuild/android-arm64': 0.19.12\n      '@esbuild/android-x64': 0.19.12\n      '@esbuild/darwin-arm64': 0.19.12\n      '@esbuild/darwin-x64': 0.19.12\n      '@esbuild/freebsd-arm64': 0.19.12\n      '@esbuild/freebsd-x64': 0.19.12\n      '@esbuild/linux-arm': 0.19.12\n      '@esbuild/linux-arm64': 0.19.12\n      '@esbuild/linux-ia32': 0.19.12\n      '@esbuild/linux-loong64': 0.19.12\n      '@esbuild/linux-mips64el': 0.19.12\n      '@esbuild/linux-ppc64': 0.19.12\n      '@esbuild/linux-riscv64': 0.19.12\n      '@esbuild/linux-s390x': 0.19.12\n      '@esbuild/linux-x64': 0.19.12\n      '@esbuild/netbsd-x64': 0.19.12\n      '@esbuild/openbsd-x64': 0.19.12\n      '@esbuild/sunos-x64': 0.19.12\n      '@esbuild/win32-arm64': 0.19.12\n      '@esbuild/win32-ia32': 0.19.12\n      '@esbuild/win32-x64': 0.19.12\n\n  esbuild@0.21.5:\n    optionalDependencies:\n      '@esbuild/aix-ppc64': 0.21.5\n      '@esbuild/android-arm': 0.21.5\n      '@esbuild/android-arm64': 0.21.5\n      '@esbuild/android-x64': 0.21.5\n      '@esbuild/darwin-arm64': 0.21.5\n      '@esbuild/darwin-x64': 0.21.5\n      '@esbuild/freebsd-arm64': 0.21.5\n      '@esbuild/freebsd-x64': 0.21.5\n      '@esbuild/linux-arm': 0.21.5\n      '@esbuild/linux-arm64': 0.21.5\n      '@esbuild/linux-ia32': 0.21.5\n      '@esbuild/linux-loong64': 0.21.5\n      '@esbuild/linux-mips64el': 0.21.5\n      '@esbuild/linux-ppc64': 0.21.5\n      '@esbuild/linux-riscv64': 0.21.5\n      '@esbuild/linux-s390x': 0.21.5\n      '@esbuild/linux-x64': 0.21.5\n      '@esbuild/netbsd-x64': 0.21.5\n      '@esbuild/openbsd-x64': 0.21.5\n      '@esbuild/sunos-x64': 0.21.5\n      '@esbuild/win32-arm64': 0.21.5\n      '@esbuild/win32-ia32': 0.21.5\n      '@esbuild/win32-x64': 0.21.5\n\n  esbuild@0.25.12:\n    optionalDependencies:\n      '@esbuild/aix-ppc64': 0.25.12\n      '@esbuild/android-arm': 0.25.12\n      '@esbuild/android-arm64': 0.25.12\n      '@esbuild/android-x64': 0.25.12\n      '@esbuild/darwin-arm64': 0.25.12\n      '@esbuild/darwin-x64': 0.25.12\n      '@esbuild/freebsd-arm64': 0.25.12\n      '@esbuild/freebsd-x64': 0.25.12\n      '@esbuild/linux-arm': 0.25.12\n      '@esbuild/linux-arm64': 0.25.12\n      '@esbuild/linux-ia32': 0.25.12\n      '@esbuild/linux-loong64': 0.25.12\n      '@esbuild/linux-mips64el': 0.25.12\n      '@esbuild/linux-ppc64': 0.25.12\n      '@esbuild/linux-riscv64': 0.25.12\n      '@esbuild/linux-s390x': 0.25.12\n      '@esbuild/linux-x64': 0.25.12\n      '@esbuild/netbsd-arm64': 0.25.12\n      '@esbuild/netbsd-x64': 0.25.12\n      '@esbuild/openbsd-arm64': 0.25.12\n      '@esbuild/openbsd-x64': 0.25.12\n      '@esbuild/openharmony-arm64': 0.25.12\n      '@esbuild/sunos-x64': 0.25.12\n      '@esbuild/win32-arm64': 0.25.12\n      '@esbuild/win32-ia32': 0.25.12\n      '@esbuild/win32-x64': 0.25.12\n\n  escalade@3.2.0: {}\n\n  escape-html@1.0.3: {}\n\n  esniff@2.0.1:\n    dependencies:\n      d: 1.0.2\n      es5-ext: 0.10.64\n      event-emitter: 0.3.5\n      type: 2.7.3\n\n  etag@1.8.1: {}\n\n  event-emitter@0.3.5:\n    dependencies:\n      d: 1.0.2\n      es5-ext: 0.10.64\n\n  eventemitter3@4.0.7: {}\n\n  express-fileupload@1.5.2:\n    dependencies:\n      busboy: 1.6.0\n\n  express-rate-limit@8.2.1(express@4.21.2):\n    dependencies:\n      express: 4.21.2\n      ip-address: 10.0.1\n\n  express-session@1.18.2:\n    dependencies:\n      cookie: 0.7.2\n      cookie-signature: 1.0.7\n      debug: 2.6.9\n      depd: 2.0.0\n      on-headers: 1.1.0\n      parseurl: 1.3.3\n      safe-buffer: 5.2.1\n      uid-safe: 2.1.5\n    transitivePeerDependencies:\n      - supports-color\n\n  express@4.21.2:\n    dependencies:\n      accepts: 1.3.8\n      array-flatten: 1.1.1\n      body-parser: 1.20.3\n      content-disposition: 0.5.4\n      content-type: 1.0.5\n      cookie: 0.7.1\n      cookie-signature: 1.0.6\n      debug: 2.6.9\n      depd: 2.0.0\n      encodeurl: 2.0.0\n      escape-html: 1.0.3\n      etag: 1.8.1\n      finalhandler: 1.3.1\n      fresh: 0.5.2\n      http-errors: 2.0.0\n      merge-descriptors: 1.0.3\n      methods: 1.1.2\n      on-finished: 2.4.1\n      parseurl: 1.3.3\n      path-to-regexp: 0.1.12\n      proxy-addr: 2.0.7\n      qs: 6.13.0\n      range-parser: 1.2.1\n      safe-buffer: 5.2.1\n      send: 0.19.0\n      serve-static: 1.16.2\n      setprototypeof: 1.2.0\n      statuses: 2.0.1\n      type-is: 1.6.18\n      utils-merge: 1.0.1\n      vary: 1.1.2\n    transitivePeerDependencies:\n      - supports-color\n\n  ext@1.7.0:\n    dependencies:\n      type: 2.7.3\n\n  fast-equals@5.3.3: {}\n\n  fast-glob@3.3.3:\n    dependencies:\n      '@nodelib/fs.stat': 2.0.5\n      '@nodelib/fs.walk': 1.2.8\n      glob-parent: 5.1.2\n      merge2: 1.4.1\n      micromatch: 4.0.8\n\n  fastq@1.19.1:\n    dependencies:\n      reusify: 1.1.0\n\n  fill-range@7.1.1:\n    dependencies:\n      to-regex-range: 5.0.1\n\n  finalhandler@1.3.1:\n    dependencies:\n      debug: 2.6.9\n      encodeurl: 2.0.0\n      escape-html: 1.0.3\n      on-finished: 2.4.1\n      parseurl: 1.3.3\n      statuses: 2.0.1\n      unpipe: 1.0.0\n    transitivePeerDependencies:\n      - supports-color\n\n  foreground-child@3.3.1:\n    dependencies:\n      cross-spawn: 7.0.6\n      signal-exit: 4.1.0\n\n  forwarded@0.2.0: {}\n\n  fraction.js@5.3.4: {}\n\n  framer-motion@11.18.2(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n    dependencies:\n      motion-dom: 11.18.1\n      motion-utils: 11.18.1\n      tslib: 2.8.1\n    optionalDependencies:\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n\n  fresh@0.5.2: {}\n\n  fsevents@2.3.3:\n    optional: true\n\n  function-bind@1.1.2: {}\n\n  gel@2.2.0:\n    dependencies:\n      '@petamoriken/float16': 3.9.3\n      debug: 4.4.3\n      env-paths: 3.0.0\n      semver: 7.7.3\n      shell-quote: 1.8.3\n      which: 4.0.0\n    transitivePeerDependencies:\n      - supports-color\n\n  gensync@1.0.0-beta.2: {}\n\n  get-intrinsic@1.3.0:\n    dependencies:\n      call-bind-apply-helpers: 1.0.2\n      es-define-property: 1.0.1\n      es-errors: 1.3.0\n      es-object-atoms: 1.1.1\n      function-bind: 1.1.2\n      get-proto: 1.0.1\n      gopd: 1.2.0\n      has-symbols: 1.1.0\n      hasown: 2.0.2\n      math-intrinsics: 1.1.0\n\n  get-nonce@1.0.1: {}\n\n  get-proto@1.0.1:\n    dependencies:\n      dunder-proto: 1.0.1\n      es-object-atoms: 1.1.1\n\n  get-tsconfig@4.13.0:\n    dependencies:\n      resolve-pkg-maps: 1.0.0\n\n  glob-parent@5.1.2:\n    dependencies:\n      is-glob: 4.0.3\n\n  glob-parent@6.0.2:\n    dependencies:\n      is-glob: 4.0.3\n\n  glob@10.5.0:\n    dependencies:\n      foreground-child: 3.3.1\n      jackspeak: 3.4.3\n      minimatch: 9.0.5\n      minipass: 7.1.2\n      package-json-from-dist: 1.0.1\n      path-scurry: 1.11.1\n\n  gopd@1.2.0: {}\n\n  graceful-fs@4.2.11: {}\n\n  has-symbols@1.1.0: {}\n\n  hasown@2.0.2:\n    dependencies:\n      function-bind: 1.1.2\n\n  http-errors@2.0.0:\n    dependencies:\n      depd: 2.0.0\n      inherits: 2.0.4\n      setprototypeof: 1.2.0\n      statuses: 2.0.1\n      toidentifier: 1.0.1\n\n  iconv-lite@0.4.24:\n    dependencies:\n      safer-buffer: 2.1.2\n\n  inherits@2.0.4: {}\n\n  input-otp@1.4.2(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n    dependencies:\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n\n  internmap@2.0.3: {}\n\n  ip-address@10.0.1: {}\n\n  ipaddr.js@1.9.1: {}\n\n  is-binary-path@2.1.0:\n    dependencies:\n      binary-extensions: 2.3.0\n\n  is-core-module@2.16.1:\n    dependencies:\n      hasown: 2.0.2\n\n  is-extglob@2.1.1: {}\n\n  is-fullwidth-code-point@3.0.0: {}\n\n  is-glob@4.0.3:\n    dependencies:\n      is-extglob: 2.1.1\n\n  is-number@7.0.0: {}\n\n  is-promise@2.2.2: {}\n\n  isexe@2.0.0: {}\n\n  isexe@3.1.1: {}\n\n  jackspeak@3.4.3:\n    dependencies:\n      '@isaacs/cliui': 8.0.2\n    optionalDependencies:\n      '@pkgjs/parseargs': 0.11.0\n\n  jiti@1.21.7: {}\n\n  jiti@2.6.1: {}\n\n  jose@6.1.2: {}\n\n  js-tokens@4.0.0: {}\n\n  jsesc@3.1.0: {}\n\n  json5@2.2.3: {}\n\n  lightningcss-android-arm64@1.30.2:\n    optional: true\n\n  lightningcss-darwin-arm64@1.30.2:\n    optional: true\n\n  lightningcss-darwin-x64@1.30.2:\n    optional: true\n\n  lightningcss-freebsd-x64@1.30.2:\n    optional: true\n\n  lightningcss-linux-arm-gnueabihf@1.30.2:\n    optional: true\n\n  lightningcss-linux-arm64-gnu@1.30.2:\n    optional: true\n\n  lightningcss-linux-arm64-musl@1.30.2:\n    optional: true\n\n  lightningcss-linux-x64-gnu@1.30.2:\n    optional: true\n\n  lightningcss-linux-x64-musl@1.30.2:\n    optional: true\n\n  lightningcss-win32-arm64-msvc@1.30.2:\n    optional: true\n\n  lightningcss-win32-x64-msvc@1.30.2:\n    optional: true\n\n  lightningcss@1.30.2:\n    dependencies:\n      detect-libc: 2.1.2\n    optionalDependencies:\n      lightningcss-android-arm64: 1.30.2\n      lightningcss-darwin-arm64: 1.30.2\n      lightningcss-darwin-x64: 1.30.2\n      lightningcss-freebsd-x64: 1.30.2\n      lightningcss-linux-arm-gnueabihf: 1.30.2\n      lightningcss-linux-arm64-gnu: 1.30.2\n      lightningcss-linux-arm64-musl: 1.30.2\n      lightningcss-linux-x64-gnu: 1.30.2\n      lightningcss-linux-x64-musl: 1.30.2\n      lightningcss-win32-arm64-msvc: 1.30.2\n      lightningcss-win32-x64-msvc: 1.30.2\n\n  lilconfig@3.1.3: {}\n\n  lines-and-columns@1.2.4: {}\n\n  lodash@4.17.21: {}\n\n  loose-envify@1.4.0:\n    dependencies:\n      js-tokens: 4.0.0\n\n  lru-cache@10.4.3: {}\n\n  lru-cache@4.1.5:\n    dependencies:\n      pseudomap: 1.0.2\n      yallist: 2.1.2\n\n  lru-cache@5.1.1:\n    dependencies:\n      yallist: 3.1.1\n\n  lru-queue@0.1.0:\n    dependencies:\n      es5-ext: 0.10.64\n\n  lucide-react@0.453.0(react@18.3.1):\n    dependencies:\n      react: 18.3.1\n\n  magic-string@0.30.21:\n    dependencies:\n      '@jridgewell/sourcemap-codec': 1.5.5\n\n  make-error@1.3.6: {}\n\n  math-intrinsics@1.1.0: {}\n\n  media-typer@0.3.0: {}\n\n  memoizee@0.4.17:\n    dependencies:\n      d: 1.0.2\n      es5-ext: 0.10.64\n      es6-weak-map: 2.0.3\n      event-emitter: 0.3.5\n      is-promise: 2.2.2\n      lru-queue: 0.1.0\n      next-tick: 1.1.0\n      timers-ext: 0.1.8\n\n  memorystore@1.6.7:\n    dependencies:\n      debug: 4.4.3\n      lru-cache: 4.1.5\n    transitivePeerDependencies:\n      - supports-color\n\n  merge-descriptors@1.0.3: {}\n\n  merge2@1.4.1: {}\n\n  methods@1.1.2: {}\n\n  micromatch@4.0.8:\n    dependencies:\n      braces: 3.0.3\n      picomatch: 2.3.1\n\n  mime-db@1.52.0: {}\n\n  mime-types@2.1.35:\n    dependencies:\n      mime-db: 1.52.0\n\n  mime@1.6.0: {}\n\n  minimatch@9.0.5:\n    dependencies:\n      brace-expansion: 2.0.2\n\n  minimist@1.2.8: {}\n\n  minipass@7.1.2: {}\n\n  mitt@3.0.1: {}\n\n  mkdirp@0.5.6:\n    dependencies:\n      minimist: 1.2.8\n\n  modern-screenshot@4.6.7: {}\n\n  motion-dom@11.18.1:\n    dependencies:\n      motion-utils: 11.18.1\n\n  motion-utils@11.18.1: {}\n\n  ms@2.0.0: {}\n\n  ms@2.1.3: {}\n\n  multer@2.0.2:\n    dependencies:\n      append-field: 1.0.0\n      busboy: 1.6.0\n      concat-stream: 2.0.0\n      mkdirp: 0.5.6\n      object-assign: 4.1.1\n      type-is: 1.6.18\n      xtend: 4.0.2\n\n  mz@2.7.0:\n    dependencies:\n      any-promise: 1.3.0\n      object-assign: 4.1.1\n      thenify-all: 1.6.0\n\n  nanoid@3.3.11: {}\n\n  nanoid@5.1.6: {}\n\n  negotiator@0.6.3: {}\n\n  next-tick@1.1.0: {}\n\n  node-addon-api@8.5.0: {}\n\n  node-gyp-build@4.8.4: {}\n\n  node-releases@2.0.27: {}\n\n  normalize-path@3.0.0: {}\n\n  normalize-range@0.1.2: {}\n\n  oauth4webapi@3.8.2: {}\n\n  object-assign@4.1.1: {}\n\n  object-hash@3.0.0: {}\n\n  object-inspect@1.13.4: {}\n\n  obuf@1.1.2: {}\n\n  on-finished@2.4.1:\n    dependencies:\n      ee-first: 1.1.1\n\n  on-headers@1.1.0: {}\n\n  openid-client@6.8.1:\n    dependencies:\n      jose: 6.1.2\n      oauth4webapi: 3.8.2\n\n  package-json-from-dist@1.0.1: {}\n\n  parseurl@1.3.3: {}\n\n  passport-local@1.0.0:\n    dependencies:\n      passport-strategy: 1.0.0\n\n  passport-strategy@1.0.0: {}\n\n  passport@0.7.0:\n    dependencies:\n      passport-strategy: 1.0.0\n      pause: 0.0.1\n      utils-merge: 1.0.1\n\n  path-key@3.1.1: {}\n\n  path-parse@1.0.7: {}\n\n  path-scurry@1.11.1:\n    dependencies:\n      lru-cache: 10.4.3\n      minipass: 7.1.2\n\n  path-to-regexp@0.1.12: {}\n\n  pause@0.0.1: {}\n\n  pg-cloudflare@1.2.7:\n    optional: true\n\n  pg-connection-string@2.9.1: {}\n\n  pg-int8@1.0.1: {}\n\n  pg-numeric@1.0.2: {}\n\n  pg-pool@3.10.1(pg@8.16.3):\n    dependencies:\n      pg: 8.16.3\n\n  pg-protocol@1.10.3: {}\n\n  pg-types@2.2.0:\n    dependencies:\n      pg-int8: 1.0.1\n      postgres-array: 2.0.0\n      postgres-bytea: 1.0.0\n      postgres-date: 1.0.7\n      postgres-interval: 1.2.0\n\n  pg-types@4.1.0:\n    dependencies:\n      pg-int8: 1.0.1\n      pg-numeric: 1.0.2\n      postgres-array: 3.0.4\n      postgres-bytea: 3.0.0\n      postgres-date: 2.1.0\n      postgres-interval: 3.0.0\n      postgres-range: 1.1.4\n\n  pg@8.16.3:\n    dependencies:\n      pg-connection-string: 2.9.1\n      pg-pool: 3.10.1(pg@8.16.3)\n      pg-protocol: 1.10.3\n      pg-types: 2.2.0\n      pgpass: 1.0.5\n    optionalDependencies:\n      pg-cloudflare: 1.2.7\n\n  pgpass@1.0.5:\n    dependencies:\n      split2: 4.2.0\n\n  picocolors@1.1.1: {}\n\n  picomatch@2.3.1: {}\n\n  pify@2.3.0: {}\n\n  pirates@4.0.7: {}\n\n  postcss-import@15.1.0(postcss@8.5.6):\n    dependencies:\n      postcss: 8.5.6\n      postcss-value-parser: 4.2.0\n      read-cache: 1.0.0\n      resolve: 1.22.11\n\n  postcss-js@4.1.0(postcss@8.5.6):\n    dependencies:\n      camelcase-css: 2.0.1\n      postcss: 8.5.6\n\n  postcss-load-config@6.0.1(jiti@1.21.7)(postcss@8.5.6)(tsx@4.20.6):\n    dependencies:\n      lilconfig: 3.1.3\n    optionalDependencies:\n      jiti: 1.21.7\n      postcss: 8.5.6\n      tsx: 4.20.6\n\n  postcss-nested@6.2.0(postcss@8.5.6):\n    dependencies:\n      postcss: 8.5.6\n      postcss-selector-parser: 6.1.2\n\n  postcss-selector-parser@6.0.10:\n    dependencies:\n      cssesc: 3.0.0\n      util-deprecate: 1.0.2\n\n  postcss-selector-parser@6.1.2:\n    dependencies:\n      cssesc: 3.0.0\n      util-deprecate: 1.0.2\n\n  postcss-value-parser@4.2.0: {}\n\n  postcss@8.5.6:\n    dependencies:\n      nanoid: 3.3.11\n      picocolors: 1.1.1\n      source-map-js: 1.2.1\n\n  postgres-array@2.0.0: {}\n\n  postgres-array@3.0.4: {}\n\n  postgres-bytea@1.0.0: {}\n\n  postgres-bytea@3.0.0:\n    dependencies:\n      obuf: 1.1.2\n\n  postgres-date@1.0.7: {}\n\n  postgres-date@2.1.0: {}\n\n  postgres-interval@1.2.0:\n    dependencies:\n      xtend: 4.0.2\n\n  postgres-interval@3.0.0: {}\n\n  postgres-range@1.1.4: {}\n\n  postgres@3.4.7: {}\n\n  prop-types@15.8.1:\n    dependencies:\n      loose-envify: 1.4.0\n      object-assign: 4.1.1\n      react-is: 16.13.1\n\n  proxy-addr@2.0.7:\n    dependencies:\n      forwarded: 0.2.0\n      ipaddr.js: 1.9.1\n\n  pseudomap@1.0.2: {}\n\n  qs@6.13.0:\n    dependencies:\n      side-channel: 1.1.0\n\n  queue-microtask@1.2.3: {}\n\n  random-bytes@1.0.0: {}\n\n  range-parser@1.2.1: {}\n\n  raw-body@2.5.2:\n    dependencies:\n      bytes: 3.1.2\n      http-errors: 2.0.0\n      iconv-lite: 0.4.24\n      unpipe: 1.0.0\n\n  react-day-picker@8.10.1(date-fns@3.6.0)(react@18.3.1):\n    dependencies:\n      date-fns: 3.6.0\n      react: 18.3.1\n\n  react-dom@18.3.1(react@18.3.1):\n    dependencies:\n      loose-envify: 1.4.0\n      react: 18.3.1\n      scheduler: 0.23.2\n\n  react-hook-form@7.66.1(react@18.3.1):\n    dependencies:\n      react: 18.3.1\n\n  react-icons@5.5.0(react@18.3.1):\n    dependencies:\n      react: 18.3.1\n\n  react-is@16.13.1: {}\n\n  react-is@18.3.1: {}\n\n  react-refresh@0.17.0: {}\n\n  react-remove-scroll-bar@2.3.8(@types/react@18.3.27)(react@18.3.1):\n    dependencies:\n      react: 18.3.1\n      react-style-singleton: 2.2.3(@types/react@18.3.27)(react@18.3.1)\n      tslib: 2.8.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  react-remove-scroll@2.7.1(@types/react@18.3.27)(react@18.3.1):\n    dependencies:\n      react: 18.3.1\n      react-remove-scroll-bar: 2.3.8(@types/react@18.3.27)(react@18.3.1)\n      react-style-singleton: 2.2.3(@types/react@18.3.27)(react@18.3.1)\n      tslib: 2.8.1\n      use-callback-ref: 1.3.3(@types/react@18.3.27)(react@18.3.1)\n      use-sidecar: 1.1.3(@types/react@18.3.27)(react@18.3.1)\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  react-resizable-panels@2.1.9(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n    dependencies:\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n\n  react-smooth@4.0.4(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n    dependencies:\n      fast-equals: 5.3.3\n      prop-types: 15.8.1\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n      react-transition-group: 4.4.5(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n\n  react-style-singleton@2.2.3(@types/react@18.3.27)(react@18.3.1):\n    dependencies:\n      get-nonce: 1.0.1\n      react: 18.3.1\n      tslib: 2.8.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  react-transition-group@4.4.5(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n    dependencies:\n      '@babel/runtime': 7.28.4\n      dom-helpers: 5.2.1\n      loose-envify: 1.4.0\n      prop-types: 15.8.1\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n\n  react@18.3.1:\n    dependencies:\n      loose-envify: 1.4.0\n\n  read-cache@1.0.0:\n    dependencies:\n      pify: 2.3.0\n\n  readable-stream@3.6.2:\n    dependencies:\n      inherits: 2.0.4\n      string_decoder: 1.3.0\n      util-deprecate: 1.0.2\n\n  readdirp@3.6.0:\n    dependencies:\n      picomatch: 2.3.1\n\n  recharts-scale@0.4.5:\n    dependencies:\n      decimal.js-light: 2.5.1\n\n  recharts@2.15.4(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n    dependencies:\n      clsx: 2.1.1\n      eventemitter3: 4.0.7\n      lodash: 4.17.21\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n      react-is: 18.3.1\n      react-smooth: 4.0.4(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      recharts-scale: 0.4.5\n      tiny-invariant: 1.3.3\n      victory-vendor: 36.9.2\n\n  regexparam@3.0.0: {}\n\n  resolve-pkg-maps@1.0.0: {}\n\n  resolve@1.22.11:\n    dependencies:\n      is-core-module: 2.16.1\n      path-parse: 1.0.7\n      supports-preserve-symlinks-flag: 1.0.0\n\n  reusify@1.1.0: {}\n\n  rollup@4.53.3:\n    dependencies:\n      '@types/estree': 1.0.8\n    optionalDependencies:\n      '@rollup/rollup-android-arm-eabi': 4.53.3\n      '@rollup/rollup-android-arm64': 4.53.3\n      '@rollup/rollup-darwin-arm64': 4.53.3\n      '@rollup/rollup-darwin-x64': 4.53.3\n      '@rollup/rollup-freebsd-arm64': 4.53.3\n      '@rollup/rollup-freebsd-x64': 4.53.3\n      '@rollup/rollup-linux-arm-gnueabihf': 4.53.3\n      '@rollup/rollup-linux-arm-musleabihf': 4.53.3\n      '@rollup/rollup-linux-arm64-gnu': 4.53.3\n      '@rollup/rollup-linux-arm64-musl': 4.53.3\n      '@rollup/rollup-linux-loong64-gnu': 4.53.3\n      '@rollup/rollup-linux-ppc64-gnu': 4.53.3\n      '@rollup/rollup-linux-riscv64-gnu': 4.53.3\n      '@rollup/rollup-linux-riscv64-musl': 4.53.3\n      '@rollup/rollup-linux-s390x-gnu': 4.53.3\n      '@rollup/rollup-linux-x64-gnu': 4.53.3\n      '@rollup/rollup-linux-x64-musl': 4.53.3\n      '@rollup/rollup-openharmony-arm64': 4.53.3\n      '@rollup/rollup-win32-arm64-msvc': 4.53.3\n      '@rollup/rollup-win32-ia32-msvc': 4.53.3\n      '@rollup/rollup-win32-x64-gnu': 4.53.3\n      '@rollup/rollup-win32-x64-msvc': 4.53.3\n      fsevents: 2.3.3\n\n  run-parallel@1.2.0:\n    dependencies:\n      queue-microtask: 1.2.3\n\n  safe-buffer@5.2.1: {}\n\n  safer-buffer@2.1.2: {}\n\n  scheduler@0.23.2:\n    dependencies:\n      loose-envify: 1.4.0\n\n  semver@6.3.1: {}\n\n  semver@7.7.3: {}\n\n  send@0.19.0:\n    dependencies:\n      debug: 2.6.9\n      depd: 2.0.0\n      destroy: 1.2.0\n      encodeurl: 1.0.2\n      escape-html: 1.0.3\n      etag: 1.8.1\n      fresh: 0.5.2\n      http-errors: 2.0.0\n      mime: 1.6.0\n      ms: 2.1.3\n      on-finished: 2.4.1\n      range-parser: 1.2.1\n      statuses: 2.0.1\n    transitivePeerDependencies:\n      - supports-color\n\n  serve-static@1.16.2:\n    dependencies:\n      encodeurl: 2.0.0\n      escape-html: 1.0.3\n      parseurl: 1.3.3\n      send: 0.19.0\n    transitivePeerDependencies:\n      - supports-color\n\n  setprototypeof@1.2.0: {}\n\n  shebang-command@2.0.0:\n    dependencies:\n      shebang-regex: 3.0.0\n\n  shebang-regex@3.0.0: {}\n\n  shell-quote@1.8.3: {}\n\n  side-channel-list@1.0.0:\n    dependencies:\n      es-errors: 1.3.0\n      object-inspect: 1.13.4\n\n  side-channel-map@1.0.1:\n    dependencies:\n      call-bound: 1.0.4\n      es-errors: 1.3.0\n      get-intrinsic: 1.3.0\n      object-inspect: 1.13.4\n\n  side-channel-weakmap@1.0.2:\n    dependencies:\n      call-bound: 1.0.4\n      es-errors: 1.3.0\n      get-intrinsic: 1.3.0\n      object-inspect: 1.13.4\n      side-channel-map: 1.0.1\n\n  side-channel@1.1.0:\n    dependencies:\n      es-errors: 1.3.0\n      object-inspect: 1.13.4\n      side-channel-list: 1.0.0\n      side-channel-map: 1.0.1\n      side-channel-weakmap: 1.0.2\n\n  signal-exit@4.1.0: {}\n\n  source-map-js@1.2.1: {}\n\n  source-map-support@0.5.21:\n    dependencies:\n      buffer-from: 1.1.2\n      source-map: 0.6.1\n\n  source-map@0.6.1: {}\n\n  split2@4.2.0: {}\n\n  statuses@2.0.1: {}\n\n  streamsearch@1.1.0: {}\n\n  string-width@4.2.3:\n    dependencies:\n      emoji-regex: 8.0.0\n      is-fullwidth-code-point: 3.0.0\n      strip-ansi: 6.0.1\n\n  string-width@5.1.2:\n    dependencies:\n      eastasianwidth: 0.2.0\n      emoji-regex: 9.2.2\n      strip-ansi: 7.1.2\n\n  string_decoder@1.3.0:\n    dependencies:\n      safe-buffer: 5.2.1\n\n  strip-ansi@6.0.1:\n    dependencies:\n      ansi-regex: 5.0.1\n\n  strip-ansi@7.1.2:\n    dependencies:\n      ansi-regex: 6.2.2\n\n  sucrase@3.35.0:\n    dependencies:\n      '@jridgewell/gen-mapping': 0.3.13\n      commander: 4.1.1\n      glob: 10.5.0\n      lines-and-columns: 1.2.4\n      mz: 2.7.0\n      pirates: 4.0.7\n      ts-interface-checker: 0.1.13\n\n  supports-preserve-symlinks-flag@1.0.0: {}\n\n  tailwind-merge@2.6.0: {}\n\n  tailwindcss-animate@1.0.7(tailwindcss@3.4.18(tsx@4.20.6)):\n    dependencies:\n      tailwindcss: 3.4.18(tsx@4.20.6)\n\n  tailwindcss@3.4.18(tsx@4.20.6):\n    dependencies:\n      '@alloc/quick-lru': 5.2.0\n      arg: 5.0.2\n      chokidar: 3.6.0\n      didyoumean: 1.2.2\n      dlv: 1.1.3\n      fast-glob: 3.3.3\n      glob-parent: 6.0.2\n      is-glob: 4.0.3\n      jiti: 1.21.7\n      lilconfig: 3.1.3\n      micromatch: 4.0.8\n      normalize-path: 3.0.0\n      object-hash: 3.0.0\n      picocolors: 1.1.1\n      postcss: 8.5.6\n      postcss-import: 15.1.0(postcss@8.5.6)\n      postcss-js: 4.1.0(postcss@8.5.6)\n      postcss-load-config: 6.0.1(jiti@1.21.7)(postcss@8.5.6)(tsx@4.20.6)\n      postcss-nested: 6.2.0(postcss@8.5.6)\n      postcss-selector-parser: 6.1.2\n      resolve: 1.22.11\n      sucrase: 3.35.0\n    transitivePeerDependencies:\n      - tsx\n      - yaml\n\n  tailwindcss@4.1.17: {}\n\n  tapable@2.3.0: {}\n\n  thenify-all@1.6.0:\n    dependencies:\n      thenify: 3.3.1\n\n  thenify@3.3.1:\n    dependencies:\n      any-promise: 1.3.0\n\n  timers-ext@0.1.8:\n    dependencies:\n      es5-ext: 0.10.64\n      next-tick: 1.1.0\n\n  tiny-invariant@1.3.3: {}\n\n  to-regex-range@5.0.1:\n    dependencies:\n      is-number: 7.0.0\n\n  toidentifier@1.0.1: {}\n\n  ts-interface-checker@0.1.13: {}\n\n  ts-node@10.9.2(@types/node@20.16.11)(typescript@5.9.3):\n    dependencies:\n      '@cspotcode/source-map-support': 0.8.1\n      '@tsconfig/node10': 1.0.12\n      '@tsconfig/node12': 1.0.11\n      '@tsconfig/node14': 1.0.3\n      '@tsconfig/node16': 1.0.4\n      '@types/node': 20.16.11\n      acorn: 8.15.0\n      acorn-walk: 8.3.4\n      arg: 4.1.3\n      create-require: 1.1.1\n      diff: 4.0.2\n      make-error: 1.3.6\n      typescript: 5.9.3\n      v8-compile-cache-lib: 3.0.1\n      yn: 3.1.1\n\n  tslib@2.8.1: {}\n\n  tsx@4.20.6:\n    dependencies:\n      esbuild: 0.25.12\n      get-tsconfig: 4.13.0\n    optionalDependencies:\n      fsevents: 2.3.3\n\n  tw-animate-css@1.4.0: {}\n\n  type-is@1.6.18:\n    dependencies:\n      media-typer: 0.3.0\n      mime-types: 2.1.35\n\n  type@2.7.3: {}\n\n  typedarray@0.0.6: {}\n\n  typescript@5.9.3: {}\n\n  uid-safe@2.1.5:\n    dependencies:\n      random-bytes: 1.0.0\n\n  undici-types@6.19.8: {}\n\n  unpipe@1.0.0: {}\n\n  update-browserslist-db@1.1.4(browserslist@4.28.0):\n    dependencies:\n      browserslist: 4.28.0\n      escalade: 3.2.0\n      picocolors: 1.1.1\n\n  use-callback-ref@1.3.3(@types/react@18.3.27)(react@18.3.1):\n    dependencies:\n      react: 18.3.1\n      tslib: 2.8.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  use-sidecar@1.1.3(@types/react@18.3.27)(react@18.3.1):\n    dependencies:\n      detect-node-es: 1.1.0\n      react: 18.3.1\n      tslib: 2.8.1\n    optionalDependencies:\n      '@types/react': 18.3.27\n\n  use-sync-external-store@1.6.0(react@18.3.1):\n    dependencies:\n      react: 18.3.1\n\n  util-deprecate@1.0.2: {}\n\n  utils-merge@1.0.1: {}\n\n  v8-compile-cache-lib@3.0.1: {}\n\n  vary@1.1.2: {}\n\n  vaul@1.1.2(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n    dependencies:\n      '@radix-ui/react-dialog': 1.1.15(@types/react-dom@18.3.7(@types/react@18.3.27))(@types/react@18.3.27)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n      react: 18.3.1\n      react-dom: 18.3.1(react@18.3.1)\n    transitivePeerDependencies:\n      - '@types/react'\n      - '@types/react-dom'\n\n  victory-vendor@36.9.2:\n    dependencies:\n      '@types/d3-array': 3.2.2\n      '@types/d3-ease': 3.0.2\n      '@types/d3-interpolate': 3.0.4\n      '@types/d3-scale': 4.0.9\n      '@types/d3-shape': 3.1.7\n      '@types/d3-time': 3.0.4\n      '@types/d3-timer': 3.0.2\n      d3-array: 3.2.4\n      d3-ease: 3.0.1\n      d3-interpolate: 3.0.1\n      d3-scale: 4.0.2\n      d3-shape: 3.2.0\n      d3-time: 3.1.0\n      d3-timer: 3.0.1\n\n  vite@5.4.21(@types/node@20.16.11)(lightningcss@1.30.2):\n    dependencies:\n      esbuild: 0.21.5\n      postcss: 8.5.6\n      rollup: 4.53.3\n    optionalDependencies:\n      '@types/node': 20.16.11\n      fsevents: 2.3.3\n      lightningcss: 1.30.2\n\n  which@2.0.2:\n    dependencies:\n      isexe: 2.0.0\n\n  which@4.0.0:\n    dependencies:\n      isexe: 3.1.1\n\n  wouter@3.7.1(react@18.3.1):\n    dependencies:\n      mitt: 3.0.1\n      react: 18.3.1\n      regexparam: 3.0.0\n      use-sync-external-store: 1.6.0(react@18.3.1)\n\n  wrap-ansi@7.0.0:\n    dependencies:\n      ansi-styles: 4.3.0\n      string-width: 4.2.3\n      strip-ansi: 6.0.1\n\n  wrap-ansi@8.1.0:\n    dependencies:\n      ansi-styles: 6.2.3\n      string-width: 5.1.2\n      strip-ansi: 7.1.2\n\n  ws@8.18.3(bufferutil@4.0.9):\n    optionalDependencies:\n      bufferutil: 4.0.9\n\n  xtend@4.0.2: {}\n\n  yallist@2.1.2: {}\n\n  yallist@3.1.1: {}\n\n  yn@3.1.1: {}\n\n  zod-validation-error@3.5.4(zod@3.25.76):\n    dependencies:\n      zod: 3.25.76\n\n  zod@3.25.76: {}\n","path":null,"size_bytes":250953,"size_tokens":null},"client/src/components/media-library.tsx":{"content":"\nimport React, { useState, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\nimport { Trash2, Upload, Image as ImageIcon, Search } from \"lucide-react\";\n\ninterface MediaItem {\n  id: string;\n  filename: string;\n  url: string;\n  size: number;\n  uploadedAt: string;\n  contentType: string;\n}\n\ninterface MediaLibraryProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSelect?: (imageUrl: string) => void;\n  allowUpload?: boolean;\n  allowDelete?: boolean;\n}\n\nexport default function MediaLibrary({\n  isOpen,\n  onClose,\n  onSelect,\n  allowUpload = true,\n  allowDelete = true,\n}: MediaLibraryProps) {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedImage, setSelectedImage] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: images = [], isLoading } = useQuery({\n    queryKey: [\"/api/media\"],\n    enabled: isOpen,\n  });\n\n  const uploadMutation = useMutation({\n    mutationFn: async (file: File) => {\n      const formData = new FormData();\n      formData.append(\"image\", file);\n      \n      const response = await fetch(\"/api/media/upload\", {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n      \n      if (!response.ok) {\n        throw new Error(\"Failed to upload image\");\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/media\"] });\n      toast({\n        title: \"Success\",\n        description: \"Image uploaded successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to upload image\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (imageId: string) => {\n      await apiRequest(\"DELETE\", `/api/media/${imageId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/media\"] });\n      toast({\n        title: \"Success\",\n        description: \"Image deleted successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete image\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    if (!file.type.startsWith(\"image/\")) {\n      toast({\n        title: \"Error\",\n        description: \"Please select a valid image file\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate file size (5MB limit)\n    if (file.size > 5 * 1024 * 1024) {\n      toast({\n        title: \"Error\",\n        description: \"Image size must be less than 5MB\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    uploadMutation.mutate(file);\n  };\n\n  const handleImageSelect = (imageUrl: string) => {\n    if (onSelect) {\n      onSelect(imageUrl);\n      onClose();\n    } else {\n      setSelectedImage(imageUrl);\n    }\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return \"0 Bytes\";\n    const k = 1024;\n    const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\n  };\n\n  const filteredImages = images.filter((image: MediaItem) =>\n    image.filename.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-hidden\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <ImageIcon className=\"h-5 w-5\" />\n            Media Library\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          {/* Upload Section */}\n          {allowUpload && (\n            <div className=\"flex items-center gap-4 p-4 border rounded-lg bg-gray-50\">\n              <Button\n                onClick={() => fileInputRef.current?.click()}\n                disabled={uploadMutation.isPending}\n                className=\"gap-2\"\n              >\n                <Upload className=\"h-4 w-4\" />\n                {uploadMutation.isPending ? \"Uploading...\" : \"Upload Image\"}\n              </Button>\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"image/*\"\n                onChange={handleFileSelect}\n                className=\"hidden\"\n              />\n              <span className=\"text-sm text-gray-600\">\n                Supports JPG, PNG, GIF up to 5MB\n              </span>\n            </div>\n          )}\n\n          {/* Search */}\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n            <Input\n              placeholder=\"Search images...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10\"\n            />\n          </div>\n\n          {/* Images Grid */}\n          <div className=\"max-h-[60vh] overflow-y-auto\">\n            {isLoading ? (\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                {[1, 2, 3, 4, 5, 6, 7, 8].map((i) => (\n                  <div\n                    key={i}\n                    className=\"aspect-square bg-gray-200 rounded-lg animate-pulse\"\n                  />\n                ))}\n              </div>\n            ) : filteredImages.length > 0 ? (\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                {filteredImages.map((image: MediaItem) => (\n                  <Card\n                    key={image.id}\n                    className={`cursor-pointer transition-all hover:shadow-lg ${\n                      selectedImage === image.url\n                        ? \"ring-2 ring-blue-500\"\n                        : \"\"\n                    }`}\n                    onClick={() => handleImageSelect(image.url)}\n                  >\n                    <CardContent className=\"p-2\">\n                      <div className=\"aspect-square relative mb-2\">\n                        <img\n                          src={image.url}\n                          alt={image.filename}\n                          className=\"w-full h-full object-cover rounded\"\n                          loading=\"lazy\"\n                        />\n                        {allowDelete && (\n                          <DeleteConfirmationDialog\n                            trigger={\n                              <Button\n                                size=\"sm\"\n                                variant=\"destructive\"\n                                className=\"absolute top-1 right-1 h-6 w-6 p-0\"\n                                onClick={(e) => e.stopPropagation()}\n                              >\n                                <Trash2 className=\"h-3 w-3\" />\n                              </Button>\n                            }\n                            title=\"Delete Image\"\n                            itemName={image.filename}\n                            onConfirm={() => deleteMutation.mutate(image.id)}\n                            isLoading={deleteMutation.isPending}\n                          />\n                        )}\n                      </div>\n                      <div className=\"space-y-1\">\n                        <p className=\"text-xs font-medium truncate\">\n                          {image.filename}\n                        </p>\n                        <div className=\"flex items-center justify-between\">\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            {formatFileSize(image.size)}\n                          </Badge>\n                          <Badge variant=\"outline\" className=\"text-xs\">\n                            {image.contentType.split(\"/\")[1].toUpperCase()}\n                          </Badge>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-12\">\n                <ImageIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-medium text-gray-600 mb-2\">\n                  No images found\n                </h3>\n                <p className=\"text-gray-500\">\n                  {searchQuery\n                    ? \"Try adjusting your search criteria\"\n                    : \"Upload your first image to get started\"}\n                </p>\n              </div>\n            )}\n          </div>\n\n          {/* Actions */}\n          {onSelect && (\n            <div className=\"flex justify-end gap-2 pt-4 border-t\">\n              <Button variant=\"outline\" onClick={onClose}>\n                Cancel\n              </Button>\n              <Button\n                onClick={() => {\n                  if (selectedImage) {\n                    onSelect(selectedImage);\n                    onClose();\n                  }\n                }}\n                disabled={!selectedImage}\n              >\n                Select Image\n              </Button>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":9984,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"\"use client\";\n\nimport * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\nimport { cn } from \"@/lib/utils\";\n\n// Define button variants using `cva`\nexport const buttonVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-gradient-to-r from-orange-400 via-orange-500 to-orange-600 text-white shadow-sm hover:shadow focus:ring-orange-300/50 hover:from-orange-500 hover:to-orange-600\",\n        outline:\n          \"border border-gray-300 bg-white text-gray-700 shadow-sm hover:bg-gray-50 hover:border-gray-400 focus:ring-blue-500/30 disabled:bg-white disabled:text-gray-400\",\n        secondary:\n          \"bg-gray-100 text-gray-800 hover:bg-gray-200 focus:ring-gray-300/50 disabled:bg-gray-100\",\n        ghost:\n          \"hover:bg-gray-100 hover:text-gray-900 focus:ring-gray-300/50 disabled:text-gray-400\",\n        link: \"text-blue-600 underline-offset-4 hover:underline focus:ring-0 focus:underline disabled:text-blue-400\",\n      },\n      size: {\n        default: \"h-10 px-6 py-2 rounded-lg\",\n        sm: \"h-8 px-3 rounded-md text-xs\",\n        lg: \"h-12 px-8 rounded-xl text-base font-semibold\",\n        icon: \"h-10 w-10 rounded-lg p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\n// Button component props\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\n// Main Button component\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\";\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    );\n  },\n);\nButton.displayName = \"Button\";\n\nexport { Button };\n","path":null,"size_bytes":2213,"size_tokens":null},"client/src/components/product-form-enhanced.tsx":{"content":"import React, { useEffect, useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertProductSchema } from \"@shared/schema\";\nimport {\n  Form,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport MediaLibrary from \"./media-library\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Calculator, Plus, Trash2 } from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { useUnits } from \"@/hooks/useUnits\";\nimport { z } from \"zod\";\n\nconst productFormSchema = insertProductSchema.extend({\n  categoryId: z.string().optional(),\n  unitId: z.string().optional(),\n  price: z.string().min(1, \"Price is required\"),\n  cost: z.string().min(1, \"Cost is required\"),\n  margin: z.string().min(1, \"Margin is required\"),\n\n  ingredients: z\n    .array(\n      z.object({\n        inventoryItemId: z.string().min(1, \"Ingredient is required\"),\n        quantity: z.string().min(1, \"Quantity is required\"),\n      }),\n    )\n    .default([]),\n});\n\ninterface ProductFormProps {\n  product?: any;\n  onSuccess?: () => void;\n}\n\nexport default function ProductFormEnhanced({\n  product,\n  onSuccess,\n}: ProductFormProps) {\n  const [showMediaLibrary, setShowMediaLibrary] = useState(false);\n  const [selectedImage, setSelectedImage] = useState<string>(\"\");\n  const [activeTab, setActiveTab] = useState(\"basic\");\n  const [calculations, setCalculations] = useState({\n    subTotalForBatch: 0,\n    totalForProduction: 0,\n    effectiveUnits: 0,\n    rmCostPerUnit: 0,\n    effectiveUnitsProduced: 0,\n    estimatedCostPerUnit: 0,\n    mfgCostPerUnit: 0,\n    overheadCostPerUnit: 0,\n    finalCostPerUnit: 0,\n  });\n  const { toast } = useToast();\n  const { symbol, formatCurrency } = useCurrency();\n\n  const { data: categories = [] } = useQuery({\n    queryKey: [\"/api/categories\"],\n  });\n\n  const { data: units = [] } = useUnits();\n\n  const { data: inventoryItems = [] } = useQuery({\n    queryKey: [\"/api/inventory/all\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/inventory/all\"),\n  });\n\n  const form = useForm({\n    resolver: zodResolver(productFormSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      categoryId: \"\",\n      unitId: \"\",\n      price: \"\",\n      cost: \"\",\n      margin: \"\",\n      sku: \"\",\n      batchSize: \"1\",\n      finishedGoodRequired: \"1\",\n      productionQuantity: \"1\",\n      normalLossMfg: \"5\",\n      normalLossOnSold: \"0\",\n      mfgAndPackagingCost: \"45\",\n      overheadCost: \"5\",\n      ingredients: [],\n    },\n  });\n\n  const { fields, append, remove } = useFieldArray({\n    control: form.control,\n    name: \"ingredients\",\n  });\n\n  useEffect(() => {\n    if (product) {\n      form.reset({\n        name: product.name || \"\",\n        description: product.description || \"\",\n        categoryId: product.categoryId?.toString() || \"\",\n        unitId: product.unitId?.toString() || \"\",\n        price: product.price?.toString() || \"\",\n        cost: product.cost?.toString() || \"\",\n        margin: product.margin?.toString() || \"\",\n        sku: product.sku || \"\",\n        batchSize: \"1\",\n        finishedGoodRequired: \"1\",\n        productionQuantity: \"1\",\n        normalLossMfg: \"5\",\n        normalLossOnSold: \"0\",\n        mfgAndPackagingCost: \"45\",\n        overheadCost: \"5\",\n        ingredients: [],\n      });\n      setSelectedImage(product.imageUrl || \"\");\n    }\n  }, [product, form]);\n\n  const mutation = useMutation({\n    mutationFn: async (data: any) => {\n      const transformedData = {\n        ...data,\n        categoryId: data.categoryId ? parseInt(data.categoryId) : null,\n        unitId: data.unitId ? parseInt(data.unitId) : null,\n        price: parseFloat(data.price),\n        cost: parseFloat(data.cost),\n        margin: parseFloat(data.margin),\n        imageUrl: selectedImage || null,\n      };\n\n      if (product) {\n        await apiRequest(\"PUT\", `/api/products/${product.id}`, transformedData);\n      } else {\n        await apiRequest(\"POST\", \"/api/products\", transformedData);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n      toast({\n        title: \"Success\",\n        description: product\n          ? \"Product updated successfully\"\n          : \"Product created successfully\",\n      });\n      onSuccess?.();\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: product\n          ? \"Failed to update product\"\n          : \"Failed to create product\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const calculateMargin = () => {\n    const price = parseFloat(form.getValues(\"price\") || \"0\");\n    const cost = parseFloat(form.getValues(\"cost\") || \"0\");\n\n    if (price > 0 && cost > 0) {\n      const margin = price - cost;\n      form.setValue(\"margin\", margin.toFixed(2));\n    }\n  };\n\n  const calculateCosts = () => {\n    const formData = form.getValues();\n    const ingredients = formData.ingredients || [];\n\n    if (ingredients.length === 0) return;\n\n    const batchSize = parseFloat(formData.batchSize || \"1\");\n    const productionQuantity = parseFloat(formData.productionQuantity || \"1\");\n    const normalLossMfg = parseFloat(formData.normalLossMfg || \"5\");\n    const mfgAndPackagingCost = parseFloat(\n      formData.mfgAndPackagingCost || \"45\",\n    );\n    const overheadCost = parseFloat(formData.overheadCost || \"5\");\n\n    let subTotalForBatch = 0;\n\n    ingredients.forEach((ingredient: any) => {\n      const item = (inventoryItems as any[]).find(\n        (item: any) => item.id.toString() === ingredient.inventoryItemId,\n      );\n      if (item) {\n        const quantity = parseFloat(ingredient.quantity || \"0\");\n        const cost = parseFloat(item.costPerUnit || \"0\");\n        subTotalForBatch += quantity * cost;\n      }\n    });\n\n    const totalForProduction = subTotalForBatch * productionQuantity;\n    const effectiveUnits = batchSize * productionQuantity;\n    const rmCostPerUnit = totalForProduction / effectiveUnits;\n    const effectiveUnitsProduced = effectiveUnits * (1 - normalLossMfg / 100);\n    const estimatedCostPerUnit = totalForProduction / effectiveUnitsProduced;\n    const mfgCostPerUnit = estimatedCostPerUnit * (mfgAndPackagingCost / 100);\n    const overheadCostPerUnit = estimatedCostPerUnit * (overheadCost / 100);\n    const finalCostPerUnit =\n      estimatedCostPerUnit + mfgCostPerUnit + overheadCostPerUnit;\n\n    setCalculations({\n      subTotalForBatch,\n      totalForProduction,\n      effectiveUnits,\n      rmCostPerUnit,\n      effectiveUnitsProduced,\n      estimatedCostPerUnit,\n      mfgCostPerUnit,\n      overheadCostPerUnit,\n      finalCostPerUnit,\n    });\n\n    // Auto-update cost field\n    form.setValue(\"cost\", finalCostPerUnit.toFixed(2));\n  };\n\n  useEffect(() => {\n    calculateCosts();\n  }, [\n    form.watch(\"ingredients\"),\n    form.watch(\"batchSize\"),\n    form.watch(\"productionQuantity\"),\n    form.watch(\"normalLossMfg\"),\n    form.watch(\"mfgAndPackagingCost\"),\n    form.watch(\"overheadCost\"),\n  ]);\n\n  return (\n    <Form {...form}>\n      <form\n        onSubmit={form.handleSubmit((data) => mutation.mutate(data))}\n        className=\"space-y-6\"\n      >\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <TabsContent value=\"basic\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Product Details</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Product Name</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Bread\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"categoryId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Category</FormLabel>\n                        <Select\n                          onValueChange={field.onChange}\n                          value={field.value}\n                        >\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select a category\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {(categories as any[]).map((category: any) => (\n                              <SelectItem\n                                key={category.id}\n                                value={category.id.toString()}\n                              >\n                                {category.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"unitId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Unit</FormLabel>\n                        <Select\n                          onValueChange={field.onChange}\n                          value={field.value}\n                        >\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select a unit\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {Array.isArray(units) && units.length > 0 ? (\n                              units.map((unit: any) => (\n                                <SelectItem\n                                  key={unit.id}\n                                  value={unit.id.toString()}\n                                >\n                                  {unit.name} ({unit.abbreviation})\n                                </SelectItem>\n                              ))\n                            ) : (\n                              <SelectItem value=\"none\" disabled>\n                                No units available\n                              </SelectItem>\n                            )}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"sku\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>SKU (Optional)</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"350G\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Textarea placeholder=\"Making Process...\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Product Image */}\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Product Image</label>\n                  <div className=\"flex items-center gap-4\">\n                    {selectedImage ? (\n                      <div className=\"relative\">\n                        <img\n                          src={selectedImage}\n                          alt=\"Product preview\"\n                          className=\"w-20 h-20 object-cover rounded-lg border\"\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0\"\n                          onClick={() => setSelectedImage(\"\")}\n                        >\n                          √ó\n                        </Button>\n                      </div>\n                    ) : (\n                      <div className=\"w-20 h-20 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center\">\n                        <span className=\"text-gray-400 text-xs\">No image</span>\n                      </div>\n                    )}\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => setShowMediaLibrary(true)}\n                    >\n                      Select Image\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"cost\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>\n                          Cost Price ({symbol})\n                          {calculations.finalCostPerUnit > 0 && (\n                            <Badge variant=\"secondary\" className=\"ml-2\">\n                              Calculated:{\" \"}\n                              {formatCurrency(calculations.finalCostPerUnit)}\n                            </Badge>\n                          )}\n                        </FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            {...field}\n                            onBlur={() => {\n                              field.onBlur();\n                              calculateMargin();\n                            }}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"price\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Selling Price ({symbol})</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            {...field}\n                            onBlur={() => {\n                              field.onBlur();\n                              calculateMargin();\n                            }}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"margin\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Margin Price ({symbol})</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            {...field}\n                            readOnly\n                            className=\"bg-gray-50\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"recipe\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Recipe</CardTitle>\n                <p className=\"text-sm text-muted-foreground\">\n                  Calculate product cost based on ingredients and production\n                  parameters\n                </p>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {/* Production Parameters */}\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"batchSize\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Batch Size</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" step=\"0.01\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"productionQuantity\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Production Quantity</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" step=\"0.01\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"normalLossMfg\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Normal Loss Mfg (%)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" step=\"0.01\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"mfgAndPackagingCost\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Mfg & Packaging (%)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" step=\"0.01\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Ingredients Section */}\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"text-lg font-medium\">Ingredients</h3>\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() =>\n                        append({ inventoryItemId: \"\", quantity: \"\" })\n                      }\n                    >\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Add Ingredient\n                    </Button>\n                  </div>\n\n                  {fields.map((field, index) => (\n                    <div key={field.id} className=\"flex gap-4 items-end\">\n                      <div className=\"flex-1\">\n                        <FormField\n                          control={form.control}\n                          name={`ingredients.${index}.inventoryItemId`}\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Ingredient</FormLabel>\n                              <Select\n                                onValueChange={field.onChange}\n                                value={field.value}\n                              >\n                                <FormControl>\n                                  <SelectTrigger>\n                                    <SelectValue placeholder=\"Select ingredient\" />\n                                  </SelectTrigger>\n                                </FormControl>\n                                <SelectContent>\n                                  {(inventoryItems as any[]).map(\n                                    (item: any) => (\n                                      <SelectItem\n                                        key={item.id}\n                                        value={item.id.toString()}\n                                      >\n                                        {item.name} -{\" \"}\n                                        {formatCurrency(item.costPerUnit)}/\n                                        {item.unit}\n                                      </SelectItem>\n                                    ),\n                                  )}\n                                </SelectContent>\n                              </Select>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n\n                      <div className=\"w-32\">\n                        <FormField\n                          control={form.control}\n                          name={`ingredients.${index}.quantity`}\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Quantity</FormLabel>\n                              <FormControl>\n                                <Input type=\"number\" step=\"0.01\" {...field} />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => remove(index)}\n                        className=\"mb-2\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n\n                <Separator />\n\n                {/* Cost Summary */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-medium\">Cost Breakdown</h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <div className=\"flex justify-between\">\n                        <span>Subtotal for Batch:</span>\n                        <span>\n                          {formatCurrency(calculations.subTotalForBatch)}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Total for Production:</span>\n                        <span>\n                          {formatCurrency(calculations.totalForProduction)}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>RM Cost per Unit:</span>\n                        <span>\n                          {formatCurrency(calculations.rmCostPerUnit)}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Estimated Cost per Unit:</span>\n                        <span>\n                          {formatCurrency(calculations.estimatedCostPerUnit)}\n                        </span>\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <div className=\"flex justify-between\">\n                        <span>Mfg Cost per Unit:</span>\n                        <span>\n                          {formatCurrency(calculations.mfgCostPerUnit)}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Overhead Cost per Unit:</span>\n                        <span>\n                          {formatCurrency(calculations.overheadCostPerUnit)}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between font-semibold border-t pt-2\">\n                        <span>Final Cost per Unit:</span>\n                        <span>\n                          {formatCurrency(calculations.finalCostPerUnit)}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n\n        <div className=\"flex justify-end space-x-2 pt-4\">\n          <Button type=\"button\" variant=\"outline\" onClick={onSuccess}>\n            Cancel\n          </Button>\n          <Button type=\"submit\" disabled={mutation.isPending}>\n            {mutation.isPending && (\n              <i className=\"fas fa-spinner fa-spin mr-2\"></i>\n            )}\n            {product ? \"Update\" : \"Create\"} Product\n          </Button>\n        </div>\n\n        <MediaLibrary\n          isOpen={showMediaLibrary}\n          onClose={() => setShowMediaLibrary(false)}\n          onSelect={(imageUrl) => setSelectedImage(imageUrl)}\n        />\n      </form>\n    </Form>\n  );\n}","path":null,"size_bytes":27034,"size_tokens":null},"client/src/hooks/use-company-branding.ts":{"content":"import { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useEffect } from \"react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface CompanyBranding {\n  mapLogo: string;\n  companyIcon: string;\n  companyName: string;\n  companyLogo: string;\n  themeColor: string;\n  currency: string;\n}\n\nexport function useCompanyBranding() {\n  const queryClient = useQueryClient();\n  const {\n    data: settingsResponse,\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: [\"/api/settings\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/settings\"),\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  const settings = settingsResponse?.settings || {};\n  const DEFAULT_MAP_LOGO_PATH = \"/company__logo.webp\";\n  const DEFAULT_ICON_PATH = \"/favicon-icon.png\";\n  const DEFAULT_LOGO_PATH = \"/BakerSoftLogo.png\";\n\n  const branding: CompanyBranding = {\n    mapLogo: settings?.mapLogo || DEFAULT_MAP_LOGO_PATH,\n    companyName: settings?.companyName || \"BakerSoft\",\n    companyIcon: settings?.companyIcon || DEFAULT_ICON_PATH,\n    companyLogo: settings?.companyLogo || DEFAULT_LOGO_PATH,\n    themeColor: settings?.themeColor || \"#efa14b\",\n    currency: settings?.currency || \"NPR\",\n  };\n\n  // Apply theme color to CSS variables\n  useEffect(() => {\n    if (branding.themeColor) {\n      // Convert hex to HSL for CSS custom properties\n      const hexToHsl = (hex: string) => {\n        const r = parseInt(hex.slice(1, 3), 16);\n        const g = parseInt(hex.slice(3, 5), 16);\n        const b = parseInt(hex.slice(5, 7), 16);\n\n        const rNorm = r / 255;\n        const gNorm = g / 255;\n        const bNorm = b / 255;\n\n        const max = Math.max(rNorm, gNorm, bNorm);\n        const min = Math.min(rNorm, gNorm, bNorm);\n\n        let h = 0;\n        let s = 0;\n        const l = (max + min) / 2;\n\n        if (max !== min) {\n          const d = max - min;\n          s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\n          switch (max) {\n            case rNorm:\n              h = (gNorm - bNorm) / d + (gNorm < bNorm ? 6 : 0);\n              break;\n            case gNorm:\n              h = (bNorm - rNorm) / d + 2;\n              break;\n            case bNorm:\n              h = (rNorm - gNorm) / d + 4;\n              break;\n          }\n          h /= 6;\n        }\n\n        return [Math.round(h * 360), Math.round(s * 100), Math.round(l * 100)];\n      };\n\n      try {\n        const [h, s, l] = hexToHsl(branding.themeColor);\n\n        // Update CSS custom properties for comprehensive theme coverage\n        const root = document.documentElement;\n\n        // Primary color variations\n        root.style.setProperty(\"--primary\", `${h} ${s}% ${l}%`);\n        root.style.setProperty(\n          \"--primary-foreground\",\n          l > 50 ? \"0 0% 98%\" : \"0 0% 2%\",\n        );\n\n        // Secondary color variations (lighter version of primary)\n        root.style.setProperty(\n          \"--secondary\",\n          `${h} ${Math.max(s - 20, 10)}% ${Math.min(l + 40, 95)}%`,\n        );\n        root.style.setProperty(\n          \"--secondary-foreground\",\n          `${h} ${s}% ${Math.max(l - 40, 10)}%`,\n        );\n\n        // Accent color (slightly different hue)\n        const accentHue = (h + 30) % 360;\n        root.style.setProperty(\n          \"--accent\",\n          `${accentHue} ${Math.max(s - 10, 20)}% ${Math.min(l + 30, 90)}%`,\n        );\n        root.style.setProperty(\n          \"--accent-foreground\",\n          `${accentHue} ${s}% ${Math.max(l - 30, 15)}%`,\n        );\n\n        // Ring color for focus states\n        root.style.setProperty(\n          \"--ring\",\n          `${h} ${Math.max(s - 10, 30)}% ${Math.min(l + 10, 70)}%`,\n        );\n\n        // Muted variants\n        root.style.setProperty(\n          \"--muted\",\n          `${h} ${Math.max(s - 30, 8)}% ${Math.min(l + 50, 95)}%`,\n        );\n        root.style.setProperty(\n          \"--muted-foreground\",\n          `${h} ${Math.max(s - 20, 5)}% ${Math.max(l - 20, 45)}%`,\n        );\n\n        // Border color\n        root.style.setProperty(\n          \"--border\",\n          `${h} ${Math.max(s - 20, 10)}% ${Math.min(l + 45, 90)}%`,\n        );\n\n        // Input color\n        root.style.setProperty(\n          \"--input\",\n          `${h} ${Math.max(s - 20, 10)}% ${Math.min(l + 45, 90)}%`,\n        );\n\n        // Update meta theme color for mobile browsers\n        const metaThemeColor = document.querySelector(\n          'meta[name=\"theme-color\"]',\n        );\n        if (metaThemeColor) {\n          metaThemeColor.setAttribute(\"content\", branding.themeColor);\n        } else {\n          const meta = document.createElement(\"meta\");\n          meta.name = \"theme-color\";\n          meta.content = branding.themeColor;\n          document.head.appendChild(meta);\n        }\n      } catch (error) {\n        console.warn(\"Failed to apply theme color:\", error);\n      }\n    }\n  }, [branding.themeColor]);\n\n  // Update document title\n  useEffect(() => {\n    if (branding.companyName) {\n      document.title = `${branding.companyName}`;\n    }\n  }, [branding.companyName]);\n\n  return {\n    branding,\n    isLoading,\n    error,\n    refreshBranding: () => {\n      // Invalidate and refetch the settings\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings\"] });\n    },\n  };\n}\n\n// Utility function to format currency\nexport function formatCurrency(\n  amount: number,\n  currency: string = \"NPR\",\n): string {\n  try {\n    return new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: currency,\n      minimumFractionDigits: 2,\n    }).format(amount);\n  } catch (error) {\n    // Fallback if currency is not supported\n    return `${currency} ${amount.toFixed(2)}`;\n  }\n}\n","path":null,"size_bytes":5633,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":2604,"size_tokens":null},"public/sw.js":{"content":"// Cache disabled - no caching strategy\nconst CACHE_NAME = 'bakersoft-no-cache';\nconst STATIC_CACHE_URLS = [];\n\n// Install event - skip caching and activate immediately\nself.addEventListener(\"install\", (event) => {\n  console.log(\"üîß Service Worker installing...\");\n  // Skip caching - activate immediately\n  self.skipWaiting();\n  console.log(\"‚úÖ Service Worker installed (caching skipped)\");\n});\n\n// Activate event - clean up old caches\nself.addEventListener(\"activate\", (event) => {\n  console.log(\"üîß Service Worker activating...\");\n  // Delete all caches\n  event.waitUntil(\n    caches.keys().then((cacheNames) => {\n      return Promise.all(\n        cacheNames.map((cacheName) => caches.delete(cacheName))\n      );\n    }).then(() => self.clients.claim())\n  );\n  console.log(\"‚úÖ Service Worker activated (all caches cleared)\");\n});\n\n// Fetch event - always fetch from network, no cache\nself.addEventListener(\"fetch\", (event) => {\n  // Skip chrome extensions and other non-http(s) requests\n  if (!event.request.url.startsWith(\"http\")) return;\n\n  event.respondWith(\n    fetch(event.request).catch(() => {\n      // Network failed, try to serve offline page for navigation requests\n      if (event.request.mode === \"navigate\") {\n        return caches.match(\"/offline.html\");\n      }\n      // Return a network error response for other failed requests\n      return new Response('Network error', { status: 503 });\n    })\n  );\n});\n\n// Push notification handler\nself.addEventListener(\"push\", (event) => {\n  console.log(\"üì® Push event received:\", event);\n  let notificationData;\n\n  try {\n    if (event.data) {\n      notificationData = event.data.json();\n    } else {\n      notificationData = {\n        title: \"BakerSoft\",\n        body: \"You have a new notification\",\n        icon: \"/favicon-icon.png\",\n        badge: \"/favicon-icon.png\",\n        tag: \"default-notification\",\n      };\n    }\n  } catch (error) {\n    console.error(\"‚ùå Error parsing push data:\", error);\n    notificationData = {\n      title: \"BakerSoft\",\n      body: \"You have a new notification\",\n      icon: \"/favicon-icon.png\",\n      badge: \"/favicon-icon.png\",\n      tag: \"default-notification\",\n    };\n  }\n\n  const notificationOptions = {\n    body: notificationData.body,\n    icon: notificationData.icon || \"/favicon-icon.png\",\n    badge: notificationData.badge || \"/favicon-icon.png\",\n    tag: notificationData.tag || \"notification\",\n    data: notificationData.data || {},\n    requireInteraction: false,\n    vibrate: [200, 100, 200],\n    timestamp: Date.now(),\n  };\n\n  event.waitUntil(\n    self.registration.showNotification(notificationData.title, notificationOptions)\n  );\n});\n\n// Notification click handler\nself.addEventListener(\"notificationclick\", (event) => {\n  console.log(\"üñ±Ô∏è Notification clicked\");\n  event.notification.close();\n\n  event.waitUntil(\n    clients\n      .matchAll({ type: \"window\", includeUncontrolled: true })\n      .then((clientList) => {\n        // Focus existing window if available\n        for (const client of clientList) {\n          if (client.url.includes(self.location.origin) && \"focus\" in client) {\n            return client.focus();\n          }\n        }\n        // Open new window if none exists\n        if (clients.openWindow) {\n          return clients.openWindow(\"/\");\n        }\n      })\n  );\n});\n\nconsole.log(\"‚úÖ Service Worker setup complete (caching disabled)\");","path":null,"size_bytes":3377,"size_tokens":null},"client/src/pages/orders.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport OrderForm from \"@/components/order-form\"; // Ensure OrderForm correctly saves data\nimport SearchBar from \"@/components/search-bar\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n  usePagination,\n} from \"@/components/ui/pagination\";\n\ninterface Order {\n  id: number;\n  orderNumber: string;\n  customerName: string;\n  customerEmail?: string;\n  customerPhone?: string;\n  orderDate: string;\n  dueDate?: string;\n  totalAmount: string;\n  status: string;\n  notes?: string;\n  items?: OrderItem[];\n}\n\ninterface OrderItem {\n  id: number;\n  productName: string;\n  quantity: number;\n  unitPrice: string;\n  totalPrice: string;\n  unit?: string;\n  unitAbbreviation?: string;\n}\n\nexport default function Orders() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [showOrderForm, setShowOrderForm] = useState(false);\n  const { formatCurrency } = useCurrency();\n  const [selectedOrder, setSelectedOrder] = useState<Order | null>(null);\n  const { toast } = useToast();\n\n  // --- Data Fetching ---\n  // Ensure your API endpoint /api/orders returns all necessary fields:\n  // id, orderNumber, customerName, customerEmail, customerPhone, orderDate,\n  // dueDate, totalAmount, status, notes, etc.\n  const {\n    data: orders = [],\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: [\"/api/orders\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/orders\"),\n    staleTime: 1000 * 60 * 5, // 5 minutes\n  });\n\n  // --- Mutation for Updating Status ---\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({\n      orderId,\n      status,\n    }: {\n      orderId: number;\n      status: string;\n    }) => {\n      // Ensure your PUT /api/orders/:id endpoint correctly updates the status\n      await apiRequest(\"PUT\", `/api/orders/${orderId}`, { status });\n    },\n    onSuccess: () => {\n      // Invalidate relevant queries to refetch updated data\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/dashboard/recent-orders\"],\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n      toast({\n        title: \"Success\",\n        description: \"Order status updated successfully\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        // Consider using a more robust navigation method if available\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to update order status\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // --- Helper Function for Status Badges ---\n  const getStatusBadge = (status: string) => {\n    // Maps status strings to Badge variants for color coding\n    const variants: Record<\n      string,\n      \"default\" | \"secondary\" | \"destructive\" | \"outline\"\n    > = {\n      completed: \"default\", // Typically green\n      in_progress: \"secondary\", // Typically blue/gray\n      pending: \"outline\", // Typically gray border\n      cancelled: \"destructive\", // Typically red\n    };\n    const labels: Record<string, string> = {\n      completed: \"Completed\",\n      in_progress: \"In Progress\",\n      pending: \"Pending\",\n      cancelled: \"Cancelled\",\n    };\n    return (\n      <Badge variant={variants[status] || \"outline\"}>\n        {labels[status] || status}\n      </Badge>\n    );\n  };\n\n  // --- Helper Function for Status Actions ---\n  const getStatusActions = (currentStatus: string, orderId: number) => {\n    const actions = [];\n    if (currentStatus === \"pending\") {\n      actions.push(\n        <Button\n          key=\"start\"\n          size=\"sm\"\n          variant=\"outline\"\n          onClick={() =>\n            updateStatusMutation.mutate({ orderId, status: \"in_progress\" })\n          }\n          disabled={updateStatusMutation.isPending}\n        >\n          Start\n        </Button>,\n      );\n    }\n    if (currentStatus === \"in_progress\") {\n      actions.push(\n        <Button\n          key=\"complete\"\n          size=\"sm\"\n          onClick={() =>\n            updateStatusMutation.mutate({ orderId, status: \"completed\" })\n          }\n          disabled={updateStatusMutation.isPending}\n        >\n          Complete\n        </Button>,\n      );\n    }\n    // Allow cancellation for pending or in_progress orders\n    if (currentStatus !== \"cancelled\" && currentStatus !== \"completed\") {\n      actions.push(\n        <Button\n          key=\"cancel\"\n          size=\"sm\"\n          variant=\"destructive\"\n          onClick={() =>\n            updateStatusMutation.mutate({ orderId, status: \"cancelled\" })\n          }\n          disabled={updateStatusMutation.isPending}\n        >\n          Cancel\n        </Button>,\n      );\n    }\n    return actions;\n  };\n\n  // --- Filtering Logic ---\n  const filteredOrders = orders.filter((order: any) => {\n    const matchesSearch =\n      order.customerName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      order.orderNumber.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      (order.customerEmail?.toLowerCase().includes(searchQuery.toLowerCase()) ??\n        false); // Safer check\n\n    const matchesStatus =\n      statusFilter === \"all\" || order.status === statusFilter;\n\n    // As per original logic: Hide completed orders from the main list view\n    const isNotCompleted = order.status !== \"completed\";\n\n    return matchesSearch && matchesStatus && isNotCompleted;\n  });\n\n  // --- Sorting Logic ---\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredOrders,\n    \"orderNumber\", // Default sort by order number\n  );\n\n  // --- Pagination Logic ---\n  const pagination = usePagination(sortedData, 5); // Default page size 5\n  const {\n    currentPage,\n    pageSize,\n    totalPages,\n    totalItems,\n    paginatedData: paginatedOrders,\n    handlePageChange,\n    handlePageSizeChange,\n  } = pagination;\n\n  // --- Loading State ---\n  if (isLoading) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/4\"></div>\n          <div className=\"space-y-4\">\n            {[1, 2, 3, 4].map((i) => (\n              <div key={i} className=\"h-32 bg-gray-200 rounded-lg\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // --- Error Handling ---\n  if (error) {\n    if (isUnauthorizedError(error)) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return null; // Prevent further rendering\n    } else {\n      // Handle other errors if needed, or let React Query's default error handling show\n      console.error(\"Error fetching orders:\", error);\n      // Optionally, show a user-friendly error message here\n    }\n  }\n\n  // --- Main Render ---\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-gray-600\">Track and manage customer orders</p>\n        </div>\n        <Button onClick={() => setShowOrderForm(true)}>\n          <i className=\"fas fa-plus mr-2\"></i> {/* Consider Lucide Icons */}\n          New Order\n        </Button>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex flex-col sm:flex-row gap-4\">\n            <div className=\"flex-1\">\n              <SearchBar\n                placeholder=\"Search orders, customers...\"\n                value={searchQuery}\n                onChange={setSearchQuery}\n                className=\"w-full\"\n              />\n            </div>\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\n              <SelectTrigger className=\"w-full sm:w-48\">\n                <SelectValue placeholder=\"All Status\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Status</SelectItem>\n                <SelectItem value=\"pending\">Pending</SelectItem>\n                <SelectItem value=\"in_progress\">In Progress</SelectItem>\n                <SelectItem value=\"completed\">Completed</SelectItem>\n                <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Orders List Table */}\n      <div className=\"overflow-x-auto bg-white rounded-lg border\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <SortableTableHeader\n                sortKey=\"id\"\n                sortConfig={sortConfig}\n                onSort={requestSort}\n              >\n                Order ID\n              </SortableTableHeader>\n              <SortableTableHeader\n                sortKey=\"customerName\"\n                sortConfig={sortConfig}\n                onSort={requestSort}\n              >\n                Customer\n              </SortableTableHeader>\n              <SortableTableHeader\n                sortKey=\"orderDate\"\n                sortConfig={sortConfig}\n                onSort={requestSort}\n              >\n                Date\n              </SortableTableHeader>\n              <SortableTableHeader\n                sortKey=\"dueDate\"\n                sortConfig={sortConfig}\n                onSort={requestSort}\n              >\n                Due Date\n              </SortableTableHeader>\n              <SortableTableHeader\n                sortKey=\"customerPhone\"\n                sortConfig={sortConfig}\n                onSort={requestSort}\n              >\n                Phone\n              </SortableTableHeader>\n              <SortableTableHeader\n                sortKey=\"totalAmount\"\n                sortConfig={sortConfig}\n                onSort={requestSort}\n                className=\"text-right\"\n              >\n                Total\n              </SortableTableHeader>\n              <SortableTableHeader\n                sortKey=\"status\"\n                sortConfig={sortConfig}\n                onSort={requestSort}\n              >\n                Status\n              </SortableTableHeader>\n              <TableHead className=\"text-right\">Actions</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {paginatedOrders && paginatedOrders.length > 0 ? (\n              paginatedOrders.map((order: any) => {\n                // ‚úÖ Move the logic here\n                let statusClass = \"bg-gray-100 text-gray-800\";\n                if (order.status === \"completed\") {\n                  statusClass = \"bg-green-100 text-green-800\";\n                } else if (order.status === \"pending\") {\n                  statusClass = \"bg-yellow-100 text-yellow-800\";\n                } else if (order.status === \"cancelled\") {\n                  statusClass = \"bg-red-100 text-red-800\";\n                }\n\n                return (\n                  <TableRow key={order.id} className=\"hover:bg-muted/50\">\n                    {/* Order ID */}\n                    <TableCell className=\"font-medium\">{order.id}</TableCell>\n                    {/* Customer Info */}\n                    <TableCell>\n                      <div>{order.customerName}</div>\n                      {order.customerEmail && (\n                        <div className=\"text-xs text-muted-foreground\">\n                          {order.customerEmail}\n                        </div>\n                      )}\n                    </TableCell>\n                    {/* Order Date */}\n                    <TableCell>\n                      {new Date(order.orderDate).toLocaleDateString()}\n                    </TableCell>\n                    {/* Due Date */}\n                    <TableCell>\n                      {order.dueDate\n                        ? new Date(order.dueDate).toLocaleDateString()\n                        : \"-\"}\n                    </TableCell>\n                    {/* Phone */}\n                    <TableCell>{order.customerPhone || \"-\"}</TableCell>\n                    {/* Total Amount */}\n                    <TableCell className=\"text-right font-semibold\">\n                      {formatCurrency(Number(order.totalAmount))}\n                    </TableCell>\n                    {/* Status with Color */}\n                    <TableCell>\n                      <span\n                        className={`px-2 py-1 rounded-full text-xs ${statusClass}`}\n                      >\n                        {order.status}\n                      </span>\n                    </TableCell>\n                    {/* Actions */}\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex justify-end space-x-1\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => setSelectedOrder(order)}\n                        >\n                          <i className=\"fas fa-eye mr-1\"></i>\n                        </Button>\n                        {getStatusActions(order.status, order.id)}\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                );\n              })\n            ) : (\n              <TableRow>\n                <TableCell colSpan={8} className=\"text-center py-12\">\n                  <div className=\"flex flex-col items-center justify-center\">\n                    <i className=\"fas fa-shopping-cart text-4xl text-gray-300 mb-4\"></i>\n                    <h3 className=\"text-lg font-semibold text-gray-600 mb-2\">\n                      No orders found\n                    </h3>\n                    <p className=\"text-gray-500 mb-4\">\n                      {searchQuery || statusFilter !== \"all\"\n                        ? \"Try adjusting your search criteria\"\n                        : \"Start by creating your first order\"}\n                    </p>\n                  </div>\n                </TableCell>\n              </TableRow>\n            )}\n          </TableBody>\n        </Table>\n\n        {/* Pagination Controls */}\n        {filteredOrders.length > 0 && (\n          <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 p-4 border-t\">\n            <PaginationInfo\n              currentPage={currentPage}\n              pageSize={pageSize}\n              totalItems={totalItems}\n            />\n            <div className=\"flex items-center gap-4\">\n              <PageSizeSelector\n                pageSize={pageSize}\n                onPageSizeChange={handlePageSizeChange}\n                options={[5, 10, 20, 50]}\n              />\n              <Pagination\n                currentPage={currentPage}\n                totalPages={totalPages}\n                onPageChange={handlePageChange}\n              />\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Create Order Modal */}\n      <Dialog open={showOrderForm} onOpenChange={setShowOrderForm}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Create New Order</DialogTitle>\n          </DialogHeader>\n          {/* Ensure OrderForm calls onSuccess correctly after saving */}\n          <OrderForm onSuccess={() => setShowOrderForm(false)} />\n        </DialogContent>\n      </Dialog>\n\n      {/* View Order Details Modal */}\n      <Dialog\n        open={!!selectedOrder} // Opens if selectedOrder is not null\n        onOpenChange={() => setSelectedOrder(null)} // Clears selection on close\n      >\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Order Details - {selectedOrder?.id}</DialogTitle>\n          </DialogHeader>\n          {/* Display details only if selectedOrder exists */}\n          {selectedOrder && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {/* Customer Information Section */}\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-2\">\n                    Customer Information\n                  </h4>\n                  <div className=\"space-y-1 text-sm\">\n                    <div>\n                      <strong>Name:</strong> {selectedOrder.customerName}\n                    </div>\n                    {selectedOrder.customerEmail && (\n                      <div>\n                        <strong>Email:</strong> {selectedOrder.customerEmail}\n                      </div>\n                    )}\n                    {selectedOrder.customerPhone && (\n                      <div>\n                        <strong>Phone:</strong> {selectedOrder.customerPhone}\n                      </div>\n                    )}\n                    {/* Add other customer fields if needed */}\n                  </div>\n                </div>\n\n                {/* Order Information Section */}\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-2\">\n                    Order Information\n                  </h4>\n                  <div className=\"space-y-1 text-sm\">\n                    <div>\n                      <strong>Status:</strong>{\" \"}\n                      {getStatusBadge(selectedOrder.status)}{\" \"}\n                      {/* Uses the badge helper */}\n                    </div>\n                    <div>\n                      <strong>Order Date:</strong>{\" \"}\n                      {new Date(selectedOrder.orderDate).toLocaleDateString()}\n                    </div>\n                    {selectedOrder.dueDate && (\n                      <div>\n                        <strong>Due Date:</strong>{\" \"}\n                        {new Date(selectedOrder.dueDate).toLocaleDateString()}\n                      </div>\n                    )}\n                    <div>\n                      <strong>Total:</strong>{\" \"}\n                      {formatCurrency(selectedOrder.totalAmount)}\n                    </div>\n                    {/* Add other order fields if needed (e.g., items if stored) */}\n                  </div>\n                </div>\n              </div>\n\n              {/* Order Items */}\n              {selectedOrder.items && selectedOrder.items.length > 0 && (\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-2\">\n                    Order Items\n                  </h4>\n                  <div className=\"space-y-2\">\n                    {selectedOrder.items.map((item: any, index: number) => (\n                      <div\n                        key={index}\n                        className=\"flex justify-between items-center p-2 bg-gray-50 rounded\"\n                      >\n                        <div>\n                          <span className=\"font-medium\">\n                            {item.productName}\n                          </span>\n                          <span className=\"text-gray-600 ml-2\">\n                            (Qty: {item.quantity}{\" \"}\n                            {item.unitAbbreviation || item.unit || \"\"})\n                          </span>\n                        </div>\n                        <div className=\"text-right\">\n                          <div>\n                            {formatCurrency(item.unitPrice)} per{\" \"}\n                            {item.unitAbbreviation || item.unit || \"unit\"}\n                          </div>\n                          <div className=\"font-semibold\">\n                            {formatCurrency(item.totalPrice)}\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Notes Section */}\n              {selectedOrder.notes && (\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-2\">Notes</h4>\n                  <p className=\"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg\">\n                    {selectedOrder.notes}\n                  </p>\n                </div>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":21317,"size_tokens":null},"client/src/components/ui/loading-spinner.tsx":{"content":"import { cn } from \"@/lib/utils\";\n\ninterface LoadingSpinnerProps {\n  className?: string;\n  size?: \"sm\" | \"md\" | \"lg\";\n  message?: string;\n}\n\nexport function LoadingSpinner({\n  className,\n  size = \"md\",\n  message = \"Loading...\",\n}: LoadingSpinnerProps) {\n  const sizeClasses = {\n    sm: \"h-4 w-4\",\n    md: \"h-8 w-8\",\n    lg: \"h-12 w-12\",\n  };\n\n  return (\n    <div className=\"flex flex-col items-center justify-center p-8\">\n      <div\n        className={cn(\n          \"animate-spin rounded-full border-4 border-gray-200 border-t-blue-600\",\n          sizeClasses[size],\n          className,\n        )}\n      />\n      <p className=\"text-gray-500 mt-2 text-sm\">{message}</p>\n    </div>\n  );\n}\n\nexport function FullPageLoader() {\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\">\n      <div className=\"text-center\">\n        <div className=\"w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4\" />\n        <h2 className=\"text-xl font-semibold text-gray-700 mb-2\">\n          Loading Mero BakeSoft\n        </h2>\n        <p className=\"text-gray-500\">\n          Please wait while we prepare your bakery management system...\n        </p>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1270,"size_tokens":null},"client/src/lib/pwa.ts":{"content":"// PWA utilities for iOS support and badge management\n\ninterface PWAInstallPromptEvent extends Event {\n  prompt(): Promise<void>;\n  userChoice: Promise<{ outcome: \"accepted\" | \"dismissed\" }>;\n}\n\ninterface Navigator {\n  setAppBadge?: (count?: number) => Promise<void>;\n  clearAppBadge?: () => Promise<void>;\n  standalone?: boolean;\n}\n\ninterface Window {\n  navigator: Navigator;\n}\n\nclass PWAManager {\n  private installPrompt: PWAInstallPromptEvent | null = null;\n  private serviceWorkerRegistration: ServiceWorkerRegistration | null = null;\n\n  async init() {\n    await this.registerServiceWorker();\n    this.setupInstallPrompt();\n    this.setupBadgeSupport();\n    this.detectStandaloneMode();\n    this.setupServerRestartDetection();\n  }\n\n  private async registerServiceWorker() {\n    if (\"serviceWorker\" in navigator) {\n      try {\n        // Register with explicit type to ensure correct MIME type\n        const registration = await navigator.serviceWorker.register(\"/sw.js\", {\n          scope: \"/\",\n          updateViaCache: \"none\",\n          type: \"classic\"\n        });\n\n        this.serviceWorkerRegistration = registration;\n\n        // Handle service worker updates\n        registration.addEventListener(\"updatefound\", () => {\n          // Service worker update found\n        });\n\n        return registration;\n      } catch (error) {\n        throw error;\n      }\n    } else {\n      throw new Error(\"Service Worker not supported\");\n    }\n  }\n\n  private setupInstallPrompt() {\n    // Listen for PWA install prompt\n    window.addEventListener(\"beforeinstallprompt\", (e) => {\n      e.preventDefault();\n      this.installPrompt = e as PWAInstallPromptEvent;\n    });\n\n    // Handle PWA installation\n    window.addEventListener(\"appinstalled\", () => {\n      this.installPrompt = null;\n    });\n  }\n\n  private setupBadgeSupport() {\n    // Badge API is available in iOS 16.4+ PWAs - no logging needed\n  }\n\n  // Critical: Check if running in standalone mode\n  isStandalone(): boolean {\n    // iOS Safari - Primary detection method\n    if (window.navigator.standalone === true) {\n      return true;\n    }\n\n    // Android Chrome and other browsers\n    if (window.matchMedia(\"(display-mode: standalone)\").matches) {\n      return true;\n    }\n\n    // iOS Safari additional check\n    if (window.matchMedia(\"(display-mode: fullscreen)\").matches) {\n      return true;\n    }\n\n    // Fallback: Check for source parameter\n    const urlParams = new URLSearchParams(window.location.search);\n    if (urlParams.get(\"source\") === \"pwa\") {\n      return true;\n    }\n\n    // Additional iOS checks\n    const isIOSDevice = /iPad|iPhone|iPod/.test(window.navigator.userAgent);\n    const isStandaloneCapable = window.navigator.standalone !== undefined;\n\n    if (isIOSDevice && isStandaloneCapable) {\n      // Check if window height suggests fullscreen mode\n      const windowHeight = window.innerHeight;\n      const screenHeight = window.screen.height;\n      const ratio = windowHeight / screenHeight;\n\n      // iOS Safari in standalone mode typically uses full screen height\n      if (ratio > 0.9) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // Force standalone mode detection on page load\n  detectStandaloneMode() {\n    const standalone = this.isStandalone();\n\n    // Set a flag for CSS targeting\n    if (standalone) {\n      document.documentElement.setAttribute(\"data-pwa-standalone\", \"true\");\n    } else {\n      document.documentElement.setAttribute(\"data-pwa-standalone\", \"false\");\n    }\n\n    return standalone;\n  }\n\n  async showInstallPrompt(): Promise<boolean> {\n    if (!this.installPrompt) {\n      return false;\n    }\n\n    try {\n      await this.installPrompt.prompt();\n      const result = await this.installPrompt.userChoice;\n\n      if (result.outcome === \"accepted\") {\n        this.installPrompt = null;\n        return true;\n      } else {\n        return false;\n      }\n    } catch (error) {\n      return false;\n    }\n  }\n\n  isInstallable(): boolean {\n    return this.installPrompt !== null;\n  }\n\n  async setBadge(count?: number): Promise<void> {\n    try {\n      if (\"setAppBadge\" in navigator) {\n        await navigator.setAppBadge!(count);\n      } else {\n        // Fallback: Send message to service worker\n        if (this.serviceWorkerRegistration?.active) {\n          this.serviceWorkerRegistration.active.postMessage({\n            type: \"SET_BADGE\",\n            count: count || 1,\n          });\n        }\n      }\n    } catch (error) {\n      // Badge setting failed silently\n    }\n  }\n\n  async clearBadge(): Promise<void> {\n    try {\n      if (\"clearAppBadge\" in navigator) {\n        await navigator.clearAppBadge!();\n      } else {\n        // Fallback: Send message to service worker\n        if (this.serviceWorkerRegistration?.active) {\n          this.serviceWorkerRegistration.active.postMessage({\n            type: \"CLEAR_BADGE\",\n          });\n        }\n      }\n    } catch (error) {\n      // Badge clearing failed silently\n    }\n  }\n\n  async updateServiceWorker(): Promise<void> {\n    if (this.serviceWorkerRegistration) {\n      try {\n        await this.serviceWorkerRegistration.update();\n      } catch (error) {\n        // Service worker update failed silently\n      }\n    }\n  }\n\n  // iOS-specific PWA checks\n  isIOSPWA(): boolean {\n    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);\n    const isStandalone = this.isStandalone();\n    return isIOS && isStandalone;\n  }\n\n  // Setup server restart detection\n  private setupServerRestartDetection() {\n    if (\"serviceWorker\" in navigator) {\n      navigator.serviceWorker.addEventListener(\"message\", (event) => {\n        if (event.data.type === \"SERVER_RESTART_DETECTED\") {\n          // Clear all local storage and caches\n          this.clearAppData().then(() => {\n            // Force reload the app\n            window.location.reload();\n          });\n        }\n      });\n\n      this.startServerHealthMonitoring();\n    }\n  }\n\n  // Start server health monitoring\n  startServerHealthMonitoring() {\n    if (typeof window !== \"undefined\") {\n      // Only check server health if user is already authenticated\n      // Don't interfere with login process\n      setInterval(() => {\n        // Skip health check on login page\n        if (!window.location.pathname.includes(\"/login\")) {\n          this.performHealthCheck();\n        }\n      }, 60000); // Check every 60 seconds instead of 30\n    }\n  }\n\n  // Perform server health check\n  private async performHealthCheck() {\n    try {\n      const response = await fetch(\"/api/auth/user\", {\n        method: \"GET\",\n        credentials: \"include\",\n      });\n\n      if (!response.ok && response.status >= 500) {\n        await this.clearAppData();\n        window.location.reload();\n      }\n    } catch (error) {\n      // Don't reload immediately on network errors, wait for next check\n    }\n  }\n\n  // Clear all app data (storage, caches, etc.)\n  private async clearAppData() {\n    try {\n      // Clear localStorage\n      localStorage.clear();\n\n      // Clear sessionStorage\n      sessionStorage.clear();\n\n      // Clear all caches\n      if (\"caches\" in window) {\n        const cacheNames = await caches.keys();\n        await Promise.all(\n          cacheNames.map((cacheName) => caches.delete(cacheName)),\n        );\n      }\n\n      // Clear IndexedDB (if React Query uses it)\n      if (\"indexedDB\" in window) {\n        // This will clear React Query persistence if enabled\n        const databases = [\"react-query-offline-cache\"];\n        databases.forEach((dbName) => {\n          indexedDB.deleteDatabase(dbName);\n        });\n      }\n    } catch (error) {\n      // Error clearing app data - silently handled\n    }\n  }\n\n  // Get platform-specific info\n  getPlatformInfo() {\n    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);\n    const isAndroid = /Android/.test(navigator.userAgent);\n    const isStandalone = this.isStandalone();\n    const isInstallable = this.isInstallable();\n\n    return {\n      isIOS,\n      isAndroid,\n      isStandalone,\n      isInstallable,\n      isPWA: isStandalone,\n      supportsNotifications: \"Notification\" in window,\n      supportsBadges: \"setAppBadge\" in navigator,\n      serviceWorkerSupported: \"serviceWorker\" in navigator,\n    };\n  }\n}\n\nexport const pwaManager = new PWAManager();\n\n// Export utilities\n// Add PWA installability check\nasync function checkPWAInstallability() {\n  // Check required PWA criteria\n  const checks = {\n    serviceWorker: \"serviceWorker\" in navigator,\n    manifest: false,\n    icon: false,\n    https: location.protocol === \"https:\" || location.hostname === \"localhost\",\n    standalone: false,\n  };\n\n  try {\n    // Check manifest\n    const manifestResponse = await fetch(\"/manifest.json\");\n    checks.manifest = manifestResponse.ok;\n\n    // Check icon\n    const iconResponse = await fetch(\"/favicon-icon.png\");\n    checks.icon = iconResponse.ok;\n\n    // Check if standalone mode is supported\n    checks.standalone = window.matchMedia(\"(display-mode: standalone)\").matches;\n\n    const installable =\n      checks.serviceWorker && checks.manifest && checks.icon && checks.https;\n\n    return installable;\n  } catch (error) {\n    return false;\n  }\n}\n\nexport const initPWA = async () => {\n  await pwaManager.init();\n  await checkPWAInstallability();\n};\nexport const showInstallPrompt = () => pwaManager.showInstallPrompt();\nexport const setBadge = (count?: number) => pwaManager.setBadge(count);\nexport const clearBadge = () => pwaManager.clearBadge();\nexport const isStandalone = () => pwaManager.isStandalone();\nexport const isIOSPWA = () => pwaManager.isIOSPWA();\nexport const getPlatformInfo = () => pwaManager.getPlatformInfo();\n","path":null,"size_bytes":9600,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-11 w-full rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm text-gray-900 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200\",\n          className,\n        )}\n        ref={ref}\n        {...props}\n      />\n    );\n  },\n);\nInput.displayName = \"Input\";\n\nexport { Input };\n","path":null,"size_bytes":687,"size_tokens":null},"server/permissionMiddleware.ts":{"content":"\nimport type { Request, Response, NextFunction } from \"express\";\nimport { storage } from \"./lib/storage\";\n\ninterface AuthenticatedRequest extends Request {\n  user?: {\n    id: string;\n    email: string;\n    role: string;\n  };\n  filterSuperAdmin?: boolean;\n}\n\nexport function requirePermission(resource: string, action: 'read' | 'write' | 'read_write') {\n  return async (req: AuthenticatedRequest, res: Response, next: NextFunction) => {\n    try {\n      if (!req.user) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      // Super admin ALWAYS has access to EVERYTHING - no exceptions\n      if (req.user.role === 'super_admin') {\n        console.log(`üöÄ Super Admin access granted for ${resource} (${action})`);\n        return next();\n      }\n\n      // Admin has access to most things but not superadmin-related functionality\n      if (req.user.role === 'admin' && resource !== 'super_admin') {\n        return next();\n      }\n\n      const hasPermission = await storage.checkUserPermission(req.user.id, resource, action);\n      \n      if (!hasPermission) {\n        return res.status(403).json({ \n          message: \"Insufficient permissions\",\n          required: `${action} access to ${resource}` \n        });\n      }\n\n      next();\n    } catch (error) {\n      console.error(\"Permission check error:\", error);\n      res.status(500).json({ message: \"Permission check failed\" });\n    }\n  };\n}\n\nexport function requireRead(resource: string) {\n  return requirePermission(resource, 'read');\n}\n\nexport function requireWrite(resource: string) {\n  return requirePermission(resource, 'write');\n}\n\nexport function requireReadWrite(resource: string) {\n  return requirePermission(resource, 'read_write');\n}\n\nexport function requireSuperAdmin() {\n  return (req: AuthenticatedRequest, res: Response, next: NextFunction) => {\n    if (!req.user) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n\n    if (req.user.role !== 'super_admin') {\n      return res.status(403).json({ \n        message: \"Super admin access required\" \n      });\n    }\n\n    next();\n  };\n}\n\nexport function filterSuperAdminUsers() {\n  return (req: AuthenticatedRequest, res: Response, next: NextFunction) => {\n    // Add a flag to indicate we need to filter superadmin users\n    req.filterSuperAdmin = req.user?.role !== 'super_admin';\n    next();\n  };\n}\n","path":null,"size_bytes":2383,"size_tokens":null},"client/src/components/ui/data-table.tsx":{"content":"\nimport React from \"react\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n} from \"@/components/ui/pagination\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Search, Filter, Download, RefreshCw } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface DataTableColumn<T> {\n  key: string;\n  title: string;\n  sortable?: boolean;\n  width?: string;\n  className?: string;\n  render?: (value: any, row: T, index: number) => React.ReactNode;\n  sortKey?: string; // Custom sort key if different from column key\n}\n\nexport interface DataTableAction<T> {\n  label: string;\n  icon?: React.ReactNode;\n  onClick: (row: T) => void;\n  variant?: \"default\" | \"destructive\" | \"outline\" | \"secondary\" | \"ghost\" | \"link\";\n  className?: string;\n  disabled?: (row: T) => boolean;\n}\n\nexport interface DataTableProps<T> {\n  title?: string;\n  description?: string;\n  data: T[];\n  columns: DataTableColumn<T>[];\n  actions?: DataTableAction<T>[];\n  loading?: boolean;\n  error?: string;\n  searchable?: boolean;\n  searchPlaceholder?: string;\n  searchValue?: string;\n  onSearchChange?: (value: string) => void;\n  filterable?: boolean;\n  onFilterClick?: () => void;\n  exportable?: boolean;\n  onExportClick?: () => void;\n  refreshable?: boolean;\n  onRefreshClick?: () => void;\n  // Pagination props\n  currentPage: number;\n  totalPages: number;\n  pageSize: number;\n  totalItems: number;\n  onPageChange: (page: number) => void;\n  onPageSizeChange: (size: number) => void;\n  // Sorting props\n  sortConfig?: { key: string; direction: 'asc' | 'desc' } | null;\n  onSort?: (key: string) => void;\n  // Additional props\n  emptyMessage?: string;\n  className?: string;\n  headerActions?: React.ReactNode;\n  showPaginationInfo?: boolean;\n  pageSizeOptions?: number[];\n}\n\nexport function DataTable<T extends Record<string, any>>({\n  title,\n  description,\n  data,\n  columns,\n  actions,\n  loading = false,\n  error,\n  searchable = false,\n  searchPlaceholder = \"Search...\",\n  searchValue = \"\",\n  onSearchChange,\n  filterable = false,\n  onFilterClick,\n  exportable = false,\n  onExportClick,\n  refreshable = false,\n  onRefreshClick,\n  currentPage,\n  totalPages,\n  pageSize,\n  totalItems,\n  onPageChange,\n  onPageSizeChange,\n  sortConfig,\n  onSort,\n  emptyMessage = \"No records found\",\n  className,\n  headerActions,\n  showPaginationInfo = true,\n  pageSizeOptions = [10, 20, 50, 100],\n}: DataTableProps<T>) {\n  const hasHeader = title || description || searchable || filterable || exportable || refreshable || headerActions;\n\n  const renderCellContent = (column: DataTableColumn<T>, row: T, index: number) => {\n    if (column.render) {\n      return column.render(row[column.key], row, index);\n    }\n    \n    const value = row[column.key];\n    \n    // Handle common data types\n    if (value === null || value === undefined) {\n      return <span className=\"text-muted-foreground\">-</span>;\n    }\n    \n    if (typeof value === 'boolean') {\n      return (\n        <Badge variant={value ? \"default\" : \"secondary\"}>\n          {value ? \"Yes\" : \"No\"}\n        </Badge>\n      );\n    }\n    \n    if (typeof value === 'number' && column.key.toLowerCase().includes('amount')) {\n      return <span className=\"font-medium\">${value.toFixed(2)}</span>;\n    }\n    \n    if (typeof value === 'string' && value.match(/^\\d{4}-\\d{2}-\\d{2}/)) {\n      return new Date(value).toLocaleDateString();\n    }\n    \n    return String(value);\n  };\n\n  return (\n    <Card className={cn(\"w-full\", className)}>\n      {hasHeader && (\n        <CardHeader>\n          <div className=\"flex flex-col space-y-4\">\n            {(title || description) && (\n              <div>\n                {title && <CardTitle>{title}</CardTitle>}\n                {description && (\n                  <p className=\"text-sm text-muted-foreground mt-1\">{description}</p>\n                )}\n              </div>\n            )}\n            \n            <div className=\"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between\">\n              <div className=\"flex flex-col sm:flex-row gap-2 items-start sm:items-center\">\n                {searchable && (\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                      placeholder={searchPlaceholder}\n                      value={searchValue}\n                      onChange={(e) => onSearchChange?.(e.target.value)}\n                      className=\"pl-10 w-64\"\n                    />\n                  </div>\n                )}\n                \n                <div className=\"flex gap-2\">\n                  {filterable && (\n                    <Button variant=\"outline\" size=\"sm\" onClick={onFilterClick}>\n                      <Filter className=\"h-4 w-4 mr-2\" />\n                      Filter\n                    </Button>\n                  )}\n                  \n                  {exportable && (\n                    <Button variant=\"outline\" size=\"sm\" onClick={onExportClick}>\n                      <Download className=\"h-4 w-4 mr-2\" />\n                      Export\n                    </Button>\n                  )}\n                  \n                  {refreshable && (\n                    <Button variant=\"outline\" size=\"sm\" onClick={onRefreshClick}>\n                      <RefreshCw className=\"h-4 w-4 mr-2\" />\n                      Refresh\n                    </Button>\n                  )}\n                </div>\n              </div>\n              \n              {headerActions && (\n                <div className=\"flex gap-2\">\n                  {headerActions}\n                </div>\n              )}\n            </div>\n          </div>\n        </CardHeader>\n      )}\n      \n      <CardContent className=\"p-0\">\n        {error && (\n          <div className=\"p-6 text-center text-red-600\">\n            <p>{error}</p>\n          </div>\n        )}\n        \n        {loading ? (\n          <div className=\"p-6 text-center\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2\"></div>\n            <p className=\"text-muted-foreground\">Loading...</p>\n          </div>\n        ) : (\n          <>\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    {columns.map((column) => (\n                      <TableHead\n                        key={column.key}\n                        className={cn(column.className)}\n                        style={column.width ? { width: column.width } : undefined}\n                      >\n                        {column.sortable && onSort ? (\n                          <SortableTableHeader\n                            label={column.title}\n                            sortKey={column.sortKey || column.key}\n                            currentSort={sortConfig || { key: \"\", direction: \"asc\" }}\n                            onSort={onSort}\n                          />\n                        ) : (\n                          column.title\n                        )}\n                      </TableHead>\n                    ))}\n                    {actions && actions.length > 0 && (\n                      <TableHead className=\"w-32\">Actions</TableHead>\n                    )}\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {data.length === 0 ? (\n                    <TableRow>\n                      <TableCell\n                        colSpan={columns.length + (actions?.length ? 1 : 0)}\n                        className=\"text-center py-8 text-muted-foreground\"\n                      >\n                        {emptyMessage}\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    data.map((row, index) => (\n                      <TableRow key={row.id || index} className=\"hover:bg-muted/50\">\n                        {columns.map((column) => (\n                          <TableCell\n                            key={column.key}\n                            className={cn(column.className)}\n                          >\n                            {renderCellContent(column, row, index)}\n                          </TableCell>\n                        ))}\n                        {actions && actions.length > 0 && (\n                          <TableCell>\n                            <div className=\"flex gap-1\">\n                              {actions.map((action, actionIndex) => (\n                                <Button\n                                  key={actionIndex}\n                                  variant={action.variant || \"ghost\"}\n                                  size=\"sm\"\n                                  onClick={() => action.onClick(row)}\n                                  disabled={action.disabled?.(row)}\n                                  className={cn(\"h-8 w-8 p-0\", action.className)}\n                                  title={action.label}\n                                >\n                                  {action.icon}\n                                </Button>\n                              ))}\n                            </div>\n                          </TableCell>\n                        )}\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n            \n            {totalItems > 0 && (\n              <div className=\"px-6 py-4 border-t flex flex-col sm:flex-row gap-4 items-center justify-between\">\n                <div className=\"flex items-center gap-4\">\n                  <PageSizeSelector\n                    pageSize={pageSize}\n                    onPageSizeChange={onPageSizeChange}\n                    options={pageSizeOptions}\n                  />\n                  {showPaginationInfo && (\n                    <PaginationInfo\n                      currentPage={currentPage}\n                      totalPages={totalPages}\n                      totalItems={totalItems}\n                    />\n                  )}\n                </div>\n                \n                <Pagination\n                  currentPage={currentPage}\n                  totalPages={totalPages}\n                  onPageChange={onPageChange}\n                />\n              </div>\n            )}\n          </>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":10745,"size_tokens":null},"client/src/pages/customers.tsx":{"content":"\nimport { useState, useMemo, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  PermissionWrapper,\n  ReadOnlyWrapper,\n} from \"@/components/permission-wrapper\";\nimport { Input } from \"@/components/ui/input\";\nimport SearchBar from \"@/components/search-bar\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Plus,\n  Search,\n  Edit,\n  Trash2,\n  Users,\n  Eye,\n  Download,\n  AlertCircle,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\nimport { format } from \"date-fns\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n  usePagination,\n} from \"@/components/ui/pagination\";\n\ninterface Customer {\n  id: number;\n  name: string;\n  email?: string;\n  phone?: string;\n  address?: string;\n  openingBalance: number;\n  currentBalance: number;\n  totalOrders: number;\n  totalSpent: number;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface LedgerTransaction {\n  id: number;\n  transactionDate: string;\n  description: string;\n  referenceNumber?: string;\n  debitAmount: string;\n  creditAmount: string;\n  runningBalance: string;\n  transactionType: string;\n  paymentMethod?: string;\n  notes?: string;\n}\n\ninterface FormErrors {\n  name?: string;\n  email?: string;\n  phone?: string;\n  openingBalance?: string;\n}\n\ninterface TransactionFormErrors {\n  transactionType?: string;\n  amount?: string;\n  description?: string;\n  transactionDate?: string;\n}\n\nexport default function Customers() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingCustomer, setEditingCustomer] = useState<Customer | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\n  const [isLedgerDialogOpen, setIsLedgerDialogOpen] = useState(false);\n  const [transactionType, setTransactionType] = useState(\"\");\n  const [formErrors, setFormErrors] = useState<FormErrors>({});\n  const [transactionErrors, setTransactionErrors] =\n    useState<TransactionFormErrors>({});\n  const { formatCurrency } = useCurrency();\n\n  const {\n    data: customersResponse,\n    isLoading,\n    error,\n    refetch\n  } = useQuery({\n    queryKey: [\"/api/customers\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/customers\");\n      return response;\n    },\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  const customers = Array.isArray(customersResponse?.data)\n    ? customersResponse.data\n    : Array.isArray(customersResponse?.items)\n    ? customersResponse.items\n    : Array.isArray(customersResponse)\n    ? customersResponse\n    : [];\n\n  // Check URL parameters for auto-opening ledger\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const viewLedgerParam = urlParams.get(\"viewLedger\");\n\n    if (viewLedgerParam && Array.isArray(customers) && customers.length > 0) {\n      const customerId = parseInt(viewLedgerParam);\n      const customer = customers.find((c: Customer) => c.id === customerId);\n\n      if (customer) {\n        setSelectedCustomer(customer);\n        setIsLedgerDialogOpen(true);\n        // Clear the URL parameter\n        window.history.replaceState({}, \"\", window.location.pathname);\n      }\n    }\n  }, [customers]);\n\n  const { data: ledgerTransactions = [] } = useQuery({\n    queryKey: [\"/api/ledger/customer\", selectedCustomer?.id],\n    enabled: !!selectedCustomer?.id,\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: any) => apiRequest(\"POST\", \"/api/customers\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      setIsDialogOpen(false);\n      setEditingCustomer(null);\n      setFormErrors({});\n      toast({ title: \"Success\", description: \"Customer saved successfully\" });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n\n      if (error.response?.data?.errors) {\n        setFormErrors(error.response.data.errors);\n      } else {\n        toast({\n          title: \"Error\",\n          description: error.response?.data?.message || \"Failed to save customer\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) =>\n      apiRequest(\"PUT\", `/api/customers/${id}`, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      setIsDialogOpen(false);\n      setEditingCustomer(null);\n      setFormErrors({});\n      toast({ title: \"Success\", description: \"Customer updated successfully\" });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n\n      if (error.response?.data?.errors) {\n        setFormErrors(error.response.data.errors);\n      } else {\n        toast({\n          title: \"Error\",\n          description:\n            error.response?.data?.message || \"Failed to update customer\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/customers/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      toast({ title: \"Success\", description: \"Customer deleted successfully\" });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete customer\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const [isTransactionDialogOpen, setIsTransactionDialogOpen] = useState(false);\n  const transactionMutation = useMutation({\n    mutationFn: (data: any) => apiRequest(\"POST\", \"/api/ledger\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/ledger/customer\", selectedCustomer?.id],\n      });\n      setIsTransactionDialogOpen(false);\n      setTransactionType(\"\");\n      setTransactionErrors({});\n      toast({\n        title: \"Success\",\n        description: \"Transaction added successfully\",\n      });\n    },\n    onError: (error: any) => {\n      if (error.response?.data?.errors) {\n        setTransactionErrors(error.response.data.errors);\n      } else {\n        toast({\n          title: \"Error\",\n          description:\n            error.response?.data?.message || \"Failed to add transaction\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const validateForm = (formData: FormData): boolean => {\n    const errors: FormErrors = {};\n\n    const name = formData.get(\"name\") as string;\n    const email = formData.get(\"email\") as string;\n    const phone = formData.get(\"phone\") as string;\n    const openingBalance = formData.get(\"openingBalance\") as string;\n\n    if (!name || name.trim().length < 2) {\n      errors.name = \"Customer name must be at least 2 characters long\";\n    }\n\n    if (email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {\n      errors.email = \"Please enter a valid email address\";\n    }\n\n    if (phone && !/^[\\d\\s\\-\\+\\(\\)]+$/.test(phone)) {\n      errors.phone = \"Please enter a valid phone number\";\n    }\n\n    if (openingBalance && isNaN(parseFloat(openingBalance))) {\n      errors.openingBalance = \"Opening balance must be a valid number\";\n    }\n\n    setFormErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  const validateTransactionForm = (formData: FormData): boolean => {\n    const errors: TransactionFormErrors = {};\n\n    const amount = formData.get(\"amount\") as string;\n    const description = formData.get(\"description\") as string;\n    const transactionDate = formData.get(\"transactionDate\") as string;\n\n    if (!transactionType) {\n      errors.transactionType = \"Please select a transaction type\";\n    }\n\n    if (!amount || amount.trim() === \"\") {\n      errors.amount = \"Amount is required\";\n    } else if (isNaN(parseFloat(amount)) || parseFloat(amount) <= 0) {\n      errors.amount = \"Amount must be a positive number\";\n    } else if (parseFloat(amount) > 999999999.99) {\n      errors.amount = \"Amount is too large\";\n    }\n\n    if (!description || description.trim().length < 3) {\n      errors.description = \"Description must be at least 3 characters long\";\n    } else if (description.trim().length > 500) {\n      errors.description = \"Description is too long (max 500 characters)\";\n    }\n\n    if (!transactionDate) {\n      errors.transactionDate = \"Transaction date is required\";\n    } else {\n      const selectedDate = new Date(transactionDate);\n      const today = new Date();\n      const oneYearAgo = new Date();\n      oneYearAgo.setFullYear(today.getFullYear() - 1);\n\n      if (selectedDate > today) {\n        errors.transactionDate = \"Transaction date cannot be in the future\";\n      } else if (selectedDate < oneYearAgo) {\n        errors.transactionDate =\n          \"Transaction date cannot be more than 1 year ago\";\n      }\n    }\n\n    setTransactionErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  const handleTransactionSave = (e: React.FormEvent) => {\n    e.preventDefault();\n    const formData = new FormData(e.target as HTMLFormElement);\n\n    if (!validateTransactionForm(formData)) {\n      return;\n    }\n\n    const amount = parseFloat(formData.get(\"amount\") as string);\n    const isDebit =\n      transactionType === \"sale\" || transactionType === \"adjustment_debit\";\n\n    const data = {\n      customerOrPartyId: selectedCustomer?.id,\n      entityType: \"customer\",\n      transactionDate: formData.get(\"transactionDate\") as string,\n      description: formData.get(\"description\") as string,\n      referenceNumber: formData.get(\"referenceNumber\") as string,\n      debitAmount: isDebit ? amount : 0,\n      creditAmount: !isDebit ? amount : 0,\n      transactionType,\n      paymentMethod: formData.get(\"paymentMethod\") as string,\n      notes: formData.get(\"notes\") as string,\n    };\n\n    transactionMutation.mutate(data);\n  };\n\n  const exportLedger = () => {\n    const csvContent = [\n      [\"Date\", \"Description\", \"Reference\", \"Debit\", \"Credit\", \"Balance\"].join(\n        \",\",\n      ),\n      ...ledgerTransactions.map((txn: LedgerTransaction) =>\n        [\n          format(new Date(txn.transactionDate), \"dd/MM/yyyy\"),\n          txn.description,\n          txn.referenceNumber || \"\",\n          txn.debitAmount,\n          txn.creditAmount,\n          txn.runningBalance,\n        ].join(\",\"),\n      ),\n    ].join(\"\\n\");\n\n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `${selectedCustomer?.name}_ledger.csv`;\n    a.click();\n    window.URL.revokeObjectURL(url);\n\n    toast({\n      title: \"Export Successful\",\n      description: \"Ledger exported to CSV file\",\n    });\n  };\n\n  const filteredCustomers = Array.isArray(customers) ? customers.filter((customer: Customer) => {\n    const matchesSearch =\n      customer.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      customer.email?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      customer.phone?.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesStatus = statusFilter === \"all\" || \n      (statusFilter === \"active\" ? customer.isActive : !customer.isActive);\n    return matchesSearch && matchesStatus;\n  }) : [];\n\n  // Add sorting functionality\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredCustomers,\n    \"name\",\n  );\n\n  // Add pagination\n  const {\n    currentItems: paginatedCustomers,\n    currentPage,\n    pageSize,\n    totalPages,\n    totalItems,\n    goToPage: handlePageChange,\n    setPageSize: handlePageSizeChange,\n  } = usePagination(sortedData, 10);\n\n  const getStatusBadge = (isActive: boolean) => {\n    return isActive ? \"default\" : \"secondary\";\n  };\n\n  const getBalanceBadge = (balance: any) => {\n    const amount = parseFloat(balance || 0);\n    if (amount > 0) {\n      return {\n        variant: \"destructive\" as const,\n        text: `Dr. ${formatCurrency(amount)}`,\n      };\n    } else if (amount < 0) {\n      return {\n        variant: \"default\" as const,\n        text: `Cr. ${formatCurrency(Math.abs(amount))}`,\n      };\n    }\n    return { variant: \"secondary\" as const, text: formatCurrency(0) };\n  };\n\n  const calculateTotals = () => {\n    let totalDebit = 0;\n    let totalCredit = 0;\n\n    ledgerTransactions.forEach((txn: LedgerTransaction) => {\n      totalDebit += parseFloat(txn.debitAmount) || 0;\n      totalCredit += parseFloat(txn.creditAmount) || 0;\n    });\n\n    return { totalDebit, totalCredit };\n  };\n\n  if (error) {\n    if (isUnauthorizedError(error)) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return null;\n    }\n    console.error(\"Error loading customers:\", error);\n  }\n\n  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setFormErrors({});\n\n    const formData = new FormData(e.currentTarget);\n\n    // Client-side validation\n    const errors: FormErrors = {};\n    const name = formData.get(\"name\") as string;\n\n    if (!name?.trim()) {\n      errors.name = \"Customer name is required\";\n    } else if (name.trim().length < 2) {\n      errors.name = \"Customer name must be at least 2 characters long\";\n    }\n\n    // Validate email format if provided\n    const email = formData.get(\"email\") as string;\n    if (email && email.trim() && !/\\S+@\\S+\\.\\S+/.test(email.trim())) {\n      errors.email = \"Please enter a valid email address\";\n    }\n\n    // Validate opening balance if provided\n    const openingBalance = formData.get(\"openingBalance\") as string;\n    if (openingBalance && openingBalance.trim() && isNaN(parseFloat(openingBalance))) {\n      errors.openingBalance = \"Please enter a valid number\";\n    }\n\n    if (Object.keys(errors).length > 0) {\n      setFormErrors(errors);\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fix the errors in the form\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const customerData = {\n      name: name.trim(),\n      email: email?.trim() || null,\n      phone: (formData.get(\"phone\") as string)?.trim() || null,\n      address: (formData.get(\"address\") as string)?.trim() || null,\n      openingBalance: openingBalance?.trim() || \"0\",\n      currentBalance: openingBalance?.trim() || \"0\",\n      totalOrders: 0,\n      totalSpent: \"0\",\n      isActive: (formData.get(\"isActive\") as string) === \"true\",\n    };\n\n    if (editingCustomer) {\n      updateMutation.mutate({ id: editingCustomer.id, data: customerData });\n    } else {\n      createMutation.mutate(customerData);\n    }\n  };\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600\">\n            Manage your customer information and relationships with complete transaction history\n          </p>\n        </div>\n        <PermissionWrapper resource=\"customers\" action=\"write\">\n          <Dialog\n            open={isDialogOpen}\n            onOpenChange={(open) => {\n              setIsDialogOpen(open);\n              if (!open) {\n                setEditingCustomer(null);\n                setFormErrors({});\n              }\n            }}\n          >\n            <DialogTrigger asChild>\n              <Button\n                onClick={() => {\n                  setEditingCustomer(null);\n                  setFormErrors({});\n                }}\n                className=\"w-full sm:w-auto\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Customer\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl mx-auto max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>\n                  {editingCustomer ? \"Edit Customer\" : \"Add New Customer\"}\n                </DialogTitle>\n                <DialogDescription>Enter customer details below</DialogDescription>\n              </DialogHeader>\n              <form onSubmit={handleSubmit} className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"name\">Customer Name *</Label>\n                    <Input\n                      id=\"name\"\n                      name=\"name\"\n                      placeholder=\"Enter customer name\"\n                      defaultValue={editingCustomer?.name || \"\"}\n                      className={formErrors.name ? \"border-red-500\" : \"\"}\n                      required\n                    />\n                    {formErrors.name && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {formErrors.name}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"email\">Email Address</Label>\n                    <Input\n                      id=\"email\"\n                      name=\"email\"\n                      type=\"email\"\n                      placeholder=\"Enter email address\"\n                      defaultValue={editingCustomer?.email || \"\"}\n                      className={formErrors.email ? \"border-red-500\" : \"\"}\n                    />\n                    {formErrors.email && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {formErrors.email}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"phone\">Phone Number</Label>\n                    <Input\n                      id=\"phone\"\n                      name=\"phone\"\n                      placeholder=\"Enter phone number\"\n                      defaultValue={editingCustomer?.phone || \"\"}\n                      className={formErrors.phone ? \"border-red-500\" : \"\"}\n                    />\n                    {formErrors.phone && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {formErrors.phone}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"isActive\">Status</Label>\n                    <Select\n                      name=\"isActive\"\n                      defaultValue={editingCustomer?.isActive ? \"true\" : \"true\"}\n                    >\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"true\">Active</SelectItem>\n                        <SelectItem value=\"false\">Inactive</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"address\">Address</Label>\n                  <Textarea\n                    id=\"address\"\n                    name=\"address\"\n                    placeholder=\"Enter complete address\"\n                    defaultValue={editingCustomer?.address || \"\"}\n                    rows={3}\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"openingBalance\">Opening Balance</Label>\n                  <Input\n                    id=\"openingBalance\"\n                    name=\"openingBalance\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    placeholder=\"Enter opening balance (positive for debit, negative for credit)\"\n                    defaultValue={editingCustomer?.openingBalance || \"0\"}\n                    className={\n                      formErrors.openingBalance ? \"border-red-500\" : \"\"\n                    }\n                  />\n                  <p className=\"text-sm text-muted-foreground\">\n                    Positive values represent amounts they owe you (debit),\n                    negative values represent amounts you owe them (credit)\n                  </p>\n                  {formErrors.openingBalance && (\n                    <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                      <AlertCircle className=\"h-4 w-4\" />\n                      {formErrors.openingBalance}\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setIsDialogOpen(false)}\n                    className=\"w-full sm:w-auto\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={\n                      createMutation.isPending || updateMutation.isPending\n                    }\n                    className=\"w-full sm:w-auto\"\n                  >\n                    {editingCustomer ? \"Update Customer\" : \"Create Customer\"}\n                  </Button>\n                </div>\n              </form>\n            </DialogContent>\n          </Dialog>\n        </PermissionWrapper>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n            <CardTitle>Customers List</CardTitle>\n            <div className=\"flex flex-col sm:flex-row gap-2 w-full sm:w-auto\">\n              <div className=\"w-full sm:w-64\">\n                <SearchBar\n                  placeholder=\"Search customers...\"\n                  value={searchQuery}\n                  onChange={setSearchQuery}\n                  className=\"w-full\"\n                />\n              </div>\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-full sm:w-48\">\n                  <SelectValue placeholder=\"All Status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Status</SelectItem>\n                  <SelectItem value=\"active\">Active</SelectItem>\n                  <SelectItem value=\"inactive\">Inactive</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"name\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Customer Details\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"email\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                      className=\"hidden sm:table-cell\"\n                    >\n                      Contact Info\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"currentBalance\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Account Balance\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"totalOrders\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Orders\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"totalSpent\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Total Spent\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"isActive\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Status\n                    </SortableTableHeader>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {paginatedCustomers && paginatedCustomers.length > 0 ? (\n                    paginatedCustomers.map((customer: Customer) => {\n                    const balanceInfo = getBalanceBadge(customer.currentBalance);\n                    return (\n                      <TableRow key={customer.id}>\n                        <TableCell>\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center\">\n                              <Users className=\"h-4 w-4 text-primary\" />\n                            </div>\n                            <div>\n                              <div className=\"font-medium\">{customer.name}</div>\n                              <div className=\"text-sm text-muted-foreground\">\n                                ID: {customer.id}\n                              </div>\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"hidden sm:table-cell\">\n                          <div className=\"text-sm\">\n                            {customer.email && <div>{customer.email}</div>}\n                            {customer.phone && (\n                              <div className=\"text-muted-foreground\">\n                                {customer.phone}\n                              </div>\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={balanceInfo.variant}>\n                            {balanceInfo.text}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"text-center\">\n                            {customer.totalOrders || 0}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"text-right\">\n                            {formatCurrency(customer.totalSpent || 0)}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={getStatusBadge(customer.isActive)}>\n                            {customer.isActive ? \"Active\" : \"Inactive\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex space-x-1\">\n                            <PermissionWrapper resource=\"customers\" action=\"read\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  setSelectedCustomer(customer);\n                                  setIsLedgerDialogOpen(true);\n                                }}\n                                className=\"text-green-600 hover:text-green-800 focus:outline-none\"\n                                title=\"View\"\n                              >\n                                <Eye className=\"h-4 w-4\" />\n                              </Button>\n                            </PermissionWrapper>\n                            <PermissionWrapper\n                              resource=\"customers\"\n                              action=\"write\"\n                            >\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  setSelectedCustomer(customer);\n                                  setIsTransactionDialogOpen(true);\n                                }}\n                                title=\"Add Transaction\"\n                              >\n                                <Plus className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  setEditingCustomer(customer);\n                                  setFormErrors({});\n                                  setIsDialogOpen(true);\n                                }}\n                                className=\"text-blue-600 hover:text-blue-800 focus:outline-none\"\n                                title=\"Edit\"\n                              >\n                                <Edit className=\"h-4 w-4\" />\n                              </Button>\n                              <DeleteConfirmationDialog\n                                trigger={\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"text-red-600 hover:text-red-800 focus:outline-none\"\n                                    title=\"Delete\"\n                                  >\n                                    <Trash2 className=\"h-4 w-4\" />\n                                  </Button>\n                                }\n                                title=\"Delete Customer\"\n                                itemName={customer.name}\n                                onConfirm={() =>\n                                  deleteMutation.mutate(customer.id)\n                                }\n                                isLoading={deleteMutation.isPending}\n                              />\n                            </PermissionWrapper>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                    })\n                  ) : (\n                    <TableRow>\n                      <TableCell colSpan={7} className=\"text-center py-12\">\n                        <div className=\"flex flex-col items-center justify-center\">\n                          <Users className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                          <h3 className=\"text-lg font-semibold mb-2\">No customers found</h3>\n                          <p className=\"text-muted-foreground mb-4\">\n                            {searchQuery || statusFilter !== \"all\"\n                              ? 'No customers match your search criteria.'\n                              : 'Start by adding your first customer.'}\n                          </p>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n\n              {/* Pagination Controls */}\n              {filteredCustomers.length > 0 && (\n                <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 mt-4\">\n                  <PaginationInfo\n                    currentPage={currentPage}\n                    pageSize={pageSize}\n                    totalItems={totalItems}\n                  />\n                  <div className=\"flex items-center gap-4\">\n                    <PageSizeSelector\n                      pageSize={pageSize}\n                      onPageSizeChange={handlePageSizeChange}\n                    />\n                    <Pagination\n                      currentPage={currentPage}\n                      totalPages={totalPages}\n                      onPageChange={handlePageChange}\n                    />\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Transaction Dialog */}\n      <Dialog\n        open={isTransactionDialogOpen}\n        onOpenChange={(open) => {\n          setIsTransactionDialogOpen(open);\n          if (!open) {\n            setTransactionType(\"\");\n            setTransactionErrors({});\n          }\n        }}\n      >\n        <DialogContent className=\"max-w-2xl mx-auto max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Plus className=\"h-5 w-5\" />\n              Add Transaction for {selectedCustomer?.name}\n            </DialogTitle>\n            <DialogDescription className=\"text-base\">\n              Record a new transaction to track debits and credits for this\n              customer\n            </DialogDescription>\n          </DialogHeader>\n\n          <form onSubmit={handleTransactionSave} className=\"space-y-6\">\n            {/* Transaction Type Section */}\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-lg\">Transaction Details</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label\n                      htmlFor=\"transactionType\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Transaction Type *\n                    </Label>\n                    <Select\n                      value={transactionType}\n                      onValueChange={setTransactionType}\n                      required\n                    >\n                      <SelectTrigger\n                        className={\n                          transactionErrors.transactionType\n                            ? \"border-red-500\"\n                            : \"\"\n                        }\n                      >\n                        <SelectValue placeholder=\"Select transaction type\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"sale\">\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">Sale</span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              They owe us (Debit)\n                            </span>\n                          </div>\n                        </SelectItem>\n                        <SelectItem value=\"payment_received\">\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">Payment Received</span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              They paid us (Credit)\n                            </span>\n                          </div>\n                        </SelectItem>\n                        <SelectItem value=\"adjustment_debit\">\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">\n                              Adjustment (Debit)\n                            </span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              Increase what they owe us\n                            </span>\n                          </div>\n                        </SelectItem>\n                        <SelectItem value=\"adjustment_credit\">\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">\n                              Adjustment (Credit)\n                            </span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              Decrease what they owe us\n                            </span>\n                          </div>\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                    {transactionErrors.transactionType && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {transactionErrors.transactionType}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label\n                      htmlFor=\"transactionDate\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Transaction Date *\n                    </Label>\n                    <Input\n                      id=\"transactionDate\"\n                      name=\"transactionDate\"\n                      type=\"date\"\n                      defaultValue={format(new Date(), \"yyyy-MM-dd\")}\n                      className={\n                        transactionErrors.transactionDate\n                          ? \"border-red-500\"\n                          : \"\"\n                      }\n                      required\n                    />\n                    {transactionErrors.transactionDate && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {transactionErrors.transactionDate}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\" className=\"text-sm font-medium\">\n                    Description *\n                  </Label>\n                  <Input\n                    id=\"description\"\n                    name=\"description\"\n                    placeholder=\"Enter detailed transaction description\"\n                    className={\n                      transactionErrors.description ? \"border-red-500\" : \"\"\n                    }\n                    required\n                  />\n                  {transactionErrors.description && (\n                    <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                      <AlertCircle className=\"h-4 w-4\" />\n                      {transactionErrors.description}\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Amount and Payment Section */}\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-lg\">Financial Details</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"amount\" className=\"text-sm font-medium\">\n                      Amount *\n                    </Label>\n                    <Input\n                      id=\"amount\"\n                      name=\"amount\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0.01\"\n                      placeholder=\"0.00\"\n                      className={\n                        transactionErrors.amount ? \"border-red-500\" : \"\"\n                      }\n                      required\n                    />\n                    {transactionErrors.amount && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {transactionErrors.amount}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label\n                      htmlFor=\"paymentMethod\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Payment Method\n                    </Label>\n                    <Select name=\"paymentMethod\">\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select payment method\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"cash\">Cash</SelectItem>\n                        <SelectItem value=\"bank_transfer\">\n                          Bank Transfer\n                        </SelectItem>\n                        <SelectItem value=\"cheque\">Cheque</SelectItem>\n                        <SelectItem value=\"credit_card\">Credit Card</SelectItem>\n                        <SelectItem value=\"upi\">UPI</SelectItem>\n                        <SelectItem value=\"other\">Other</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label\n                    htmlFor=\"referenceNumber\"\n                    className=\"text-sm font-medium\"\n                  >\n                    Reference Number\n                  </Label>\n                  <Input\n                    id=\"referenceNumber\"\n                    name=\"referenceNumber\"\n                    placeholder=\"Invoice number, receipt number, etc. (optional)\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    Enter invoice number, receipt number, or any reference for\n                    this transaction\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Additional Information Section */}\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-lg\">\n                  Additional Information\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"notes\" className=\"text-sm font-medium\">\n                    Additional Notes\n                  </Label>\n                  <Textarea\n                    id=\"notes\"\n                    name=\"notes\"\n                    placeholder=\"Any additional notes, terms, or conditions (optional)\"\n                    rows={3}\n                    className=\"resize-none\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Account Impact Preview */}\n            {transactionType && (\n              <Card className=\"border-blue-200 bg-blue-50\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\n                    <span className=\"text-sm font-medium text-blue-900\">\n                      Account Impact\n                    </span>\n                  </div>\n                  <p className=\"text-sm text-blue-800\">\n                    {transactionType === \"sale\" &&\n                      \"This will increase the amount owed by the customer (Debit their account)\"}\n                    {transactionType === \"payment_received\" &&\n                      \"This will decrease the amount owed by the customer (Credit their account)\"}\n                    {transactionType === \"adjustment_debit\" &&\n                      \"This will increase the customer's account balance (Debit adjustment)\"}\n                    {transactionType === \"adjustment_credit\" &&\n                      \"This will decrease the customer's account balance (Credit adjustment)\"}\n                  </p>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Form Actions */}\n            <div className=\"flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => {\n                  setIsTransactionDialogOpen(false);\n                  setTransactionType(\"\");\n                  setTransactionErrors({});\n                }}\n                className=\"w-full sm:w-auto\"\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={transactionMutation.isPending || !transactionType}\n                className=\"w-full sm:w-auto\"\n              >\n                {transactionMutation.isPending ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                    Adding Transaction...\n                  </>\n                ) : (\n                  <>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Add Transaction\n                  </>\n                )}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Ledger View Dialog */}\n      <Dialog open={isLedgerDialogOpen} onOpenChange={setIsLedgerDialogOpen}>\n        <DialogContent className=\"max-w-6xl mx-auto max-h-[80vh]\">\n          <DialogHeader>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <DialogTitle>Customer Ledger - {selectedCustomer?.name}</DialogTitle>\n                <DialogDescription>\n                  Complete transaction history with debit/credit tracking\n                </DialogDescription>\n              </div>\n              <Button variant=\"outline\" onClick={exportLedger}>\n                <Download className=\"h-4 w-4 mr-2\" />\n                Export CSV\n              </Button>\n            </div>\n          </DialogHeader>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm text-muted-foreground\">\n                  Total Debits\n                </div>\n                <div className=\"text-lg font-semibold text-red-600\">\n                  {formatCurrency(calculateTotals().totalDebit)}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm text-muted-foreground\">\n                  Total Credits\n                </div>\n                <div className=\"text-lg font-semibold text-green-600\">\n                  {formatCurrency(calculateTotals().totalCredit)}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm text-muted-foreground\">Net Balance</div>\n                <div\n                  className={`text-lg font-semibold ${\n                    parseFloat(selectedCustomer?.currentBalance?.toString() || \"0\") >= 0\n                      ? \"text-red-600\"\n                      : \"text-green-600\"\n                  }`}\n                >\n                  {getBalanceBadge(selectedCustomer?.currentBalance).text}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"overflow-y-auto max-h-[50vh] border rounded-lg\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Reference</TableHead>\n                  <TableHead className=\"text-right\">Debit</TableHead>\n                  <TableHead className=\"text-right\">Credit</TableHead>\n                  <TableHead className=\"text-right\">Running Balance</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {ledgerTransactions.map((transaction: LedgerTransaction) => (\n                  <TableRow key={transaction.id}>\n                    <TableCell>\n                      {format(\n                        new Date(transaction.transactionDate),\n                        \"dd/MM/yyyy\",\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      <div>\n                        <div className=\"font-medium\">\n                          {transaction.description}\n                        </div>\n                        {transaction.notes && (\n                          <div className=\"text-sm text-muted-foreground\">\n                            {transaction.notes}\n                          </div>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell>{transaction.referenceNumber || \"-\"}</TableCell>\n                    <TableCell className=\"text-right\">\n                      {parseFloat(transaction.debitAmount) > 0 ? (\n                        <span className=\"text-red-600 font-medium\">\n                          {formatCurrency(parseFloat(transaction.debitAmount))}\n                        </span>\n                      ) : (\n                        \"-\"\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {parseFloat(transaction.creditAmount) > 0 ? (\n                        <span className=\"text-green-600 font-medium\">\n                          {formatCurrency(parseFloat(transaction.creditAmount))}\n                        </span>\n                      ) : (\n                        \"-\"\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right font-medium\">\n                      <span\n                        className={\n                          parseFloat(transaction.runningBalance) >= 0\n                            ? \"text-red-600\"\n                            : \"text-green-600\"\n                        }\n                      >\n                        {formatCurrency(\n                          Math.abs(parseFloat(transaction.runningBalance)),\n                        )}\n                        {parseFloat(transaction.runningBalance) >= 0\n                          ? \" Dr\"\n                          : \" Cr\"}\n                      </span>\n                    </TableCell>\n                  </TableRow>\n                ))}\n                {ledgerTransactions.length === 0 && (\n                  <TableRow>\n                    <TableCell\n                      colSpan={6}\n                      className=\"text-center py-8 text-muted-foreground\"\n                    >\n                      No transactions found. Click the \"+\" button to add the\n                      first transaction.\n                    </TableCell>\n                  </TableRow>\n                )}\n              </TableBody>\n            </Table>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":53515,"size_tokens":null},"client/src/pages/staff.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport React from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Plus, Edit, Trash2, Users, Phone, Mail, MapPin } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport SearchBar from \"@/components/search-bar\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n} from \"@/components/ui/pagination\";\n\nexport default function StaffDirectory() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingStaff, setEditingStaff] = useState<any>(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [pageSize, setPageSize] = useState(10);\n  const [formData, setFormData] = useState({\n    staffId: \"\",\n    firstName: \"\",\n    lastName: \"\",\n    email: \"\",\n    phone: \"\",\n    address: \"\",\n    dateOfBirth: \"\",\n    hireDate: \"\",\n    position: \"\",\n    department: \"\",\n    employmentType: \"full-time\",\n    salary: \"\",\n    hourlyRate: \"\",\n    bankAccount: \"\",\n    emergencyContact: \"\",\n    emergencyPhone: \"\",\n    citizenshipNumber: \"\",\n    panNumber: \"\",\n    profilePhoto: \"\",\n    identityCardUrl: \"\",\n    agreementPaperUrl: \"\",\n    notes: \"\",\n  });\n\n  const { toast } = useToast();\n\n  const {\n    data: staffData,\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: [\"/api/staff\", currentPage, pageSize, searchQuery],\n    queryFn: async () => {\n      const response = await apiRequest(\n        \"GET\",\n        `/api/staff?page=${currentPage}&limit=${pageSize}&search=${encodeURIComponent(searchQuery)}`,\n      );\n      console.log(\"üìã Staff API response:\", response);\n      return response;\n    },\n  });\n\n  // Handle both paginated and direct array responses\n  const staff = React.useMemo(() => {\n    if (!staffData) return [];\n\n    // If response has items property (paginated)\n    if (staffData.items && Array.isArray(staffData.items)) {\n      return staffData.items;\n    }\n\n    // If response is directly an array\n    if (Array.isArray(staffData)) {\n      return staffData;\n    }\n\n    return [];\n  }, [staffData]);\n\n  const totalItems = staffData?.totalCount || staff.length;\n  const totalPages =\n    staffData?.totalPages || Math.ceil(staff.length / pageSize);\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/staff\", data);\n      return response;\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Success\",\n        description: `Staff member \"${data.firstName} ${data.lastName}\" created successfully with ID: ${data.staffId}`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/staff\"] });\n      setIsDialogOpen(false);\n      resetForm();\n      setCurrentPage(1); // Reset to first page\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create staff member\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: any) => {\n      await apiRequest(\"PUT\", `/api/staff/${editingStaff?.id}`, data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Staff member updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/staff\"] });\n      setIsDialogOpen(false);\n      resetForm();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update staff member\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/staff/${id}`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Staff member deleted successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/staff\"] });\n      // If we're on the last page and it becomes empty, go to previous page\n      if (staff.length === 1 && currentPage > 1) {\n        setCurrentPage(currentPage - 1);\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete staff member\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const uploadDocumentMutation = useMutation({\n    mutationFn: async ({\n      file,\n      documentType,\n      staffId,\n    }: {\n      file: File;\n      documentType: string;\n      staffId: string;\n    }) => {\n      const formData = new FormData();\n      formData.append(\"document\", file);\n      formData.append(\"documentType\", documentType);\n      formData.append(\"staffId\", staffId);\n\n      const response = await fetch(\"/api/staff/upload-document\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to upload document\");\n      }\n\n      return response.json();\n    },\n    onSuccess: (data, variables) => {\n      toast({\n        title: \"Success\",\n        description: `${variables.documentType} uploaded successfully`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to upload document\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      staffId: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      email: \"\",\n      phone: \"\",\n      address: \"\",\n      dateOfBirth: \"\",\n      hireDate: \"\",\n      position: \"\",\n      department: \"\",\n      employmentType: \"full-time\",\n      salary: \"\",\n      hourlyRate: \"\",\n      bankAccount: \"\",\n      emergencyContact: \"\",\n      emergencyPhone: \"\",\n      citizenshipNumber: \"\",\n      panNumber: \"\",\n      profilePhoto: \"\",\n      identityCardUrl: \"\",\n      agreementPaperUrl: \"\",\n      notes: \"\",\n    });\n    setEditingStaff(null);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (\n      !formData.firstName ||\n      !formData.lastName ||\n      !formData.position ||\n      !formData.department ||\n      !formData.hireDate\n    ) {\n      const missingFields = [];\n      if (!formData.firstName) missingFields.push(\"First Name\");\n      if (!formData.lastName) missingFields.push(\"Last Name\");\n      if (!formData.position) missingFields.push(\"Position\");\n      if (!formData.department) missingFields.push(\"Department\");\n      if (!formData.hireDate) missingFields.push(\"Hire Date\");\n\n      toast({\n        title: \"Error\",\n        description: `Please fill in the following required fields: ${missingFields.join(\", \")}`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Auto-generate staff ID if not provided\n    let submitData = { ...formData };\n    if (!editingStaff && !formData.staffId) {\n      const timestamp = Date.now().toString().slice(-6);\n      const initials = (\n        formData.firstName.charAt(0) + formData.lastName.charAt(0)\n      ).toUpperCase();\n      submitData.staffId = `EMP${initials}${timestamp}`;\n    }\n\n    if (editingStaff) {\n      updateMutation.mutate(submitData);\n    } else {\n      createMutation.mutate(submitData);\n    }\n  };\n\n  const handleEdit = (staffMember: any) => {\n    setEditingStaff(staffMember);\n    setFormData({\n      staffId: staffMember.staffId || \"\",\n      firstName: staffMember.firstName || \"\",\n      lastName: staffMember.lastName || \"\",\n      email: staffMember.email || \"\",\n      phone: staffMember.phone || \"\",\n      address: staffMember.address || \"\",\n      dateOfBirth: staffMember.dateOfBirth\n        ? new Date(staffMember.dateOfBirth).toISOString().split(\"T\")[0]\n        : \"\",\n      hireDate: staffMember.hireDate\n        ? new Date(staffMember.hireDate).toISOString().split(\"T\")[0]\n        : \"\",\n      position: staffMember.position || \"\",\n      department: staffMember.department || \"\",\n      employmentType: staffMember.employmentType || \"full-time\",\n      salary: staffMember.salary || \"\",\n      hourlyRate: staffMember.hourlyRate || \"\",\n      bankAccount: staffMember.bankAccount || \"\",\n      emergencyContact: staffMember.emergencyContact || \"\",\n      emergencyPhone: staffMember.emergencyPhone || \"\",\n      citizenshipNumber: staffMember.citizenshipNumber || \"\",\n      panNumber: staffMember.panNumber || \"\",\n      profilePhoto: staffMember.profilePhoto || \"\",\n      identityCardUrl: staffMember.identityCardUrl || \"\",\n      agreementPaperUrl: staffMember.agreementPaperUrl || \"\",\n      notes: staffMember.notes || \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = async (id: number) => {\n    deleteMutation.mutate(id);\n  };\n\n  const handleFileUpload = async (file: File, documentType: string) => {\n    const staffId = formData.staffId || `temp_${Date.now()}`;\n\n    try {\n      const result = await uploadDocumentMutation.mutateAsync({\n        file,\n        documentType,\n        staffId,\n      });\n\n      // Update form data with the uploaded file URL\n      setFormData((prev) => ({\n        ...prev,\n        [documentType === \"profile_photo\"\n          ? \"profilePhoto\"\n          : documentType === \"identity_card\"\n            ? \"identityCardUrl\"\n            : \"agreementPaperUrl\"]: result.url,\n      }));\n    } catch (error) {\n      console.error(\"File upload failed:\", error);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const statusConfig = {\n      active: { variant: \"default\" as const, label: \"Active\" },\n      inactive: { variant: \"secondary\" as const, label: \"Inactive\" },\n      terminated: { variant: \"destructive\" as const, label: \"Terminated\" },\n    };\n\n    const config =\n      statusConfig[status as keyof typeof statusConfig] || statusConfig.active;\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  // Add sorting functionality\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    staff,\n    \"firstName\",\n  );\n\n  // Handle search with debouncing\n  const handleSearchChange = (value: string) => {\n    setSearchQuery(value);\n    setCurrentPage(1); // Reset to first page when searching\n  };\n\n  // Handle page size change\n  const handlePageSizeChange = (newSize: number) => {\n    setPageSize(newSize);\n    setCurrentPage(1); // Reset to first page when changing page size\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n        <div>\n          <p className=\"text-muted-foreground\">\n            Manage your bakery staff members\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={() => resetForm()}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Staff Member\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingStaff ? \"Edit Staff Member\" : \"Add New Staff Member\"}\n              </DialogTitle>\n            </DialogHeader>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"staffId\">\n                    Staff ID {!editingStaff && \"(Auto-generated if empty)\"}\n                  </Label>\n                  <Input\n                    id=\"staffId\"\n                    value={formData.staffId}\n                    onChange={(e) =>\n                      setFormData({ ...formData, staffId: e.target.value })\n                    }\n                    placeholder={\n                      editingStaff\n                        ? \"Enter staff ID\"\n                        : \"Auto-generated if empty\"\n                    }\n                    required={!!editingStaff}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"employmentType\">Employment Type *</Label>\n                  <Select\n                    value={formData.employmentType}\n                    onValueChange={(value) =>\n                      setFormData({ ...formData, employmentType: value })\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"full-time\">Full Time</SelectItem>\n                      <SelectItem value=\"part-time\">Part Time</SelectItem>\n                      <SelectItem value=\"contract\">Contract</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"firstName\">First Name *</Label>\n                  <Input\n                    id=\"firstName\"\n                    value={formData.firstName}\n                    onChange={(e) =>\n                      setFormData({ ...formData, firstName: e.target.value })\n                    }\n                    required\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"lastName\">Last Name *</Label>\n                  <Input\n                    id=\"lastName\"\n                    value={formData.lastName}\n                    onChange={(e) =>\n                      setFormData({ ...formData, lastName: e.target.value })\n                    }\n                    required\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"email\">Email</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    value={formData.email}\n                    onChange={(e) =>\n                      setFormData({ ...formData, email: e.target.value })\n                    }\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"phone\">Phone</Label>\n                  <Input\n                    id=\"phone\"\n                    value={formData.phone}\n                    onChange={(e) =>\n                      setFormData({ ...formData, phone: e.target.value })\n                    }\n                  />\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"address\">Address</Label>\n                <Input\n                  id=\"address\"\n                  value={formData.address}\n                  onChange={(e) =>\n                    setFormData({ ...formData, address: e.target.value })\n                  }\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"dateOfBirth\">Date of Birth</Label>\n                  <Input\n                    id=\"dateOfBirth\"\n                    type=\"date\"\n                    value={formData.dateOfBirth}\n                    onChange={(e) =>\n                      setFormData({ ...formData, dateOfBirth: e.target.value })\n                    }\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"hireDate\">Hire Date *</Label>\n                  <Input\n                    id=\"hireDate\"\n                    type=\"date\"\n                    value={formData.hireDate}\n                    onChange={(e) =>\n                      setFormData({ ...formData, hireDate: e.target.value })\n                    }\n                    required\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"position\">Position *</Label>\n                  <Input\n                    id=\"position\"\n                    value={formData.position}\n                    onChange={(e) =>\n                      setFormData({ ...formData, position: e.target.value })\n                    }\n                    placeholder=\"Baker, Cashier, Manager\"\n                    required\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"department\">Department *</Label>\n                  <Select\n                    value={formData.department}\n                    onValueChange={(value) =>\n                      setFormData({ ...formData, department: value })\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select department\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"Production\">Production</SelectItem>\n                      <SelectItem value=\"Sales\">Sales</SelectItem>\n                      <SelectItem value=\"Management\">Management</SelectItem>\n                      <SelectItem value=\"Admin\">Admin</SelectItem>\n                      <SelectItem value=\"Kitchen\">Kitchen</SelectItem>\n                      <SelectItem value=\"Delivery\">Delivery</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"salary\">Monthly Salary (Rs.)</Label>\n                  <Input\n                    id=\"salary\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={formData.salary}\n                    onChange={(e) =>\n                      setFormData({ ...formData, salary: e.target.value })\n                    }\n                    placeholder=\"0.00\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"hourlyRate\">Hourly Rate</Label>\n                  <Input\n                    id=\"hourlyRate\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={formData.hourlyRate}\n                    onChange={(e) =>\n                      setFormData({ ...formData, hourlyRate: e.target.value })\n                    }\n                    placeholder=\"0.00\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"bankAccount\">Bank Account</Label>\n                <Input\n                  id=\"bankAccount\"\n                  value={formData.bankAccount}\n                  onChange={(e) =>\n                    setFormData({ ...formData, bankAccount: e.target.value })\n                  }\n                  placeholder=\"Account number\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"emergencyContact\">Emergency Contact</Label>\n                  <Input\n                    id=\"emergencyContact\"\n                    value={formData.emergencyContact}\n                    onChange={(e) =>\n                      setFormData({\n                        ...formData,\n                        emergencyContact: e.target.value,\n                      })\n                    }\n                    placeholder=\"Contact name\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"emergencyPhone\">Emergency Phone</Label>\n                  <Input\n                    id=\"emergencyPhone\"\n                    value={formData.emergencyPhone}\n                    onChange={(e) =>\n                      setFormData({\n                        ...formData,\n                        emergencyPhone: e.target.value,\n                      })\n                    }\n                    placeholder=\"Phone number\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"citizenshipNumber\">Citizenship Number</Label>\n                  <Input\n                    id=\"citizenshipNumber\"\n                    value={formData.citizenshipNumber}\n                    onChange={(e) =>\n                      setFormData({\n                        ...formData,\n                        citizenshipNumber: e.target.value,\n                      })\n                    }\n                    placeholder=\"Citizenship number\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"panNumber\">PAN Number</Label>\n                  <Input\n                    id=\"panNumber\"\n                    value={formData.panNumber}\n                    onChange={(e) =>\n                      setFormData({ ...formData, panNumber: e.target.value })\n                    }\n                    placeholder=\"PAN number\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <Label htmlFor=\"profilePhoto\">Profile Photo</Label>\n                  <div className=\"flex items-center space-x-2\">\n                    <Input\n                      type=\"file\"\n                      accept=\"image/*\"\n                      onChange={(e) => {\n                        const file = e.target.files?.[0];\n                        if (file) handleFileUpload(file, \"profile_photo\");\n                      }}\n                    />\n                    {formData.profilePhoto && (\n                      <span className=\"text-sm text-green-600\">‚úì Uploaded</span>\n                    )}\n                  </div>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"identityCard\">\n                    Identity Card (Image/PDF)\n                  </Label>\n                  <div className=\"flex items-center space-x-2\">\n                    <Input\n                      type=\"file\"\n                      accept=\"image/*,application/pdf\"\n                      onChange={(e) => {\n                        const file = e.target.files?.[0];\n                        if (file) handleFileUpload(file, \"identity_card\");\n                      }}\n                    />\n                    {formData.identityCardUrl && (\n                      <span className=\"text-sm text-green-600\">‚úì Uploaded</span>\n                    )}\n                  </div>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"agreementPaper\">\n                    Agreement Paper (Image/PDF)\n                  </Label>\n                  <div className=\"flex items-center space-x-2\">\n                    <Input\n                      type=\"file\"\n                      accept=\"image/*,application/pdf\"\n                      onChange={(e) => {\n                        const file = e.target.files?.[0];\n                        if (file) handleFileUpload(file, \"agreement_paper\");\n                      }}\n                    />\n                    {formData.agreementPaperUrl && (\n                      <span className=\"text-sm text-green-600\">‚úì Uploaded</span>\n                    )}\n                  </div>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"notes\">Notes</Label>\n                <Textarea\n                  id=\"notes\"\n                  value={formData.notes}\n                  onChange={(e) =>\n                    setFormData({ ...formData, notes: e.target.value })\n                  }\n                  placeholder=\"Additional notes\"\n                />\n              </div>\n\n              <div className=\"flex justify-end space-x-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={\n                    createMutation.isPending || updateMutation.isPending\n                  }\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? \"Saving...\"\n                    : editingStaff\n                      ? \"Update\"\n                      : \"Create\"}\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center space-x-2\">\n        <div className=\"flex-1\">\n          <SearchBar\n            placeholder=\"Search staff members...\"\n            value={searchQuery}\n            onChange={handleSearchChange}\n            className=\"w-full\"\n          />\n        </div>\n      </div>\n\n      {/* Staff Table */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Staff Members</CardTitle>\n            <div className=\"flex items-center space-x-4\">\n              <PageSizeSelector\n                pageSize={pageSize}\n                onPageSizeChange={handlePageSizeChange}\n                options={[5, 10, 20, 50]}\n              />\n              <PaginationInfo\n                currentPage={currentPage}\n                totalPages={totalPages}\n                totalItems={totalItems}\n              />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto\"></div>\n              <p className=\"text-muted-foreground mt-2\">Loading staff...</p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"staffId\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Staff ID\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"firstName\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Name\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"position\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Position\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"department\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Department\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"email\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Contact\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"employmentType\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Employment\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"status\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Status\n                    </SortableTableHeader>\n                    <TableHead>Documents</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {sortedData.map((member: any) => (\n                    <TableRow key={member.id}>\n                      <TableCell className=\"font-medium\">\n                        {member.staffId}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center space-x-3\">\n                          {member.profilePhoto && (\n                            <img\n                              src={member.profilePhoto}\n                              alt=\"Profile\"\n                              className=\"w-8 h-8 rounded-full object-cover\"\n                            />\n                          )}\n                          <div>\n                            <div className=\"font-medium\">\n                              {member.firstName} {member.lastName}\n                            </div>\n                            <div className=\"text-sm text-muted-foreground\">\n                              Hired:{\" \"}\n                              {new Date(member.hireDate).toLocaleDateString()}\n                            </div>\n                            {member.citizenshipNumber && (\n                              <div className=\"text-xs text-muted-foreground\">\n                                Citizenship: {member.citizenshipNumber}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>{member.position}</TableCell>\n                      <TableCell>{member.department}</TableCell>\n                      <TableCell>\n                        <div className=\"space-y-1\">\n                          {member.email && (\n                            <div className=\"flex items-center text-sm\">\n                              <Mail className=\"h-3 w-3 mr-1\" />\n                              {member.email}\n                            </div>\n                          )}\n                          {member.phone && (\n                            <div className=\"flex items-center text-sm\">\n                              <Phone className=\"h-3 w-3 mr-1\" />\n                              {member.phone}\n                            </div>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\">\n                          {member.employmentType?.replace(\"-\", \" \") ||\n                            \"Full Time\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {getStatusBadge(member.status || \"active\")}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex space-x-1\">\n                          {member.identityCardUrl && (\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              ID\n                            </Badge>\n                          )}\n                          {member.agreementPaperUrl && (\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              Agreement\n                            </Badge>\n                          )}\n                          {member.profilePhoto && (\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              Photo\n                            </Badge>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex space-x-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(member)}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <DeleteConfirmationDialog\n                            trigger={\n                              <Button variant=\"ghost\" size=\"sm\">\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            }\n                            title=\"Delete Staff Member\"\n                            itemName={`${member.firstName} ${member.lastName}`}\n                            onConfirm={() => handleDelete(member.id)}\n                            isLoading={deleteMutation.isPending}\n                          />\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n\n          {!isLoading && totalPages > 1 && (\n            <div className=\"mt-4 flex justify-center\">\n              <Pagination\n                currentPage={currentPage}\n                totalPages={totalPages}\n                onPageChange={setCurrentPage}\n              />\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":33849,"size_tokens":null},"server/create-user.ts":{"content":"\nimport { db } from \"./db\";\nimport { users } from \"../shared/schema\";\nimport bcrypt from \"bcrypt\";\n\nasync function createUser() {\n  try {\n    console.log(\"üë§ Creating new user...\");\n    \n    const userEmail = \"test@bakersoft.com\";\n    const userPassword = \"test123\";\n    const hashedPassword = await bcrypt.hash(userPassword, 10);\n    \n    const newUser = {\n      id: `user_${Date.now()}`,\n      email: userEmail,\n      password: hashedPassword,\n      firstName: \"Test\",\n      lastName: \"User\",\n      role: \"admin\"\n    };\n\n    await db.insert(users).values(newUser);\n    \n    console.log(\"\\n‚úÖ User created successfully!\");\n    console.log(\"\\n=== LOGIN CREDENTIALS ===\");\n    console.log(\"Email:\", userEmail);\n    console.log(\"Password:\", userPassword);\n    console.log(\"Role: admin\");\n    console.log(\"=========================\");\n    console.log(\"\\nüöÄ You can now login with these credentials!\");\n    \n  } catch (error) {\n    console.error(\"‚ùå Error creating user:\", error);\n    \n    if (error.message?.includes('relation \"users\" does not exist')) {\n      console.log(\"\\nüí° It looks like the database tables don't exist yet.\");\n      console.log(\"Please run the migration script first:\");\n      console.log(\"npx tsx server/migrate-and-seed.ts\");\n    }\n  }\n}\n\n// Run if this file is executed directly\nif (import.meta.url === `file://${process.argv[1]}`) {\n  createUser().then(() => {\n    console.log(\"Process completed\");\n    process.exit(0);\n  }).catch((error) => {\n    console.error(\"Process failed:\", error);\n    process.exit(1);\n  });\n}\n\nexport { createUser };\n","path":null,"size_bytes":1574,"size_tokens":null},"server/migrate-and-seed.ts":{"content":"import { drizzle } from \"drizzle-orm/postgres-js\";\nimport { migrate } from \"drizzle-orm/postgres-js/migrator\";\nimport postgres from \"postgres\";\nimport bcrypt from \"bcrypt\";\nimport { users } from \"../shared/schema\";\nimport { runMigrations } from \"./db\";\nimport { initializeCompleteSystem } from \"./init-complete-system\";\n\nconst connectionString = process.env.DATABASE_URL;\n\nif (!connectionString) {\n  throw new Error(\"DATABASE_URL environment variable is required\");\n}\n\nconst sql = postgres(connectionString, { max: 1 });\nconst db = drizzle(sql);\n\nasync function migrateAndSeed() {\n  try {\n    console.log(\"üîÑ Running database migrations...\");\n    await runMigrations();\n    console.log(\"‚úÖ Database migrations completed\");\n\n    console.log(\"üë§ Initializing complete system...\");\n    await initializeCompleteSystem();\n  } catch (error) {\n    console.error(\"‚ùå Database setup failed:\", error);\n    process.exit(1);\n  } finally {\n    await sql.end();\n  }\n}\n\n// Run if this file is executed directly\nif (import.meta.url === `file://${process.argv[1]}`) {\n  migrateAndSeed()\n    .then(() => {\n      console.log(\"‚úÖ Process completed\");\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error(\"‚ùå Process failed:\", error);\n      process.exit(1);\n    });\n}\n\nexport { migrateAndSeed };\n","path":null,"size_bytes":1304,"size_tokens":null},"client/src/pages/notifications.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Bell, Filter, Search, Trash2 } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface Notification {\n  id: string;\n  type: \"order\" | \"stock\" | \"production\" | \"system\";\n  title: string;\n  description: string;\n  timestamp: string;\n  read: boolean;\n  priority: \"low\" | \"medium\" | \"high\";\n}\n\nexport default function Notifications() {\n  const [activeTab, setActiveTab] = useState(\"activity\");\n  const [filter, setFilter] = useState(\"all\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const markAsReadMutation = useMutation({\n    mutationFn: async (notificationId: string) => {\n      const response = await fetch(\n        `/api/notifications/${notificationId}/read`,\n        {\n          method: \"PUT\",\n          credentials: \"include\",\n        },\n      );\n      if (!response.ok) throw new Error(\"Failed to mark as read\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n    },\n  });\n\n  const markAllAsReadMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(\"/api/notifications/mark-all-read\", {\n        method: \"PUT\",\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to mark all as read\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      toast({\n        title: \"Success\",\n        description: \"All notifications marked as read\",\n      });\n    },\n  });\n\n  const deleteNotificationMutation = useMutation({\n    mutationFn: async (notificationId: string) => {\n      const response = await fetch(`/api/notifications/${notificationId}`, {\n        method: \"DELETE\",\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to delete notification\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      toast({\n        title: \"Success\",\n        description: \"Notification deleted successfully\",\n      });\n    },\n  });\n\n  // Fetch notifications data\n  const { data: notifications = [] } = useQuery({\n    queryKey: [\"/api/notifications\"],\n  });\n\n  const getTypeIcon = (type: string) => {\n    switch (type) {\n      case \"order\":\n        return \"fas fa-shopping-cart\";\n      case \"stock\":\n        return \"fas fa-boxes\";\n      case \"production\":\n        return \"fas fa-industry\";\n      case \"system\":\n        return \"fas fa-cog\";\n      default:\n        return \"fas fa-bell\";\n    }\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case \"order\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"stock\":\n        return \"bg-green-100 text-green-800\";\n      case \"production\":\n        return \"bg-yellow-100 text-yellow-800\";\n      case \"system\":\n        return \"bg-gray-100 text-gray-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case \"high\":\n        return \"bg-red-500\";\n      case \"medium\":\n        return \"bg-yellow-500\";\n      case \"low\":\n        return \"bg-green-500\";\n      default:\n        return \"bg-gray-400\";\n    }\n  };\n\n  const filteredNotifications = notifications.filter((notification) => {\n    const matchesFilter = filter === \"all\" || notification.type === filter;\n    const matchesSearch =\n      notification.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      notification.description.toLowerCase().includes(searchTerm.toLowerCase());\n    return matchesFilter && matchesSearch;\n  });\n  const unreadImportantCount = notifications.filter(\n    (n) => !n.read && [\"order\", \"stock\", \"production\"].includes(n.type),\n  ).length;\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <p className=\"text-gray-600\">\n            Stay updated with your bakery activities\n          </p>\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between\">\n            <div className=\"flex gap-2\">\n              <Button\n                variant={activeTab === \"order\" ? \"default\" : \"outline\"}\n                onClick={() => setActiveTab(\"order\")}\n                size=\"sm\"\n              >\n                Order\n              </Button>\n              <Button\n                variant={activeTab === \"activity\" ? \"destructive\" : \"outline\"}\n                onClick={() => setActiveTab(\"activity\")}\n                size=\"sm\"\n              >\n                Activity\n              </Button>\n              {unreadImportantCount > 0 && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => markAllAsReadMutation.mutate()}\n                  disabled={markAllAsReadMutation.isPending}\n                >\n                  Mark All Read\n                </Button>\n              )}\n            </div>\n\n            <div className=\"flex gap-2 items-center\">\n              <Select value={filter} onValueChange={setFilter}>\n                <SelectTrigger className=\"w-32\">\n                  <SelectValue placeholder=\"Lifetime\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All</SelectItem>\n                  <SelectItem value=\"order\">Orders</SelectItem>\n                  <SelectItem value=\"stock\">Stock</SelectItem>\n                  <SelectItem value=\"production\">Production</SelectItem>\n                  <SelectItem value=\"system\">System</SelectItem>\n                </SelectContent>\n              </Select>\n\n              <Select defaultValue=\"all\">\n                <SelectTrigger className=\"w-32\">\n                  <SelectValue placeholder=\"Type: All\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Type: All</SelectItem>\n                  <SelectItem value=\"read\">Read</SelectItem>\n                  <SelectItem value=\"unread\">Unread</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          <div className=\"flex gap-2 mt-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search notifications...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n\n        <CardContent>\n          <div className=\"space-y-1\">\n            <div className=\"text-sm font-medium text-muted-foreground mb-4\">\n              June 16th, 2025\n            </div>\n\n            {filteredNotifications.map((notification) => (\n              <div\n                key={notification.id}\n                className={`flex items-start gap-3 p-4 rounded-lg border transition-colors hover:bg-muted/50 ${\n                  !notification.read\n                    ? \"bg-blue-50/50 border-blue-200\"\n                    : \"bg-white\"\n                }`}\n              >\n                <div className=\"flex-shrink-0 mt-1\">\n                  <div\n                    className={`w-8 h-8 rounded-full flex items-center justify-center ${getTypeColor(notification.type)}`}\n                  >\n                    <i\n                      className={`${getTypeIcon(notification.type)} text-sm`}\n                    ></i>\n                  </div>\n                </div>\n\n                <div className=\"flex-1 min-w-0 cursor-pointer\" onClick={() => {\n                  if (!notification.read) {\n                    markAsReadMutation.mutate(notification.id);\n                  }\n                }}>\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <h3 className=\"font-medium text-sm\">\n                        {notification.title}\n                      </h3>\n                      <p className=\"text-sm text-muted-foreground mt-1\">\n                        {notification.description}\n                      </p>\n                    </div>\n\n                    <div className=\"flex items-center gap-2 ml-4\">\n                      <div\n                        className={`w-2 h-2 rounded-full ${getPriorityColor(notification.priority)}`}\n                      ></div>\n                      <span className=\"text-xs text-muted-foreground whitespace-nowrap\">\n                        {notification.timestamp}\n                      </span>\n                      {!notification.read &&\n                        [\"order\", \"stock\", \"production\"].includes(\n                          notification.type,\n                        ) && (\n                          <Badge className=\"bg-red-500 text-white text-xs px-1.5 py-0.5\">\n                            New\n                          </Badge>\n                        )}\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-6 w-6 p-0 text-muted-foreground hover:text-red-600\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          deleteNotificationMutation.mutate(notification.id);\n                        }}\n                      >\n                        <i className=\"fas fa-trash text-xs\"></i>\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ))}\n\n            {filteredNotifications.length === 0 && (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Bell className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No notifications found</p>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":10647,"size_tokens":null},"client/src/hooks/useRoleAccess.ts":{"content":"// src/hooks/useRoleAccess.ts\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { usePermissions } from \"@/hooks/usePermissions\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { getRouteModule, getResourceModule, SYSTEM_MODULES } from \"../../../shared/modules\";\n\n/**\n * Hook to provide role-based access control (RBAC)\n * All functions are memoized by reference since they're static per-user\n */\nexport function useRoleAccess() {\n  const { user } = useAuth(); // ‚úÖ Always called unconditionally\n  const { hasPermission } = usePermissions();\n\n  // Fetch user's module access\n  const { data: userModulesResponse } = useQuery({\n    queryKey: [\"user\", \"modules\", user?.id, user?.role],\n    queryFn: async () => {\n      const response = await fetch(\"/api/user/modules\");\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch user modules\");\n      }\n      return response.json();\n    },\n    enabled: !!user,\n    staleTime: 1 * 60 * 1000, // 1 minute (reduced for faster updates)\n    refetchOnWindowFocus: true,\n  });\n\n  const userModuleIds = new Set(userModulesResponse?.data?.moduleIds || []);\n\n  // Role checkers ‚Äî safe even if user is null (returns false)\n  const isSuperAdmin = () => user?.role === \"super_admin\";\n  const isAdmin = () => user?.role === \"admin\";\n  const isManager = () => user?.role === \"manager\";\n  const isSupervisor = () => user?.role === \"supervisor\";\n  const isMarketer = () => user?.role === \"marketer\";\n  const isStaff = () => user?.role === \"staff\";\n\n  /**\n   * Check if current user can access a specific module\n   */\n  const canAccessModule = (moduleId: string): boolean => {\n    if (!user) return false;\n\n    // Super Admin has access to all modules\n    if (isSuperAdmin()) {\n      return true;\n    }\n\n    // Check if user has access to this module\n    return userModuleIds.has(moduleId);\n  };\n\n  /**\n   * Check if current user can access a route based on module access\n   */\n  const canAccessRoute = (route: string): boolean => {\n    if (!user) return false;\n\n    // Super Admin has access to all routes\n    if (isSuperAdmin()) {\n      return true;\n    }\n\n    // Find the module that contains this route\n    const routeModule = getRouteModule(route);\n    if (!routeModule) {\n      return false; // If no module is found, deny access\n    }\n\n    // Check module access\n    return canAccessModule(routeModule.id);\n  };\n\n  /**\n   * Check if current user can access a page/resource\n   */\n  const canAccessPage = (\n    resource: string,\n    action: \"read\" | \"write\" | \"read_write\" = \"read\"\n  ): boolean => {\n    if (!user) return false;\n\n    // Super Admin has UNLIMITED access to everything - no restrictions whatsoever\n    if (isSuperAdmin()) {\n      return true;\n    }\n\n    // First check module-based access\n    const resourceModule = getResourceModule(resource);\n    if (resourceModule && !canAccessModule(resourceModule.id)) {\n      return false;\n    }\n\n    // Admins can do almost everything except super_admin specific resources\n    if (isAdmin()) {\n      const restrictedResources = [\"super_admin\"];\n      return !restrictedResources.includes(resource);\n    }\n\n    // Manager-level access\n    if (isManager()) {\n      const allowedResources = [\n        \"dashboard\",\n        \"products\",\n        \"inventory\",\n        \"orders\",\n        \"production\",\n        \"customers\",\n        \"parties\",\n        \"assets\",\n        \"expenses\",\n        \"sales\",\n        \"purchases\",\n        \"reports\",\n        \"staff\",\n        \"attendance\",\n        \"salary\",\n        \"leave_requests\",\n      ];\n      return allowedResources.includes(resource);\n    }\n\n    // Supervisor access\n    if (isSupervisor()) {\n      const allowedResources = [\n        \"dashboard\",\n        \"products\",\n        \"inventory\",\n        \"orders\",\n        \"production\",\n        \"customers\",\n        \"staff\",\n        \"attendance\",\n      ];\n      return allowedResources.includes(resource);\n    }\n\n    // Marketer access\n    if (isMarketer()) {\n      const allowedResources = [\n        \"dashboard\",\n        \"products\",\n        \"customers\",\n        \"orders\",\n        \"sales\",\n        \"reports\",\n      ];\n      return allowedResources.includes(resource);\n    }\n\n    // Staff access\n    if (isStaff()) {\n      const allowedResources = [\n        \"dashboard\",\n        \"products\",\n        \"inventory\",\n        \"orders\",\n        \"production\",\n      ];\n      return allowedResources.includes(resource);\n    }\n\n    // Fallback to fine-grained permissions system (if any)\n    return hasPermission(resource, action);\n  };\n\n  // Enhanced sidebar item access that considers module access\n  const canAccessSidebarItem = (resource: string, action: \"read\" | \"write\" | \"read_write\" = \"read\"): boolean => {\n    if (!user) return false;\n\n    // Super Admin has access to everything\n    if (isSuperAdmin()) {\n      return true;\n    }\n\n    // Check module access first\n    const resourceModule = getResourceModule(resource);\n    if (resourceModule && !canAccessModule(resourceModule.id)) {\n      return false;\n    }\n\n    // Then check traditional page access\n    return canAccessPage(resource, action);\n  };\n\n  // High-level capability checks - Super Admin has ALL capabilities\n  const canManageUsers = (): boolean => isSuperAdmin() || isAdmin();\n  const canViewSuperAdminUsers = (): boolean => isSuperAdmin();\n  const canManageStaff = (): boolean => isSuperAdmin() || isAdmin() || isManager();\n  const canViewFinance = (): boolean => isSuperAdmin() || isAdmin() || isManager();\n  const canManageSettings = (): boolean => isSuperAdmin() || isAdmin();\n  const canManageBranches = (): boolean => isSuperAdmin() || isAdmin();\n  const canAccessAuditLogs = (): boolean => isSuperAdmin() || isAdmin();\n  const canViewSystemLogs = (): boolean => isSuperAdmin();\n  const canAccessDeveloperTools = (): boolean => isSuperAdmin();\n  const canBypassAllRestrictions = (): boolean => {\n    return isSuperAdmin();\n  };\n  const canExportAllData = (): boolean => isSuperAdmin() || isAdmin();\n  const canModifySystemConfig = (): boolean => isSuperAdmin();\n  const canAccessAllReports = (): boolean => isSuperAdmin() || isAdmin() || isManager();\n\n  // Branch access logic - Super Admin bypasses all branch restrictions\n  const canAccessAllBranches = (): boolean =>\n    isSuperAdmin() || user?.canAccessAllBranches === true;\n\n  const getUserBranchId = (): number | undefined => \n    isSuperAdmin() ? undefined : user?.branchId ?? undefined;\n\n  const canAccessBranchData = (branchId?: number): boolean => {\n    if (isSuperAdmin()) return true; // Super Admin can access ALL branch data\n    if (!branchId) return true;\n    if (canAccessAllBranches()) return true;\n    return getUserBranchId() === branchId;\n  };\n\n  const getBranchDisplayName = (): string => {\n    if (canAccessAllBranches()) return \"All Branches\";\n    return `Branch ${user?.branchId || 'Unknown'}`;\n  };\n\n  const getBranchFilterForUser = () => ({\n    userBranchId: getUserBranchId(),\n    canAccessAllBranches: canAccessAllBranches(),\n  });\n\n  const getRoleDisplayName = (): string => {\n    switch (user?.role) {\n      case \"super_admin\":\n        return \"Super Admin\";\n      case \"admin\":\n        return \"Administrator\";\n      case \"manager\":\n        return \"Manager\";\n      case \"supervisor\":\n        return \"Supervisor\";\n      case \"marketer\":\n        return \"Marketer\";\n      case \"staff\":\n        return \"Staff\";\n      default:\n        return \"Unknown Role\";\n    }\n  };\n\n  return {\n    // Role checkers\n    isSuperAdmin,\n    isAdmin,\n    isManager,\n    isSupervisor,\n    isMarketer,\n    isStaff,\n\n    // Access control\n    canAccessPage,\n    canAccessSidebarItem,\n    canAccessRoute,\n    canAccessModule,\n\n    // Module data\n    userModuleIds: Array.from(userModuleIds),\n    userModulesLoading: !userModulesResponse && !!user,\n\n    // Capabilities\n    canManageUsers,\n    canViewSuperAdminUsers,\n    canManageStaff,\n    canViewFinance,\n    canManageSettings,\n    canManageBranches,\n    canAccessAllBranches,\n    canAccessAuditLogs,\n    canViewSystemLogs,\n    canAccessDeveloperTools,\n    canBypassAllRestrictions,\n    canExportAllData,\n    canModifySystemConfig,\n    canAccessAllReports,\n\n    // Branch utilities\n    getUserBranchId,\n    canAccessBranchData,\n    getBranchDisplayName,\n    getBranchFilterForUser,\n\n    // Display helpers\n    getRoleDisplayName,\n\n    // Raw user object (for advanced usage)\n    user,\n  };\n}","path":null,"size_bytes":8352,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/enhanced-dashboard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  TrendingUp,\n  ShoppingCart,\n  Package,\n  Users,\n  AlertTriangle,\n  Calendar,\n  Plus,\n  Eye,\n  Zap,\n  CheckCircle,\n  Target,\n  Settings,\n  Activity,\n  Clock,\n  RefreshCw,\n  Factory,\n  ArrowUpRight,\n  ArrowDownRight,\n  Banknote,\n  BarChart3,\n  PieChart,\n  TrendingDown,\n  Star,\n  Award,\n  Truck,\n  ShoppingBag,\n  Shield,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { useRoleAccess } from \"@/hooks/useRoleAccess\";\nimport { Link } from \"wouter\";\nimport { format } from \"date-fns\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { SystemPriceCard } from \"@/components/dynamic-price-display\";\n\ninterface ProductionItem {\n  id: number;\n  productName: string;\n  quantity: number;\n  scheduledDate: string;\n  status: string;\n  productCode?: string;\n  batchNo?: string;\n  totalQuantity?: number;\n  unitType?: string;\n  actualQuantityPackets?: number;\n  priority?: \"low\" | \"medium\" | \"high\";\n  shift?: string;\n  assignedTo?: string;\n  productionStartTime?: string;\n  productionEndTime?: string;\n  scheduleDate?: string;\n}\n\n// Helper component for Order Status Badges\nconst OrderStatusBadge = ({ status }: { status: string }) => {\n  const statusConfig = {\n    completed: { variant: \"default\", color: \"text-green-600\" },\n    in_progress: { variant: \"secondary\", color: \"text-blue-600\" },\n    pending: { variant: \"outline\", color: \"text-yellow-600\" },\n    cancelled: { variant: \"destructive\", color: \"text-red-600\" },\n  };\n\n  const config =\n    statusConfig[status as keyof typeof statusConfig] || statusConfig.pending;\n\n  return (\n    <Badge variant={config.variant as any} className={config.color}>\n      {status.replace(\"_\", \" \").toUpperCase()}\n    </Badge>\n  );\n};\n\n// Enhanced Quick Stat Card\nconst QuickStatCard = ({\n  title,\n  value,\n  change,\n  trend,\n  icon: Icon,\n  color,\n  percentage,\n  subtitle,\n  href,\n}: any) => {\n  const content = (\n    <div className=\"flex items-center justify-between\">\n      <div className=\"flex-1\">\n        <p className=\"text-sm font-medium text-gray-500 mb-2\">{title}</p>\n        <p className=\"text-3xl font-bold text-gray-900 group-hover:text-blue-600 transition-colors mb-1\">\n          {value}\n        </p>\n        {subtitle && <p className=\"text-xs text-gray-400 mb-2\">{subtitle}</p>}\n        <div className=\"flex items-center gap-2\">\n          <p\n            className={`text-sm font-medium ${\n              trend === \"up\"\n                ? \"text-green-500\"\n                : trend === \"down\"\n                  ? \"text-red-500\"\n                  : \"text-gray-500\"\n            } flex items-center`}\n          >\n            {trend === \"up\" && <ArrowUpRight className=\"inline h-4 w-4 mr-1\" />}\n            {trend === \"down\" && (\n              <ArrowDownRight className=\"inline h-4 w-4 mr-1\" />\n            )}\n            {change}\n          </p>\n          {percentage && <Progress value={percentage} className=\"w-20 h-2\" />}\n        </div>\n      </div>\n      <div className=\"w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300\">\n        <Icon className=\"h-8 w-8 text-blue-600\" />\n      </div>\n    </div>\n  );\n\n  return (\n    <Card className=\"group border-l-4 border-blue-500 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 cursor-pointer\">\n      <CardContent className=\"p-6\">\n        {href ? (\n          <Link href={href} className=\"block\">\n            {content}\n          </Link>\n        ) : (\n          content\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default function EnhancedDashboard() {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const {\n    canAccessPage,\n    isSuperAdmin,\n    isAdmin,\n    isManager,\n    isSupervisor,\n    isMarketer,\n    isStaff,\n    getRoleDisplayName,\n    canAccessSidebarItem, // Assuming this hook/function exists for checking sidebar item access\n  } = useRoleAccess();\n  const [currentTime, setCurrentTime] = useState(new Date());\n\n  // For Super Admin, always grant access to everything\n  const hasAccess = (resource: string) => {\n    if (isSuperAdmin()) return true;\n    return canAccessPage(resource);\n  };\n\n  const queryClient = useQueryClient();\n\n  // Fetch dashboard stats with proper authorization\n  const {\n    data: dashboardStats,\n    isLoading: isLoadingStats,\n    refetch: refetchStats,\n  } = useQuery({\n    queryKey: [\"/api/dashboard/stats\"],\n    queryFn: async () => {\n      try {\n        console.log(\"üîÑ Fetching dashboard stats...\");\n        const response = await fetch(\"/api/dashboard/stats\", {\n          credentials: \"include\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          console.log(\"‚úÖ Dashboard stats loaded successfully:\", data);\n          return data;\n        } else {\n          console.warn(\n            \"‚ö†Ô∏è Dashboard stats API failed:\",\n            response.status,\n            response.statusText,\n          );\n          throw new Error(`API returned ${response.status}`);\n        }\n      } catch (error) {\n        console.warn(\"‚ö†Ô∏è Using sample dashboard stats due to error:\", error);\n        // Enhanced sample data for demonstration\n        return {\n          totalRevenue: 245000 + Math.floor(Math.random() * 100000),\n          ordersToday: Math.floor(Math.random() * 30) + 45,\n          activeProducts: Math.floor(Math.random() * 75) + 150,\n          totalCustomers: Math.floor(Math.random() * 500) + 1200,\n          lowStockItems: Math.floor(Math.random() * 8) + 3,\n          pendingOrders: Math.floor(Math.random() * 20) + 8,\n          completedOrders: Math.floor(Math.random() * 60) + 35,\n          monthlyGrowth: 15.8,\n          isDemo: true,\n        };\n      }\n    },\n    refetchInterval: 30000,\n    retry: 2,\n  });\n\n  // Fetch recent orders\n  const { data: recentOrders, refetch: refetchOrders } = useQuery({\n    queryKey: [\"/api/dashboard/recent-orders\"],\n    queryFn: async () => {\n      try {\n        console.log(\"üîÑ Fetching recent orders...\");\n        const response = await fetch(\"/api/dashboard/recent-orders\", {\n          credentials: \"include\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          console.log(\n            \"‚úÖ Recent orders loaded successfully:\",\n            data.length,\n            \"orders\",\n          );\n          return data;\n        } else {\n          console.warn(\"‚ö†Ô∏è Recent orders API failed:\", response.status);\n          throw new Error(`API returned ${response.status}`);\n        }\n      } catch (error) {\n        console.warn(\"‚ö†Ô∏è Using sample recent orders due to error:\", error);\n        return [\n          {\n            id: 1,\n            customerName: \"John Doe\",\n            totalAmount: \"1250.00\",\n            status: \"completed\",\n            orderDate: new Date().toISOString(),\n          },\n          {\n            id: 2,\n            customerName: \"Jane Smith\",\n            totalAmount: \"850.00\",\n            status: \"in_progress\",\n            orderDate: new Date().toISOString(),\n          },\n          {\n            id: 3,\n            customerName: \"Bob Johnson\",\n            totalAmount: \"2100.00\",\n            status: \"pending\",\n            orderDate: new Date().toISOString(),\n          },\n          {\n            id: 4,\n            customerName: \"Alice Brown\",\n            totalAmount: \"750.00\",\n            status: \"completed\",\n            orderDate: new Date().toISOString(),\n          },\n          {\n            id: 5,\n            customerName: \"Charlie Wilson\",\n            totalAmount: \"1450.00\",\n            status: \"in_progress\",\n            orderDate: new Date().toISOString(),\n          },\n          {\n            id: 6,\n            customerName: \"David Miller\",\n            totalAmount: \"3200.00\",\n            status: \"completed\",\n            orderDate: new Date().toISOString(),\n          },\n          {\n            id: 7,\n            customerName: \"Sarah Davis\",\n            totalAmount: \"925.00\",\n            status: \"pending\",\n            orderDate: new Date().toISOString(),\n          },\n        ];\n      }\n    },\n    refetchInterval: 30000,\n    retry: 2,\n  });\n\n  // Fetch low stock items\n  const { data: lowStockItems } = useQuery({\n    queryKey: [\"/api/dashboard/low-stock\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/dashboard/low-stock\");\n        if (response.ok) {\n          const data = await response.json();\n          console.log(\"Low stock items loaded:\", data);\n          return data;\n        }\n        throw new Error(\"Failed to fetch low stock\");\n      } catch (error) {\n        console.log(\"Using sample low stock items due to error:\", error);\n        return [\n          {\n            id: 1,\n            name: \"Flour\",\n            currentStock: \"5\",\n            unit: \"kg\",\n            minLevel: \"10\",\n          },\n          {\n            id: 2,\n            name: \"Sugar\",\n            currentStock: \"8\",\n            unit: \"kg\",\n            minLevel: \"15\",\n          },\n          {\n            id: 3,\n            name: \"Butter\",\n            currentStock: \"2\",\n            unit: \"kg\",\n            minLevel: \"5\",\n          },\n          {\n            id: 4,\n            name: \"Vanilla Extract\",\n            currentStock: \"200\",\n            unit: \"ml\",\n            minLevel: \"500\",\n          },\n          {\n            id: 5,\n            name: \"Baking Powder\",\n            currentStock: \"100\",\n            unit: \"g\",\n            minLevel: \"250\",\n          },\n        ];\n      }\n    },\n  });\n\n  // Fetch upcoming production\n  const { data: upcomingProduction } = useQuery({\n    queryKey: [\"/api/dashboard/production-schedule\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/dashboard/production-schedule\");\n        if (response.ok) {\n          const data = await response.json();\n          console.log(\"Production schedule loaded:\", data);\n          return data;\n        }\n        throw new Error(\"Failed to fetch production\");\n      } catch (error) {\n        console.log(\"Using sample production schedule due to error:\", error);\n        return [\n          {\n            id: 1,\n            productName: \"Chocolate Cake\",\n            quantity: 20,\n            scheduledDate: new Date().toISOString(),\n            status: \"pending\",\n            priority: \"high\",\n          },\n          {\n            id: 2,\n            productName: \"Vanilla Cupcakes\",\n            quantity: 50,\n            scheduledDate: new Date().toISOString(),\n            status: \"in_progress\",\n            priority: \"medium\",\n          },\n          {\n            id: 3,\n            productName: \"Strawberry Tart\",\n            quantity: 15,\n            scheduledDate: new Date().toISOString(),\n            status: \"pending\",\n            priority: \"low\",\n          },\n          {\n            id: 4,\n            productName: \"Croissants\",\n            quantity: 30,\n            scheduledDate: new Date().toISOString(),\n            status: \"completed\",\n            priority: \"high\",\n          },\n          {\n            id: 5,\n            productName: \"Danish Pastry\",\n            quantity: 25,\n            scheduledDate: new Date().toISOString(),\n            status: \"pending\",\n            priority: \"medium\",\n          },\n        ];\n      }\n    },\n  });\n\n  // Fetch notifications\n  const { data: notifications } = useQuery({\n    queryKey: [\"/api/notifications\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/notifications\");\n        if (response.ok) {\n          const data = await response.json();\n          console.log(\"Notifications loaded:\", data);\n          return data;\n        }\n        throw new Error(\"Failed to fetch notifications\");\n      } catch (error) {\n        console.log(\"Using sample notifications due to error:\", error);\n        return [\n          {\n            id: 1,\n            title: \"Low Stock Alert\",\n            description: \"Flour is running low\",\n            type: \"inventory\",\n            priority: \"high\",\n            read: false,\n          },\n          {\n            id: 2,\n            title: \"New Order\",\n            description: \"Order #123 received\",\n            type: \"order\",\n            priority: \"medium\",\n            read: false,\n          },\n          {\n            id: 3,\n            title: \"Production Complete\",\n            description: \"Chocolate cake batch completed\",\n            type: \"production\",\n            priority: \"low\",\n            read: true,\n          },\n        ];\n      }\n    },\n    refetchInterval: 60000,\n  });\n\n  const { formatCurrencyWithCommas } = useCurrency();\n\n  const allQuickStats = [\n    {\n      title: \"Total Revenue\",\n      value: `Rs.${(dashboardStats?.totalRevenue || 0).toLocaleString()}`,\n      icon: TrendingUp,\n      trend: \"+12.5%\",\n      color: \"green\",\n      resource: \"sales\",\n    },\n    {\n      title: \"Orders Today\",\n      value: dashboardStats?.ordersToday || 0,\n      icon: ShoppingCart,\n      trend: \"+8.2%\",\n      color: \"blue\",\n      resource: \"orders\",\n    },\n    {\n      title: \"Active Products\",\n      value: dashboardStats?.activeProducts || 0,\n      icon: Package,\n      trend: \"+3.1%\",\n      color: \"purple\",\n      resource: \"products\",\n    },\n    {\n      title: \"Total Customers\",\n      value: dashboardStats?.totalCustomers || 0,\n      icon: Users,\n      trend: \"+15.3%\",\n      color: \"orange\",\n      resource: \"customers\",\n    },\n    {\n      title: \"Low Stock Items\",\n      value: dashboardStats?.lowStockItems || 0,\n      icon: AlertTriangle,\n      trend: \"-5\",\n      color: \"red\",\n      resource: \"inventory\",\n    },\n    {\n      title: \"Pending Orders\",\n      value: dashboardStats?.pendingOrders || 0,\n      icon: Clock,\n      trend: \"+2\",\n      color: \"yellow\",\n      resource: \"orders\",\n    },\n    {\n      title: \"Completed Today\",\n      value: dashboardStats?.completedOrders || 0,\n      icon: CheckCircle,\n      trend: \"+18\",\n      color: \"green\",\n      resource: \"orders\",\n    },\n    {\n      title: \"Monthly Growth\",\n      value: `${dashboardStats?.monthlyGrowth || 0}%`,\n      icon: BarChart3,\n      trend: \"+4.2%\",\n      color: \"gray\",\n      resource: \"reports\",\n    },\n  ];\n\n  // Filter stats based on user permissions\n  const quickStats = allQuickStats.filter((stat) =>\n    canAccessSidebarItem(stat.resource, \"read\"),\n  );\n\n  const quickActions = [\n    {\n      title: \"New Order\",\n      description: \"Create customer order\",\n      icon: Plus,\n      href: \"/orders\",\n      color: \"blue\",\n    },\n    {\n      title: \"Schedule Production\",\n      description: \"Plan production run\",\n      icon: Factory,\n      href: \"/production\",\n      color: \"green\",\n    },\n    {\n      title: \"Update Inventory\",\n      description: \"Manage stock levels\",\n      icon: Package,\n      href: \"/inventory\",\n      color: \"orange\",\n    },\n    {\n      title: \"View Reports\",\n      description: \"Business analytics\",\n      icon: BarChart3,\n      href: \"/reports\",\n      color: \"purple\",\n    },\n    {\n      title: \"Manage Users\",\n      description: \"User administration\",\n      icon: Shield,\n      href: \"/admin-users\",\n      color: \"red\",\n    },\n    {\n      title: \"System Settings\",\n      description: \"Configure system\",\n      icon: Settings,\n      href: \"/settings\",\n      color: \"gray\",\n    },\n  ];\n\n  const systemModules = [\n    {\n      name: \"Dashboard\",\n      status: \"active\",\n      users: 12,\n      icon: Activity,\n      href: \"/dashboard\",\n    },\n    {\n      name: \"Orders\",\n      status: \"active\",\n      users: 8,\n      icon: ShoppingCart,\n      href: \"/orders\",\n    },\n    {\n      name: \"Products\",\n      status: \"active\",\n      users: 5,\n      icon: Package,\n      href: \"/products\",\n    },\n    {\n      name: \"Inventory\",\n      status: \"active\",\n      users: 7,\n      icon: Package,\n      href: \"/inventory\",\n    },\n    {\n      name: \"Production\",\n      status: \"active\",\n      users: 4,\n      icon: Factory,\n      href: \"/production\",\n    },\n    {\n      name: \"Customers\",\n      status: \"active\",\n      users: 6,\n      icon: Users,\n      href: \"/customers\",\n    },\n    {\n      name: \"Reports\",\n      status: \"active\",\n      users: 3,\n      icon: BarChart3,\n      href: \"/reports\",\n    },\n    {\n      name: \"Settings\",\n      status: \"active\",\n      users: 2,\n      icon: Settings,\n      href: \"/settings\",\n    },\n  ];\n\n  console.log(\"Dashboard rendering with data:\", {\n    stats: dashboardStats,\n    orders: recentOrders?.length,\n    lowStock: lowStockItems?.length,\n    production: upcomingProduction?.length,\n    notifications: notifications?.length,\n    userRole: user?.role,\n    isSuperAdmin: isSuperAdmin(),\n  });\n\n  return (\n    <div className=\"space-y-6 p-6 bg-gray-50 min-h-screen\">\n      {/* Header Section */}\n      <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n        <div>\n          <div className=\"text-gray-600 mt-2 text-lg\">\n            Welcome back,{\" \"}\n            <span className=\"font-semibold\">\n              {user?.firstName || user?.email || \"User\"}\n            </span>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={async () => {\n              console.log(\"üîÑ Manually refreshing all dashboard data...\");\n              await Promise.all([\n                queryClient.invalidateQueries({\n                  queryKey: [\"/api/dashboard/stats\"],\n                }),\n                queryClient.invalidateQueries({\n                  queryKey: [\"/api/dashboard/recent-orders\"],\n                }),\n                queryClient.invalidateQueries({\n                  queryKey: [\"/api/dashboard/low-stock\"],\n                }),\n                queryClient.invalidateQueries({\n                  queryKey: [\"/api/dashboard/production-schedule\"],\n                }),\n                queryClient.invalidateQueries({\n                  queryKey: [\"/api/notifications\"],\n                }),\n              ]);\n\n              // Force immediate refetch\n              Promise.all([refetchStats(), refetchOrders()]).then(() => {\n                toast({\n                  title: \"Data Refreshed\",\n                  description: \"Dashboard data has been updated successfully\",\n                });\n              });\n            }}\n            className=\"shadow-sm\"\n          >\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            Refresh All Data\n          </Button>\n          {isSuperAdmin() && (\n            <Badge variant=\"destructive\" className=\"px-3 py-1\">\n              <Shield className=\"h-3 w-3 mr-1\" />\n              SUPER ADMIN\n            </Badge>\n          )}\n        </div>\n      </div>\n\n      {/* Loading State */}\n      {isLoadingStats && (\n        <div className=\"flex items-center justify-center py-8\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n          <span className=\"ml-2 text-gray-600\">Loading dashboard data...</span>\n        </div>\n      )}\n\n      {/* Data Status Indicators for SuperAdmin */}\n      {isSuperAdmin() && (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n          <Card className=\"border-dashed\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm font-medium\">Dashboard Stats</span>\n                <Badge\n                  variant={dashboardStats?.isDemo ? \"secondary\" : \"default\"}\n                >\n                  {dashboardStats?.isDemo ? \"Sample Data\" : \"Live Data\"}\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"border-dashed\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm font-medium\">Recent Orders</span>\n                <Badge variant=\"default\">\n                  {recentOrders?.length || 0} Items\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"border-dashed\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm font-medium\">Low Stock Items</span>\n                <Badge variant=\"default\">\n                  {lowStockItems?.length || 0} Items\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"border-dashed\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm font-medium\">Production Schedule</span>\n                <Badge variant=\"default\">\n                  {upcomingProduction?.length || 0} Items\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Quick Stats Overview */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        {quickStats.map((stat) => (\n          <QuickStatCard key={stat.title} {...stat} />\n        ))}\n      </div>\n\n      {/* Main Content Tabs */}\n      <Tabs defaultValue=\"overview\" className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-3 lg:w-auto lg:grid-cols-3 bg-white shadow-sm\">\n          <TabsTrigger value=\"overview\" className=\"flex items-center gap-2\">\n            <Eye className=\"h-4 w-4\" />\n            Overview\n          </TabsTrigger>\n          <TabsTrigger value=\"actions\" className=\"flex items-center gap-2\">\n            <Zap className=\"h-4 w-4\" />\n            Quick Actions\n          </TabsTrigger>\n          <TabsTrigger value=\"system\" className=\"flex items-center gap-2\">\n            <Settings className=\"h-4 w-4\" />\n            System\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Overview Tab */}\n        <TabsContent value=\"overview\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            {/* Recent Orders */}\n            <Card className=\"shadow-sm\">\n              <CardHeader className=\"flex flex-row items-center justify-between\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <ShoppingBag className=\"h-5 w-5\" />\n                    Recent Orders\n                  </CardTitle>\n                  <CardDescription>\n                    Latest customer orders ({recentOrders?.length || 0})\n                  </CardDescription>\n                </div>\n                <Button variant=\"outline\" size=\"sm\" asChild>\n                  <Link href=\"/orders\">\n                    <Eye className=\"h-4 w-4 mr-2\" />\n                    View All\n                  </Link>\n                </Button>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {recentOrders?.slice(0, 5).map((order: any) => (\n                    <div\n                      key={order.id}\n                      className=\"flex items-center justify-between p-4 rounded-lg border bg-white hover:shadow-sm transition-shadow\"\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center\">\n                          <ShoppingCart className=\"h-5 w-5 text-blue-600\" />\n                        </div>\n                        <div>\n                          <p className=\"font-medium text-sm\">\n                            {order.customerName}\n                          </p>\n                          <p className=\"text-xs text-gray-500\">\n                            Order #{order.id}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"font-bold text-sm text-green-600\">\n                          ‚Çπ{parseFloat(order.totalAmount || \"0\").toFixed(2)}\n                        </p>\n                        <OrderStatusBadge status={order.status} />\n                      </div>\n                    </div>\n                  ))}\n                  {(!recentOrders || recentOrders.length === 0) && (\n                    <div className=\"text-center py-8 text-gray-500\">\n                      <ShoppingCart className=\"h-12 w-12 mx-auto mb-4 text-gray-400\" />\n                      <p className=\"text-sm\">No recent orders</p>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Today's Production */}\n            <Card className=\"shadow-sm\">\n              <CardHeader className=\"flex flex-row items-center justify-between\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Factory className=\"h-5 w-5\" />\n                    Today's Production\n                  </CardTitle>\n                  <CardDescription>\n                    Scheduled production items (\n                    {upcomingProduction?.length || 0})\n                  </CardDescription>\n                </div>\n                <Button variant=\"outline\" size=\"sm\" asChild>\n                  <Link href=\"/production\">\n                    <Eye className=\"h-4 w-4 mr-2\" />\n                    View All\n                  </Link>\n                </Button>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {upcomingProduction\n                    ?.slice(0, 5)\n                    .map((item: ProductionItem) => (\n                      <div\n                        key={item.id}\n                        className=\"flex items-center justify-between p-4 rounded-lg border bg-white hover:shadow-sm transition-shadow\"\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div\n                            className={`w-10 h-10 rounded-full flex items-center justify-center ${\n                              item.priority === \"high\"\n                                ? \"bg-red-100\"\n                                : item.priority === \"medium\"\n                                  ? \"bg-yellow-100\"\n                                  : \"bg-green-100\"\n                            }`}\n                          >\n                            <Factory\n                              className={`h-5 w-5 ${\n                                item.priority === \"high\"\n                                  ? \"text-red-600\"\n                                  : item.priority === \"medium\"\n                                    ? \"text-yellow-600\"\n                                    : \"text-green-600\"\n                              }`}\n                            />\n                          </div>\n                          <div>\n                            <p className=\"font-medium text-sm\">\n                              {item.productName}\n                            </p>\n                            <p className=\"text-xs text-gray-500\">\n                              Qty: {item.quantity}\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"text-right\">\n                          <OrderStatusBadge status={item.status} />\n                          <p className=\"text-xs text-gray-500 mt-1\">\n                            {format(new Date(item.scheduledDate), \"HH:mm\")}\n                          </p>\n                        </div>\n                      </div>\n                    ))}\n                  {(!upcomingProduction || upcomingProduction.length === 0) && (\n                    <div className=\"text-center py-8 text-gray-500\">\n                      <Factory className=\"h-12 w-12 mx-auto mb-4 text-gray-400\" />\n                      <p className=\"text-sm\">No scheduled production</p>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Low Stock Alert */}\n            <Card className=\"shadow-sm\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-red-600\">\n                  <AlertTriangle className=\"h-5 w-5\" />\n                  Low Stock Alert\n                </CardTitle>\n                <CardDescription>\n                  Items requiring attention ({lowStockItems?.length || 0})\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {lowStockItems?.slice(0, 5).map((item: any) => (\n                    <div\n                      key={item.id}\n                      className=\"flex items-center justify-between p-3 rounded-lg border border-red-200 bg-red-50\"\n                    >\n                      <div>\n                        <p className=\"font-medium text-sm\">{item.name}</p>\n                        <p className=\"text-xs text-gray-500\">\n                          Current: {item.currentStock} {item.unit}\n                        </p>\n                      </div>\n                      <Badge variant=\"destructive\" className=\"text-xs\">\n                        Low\n                      </Badge>\n                    </div>\n                  ))}\n                  {(!lowStockItems || lowStockItems.length === 0) && (\n                    <div className=\"text-center py-8 text-gray-500\">\n                      <CheckCircle className=\"h-12 w-12 mx-auto mb-4 text-green-500\" />\n                      <p className=\"text-sm\">All items in stock</p>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Quick Actions Tab */}\n        <TabsContent value=\"actions\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {quickActions.map((action) => (\n              <Card\n                key={action.title}\n                className=\"hover:shadow-lg transition-shadow cursor-pointer\"\n              >\n                <CardContent className=\"p-6\">\n                  <Link href={action.href} className=\"block\">\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center\">\n                        <action.icon className=\"h-6 w-6 text-gray-600\" />\n                      </div>\n                      <div>\n                        <h3 className=\"font-semibold\">{action.title}</h3>\n                        <p className=\"text-sm text-gray-500\">\n                          {action.description}\n                        </p>\n                      </div>\n                    </div>\n                  </Link>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n\n        {/* System Tab */}\n        <TabsContent value=\"system\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            {/* System Modules */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Activity className=\"h-5 w-5\" />\n                  System Modules\n                </CardTitle>\n                <CardDescription>Available system modules</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {systemModules.map((module) => (\n                    <div\n                      key={module.name}\n                      className=\"flex items-center justify-between p-3 rounded-lg border\"\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <module.icon className=\"h-5 w-5 text-blue-600\" />\n                        <div>\n                          <p className=\"font-medium text-sm\">{module.name}</p>\n                          <p className=\"text-xs text-gray-500\">\n                            {module.users} active users\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"outline\" className=\"text-green-600\">\n                          {module.status}\n                        </Badge>\n                        <Button variant=\"ghost\" size=\"sm\" asChild>\n                          <Link href={module.href}>\n                            <Eye className=\"h-4 w-4\" />\n                          </Link>\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Role Information */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Users className=\"h-5 w-5\" />\n                  Role Information\n                </CardTitle>\n                <CardDescription>Your current permissions</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600\">Current Role:</span>\n                    <Badge variant=\"outline\" className=\"font-semibold\">\n                      {getRoleDisplayName()}\n                    </Badge>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600\">Access Level:</span>\n                    <span className=\"text-sm font-medium\">\n                      {isSuperAdmin()\n                        ? \"Full System Access\"\n                        : isAdmin()\n                          ? \"Administrative Access\"\n                          : isManager()\n                            ? \"Management Access\"\n                            : isSupervisor()\n                              ? \"Supervisor Access\"\n                              : \"Limited Access\"}\n                    </span>\n                  </div>\n                  <Separator />\n                  <div className=\"space-y-2\">\n                    <p className=\"text-xs font-medium text-gray-700\">\n                      Available Modules:\n                    </p>\n                    <div className=\"flex flex-wrap gap-1\">\n                      {systemModules.map((module) => (\n                        <Badge\n                          key={module.name}\n                          variant=\"secondary\"\n                          className=\"text-xs\"\n                        >\n                          {module.name}\n                        </Badge>\n                      ))}\n                    </div>\n                  </div>\n                  {isSuperAdmin() && (\n                    <div className=\"text-xs text-green-700 p-3 bg-green-50 rounded-lg border border-green-200\">\n                      ‚úÖ Super Admin: Full access to all dashboard features and\n                      data.\n                    </div>\n                  )}\n                  <div className=\"text-xs text-blue-600 p-3 bg-blue-50 rounded-lg border border-blue-200\">\n                    üìä Dashboard data is loading from API endpoints with sample\n                    fallbacks.\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":36340,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"shared/modules.ts":{"content":"\n// System modules for role-based access control\nexport interface SystemModule {\n  id: string;\n  name: string;\n  description: string;\n  category: string;\n  routes: string[];\n  resources: string[];\n}\n\nexport const SYSTEM_MODULES: SystemModule[] = [\n  {\n    id: \"dashboard\",\n    name: \"Dashboard\",\n    description: \"Main dashboard and overview\",\n    category: \"core\",\n    routes: [\"/\", \"/dashboard\"],\n    resources: [\"dashboard\"]\n  },\n  {\n    id: \"sales_management\",\n    name: \"Sales Management\",\n    description: \"Sales, orders, and customer transactions\",\n    category: \"finance\",\n    routes: [\"/sales\", \"/orders\", \"/day-book\", \"/transactions\"],\n    resources: [\"sales\", \"orders\"]\n  },\n  {\n    id: \"inventory_management\",\n    name: \"Inventory Management\",\n    description: \"Stock, products, and inventory control\",\n    category: \"inventory\",\n    routes: [\"/inventory\", \"/stock\", \"/products\", \"/ingredients\"],\n    resources: [\"inventory\", \"products\"]\n  },\n  {\n    id: \"purchase_management\",\n    name: \"Purchase Management\",\n    description: \"Purchases and supplier management\",\n    category: \"finance\",\n    routes: [\"/purchases\", \"/purchase-returns\"],\n    resources: [\"purchases\"]\n  },\n  {\n    id: \"customer_management\",\n    name: \"Customer Management\",\n    description: \"Customer and party management\",\n    category: \"crm\",\n    routes: [\"/customers\", \"/parties\"],\n    resources: [\"customers\", \"parties\"]\n  },\n  {\n    id: \"production_management\",\n    name: \"Production Management\",\n    description: \"Production scheduling and manufacturing\",\n    category: \"operations\",\n    routes: [\"/production\", \"/recipes\", \"/label-printing\"],\n    resources: [\"production\"]\n  },\n  {\n    id: \"hr_management\",\n    name: \"HR & Payroll\",\n    description: \"Staff, attendance, and payroll management\",\n    category: \"hr\",\n    routes: [\"/staff\", \"/attendance\", \"/salary\", \"/leave-requests\", \"/staff-schedules\"],\n    resources: [\"staff\", \"attendance\", \"salary\", \"leave_requests\"]\n  },\n  {\n    id: \"financial_management\",\n    name: \"Financial Management\",\n    description: \"Expenses, assets, and financial tracking\",\n    category: \"finance\",\n    routes: [\"/expenses\", \"/assets\", \"/sales-returns\"],\n    resources: [\"expenses\", \"assets\", \"sales_returns\"]\n  },\n  {\n    id: \"reports_analytics\",\n    name: \"Reports & Analytics\",\n    description: \"Business reports and analytics\",\n    category: \"analytics\",\n    routes: [\"/reports\", \"/billing\"],\n    resources: [\"reports\", \"billing\"]\n  },\n  {\n    id: \"user_management\",\n    name: \"User Management\",\n    description: \"User accounts and permissions\",\n    category: \"administration\",\n    routes: [\"/admin/users\", \"/admin/roles\"],\n    resources: [\"users\", \"roles\"]\n  },\n  {\n    id: \"audit_management\",\n    name: \"Audit & Security\",\n    description: \"Audit logs and security monitoring\",\n    category: \"administration\",\n    routes: [\"/admin/login-logs\", \"/admin/audit-logs\"],\n    resources: [\"audit\", \"security\"]\n  },\n  {\n    id: \"system_configuration\",\n    name: \"System Configuration\",\n    description: \"System settings and configuration\",\n    category: \"administration\",\n    routes: [\"/settings\", \"/units\"],\n    resources: [\"settings\", \"system\"]\n  },\n  {\n    id: \"branch_management\",\n    name: \"Branch Management\",\n    description: \"Multi-branch operations\",\n    category: \"administration\",\n    routes: [\"/branches\"],\n    resources: [\"branches\"]\n  }\n];\n\n// Helper functions to find modules by route or resource\nexport function getRouteModule(route: string): SystemModule | undefined {\n  return SYSTEM_MODULES.find(module => \n    module.routes.some(moduleRoute => \n      route === moduleRoute || route.startsWith(moduleRoute + \"/\")\n    )\n  );\n}\n\nexport function getResourceModule(resource: string): SystemModule | undefined {\n  return SYSTEM_MODULES.find(module => \n    module.resources.includes(resource)\n  );\n}\n\nexport function getModulesByCategory(category: string): SystemModule[] {\n  return SYSTEM_MODULES.filter(module => module.category === category);\n}\n\nexport function getAllModuleIds(): string[] {\n  return SYSTEM_MODULES.map(module => module.id);\n}\n","path":null,"size_bytes":4077,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/pages/sales.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport SearchBar from \"@/components/search-bar\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n  usePagination,\n} from \"@/components/ui/pagination\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Plus,\n  Edit,\n  Trash2,\n  ShoppingCart,\n  Eye,\n  FileText,\n  ExternalLink,\n  ShoppingBag,\n  Printer,\n  Receipt,\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface Sale {\n  id: number;\n  customerName: string;\n  customerId?: number;\n  totalAmount: string;\n  paymentMethod: string;\n  status: string;\n  saleDate?: string;\n  notes?: string;\n  createdAt: string;\n  items?: SaleItem[];\n}\n\ninterface SaleItem {\n  id: number;\n  productId: number;\n  productName: string;\n  quantity: string;\n  unitPrice: string;\n  totalPrice: string;\n  unitId?: string;\n}\n\ninterface Customer {\n  id: number;\n  name: string;\n  type: string;\n  currentBalance: string;\n}\n\ninterface Product {\n  id: number;\n  name: string;\n  price: string;\n  unit: string;\n}\n\nexport default function Sales() {\n  const { toast } = useToast();\n  const { formatCurrency, formatCurrencyWithCommas } = useCurrency();\n  const queryClient = useQueryClient();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [isDetailDialogOpen, setIsDetailDialogOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [customerFilter, setCustomerFilter] = useState(\"all\");\n  const [dateFrom, setDateFrom] = useState(\"\");\n  const [dateTo, setDateTo] = useState(\"\");\n  const [selectedSale, setSelectedSale] = useState<Sale | null>(null);\n  const [editingSale, setEditingSale] = useState<Sale | null>(null);\n\n  const { data: sales = [], isLoading } = useQuery({\n    queryKey: [\"/api/sales\"],\n  });\n\n  const { data: products = [], isLoading: productsLoading } = useQuery({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: customers = [] } = useQuery({\n    queryKey: [\"/api/customers\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/customers\");\n      console.log(\"Customers API response:\", response);\n      // Handle different response formats\n      if (Array.isArray(response)) return response;\n      if (response?.data && Array.isArray(response.data)) return response.data;\n      if (response?.customers && Array.isArray(response.customers)) return response.customers;\n      return [];\n    },\n  });\n\n  const { data: units = [], isLoading: unitsLoading } = useQuery({\n    queryKey: [\"/api/units\"],\n  });\n\n  const [saleForm, setSaleForm] = useState({\n    customerId: \"\",\n    customerName: \"\",\n    paymentMethod: \"cash\",\n    saleDate: new Date().toISOString().split(\"T\")[0],\n    status: \"completed\",\n    notes: \"\",\n    tax: 0,\n    items: [{ productId: \"\", quantity: 1, unitPrice: \"0\", unitId: \"\" }],\n  });\n\n  // Create Sale Mutation\n  const createSaleMutation = useMutation({\n    mutationFn: async (saleData: any) => {\n      return apiRequest(\"POST\", \"/api/sales\", saleData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sales\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n      toast({\n        title: \"Success\",\n        description: \"Sale recorded successfully\",\n      });\n      handleCloseDialog();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to record sale\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update Sale Mutation\n  const updateSaleMutation = useMutation({\n    mutationFn: async (data: { id: number; saleData: any }) => {\n      return apiRequest(\"PUT\", `/api/sales/${data.id}`, data.saleData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sales\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      toast({\n        title: \"Success\",\n        description: \"Sale updated successfully\",\n      });\n      setIsEditDialogOpen(false);\n      setEditingSale(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update sale\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete Sale Mutation\n  const deleteSaleMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"DELETE\", `/api/sales/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/sales\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      toast({\n        title: \"Success\",\n        description: \"Sale deleted successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete sale\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Validate form\n    if (!saleForm.customerName.trim()) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Customer name is required.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (\n      saleForm.items.length === 0 ||\n      !saleForm.items.some((item) => item.productId)\n    ) {\n      toast({\n        title: \"Validation Error\",\n        description: \"At least one item is required.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const validItems = saleForm.items.filter(\n      (item) =>\n        item.productId && parseFloat(item.unitPrice) > 0 && item.quantity > 0,\n    );\n\n    if (validItems.length === 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please add valid items with prices and quantities.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const totalAmount = validItems.reduce((sum, item) => {\n      const itemTotal = parseFloat(item.unitPrice) * item.quantity;\n      return sum + itemTotal;\n    }, 0);\n\n    const saleData = {\n      customerId: saleForm.customerId ? parseInt(saleForm.customerId) : null,\n      customerName: saleForm.customerName.trim(),\n      totalAmount: totalAmount.toString(),\n      paymentMethod: saleForm.paymentMethod,\n      status: saleForm.status,\n      saleDate: saleForm.saleDate,\n      notes: saleForm.notes || null,\n      items: validItems.map((item) => ({\n        productId: parseInt(item.productId),\n        quantity: parseFloat(item.quantity.toString()),\n        unitPrice: parseFloat(item.unitPrice),\n        unitId: item.unitId ? parseInt(item.unitId) : null,\n        totalPrice: (\n          parseFloat(item.unitPrice) * parseFloat(item.quantity.toString())\n        ).toString(),\n      })),\n    };\n\n    createSaleMutation.mutate(saleData);\n  };\n\n  const handleEdit = (sale: Sale) => {\n    setEditingSale(sale);\n    setSaleForm({\n      customerId: sale.customerId?.toString() || \"\",\n      customerName: sale.customerName,\n      paymentMethod: sale.paymentMethod,\n      saleDate: sale.saleDate\n        ? new Date(sale.saleDate).toISOString().split(\"T\")[0]\n        : new Date(sale.createdAt).toISOString().split(\"T\")[0],\n      status: sale.status,\n      notes: sale.notes || \"\",\n      tax: 0,\n      items:\n        sale.items && sale.items.length > 0\n          ? sale.items.map((item) => ({\n              productId: item.productId.toString(),\n              quantity: parseFloat(item.quantity),\n              unitPrice: parseFloat(item.unitPrice),\n              unitId: item.unitId ? item.unitId.toString() : \"\",\n            }))\n          : [{ productId: \"\", quantity: 1, unitPrice: \"0\", unitId: \"\" }],\n    });\n    setIsEditDialogOpen(true);\n  };\n\n  const handleEditSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!editingSale) return;\n\n    const totalAmount = saleForm.items.reduce((sum, item) => {\n      const itemTotal = parseFloat(item.unitPrice) * item.quantity;\n      return sum + itemTotal;\n    }, 0);\n\n    const saleData = {\n      customerId: saleForm.customerId ? parseInt(saleForm.customerId) : null,\n      customerName: saleForm.customerName,\n      totalAmount: totalAmount.toString(),\n      paymentMethod: saleForm.paymentMethod,\n      status: saleForm.status,\n      saleDate: saleForm.saleDate,\n      notes: saleForm.notes || null,\n    };\n\n    updateSaleMutation.mutate({\n      id: editingSale.id,\n      saleData,\n    });\n  };\n\n  const handleDelete = (id: number) => {\n    if (\n      confirm(\n        \"Are you sure you want to delete this sale? This action cannot be undone.\",\n      )\n    ) {\n      deleteSaleMutation.mutate(id);\n    }\n  };\n\n  const handleViewDetails = (sale: Sale) => {\n    setSelectedSale(sale);\n    setIsDetailDialogOpen(true);\n  };\n\n  const handleCloseDialog = () => {\n    setIsDialogOpen(false);\n    setSaleForm({\n      customerId: \"\",\n      customerName: \"\",\n      paymentMethod: \"cash\",\n      saleDate: new Date().toISOString().split(\"T\")[0],\n      status: \"completed\",\n      notes: \"\",\n      tax: 0,\n      items: [{ productId: \"\", quantity: 1, unitPrice: \"0\", unitId: \"\" }],\n    });\n  };\n\n  const addItem = () => {\n    setSaleForm({\n      ...saleForm,\n      items: [\n        ...saleForm.items,\n        { productId: \"\", quantity: 1, unitPrice: \"0\", unitId: \"\" },\n      ],\n    });\n  };\n\n  const removeItem = (index: number) => {\n    setSaleForm({\n      ...saleForm,\n      items: saleForm.items.filter((_, i) => i !== index),\n    });\n  };\n\n  const updateItem = (index: number, field: string, value: any) => {\n    const updatedItems = saleForm.items.map((item, i) => {\n      if (i === index) {\n        if (field === \"productId\") {\n          const product = products.find((p: any) => p.id === parseInt(value));\n          return {\n            ...item,\n            productId: value,\n            unitPrice: product?.price || \"0\",\n          };\n        } else if (field === \"quantity\") {\n          return { ...item, [field]: parseInt(value) || 1 };\n        } else if (field === \"unitPrice\") {\n          return { ...item, [field]: parseFloat(value) || 0 };\n        } else {\n          return { ...item, [field]: value };\n        }\n      }\n      return item;\n    });\n    setSaleForm({ ...saleForm, items: updatedItems });\n  };\n\n  // Calculate Sub Total\n  const calculateSubTotal = () => {\n    return saleForm.items.reduce(\n      (sum, item) =>\n        sum + parseFloat(item.quantity) * parseFloat(item.unitPrice),\n      0,\n    );\n  };\n\n  // Calculate Total (Sub Total + Tax)\n  const calculateTotal = () => {\n    return calculateSubTotal() + (saleForm.tax || 0);\n  };\n\n  // Filter and search logic\n  const filteredSales = useMemo(() => {\n    return sales.filter((sale: Sale) => {\n      const customerName = sale.customerName?.toLowerCase() || \"\";\n      const searchLower = searchTerm.toLowerCase();\n\n      const matchesSearch =\n        customerName.includes(searchLower) ||\n        sale.totalAmount.includes(searchLower);\n\n      const matchesStatus =\n        statusFilter === \"all\" || sale.status === statusFilter;\n\n      const matchesCustomer =\n        customerFilter === \"all\" || sale.customerName === customerFilter;\n\n      const saleDate = new Date(sale.saleDate || sale.createdAt);\n      const matchesDateFrom = !dateFrom || saleDate >= new Date(dateFrom);\n      const matchesDateTo =\n        !dateTo || saleDate <= new Date(dateTo + \"T23:59:59\");\n\n      return (\n        matchesSearch &&\n        matchesStatus &&\n        matchesCustomer &&\n        matchesDateFrom &&\n        matchesDateTo\n      );\n    });\n  }, [sales, searchTerm, statusFilter, customerFilter, dateFrom, dateTo]);\n\n  // Sorting\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredSales,\n    \"saleDate\",\n  );\n\n  // Pagination\n  const {\n    currentItems,\n    currentPage,\n    totalPages,\n    pageSize,\n    setPageSize,\n    goToPage,\n    totalItems,\n  } = usePagination(sortedData, 10);\n\n  // Get unique customers for filter\n  const uniqueCustomers = useMemo(() => {\n    const customers = [...new Set(sales.map((s: Sale) => s.customerName))];\n    return customers.filter(Boolean);\n  }, [sales]);\n\n  // Summary calculations\n  const totalSales = filteredSales.reduce(\n    (sum: number, sale: Sale) => sum + parseFloat(sale.totalAmount),\n    0,\n  );\n\n  const statusCounts = useMemo(() => {\n    return filteredSales.reduce((acc: any, sale: Sale) => {\n      acc[sale.status] = (acc[sale.status] || 0) + 1;\n      return acc;\n    }, {});\n  }, [filteredSales]);\n\n  const getStatusBadge = (status: string) => {\n    const variants: {\n      [key: string]: \"default\" | \"secondary\" | \"destructive\" | \"outline\";\n    } = {\n      completed: \"default\",\n      pending: \"secondary\",\n      cancelled: \"destructive\",\n      partial: \"outline\",\n    };\n    return (\n      <Badge variant={variants[status] || \"outline\"}>\n        {status?.charAt(0).toUpperCase() + status?.slice(1)}\n      </Badge>\n    );\n  };\n\n  const viewCustomerLedger = (customerId: number) => {\n    if (customerId) {\n      window.open(`/customers?viewLedger=${customerId}`, \"_blank\");\n    }\n  };\n\n  const printInvoice = (sale: Sale) => {\n    const printWindow = window.open(\"\", \"_blank\");\n    if (!printWindow) return;\n    const invoiceHTML = `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Sales Invoice - ${sale.id}</title>\n          <style>\n            body {\n              font-family: Arial, sans-serif;\n              margin: 0;\n              padding: 20px;\n              color: #333;\n            }\n            .header {\n              text-align: center;\n              margin-bottom: 30px;\n              border-bottom: 2px solid #333;\n              padding-bottom: 20px;\n            }\n            .company-name {\n              font-size: 28px;\n              font-weight: bold;\n              color: #2563eb;\n              margin-bottom: 5px;\n            }\n            .company-tagline {\n              font-size: 14px;\n              color: #666;\n            }\n            .invoice-title {\n              font-size: 24px;\n              font-weight: bold;\n              margin: 20px 0;\n            }\n            .invoice-details {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 30px;\n            }\n            .invoice-info, .customer-info {\n              flex: 1;\n            }\n            .invoice-info h3, .customer-info h3 {\n              font-size: 16px;\n              margin-bottom: 10px;\n              color: #2563eb;\n            }\n            .invoice-info p, .customer-info p {\n              margin: 5px 0;\n              font-size: 14px;\n            }\n            .items-table {\n              width: 100%;\n              border-collapse: collapse;\n              margin: 20px 0;\n            }\n            .items-table th, .items-table td {\n              border: 1px solid #ddd;\n              padding: 12px;\n              text-align: left;\n            }\n            .items-table th {\n              background-color: #f8f9fa;\n              font-weight: bold;\n              color: #333;\n            }\n            .items-table tr:nth-child(even) {\n              background-color: #f9f9f9;\n            }\n            .total-section {\n              text-align: right;\n              margin-top: 20px;\n            }\n            .total-row {\n              display: flex;\n              justify-content: flex-end;\n              margin: 5px 0;\n            }\n            .total-label {\n              width: 150px;\n              font-weight: bold;\n            }\n            .total-amount {\n              width: 100px;\n              text-align: right;\n            }\n            .grand-total {\n              border-top: 2px solid #333;\n              padding-top: 10px;\n              font-size: 18px;\n              font-weight: bold;\n              color: #2563eb;\n            }\n            .footer {\n              margin-top: 40px;\n              text-align: center;\n              font-size: 12px;\n              color: #666;\n              border-top: 1px solid #ddd;\n              padding-top: 20px;\n            }\n            @media print {\n              body { margin: 0; }\n              .no-print { display: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"header\">\n            <div class=\"company-name\">Bake Sewa</div>\n            <div class=\"company-tagline\">Delicious Moments, Sweet Memories</div>\n            <div class=\"invoice-title\">SALES INVOICE</div>\n          </div>\n          <div class=\"invoice-details\">\n            <div class=\"invoice-info\">\n              <h3>Invoice Information</h3>\n              <p><strong>Invoice #:</strong> INV-${sale.id}</p>\n              <p><strong>Date:</strong> ${format(new Date(sale.createdAt), \"dd/MM/yyyy\")}</p>\n              <p><strong>Time:</strong> ${format(new Date(sale.createdAt), \"HH:mm:ss\")}</p>\n              <p><strong>Payment Method:</strong> ${sale.paymentMethod?.toUpperCase() || \"N/A\"}</p>\n              <p><strong>Status:</strong> ${sale.status?.toUpperCase() || \"COMPLETED\"}</p>\n            </div>\n            <div class=\"customer-info\">\n              <h3>Customer Information</h3>\n              <p><strong>Name:</strong> ${sale.customerName}</p>\n              <p><strong>Invoice Date:</strong> ${format(new Date(sale.createdAt), \"MMMM dd, yyyy\")}</p>\n            </div>\n          </div>\n          <table class=\"items-table\">\n            <thead>\n              <tr>\n                <th>Item</th>\n                <th>Quantity</th>\n                <th>Unit Price</th>\n                <th>Total Price</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${\n                (sale.items || [])\n                  .map(\n                    (item) => `\n                <tr>\n                  <td>${item.productName || \"N/A\"}</td>\n                  <td>${item.quantity}</td>\n                  <td>${formatCurrency(parseFloat(item.unitPrice) || 0)}</td>\n                  <td>${formatCurrency(parseFloat(item.totalPrice) || 0)}</td>\n                </tr>\n              `,\n                  )\n                  .join(\"\") || '<tr><td colspan=\"4\">No items found</td></tr>'\n              }\n            </tbody>\n          </table>\n          <div class=\"total-section\">\n            <div class=\"total-row grand-total\">\n              <div class=\"total-label\">Grand Total:</div>\n              <div class=\"total-amount\">${formatCurrency(parseFloat(sale.totalAmount) || 0)}</div>\n            </div>\n          </div>\n          <div class=\"footer\">\n            <p>Thank you for your business!</p>\n            <p>Bake Sewa - Where every bite is a delight</p>\n          </div>\n        </body>\n      </html>\n    `;\n    printWindow.document.write(invoiceHTML);\n    printWindow.document.close();\n    printWindow.focus();\n    printWindow.print();\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto\"></div>\n          <p className=\"text-muted-foreground mt-2\">Loading sales...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-gray-600\">\n            Record and track all sales transactions with detailed history\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <div className=\"flex gap-2\">\n            <DialogTrigger asChild>\n              <Button onClick={handleCloseDialog}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Record Sale\n              </Button>\n            </DialogTrigger>\n            <Button\n              variant=\"outline\"\n              onClick={() => (window.location.href = \"/sales-returns\")}\n            >\n              Sales Returns\n            </Button>\n          </div>\n          <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Record New Sale</DialogTitle>\n              <DialogDescription>\n                Enter the sale transaction details\n              </DialogDescription>\n            </DialogHeader>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"customer\">Customer</Label>\n                  <Select\n                    value={saleForm.customerId || undefined}\n                    onValueChange={(value) => {\n                      const customer = customers.find(\n                        (c: any) => c.id === parseInt(value),\n                      );\n                      setSaleForm({\n                        ...saleForm,\n                        customerId: value,\n                        customerName: customer?.name || \"\",\n                      });\n                    }}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select customer\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {Array.isArray(customers) &&\n                        customers.map((customer: any) => (\n                          <SelectItem\n                            key={customer.id}\n                            value={customer.id.toString()}\n                          >\n                            {customer.name}\n                          </SelectItem>\n                        ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"customerName\">Customer Name</Label>\n                  <Input\n                    id=\"customerName\"\n                    value={saleForm.customerName}\n                    onChange={(e) =>\n                      setSaleForm({\n                        ...saleForm,\n                        customerName: e.target.value,\n                      })\n                    }\n                    placeholder=\"Enter customer name\"\n                    required\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"saleDate\">Sale Date</Label>\n                  <Input\n                    id=\"saleDate\"\n                    type=\"date\"\n                    value={saleForm.saleDate}\n                    onChange={(e) =>\n                      setSaleForm({\n                        ...saleForm,\n                        saleDate: e.target.value,\n                      })\n                    }\n                    required\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"paymentMethod\">Payment Method</Label>\n                  <Select\n                    value={saleForm.paymentMethod || undefined}\n                    onValueChange={(value) =>\n                      setSaleForm({ ...saleForm, paymentMethod: value })\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"cash\">Cash</SelectItem>\n                      <SelectItem value=\"card\">Card</SelectItem>\n                      <SelectItem value=\"upi\">UPI</SelectItem>\n                      <SelectItem value=\"bank_transfer\">\n                        Bank Transfer\n                      </SelectItem>\n                      <SelectItem value=\"credit\">Credit</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"status\">Status</Label>\n                  <Select\n                    value={saleForm.status || undefined}\n                    onValueChange={(value) =>\n                      setSaleForm({ ...saleForm, status: value })\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"completed\">Completed</SelectItem>\n                      <SelectItem value=\"pending\">Pending</SelectItem>\n                      <SelectItem value=\"partial\">Partial</SelectItem>\n                      <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"notes\">Notes</Label>\n                <Input\n                  id=\"notes\"\n                  value={saleForm.notes}\n                  onChange={(e) =>\n                    setSaleForm({\n                      ...saleForm,\n                      notes: e.target.value,\n                    })\n                  }\n                  placeholder=\"Additional notes\"\n                />\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <Label className=\"font-medium\">Sale Items</Label>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"bg-green-100 text-green-800 hover:bg-green-200\"\n                    onClick={addItem}\n                  >\n                    + Add Item\n                  </Button>\n                </div>\n\n                {/* Table Header Row */}\n                <div className=\"grid grid-cols-12 gap-2 pb-2 border-b font-medium text-sm\">\n                  <div className=\"col-span-1 text-center\">S.No.</div>\n                  <div className=\"col-span-3\">Particular *</div>\n                  <div className=\"col-span-1\">Qty *</div>\n                  <div className=\"col-span-2\">Unit *</div>\n                  <div className=\"col-span-2\">Rate *</div>\n                  <div className=\"col-span-2\">Amount *</div>\n                  <div className=\"col-span-1\">Action</div>\n                </div>\n\n                {/* Data Rows */}\n                {saleForm.items.map((item, index) => (\n                  <div\n                    key={index}\n                    className=\"grid grid-cols-12 gap-2 bg-white hover:bg-gray-50\"\n                  >\n                    {/* S.No. */}\n                    <div className=\"col-span-1 flex items-center justify-center\">\n                      {index + 1}\n                    </div>\n\n                    {/* Particular */}\n                    <div className=\"col-span-3\">\n                      <Select\n                        value={item.productId || undefined}\n                        onValueChange={(value) => {\n                          const product = products.find((p: any) => p.id.toString() === value);\n                          const updatedItems = saleForm.items.map((itm, i) => {\n                            if (i === index) {\n                              return {\n                                ...itm,\n                                productId: value,\n                                unitId: product?.unitId?.toString() || \"\",\n                                unitPrice: product?.price ? parseFloat(product.price.toString()).toString() : \"0\",\n                              };\n                            }\n                            return itm;\n                          });\n                          setSaleForm({ ...saleForm, items: updatedItems });\n                          calculateTotal();\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select product\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {products && Array.isArray(products) ? (\n                            products.map((product: any) => (\n                              <SelectItem\n                                key={product.id}\n                                value={product.id.toString()}\n                              >\n                                {product.name}\n                              </SelectItem>\n                            ))\n                          ) : (\n                            <SelectItem value=\"no-products\" disabled>\n                              No products available\n                            </SelectItem>\n                          )}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    {/* Quantity */}\n                    <div className=\"col-span-1\">\n                      <Input\n                        type=\"number\"\n                        value={item.quantity}\n                        onChange={(e) =>\n                          updateItem(\n                            index,\n                            \"quantity\",\n                            parseInt(e.target.value) || 0,\n                          )\n                        }\n                        min=\"1\"\n                        placeholder=\"Qty\"\n                      />\n                    </div>\n\n                    {/* Unit */}\n                    <div className=\"col-span-2\">\n                      <Select\n                        value={item.unitId || undefined}\n                        onValueChange={(value) =>\n                          updateItem(index, \"unitId\", value)\n                        }\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Unit\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {unitsLoading ? (\n                            <SelectItem value=\"loading\" disabled>\n                              Loading units...\n                            </SelectItem>\n                          ) : units && Array.isArray(units) ? (\n                            units\n                              .filter((unit: any) => unit.isActive)\n                              .map((unit: any) => (\n                                <SelectItem\n                                  key={unit.id}\n                                  value={unit.id.toString()}\n                                >\n                                  {unit.name} ({unit.abbreviation})\n                                </SelectItem>\n                              ))\n                          ) : (\n                            <SelectItem value=\"no-units\" disabled>\n                              No units available\n                            </SelectItem>\n                          )}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    {/* Rate */}\n                    <div className=\"col-span-2\">\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        value={item.unitPrice}\n                        onChange={(e) =>\n                          updateItem(\n                            index,\n                            \"unitPrice\",\n                            parseFloat(e.target.value) || 0,\n                          )\n                        }\n                        min=\"0\"\n                        placeholder=\"Rate per unit\"\n                      />\n                    </div>\n\n                    {/* Amount (Calculated as Quantity √ó Rate) */}\n                    <div className=\"col-span-2\">\n                      <Input\n                        value={(\n                          parseFloat(item.quantity) * parseFloat(item.unitPrice)\n                        ).toFixed(2)}\n                        readOnly\n                        className=\"bg-gray-100\"\n                        placeholder=\"0.00\"\n                      />\n                    </div>\n\n                    {/* Action */}\n                    <div className=\"col-span-1 flex items-center justify-center\">\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => removeItem(index)}\n                        disabled={saleForm.items.length === 1}\n                        className=\"text-red-500 hover:text-red-700\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n\n                {/* Summary Section */}\n                <div className=\"mt-6 p-4 border-t border-gray-200 bg-white rounded-lg\">\n                  <div className=\"grid grid-cols-12 gap-4\">\n                    <div className=\"col-span-8\"></div>\n                    <div className=\"col-span-2 text-right font-medium\">\n                      Sub Total:\n                    </div>\n                    <div className=\"col-span-2\">\n                      <Input\n                        value={calculateSubTotal().toFixed(2)}\n                        readOnly\n                        className=\"bg-gray-100 font-medium\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-12 gap-4 mt-2\">\n                    <div className=\"col-span-8\"></div>\n                    <div className=\"col-span-2 text-right font-medium\">\n                      Tax:\n                    </div>\n                    <div className=\"col-span-2\">\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        value={saleForm.tax || 0}\n                        onChange={(e) =>\n                          setSaleForm({\n                            ...saleForm,\n                            tax: parseFloat(e.target.value) || 0,\n                          })\n                        }\n                        placeholder=\"0.00\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-12 gap-4 mt-2\">\n                    <div className=\"col-span-8\"></div>\n                    <div className=\"col-span-2 text-right font-bold\">\n                      Total:\n                    </div>\n                    <div className=\"col-span-2\">\n                      <Input\n                        value={calculateTotal().toFixed(2)}\n                        readOnly\n                        className=\"bg-gray-100 font-bold\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex justify-end gap-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={handleCloseDialog}\n                >\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={createSaleMutation.isPending}>\n                  {createSaleMutation.isPending\n                    ? \"Recording...\"\n                    : \"Record Sale\"}\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Sales</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrencyWithCommas(totalSales)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              {filteredSales.length} transactions\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Completed</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {statusCounts.completed || 0}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Successfully processed\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-yellow-600\">\n              {statusCounts.pending || 0}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Awaiting completion</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">\n              Unique Customers\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{uniqueCustomers.length}</div>\n            <p className=\"text-xs text-muted-foreground\">Active customers</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters and Search */}\n      <Card>\n        <CardContent className=\"pt-6 pb-4 space-y-4\">\n          <div className=\"flex flex-col lg:flex-row gap-4\">\n            <div className=\"flex-1\">\n              <SearchBar\n                value={searchTerm}\n                onChange={setSearchTerm}\n                placeholder=\"Search by customer, or amount...\"\n                className=\"w-full\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div>\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"All statuses\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All statuses</SelectItem>\n                    <SelectItem value=\"completed\">Completed</SelectItem>\n                    <SelectItem value=\"pending\">Pending</SelectItem>\n                    <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                    <SelectItem value=\"partial\">Partial</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Select\n                  value={customerFilter}\n                  onValueChange={setCustomerFilter}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"All customers\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All customers</SelectItem>\n                    {uniqueCustomers.map((customer) => (\n                      <SelectItem key={customer} value={customer}>\n                        {customer}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Input\n                  id=\"date-from\"\n                  type=\"date\"\n                  value={dateFrom}\n                  onChange={(e) => setDateFrom(e.target.value)}\n                />\n              </div>\n              <div>\n                <Input\n                  id=\"date-to\"\n                  type=\"date\"\n                  value={dateTo}\n                  onChange={(e) => setDateTo(e.target.value)}\n                />\n              </div>\n            </div>\n          </div>\n          {(searchTerm ||\n            statusFilter !== \"all\" ||\n            customerFilter !== \"all\" ||\n            dateFrom ||\n            dateTo) && (\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => {\n                  setSearchTerm(\"\");\n                  setStatusFilter(\"all\");\n                  setCustomerFilter(\"all\");\n                  setDateFrom(\"\");\n                  setDateTo(\"\");\n                }}\n              >\n                Clear Filters\n              </Button>\n              <span className=\"text-sm text-muted-foreground self-center\">\n                Showing {filteredSales.length} of {sales.length} sales\n              </span>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Sales History Table */}\n      <Card>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <SortableTableHeader\n                    label=\"Date\"\n                    sortKey=\"saleDate\"\n                    sortConfig={sortConfig}\n                    onSort={requestSort}\n                  >\n                    Date\n                  </SortableTableHeader>\n                  <SortableTableHeader\n                    label=\"Customer Name\"\n                    sortKey=\"customerName\"\n                    sortConfig={sortConfig}\n                    onSort={requestSort}\n                  >\n                    Customer Name\n                  </SortableTableHeader>\n                  <SortableTableHeader\n                    label=\"Total Amount\"\n                    sortKey=\"totalAmount\"\n                    sortConfig={sortConfig}\n                    onSort={requestSort}\n                  >\n                    Total Amount\n                  </SortableTableHeader>\n                  <SortableTableHeader>Payment Method</SortableTableHeader>\n                  <SortableTableHeader\n                    label=\"Status\"\n                    sortKey=\"status\"\n                    sortConfig={sortConfig}\n                    onSort={requestSort}\n                  >\n                    Status\n                  </SortableTableHeader>\n                  <SortableTableHeader>Actions</SortableTableHeader>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {currentItems.length > 0 ? (\n                  currentItems.map((sale) => (\n                    <TableRow key={sale.id}>\n                      <TableCell>\n                        {format(\n                          new Date(sale.saleDate || sale.createdAt),\n                          \"MMM dd, yyyy\",\n                        )}\n                      </TableCell>\n                      <TableCell className=\"font-medium\">\n                        {sale.customerName}\n                        {sale.customerId && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"ml-2 h-6 px-2\"\n                            onClick={() => viewCustomerLedger(sale.customerId!)}\n                            title=\"View Customer Ledger\"\n                          >\n                            <ExternalLink className=\"h-3 w-3\" />\n                          </Button>\n                        )}\n                      </TableCell>\n                      \n                      <TableCell className=\"font-medium\">\n                        {formatCurrencyWithCommas(\n                          parseFloat(sale.totalAmount || \"0\"),\n                        )}\n                      </TableCell>\n                      <TableCell className=\"capitalize\">\n                        {sale.paymentMethod?.replace(\"_\", \" \") || \"N/A\"}\n                      </TableCell>\n                      <TableCell>{getStatusBadge(sale.status)}</TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleViewDetails(sale)}\n                            title=\"View Details\"\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => printInvoice(sale)}\n                            title=\"Print Invoice\"\n                            className=\"text-green-600 hover:text-green-800\"\n                          >\n                            <Printer className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(sale)}\n                            title=\"Edit Sale\"\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleDelete(sale.id)}\n                            title=\"Delete Sale\"\n                            className=\"text-red-600 hover:text-red-800\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))\n                ) : (\n                  <TableRow>\n                    <TableCell colSpan={7} className=\"text-center py-8\">\n                      <div className=\"flex flex-col items-center text-muted-foreground\">\n                        <ShoppingBag className=\"h-12 w-12 mb-4 opacity-50\" />\n                        <h3 className=\"text-lg font-semibold mb-2\">\n                          No Sales Record Found\n                        </h3>\n                        <p className=\"text-sm mb-4\">\n                          {searchTerm || statusFilter !== \"all\"\n                            ? \"Try adjusting your search or filter criteria.\"\n                            : \"Start by adding a new sale entry.\"}\n                        </p>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                )}\n              </TableBody>\n            </Table>\n          </div>\n\n          {/* Pagination */}\n          <div className=\"flex flex-col sm:flex-row justify-between items-center gap-4 mt-4\">\n            <PaginationInfo\n              currentPage={currentPage}\n              totalPages={totalPages}\n              totalItems={totalItems}\n            />\n            <div className=\"flex items-center gap-4\">\n              <PageSizeSelector\n                pageSize={pageSize}\n                onPageSizeChange={setPageSize}\n              />\n              <Pagination\n                currentPage={currentPage}\n                totalPages={totalPages}\n                onPageChange={goToPage}\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Sale Details Dialog */}\n      <Dialog open={isDetailDialogOpen} onOpenChange={setIsDetailDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Sale Details</DialogTitle>\n            <DialogDescription>\n              Complete information for sale #{selectedSale?.id}\n            </DialogDescription>\n          </DialogHeader>\n\n          {selectedSale && (\n            <div className=\"space-y-6\">\n              {/* Sale Information */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label className=\"text-sm font-medium\">Customer</Label>\n                  <p className=\"text-sm\">{selectedSale.customerName}</p>\n                </div>\n                <div>\n                  <Label className=\"text-sm font-medium\">Sale Date</Label>\n                  <p className=\"text-sm\">\n                    {format(\n                      new Date(selectedSale.saleDate || selectedSale.createdAt),\n                      \"PPP\",\n                    )}\n                  </p>\n                </div>\n                <div>\n                  <Label className=\"text-sm font-medium\">Payment Method</Label>\n                  <p className=\"text-sm capitalize\">\n                    {selectedSale.paymentMethod?.replace(\"_\", \" \")}\n                  </p>\n                </div>\n                <div>\n                  <Label className=\"text-sm font-medium\">Status</Label>\n                  <div className=\"mt-1\">\n                    {getStatusBadge(selectedSale.status)}\n                  </div>\n                </div>\n                <div>\n                  <Label className=\"text-sm font-medium\">Total Amount</Label>\n                  <p className=\"text-lg font-semibold\">\n                    {formatCurrencyWithCommas(\n                      parseFloat(selectedSale.totalAmount),\n                    )}\n                  </p>\n                </div>\n              </div>\n\n              {/* Sale Items */}\n              {selectedSale.items && selectedSale.items.length > 0 && (\n                <div>\n                  <Label className=\"text-sm font-medium\">Items Sold</Label>\n                  <div className=\"mt-2 border rounded-lg\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Item</TableHead>\n                          <TableHead>Quantity</TableHead>\n                          <TableHead>Unit</TableHead>\n                          <TableHead>Unit Price</TableHead>\n                          <TableHead>Total</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {selectedSale.items.map((item) => (\n                          <TableRow key={item.id}>\n                            <TableCell>{item.productName}</TableCell>\n                            <TableCell>{item.quantity}</TableCell>\n                            <TableCell>{item.unitId || \"N/A\"}</TableCell>\n                            <TableCell>\n                              {formatCurrency(parseFloat(item.unitPrice))}\n                            </TableCell>\n                            <TableCell className=\"font-medium\">\n                              {formatCurrency(parseFloat(item.totalPrice))}\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                </div>\n              )}\n\n              {/* Notes */}\n              {selectedSale.notes && (\n                <div>\n                  <Label className=\"text-sm font-medium\">Notes</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {selectedSale.notes}\n                  </p>\n                </div>\n              )}\n\n              {/* Customer Ledger Link */}\n              {selectedSale.customerId && (\n                <div className=\"border-t pt-4\">\n                  <Button\n                    onClick={() => viewCustomerLedger(selectedSale.customerId!)}\n                    className=\"w-full\"\n                  >\n                    <FileText className=\"h-4 w-4 mr-2\" />\n                    View Customer Ledger & Transaction History\n                  </Button>\n                </div>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Sale Dialog */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Edit Sale</DialogTitle>\n            <DialogDescription>Update sale information</DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleEditSubmit} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"edit-customer\">Customer</Label>\n                <Select\n                  value={saleForm.customerId || undefined}\n                  onValueChange={(value) => {\n                    const customer = customers.find(\n                      (c: any) => c.id === parseInt(value),\n                    );\n                    setSaleForm({\n                      ...saleForm,\n                      customerId: value,\n                      customerName: customer?.name || \"\",\n                    });\n                  }}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select customer\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {Array.isArray(customers) &&\n                      customers.map((customer: any) => (\n                        <SelectItem\n                          key={customer.id}\n                          value={customer.id.toString()}\n                        >\n                          {customer.name}\n                        </SelectItem>\n                      ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"edit-customerName\">Customer Name</Label>\n                <Input\n                  id=\"edit-customerName\"\n                  value={saleForm.customerName}\n                  onChange={(e) =>\n                    setSaleForm({\n                      ...saleForm,\n                      customerName: e.target.value,\n                    })\n                  }\n                  placeholder=\"Enter customer name\"\n                  required\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div>\n                <Label htmlFor=\"edit-saleDate\">Sale Date</Label>\n                <Input\n                  id=\"edit-saleDate\"\n                  type=\"date\"\n                  value={saleForm.saleDate}\n                  onChange={(e) =>\n                    setSaleForm({\n                      ...saleForm,\n                      saleDate: e.target.value,\n                    })\n                  }\n                  required\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"edit-paymentMethod\">Payment Method</Label>\n                <Select\n                  value={saleForm.paymentMethod || undefined}\n                  onValueChange={(value) =>\n                    setSaleForm({ ...saleForm, paymentMethod: value })\n                  }\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"cash\">Cash</SelectItem>\n                    <SelectItem value=\"card\">Card</SelectItem>\n                    <SelectItem value=\"upi\">UPI</SelectItem>\n                    <SelectItem value=\"bank_transfer\">Bank Transfer</SelectItem>\n                    <SelectItem value=\"credit\">Credit</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"edit-status\">Status</Label>\n                <Select\n                  value={saleForm.status || undefined}\n                  onValueChange={(value) =>\n                    setSaleForm({ ...saleForm, status: value })\n                  }\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"completed\">Completed</SelectItem>\n                    <SelectItem value=\"pending\">Pending</SelectItem>\n                    <SelectItem value=\"partial\">Partial</SelectItem>\n                    <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div>\n              <Label htmlFor=\"edit-notes\">Notes</Label>\n              <Input\n                id=\"edit-notes\"\n                value={saleForm.notes}\n                onChange={(e) =>\n                  setSaleForm({\n                    ...saleForm,\n                    notes: e.target.value,\n                  })\n                }\n                placeholder=\"Additional notes\"\n              />\n            </div>\n\n            <div className=\"flex justify-end gap-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => {\n                  setIsEditDialogOpen(false);\n                  setEditingSale(null);\n                }}\n              >\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={updateSaleMutation.isPending}>\n                {updateSaleMutation.isPending ? \"Updating...\" : \"Update Sale\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":57917,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/unit-selector.tsx":{"content":"import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { FormControl } from \"@/components/ui/form\";\nimport { useUnits, useUnitsByType } from \"@/hooks/useUnits\";\n\nexport interface UnitSelectorProps {\n  value?: string;\n  onValueChange: (value: string) => void;\n  placeholder?: string;\n  filterByType?: string; // weight, volume, count\n  required?: boolean;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport function UnitSelector({\n  value,\n  onValueChange,\n  placeholder = \"Select unit\",\n  filterByType,\n  required = false,\n  disabled = false,\n  className\n}: UnitSelectorProps) {\n  const { data: allUnits = [], isLoading, error } = useUnits();\n  const { data: filteredUnits = [] } = useUnitsByType(filterByType || \"\");\n\n  // Ensure allUnits is always an array and safely filter\n  const safeAllUnits = Array.isArray(allUnits) ? allUnits : [];\n  const safeFilteredUnits = Array.isArray(filteredUnits) ? filteredUnits : [];\n\n  // Use filtered units if filterByType is provided, otherwise use all units\n  const unitsToShow = filterByType \n    ? safeFilteredUnits \n    : safeAllUnits.filter((unit: any) => unit && unit.isActive !== false);\n\n  console.log(\"UnitSelector - Units to show:\", unitsToShow);\n  console.log(\"UnitSelector - Loading:\", isLoading);\n  console.log(\"UnitSelector - Error:\", error);\n\n  const handleValueChange = (selectedValue: string) => {\n    try {\n      if (selectedValue && selectedValue !== \"loading\" && selectedValue !== \"error\" && selectedValue !== \"none\") {\n        onValueChange(selectedValue);\n      }\n    } catch (error) {\n      console.error('Error in UnitSelector onValueChange:', error);\n    }\n  };\n\n  return (\n    <Select\n      value={value || \"\"}\n      onValueChange={handleValueChange}\n      disabled={disabled || isLoading}\n      required={required}\n    >\n      <FormControl>\n        <SelectTrigger className={className}>\n          <SelectValue placeholder={isLoading ? \"Loading units...\" : placeholder} />\n        </SelectTrigger>\n      </FormControl>\n      <SelectContent>\n        {isLoading ? (\n          <SelectItem value=\"loading\" disabled>\n            Loading units...\n          </SelectItem>\n        ) : error ? (\n          <SelectItem value=\"error\" disabled>\n            Error loading units\n          </SelectItem>\n        ) : !unitsToShow || unitsToShow.length === 0 ? (\n          <SelectItem value=\"none\" disabled>\n            {filterByType ? `No ${filterByType} units available` : \"No units available\"}\n          </SelectItem>\n        ) : (\n          unitsToShow.map((unit: any) => {\n            // Ensure unit has required properties\n            if (!unit || !unit.id || !unit.name) {\n              return null;\n            }\n            return (\n              <SelectItem key={`unit-${unit.id}`} value={unit.id.toString()}>\n                {unit.name} ({unit.abbreviation || 'N/A'})\n              </SelectItem>\n            );\n          }).filter(Boolean)\n        )}\n      </SelectContent>\n    </Select>\n  );\n}\n\nexport function UnitDisplay({ \n  unitId, \n  units, \n  showAbbreviation = true,\n  fallbackText = \"No unit\"\n}: {\n  unitId?: number | string;\n  units?: any[];\n  showAbbreviation?: boolean;\n  fallbackText?: string;\n}) {\n  const { data: allUnits = [] } = useUnits();\n  const unitsToUse = units || allUnits;\n  \n  if (!unitId) {\n    return <span className=\"text-gray-400\">{fallbackText}</span>;\n  }\n  \n  const unit = unitsToUse.find((u: any) => u.id.toString() === unitId.toString());\n  \n  if (!unit) {\n    return <span className=\"text-gray-400\">Unknown unit (ID: {unitId})</span>;\n  }\n  \n  return (\n    <span className=\"text-gray-600\">\n      {showAbbreviation ? (unit.abbreviation || unit.name) : unit.name}\n    </span>\n  );\n}\n\nexport function UnitBadge({ \n  unitId, \n  units,\n  className = \"\"\n}: {\n  unitId?: number | string;\n  units?: any[];\n  className?: string;\n}) {\n  const { data: allUnits = [] } = useUnits();\n  const unitsToUse = units || allUnits;\n  \n  if (!unitId) return null;\n  \n  const unit = unitsToUse.find((u: any) => u.id.toString() === unitId.toString());\n  \n  if (!unit) return null;\n  \n  return (\n    <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 ${className}`}>\n      {unit.abbreviation}\n    </span>\n  );\n}","path":null,"size_bytes":4301,"size_tokens":null},"tailwind.config.js":{"content":"\nimport type { Config } from \"tailwindcss\";\n\nexport default {\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":2605,"size_tokens":null},"server/init-units.ts":{"content":"import { db } from \"./db\";\nimport { units } from \"@shared/schema\";\n\nasync function initializeUnits() {\n  const defaultUnits = [\n    { name: \"Kilograms\", abbreviation: \"kg\", type: \"weight\", isActive: true },\n    { name: \"Grams\", abbreviation: \"g\", type: \"weight\", isActive: true },\n    { name: \"Pounds\", abbreviation: \"lbs\", type: \"weight\", isActive: true },\n    { name: \"Liters\", abbreviation: \"L\", type: \"volume\", isActive: true },\n    { name: \"Milliliters\", abbreviation: \"ml\", type: \"volume\", isActive: true },\n    { name: \"Cups\", abbreviation: \"cups\", type: \"volume\", isActive: true },\n    {\n      name: \"Tablespoons\",\n      abbreviation: \"tbsp\",\n      type: \"volume\",\n      isActive: true,\n    },\n    { name: \"Teaspoons\", abbreviation: \"tsp\", type: \"volume\", isActive: true },\n    { name: \"Pieces\", abbreviation: \"pcs\", type: \"count\", isActive: true },\n    { name: \"Packets\", abbreviation: \"pkt\", type: \"count\", isActive: true },\n    { name: \"Boxes\", abbreviation: \"box\", type: \"count\", isActive: true },\n    { name: \"Bags\", abbreviation: \"bag\", type: \"count\", isActive: true },\n  ];\n\n  try {\n    console.log(\"üîç Checking for existing units...\");\n    // Check if units already exist\n    const existingUnits = await db.select().from(units);\n    console.log(`üìä Found ${existingUnits.length} existing units`);\n\n    if (existingUnits.length > 0) {\n      console.log(\"‚úÖ Units already initialized, skipping\");\n      return;\n    }\n\n    console.log(\"üìù Inserting default units...\");\n    // Insert default units\n    const insertedUnits = await db\n      .insert(units)\n      .values(defaultUnits)\n      .returning();\n    \n    console.log(`‚úÖ Successfully inserted ${insertedUnits.length} units:`, insertedUnits.map(u => u.name));\n  } catch (error) {\n    console.error(\"‚ùå Error initializing units:\", error);\n    throw error;\n  }\n}\n\n// Run if this file is executed directly (ESM-safe check)\nif (import.meta.url === process.argv[1]) {\n  initializeUnits()\n    .then(() => process.exit(0))\n    .catch((error) => {\n      console.error(error);\n      process.exit(1);\n    });\n}\n\nexport { initializeUnits };\n","path":null,"size_bytes":2106,"size_tokens":null},"client/src/pages/LoginLogs.tsx":{"content":"\nimport { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Shield,\n  Calendar,\n  Download,\n  Filter,\n  Search,\n  Eye,\n  Activity,\n  Users,\n  AlertTriangle,\n  CheckCircle,\n  Loader2,\n} from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { format } from \"date-fns\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useRoleAccess } from \"@/hooks/useRoleAccess\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\nexport default function AuditLogs() {\n  const { canAccessSidebarItem } = useRoleAccess();\n  const [page, setPage] = useState(1);\n  const [limit] = useState(50);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [actionFilter, setActionFilter] = useState(\"all\");\n  const [resourceFilter, setResourceFilter] = useState(\"all\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [selectedLog, setSelectedLog] = useState<any>(null);\n  const [dateFilter, setDateFilter] = useState({\n    startDate: \"\",\n    endDate: \"\",\n  });\n\n  // Check permissions\n  if (!canAccessSidebarItem(\"audit\", \"read\")) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <Alert>\n          <AlertTriangle className=\"h-4 w-4\" />\n          <AlertDescription>\n            You don't have permission to access audit logs.\n          </AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  const { data, isLoading, error } = useQuery({\n    queryKey: [\n      \"/api/audit-logs\",\n      page,\n      limit,\n      searchTerm,\n      actionFilter,\n      resourceFilter,\n      statusFilter,\n      dateFilter.startDate,\n      dateFilter.endDate,\n    ],\n    queryFn: async () => {\n      const params = new URLSearchParams({\n        page: page.toString(),\n        limit: limit.toString(),\n        ...(searchTerm && { search: searchTerm }),\n        ...(actionFilter !== \"all\" && { action: actionFilter }),\n        ...(resourceFilter !== \"all\" && { resource: resourceFilter }),\n        ...(statusFilter !== \"all\" && { status: statusFilter }),\n        ...(dateFilter.startDate && { startDate: dateFilter.startDate }),\n        ...(dateFilter.endDate && { endDate: dateFilter.endDate }),\n      });\n      return apiRequest(\"GET\", `/api/audit-logs?${params.toString()}`);\n    },\n  });\n\n  const { data: analytics, isLoading: analyticsLoading } = useQuery({\n    queryKey: [\"/api/audit-logs/analytics\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/audit-logs/analytics\"),\n  });\n\n  const { data: loginAnalytics, isLoading: loginAnalyticsLoading } = useQuery({\n    queryKey: [\"/api/login-logs/analytics\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/login-logs/analytics\"),\n  });\n\n  const auditLogs = data?.auditLogs || data?.data || [];\n  const pagination = data?.pagination || {};\n\n  const getActionBadge = (action: string) => {\n    const colors = {\n      CREATE: \"bg-green-100 text-green-800 border-green-200\",\n      UPDATE: \"bg-blue-100 text-blue-800 border-blue-200\",\n      DELETE: \"bg-red-100 text-red-800 border-red-200\",\n      READ: \"bg-gray-100 text-gray-800 border-gray-200\",\n      LOGIN: \"bg-purple-100 text-purple-800 border-purple-200\",\n      LOGOUT: \"bg-orange-100 text-orange-800 border-orange-200\",\n      EXPORT: \"bg-yellow-100 text-yellow-800 border-yellow-200\",\n      IMPORT: \"bg-indigo-100 text-indigo-800 border-indigo-200\",\n      VIEW: \"bg-teal-100 text-teal-800 border-teal-200\",\n    };\n\n    const actionClass =\n      colors[action as keyof typeof colors] ||\n      \"bg-gray-100 text-gray-800 border-gray-200\";\n\n    return (\n      <Badge className={`${actionClass} font-medium border`}>{action}</Badge>\n    );\n  };\n\n  const getStatusBadge = (status: string) => {\n    const isSuccess = status === \"success\" || status === \"SUCCESS\";\n    return (\n      <Badge\n        variant={isSuccess ? \"default\" : \"destructive\"}\n        className={`flex items-center gap-1 ${isSuccess ? \"bg-green-100 text-green-800 border-green-200\" : \"bg-red-100 text-red-800 border-red-200\"}`}\n      >\n        {isSuccess ? (\n          <CheckCircle className=\"h-3 w-3\" />\n        ) : (\n          <AlertTriangle className=\"h-3 w-3\" />\n        )}\n        {isSuccess ? \"Success\" : \"Failed\"}\n      </Badge>\n    );\n  };\n\n  const getResourceIcon = (resource: string) => {\n    const icons: { [key: string]: string } = {\n      staff: \"üë•\",\n      product: \"üì¶\",\n      customer: \"üë§\",\n      order: \"üõí\",\n      inventory: \"üìä\",\n      settings: \"‚öôÔ∏è\",\n      users: \"üîê\",\n      reports: \"üìã\",\n      production: \"üè≠\",\n      expenses: \"üí∞\",\n      sales: \"üí≥\",\n      purchases: \"üõçÔ∏è\",\n      assets: \"üè¢\",\n      parties: \"ü§ù\",\n      attendance: \"üìÖ\",\n      salary: \"üíµ\",\n      leave_requests: \"üèñÔ∏è\",\n      audit: \"üìã\",\n      auth: \"üîê\",\n      admin: \"üë®‚Äçüíº\",\n    };\n    return icons[resource] || \"üìÑ\";\n  };\n\n  const filteredLogs = auditLogs.filter(\n    (log: any) =>\n      searchTerm === \"\" ||\n      log.userEmail?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      log.userName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      log.resource?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      log.action?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      (log.resourceId &&\n        log.resourceId.toLowerCase().includes(searchTerm.toLowerCase())),\n  );\n\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredLogs,\n    \"timestamp\",\n  );\n\n  const exportLogs = async () => {\n    try {\n      const response = await apiRequest(\"GET\", \"/api/audit-logs/export\");\n      const blob = new Blob([JSON.stringify(response, null, 2)], {\n        type: \"application/json\",\n      });\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.style.display = \"none\";\n      a.href = url;\n      a.download = `audit-logs-${format(new Date(), \"yyyy-MM-dd\")}.json`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n    } catch (error) {\n      console.error(\"Failed to export logs:\", error);\n    }\n  };\n\n  if (error) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <Alert>\n          <AlertTriangle className=\"h-4 w-4\" />\n          <AlertDescription>\n            Failed to load audit logs. Please try again later.\n          </AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold flex items-center gap-2\">\n            <Shield className=\"h-6 w-6\" />\n            Audit Logs\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Complete activity trail for security monitoring and compliance\n          </p>\n        </div>\n        <Button variant=\"outline\" onClick={exportLogs}>\n          <Download className=\"h-4 w-4 mr-2\" />\n          Export Logs\n        </Button>\n      </div>\n\n      {/* Analytics Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {analyticsLoading ? (\n          Array.from({ length: 4 }).map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-4\">\n                <Skeleton className=\"h-20 w-full\" />\n              </CardContent>\n            </Card>\n          ))\n        ) : analytics ? (\n          <>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <div className=\"text-2xl font-bold text-blue-600\">\n                      {analytics.totalActions || 0}\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Total Activities\n                    </p>\n                  </div>\n                  <Activity className=\"h-8 w-8 text-blue-500\" />\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <div className=\"text-2xl font-bold text-green-600\">\n                      {Object.keys(analytics.actionsByUser || {}).length}\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Active Users\n                    </p>\n                  </div>\n                  <Users className=\"h-8 w-8 text-green-500\" />\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <div className=\"text-2xl font-bold text-purple-600\">\n                      {analytics.actionsByType?.CREATE || 0}\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Items Created\n                    </p>\n                  </div>\n                  <CheckCircle className=\"h-8 w-8 text-purple-500\" />\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <div className=\"text-2xl font-bold text-orange-600\">\n                      {analytics.actionsByType?.UPDATE || 0}\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Items Modified\n                    </p>\n                  </div>\n                  <Shield className=\"h-8 w-8 text-orange-500\" />\n                </div>\n              </CardContent>\n            </Card>\n          </>\n        ) : null}\n      </div>\n\n      {/* Login Analytics */}\n      {!loginAnalyticsLoading && loginAnalytics && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Shield className=\"h-5 w-5\" />\n              Authentication Summary (Last 30 Days)\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div className=\"text-center p-4 bg-green-50 rounded-lg\">\n                <div className=\"text-2xl font-bold text-green-600\">\n                  {loginAnalytics.successCount?.[0]?.count || 0}\n                </div>\n                <p className=\"text-sm text-green-700\">Successful Logins</p>\n              </div>\n              <div className=\"text-center p-4 bg-red-50 rounded-lg\">\n                <div className=\"text-2xl font-bold text-red-600\">\n                  {loginAnalytics.failureCount?.[0]?.count || 0}\n                </div>\n                <p className=\"text-sm text-red-700\">Failed Attempts</p>\n              </div>\n              <div className=\"text-center p-4 bg-blue-50 rounded-lg\">\n                <div className=\"text-2xl font-bold text-blue-600\">\n                  {loginAnalytics.topLocations?.length || 0}\n                </div>\n                <p className=\"text-sm text-blue-700\">Login Locations</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4\">\n            <div className=\"lg:col-span-2\">\n              <Label htmlFor=\"search\">Search</Label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"search\"\n                  placeholder=\"Search users, actions, resources...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n            <div>\n              <Label htmlFor=\"action\">Action</Label>\n              <Select value={actionFilter} onValueChange={setActionFilter}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Actions</SelectItem>\n                  <SelectItem value=\"CREATE\">Create</SelectItem>\n                  <SelectItem value=\"UPDATE\">Update</SelectItem>\n                  <SelectItem value=\"DELETE\">Delete</SelectItem>\n                  <SelectItem value=\"READ\">Read</SelectItem>\n                  <SelectItem value=\"LOGIN\">Login</SelectItem>\n                  <SelectItem value=\"LOGOUT\">Logout</SelectItem>\n                  <SelectItem value=\"EXPORT\">Export</SelectItem>\n                  <SelectItem value=\"IMPORT\">Import</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"resource\">Resource</Label>\n              <Select value={resourceFilter} onValueChange={setResourceFilter}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Resources</SelectItem>\n                  <SelectItem value=\"staff\">Staff</SelectItem>\n                  <SelectItem value=\"product\">Products</SelectItem>\n                  <SelectItem value=\"customer\">Customers</SelectItem>\n                  <SelectItem value=\"order\">Orders</SelectItem>\n                  <SelectItem value=\"inventory\">Inventory</SelectItem>\n                  <SelectItem value=\"settings\">Settings</SelectItem>\n                  <SelectItem value=\"users\">Users</SelectItem>\n                  <SelectItem value=\"reports\">Reports</SelectItem>\n                  <SelectItem value=\"production\">Production</SelectItem>\n                  <SelectItem value=\"expenses\">Expenses</SelectItem>\n                  <SelectItem value=\"sales\">Sales</SelectItem>\n                  <SelectItem value=\"purchases\">Purchases</SelectItem>\n                  <SelectItem value=\"assets\">Assets</SelectItem>\n                  <SelectItem value=\"parties\">Parties</SelectItem>\n                  <SelectItem value=\"attendance\">Attendance</SelectItem>\n                  <SelectItem value=\"salary\">Salary</SelectItem>\n                  <SelectItem value=\"leave_requests\">Leave Requests</SelectItem>\n                  <SelectItem value=\"auth\">Authentication</SelectItem>\n                  <SelectItem value=\"admin\">Administration</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"status\">Status</Label>\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Status</SelectItem>\n                  <SelectItem value=\"success\">Success</SelectItem>\n                  <SelectItem value=\"failed\">Failed</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"dateRange\">Date Range</Label>\n              <div className=\"flex gap-2\">\n                <Input\n                  type=\"date\"\n                  value={dateFilter.startDate}\n                  onChange={(e) =>\n                    setDateFilter((prev) => ({\n                      ...prev,\n                      startDate: e.target.value,\n                    }))\n                  }\n                  className=\"text-xs\"\n                />\n                <Input\n                  type=\"date\"\n                  value={dateFilter.endDate}\n                  onChange={(e) =>\n                    setDateFilter((prev) => ({\n                      ...prev,\n                      endDate: e.target.value,\n                    }))\n                  }\n                  className=\"text-xs\"\n                />\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Audit Logs Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Activity Log ({sortedData.length} entries)</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-3\">\n              {Array.from({ length: 10 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"timestamp\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Timestamp\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"userName\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      User\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"action\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Action\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"resource\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Resource\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"status\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Status\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"ipAddress\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      IP Address\n                    </SortableTableHeader>\n                    <TableHead>Details</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {sortedData.map((log: any) => (\n                    <TableRow key={log.id} className=\"hover:bg-gray-50\">\n                      <TableCell className=\"font-mono text-sm\">\n                        {log.timestamp ? format(\n                          new Date(log.timestamp),\n                          \"MMM dd, yyyy HH:mm:ss\",\n                        ) : 'N/A'}\n                      </TableCell>\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">{log.userName || 'Unknown'}</div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            {log.userEmail || 'N/A'}\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>{getActionBadge(log.action || 'UNKNOWN')}</TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-lg\">\n                            {getResourceIcon(log.resource || 'unknown')}\n                          </span>\n                          <div>\n                            <div className=\"font-medium capitalize\">\n                              {(log.resource || 'unknown').replace(\"_\", \" \")}\n                            </div>\n                            {log.resourceId && (\n                              <div className=\"text-sm text-muted-foreground font-mono\">\n                                ID: {log.resourceId}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>{getStatusBadge(log.status || 'unknown')}</TableCell>\n                      <TableCell className=\"font-mono text-sm\">\n                        {log.ipAddress || 'N/A'}\n                      </TableCell>\n                      <TableCell>\n                        <Dialog>\n                          <DialogTrigger asChild>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => setSelectedLog(log)}\n                              className=\"h-8 w-8 p-0\"\n                            >\n                              <Eye className=\"h-4 w-4\" />\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n                            <DialogHeader>\n                              <DialogTitle className=\"flex items-center gap-2\">\n                                <Activity className=\"h-5 w-5\" />\n                                Audit Log Details\n                              </DialogTitle>\n                            </DialogHeader>\n                            {selectedLog && (\n                              <div className=\"space-y-6\">\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                  <div>\n                                    <Label className=\"font-semibold\">\n                                      User\n                                    </Label>\n                                    <p className=\"text-sm mt-1\">\n                                      {selectedLog.userName || 'Unknown'} ({selectedLog.userEmail || 'N/A'})\n                                    </p>\n                                  </div>\n                                  <div>\n                                    <Label className=\"font-semibold\">\n                                      Action\n                                    </Label>\n                                    <div className=\"mt-1\">\n                                      {getActionBadge(selectedLog.action || 'UNKNOWN')}\n                                    </div>\n                                  </div>\n                                  <div>\n                                    <Label className=\"font-semibold\">\n                                      Resource\n                                    </Label>\n                                    <div className=\"flex items-center gap-2 mt-1\">\n                                      <span className=\"text-lg\">\n                                        {getResourceIcon(selectedLog.resource || 'unknown')}\n                                      </span>\n                                      <span className=\"text-sm capitalize\">\n                                        {(selectedLog.resource || 'unknown').replace(\"_\", \" \")}\n                                      </span>\n                                    </div>\n                                  </div>\n                                  <div>\n                                    <Label className=\"font-semibold\">\n                                      Status\n                                    </Label>\n                                    <div className=\"mt-1\">\n                                      {getStatusBadge(selectedLog.status || 'unknown')}\n                                    </div>\n                                  </div>\n                                  <div>\n                                    <Label className=\"font-semibold\">\n                                      IP Address\n                                    </Label>\n                                    <p className=\"text-sm mt-1 font-mono\">\n                                      {selectedLog.ipAddress || 'N/A'}\n                                    </p>\n                                  </div>\n                                  <div>\n                                    <Label className=\"font-semibold\">\n                                      Timestamp\n                                    </Label>\n                                    <p className=\"text-sm mt-1 font-mono\">\n                                      {selectedLog.timestamp ? format(\n                                        new Date(selectedLog.timestamp),\n                                        \"PPpp\",\n                                      ) : 'N/A'}\n                                    </p>\n                                  </div>\n                                </div>\n\n                                {selectedLog.details && (\n                                  <div>\n                                    <Label className=\"font-semibold\">\n                                      Request Details\n                                    </Label>\n                                    <pre className=\"text-xs bg-gray-50 p-3 rounded-lg overflow-x-auto mt-2 border\">\n                                      {typeof selectedLog.details === 'string' \n                                        ? selectedLog.details \n                                        : JSON.stringify(selectedLog.details, null, 2)\n                                      }\n                                    </pre>\n                                  </div>\n                                )}\n\n                                {selectedLog.oldValues && (\n                                  <div>\n                                    <Label className=\"font-semibold\">\n                                      Previous Values\n                                    </Label>\n                                    <pre className=\"text-xs bg-red-50 p-3 rounded-lg overflow-x-auto mt-2 border border-red-200\">\n                                      {typeof selectedLog.oldValues === 'string' \n                                        ? selectedLog.oldValues \n                                        : JSON.stringify(selectedLog.oldValues, null, 2)\n                                      }\n                                    </pre>\n                                  </div>\n                                )}\n\n                                {selectedLog.newValues && (\n                                  <div>\n                                    <Label className=\"font-semibold\">\n                                      New Values\n                                    </Label>\n                                    <pre className=\"text-xs bg-green-50 p-3 rounded-lg overflow-x-auto mt-2 border border-green-200\">\n                                      {typeof selectedLog.newValues === 'string' \n                                        ? selectedLog.newValues \n                                        : JSON.stringify(selectedLog.newValues, null, 2)\n                                      }\n                                    </pre>\n                                  </div>\n                                )}\n\n                                {selectedLog.errorMessage && (\n                                  <div>\n                                    <Label className=\"font-semibold text-red-600\">\n                                      Error Message\n                                    </Label>\n                                    <div className=\"text-sm bg-red-50 p-3 rounded-lg mt-2 border border-red-200 text-red-800\">\n                                      {selectedLog.errorMessage}\n                                    </div>\n                                  </div>\n                                )}\n                              </div>\n                            )}\n                          </DialogContent>\n                        </Dialog>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n\n          {/* Pagination */}\n          {pagination.totalPages > 1 && (\n            <div className=\"flex items-center justify-between mt-6 pt-4 border-t\">\n              <div className=\"text-sm text-muted-foreground\">\n                Showing {(pagination.page - 1) * pagination.limit + 1} to{\" \"}\n                {Math.min(pagination.page * pagination.limit, pagination.total)}{\" \"}\n                of {pagination.total} entries\n              </div>\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setPage(page - 1)}\n                  disabled={page <= 1}\n                >\n                  Previous\n                </Button>\n                <span className=\"flex items-center px-3 text-sm\">\n                  Page {pagination.page} of {pagination.totalPages}\n                </span>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setPage(page + 1)}\n                  disabled={page >= pagination.totalPages}\n                >\n                  Next\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {sortedData.length === 0 && !isLoading && (\n            <div className=\"text-center py-12\">\n              <Activity className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold text-muted-foreground mb-2\">\n                No audit logs found\n              </h3>\n              <p className=\"text-muted-foreground\">\n                {searchTerm ||\n                actionFilter !== \"all\" ||\n                resourceFilter !== \"all\"\n                  ? \"Try adjusting your filters\"\n                  : \"System activities will appear here\"}\n              </p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":30667,"size_tokens":null},"client/src/pages/branches.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useRoleAccess } from \"@/hooks/useRoleAccess\";\nimport { ProtectedPage } from \"@/components/protected-page\";\nimport {\n  Building2,\n  Plus,\n  Edit,\n  Trash2,\n  MapPin,\n  Phone,\n  Mail,\n  User,\n  Crown,\n} from \"lucide-react\";\nimport type { Branch, InsertBranch } from \"@shared/schema\";\n\nexport default function Branches() {\n  return (\n    <ProtectedPage resource=\"branches\" action=\"read\">\n      <BranchManagement />\n    </ProtectedPage>\n  );\n}\n\nfunction BranchManagement() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingBranch, setEditingBranch] = useState<Branch | null>(null);\n  const [branchData, setBranchData] = useState<InsertBranch>({\n    branchCode: \"\",\n    name: \"\",\n    address: \"\",\n    phone: \"\",\n    email: \"\",\n    managerName: \"\",\n    isHeadOffice: false,\n    isActive: true,\n  });\n\n  const { toast } = useToast();\n  const { canManageBranches } = useRoleAccess();\n\n  const {\n    data: branches = [],\n    isLoading,\n    error,\n  } = useQuery<Branch[]>({\n    queryKey: [\"/api/branches\"],\n  });\n\n  const createBranchMutation = useMutation({\n    mutationFn: (data: InsertBranch) =>\n      apiRequest(\"POST\", \"/api/branches\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/branches\"] });\n      setIsDialogOpen(false);\n      resetForm();\n      toast({\n        title: \"Success\",\n        description: \"Branch created successfully\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create branch\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateBranchMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: Partial<InsertBranch> }) =>\n      apiRequest(\"PUT\", `/api/branches/${id}`, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/branches\"] });\n      setIsDialogOpen(false);\n      resetForm();\n      toast({\n        title: \"Success\",\n        description: \"Branch updated successfully\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update branch\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteBranchMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/branches/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/branches\"] });\n      toast({\n        title: \"Success\",\n        description: \"Branch deleted successfully\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete branch\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setBranchData({\n      branchCode: \"\",\n      name: \"\",\n      address: \"\",\n      phone: \"\",\n      email: \"\",\n      managerName: \"\",\n      isHeadOffice: false,\n      isActive: true,\n    });\n    setEditingBranch(null);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (editingBranch) {\n      updateBranchMutation.mutate({\n        id: editingBranch.id,\n        data: branchData,\n      });\n    } else {\n      createBranchMutation.mutate(branchData);\n    }\n  };\n\n  const handleEdit = (branch: Branch) => {\n    setEditingBranch(branch);\n    setBranchData({\n      branchCode: branch.branchCode,\n      name: branch.name,\n      address: branch.address || \"\",\n      phone: branch.phone || \"\",\n      email: branch.email || \"\",\n      managerName: branch.managerName || \"\",\n      isHeadOffice: branch.isHeadOffice,\n      isActive: branch.isActive,\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (id: number) => {\n    if (window.confirm(\"Are you sure you want to delete this branch?\")) {\n      deleteBranchMutation.mutate(id);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p>Loading branches...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"text-center text-red-600\">\n            <p>Error loading branches: {error.message}</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-muted-foreground\">\n            Manage company branches and locations\n          </p>\n        </div>\n\n        {canManageBranches() && (\n          <Dialog\n            open={isDialogOpen}\n            onOpenChange={(open) => {\n              setIsDialogOpen(open);\n              if (!open) {\n                resetForm();\n              }\n            }}\n          >\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Branch\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-md\">\n              <form onSubmit={handleSubmit}>\n                <DialogHeader>\n                  <DialogTitle>\n                    {editingBranch ? \"Edit Branch\" : \"Add New Branch\"}\n                  </DialogTitle>\n                  <DialogDescription>\n                    {editingBranch\n                      ? \"Update branch information\"\n                      : \"Create a new branch location\"}\n                  </DialogDescription>\n                </DialogHeader>\n\n                <div className=\"grid gap-4 py-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <Label htmlFor=\"branchCode\">Branch Code *</Label>\n                      <Input\n                        id=\"branchCode\"\n                        value={branchData.branchCode}\n                        onChange={(e) =>\n                          setBranchData({\n                            ...branchData,\n                            branchCode: e.target.value,\n                          })\n                        }\n                        placeholder=\"BR001\"\n                        required\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"name\">Branch Name *</Label>\n                      <Input\n                        id=\"name\"\n                        value={branchData.name}\n                        onChange={(e) =>\n                          setBranchData({ ...branchData, name: e.target.value })\n                        }\n                        placeholder=\"Main Branch\"\n                        required\n                      />\n                    </div>\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"address\">Address</Label>\n                    <Textarea\n                      id=\"address\"\n                      value={branchData.address}\n                      onChange={(e) =>\n                        setBranchData({\n                          ...branchData,\n                          address: e.target.value,\n                        })\n                      }\n                      placeholder=\"Enter branch address\"\n                      rows={2}\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <Label htmlFor=\"phone\">Phone</Label>\n                      <Input\n                        id=\"phone\"\n                        value={branchData.phone}\n                        onChange={(e) =>\n                          setBranchData({\n                            ...branchData,\n                            phone: e.target.value,\n                          })\n                        }\n                        placeholder=\"+977-1-4567890\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"email\">Email</Label>\n                      <Input\n                        id=\"email\"\n                        type=\"email\"\n                        value={branchData.email}\n                        onChange={(e) =>\n                          setBranchData({\n                            ...branchData,\n                            email: e.target.value,\n                          })\n                        }\n                        placeholder=\"branch@company.com\"\n                      />\n                    </div>\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"managerName\">Manager Name</Label>\n                    <Input\n                      id=\"managerName\"\n                      value={branchData.managerName}\n                      onChange={(e) =>\n                        setBranchData({\n                          ...branchData,\n                          managerName: e.target.value,\n                        })\n                      }\n                      placeholder=\"Branch Manager\"\n                    />\n                  </div>\n\n                  <div className=\"flex items-center space-x-2\">\n                    <Switch\n                      id=\"isHeadOffice\"\n                      checked={branchData.isHeadOffice}\n                      onCheckedChange={(checked) =>\n                        setBranchData({ ...branchData, isHeadOffice: checked })\n                      }\n                    />\n                    <Label htmlFor=\"isHeadOffice\">Head Office</Label>\n                  </div>\n\n                  <div className=\"flex items-center space-x-2\">\n                    <Switch\n                      id=\"isActive\"\n                      checked={branchData.isActive}\n                      onCheckedChange={(checked) =>\n                        setBranchData({ ...branchData, isActive: checked })\n                      }\n                    />\n                    <Label htmlFor=\"isActive\">Active</Label>\n                  </div>\n                </div>\n\n                <DialogFooter>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setIsDialogOpen(false)}\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={\n                      createBranchMutation.isPending ||\n                      updateBranchMutation.isPending\n                    }\n                  >\n                    {createBranchMutation.isPending ||\n                    updateBranchMutation.isPending\n                      ? \"Saving...\"\n                      : editingBranch\n                        ? \"Update\"\n                        : \"Create\"}\n                  </Button>\n                </DialogFooter>\n              </form>\n            </DialogContent>\n          </Dialog>\n        )}\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Branches</CardTitle>\n          <CardDescription>\n            List of all company branches and their details\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Branch Code</TableHead>\n                <TableHead>Name</TableHead>\n                <TableHead>Manager</TableHead>\n                <TableHead>Contact</TableHead>\n                <TableHead>Type</TableHead>\n                <TableHead>Status</TableHead>\n                {canManageBranches() && <TableHead>Actions</TableHead>}\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {branches.map((branch) => (\n                <TableRow key={branch.id}>\n                  <TableCell className=\"font-mono\">\n                    {branch.branchCode}\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex items-center gap-2\">\n                      {branch.isHeadOffice && (\n                        <Crown className=\"h-4 w-4 text-yellow-500\" />\n                      )}\n                      <span className=\"font-medium\">{branch.name}</span>\n                    </div>\n                    {branch.address && (\n                      <div className=\"flex items-center gap-1 text-sm text-muted-foreground mt-1\">\n                        <MapPin className=\"h-3 w-3\" />\n                        {branch.address}\n                      </div>\n                    )}\n                  </TableCell>\n                  <TableCell>\n                    {branch.managerName && (\n                      <div className=\"flex items-center gap-1\">\n                        <User className=\"h-3 w-3\" />\n                        {branch.managerName}\n                      </div>\n                    )}\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"space-y-1\">\n                      {branch.phone && (\n                        <div className=\"flex items-center gap-1 text-sm\">\n                          <Phone className=\"h-3 w-3\" />\n                          {branch.phone}\n                        </div>\n                      )}\n                      {branch.email && (\n                        <div className=\"flex items-center gap-1 text-sm\">\n                          <Mail className=\"h-3 w-3\" />\n                          {branch.email}\n                        </div>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    {branch.isHeadOffice ? (\n                      <Badge className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\">\n                        Head Office\n                      </Badge>\n                    ) : (\n                      <Badge variant=\"outline\">Branch</Badge>\n                    )}\n                  </TableCell>\n                  <TableCell>\n                    <Badge variant={branch.isActive ? \"default\" : \"secondary\"}>\n                      {branch.isActive ? \"Active\" : \"Inactive\"}\n                    </Badge>\n                  </TableCell>\n                  {canManageBranches() && (\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleEdit(branch)}\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        {!branch.isHeadOffice && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleDelete(branch.id)}\n                            className=\"text-red-600 hover:text-red-700\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        )}\n                      </div>\n                    </TableCell>\n                  )}\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":16176,"size_tokens":null},"client/src/pages/leave-requests.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Plus,\n  Calendar,\n  Edit,\n  Trash2,\n  Clock,\n  CheckCircle,\n  XCircle,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport SearchBar from \"@/components/search-bar\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\nimport { format } from \"date-fns\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\n\nexport default function LeaveRequests() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedStaff, setSelectedStaff] = useState<string>(\"all\");\n  const [filterStatus, setFilterStatus] = useState<string>(\"all\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingRequest, setEditingRequest] = useState<any>(null);\n  const [formData, setFormData] = useState({\n    staffId: \"\",\n    leaveType: \"vacation\",\n    startDate: \"\",\n    endDate: \"\",\n    reason: \"\",\n    notes: \"\",\n    status: \"pending\",\n  });\n\n  const { toast } = useToast();\n\n  // Fetch staff with proper handling\n  const {\n    staff = [],\n    isLoading: staffLoading,\n    error: staffError,\n  } = useQuery({\n    queryKey: [\"staff\"],\n    queryFn: async () => {\n      try {\n        const response = await apiRequest(\"GET\", \"/api/staff\");\n\n        // Handle different API response formats\n        let staffList: any[] = [];\n\n        if (Array.isArray(response)) {\n          staffList = response;\n        } else if (response?.success && Array.isArray(response.data)) {\n          staffList = response.data;\n        } else {\n          console.warn(\"Unexpected staff API response:\", response);\n          return [];\n        }\n\n        // Normalize field names (e.g., first_name ‚Üí firstName)\n        return staffList.map((member) => ({\n          id: member.id || member.staff_id,\n          firstName: member.firstName || member.first_name || \"Unknown\",\n          lastName: member.lastName || member.last_name || \"\",\n          position: member.position || member.role || \"\",\n          staffName:\n            `${member.firstName || member.first_name || \"Unknown\"} ${member.lastName || member.last_name || \"\"}`.trim(),\n        }));\n      } catch (err) {\n        if (isUnauthorizedError(err)) {\n          toast({\n            title: \"Unauthorized\",\n            description: \"Session expired. Redirecting to login...\",\n            variant: \"destructive\",\n          });\n          setTimeout(() => {\n            window.location.href = \"/api/login\";\n          }, 500);\n          return [];\n        }\n        console.error(\"Failed to fetch staff:\", err);\n        toast({\n          title: \"Error\",\n          description: \"Failed to load staff list. Please try again.\",\n          variant: \"destructive\",\n        });\n        return [];\n      }\n    },\n    staleTime: 1000 * 60 * 5, // 5 minutes\n    gcTime: 1000 * 60 * 10, // 10 minutes\n  });\n\n  // Fetch leave requests\n  const {\n    leaveRequests = [],\n    isLoading: requestsLoading,\n    error: requestsError,\n  } = useQuery({\n    queryKey: [\"leave-requests\", selectedStaff, filterStatus],\n    queryFn: async () => {\n      try {\n        const params = new URLSearchParams();\n        if (selectedStaff !== \"all\") params.append(\"staffId\", selectedStaff);\n        if (filterStatus !== \"all\") params.append(\"status\", filterStatus);\n\n        const url = `/api/leave-requests?${params}`;\n        const response = await apiRequest(\"GET\", url);\n\n        let requests: any[] = [];\n\n        if (Array.isArray(response)) {\n          requests = response;\n        } else if (response?.success && Array.isArray(response.data)) {\n          requests = response.data;\n        } else {\n          return [];\n        }\n\n        // Normalize leave request data\n        return requests.map((req) => ({\n          ...req,\n          staffName: req.staffName || \"Unknown Staff\",\n          leaveType: req.leaveType || \"vacation\",\n          status: req.status || \"pending\",\n        }));\n      } catch (err) {\n        if (isUnauthorizedError(err)) {\n          toast({\n            title: \"Unauthorized\",\n            description: \"Session expired. Redirecting to login...\",\n            variant: \"destructive\",\n          });\n          setTimeout(() => {\n            window.location.href = \"/api/login\";\n          }, 500);\n          return [];\n        }\n        console.error(\"Failed to fetch leave requests:\", err);\n        return [];\n      }\n    },\n    staleTime: 1000 * 60 * 2,\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  // Create mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      if (!data.staffId || !data.startDate || !data.endDate || !data.reason) {\n        throw new Error(\"Required fields missing\");\n      }\n      return apiRequest(\"POST\", \"/api/leave-requests\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Leave request created successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"leave-requests\"] });\n      setIsDialogOpen(false);\n      resetForm();\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create leave request\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update mutation\n  const updateMutation = useMutation({\n    mutationFn: (data: any) => {\n      return apiRequest(\n        \"PUT\",\n        `/api/leave-requests/${editingRequest.id}`,\n        data,\n      );\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Leave request updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"leave-requests\"] });\n      setIsDialogOpen(false);\n      setEditingRequest(null);\n      resetForm();\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update leave request\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) =>\n      apiRequest(\"DELETE\", `/api/leave-requests/${id}`),\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Leave request deleted successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"leave-requests\"] });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete leave request\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      staffId: \"\",\n      leaveType: \"vacation\",\n      startDate: \"\",\n      endDate: \"\",\n      reason: \"\",\n      notes: \"\",\n      status: \"pending\",\n    });\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (\n      !formData.staffId ||\n      !formData.startDate ||\n      !formData.endDate ||\n      !formData.reason\n    ) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (new Date(formData.startDate) > new Date(formData.endDate)) {\n      toast({\n        title: \"Error\",\n        description: \"Start date must be before or equal to end date\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const submitData = {\n      ...formData,\n      staffId: parseInt(formData.staffId),\n    };\n\n    if (editingRequest) {\n      updateMutation.mutate(submitData);\n    } else {\n      createMutation.mutate(submitData);\n    }\n  };\n\n  const handleEdit = (request: any) => {\n    setEditingRequest(request);\n    setFormData({\n      staffId: request.staffId.toString(),\n      leaveType: request.leaveType,\n      startDate: request.startDate ? request.startDate.split(\"T\")[0] : \"\",\n      endDate: request.endDate ? request.endDate.split(\"T\")[0] : \"\",\n      reason: request.reason || \"\",\n      notes: request.notes || \"\",\n      status: request.status,\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (id: number) => {\n    deleteMutation.mutate(id);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const statusConfig = {\n      pending: { variant: \"outline\" as const, label: \"Pending\", icon: Clock },\n      approved: {\n        variant: \"default\" as const,\n        label: \"Approved\",\n        icon: CheckCircle,\n      },\n      rejected: {\n        variant: \"destructive\" as const,\n        label: \"Rejected\",\n        icon: XCircle,\n      },\n    };\n\n    const config =\n      statusConfig[status as keyof typeof statusConfig] || statusConfig.pending;\n    const Icon = config.icon;\n\n    return (\n      <Badge variant={config.variant} className=\"flex items-center gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const getLeaveTypeBadge = (type: string) => {\n    const typeConfig = {\n      vacation: { variant: \"default\" as const, label: \"Vacation\" },\n      sick: { variant: \"secondary\" as const, label: \"Sick Leave\" },\n      personal: { variant: \"outline\" as const, label: \"Personal\" },\n      emergency: { variant: \"destructive\" as const, label: \"Emergency\" },\n      maternity: { variant: \"secondary\" as const, label: \"Maternity\" },\n      paternity: { variant: \"secondary\" as const, label: \"Paternity\" },\n    };\n\n    const config =\n      typeConfig[type as keyof typeof typeConfig] || typeConfig.vacation;\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  const filteredRequests = (leaveRequests || []).filter((request: any) => {\n    const matchesSearch =\n      `${request.staffName} ${request.leaveType} ${request.reason}`\n        .toLowerCase()\n        .includes(searchQuery.toLowerCase());\n    const matchesStaff =\n      selectedStaff === \"all\" || request.staffId.toString() === selectedStaff;\n    const matchesStatus =\n      filterStatus === \"all\" || request.status === filterStatus;\n\n    return matchesSearch && matchesStaff && matchesStatus;\n  });\n\n  const isLoading = staffLoading || requestsLoading;\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n        <div>\n          <p className=\"text-muted-foreground\">\n            Manage employee leave requests and approvals\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={resetForm}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Leave Request\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingRequest ? \"Edit Leave Request\" : \"New Leave Request\"}\n              </DialogTitle>\n            </DialogHeader>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"staffId\">Staff Member *</Label>\n                  <Select\n                    value={formData.staffId}\n                    onValueChange={(value) =>\n                      setFormData({ ...formData, staffId: value })\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select staff member\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {staff.map((member: any) => (\n                        <SelectItem\n                          key={member.id}\n                          value={member.id.toString()}\n                        >\n                          {member.firstName} {member.lastName} -{\" \"}\n                          {member.position}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"leaveType\">Leave Type *</Label>\n                  <Select\n                    value={formData.leaveType || undefined}\n                    onValueChange={(value) =>\n                      setFormData({ ...formData, leaveType: value })\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select leave type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"vacation\">Vacation</SelectItem>\n                      <SelectItem value=\"sick\">Sick Leave</SelectItem>\n                      <SelectItem value=\"personal\">Personal</SelectItem>\n                      <SelectItem value=\"emergency\">Emergency</SelectItem>\n                      <SelectItem value=\"maternity\">Maternity</SelectItem>\n                      <SelectItem value=\"paternity\">Paternity</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"startDate\">Start Date *</Label>\n                  <Input\n                    id=\"startDate\"\n                    type=\"date\"\n                    value={formData.startDate}\n                    onChange={(e) =>\n                      setFormData({ ...formData, startDate: e.target.value })\n                    }\n                    required\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"endDate\">End Date *</Label>\n                  <Input\n                    id=\"endDate\"\n                    type=\"date\"\n                    value={formData.endDate}\n                    onChange={(e) =>\n                      setFormData({ ...formData, endDate: e.target.value })\n                    }\n                    required\n                  />\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"reason\">Reason *</Label>\n                <Textarea\n                  id=\"reason\"\n                  value={formData.reason}\n                  onChange={(e) =>\n                    setFormData({ ...formData, reason: e.target.value })\n                  }\n                  placeholder=\"Please provide a reason for the leave request\"\n                  required\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"notes\">Additional Notes</Label>\n                <Textarea\n                  id=\"notes\"\n                  value={formData.notes}\n                  onChange={(e) =>\n                    setFormData({ ...formData, notes: e.target.value })\n                  }\n                  placeholder=\"Any additional notes or comments\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"status\">Status</Label>\n                <Select\n                  value={formData.status || undefined}\n                  onValueChange={(value) =>\n                    setFormData({ ...formData, status: value })\n                  }\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select status\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"pending\">Pending</SelectItem>\n                    <SelectItem value=\"approved\">Approved</SelectItem>\n                    <SelectItem value=\"rejected\">Rejected</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex justify-end space-x-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={\n                    createMutation.isPending || updateMutation.isPending\n                  }\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? \"Saving...\"\n                    : editingRequest\n                      ? \"Update\"\n                      : \"Create\"}{\" \"}\n                  Request\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div>\n              <Label htmlFor=\"staffFilter\">Staff Member</Label>\n              <Select value={selectedStaff} onValueChange={setSelectedStaff}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"All staff\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All staff</SelectItem>\n                  {staff.map((member: any) => (\n                    <SelectItem key={member.id} value={member.id.toString()}>\n                      {member.firstName} {member.lastName}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"statusFilter\">Status</Label>\n              <Select value={filterStatus} onValueChange={setFilterStatus}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"All statuses\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All statuses</SelectItem>\n                  <SelectItem value=\"pending\">Pending</SelectItem>\n                  <SelectItem value=\"approved\">Approved</SelectItem>\n                  <SelectItem value=\"rejected\">Rejected</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"search\">Search</Label>\n              <SearchBar\n                placeholder=\"Search leave requests...\"\n                value={searchQuery}\n                onChange={setSearchQuery}\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Leave Requests Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Leave Requests ({filteredRequests.length})</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto\"></div>\n              <p className=\"text-muted-foreground mt-2\">\n                Loading leave requests...\n              </p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Staff Member</TableHead>\n                    <TableHead>Leave Type</TableHead>\n                    <TableHead>Start Date</TableHead>\n                    <TableHead>End Date</TableHead>\n                    <TableHead>Duration</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Reason</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredRequests.length > 0 ? (\n                    filteredRequests.map((request: any) => (\n                      <TableRow key={request.id}>\n                        <TableCell className=\"font-medium\">\n                          {request.staffName}\n                        </TableCell>\n                        <TableCell>\n                          {getLeaveTypeBadge(request.leaveType)}\n                        </TableCell>\n                        <TableCell>\n                          {request.startDate\n                            ? format(\n                                new Date(request.startDate),\n                                \"MMM dd, yyyy\",\n                              )\n                            : \"N/A\"}\n                        </TableCell>\n                        <TableCell>\n                          {request.endDate\n                            ? format(new Date(request.endDate), \"MMM dd, yyyy\")\n                            : \"N/A\"}\n                        </TableCell>\n                        <TableCell>\n                          {request.startDate && request.endDate\n                            ? `${Math.ceil(\n                                (new Date(request.endDate).getTime() -\n                                  new Date(request.startDate).getTime()) /\n                                  (1000 * 60 * 60 * 24) +\n                                  1,\n                              )} days`\n                            : \"N/A\"}\n                        </TableCell>\n                        <TableCell>{getStatusBadge(request.status)}</TableCell>\n                        <TableCell className=\"max-w-xs truncate\">\n                          {request.reason}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex space-x-2\">\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleEdit(request)}\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <DeleteConfirmationDialog\n                              trigger={\n                                <Button variant=\"outline\" size=\"sm\">\n                                  <Trash2 className=\"h-4 w-4\" />\n                                </Button>\n                              }\n                              title=\"Delete Leave Request\"\n                              itemName={`${request.staffName}'s ${request.leaveType} request`}\n                              onConfirm={() => handleDelete(request.id)}\n                              isLoading={deleteMutation.isPending}\n                            />\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  ) : (\n                    <TableRow>\n                      <TableCell\n                        colSpan={8}\n                        className=\"text-center py-8 text-muted-foreground\"\n                      >\n                        No leave requests found.\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":24560,"size_tokens":null},"client/src/pages/parties.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  PermissionWrapper,\n  ReadOnlyWrapper,\n} from \"@/components/permission-wrapper\";\nimport { Input } from \"@/components/ui/input\";\nimport SearchBar from \"@/components/search-bar\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Plus,\n  Search,\n  Edit,\n  Trash2,\n  Building,\n  Eye,\n  Download,\n  AlertCircle,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\nimport { format } from \"date-fns\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n  usePagination,\n} from \"@/components/ui/pagination\";\n\ninterface LedgerTransaction {\n  id: number;\n  transactionDate: string;\n  description: string;\n  referenceNumber?: string;\n  debitAmount: string;\n  creditAmount: string;\n  runningBalance: string;\n  transactionType: string;\n  paymentMethod?: string;\n  notes?: string;\n}\n\ninterface FormErrors {\n  name?: string;\n  type?: string;\n  email?: string;\n  phone?: string;\n  openingBalance?: string;\n}\n\ninterface TransactionFormErrors {\n  transactionType?: string;\n  amount?: string;\n  description?: string;\n  transactionDate?: string;\n}\n\nexport default function Parties() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingParty, setEditingParty] = useState<any>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [typeFilter, setTypeFilter] = useState(\"all\");\n  const [selectedParty, setSelectedParty] = useState<any>(null);\n  const [isLedgerDialogOpen, setIsLedgerDialogOpen] = useState(false);\n  const [selectedType, setSelectedType] = useState(\"\");\n  const [transactionType, setTransactionType] = useState(\"\");\n  const [formErrors, setFormErrors] = useState<FormErrors>({});\n  const [transactionErrors, setTransactionErrors] =\n    useState<TransactionFormErrors>({});\n  const { formatCurrency } = useCurrency();\n\n\n\n  const {\n    data: partiesResponse,\n    isLoading,\n    error,\n    refetch\n  } = useQuery({\n    queryKey: [\"/api/parties\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/parties\");\n      return response;\n    },\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  const parties = Array.isArray(partiesResponse?.data)\n    ? partiesResponse.data\n    : Array.isArray(partiesResponse?.items)\n    ? partiesResponse.items\n    : Array.isArray(partiesResponse)\n    ? partiesResponse\n    : [];\n\n  // Check URL parameters for auto-opening ledger\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const viewLedgerParam = urlParams.get(\"viewLedger\");\n\n    if (viewLedgerParam && Array.isArray(parties) && parties.length > 0) {\n      const partyId = parseInt(viewLedgerParam);\n      const party = parties.find((p: any) => p.id === partyId);\n\n      if (party) {\n        setSelectedParty(party);\n        setIsLedgerDialogOpen(true);\n        // Clear the URL parameter\n        window.history.replaceState({}, \"\", window.location.pathname);\n      }\n    }\n  }, [parties]);\n\n  const { data: ledgerTransactions = [] } = useQuery({\n    queryKey: [\"/api/ledger/party\", selectedParty?.id],\n    enabled: !!selectedParty?.id,\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: any) => apiRequest(\"POST\", \"/api/parties\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/parties\"] });\n      setIsDialogOpen(false);\n      setEditingParty(null);\n      setFormErrors({});\n      toast({ title: \"Success\", description: \"Party saved successfully\" });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n\n      if (error.response?.data?.errors) {\n        setFormErrors(error.response.data.errors);\n      } else {\n        toast({\n          title: \"Error\",\n          description: error.response?.data?.message || \"Failed to save party\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) =>\n      apiRequest(\"PUT\", `/api/parties/${id}`, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/parties\"] });\n      setIsDialogOpen(false);\n      setEditingParty(null);\n      setFormErrors({});\n      toast({ title: \"Success\", description: \"Party updated successfully\" });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n\n      if (error.response?.data?.errors) {\n        setFormErrors(error.response.data.errors);\n      } else {\n        toast({\n          title: \"Error\",\n          description:\n            error.response?.data?.message || \"Failed to update party\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/parties/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/parties\"] });\n      toast({ title: \"Success\", description: \"Party deleted successfully\" });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete party\",\n        variant: \"destructive\",\n      });\n    },\n  });\n  const [isTransactionDialogOpen, setIsTransactionDialogOpen] = useState(false);\n  const transactionMutation = useMutation({\n    mutationFn: (data: any) => apiRequest(\"POST\", \"/api/ledger\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/parties\"] });\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/ledger/party\", selectedParty?.id],\n      });\n      setIsTransactionDialogOpen(false);\n      setTransactionType(\"\");\n      setTransactionErrors({});\n      toast({\n        title: \"Success\",\n        description: \"Transaction added successfully\",\n      });\n    },\n    onError: (error: any) => {\n      if (error.response?.data?.errors) {\n        setTransactionErrors(error.response.data.errors);\n      } else {\n        toast({\n          title: \"Error\",\n          description:\n            error.response?.data?.message || \"Failed to add transaction\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const validateForm = (formData: FormData): boolean => {\n    const errors: FormErrors = {};\n\n    const name = formData.get(\"name\") as string;\n    const type = formData.get(\"type\") as string;\n    const email = formData.get(\"email\") as string;\n    const phone = formData.get(\"phone\") as string;\n    const openingBalance = formData.get(\"openingBalance\") as string;\n\n    if (!name || name.trim().length < 2) {\n      errors.name = \"Party name must be at least 2 characters long\";\n    }\n\n    if (!type) {\n      errors.type = \"Please select a party type\";\n    }\n\n    if (email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {\n      errors.email = \"Please enter a valid email address\";\n    }\n\n    if (phone && !/^[\\d\\s\\-\\+\\(\\)]+$/.test(phone)) {\n      errors.phone = \"Please enter a valid phone number\";\n    }\n\n    if (openingBalance && isNaN(parseFloat(openingBalance))) {\n      errors.openingBalance = \"Opening balance must be a valid number\";\n    }\n\n    setFormErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  const validateTransactionForm = (formData: FormData): boolean => {\n    const errors: TransactionFormErrors = {};\n\n    const amount = formData.get(\"amount\") as string;\n    const description = formData.get(\"description\") as string;\n    const transactionDate = formData.get(\"transactionDate\") as string;\n\n    if (!transactionType) {\n      errors.transactionType = \"Please select a transaction type\";\n    }\n\n    if (!amount || amount.trim() === \"\") {\n      errors.amount = \"Amount is required\";\n    } else if (isNaN(parseFloat(amount)) || parseFloat(amount) <= 0) {\n      errors.amount = \"Amount must be a positive number\";\n    } else if (parseFloat(amount) > 999999999.99) {\n      errors.amount = \"Amount is too large\";\n    }\n\n    if (!description || description.trim().length < 3) {\n      errors.description = \"Description must be at least 3 characters long\";\n    } else if (description.trim().length > 500) {\n      errors.description = \"Description is too long (max 500 characters)\";\n    }\n\n    if (!transactionDate) {\n      errors.transactionDate = \"Transaction date is required\";\n    } else {\n      const selectedDate = new Date(transactionDate);\n      const today = new Date();\n      const oneYearAgo = new Date();\n      oneYearAgo.setFullYear(today.getFullYear() - 1);\n\n      if (selectedDate > today) {\n        errors.transactionDate = \"Transaction date cannot be in the future\";\n      } else if (selectedDate < oneYearAgo) {\n        errors.transactionDate =\n          \"Transaction date cannot be more than 1 year ago\";\n      }\n    }\n\n    setTransactionErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  const handleSave = (e: React.FormEvent) => {\n    e.preventDefault();\n    const formData = new FormData(e.target as HTMLFormElement);\n\n    if (!validateForm(formData)) {\n      return;\n    }\n\n    const data = {\n      name: formData.get(\"name\") as string,\n      type: selectedType || (formData.get(\"type\") as string),\n      email: (formData.get(\"email\") as string) || null,\n      phone: (formData.get(\"phone\") as string) || null,\n      address: (formData.get(\"address\") as string) || null,\n      contactPerson: (formData.get(\"contactPerson\") as string) || null,\n      taxId: (formData.get(\"taxId\") as string) || null,\n      notes: (formData.get(\"notes\") as string) || null,\n      openingBalance: formData.get(\"openingBalance\")\n        ? parseFloat(formData.get(\"openingBalance\") as string) || 0\n        : 0,\n      isActive: true,\n    };\n\n    if (editingParty) {\n      updateMutation.mutate({ id: editingParty.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const handleTransactionSave = (e: React.FormEvent) => {\n    e.preventDefault();\n    const formData = new FormData(e.target as HTMLFormElement);\n\n    if (!validateTransactionForm(formData)) {\n      return;\n    }\n\n    const amount = parseFloat(formData.get(\"amount\") as string);\n    const isDebit =\n      transactionType === \"purchase\" || transactionType === \"adjustment_debit\";\n\n    const data = {\n      customerOrPartyId: selectedParty.id,\n      entityType: \"party\",\n      transactionDate: formData.get(\"transactionDate\") as string,\n      description: formData.get(\"description\") as string,\n      referenceNumber: formData.get(\"referenceNumber\") as string,\n      debitAmount: isDebit ? amount : 0,\n      creditAmount: !isDebit ? amount : 0,\n      transactionType,\n      paymentMethod: formData.get(\"paymentMethod\") as string,\n      notes: formData.get(\"notes\") as string,\n    };\n\n    transactionMutation.mutate(data);\n  };\n\n  const exportLedger = () => {\n    const csvContent = [\n      [\"Date\", \"Description\", \"Reference\", \"Debit\", \"Credit\", \"Balance\"].join(\n        \",\",\n      ),\n      ...ledgerTransactions.map((txn: LedgerTransaction) =>\n        [\n          format(new Date(txn.transactionDate), \"dd/MM/yyyy\"),\n          txn.description,\n          txn.referenceNumber || \"\",\n          txn.debitAmount,\n          txn.creditAmount,\n          txn.runningBalance,\n        ].join(\",\"),\n      ),\n    ].join(\"\\n\");\n\n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `${selectedParty?.name}_ledger.csv`;\n    a.click();\n    window.URL.revokeObjectURL(url);\n\n    toast({\n      title: \"Export Successful\",\n      description: \"Ledger exported to CSV file\",\n    });\n  };\n\n  const partyTypes = [\n    \"supplier\",\n    \"vendor\",\n    \"distributor\",\n    \"contractor\",\n    \"service_provider\",\n  ];\n\n  const filteredParties = Array.isArray(parties) ? parties.filter((party: any) => {\n    const matchesSearch =\n      party.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      party.email?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      party.contactPerson?.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesType = typeFilter === \"all\" || party.type === typeFilter;\n    return matchesSearch && matchesType;\n  }) : [];\n\n  // Add sorting functionality\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredParties,\n    \"name\",\n  );\n\n  // Add pagination\n  const {\n    currentItems: paginatedParties,\n    currentPage,\n    pageSize,\n    totalPages,\n    totalItems,\n    goToPage: handlePageChange,\n    setPageSize: handlePageSizeChange,\n  } = usePagination(sortedData, 10);\n\n  const getTypeBadge = (type: string) => {\n    const variants: Record<\n      string,\n      \"default\" | \"secondary\" | \"destructive\" | \"outline\"\n    > = {\n      supplier: \"default\",\n      vendor: \"secondary\",\n      distributor: \"outline\",\n      contractor: \"destructive\",\n      service_provider: \"default\",\n    };\n    return variants[type] || \"outline\";\n  };\n\n  const getBalanceBadge = (balance: any) => {\n    const amount = parseFloat(balance || 0);\n    if (amount > 0) {\n      return {\n        variant: \"destructive\" as const,\n        text: `Dr. ${formatCurrency(amount)}`,\n      };\n    } else if (amount < 0) {\n      return {\n        variant: \"default\" as const,\n        text: `Cr. ${formatCurrency(Math.abs(amount))}`,\n      };\n    }\n    return { variant: \"secondary\" as const, text: formatCurrency(0) };\n  };\n\n  const calculateTotals = () => {\n    let totalDebit = 0;\n    let totalCredit = 0;\n\n    ledgerTransactions.forEach((txn: LedgerTransaction) => {\n      totalDebit += parseFloat(txn.debitAmount) || 0;\n      totalCredit += parseFloat(txn.creditAmount) || 0;\n    });\n\n    return { totalDebit, totalCredit };\n  };\n\n  if (error) {\n    if (isUnauthorizedError(error)) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return null;\n    }\n    console.error(\"Error loading parties:\", error);\n  }\n\n  const createPartyMutation = useMutation({\n    mutationFn: async (partyData: any) => {\n      console.log(\"Submitting party data:\", partyData);\n      const response = await apiRequest(\"POST\", \"/api/parties\", partyData);\n      return response;\n    },\n    onSuccess: (data) => {\n      console.log(\"Party created successfully:\", data);\n      queryClient.invalidateQueries({ queryKey: [\"/api/parties\"] });\n      refetch();\n      setIsDialogOpen(false);\n      setEditingParty(null);\n      setSelectedType(\"\");\n      setFormErrors({});\n      toast({\n        title: \"Success\",\n        description: \"Party created successfully\",\n      });\n    },\n    onError: (error: any) => {\n      console.error(\"Create party error:\", error);\n\n      // Handle unauthorized errors\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n\n      // Handle validation errors\n      if (error.response?.data?.errors) {\n        setFormErrors(error.response.data.errors);\n        toast({\n          title: \"Validation Error\",\n          description: \"Please check the form for errors\",\n          variant: \"destructive\",\n        });\n      } else {\n        const errorMessage =\n          error.response?.data?.message ||\n          error.message ||\n          \"Failed to create party\";\n        toast({\n          title: \"Error\",\n          description: errorMessage,\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const updatePartyMutation = useMutation({\n    mutationFn: async ({\n      id,\n      ...partyData\n    }: {\n      id: string;\n      [key: string]: any;\n    }) => {\n      console.log(`Updating party with ID: ${id} and data:`, partyData);\n      const response = await apiRequest(\"PUT\", `/api/parties/${id}`, partyData);\n      return response;\n    },\n    onSuccess: (data) => {\n      console.log(\"Party updated successfully:\", data);\n      queryClient.invalidateQueries({ queryKey: [\"/api/parties\"] });\n      refetch();\n      setIsDialogOpen(false);\n      setEditingParty(null);\n      setSelectedType(\"\");\n      setFormErrors({});\n      toast({\n        title: \"Success\",\n        description: \"Party updated successfully\",\n      });\n    },\n    onError: (error: any) => {\n      console.error(\"Update party error:\", error);\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      if (error.response?.data?.errors) {\n        setFormErrors(error.response.data.errors);\n        toast({\n          title: \"Validation Error\",\n          description: \"Please check the form for errors\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Error\",\n          description:\n            error.response?.data?.message || \"Failed to update party\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setFormErrors({});\n\n    const formData = new FormData(e.currentTarget);\n\n    // Client-side validation\n    const errors: FormErrors = {};\n    const name = formData.get(\"name\") as string;\n    const type = selectedType || formData.get(\"type\") as string;\n\n    if (!name?.trim()) {\n      errors.name = \"Party name is required\";\n    } else if (name.trim().length < 2) {\n      errors.name = \"Party name must be at least 2 characters long\";\n    }\n\n    if (!type?.trim()) {\n      errors.type = \"Party type is required\";\n    }\n\n    // Validate email format if provided\n    const email = formData.get(\"email\") as string;\n    if (email && email.trim() && !/\\S+@\\S+\\.\\S+/.test(email.trim())) {\n      errors.email = \"Please enter a valid email address\";\n    }\n\n    // Validate opening balance if provided\n    const openingBalance = formData.get(\"openingBalance\") as string;\n    if (openingBalance && openingBalance.trim() && isNaN(parseFloat(openingBalance))) {\n      errors.openingBalance = \"Please enter a valid number\";\n    }\n\n    if (Object.keys(errors).length > 0) {\n      setFormErrors(errors);\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fix the errors in the form\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const partyData = {\n      name: name.trim(),\n      type: type.trim(),\n      contactPerson: (formData.get(\"contactPerson\") as string)?.trim() || null,\n      email: email?.trim() || null,\n      phone: (formData.get(\"phone\") as string)?.trim() || null,\n      address: (formData.get(\"address\") as string)?.trim() || null,\n      taxId: (formData.get(\"taxId\") as string)?.trim() || null,\n      notes: (formData.get(\"notes\") as string)?.trim() || null,\n      openingBalance: openingBalance?.trim() || \"0\",\n    };\n\n    console.log(\"Form submission - Party data:\", partyData);\n\n    if (editingParty) {\n      updatePartyMutation.mutate({ id: editingParty.id, ...partyData });\n    } else {\n      createPartyMutation.mutate(partyData);\n    }\n  };\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600\">\n            Manage suppliers, vendors, and business partners with complete\n            transaction history\n          </p>\n        </div>\n        <PermissionWrapper resource=\"parties\" action=\"write\">\n          <Dialog\n            open={isDialogOpen}\n            onOpenChange={(open) => {\n              setIsDialogOpen(open);\n              if (!open) {\n                setEditingParty(null);\n                setSelectedType(\"\");\n                setFormErrors({});\n              }\n            }}\n          >\n            <DialogTrigger asChild>\n              <Button\n                onClick={() => {\n                  setEditingParty(null);\n                  setSelectedType(\"\");\n                  setFormErrors({});\n                }}\n                className=\"w-full sm:w-auto\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Party\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl mx-auto max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>\n                  {editingParty ? \"Edit Party\" : \"Add New Party\"}\n                </DialogTitle>\n                <DialogDescription>Enter party details below</DialogDescription>\n              </DialogHeader>\n              <form onSubmit={handleSubmit} className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"name\">Party Name *</Label>\n                    <Input\n                      id=\"name\"\n                      name=\"name\"\n                      placeholder=\"Enter party name\"\n                      defaultValue={editingParty?.name || \"\"}\n                      className={formErrors.name ? \"border-red-500\" : \"\"}\n                      required\n                    />\n                    {formErrors.name && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {formErrors.name}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"type\">Party Type *</Label>\n                    <Select\n                      value={selectedType || editingParty?.type || \"\"}\n                      onValueChange={setSelectedType}\n                    >\n                      <SelectTrigger\n                        className={formErrors.type ? \"border-red-500\" : \"\"}\n                      >\n                        <SelectValue placeholder=\"Select party type\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {partyTypes.map((type) => (\n                          <SelectItem key={type} value={type}>\n                            {type.charAt(0).toUpperCase() +\n                              type.slice(1).replace(\"_\", \" \")}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <input\n                      type=\"hidden\"\n                      name=\"type\"\n                      value={selectedType || editingParty?.type || \"\"}\n                    />\n                    {formErrors.type && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {formErrors.type}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"email\">Email Address</Label>\n                    <Input\n                      id=\"email\"\n                      name=\"email\"\n                      type=\"email\"\n                      placeholder=\"Enter email address\"\n                      defaultValue={editingParty?.email || \"\"}\n                      className={formErrors.email ? \"border-red-500\" : \"\"}\n                    />\n                    {formErrors.email && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {formErrors.email}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"phone\">Phone Number</Label>\n                    <Input\n                      id=\"phone\"\n                      name=\"phone\"\n                      placeholder=\"Enter phone number\"\n                      defaultValue={editingParty?.phone || \"\"}\n                      className={formErrors.phone ? \"border-red-500\" : \"\"}\n                    />\n                    {formErrors.phone && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {formErrors.phone}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"contactPerson\">Contact Person</Label>\n                    <Input\n                      id=\"contactPerson\"\n                      name=\"contactPerson\"\n                      placeholder=\"Enter contact person name\"\n                      defaultValue={editingParty?.contactPerson || \"\"}\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"taxId\">Tax ID / VAT Number</Label>\n                    <Input\n                      id=\"taxId\"\n                      name=\"taxId\"\n                      placeholder=\"Enter tax ID or VAT number\"\n                      defaultValue={editingParty?.taxId || \"\"}\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"address\">Address</Label>\n                  <Textarea\n                    id=\"address\"\n                    name=\"address\"\n                    placeholder=\"Enter complete address\"\n                    defaultValue={editingParty?.address || \"\"}\n                    rows={3}\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"openingBalance\">Opening Balance</Label>\n                  <Input\n                    id=\"openingBalance\"\n                    name=\"openingBalance\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    placeholder=\"Enter opening balance (positive for debit, negative for credit)\"\n                    defaultValue={editingParty?.openingBalance || \"0\"}\n                    className={\n                      formErrors.openingBalance ? \"border-red-500\" : \"\"\n                    }\n                  />\n                  <p className=\"text-sm text-muted-foreground\">\n                    Positive values represent amounts owed to you (debit),\n                    negative values represent amounts you owe (credit)\n                  </p>\n                  {formErrors.openingBalance && (\n                    <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                      <AlertCircle className=\"h-4 w-4\" />\n                      {formErrors.openingBalance}\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"notes\">Notes</Label>\n                  <Textarea\n                    id=\"notes\"\n                    name=\"notes\"\n                    placeholder=\"Enter any additional notes\"\n                    defaultValue={editingParty?.notes || \"\"}\n                    rows={3}\n                  />\n                </div>\n\n                <div className=\"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setIsDialogOpen(false)}\n                    className=\"w-full sm:w-auto\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={\n                      createMutation.isPending || updateMutation.isPending\n                    }\n                    className=\"w-full sm:w-auto\"\n                  >\n                    {editingParty ? \"Update Party\" : \"Create Party\"}\n                  </Button>\n                </div>\n              </form>\n            </DialogContent>\n          </Dialog>\n        </PermissionWrapper>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n            <CardTitle>Parties List</CardTitle>\n            <div className=\"flex flex-col sm:flex-row gap-2 w-full sm:w-auto\">\n              <div className=\"w-full sm:w-64\">\n                <SearchBar\n                  placeholder=\"Search parties...\"\n                  value={searchQuery}\n                  onChange={setSearchQuery}\n                  className=\"w-full\"\n                />\n              </div>\n              <Select value={typeFilter} onValueChange={setTypeFilter}>\n                <SelectTrigger className=\"w-full sm:w-48\">\n                  <SelectValue placeholder=\"All Types\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Types</SelectItem>\n                  {partyTypes.map((type) => (\n                    <SelectItem key={type} value={type}>\n                      {type.charAt(0).toUpperCase() +\n                        type.slice(1).replace(\"_\", \" \")}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"name\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Party Details\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"type\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Type\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"email\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                      className=\"hidden sm:table-cell\"\n                    >\n                      Contact Info\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"currentBalance\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Account Balance\n                    </SortableTableHeader>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {paginatedParties && paginatedParties.length > 0 ? (\n                    paginatedParties.map((party: any) => {\n                    const balanceInfo = getBalanceBadge(party.currentBalance);\n                    return (\n                      <TableRow key={party.id}>\n                        <TableCell>\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center\">\n                              <Building className=\"h-4 w-4 text-primary\" />\n                            </div>\n                            <div>\n                              <div className=\"font-medium\">{party.name}</div>\n                              <div className=\"text-sm text-muted-foreground\">\n                                {party.contactPerson &&\n                                  `Contact: ${party.contactPerson}`}\n                              </div>\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={getTypeBadge(party.type)}>\n                            {party.type?.charAt(0).toUpperCase() +\n                              party.type?.slice(1).replace(\"_\", \" \")}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"hidden sm:table-cell\">\n                          <div className=\"text-sm\">\n                            {party.email && <div>{party.email}</div>}\n                            {party.phone && (\n                              <div className=\"text-muted-foreground\">\n                                {party.phone}\n                              </div>\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={balanceInfo.variant}>\n                            {balanceInfo.text}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex space-x-1\">\n                            <PermissionWrapper resource=\"parties\" action=\"read\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  setSelectedParty(party);\n                                  setIsLedgerDialogOpen(true);\n                                }}\n                                className=\"text-green-600 hover:text-green-800 focus:outline-none\"\n                                title=\"View\"\n                              >\n                                <Eye className=\"h-4 w-4\" />\n                              </Button>\n                            </PermissionWrapper>\n                            <PermissionWrapper\n                              resource=\"parties\"\n                              action=\"write\"\n                            >\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  setSelectedParty(party);\n                                  setIsTransactionDialogOpen(true);\n                                }}\n                                title=\"Add Transaction\"\n                              >\n                                <Plus className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  setEditingParty(party);\n                                  setSelectedType(party.type || \"\");\n                                  setFormErrors({});\n                                  setIsDialogOpen(true);\n                                }}\n                                className=\"text-blue-600 hover:text-blue-800 focus:outline-none\"\n                                title=\"Edit\"\n                              >\n                                <Edit className=\"h-4 w-4\" />\n                              </Button>\n                              <DeleteConfirmationDialog\n                                trigger={\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"text-red-600 hover:text-red-800 focus:outline-none\"\n                                    title=\"Delete\"\n                                  >\n                                    <Trash2 className=\"h-4 w-4\" />\n                                  </Button>\n                                }\n                                title=\"Delete Party\"\n                                itemName={party.name}\n                                onConfirm={() =>\n                                  deleteMutation.mutate(party.id)\n                                }\n                                isLoading={deleteMutation.isPending}\n                              />\n                            </PermissionWrapper>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                    })\n                  ) : (\n                    <TableRow>\n                      <TableCell colSpan={5} className=\"text-center py-12\">\n                        <div className=\"flex flex-col items-center justify-center\">\n                          <Building className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                          <h3 className=\"text-lg font-semibold mb-2\">No parties found</h3>\n                          <p className=\"text-muted-foreground mb-4\">\n                            {searchQuery || typeFilter !== \"all\"\n                              ? 'No parties match your search criteria.'\n                              : 'Start by adding your first party.'}\n                          </p>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n\n              {/* Pagination Controls */}\n              {filteredParties.length > 0 && (\n                <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 mt-4\">\n                  <PaginationInfo\n                    currentPage={currentPage}\n                    pageSize={pageSize}\n                    totalItems={totalItems}\n                  />\n                  <div className=\"flex items-center gap-4\">\n                    <PageSizeSelector\n                      pageSize={pageSize}\n                      onPageSizeChange={handlePageSizeChange}\n                    />\n                    <Pagination\n                      currentPage={currentPage}\n                      totalPages={totalPages}\n                      onPageChange={handlePageChange}\n                    />\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Transaction Dialog */}\n      <Dialog\n        open={isTransactionDialogOpen}\n        onOpenChange={(open) => {\n          setIsTransactionDialogOpen(open);\n          if (!open) {\n            setTransactionType(\"\");\n            setTransactionErrors({});\n          }\n        }}\n      >\n        <DialogContent className=\"max-w-2xl mx-auto max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Plus className=\"h-5 w-5\" />\n              Add Transaction for {selectedParty?.name}\n            </DialogTitle>\n            <DialogDescription className=\"text-base\">\n              Record a new transaction to track debits and credits for this\n              party\n            </DialogDescription>\n          </DialogHeader>\n\n          <form onSubmit={handleTransactionSave} className=\"space-y-6\">\n            {/* Transaction Type Section */}\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-lg\">Transaction Details</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label\n                      htmlFor=\"transactionType\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Transaction Type *\n                    </Label>\n                    <Select\n                      value={transactionType}\n                      onValueChange={setTransactionType}\n                      required\n                    >\n                      <SelectTrigger\n                        className={\n                          transactionErrors.transactionType\n                            ? \"border-red-500\"\n                            : \"\"\n                        }\n                      >\n                        <SelectValue placeholder=\"Select transaction type\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"purchase\">\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">Purchase</span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              We owe them (Debit)\n                            </span>\n                          </div>\n                        </SelectItem>\n                        <SelectItem value=\"payment_sent\">\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">Payment Sent</span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              We paid them (Credit)\n                            </span>\n                          </div>\n                        </SelectItem>\n                        <SelectItem value=\"adjustment_debit\">\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">\n                              Adjustment (Debit)\n                            </span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              Increase what they owe us\n                            </span>\n                          </div>\n                        </SelectItem>\n                        <SelectItem value=\"adjustment_credit\">\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">\n                              Adjustment (Credit)\n                            </span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              Decrease what they owe us\n                            </span>\n                          </div>\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                    {transactionErrors.transactionType && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {transactionErrors.transactionType}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label\n                      htmlFor=\"transactionDate\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Transaction Date *\n                    </Label>\n                    <Input\n                      id=\"transactionDate\"\n                      name=\"transactionDate\"\n                      type=\"date\"\n                      defaultValue={format(new Date(), \"yyyy-MM-dd\")}\n                      className={\n                        transactionErrors.transactionDate\n                          ? \"border-red-500\"\n                          : \"\"\n                      }\n                      required\n                    />\n                    {transactionErrors.transactionDate && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {transactionErrors.transactionDate}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\" className=\"text-sm font-medium\">\n                    Description *\n                  </Label>\n                  <Input\n                    id=\"description\"\n                    name=\"description\"\n                    placeholder=\"Enter detailed transaction description\"\n                    className={\n                      transactionErrors.description ? \"border-red-500\" : \"\"\n                    }\n                    required\n                  />\n                  {transactionErrors.description && (\n                    <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                      <AlertCircle className=\"h-4 w-4\" />\n                      {transactionErrors.description}\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Amount and Payment Section */}\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-lg\">Financial Details</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"amount\" className=\"text-sm font-medium\">\n                      Amount *\n                    </Label>\n                    <Input\n                      id=\"amount\"\n                      name=\"amount\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0.01\"\n                      placeholder=\"0.00\"\n                      className={\n                        transactionErrors.amount ? \"border-red-500\" : \"\"\n                      }\n                      required\n                    />\n                    {transactionErrors.amount && (\n                      <div className=\"flex items-center gap-1 text-sm text-red-600\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {transactionErrors.amount}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label\n                      htmlFor=\"paymentMethod\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Payment Method\n                    </Label>\n                    <Select name=\"paymentMethod\">\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select payment method\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"cash\">Cash</SelectItem>\n                        <SelectItem value=\"bank_transfer\">\n                          Bank Transfer\n                        </SelectItem>\n                        <SelectItem value=\"cheque\">Cheque</SelectItem>\n                        <SelectItem value=\"credit_card\">Credit Card</SelectItem>\n                        <SelectItem value=\"upi\">UPI</SelectItem>\n                        <SelectItem value=\"other\">Other</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label\n                    htmlFor=\"referenceNumber\"\n                    className=\"text-sm font-medium\"\n                  >\n                    Reference Number\n                  </Label>\n                  <Input\n                    id=\"referenceNumber\"\n                    name=\"referenceNumber\"\n                    placeholder=\"Invoice number, receipt number, etc. (optional)\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    Enter invoice number, receipt number, or any reference for\n                    this transaction\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Additional Information Section */}\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-lg\">\n                  Additional Information\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"notes\" className=\"text-sm font-medium\">\n                    Additional Notes\n                  </Label>\n                  <Textarea\n                    id=\"notes\"\n                    name=\"notes\"\n                    placeholder=\"Any additional notes, terms, or conditions (optional)\"\n                    rows={3}\n                    className=\"resize-none\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Account Impact Preview */}\n            {transactionType && (\n              <Card className=\"border-blue-200 bg-blue-50\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\n                    <span className=\"text-sm font-medium text-blue-900\">\n                      Account Impact\n                    </span>\n                  </div>\n                  <p className=\"text-sm text-blue-800\">\n                    {transactionType === \"purchase\" &&\n                      \"This will increase the amount owed to the party (Debit their account)\"}\n                    {transactionType === \"payment_sent\" &&\n                      \"This will decrease the amount owed to the party (Credit their account)\"}\n                    {transactionType === \"adjustment_debit\" &&\n                      \"This will increase the party's account balance (Debit adjustment)\"}\n                    {transactionType === \"adjustment_credit\" &&\n                      \"This will decrease the party's account balance (Credit adjustment)\"}\n                  </p>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Form Actions */}\n            <div className=\"flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => {\n                  setIsTransactionDialogOpen(false);\n                  setTransactionType(\"\");\n                  setTransactionErrors({});\n                }}\n                className=\"w-full sm:w-auto\"\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={transactionMutation.isPending || !transactionType}\n                className=\"w-full sm:w-auto\"\n              >\n                {transactionMutation.isPending ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                    Adding Transaction...\n                  </>\n                ) : (\n                  <>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Add Transaction\n                  </>\n                )}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Ledger View Dialog */}\n      <Dialog open={isLedgerDialogOpen} onOpenChange={setIsLedgerDialogOpen}>\n        <DialogContent className=\"max-w-6xl mx-auto max-h-[80vh]\">\n          <DialogHeader>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <DialogTitle>Party Ledger - {selectedParty?.name}</DialogTitle>\n                <DialogDescription>\n                  Complete transaction history with debit/credit tracking\n                </DialogDescription>\n              </div>\n              <Button variant=\"outline\" onClick={exportLedger}>\n                <Download className=\"h-4 w-4 mr-2\" />\n                Export CSV\n              </Button>\n            </div>\n          </DialogHeader>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm text-muted-foreground\">\n                  Total Debits\n                </div>\n                <div className=\"text-lg font-semibold text-red-600\">\n                  {formatCurrency(calculateTotals().totalDebit)}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm text-muted-foreground\">\n                  Total Credits\n                </div>\n                <div className=\"text-lg font-semibold text-green-600\">\n                  {formatCurrency(calculateTotals().totalCredit)}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm text-muted-foreground\">Net Balance</div>\n                <div\n                  className={`text-lg font-semibold ${\n                    parseFloat(selectedParty?.currentBalance || 0) >= 0\n                      ? \"text-red-600\"\n                      : \"text-green-600\"\n                  }`}\n                >\n                  {getBalanceBadge(selectedParty?.currentBalance).text}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"overflow-y-auto max-h-[50vh] border rounded-lg\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Reference</TableHead>\n                  <TableHead className=\"text-right\">Debit</TableHead>\n                  <TableHead className=\"text-right\">Credit</TableHead>\n                  <TableHead className=\"text-right\">Running Balance</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {ledgerTransactions.map((transaction: LedgerTransaction) => (\n                  <TableRow key={transaction.id}>\n                    <TableCell>\n                      {format(\n                        new Date(transaction.transactionDate),\n                        \"dd/MM/yyyy\",\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      <div>\n                        <div className=\"font-medium\">\n                          {transaction.description}\n                        </div>\n                        {transaction.notes && (\n                          <div className=\"text-sm text-muted-foreground\">\n                            {transaction.notes}\n                          </div>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell>{transaction.referenceNumber || \"-\"}</TableCell>\n                    <TableCell className=\"text-right\">\n                      {parseFloat(transaction.debitAmount) > 0 ? (\n                        <span className=\"text-red-600 font-medium\">\n                          {formatCurrency(parseFloat(transaction.debitAmount))}\n                        </span>\n                      ) : (\n                        \"-\"\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {parseFloat(transaction.creditAmount) > 0 ? (\n                        <span className=\"text-green-600 font-medium\">\n                          {formatCurrency(parseFloat(transaction.creditAmount))}\n                        </span>\n                      ) : (\n                        \"-\"\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right font-medium\">\n                      <span\n                        className={\n                          parseFloat(transaction.runningBalance) >= 0\n                            ? \"text-red-600\"\n                            : \"text-green-600\"\n                        }\n                      >\n                        {formatCurrency(\n                          Math.abs(parseFloat(transaction.runningBalance)),\n                        )}\n                        {parseFloat(transaction.runningBalance) >= 0\n                          ? \" Dr\"\n                          : \" Cr\"}\n                      </span>\n                    </TableCell>\n                  </TableRow>\n                ))}\n                {ledgerTransactions.length === 0 && (\n                  <TableRow>\n                    <TableCell\n                      colSpan={6}\n                      className=\"text-center py-8 text-muted-foreground\"\n                    >\n                      No transactions found. Click the \"+\" button to add the\n                      first transaction.\n                    </TableCell>\n                  </TableRow>\n                )}\n              </TableBody>\n            </Table>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","path":null,"size_bytes":59289,"size_tokens":null},"client/src/components/login-form.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCompanyBranding } from \"@/hooks/use-company-branding\";\nimport LoginFooter from \"@/components/login-footer\";\nimport Client_Logo from \"@/public/BakerSoftLogo.png\";\nimport { Eye, EyeOff } from \"lucide-react\";\n\ninterface LoginFormProps {\n  onSuccess: () => void;\n}\n\nexport default function LoginForm({ onSuccess }: LoginFormProps) {\n  const [isLoading, setIsLoading] = useState(false);\n  const [loginData, setLoginData] = useState({ email: \"\", password: \"\" });\n  const [showPassword, setShowPassword] = useState(false);\n  const { toast } = useToast();\n  const { branding } = useCompanyBranding();\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/login\", loginData);\n\n      if (response && response.user) {\n        toast({\n          title: \"Success\",\n          description: \"Logged in successfully\",\n        });\n        // Invalidate auth query to trigger re-fetch\n        await queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n        // Give a moment for the query to refetch\n        setTimeout(() => {\n          onSuccess();\n        }, 200);\n      } else {\n        throw new Error(\"No user data received\");\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Invalid credentials\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 via-gray-100 to-gray-200\">\n      <div className=\"w-full max-w-md space-y-8\">\n        <Card className=\"transition-all duration-300 hover:shadow-lg bg-white/95 backdrop-blur-sm border border-gray-200/50\">\n          <CardHeader>\n            <div className=\"flex items-center justify-center w-30 h-20 rounded-xl mx-auto\">\n              <img\n                src={Client_Logo}\n                alt=\"Mero BakerSoft Logo\"\n                className=\"h-30 w-30 object-contain rounded\"\n                loading=\"lazy\"\n              />\n            </div>\n            {/* <div className=\"text-center\">\n              <p className=\"text-sm text-gray-600\">\n                Professional Bakery Management System\n              </p>\n            </div> */}\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleLogin} className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"email\">Email</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={loginData.email}\n                  onChange={(e) =>\n                    setLoginData({ ...loginData, email: e.target.value })\n                  }\n                  required\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"password\">Password</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"password\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    value={loginData.password}\n                    onChange={(e) =>\n                      setLoginData({ ...loginData, password: e.target.value })\n                    }\n                    required\n                    className=\"pr-10\"\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\n                  >\n                    {showPassword ? (\n                      <EyeOff className=\"h-4 w-4\" />\n                    ) : (\n                      <Eye className=\"h-4 w-4\" />\n                    )}\n                  </button>\n                </div>\n              </div>\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-primary hover:bg-primary/90 text-primary-foreground transition-all duration-300 hover:scale-105 active:scale-95\"\n                disabled={isLoading}\n                style={{ backgroundColor: branding.themeColor }}\n              >\n                {isLoading ? \"Signing in...\" : \"Sign In\"}\n              </Button>\n            </form>\n            <LoginFooter />\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4789,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/pages/expire-products.tsx":{"content":"\"use client\";\n\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { LoadingSpinner } from \"@/components/ui/loading-spinner\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { format } from \"date-fns\";\n\ninterface ExpiredProduct {\n  id: number;\n  serialNumber: number;\n  productId: number;\n  productName: string;\n  quantity: number;\n  unitId: number;\n  unitName: string;\n  ratePerUnit: number;\n  amount: number;\n  expiryDate: string;\n  isDayClosed: boolean;\n  notes?: string;\n  createdAt: string;\n}\n\ninterface DailyExpirySummary {\n  summaryDate: string;\n  totalItems: number;\n  totalQuantity: number;\n  totalLoss: number;\n  isDayClosed: boolean;\n  closedBy?: string;\n  closedAt?: string;\n}\n\nexport default function ExpireProducts() {\n  const [selectedDate, setSelectedDate] = useState(\n    format(new Date(), \"yyyy-MM-dd\"),\n  );\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingProduct, setEditingProduct] = useState<ExpiredProduct | null>(\n    null,\n  );\n  const [formData, setFormData] = useState({\n    productId: \"\",\n    quantity: \"\",\n    unitId: \"\",\n    ratePerUnit: \"\",\n    notes: \"\",\n  });\n\n  const { toast } = useToast();\n  const { formatCurrency } = useCurrency();\n  const queryClient = useQueryClient();\n\n  // Fetch products\n  const { data: products = [], isLoading: productsLoading } = useQuery({\n    queryKey: [\"products\"],\n    queryFn: async () => {\n      try {\n        const res = await apiRequest(\"GET\", \"/api/products\");\n        return Array.isArray(res) ? res : res.products || [];\n      } catch (error) {\n        console.error(\"Failed to fetch products:\", error);\n        return [];\n      }\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Fetch units (only packet and kg) using the shared hook\n  const { data: allUnits = [], isLoading: unitsLoading } = useUnits();\n  \n  // Filter for weight units (kg, grams) and packet units\n  const units = useMemo(() => {\n    console.log(\"Filtering units from:\", allUnits);\n    const filtered = allUnits.filter(\n      (unit: any) =>\n        unit.name?.toLowerCase().includes(\"packet\") ||\n        unit.name?.toLowerCase().includes(\"kilogram\") ||\n        unit.name?.toLowerCase().includes(\"gram\") ||\n        unit.abbreviation?.toLowerCase() === \"kg\" ||\n        unit.abbreviation?.toLowerCase() === \"g\" ||\n        unit.abbreviation?.toLowerCase() === \"pkt\" ||\n        unit.abbreviation?.toLowerCase() === \"packet\" ||\n        unit.type === \"weight\" ||\n        unit.type === \"count\"\n    );\n    console.log(\"Filtered units:\", filtered);\n    return filtered;\n  }, [allUnits]);\n\n  // Fetch expired products for selected date\n  const { data: expiredProducts = [], isLoading: expiredProductsLoading } =\n    useQuery({\n      queryKey: [\"expire-products\", selectedDate],\n      queryFn: async () => {\n        try {\n          const res = await apiRequest(\n            \"GET\",\n            `/api/expire-products?date=${selectedDate}`,\n          );\n          return res?.data || [];\n        } catch (error) {\n          console.error(\"Failed to fetch expired products:\", error);\n          return [];\n        }\n      },\n      retry: (failureCount, error) =>\n        !isUnauthorizedError(error) && failureCount < 3,\n    });\n\n  // Fetch daily summary\n  const { data: dailySummary } = useQuery({\n    queryKey: [\"expire-products-summary\", selectedDate],\n    queryFn: async () => {\n      try {\n        const res = await apiRequest(\n          \"GET\",\n          `/api/expire-products/summary/${selectedDate}`,\n        );\n        return res?.data || null;\n      } catch (error) {\n        console.error(\"Failed to fetch daily summary:\", error);\n        return null;\n      }\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Define helper functions first\n  const handleSuccess = (msg: string) => {\n    setIsDialogOpen(false);\n    resetForm();\n    queryClient.invalidateQueries({ queryKey: [\"expire-products\"] });\n    queryClient.invalidateQueries({ queryKey: [\"expire-products-summary\"] });\n    toast({ title: \"Success\", description: msg });\n  };\n\n  const handleError = (\n    error: unknown,\n    variables: any,\n    context: unknown,\n  ) => {\n    console.error(\"Mutation error:\", error);\n\n    let message = \"Failed to process request.\";\n\n    // Safely extract message\n    if (error && typeof error === \"object\") {\n      const err = error as Record<string, any>;\n      if (err.response?.data?.message) {\n        message = err.response.data.message;\n      } else if (err.message) {\n        message = err.message;\n      }\n    }\n\n    if (isUnauthorizedError(error)) {\n      toast({\n        title: \"Session Expired\",\n        description: \"Redirecting to login...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => (window.location.href = \"/login\"), 1000);\n      return;\n    }\n\n    toast({\n      title: \"Error\",\n      description: message,\n      variant: \"destructive\",\n    });\n  };\n\n  // Create mutation\n  const createMutation = useMutation({\n    mutationFn: (data: any) => apiRequest(\"POST\", \"/api/expire-products\", data),\n    onSuccess: () => {\n      handleSuccess(\"Expired product entry created successfully\");\n    },\n    onError: handleError,\n  });\n\n  // Update mutation\n  const updateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) =>\n      apiRequest(\"PUT\", `/api/expire-products/${id}`, data),\n    onSuccess: () => {\n      handleSuccess(\"Expired product entry updated successfully\");\n    },\n    onError: handleError,\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) =>\n      apiRequest(\"DELETE\", `/api/expire-products/${id}`),\n    onSuccess: () => {\n      handleSuccess(\"Expired product entry deleted successfully\");\n    },\n    onError: handleError,\n  });\n\n  // Close day mutation\n  const closeDayMutation = useMutation({\n    mutationFn: (date: string) =>\n      apiRequest(\"POST\", \"/api/expire-products/close-day\", { date }),\n    onSuccess: () => {\n      handleSuccess(\"Day closed successfully.\");\n    },\n    onError: handleError,\n  });\n\n  // Reopen day mutation\n  const reopenDayMutation = useMutation({\n    mutationFn: (date: string) =>\n      apiRequest(\"POST\", \"/api/expire-products/reopen-day\", { date }),\n    onSuccess: () => {\n      handleSuccess(\"Day reopened successfully.\");\n    },\n    onError: handleError,\n  });\n\n  const isDayClosed = dailySummary?.isDayClosed || false;\n  const canModify = !isDayClosed;\n\n  // Calculate amount\n  const calculatedAmount = useMemo(() => {\n    const qty = parseFloat(formData.quantity) || 0;\n    const rate = parseFloat(formData.ratePerUnit) || 0;\n    return qty * rate;\n  }, [formData.quantity, formData.ratePerUnit]);\n\n  const resetForm = () => {\n    setFormData({\n      productId: \"\",\n      quantity: \"\",\n      unitId: \"\",\n      ratePerUnit: \"\",\n      notes: \"\",\n    });\n    setEditingProduct(null);\n  };\n\n  const handleEdit = (product: ExpiredProduct) => {\n    setEditingProduct(product);\n    setFormData({\n      productId: product.productId.toString(),\n      quantity: product.quantity.toString(),\n      unitId: product.unitId.toString(),\n      ratePerUnit: product.ratePerUnit.toString(),\n      notes: product.notes || \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (\n      !formData.productId ||\n      !formData.quantity ||\n      !formData.unitId ||\n      !formData.ratePerUnit\n    ) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fill all required fields.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const selectedProduct = products.find(\n      (p) => p.id.toString() === formData.productId,\n    );\n    const selectedUnit = units.find((u) => u.id.toString() === formData.unitId);\n\n    if (!selectedProduct || !selectedUnit) {\n      toast({\n        title: \"Invalid Selection\",\n        description: \"Please select valid product and unit.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const payload = {\n      productId: parseInt(formData.productId),\n      productName: selectedProduct.name,\n      quantity: parseFloat(formData.quantity),\n      unitId: parseInt(formData.unitId),\n      unitName: selectedUnit.name,\n      ratePerUnit: parseFloat(formData.ratePerUnit),\n      expiryDate: selectedDate,\n      notes: formData.notes,\n    };\n\n    if (editingProduct) {\n      updateMutation.mutate({ id: editingProduct.id, data: payload });\n    } else {\n      createMutation.mutate(payload);\n    }\n  };\n\n  const handleDelete = (id: number) => {\n    deleteMutation.mutate(id);\n  };\n  return (\n    <div className=\"p-6 space-y-6 max-w-7xl mx-auto\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold flex items-center gap-2 text-gray-800\">\n            üì¶ Expire Products\n          </h1>\n          <p className=\"text-gray-600 mt-1\">\n            {format(new Date(selectedDate), \"EEEE, MMMM do, yyyy\")}\n          </p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <Input\n            type=\"date\"\n            value={selectedDate}\n            onChange={(e) => setSelectedDate(e.target.value)}\n            className=\"w-auto border-gray-300\"\n          />\n          {canModify && (\n            <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n              <DialogTrigger asChild>\n                <Button\n                  onClick={() => {\n                    resetForm();\n                  }}\n                  className=\"bg-red-600 hover:bg-red-700 text-white\"\n                >\n                  + Add Expired Product\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-2xl\">\n                <DialogHeader>\n                  <DialogTitle>\n                    {editingProduct ? \"Edit\" : \"Add\"} Expired Product\n                  </DialogTitle>\n                </DialogHeader>\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <Label>Product *</Label>\n                      <Select\n                        value={formData.productId}\n                        onValueChange={(val) =>\n                          setFormData((prev) => ({ ...prev, productId: val }))\n                        }\n                        disabled={productsLoading}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select product\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {products.map((p) => (\n                            <SelectItem key={p.id} value={p.id.toString()}>\n                              {p.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label>Unit *</Label>\n                      <Select\n                        value={formData.unitId}\n                        onValueChange={(val) =>\n                          setFormData((prev) => ({ ...prev, unitId: val }))\n                        }\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select unit\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {units.map((u) => (\n                            <SelectItem key={u.id} value={u.id.toString()}>\n                              {u.name} ({u.abbreviation})\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label>Quantity *</Label>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        min=\"0\"\n                        value={formData.quantity}\n                        onChange={(e) =>\n                          setFormData((prev) => ({\n                            ...prev,\n                            quantity: e.target.value,\n                          }))\n                        }\n                        required\n                      />\n                    </div>\n\n                    <div>\n                      <Label>Rate per Unit *</Label>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        min=\"0\"\n                        value={formData.ratePerUnit}\n                        onChange={(e) =>\n                          setFormData((prev) => ({\n                            ...prev,\n                            ratePerUnit: e.target.value,\n                          }))\n                        }\n                        required\n                      />\n                    </div>\n                  </div>\n\n                  <div>\n                    <Label>Calculated Amount</Label>\n                    <div className=\"p-3 bg-red-50 rounded-lg border border-red-200\">\n                      <span className=\"text-lg font-semibold text-red-700\">\n                        {formatCurrency(calculatedAmount)}\n                      </span>\n                    </div>\n                  </div>\n\n                  <div>\n                    <Label>Notes</Label>\n                    <Textarea\n                      value={formData.notes}\n                      onChange={(e) =>\n                        setFormData((prev) => ({\n                          ...prev,\n                          notes: e.target.value,\n                        }))\n                      }\n                      rows={3}\n                      placeholder=\"Optional details...\"\n                    />\n                  </div>\n\n                  <div className=\"flex justify-end gap-2 pt-4\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => setIsDialogOpen(false)}\n                    >\n                      Cancel\n                    </Button>\n                    <Button\n                      type=\"submit\"\n                      disabled={\n                        createMutation.isPending || updateMutation.isPending\n                      }\n                    >\n                      {createMutation.isPending || updateMutation.isPending\n                        ? \"Saving...\"\n                        : \"Save\"}\n                    </Button>\n                  </div>\n                </form>\n              </DialogContent>\n            </Dialog>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total Items</p>\n                <p className=\"text-xl font-bold\">\n                  {dailySummary?.totalItems || 0}\n                </p>\n              </div>\n              <svg\n                className=\"w-8 h-8 text-blue-500\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth=\"2\"\n                  d=\"M20 7l-8-4-8 4m16 0v10l-8 4-8-4V7\"\n                />\n              </svg>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total Quantity</p>\n                <p className=\"text-xl font-bold\">\n                  {dailySummary?.totalQuantity || 0}\n                </p>\n              </div>\n              <svg\n                className=\"w-8 h-8 text-orange-500\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth=\"2\"\n                  d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"\n                />\n              </svg>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total Loss</p>\n                <p className=\"text-xl font-bold text-red-600\">\n                  {formatCurrency(dailySummary?.totalLoss || 0)}\n                </p>\n              </div>\n              <svg\n                className=\"w-8 h-8 text-red-500\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth=\"2\"\n                  d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\"\n                />\n              </svg>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Status</p>\n                <Badge variant={isDayClosed ? \"destructive\" : \"default\"}>\n                  {isDayClosed ? \"Closed\" : \"Open\"}\n                </Badge>\n              </div>\n              {isDayClosed ? (\n                <svg\n                  className=\"w-8 h-8 text-red-500\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth=\"2\"\n                    d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"\n                  />\n                </svg>\n              ) : (\n                <svg\n                  className=\"w-8 h-8 text-green-500\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth=\"2\"\n                    d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"\n                  />\n                </svg>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Day Management */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"font-semibold\">Day Status</h3>\n              <p className=\"text-sm text-gray-600\">\n                {isDayClosed\n                  ? \"This day is closed. No new entries allowed.\"\n                  : \"You can add or edit expired products.\"}\n              </p>\n            </div>\n            <div className=\"flex gap-2\">\n              {!isDayClosed ? (\n                <AlertDialog>\n                  <AlertDialogTrigger asChild>\n                    <Button\n                      variant=\"destructive\"\n                      disabled={expiredProducts.length === 0}\n                    >\n                      üîí Close Day\n                    </Button>\n                  </AlertDialogTrigger>\n                  <AlertDialogContent>\n                    <AlertDialogHeader>\n                      <AlertDialogTitle>Close Day?</AlertDialogTitle>\n                      <AlertDialogDescription>\n                        Are you sure you want to close this day? You won't be\n                        able to add more entries unless reopened.\n                        <br />\n                        <strong>\n                          Total Loss:{\" \"}\n                          {formatCurrency(dailySummary?.totalLoss || 0)}\n                        </strong>\n                      </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                      <AlertDialogCancel>Cancel</AlertDialogCancel>\n                      <AlertDialogAction\n                        onClick={() => closeDayMutation.mutate(selectedDate)}\n                      >\n                        {closeDayMutation.isPending\n                          ? \"Closing...\"\n                          : \"Yes, Close\"}\n                      </AlertDialogAction>\n                    </AlertDialogFooter>\n                  </AlertDialogContent>\n                </AlertDialog>\n              ) : (\n                <AlertDialog>\n                  <AlertDialogTrigger asChild>\n                    <Button variant=\"outline\">üîì Reopen Day</Button>\n                  </AlertDialogTrigger>\n                  <AlertDialogContent>\n                    <AlertDialogHeader>\n                      <AlertDialogTitle>Reopen Day?</AlertDialogTitle>\n                      <AlertDialogDescription>\n                        This will allow adding or editing expired product\n                        entries again.\n                      </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                      <AlertDialogCancel>Cancel</AlertDialogCancel>\n                      <AlertDialogAction\n                        onClick={() => reopenDayMutation.mutate(selectedDate)}\n                      >\n                        {reopenDayMutation.isPending\n                          ? \"Reopening...\"\n                          : \"Yes, Reopen\"}\n                      </AlertDialogAction>\n                    </AlertDialogFooter>\n                  </AlertDialogContent>\n                </AlertDialog>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Expired Products Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>\n            Expired Products{\" \"}\n            <Badge variant=\"secondary\">{expiredProducts.length} items</Badge>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {expiredProductsLoading ? (\n            <LoadingSpinner message=\"Loading...\" />\n          ) : expiredProducts.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500\">\n              No expired products recorded.\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>S.N</TableHead>\n                  <TableHead>Product</TableHead>\n                  <TableHead className=\"text-right\">Qty</TableHead>\n                  <TableHead>Unit</TableHead>\n                  <TableHead className=\"text-right\">Rate</TableHead>\n                  <TableHead className=\"text-right\">Amount</TableHead>\n                  <TableHead>Notes</TableHead>\n                  {canModify && <TableHead>Actions</TableHead>}\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {expiredProducts.map((item) => (\n                  <TableRow key={item.id}>\n                    <TableCell>{item.serialNumber}</TableCell>\n                    <TableCell className=\"font-medium\">\n                      {item.productName}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {item.quantity}\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant=\"outline\">{item.unitName}</Badge>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.ratePerUnit)}\n                    </TableCell>\n                    <TableCell className=\"text-right font-medium text-red-600\">\n                      {formatCurrency(item.amount)}\n                    </TableCell>\n                    <TableCell>{item.notes || \"‚Äî\"}</TableCell>\n                    {canModify && (\n                      <TableCell>\n                        <div className=\"flex gap-2\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => handleEdit(item)}\n                          >\n                            ‚úèÔ∏è\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => handleDelete(item.id)}\n                            disabled={deleteMutation.isPending}\n                          >\n                            üóëÔ∏è\n                          </Button>\n                        </div>\n                      </TableCell>\n                    )}\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","path":null,"size_bytes":26892,"size_tokens":null},"server/lib/unitConversion.ts":{"content":"import { storage } from \"./storage\";\n\n/**\n * Unit conversion utility for cost calculations\n */\nexport class UnitConversionCalculator {\n  private static instance: UnitConversionCalculator;\n  private conversions: any[] = [];\n  private units: any[] = [];\n\n  private constructor() {}\n\n  public static getInstance(): UnitConversionCalculator {\n    if (!UnitConversionCalculator.instance) {\n      UnitConversionCalculator.instance = new UnitConversionCalculator();\n    }\n    return UnitConversionCalculator.instance;\n  }\n\n  /**\n   * Load conversion data from database\n   */\n  async loadConversions(): Promise<void> {\n    try {\n      this.conversions = await storage.getUnitConversions();\n      this.units = await storage.getUnits();\n    } catch (error) {\n      console.error(\"Error loading unit conversions:\", error);\n    }\n  }\n\n  /**\n   * Convert quantity from one unit to another\n   */\n  async convertQuantity(\n    fromQuantity: number,\n    fromUnitId: number,\n    toUnitId: number\n  ): Promise<number> {\n    // If same unit, return original quantity\n    if (fromUnitId === toUnitId) {\n      return fromQuantity;\n    }\n\n    await this.loadConversions();\n\n    // Find direct conversion\n    const directConversion = this.conversions.find(\n      (c: any) => c.fromUnitId === fromUnitId && c.toUnitId === toUnitId && c.isActive\n    );\n\n    if (directConversion) {\n      return fromQuantity * parseFloat(directConversion.conversionFactor);\n    }\n\n    // Find reverse conversion\n    const reverseConversion = this.conversions.find(\n      (c: any) => c.fromUnitId === toUnitId && c.toUnitId === fromUnitId && c.isActive\n    );\n\n    if (reverseConversion) {\n      return fromQuantity / parseFloat(reverseConversion.conversionFactor);\n    }\n\n    // Try to find conversion through base units\n    const fromUnit = this.units.find((u: any) => u.id === fromUnitId);\n    const toUnit = this.units.find((u: any) => u.id === toUnitId);\n\n    if (fromUnit && toUnit && fromUnit.baseUnit && toUnit.baseUnit && fromUnit.baseUnit === toUnit.baseUnit) {\n      // Convert from source unit to base unit\n      const fromConversionFactor = parseFloat(fromUnit.conversionFactor) || 1;\n      const toConversionFactor = parseFloat(toUnit.conversionFactor) || 1;\n      \n      // Convert to base unit first, then to target unit\n      const baseQuantity = fromQuantity * fromConversionFactor;\n      return baseQuantity / toConversionFactor;\n    }\n\n    throw new Error(`No conversion found from unit ${fromUnitId} to unit ${toUnitId}`);\n  }\n\n  /**\n   * Calculate product cost based on ingredients with unit conversions\n   */\n  async calculateProductCost(productId: number): Promise<{\n    totalCost: number;\n    ingredientCosts: Array<{\n      ingredientId: number;\n      ingredientName: string;\n      quantity: number;\n      unit: string;\n      costPerUnit: number;\n      totalCost: number;\n      conversionUsed?: boolean;\n    }>;\n  }> {\n    const ingredients = await storage.getProductIngredients(productId);\n    const inventoryItems = await storage.getInventoryItems();\n    \n    let totalCost = 0;\n    const ingredientCosts: any[] = [];\n\n    for (const ingredient of ingredients) {\n      const inventoryItem = inventoryItems.find((item: any) => item.id === ingredient.inventoryItemId);\n      \n      if (!inventoryItem) {\n        console.warn(`Inventory item not found for ingredient ${ingredient.id}`);\n        continue;\n      }\n\n      const requiredQuantity = parseFloat(ingredient.quantity);\n      const ingredientUnit = ingredient.unit;\n      const inventoryUnit = inventoryItem.unit;\n      const costPerUnit = parseFloat(inventoryItem.costPerUnit);\n\n      let convertedQuantity = requiredQuantity;\n      let conversionUsed = false;\n\n      // If units are different, try to convert\n      if (ingredientUnit !== inventoryUnit) {\n        try {\n          // Find unit IDs\n          const ingredientUnitData = this.units.find((u: any) => u.name === ingredientUnit || u.abbreviation === ingredientUnit);\n          const inventoryUnitData = this.units.find((u: any) => u.name === inventoryUnit || u.abbreviation === inventoryUnit);\n\n          if (ingredientUnitData && inventoryUnitData) {\n            convertedQuantity = await this.convertQuantity(\n              requiredQuantity,\n              ingredientUnitData.id,\n              inventoryUnitData.id\n            );\n            conversionUsed = true;\n          } else {\n            console.warn(`Could not find unit data for conversion from ${ingredientUnit} to ${inventoryUnit}`);\n          }\n        } catch (error) {\n          console.warn(`Unit conversion failed for ${ingredientUnit} to ${inventoryUnit}:`, error);\n        }\n      }\n\n      const ingredientCost = convertedQuantity * costPerUnit;\n      totalCost += ingredientCost;\n\n      ingredientCosts.push({\n        ingredientId: ingredient.id,\n        ingredientName: inventoryItem.name,\n        quantity: convertedQuantity,\n        unit: inventoryUnit,\n        costPerUnit: costPerUnit,\n        totalCost: ingredientCost,\n        conversionUsed\n      });\n    }\n\n    return {\n      totalCost,\n      ingredientCosts\n    };\n  }\n\n  /**\n   * Update product cost automatically based on ingredient costs\n   */\n  async updateProductCost(productId: number): Promise<void> {\n    try {\n      const costCalculation = await this.calculateProductCost(productId);\n      \n      // Update product cost in database\n      await storage.updateProduct(productId, {\n        cost: costCalculation.totalCost.toString()\n      });\n\n      console.log(`Updated product ${productId} cost to ${costCalculation.totalCost}`);\n    } catch (error) {\n      console.error(`Failed to update product ${productId} cost:`, error);\n    }\n  }\n\n  /**\n   * Get available conversions for a unit\n   */\n  async getAvailableConversions(unitId: number): Promise<any[]> {\n    await this.loadConversions();\n    \n    return this.conversions.filter(\n      (c: any) => (c.fromUnitId === unitId || c.toUnitId === unitId) && c.isActive\n    );\n  }\n}\n\nexport const unitConverter = UnitConversionCalculator.getInstance();","path":null,"size_bytes":6036,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"server/db.ts":{"content":"import { Pool } from 'pg';\nimport dotenv from 'dotenv';\ndotenv.config();\nimport { drizzle } from 'drizzle-orm/node-postgres';\nimport * as schema from \"@shared/schema\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL must be set.\");\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });","path":null,"size_bytes":375,"size_tokens":null},"client/src/pages/inventory.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport SearchBar from \"@/components/search-bar\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Plus,\n  Search,\n  Edit,\n  Trash2,\n  Package,\n  AlertTriangle,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\nimport { EnhancedStockItemForm } from \"@/components/enhanced-stock-item-form\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n  usePagination,\n} from \"@/components/ui/pagination\";\n\nexport default function Inventory() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingItem, setEditingItem] = useState<any>(null);\n  const { toast } = useToast();\n  const { formatCurrency, symbol } = useCurrency();\n\n  const {\n    data: items = [],\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: [\"/api/inventory\"],\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/inventory/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n      toast({\n        title: \"Success\",\n        description: \"Stock item deleted successfully\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete stock item\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredItems = (items as any[]).filter(\n    (item: any) =>\n      item.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      item.supplier?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      item.categoryName?.toLowerCase().includes(searchQuery.toLowerCase()),\n  );\n\n  // Add pagination\n  const {\n    currentItems: paginatedItems,\n    currentPage,\n    pageSize,\n    totalPages,\n    totalItems,\n    goToPage: handlePageChange,\n    setPageSize: handlePageSizeChange,\n  } = usePagination(filteredItems, 10);\n\n  const getStockBadge = (item: any) => {\n    const currentStock = parseFloat(item.currentStock || 0);\n    const minLevel = parseFloat(item.minLevel || 0);\n\n    if (currentStock <= minLevel) {\n      return { variant: \"destructive\" as const, text: \"Low Stock\" };\n    } else if (currentStock <= minLevel * 1.5) {\n      return { variant: \"secondary\" as const, text: \"Warning\" };\n    }\n    return { variant: \"default\" as const, text: \"In Stock\" };\n  };\n\n  if (error && isUnauthorizedError(error)) {\n    toast({\n      title: \"Unauthorized\",\n      description: \"You are logged out. Logging in again...\",\n      variant: \"destructive\",\n    });\n    setTimeout(() => {\n      window.location.href = \"/api/login\";\n    }, 500);\n    return null;\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-1\">Inventory Management</h1>\n          <p className=\"text-gray-600\">\n            Track your ingredients and raw materials\n          </p>\n        </div>\n        <Button\n          onClick={() => {\n            setEditingItem(null);\n            setIsDialogOpen(true);\n          }}\n          className=\"w-full sm:w-auto\"\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Item\n        </Button>\n      </div>\n\n      <div className=\"flex items-center space-x-2\">\n        <div className=\"flex-1\">\n          <SearchBar\n            placeholder=\"Search items...\"\n            value={searchQuery}\n            onChange={setSearchQuery}\n          />\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Package className=\"h-5 w-5 mr-2\" />\n            Stock Items\n          </CardTitle>\n          <CardDescription>\n            Manage your inventory items and stock levels\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto\"></div>\n              <p className=\"text-muted-foreground mt-2\">\n                Loading stock items...\n              </p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Item</TableHead>\n                    <TableHead>Category</TableHead>\n                    <TableHead>Stock</TableHead>\n                    <TableHead className=\"hidden md:table-cell\">\n                      Cost/Unit\n                    </TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {paginatedItems.map((item: any) => {\n                    const stockInfo = getStockBadge(item);\n                    return (\n                      <TableRow key={item.id}>\n                        <TableCell>\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center\">\n                              <Package className=\"h-4 w-4 text-primary\" />\n                            </div>\n                            <div>\n                              <div className=\"font-medium\">{item.name}</div>\n                              <div className=\"text-sm text-muted-foreground\">\n                                {item.supplier || \"No supplier\"}\n                                {item.company && (\n                                  <span className=\"block\">{item.company}</span>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <span className=\"text-sm text-muted-foreground\">\n                            {item.categoryName || \"No category\"}\n                          </span>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"font-medium\">\n                            {parseFloat(item.currentStock || 0).toFixed(2)}{\" \"}\n                            {item.unitAbbreviation || item.unit || \"units\"}\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            Min: {parseFloat(item.minLevel || 0).toFixed(2)}{\" \"}\n                            {item.unitAbbreviation || item.unit || \"units\"}\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"hidden md:table-cell\">\n                          {formatCurrency(parseFloat(item.costPerUnit || 0))}\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={stockInfo.variant}>\n                            {stockInfo.text}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center space-x-2\">\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => {\n                                setEditingItem(item);\n                                setIsDialogOpen(true);\n                              }}\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <DeleteConfirmationDialog\n                              trigger={\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                >\n                                  <Trash2 className=\"h-4 w-4\" />\n                                </Button>\n                              }\n                              title=\"Delete Stock Item\"\n                              itemName={item.name}\n                              onConfirm={() => deleteMutation.mutate(item.id)}\n                              isLoading={deleteMutation.isPending}\n                            />\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n              {filteredItems.length === 0 && (\n                <div className=\"text-center py-8\">\n                  <Package className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold text-muted-foreground mb-2\">\n                    No stock items found\n                  </h3>\n                  <p className=\"text-muted-foreground mb-4\">\n                    {searchQuery\n                      ? \"Try adjusting your search criteria\"\n                      : \"Start by adding your first stock item\"}\n                  </p>\n                  <Button onClick={() => setIsDialogOpen(true)}>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Add Item\n                  </Button>\n                </div>\n              )}\n\n              {/* Pagination Controls */}\n              {filteredItems.length > 0 && (\n                <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 mt-4\">\n                  <PaginationInfo\n                    currentPage={currentPage}\n                    pageSize={pageSize}\n                    totalItems={totalItems}\n                  />\n                  <div className=\"flex items-center gap-4\">\n                    <PageSizeSelector\n                      pageSize={pageSize}\n                      onPageSizeChange={handlePageSizeChange}\n                    />\n                    <Pagination\n                      currentPage={currentPage}\n                      totalPages={totalPages}\n                      onPageChange={handlePageChange}\n                    />\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <EnhancedStockItemForm\n        isOpen={isDialogOpen}\n        onClose={() => {\n          setIsDialogOpen(false);\n          setEditingItem(null);\n        }}\n        editingItem={editingItem}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":11596,"size_tokens":null},"client/src/pages/reports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport {\n  FileText,\n  TrendingUp,\n  ShoppingCart,\n  Banknote,\n  Settings,\n  Download,\n  HelpCircle,\n  BookOpen,\n} from \"lucide-react\";\n\nexport default function Reports() {\n  const [timeRange, setTimeRange] = useState(\"30\");\n  const { toast } = useToast();\n  const { formatCurrency } = useCurrency();\n\n  const startDate = new Date();\n  startDate.setDate(startDate.getDate() - parseInt(timeRange));\n\n  const {\n    data: analytics,\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: [\n      \"/api/analytics/sales\",\n      { startDate: startDate.toISOString(), endDate: new Date().toISOString() },\n    ],\n  });\n\n  const { data: stats } = useQuery({\n    queryKey: [\"/api/dashboard/stats\"],\n  });\n\n  if (error && isUnauthorizedError(error)) {\n    toast({\n      title: \"Unauthorized\",\n      description: \"You are logged out. Logging in again...\",\n      variant: \"destructive\",\n    });\n    setTimeout(() => {\n      window.location.href = \"/api/login\";\n    }, 500);\n    return null;\n  }\n\n  const exportReport = (reportType: string) => {\n    toast({\n      title: \"Export Started\",\n      description: `${reportType} report is being generated and will download shortly.`,\n    });\n    // In a real implementation, this would trigger a download\n  };\n\n  const generateReport = (reportType: string) => {\n    toast({\n      title: \"Report Generated\",\n      description: `${reportType} has been generated successfully.`,\n    });\n    // In a real implementation, this would generate the specific report\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"animate-pulse space-y-6\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/4\"></div>\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            {[1, 2, 3, 4, 5, 6].map((i) => (\n              <div key={i} className=\"h-64 bg-gray-200 rounded-lg\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-gray-600\">\n            Comprehensive business reports and analytics\n          </p>\n        </div>\n        <div className=\"flex space-x-3\">\n          <Button variant=\"outline\" className=\"flex items-center gap-2\">\n            <HelpCircle className=\"h-4 w-4\" />\n            Need Help?\n          </Button>\n          <Button variant=\"outline\" className=\"flex items-center gap-2\">\n            <BookOpen className=\"h-4 w-4\" />\n            Learn more\n          </Button>\n        </div>\n      </div>\n\n      {/* Report Sections */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Accounting Reports */}\n        <Card className=\"border-red-200 bg-red-50\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"flex items-center gap-2 text-red-800\">\n              <div className=\"w-8 h-8 bg-red-200 rounded-full flex items-center justify-center\">\n                <FileText className=\"h-4 w-4 text-red-600\" />\n              </div>\n              Accounting\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Transaction List\")}\n            >\n              Transaction List\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Day Book\")}\n            >\n              Day Book\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Account Summary\")}\n            >\n              Account Summary\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Trial Balance\")}\n            >\n              Trial Balance\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Income Statement\")}\n            >\n              Income Statement\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Balance Sheet\")}\n            >\n              Balance Sheet\n            </Button>\n          </CardContent>\n        </Card>\n\n        {/* Tax Report (For Nepal) */}\n        <Card className=\"border-red-200 bg-red-50\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"flex items-center gap-2 text-red-800\">\n              <div className=\"w-8 h-8 bg-red-200 rounded-full flex items-center justify-center\">\n                <Banknote className=\"h-4 w-4 text-red-600\" />\n              </div>\n              Tax Report (For Nepal)\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Sales Register\")}\n            >\n              Sales Register\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Sales Return Register\")}\n            >\n              Sales Return Register\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Purchase Register\")}\n            >\n              Purchase Register\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Purchase Return Register\")}\n            >\n              Purchase Return Register\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"VAT Summary Report\")}\n            >\n              VAT Summary Report\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Annex 13 Report\")}\n            >\n              Annex 13 Report\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Annex 5 Materialized View Report\")}\n            >\n              Annex 5 Materialized View Report\n            </Button>\n          </CardContent>\n        </Card>\n\n        {/* Purchase Report */}\n        <Card className=\"border-red-200 bg-red-50\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"flex items-center gap-2 text-red-800\">\n              <div className=\"w-8 h-8 bg-red-200 rounded-full flex items-center justify-center\">\n                <ShoppingCart className=\"h-4 w-4 text-red-600\" />\n              </div>\n              Purchase Report\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Purchase VAT Reconciliation\")}\n            >\n              Purchase VAT Reconciliation\n            </Button>\n          </CardContent>\n        </Card>\n\n        {/* Sales Report */}\n        <Card className=\"border-red-200 bg-red-50\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"flex items-center gap-2 text-red-800\">\n              <div className=\"w-8 h-8 bg-red-200 rounded-full flex items-center justify-center\">\n                <TrendingUp className=\"h-4 w-4 text-red-600\" />\n              </div>\n              Sales Report\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Sales Master Report\")}\n            >\n              Sales Master Report\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Sales Ledger\")}\n            >\n              Sales Ledger\n            </Button>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Customer Monthly Sales\")}\n            >\n              Customer Monthly Sales\n            </Button>\n          </CardContent>\n        </Card>\n\n        {/* Setting */}\n        <Card className=\"border-red-200 bg-red-50\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"flex items-center gap-2 text-red-800\">\n              <div className=\"w-8 h-8 bg-red-200 rounded-full flex items-center justify-center\">\n                <Settings className=\"h-4 w-4 text-red-600\" />\n              </div>\n              Setting\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-gray-700 hover:bg-red-100\"\n              onClick={() => generateReport(\"Account Heads\")}\n            >\n              Account Heads\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Quick Analytics Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-8\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-500\">\n                  Total Revenue\n                </p>\n                <p className=\"text-3xl font-bold text-gray-900\">\n                  {formatCurrency(\n                    analytics?.salesData?.reduce(\n                      (sum: number, day: any) => sum + day.sales,\n                      0,\n                    ) || 0,\n                  )}\n                </p>\n                <p className=\"text-sm text-green-600\">Last {timeRange} days</p>\n              </div>\n              <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\n                <Banknote className=\"h-6 w-6 text-green-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-500\">\n                  Total Orders\n                </p>\n                <p className=\"text-3xl font-bold text-gray-900\">\n                  {analytics?.salesData?.reduce(\n                    (sum: number, day: any) => sum + day.orders,\n                    0,\n                  ) || 0}\n                </p>\n                <p className=\"text-sm text-blue-600\">Last {timeRange} days</p>\n              </div>\n              <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n                <ShoppingCart className=\"h-6 w-6 text-blue-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-500\">\n                  Average Order\n                </p>\n                <p className=\"text-3xl font-bold text-gray-900\">\n                  {formatCurrency(\n                    analytics?.salesData?.length > 0\n                      ? analytics.salesData.reduce(\n                          (sum: number, day: any) => sum + day.sales,\n                          0,\n                        ) /\n                          analytics.salesData.reduce(\n                            (sum: number, day: any) => sum + day.orders,\n                            0,\n                          )\n                      : 0,\n                  )}\n                </p>\n                <p className=\"text-sm text-purple-600\">Per order value</p>\n              </div>\n              <div className=\"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center\">\n                <TrendingUp className=\"h-6 w-6 text-purple-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-500\">\n                  Products in Stock\n                </p>\n                <p className=\"text-3xl font-bold text-gray-900\">\n                  {stats?.productsInStock || 0}\n                </p>\n                <p className=\"text-sm text-orange-600\">\n                  {stats?.lowStockItems || 0} low stock\n                </p>\n              </div>\n              <div className=\"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center\">\n                <FileText className=\"h-6 w-6 text-orange-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Export Actions */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Download className=\"h-5 w-5\" />\n            Export Reports\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-wrap gap-3\">\n            <Button\n              variant=\"outline\"\n              onClick={() => exportReport(\"All Accounting Reports\")}\n              className=\"flex items-center gap-2\"\n            >\n              <Download className=\"h-4 w-4\" />\n              Export Accounting Reports\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => exportReport(\"Tax Reports\")}\n              className=\"flex items-center gap-2\"\n            >\n              <Download className=\"h-4 w-4\" />\n              Export Tax Reports\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => exportReport(\"Sales Reports\")}\n              className=\"flex items-center gap-2\"\n            >\n              <Download className=\"h-4 w-4\" />\n              Export Sales Reports\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => exportReport(\"Purchase Reports\")}\n              className=\"flex items-center gap-2\"\n            >\n              <Download className=\"h-4 w-4\" />\n              Export Purchase Reports\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":16076,"size_tokens":null},"client/src/components/public-order-form.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useForm, FormProvider, useFormContext } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { Plus, Minus, ShoppingCart, Upload, FileCheck, CheckCircle, AlertTriangle } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\"; // Assuming these are available\n\n// Define the schema with added fields for file upload and terms\nconst orderFormSchema = z.object({\n  customerName: z.string().min(2, \"Name must be at least 2 characters\"),\n  customerEmail: z.string().email(\"Invalid email address\"),\n  customerPhone: z.string().min(10, \"Phone number must be at least 10 digits\"),\n  deliveryDate: z.string().min(1, \"Delivery date is required\"),\n  deliveryAddress: z\n    .string()\n    .min(10, \"Please provide complete delivery address\"),\n  specialInstructions: z.string().max(1000, \"Instructions cannot exceed 1000 characters\").optional(),\n  items: z\n    .array(\n      z.object({\n        productId: z.number(),\n        quantity: z.number().min(1, \"Quantity must be at least 1\"),\n        unitPrice: z.number(),\n        totalPrice: z.number(),\n      }),\n    )\n    .min(1, \"At least one item is required\"),\n  uploadedFiles: z.any().optional(), // For file metadata if needed by react-hook-form\n  agreeToTerms: z.boolean().refine((val) => val === true, {\n    message: \"You must agree to the terms and conditions\",\n  }),\n});\n\ntype OrderFormData = z.infer<typeof orderFormSchema>;\n\ninterface OrderItem {\n  productId: number;\n  productName: string;\n  quantity: number;\n  unitPrice: number;\n  totalPrice: number;\n}\n\n// --- Utility Functions ---\n\n// Function to simulate file upload and return file metadata\nconst simulateFileUpload = async (file: File): Promise<{ name: string; size: number; type: string }> => {\n  // In a real app, this would involve uploading to a server and returning a URL or identifier\n  console.log(`Simulating upload for: ${file.name}`);\n  // Simulate network delay\n  await new Promise(resolve => setTimeout(resolve, 500));\n  return { name: file.name, size: file.size, type: file.type };\n};\n\n// Function to handle queuing and retrying submissions\nconst submitOrderWithRetry = async (orderData: any, maxRetries: number = 3) => {\n  let retries = 0;\n  \n  // Add enhanced security and tracking data\n  const submissionData = {\n    ...orderData,\n    referenceId: `PUB-${Date.now()}-${Math.random().toString(36).substr(2, 5).toUpperCase()}`,\n    formVersion: \"2.0\",\n    submissionTimestamp: new Date().toISOString(),\n    submissionStart: Date.now(),\n    source: \"public_order_form\",\n    clientInfo: {\n      userAgent: navigator.userAgent,\n      language: navigator.language,\n      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n    }\n  };\n\n  while (retries < maxRetries) {\n    try {\n      const response = await fetch(\"/api/public/orders\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Accept\": \"application/json\"\n        },\n        body: JSON.stringify(submissionData),\n      });\n\n      const responseData = await response.json();\n      if (!response.ok) {\n        throw new Error(responseData.message || `Server error: ${response.status}`);\n      }\n      return responseData;\n    } catch (error: any) {\n      retries++;\n      console.error(`Submission attempt ${retries} failed:`, error.message);\n      if (retries >= maxRetries) {\n        throw error;\n      }\n      // Exponential backoff with jitter\n      const delay = Math.min(1000 * Math.pow(2, retries) + Math.random() * 1000, 10000);\n      await new Promise(resolve => setTimeout(resolve, delay));\n    }\n  }\n};\n\n// --- Form Components ---\n\nfunction CustomerInfoSection() {\n  const { toast } = useToast();\n  const form = useFormContext<OrderFormData>();\n  const { register, formState: { errors }, setValue, watch } = form;\n  const submitOrderMutation = useMutation({\n    mutationFn: (data: OrderFormData) => submitOrderWithRetry(data),\n    onSuccess: (data) => {\n      toast({\n        title: \"üéâ Order Submitted Successfully!\",\n        description: `Order ${data.orderNumber} has been received. We'll contact you soon with confirmation details.`,\n        duration: 6000,\n      });\n      form.reset({\n        customerName: \"\", customerEmail: \"\", customerPhone: \"\", deliveryDate: \"\", deliveryAddress: \"\",\n        specialInstructions: \"\", items: [], uploadedFiles: [], agreeToTerms: false\n      });\n      setOrderItems([]);\n      setUploadedFiles([]);\n      setSelectedProduct(null);\n      setQuantity(1);\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"‚ùå Order Submission Failed\",\n        description: error.message || \"There was an error submitting your order. Please check your information and try again.\",\n        variant: \"destructive\",\n        duration: 8000,\n      });\n    },\n  });\n\n  const { data: products = [] } = useQuery({ queryKey: [\"/api/products\"] });\n  const { data: units = [] } = useQuery({ queryKey: [\"/api/units\"] });\n  const [orderItems, setOrderItems] = useState<OrderItem[]>([]);\n  const [selectedProduct, setSelectedProduct] = useState<number | null>(null);\n  const [quantity, setQuantity] = useState(1);\n\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [uploadedFiles, setUploadedFiles] = useState<File[]>([]);\n\n  const addItemToOrder = () => {\n    if (!selectedProduct) return;\n    const product = products.find((p: any) => p.id === selectedProduct);\n    if (!product) return;\n\n    const existingItemIndex = orderItems.findIndex((item) => item.productId === selectedProduct);\n\n    if (existingItemIndex >= 0) {\n      const updatedItems = [...orderItems];\n      updatedItems[existingItemIndex].quantity += quantity;\n      updatedItems[existingItemIndex].totalPrice = updatedItems[existingItemIndex].quantity * parseFloat(product.price);\n      setOrderItems(updatedItems);\n    } else {\n      const newItem: OrderItem = {\n        productId: selectedProduct,\n        productName: product.name,\n        quantity,\n        unitPrice: parseFloat(product.price),\n        totalPrice: quantity * parseFloat(product.price),\n      };\n      setOrderItems([...orderItems, newItem]);\n    }\n    setSelectedProduct(null);\n    setQuantity(1);\n  };\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(event.target.files || []);\n    const newFiles: File[] = [];\n    const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\n    const MAX_FILES = 10;\n\n    for (const file of files) {\n      if (uploadedFiles.length + newFiles.length >= MAX_FILES) {\n        toast({\n          title: \"Too Many Files\",\n          description: `You can only upload up to ${MAX_FILES} files.`,\n          variant: \"destructive\",\n        });\n        break;\n      }\n      if (file.size > MAX_FILE_SIZE) {\n        toast({\n          title: \"File Too Large\",\n          description: `File \"${file.name}\" exceeds the 10MB limit.`,\n          variant: \"destructive\",\n        });\n        continue;\n      }\n      if (!['image/*', 'application/pdf', 'text/plain', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'].includes(file.type)) {\n        toast({\n          title: \"Invalid File Type\",\n          description: `File \"${file.name}\" has an unsupported type.`,\n          variant: \"destructive\",\n        });\n        continue;\n      }\n      newFiles.push(file);\n    }\n\n    if (newFiles.length > 0) {\n      const uploadedMetadata = await Promise.all(newFiles.map(simulateFileUpload));\n      setUploadedFiles((prevFiles) => [...prevFiles, ...newFiles]);\n      // Update form with file metadata if needed by your schema\n      setValue(\"uploadedFiles\", [...uploadedFiles, ...newFiles]);\n    }\n  };\n\n  const removeFile = (indexToRemove: number) => {\n    setUploadedFiles((prevFiles) =>\n      prevFiles.filter((_, index) => index !== indexToRemove)\n    );\n    setValue(\"uploadedFiles\", uploadedFiles.filter((_, index) => index !== indexToRemove));\n  };\n\n  const onSubmit = (data: OrderFormData) => {\n    // Comprehensive validation\n    if (orderItems.length === 0) {\n      toast({\n        title: \"‚ùå No Items Selected\",\n        description: \"Please add at least one item to your order to proceed.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const deliveryDate = new Date(data.deliveryDate);\n    const minDeliveryDate = new Date();\n    minDeliveryDate.setHours(minDeliveryDate.getHours() + 24);\n\n    if (deliveryDate < minDeliveryDate) {\n      toast({\n        title: \"‚è∞ Invalid Delivery Date\",\n        description: \"Delivery date must be at least 24 hours from now to ensure proper preparation time.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Enhanced validation\n    const validationResult = orderFormSchema.safeParse(data);\n    if (!validationResult.success) {\n      const firstError = validationResult.error.errors[0];\n      toast({\n        title: \"üìã Please Check Your Information\",\n        description: firstError.message,\n        variant: \"destructive\",\n      });\n      console.error(\"Validation errors:\", validationResult.error.errors);\n      return;\n    }\n\n    // Validate total amount\n    const calculatedTotal = orderItems.reduce((sum, item) => sum + item.totalPrice, 0);\n    if (calculatedTotal <= 0) {\n      toast({\n        title: \"üí∞ Invalid Order Total\",\n        description: \"Order total must be greater than zero.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const orderDataToSend: any = {\n      ...data,\n      items: orderItems.map((item) => ({\n        productId: item.productId,\n        quantity: item.quantity,\n        unitPrice: item.unitPrice,\n        totalPrice: item.totalPrice,\n      })),\n      // In a real app, you would send file data or references here\n      // For now, we'll assume backend handles file uploads separately or we send metadata\n      // The `uploadedFiles` in `data` contains the File objects from the form input\n      // The backend needs to be prepared to receive and process these files\n    };\n\n    submitOrderMutation.mutate(orderDataToSend);\n  };\n\n  const totalAmount = orderItems.reduce((sum, item) => sum + item.totalPrice, 0);\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Customer Information</CardTitle>\n        <CardDescription>\n          Please provide your contact details\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"customerName\">Full Name *</Label>\n          <Input\n            id=\"customerName\"\n            {...register(\"customerName\")}\n            placeholder=\"Enter your full name\"\n            disabled={submitOrderMutation.isPending}\n          />\n          {errors.customerName && (\n            <p className=\"text-sm text-red-600 mt-1\">{errors.customerName.message}</p>\n          )}\n        </div>\n\n        <div>\n          <Label htmlFor=\"customerEmail\">Email Address *</Label>\n          <Input\n            id=\"customerEmail\"\n            type=\"email\"\n            {...register(\"customerEmail\")}\n            placeholder=\"Enter your email\"\n            disabled={submitOrderMutation.isPending}\n          />\n          {errors.customerEmail && (\n            <p className=\"text-sm text-red-600 mt-1\">{errors.customerEmail.message}</p>\n          )}\n        </div>\n\n        <div>\n          <Label htmlFor=\"customerPhone\">Phone Number *</Label>\n          <Input\n            id=\"customerPhone\"\n            {...register(\"customerPhone\")}\n            placeholder=\"Enter your phone number\"\n            disabled={submitOrderMutation.isPending}\n          />\n          {errors.customerPhone && (\n            <p className=\"text-sm text-red-600 mt-1\">{errors.customerPhone.message}</p>\n          )}\n        </div>\n\n        <div>\n          <Label htmlFor=\"deliveryDate\">Delivery Date *</Label>\n          <Input\n            id=\"deliveryDate\"\n            type=\"date\"\n            {...register(\"deliveryDate\")}\n            min={\n              new Date(Date.now() + 24 * 60 * 60 * 1000)\n                .toISOString()\n                .split(\"T\")[0]\n            }\n            disabled={submitOrderMutation.isPending}\n          />\n          {errors.deliveryDate && (\n            <p className=\"text-sm text-red-600 mt-1\">{errors.deliveryDate.message}</p>\n          )}\n        </div>\n\n        <div className=\"md:col-span-2\">\n          <Label htmlFor=\"deliveryAddress\">Delivery Address *</Label>\n          <Textarea\n            id=\"deliveryAddress\"\n            {...register(\"deliveryAddress\")}\n            placeholder=\"Enter complete delivery address\"\n            rows={3}\n            disabled={submitOrderMutation.isPending}\n          />\n          {errors.deliveryAddress && (\n            <p className=\"text-sm text-red-600 mt-1\">{errors.deliveryAddress.message}</p>\n          )}\n        </div>\n\n        <div className=\"md:col-span-2\">\n          <Label htmlFor=\"specialInstructions\">\n            Special Instructions\n          </Label>\n          <Textarea\n            id=\"specialInstructions\"\n            {...register(\"specialInstructions\")}\n            placeholder=\"Any special requests or instructions for your order\"\n            rows={3}\n            disabled={submitOrderMutation.isPending}\n            maxLength={1000}\n          />\n          {errors.specialInstructions && (\n            <p className=\"text-sm text-red-600 mt-1\">{errors.specialInstructions.message}</p>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction ProductSelectionSection() {\n  const { toast } = useToast();\n  const { formatCurrency } = useCurrency();\n  const form = useFormContext<OrderFormData>();\n  const { register, formState: { errors }, setValue, watch } = form;\n  const { products = [], isLoading: isLoadingProducts } = useQuery({ queryKey: [\"/api/products\"] });\n  const { data: units = [], isLoading: isLoadingUnits } = useQuery({ queryKey: [\"/api/units\"] });\n\n  const orderItems = watch(\"items\"); // Use watch to get current items from form state\n  const [selectedProduct, setSelectedProduct] = useState<number | null>(null);\n  const [quantity, setQuantity] = useState(1);\n\n  const addItemToOrder = () => {\n    if (!selectedProduct) {\n      toast({ title: \"No Product Selected\", description: \"Please select a product.\", variant: \"destructive\" });\n      return;\n    }\n    const product = products.find((p: any) => p.id === selectedProduct);\n    if (!product) {\n      toast({ title: \"Product Not Found\", description: \"The selected product is invalid.\", variant: \"destructive\" });\n      return;\n    }\n    if (quantity <= 0) {\n      toast({ title: \"Invalid Quantity\", description: \"Quantity must be at least 1.\", variant: \"destructive\" });\n      return;\n    }\n\n    const existingItemIndex = orderItems.findIndex((item) => item.productId === selectedProduct);\n\n    let updatedItems;\n    if (existingItemIndex >= 0) {\n      updatedItems = [...orderItems];\n      updatedItems[existingItemIndex].quantity += quantity;\n      updatedItems[existingItemIndex].totalPrice = updatedItems[existingItemIndex].quantity * parseFloat(product.price);\n    } else {\n      const newItem: OrderItem = {\n        productId: selectedProduct,\n        productName: product.name,\n        quantity,\n        unitPrice: parseFloat(product.price),\n        totalPrice: quantity * parseFloat(product.price),\n      };\n      updatedItems = [...orderItems, newItem];\n    }\n    setValue(\"items\", updatedItems); // Update form state\n    setSelectedProduct(null);\n    setQuantity(1);\n  };\n\n  const removeItemFromOrder = (productId: number) => {\n    const updatedItems = orderItems.filter((item) => item.productId !== productId);\n    setValue(\"items\", updatedItems);\n  };\n\n  const updateItemQuantity = (productId: number, newQuantity: number) => {\n    if (newQuantity <= 0) {\n      removeItemFromOrder(productId);\n      return;\n    }\n\n    const updatedItems = orderItems.map((item) => {\n      if (item.productId === productId) {\n        const product = products.find((p: any) => p.id === productId);\n        return {\n          ...item,\n          quantity: newQuantity,\n          totalPrice: newQuantity * item.unitPrice,\n        };\n      }\n      return item;\n    });\n    setValue(\"items\", updatedItems);\n  };\n\n  const totalAmount = orderItems.reduce((sum, item) => sum + item.totalPrice, 0);\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <ShoppingCart className=\"h-5 w-5\" />\n          Select Products\n        </CardTitle>\n        <CardDescription>Choose items for your order</CardDescription>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex gap-4 items-end mb-6\">\n          <div className=\"flex-1\">\n            <Label>Product</Label>\n            <Select\n              value={selectedProduct?.toString() || \"\"}\n              onValueChange={(value) => setSelectedProduct(parseInt(value))}\n              disabled={isLoadingProducts || isLoadingUnits}\n            >\n              <SelectTrigger>\n                <SelectValue placeholder=\"Select a product\" />\n              </SelectTrigger>\n              <SelectContent>\n                {products.map((product: any) => {\n                  const unit = units.find((u: any) => u.id === product.unitId);\n                  return (\n                    <SelectItem key={product.id} value={product.id.toString()}>\n                      {product.name} - {formatCurrency(parseFloat(product.price))}\n                      {unit && ` per ${unit.abbreviation}`}\n                    </SelectItem>\n                  );\n                })}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label>Quantity</Label>\n            <Input\n              type=\"number\"\n              min=\"1\"\n              value={quantity}\n              onChange={(e) => setQuantity(parseInt(e.target.value) || 1)}\n              className=\"w-20\"\n            />\n          </div>\n\n          <Button\n            type=\"button\"\n            onClick={addItemToOrder}\n            disabled={!selectedProduct || isLoadingProducts || isLoadingUnits}\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Item\n          </Button>\n        </div>\n\n        {orderItems.length > 0 && (\n          <div className=\"space-y-4\">\n            <h3 className=\"font-semibold\">Your Order:</h3>\n            {orderItems.map((item, index) => (\n              <div\n                key={index}\n                className=\"flex items-center justify-between p-4 bg-gray-50 rounded-lg\"\n              >\n                <div>\n                  <h4 className=\"font-medium\">{item.productName}</h4>\n                  <p className=\"text-sm text-gray-600\">\n                    {formatCurrency(item.unitPrice)} per {(() => {\n                      const product = products.find((p: any) => p.id === item.productId);\n                      const unit = units.find((u: any) => u.id === product?.unitId);\n                      return unit?.abbreviation || 'unit';\n                    })()}\n                  </p>\n                </div>\n\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    type=\"button\"\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => updateItemQuantity(item.productId, item.quantity - 1)}\n                    disabled={item.quantity === 1}\n                  >\n                    <Minus className=\"h-3 w-3\" />\n                  </Button>\n                  <span className=\"w-8 text-center\">{item.quantity}</span>\n                  <Button\n                    type=\"button\"\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => updateItemQuantity(item.productId, item.quantity + 1)}\n                  >\n                    <Plus className=\"h-3 w-3\" />\n                  </Button>\n                  <div className=\"ml-4 text-right\">\n                    <p className=\"font-semibold\">\n                      {formatCurrency(item.totalPrice)}\n                    </p>\n                  </div>\n                  <Button\n                    type=\"button\"\n                    size=\"sm\"\n                    variant=\"destructive\"\n                    onClick={() => removeItemFromOrder(item.productId)}\n                  >\n                    Remove\n                  </Button>\n                </div>\n              </div>\n            ))}\n\n            <div className=\"text-right pt-4 border-t\">\n              <p className=\"text-xl font-bold\">Total: {formatCurrency(totalAmount)}</p>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction FileUploadSection() {\n  const { toast } = useToast();\n  const form = useFormContext<OrderFormData>();\n  const { setValue, watch, formState: { errors } } = form;\n  const { isPending: isSubmitting } = useMutation({ mutationFn: () => Promise.resolve() }); // Dummy mutation for disabled state\n\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const uploadedFiles = watch(\"uploadedFiles\", []);\n  const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\n  const MAX_FILES = 10;\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(event.target.files || []);\n    const newFiles: File[] = [];\n\n    for (const file of files) {\n      if (uploadedFiles.length + newFiles.length >= MAX_FILES) {\n        toast({\n          title: \"Too Many Files\",\n          description: `You can only upload up to ${MAX_FILES} files.`,\n          variant: \"destructive\",\n        });\n        break;\n      }\n      if (file.size > MAX_FILE_SIZE) {\n        toast({\n          title: \"File Too Large\",\n          description: `File \"${file.name}\" exceeds the 10MB limit.`,\n          variant: \"destructive\",\n        });\n        continue;\n      }\n      // Basic type check - you might want a more robust check\n      if (!['image/', 'application/pdf', 'text/', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'].some(type => file.type.startsWith(type))) {\n        toast({\n          title: \"Invalid File Type\",\n          description: `File \"${file.name}\" has an unsupported type.`,\n          variant: \"destructive\",\n        });\n        continue;\n      }\n      newFiles.push(file);\n    }\n\n    if (newFiles.length > 0) {\n      // In a real scenario, you'd upload files here and get back URLs or identifiers\n      // For this example, we'll just store the File objects in form state\n      const updatedFiles = [...uploadedFiles, ...newFiles];\n      setValue(\"uploadedFiles\", updatedFiles);\n    }\n    // Clear the input to allow selecting the same file again if needed\n    event.target.value = '';\n  };\n\n  const removeFile = (indexToRemove: number) => {\n    const updatedFiles = uploadedFiles.filter((_, index) => index !== indexToRemove);\n    setValue(\"uploadedFiles\", updatedFiles);\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Upload className=\"h-5 w-5\" />\n          Attachments (Optional)\n        </CardTitle>\n        <CardDescription>\n          Upload artwork, specifications, or reference images (Max 10MB per file)\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          <div>\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              multiple\n              accept=\"image/*,.pdf,.txt,.doc,.docx\"\n              onChange={handleFileUpload}\n              className=\"hidden\"\n            />\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => fileInputRef.current?.click()}\n              disabled={isSubmitting || uploadedFiles.length >= MAX_FILES}\n            >\n              <Upload className=\"h-4 w-4 mr-2\" />\n              Choose Files\n            </Button>\n            <p className=\"text-xs text-gray-500 mt-1\">\n              Accepted: Images, PDF, Text files (Max {MAX_FILES} files, {MAX_FILE_SIZE / 1024 / 1024}MB each)\n            </p>\n          </div>\n\n          {uploadedFiles.length > 0 && (\n            <div className=\"space-y-2\">\n              <h4 className=\"font-medium\">Uploaded Files:</h4>\n              {uploadedFiles.map((file, index) => (\n                <div key={index} className=\"flex items-center justify-between p-2 bg-gray-50 rounded\">\n                  <div className=\"flex items-center gap-2\">\n                    <FileCheck className=\"h-4 w-4 text-green-600\" />\n                    <span className=\"text-sm truncate\">{file.name}</span>\n                    <span className=\"text-xs text-gray-500\">\n                      ({(file.size / 1024 / 1024).toFixed(2)} MB)\n                    </span>\n                  </div>\n                  <Button\n                    type=\"button\"\n                    size=\"sm\"\n                    variant=\"destructive\"\n                    onClick={() => removeFile(index)}\n                    disabled={isSubmitting}\n                  >\n                    Remove\n                  </Button>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction TermsAndConditionsSection() {\n  const { register, formState: { errors } } = useFormContext<OrderFormData>();\n\n  return (\n    <Card>\n      <CardContent className=\"pt-6\">\n        <div className=\"flex items-start space-x-3\">\n          <input\n            id=\"agreeToTerms\"\n            type=\"checkbox\"\n            {...register(\"agreeToTerms\")}\n            className=\"mt-1\"\n          />\n          <div className=\"flex-1\">\n            <Label htmlFor=\"agreeToTerms\" className=\"text-sm\">\n              I agree to the{\" \"}\n              <a href=\"/terms\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600 underline\">\n                Terms and Conditions\n              </a>{\" \"}\n              and{\" \"}\n              <a href=\"/privacy\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600 underline\">\n                Privacy Policy\n              </a>\n            </Label>\n            {errors.agreeToTerms && (\n              <p className=\"text-sm text-red-600 mt-1\">{errors.agreeToTerms.message}</p>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default function PublicOrderForm() {\n  const { toast } = useToast();\n  const methods = useForm<OrderFormData>({\n    resolver: zodResolver(orderFormSchema),\n    defaultValues: {\n      customerName: \"\",\n      customerEmail: \"\",\n      customerPhone: \"\",\n      deliveryDate: \"\",\n      deliveryAddress: \"\",\n      specialInstructions: \"\",\n      items: [],\n      uploadedFiles: [],\n      agreeToTerms: false,\n    },\n  });\n\n  const { handleSubmit, formState: { errors }, reset, watch } = methods;\n  const { mutate: submitOrder, isPending: isSubmitting } = useMutation({\n    mutationFn: (data: OrderFormData) => submitOrderWithRetry(data),\n    onSuccess: (data) => {\n      console.log(\"Order submitted successfully:\", data);\n      toast({\n        title: \"üéâ Order Submitted Successfully!\",\n        description: `Order ${data.orderNumber} has been received. We'll contact you soon with confirmation details.`,\n        duration: 6000,\n      });\n      resetFormAndState();\n    },\n    onError: (error: any) => {\n      console.error(\"Order submission error:\", error);\n      toast({\n        title: \"‚ùå Order Submission Failed\",\n        description: error.message || \"There was an error submitting your order. Please check your information and try again.\",\n        variant: \"destructive\",\n        duration: 8000,\n      });\n    },\n  });\n\n  const orderItems = watch(\"items\");\n  const [submissionStatus, setSubmissionStatus] = useState<'idle' | 'submitting' | 'success' | 'error'>('idle');\n  const [orderReference, setOrderReference] = useState<string | null>(null);\n  const [retryCount, setRetryCount] = useState(0);\n  const maxRetries = 3;\n\n  const resetFormAndState = () => {\n    reset({\n      customerName: \"\",\n      customerEmail: \"\",\n      customerPhone: \"\",\n      deliveryDate: \"\",\n      deliveryAddress: \"\",\n      specialInstructions: \"\",\n      items: [],\n      uploadedFiles: [],\n      agreeToTerms: false,\n    });\n    setOrderItems([]);\n    setUploadedFiles([]);\n    setSelectedProduct(null);\n    setQuantity(1);\n    setSubmissionStatus('idle');\n    setOrderReference(null);\n    setRetryCount(0);\n  };\n\n  const onSubmit = (data: OrderFormData) => {\n    // Ensure items are correctly mapped from state if not directly in form state\n    if (orderItems.length === 0) {\n      toast({\n        title: \"No Items Selected\",\n        description: \"Please add at least one item to your order.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Convert File objects to something serializable if necessary for the API, or handle upload separately\n    // For this example, we assume the backend might receive FormData or process files asynchronously\n    const orderDataToSend: any = {\n      ...data,\n      items: orderItems.map((item) => ({\n        productId: item.productId,\n        quantity: item.quantity,\n        unitPrice: item.unitPrice,\n        totalPrice: item.totalPrice,\n      })),\n      // If files need to be uploaded with the form data, construct FormData\n      // const formData = new FormData();\n      // Object.entries(data).forEach(([key, value]) => {\n      //   if (key !== 'uploadedFiles') {\n      //     formData.append(key, value as string);\n      //   }\n      // });\n      // data.uploadedFiles.forEach((file: File) => {\n      //   formData.append('files', file);\n      // });\n      // Then use formData in the mutationFn\n    };\n\n    setSubmissionStatus('submitting');\n    setRetryCount(0); // Reset retry count on new submission attempt\n\n    submitOrder(orderDataToSend); // Using the mutation directly\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 py-8\">\n      <div className=\"max-w-4xl mx-auto px-4\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n            Bake Sewa Order Form\n          </h1>\n          <p className=\"text-gray-600\">Place your custom bakery order online</p>\n        </div>\n\n        <FormProvider {...methods}>\n          <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\n            <CustomerInfoSection />\n            <ProductSelectionSection />\n            <FileUploadSection />\n            <TermsAndConditionsSection />\n\n            {isSubmitting && (\n              <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n                <div className=\"bg-white p-6 rounded-lg shadow-lg text-center\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n                  <p className=\"text-lg font-semibold\">Submitting your order...</p>\n                  <p className=\"text-gray-600\">Please wait while we process your request.</p>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex justify-center pt-4\">\n              <Button\n                type=\"submit\"\n                size=\"lg\"\n                disabled={isSubmitting || orderItems.length === 0}\n                className=\"min-w-[200px]\"\n              >\n                {isSubmitting ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                    Submitting Order...\n                  </>\n                ) : (\n                  \"Submit Order\"\n                )}\n              </Button>\n            </div>\n          </form>\n        </FormProvider>\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":32437,"size_tokens":null},"client/src/pages/system-health.tsx":{"content":"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Activity, Heart, Server, AlertTriangle } from \"lucide-react\";\nimport { ProtectedRoute } from \"@/components/protected-route\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function SystemHealth() {\n  return (\n    <ProtectedRoute resource=\"monitoring\" action=\"read\">\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div>\n            <p className=\"text-muted-foreground\">\n              Monitor system performance and health metrics\n            </p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Server className=\"h-5 w-5\" />\n                Server Status\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-2\">\n                <Badge variant=\"default\" className=\"bg-green-500\">Online</Badge>\n                <span className=\"text-sm text-muted-foreground\">99.9% uptime</span>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Activity className=\"h-5 w-5\" />\n                CPU Usage\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">23%</div>\n              <p className=\"text-sm text-muted-foreground\">Average load</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Memory Usage</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">512MB</div>\n              <p className=\"text-sm text-muted-foreground\">of 2GB used</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <AlertTriangle className=\"h-5 w-5\" />\n                Alerts\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">0</div>\n              <p className=\"text-sm text-muted-foreground\">Active alerts</p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </ProtectedRoute>\n  );\n}\n","path":null,"size_bytes":2528,"size_tokens":null},"client/src/pages/performance.tsx":{"content":"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Zap, BarChart, Cpu, HardDrive } from \"lucide-react\";\nimport { ProtectedRoute } from \"@/components/protected-route\";\n\nexport default function PerformanceMetrics() {\n  return (\n    <ProtectedRoute resource=\"performance\" action=\"read\">\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div>\n            <p className=\"text-muted-foreground\">\n              Detailed performance analytics and optimization insights\n            </p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Cpu className=\"h-5 w-5\" />\n                CPU Performance\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">87%</div>\n              <p className=\"text-sm text-muted-foreground\">Efficiency score</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <HardDrive className=\"h-5 w-5\" />\n                Disk I/O\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">23MB/s</div>\n              <p className=\"text-sm text-muted-foreground\">Average throughput</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BarChart className=\"h-5 w-5\" />\n                Query Performance\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">0.8ms</div>\n              <p className=\"text-sm text-muted-foreground\">Avg query time</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Cache Hit Rate</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">94%</div>\n              <p className=\"text-sm text-muted-foreground\">Cache efficiency</p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </ProtectedRoute>\n  );\n}\n","path":null,"size_bytes":2412,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { LanguageProvider } from \"@/contexts/LanguageContext\";\nimport { UnitsProvider } from \"@/contexts/UnitsContext\";\nimport { useState, useEffect } from \"react\";\n\n// Page Components\nimport Landing from \"@/pages/landing\";\nimport Dashboard from \"@/pages/dashboard\";\nimport { MobileInstallBanner } from \"@/components/mobile-install-banner\";\nimport Products from \"@/pages/products\";\nimport Inventory from \"@/pages/inventory\";\nimport Orders from \"@/pages/orders\";\nimport Production from \"@/pages/production\";\nimport Assets from \"@/pages/assets\";\nimport Expenses from \"@/pages/expenses\";\nimport Parties from \"@/pages/parties\";\nimport Reports from \"@/pages/reports\";\nimport DayBook from \"./pages/day-book\";\nimport Transactions from \"@/pages/transactions\";\nimport Billing from \"@/pages/billing\";\nimport Settings from \"@/pages/settings\";\nimport Notifications from \"./pages/notifications\";\nimport AdminUsers from \"@/pages/admin-users\";\nimport AdminRoles from \"@/pages/admin-roles\";\nimport LoginLogs from \"@/pages/LoginLogs\";\nimport ProductCategories from \"@/pages/product-categories\";\nimport NotFound from \"@/pages/not-found\";\nimport Unauthorized from \"@/pages/unauthorized\"; // Import the Unauthorized component\nimport LoginForm from \"@/components/login-form\";\nimport Sidebar from \"@/components/sidebar\";\nimport Header from \"@/components/header\";\nimport Customers from \"@/pages/customers\";\nimport NotificationSettings from \"@/components/notification-settings\";\n\nimport Sales from \"@/pages/sales\";\nimport Purchases from \"@/pages/purchases\";\nimport SalesReturns from \"@/pages/sales-returns\";\nimport PurchaseReturns from \"@/pages/purchase-returns\";\nimport PublicOrderForm from \"@/components/public-order-form\";\nimport ComprehensiveStockManagement from \"@/pages/stock\";\nimport Ingredients from \"@/pages/ingredients\";\nimport Units from \"@/pages/units\";\nimport LabelPrinting from \"@/pages/label-printing\";\nimport LabelEditor from \"@/pages/label-editor\"; // Import LabelEditor\nimport Recipes from \"@/pages/recipes\";\n// import ExpireProducts from \"@/pages/expire-products\"; // Removed as it's being replaced\n\nimport Staff from \"@/pages/staff\";\nimport Attendance from \"@/pages/attendance\";\nimport Salary from \"@/pages/salary\";\nimport LeaveRequests from \"@/pages/leave-requests\";\nimport { ProtectedRoute } from \"@/components/protected-route\";\nimport ProductionPage from \"@/pages/production\";\nimport Branches from \"./pages/branches\";\n\nimport { PWAInstallPopup } from \"./components/pwa-install-popup\"; // Import PWAInstallPopup\n\nfunction Router() {\n  const { user, isLoading } = useAuth();\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-lg\">Loading...</div>\n      </div>\n    );\n  }\n\n  // Public routes (no authentication required)\n  return (\n    <Switch>\n      <Route path=\"/order\" component={PublicOrderForm} />\n      <Route path=\"*\">\n        {!user ? (\n          <LoginForm\n            onSuccess={() => {\n              // Force a complete refresh of auth state\n              queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n              // Small delay to ensure the query has time to refetch\n              setTimeout(() => {\n                window.location.href = \"/dashboard\";\n              }, 300);\n            }}\n          />\n        ) : (\n          <AuthenticatedApp\n            user={user}\n            sidebarOpen={sidebarOpen}\n            setSidebarOpen={setSidebarOpen}\n          />\n        )}\n      </Route>\n    </Switch>\n  );\n}\n\nfunction AuthenticatedApp({\n  user,\n  sidebarOpen,\n  setSidebarOpen,\n}: {\n  user: any;\n  sidebarOpen: boolean;\n  setSidebarOpen: (open: boolean) => void;\n}) {\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  // Listen to localStorage changes for sidebar state\n  useEffect(() => {\n    const handleStorageChange = () => {\n      const savedState = localStorage.getItem(\"sidebar-collapsed\");\n      if (savedState !== null) {\n        setIsCollapsed(JSON.parse(savedState));\n      }\n    };\n\n    // Initial load\n    handleStorageChange();\n\n    // Listen for storage changes\n    window.addEventListener(\"storage\", handleStorageChange);\n\n    // Custom event for same-page updates\n    const handleSidebarToggle = () => {\n      const savedState = localStorage.getItem(\"sidebar-collapsed\");\n      if (savedState !== null) {\n        setIsCollapsed(JSON.parse(savedState));\n      }\n    };\n\n    window.addEventListener(\"sidebar-toggle\", handleSidebarToggle);\n\n    return () => {\n      window.removeEventListener(\"storage\", handleStorageChange);\n      window.removeEventListener(\"sidebar-toggle\", handleSidebarToggle);\n    };\n  }, []);\n\n  const toggleCollapse = () => {\n    const newState = !isCollapsed;\n    setIsCollapsed(newState);\n    localStorage.setItem(\"sidebar-collapsed\", JSON.stringify(newState));\n    // Dispatch custom event for same-page updates\n    window.dispatchEvent(new CustomEvent(\"sidebar-toggle\"));\n  };\n\n  // Super Admin gets unrestricted access - no ProtectedRoute wrapper needed\n  const isSuperAdmin = user?.role === \"super_admin\";\n\n  // Component wrapper that conditionally adds protection\n  const RouteWrapper = ({\n    children,\n    resource,\n    action,\n  }: {\n    children: React.ReactNode;\n    resource: string;\n    action: \"read\" | \"write\" | \"read_write\";\n  }) => {\n    if (isSuperAdmin) {\n      return <>{children}</>;\n    }\n    return (\n      <ProtectedRoute resource={resource} action={action}>\n        {children}\n      </ProtectedRoute>\n    );\n  };\n\n  return (\n    <div className=\"h-screen flex bg-gray-50 overflow-hidden\">\n      <Sidebar\n        isOpen={sidebarOpen}\n        onToggle={() => setSidebarOpen(!sidebarOpen)}\n        isCollapsed={isCollapsed}\n      />\n      <main\n        className={`flex-1 flex flex-col min-w-0 transition-all duration-300 ${isCollapsed ? \"lg:ml-20\" : \"lg:ml-64\"}`}\n      >\n        <Header\n          onMenuClick={() => setSidebarOpen(!sidebarOpen)}\n          isCollapsed={isCollapsed}\n          onToggleCollapse={toggleCollapse}\n        />\n        <div className=\"flex-1 overflow-y-auto bg-gray-50/30\">\n          <MobileInstallBanner />\n          <PWAInstallPopup /> {/* Added PWA Install Popup here */}\n          <Switch>\n            <Route\n              path=\"/\"\n              component={() => (\n                <RouteWrapper resource=\"dashboard\" action=\"read\">\n                  <Dashboard />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/dashboard\"\n              component={() => (\n                <RouteWrapper resource=\"dashboard\" action=\"read\">\n                  <Dashboard />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/production\"\n              component={() => (\n                <RouteWrapper resource=\"production\" action=\"read\">\n                  <ProductionPage />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/label-printing\"\n              component={() => (\n                <RouteWrapper resource=\"production\" action=\"read\">\n                  <LabelPrinting />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/label-editor\"\n              component={() => (\n                <RouteWrapper resource=\"production\" action=\"read\">\n                  <LabelEditor />\n                </RouteWrapper>\n              )}\n            />\n            {/* Replaced expire-products route with sales-returns and purchase-returns */}\n            <Route\n              path=\"/sales-returns\"\n              component={() => (\n                <RouteWrapper resource=\"sales\" action=\"read\">\n                  <SalesReturns />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/purchase-returns\"\n              component={() => (\n                <RouteWrapper resource=\"purchases\" action=\"read\">\n                  <PurchaseReturns />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/units\"\n              component={() => (\n                <RouteWrapper resource=\"units\" action=\"read\">\n                  <Units />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/recipes\"\n              component={() => (\n                <RouteWrapper resource=\"products\" action=\"read\">\n                  <Recipes />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/products\"\n              component={() => (\n                <RouteWrapper resource=\"products\" action=\"read\">\n                  <Products />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/inventory\"\n              component={() => (\n                <RouteWrapper resource=\"inventory\" action=\"read\">\n                  <Inventory />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/stock\"\n              component={() => (\n                <RouteWrapper resource=\"inventory\" action=\"read\">\n                  <ComprehensiveStockManagement />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/ingredients\"\n              component={() => (\n                <RouteWrapper resource=\"inventory\" action=\"read\">\n                  <Ingredients />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/orders\"\n              component={() => (\n                <RouteWrapper resource=\"orders\" action=\"read\">\n                  <Orders />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/customers\"\n              component={() => (\n                <RouteWrapper resource=\"customers\" action=\"read\">\n                  <Customers />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/parties\"\n              component={() => (\n                <RouteWrapper resource=\"parties\" action=\"read\">\n                  <Parties />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/assets\"\n              component={() => (\n                <RouteWrapper resource=\"assets\" action=\"read\">\n                  <Assets />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/expenses\"\n              component={() => (\n                <RouteWrapper resource=\"expenses\" action=\"read\">\n                  <Expenses />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/reports\"\n              component={() => (\n                <RouteWrapper resource=\"reports\" action=\"read\">\n                  <Reports />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/day-book\"\n              component={() => (\n                <RouteWrapper resource=\"reports\" action=\"read\">\n                  <DayBook />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/transactions\"\n              component={() => (\n                <RouteWrapper resource=\"reports\" action=\"read\">\n                  <Transactions />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/billing\"\n              component={() => (\n                <RouteWrapper resource=\"orders\" action=\"read\">\n                  <Billing />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/settings\"\n              component={() => (\n                <RouteWrapper resource=\"settings\" action=\"read\">\n                  <Settings />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/notifications\"\n              component={() => (\n                <RouteWrapper resource=\"dashboard\" action=\"read\">\n                  <Notifications />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/notification-settings\"\n              component={() => (\n                <RouteWrapper resource=\"settings\" action=\"read\">\n                  <NotificationSettings />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/admin/users\"\n              component={() => (\n                <RouteWrapper resource=\"users\" action=\"read_write\">\n                  <AdminUsers />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/admin/roles\"\n              component={() => (\n                <RouteWrapper resource=\"users\" action=\"read_write\">\n                  <AdminRoles />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/admin/login-logs\"\n              component={() => (\n                <RouteWrapper resource=\"admin\" action=\"read_write\">\n                  <LoginLogs />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/admin/categories\"\n              component={() => (\n                <RouteWrapper resource=\"products\" action=\"read_write\">\n                  <ProductCategories />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/sales\"\n              component={() => (\n                <RouteWrapper resource=\"sales\" action=\"read\">\n                  <Sales />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/purchases\"\n              component={() => (\n                <RouteWrapper resource=\"purchases\" action=\"read\">\n                  <Purchases />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/units\"\n              component={() => (\n                <RouteWrapper resource=\"units\" action=\"read\">\n                  <Units />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/staff\"\n              component={() => (\n                <RouteWrapper resource=\"staff\" action=\"read\">\n                  <Staff />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/attendance\"\n              component={() => (\n                <RouteWrapper resource=\"staff\" action=\"read\">\n                  <Attendance />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/salary\"\n              component={() => (\n                <RouteWrapper resource=\"staff\" action=\"read\">\n                  <Salary />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/leave-requests\"\n              component={() => (\n                <RouteWrapper resource=\"staff\" action=\"read\">\n                  <LeaveRequests />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/staff-schedules\"\n              component={() => (\n                <RouteWrapper resource=\"staff\" action=\"read\">\n                  <LeaveRequests />\n                </RouteWrapper>\n              )}\n            />\n            <Route\n              path=\"/branches\"\n              component={() => (\n                <RouteWrapper resource=\"branches\" action=\"read\">\n                  <Branches />\n                </RouteWrapper>\n              )}\n            />\n            <Route path=\"/unauthorized\" component={Unauthorized} />\n            <Route component={NotFound} />\n          </Switch>\n        </div>\n      </main>\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      {/* Removed ThemeProvider and CurrencyProvider as they were not provided in the original code */}\n      <LanguageProvider>\n        <UnitsProvider>\n          <TooltipProvider>\n            <Router />\n            <Toaster />\n            <MobileInstallBanner />\n            <PWAInstallPopup />\n          </TooltipProvider>\n        </UnitsProvider>\n      </LanguageProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;","path":null,"size_bytes":16715,"size_tokens":null},"replit.md":{"content":"# Mero BakeSoft - Bakery Management System\n\n## Overview\n\nA comprehensive bakery management system built with React, TypeScript, and PostgreSQL. The application provides complete business management functionality for bakeries including product management, inventory tracking, order processing, production scheduling, and financial operations.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React 18 with TypeScript\n- **Routing**: Wouter for client-side routing\n- **State Management**: TanStack Query (React Query) for server state\n- **UI Library**: Shadcn/ui components with Radix UI primitives\n- **Styling**: Tailwind CSS with custom bakery theme\n- **Forms**: React Hook Form with Zod validation\n- **Build Tool**: Vite for fast development and optimized builds\n\n### Backend Architecture\n- **Runtime**: Node.js with Express.js server\n- **Language**: TypeScript with ES modules\n- **Authentication**: Passport.js with local strategy and bcrypt\n- **Session Management**: Express session with PostgreSQL store\n- **API Design**: RESTful endpoints with role-based access control\n\n### Database Layer\n- **Database**: PostgreSQL with Drizzle ORM\n- **Schema Management**: Drizzle migrations with version control\n- **Connection**: Neon serverless PostgreSQL or standard PostgreSQL\n- **Session Storage**: connect-pg-simple for Express sessions\n\n## Key Components\n\n### Core Management Modules\n1. **Dashboard**: Real-time analytics, sales metrics, and operational overview\n2. **Products**: Product catalog with categories, pricing, and cost calculation\n3. **Inventory**: Raw materials tracking with stock levels and alerts\n4. **Orders**: Customer order processing with status tracking\n5. **Production**: Scheduling and batch production management\n6. **Sales**: Transaction recording and revenue tracking\n7. **Purchases**: Supplier management and inventory restocking\n\n### Business Operations\n1. **Customer Management**: CRM functionality for customer relationships\n2. **Supplier/Party Management**: Vendor and supplier database\n3. **Asset Management**: Equipment and business asset tracking\n4. **Expense Tracking**: Business cost monitoring and categorization\n5. **Billing**: Invoice generation and payment processing\n\n### Advanced Features\n1. **User Management**: Role-based access (Super Admin, Admin, Manager, Staff)\n2. **Category Management**: Hierarchical organization system\n3. **Currency Support**: Multi-currency with formatting utilities\n4. **Notifications**: Push notification system for alerts\n5. **Reports & Analytics**: Business intelligence and insights\n6. **Theme Customization**: Dynamic color theming system\n7. **Unit Conversion System**: Advanced unit conversion with cost calculations\n8. **Cost Calculation Engine**: Automatic product cost calculation based on ingredient units\n9. **Interactive Table Sorting**: Comprehensive column sorting with visual indicators across all listing pages\n\n## Data Flow\n\n### Authentication Flow\n1. User credentials validated against bcrypt-hashed passwords\n2. Passport.js creates authenticated session\n3. Session stored in PostgreSQL with automatic expiration\n4. Role-based route protection via middleware\n\n### Data Management Flow\n1. Client components use TanStack Query for server state\n2. API requests routed through Express.js endpoints\n3. Drizzle ORM handles database operations with type safety\n4. Real-time updates via query invalidation and optimistic updates\n\n### Production Workflow\n1. Products defined with ingredient relationships\n2. Production schedules created with target quantities\n3. Inventory automatically updated based on production consumption\n4. Cost calculations based on ingredient prices and overhead\n\n## External Dependencies\n\n### Core Dependencies\n- **@tanstack/react-query**: Server state management\n- **drizzle-orm**: Type-safe database operations\n- **@neondatabase/serverless**: Serverless PostgreSQL client\n- **passport**: Authentication middleware\n- **bcrypt**: Password hashing\n- **express-session**: Session management\n\n### UI Dependencies\n- **@radix-ui/***: Primitive UI components\n- **tailwindcss**: Utility-first CSS framework\n- **react-hook-form**: Form state management\n- **zod**: Schema validation\n- **date-fns**: Date manipulation utilities\n\n### Development Dependencies\n- **vite**: Build tool and dev server\n- **typescript**: Type checking\n- **drizzle-kit**: Database migration tools\n- **esbuild**: Production bundling\n\n## Deployment Strategy\n\n### Development Environment\n- Vite dev server with HMR for frontend\n- tsx for TypeScript execution in development\n- Automatic database initialization with default users\n- Replit-specific optimizations and error handling\n\n### Production Build\n1. Vite builds optimized client bundle to `dist/public`\n2. esbuild bundles server code to `dist/index.js`\n3. Express serves static files in production mode\n4. Database migrations run automatically on startup\n\n### Environment Configuration\n- **DATABASE_URL**: PostgreSQL connection string (required)\n- **SESSION_SECRET**: Session encryption key\n- **NODE_ENV**: Environment flag (development/production)\n- **PORT**: Server port (default: 5000)\n\n### Default User Accounts\n- **Super Admin**: superadmin@bakesewa.com / superadmin123 (Full system access)\n- **Admin**: admin@bakesewa.com / admin123 (Administrative access)\n- **Manager**: manager@bakesewa.com / manager123 (Management features)\n- **Staff**: staff@bakesewa.com / staff123 (Basic operations)\n\n### Label Layout Editor\nThe Label Editor is a professional design tool for creating printable labels with the following features:\n- **Drawing Tools**: Text, shapes (rectangle, ellipse, triangle, star, line), barcodes, QR codes, and images\n- **Pan Tool**: Pan/scroll canvas using grab cursor (Hand icon in toolbar)\n- **Selection Tool**: Select, move, and resize elements with handles\n- **Zoom Controls**: Zoom in/out with Auto Fit button to show full preview\n- **Fit-to-Screen Preview**: Label preview always displays in fit-to-screen mode for optimal viewing\n- **Grid and Snap**: Toggle grid visibility and snap-to-grid alignment\n- **Text Formatting**: Font family, size, weight, style, text alignment, color\n- **Element Properties**: Position, size, rotation, opacity, visibility, lock\n- **Image Elements**: Supports URL-based images with placeholder display\n- **Template Management**: Save/load templates to localStorage, export/import as JSON\n- **Default Template Protection**: Default 4x3mm template cannot be deleted from the system\n- **Default Page Size**: 4mm width x 3mm height with pre-configured elements\n- **Print Support**: Print labels directly from the editor\n\nChangelog:\n- June 24, 2025. Initial setup\n- July 9, 2025. Implemented comprehensive theme color system with database integration\n- July 9, 2025. Added login tracking system with IP address, location, and device tracking\n- July 9, 2025. Enhanced UI/UX with consistent theme color application across all components\n- July 9, 2025. Added theme-aware badge system and improved user interface consistency\n- July 11, 2025. Added unit conversion system with database tables and API endpoints\n- July 11, 2025. Implemented cost calculation system for products based on unit conversions\n- July 11, 2025. Enhanced super admin role with full access to all system resources\n- July 11, 2025. Added reusable SearchBar component across all 17 pages\n- July 25, 2025. Implemented comprehensive interactive table sorting functionality across all listing pages with clickable column headers, ascending/descending toggle, and visual sort indicators\n- July 29, 2025. Successfully migrated from Replit Agent to standard Replit environment with PostgreSQL database provisioning, schema migrations, and unit system fixes\n- August 28, 2025. Completed full migration to Replit environment - resolved all 137 TypeScript diagnostics, fixed staff management system, added missing storage methods (getAssetById, getPartyById), corrected authentication interfaces, and ensured all 6 staff management subcategories are fully operational\n- September 16, 2025. Successfully configured GitHub import for Replit environment - provisioned PostgreSQL database, applied schema migrations, configured Vite for proxy support with allowedHosts: true, and verified all system components are working properly\n- November 30, 2025. Cleaned up duplicate files from Replit Agent migration: removed duplicate tailwind.config.js (keeping TypeScript version), removed duplicate client/src/public/sw.js, removed unused product-form-enhanced.tsx, removed empty cookies.txt and dump.sql files, consolidated public assets\n- December 2, 2025. Fixed Label Editor pan tool and image rendering: implemented proper pan functionality with accumulating offsets, added Reset View button, fixed image element rendering with placeholder/URL support, added image URL input to properties panel\n- December 4, 2025. Label Editor enhancements: implemented fit-to-screen preview mode (always auto-zoom), added default template protection (4x3mm template cannot be deleted), set default page size to 4mm width x 3mm height with appropriately scaled elements\n\nUser Preferences:\nPreferred communication style: Simple, everyday language.\nTheme system: Dynamic theme colors from database with comprehensive UI integration.","path":null,"size_bytes":9256,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\";\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\ninterface PaginationProps {\n  currentPage: number;\n  totalPages: number;\n  onPageChange: (page: number) => void;\n  showFirstLast?: boolean;\n  showPreviousNext?: boolean;\n  className?: string;\n}\n\nexport function Pagination({\n  currentPage,\n  totalPages,\n  onPageChange,\n  showFirstLast = true,\n  showPreviousNext = true,\n  className,\n}: PaginationProps) {\n  const getVisiblePages = () => {\n    const delta = 2;\n    const range = [];\n    const rangeWithDots = [];\n\n    for (\n      let i = Math.max(2, currentPage - delta);\n      i <= Math.min(totalPages - 1, currentPage + delta);\n      i++\n    ) {\n      range.push(i);\n    }\n\n    if (currentPage - delta > 2) {\n      rangeWithDots.push(1, \"...\");\n    } else {\n      rangeWithDots.push(1);\n    }\n\n    rangeWithDots.push(...range);\n\n    if (currentPage + delta < totalPages - 1) {\n      rangeWithDots.push(\"...\", totalPages);\n    } else {\n      rangeWithDots.push(totalPages);\n    }\n\n    return rangeWithDots;\n  };\n\n  const visiblePages = totalPages > 1 ? getVisiblePages() : [];\n\n  if (totalPages <= 1) {\n    return null;\n  }\n\n  return (\n    <nav\n      className={cn(\"flex items-center justify-center space-x-2\", className)}\n      aria-label=\"Pagination\"\n    >\n      {showFirstLast && (\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => onPageChange(1)}\n          disabled={currentPage === 1}\n          className=\"px-3\"\n        >\n          &laquo;\n        </Button>\n      )}\n\n      {showPreviousNext && (\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => onPageChange(currentPage - 1)}\n          disabled={currentPage === 1}\n          className=\"px-3\"\n        >\n          &lsaquo;\n        </Button>\n      )}\n\n      {visiblePages.map((page, index) => (\n        <React.Fragment key={index}>\n          {page === \"...\" ? (\n            <span className=\"px-3 py-2 text-sm text-muted-foreground\">\n              <MoreHorizontal className=\"h-4 w-4\" />\n            </span>\n          ) : (\n            <Button\n              variant={page === currentPage ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => onPageChange(page as number)}\n              className=\"px-3\"\n            >\n              {page}\n            </Button>\n          )}\n        </React.Fragment>\n      ))}\n\n      {showPreviousNext && (\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => onPageChange(currentPage + 1)}\n          disabled={currentPage === totalPages}\n          className=\"px-3\"\n        >\n          &rsaquo;\n        </Button>\n      )}\n\n      {showFirstLast && (\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => onPageChange(totalPages)}\n          disabled={currentPage === totalPages}\n          className=\"px-3\"\n        >\n          &raquo;\n        </Button>\n      )}\n    </nav>\n  );\n}\n\ninterface PaginationInfoProps {\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  className?: string;\n}\n\nexport function PaginationInfo({\n  currentPage,\n  totalPages,\n  totalItems,\n  className,\n}: PaginationInfoProps) {\n  return (\n    <div className={cn(\"text-sm text-muted-foreground\", className)}>\n      Page {currentPage} of {totalPages} ({totalItems} total items)\n    </div>\n  );\n}\n\ninterface PageSizeSelectorProps {\n  pageSize: number;\n  onPageSizeChange: (size: number) => void;\n  options?: number[];\n  className?: string;\n}\n\nexport function PageSizeSelector({\n  pageSize,\n  onPageSizeChange,\n  options = [10, 20, 50, 100],\n  className,\n}: PageSizeSelectorProps) {\n  return (\n    <div className={cn(\"flex items-center space-x-2\", className)}>\n      <span className=\"text-sm text-muted-foreground\">Show</span>\n      <Select value={pageSize.toString()} onValueChange={(value) => onPageSizeChange(Number(value))}>\n        <SelectTrigger className=\"w-20\">\n          <SelectValue />\n        </SelectTrigger>\n        <SelectContent>\n          {options.map((option) => (\n            <SelectItem key={option} value={option.toString()}>\n              {option}\n            </SelectItem>\n          ))}\n        </SelectContent>\n      </Select>\n      <span className=\"text-sm text-muted-foreground\">items</span>\n    </div>\n  );\n}\n\nexport function usePagination<T>(\n  data: T[],\n  initialPageSize = 10\n) {\n  const [currentPage, setCurrentPage] = React.useState(1);\n  const [pageSize, setPageSize] = React.useState(initialPageSize);\n\n  const totalItems = data.length;\n  const totalPages = Math.ceil(totalItems / pageSize);\n\n  // Reset to first page when data changes\n  React.useEffect(() => {\n    setCurrentPage(1);\n  }, [data.length]);\n\n  // Reset to last page if current page exceeds total pages\n  React.useEffect(() => {\n    if (currentPage > totalPages && totalPages > 0) {\n      setCurrentPage(totalPages);\n    }\n  }, [currentPage, totalPages]);\n\n  const startIndex = (currentPage - 1) * pageSize;\n  const endIndex = startIndex + pageSize;\n  const currentItems = data.slice(startIndex, endIndex);\n\n  const goToPage = (page: number) => {\n    setCurrentPage(Math.max(1, Math.min(page, totalPages)));\n  };\n\n  const nextPage = () => {\n    goToPage(currentPage + 1);\n  };\n\n  const previousPage = () => {\n    goToPage(currentPage - 1);\n  };\n\n  const onPageSizeChange = (newSize: number) => {\n    const currentStartIndex = (currentPage - 1) * pageSize;\n    const newPage = Math.floor(currentStartIndex / newSize) + 1;\n    setPageSize(newSize);\n    setCurrentPage(newPage);\n  };\n\n  return {\n    currentItems,\n    currentPage,\n    totalPages,\n    pageSize,\n    totalItems,\n    setPageSize: onPageSizeChange,\n    goToPage,\n    nextPage,\n    previousPage,\n  };\n}","path":null,"size_bytes":5946,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/pages/salary.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Plus, Edit, Banknote, Calendar } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport SearchBar from \"@/components/search-bar\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nexport default function SalaryPayments() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingPayment, setEditingPayment] = useState<any>(null);\n  const [selectedStaff, setSelectedStaff] = useState(\"\");\n  const [formData, setFormData] = useState({\n    staffId: \"\",\n    payPeriodStart: \"\",\n    payPeriodEnd: \"\",\n    basicSalary: \"\",\n    overtimePay: \"\",\n    bonus: \"\",\n    allowances: \"\",\n    deductions: \"\",\n    taxPercentage: \"0\",\n    taxAmount: \"0\",\n    netPay: \"0\",\n    paymentDate: new Date().toISOString().split(\"T\")[0], // default today\n    paymentMethod: \"bank_transfer\",\n    status: \"pending\",\n    notes: \"\",\n  });\n\n  const { toast } = useToast();\n\n  const { data: staff = [], isLoading: staffLoading } = useQuery({\n    queryKey: [\"staff\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/staff\"),\n  });\n\n  const { data: salaryPayments = [], isLoading: paymentsLoading } = useQuery({\n    queryKey: [\"salary-payments\", selectedStaff],\n    queryFn: async () => {\n      const params = selectedStaff ? `?staffId=${selectedStaff}` : \"\";\n      const result = await apiRequest(\"GET\", `/api/salary-payments${params}`);\n      // Ensure we always return an array\n      if (Array.isArray(result)) {\n        return result;\n      } else if (result && Array.isArray(result.items)) {\n        return result.items;\n      } else if (result && Array.isArray(result.data)) {\n        return result.data;\n      }\n      return [];\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return apiRequest(\"POST\", \"/api/salary-payments\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Salary payment created successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"salary-payments\"] });\n      setIsDialogOpen(false);\n      resetForm();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create salary payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return apiRequest(\n        \"PUT\",\n        `/api/salary-payments/${editingPayment?.id}`,\n        data,\n      );\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Salary payment updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"salary-payments\"] });\n      setIsDialogOpen(false);\n      resetForm();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update salary payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      staffId: \"\",\n      payPeriodStart: \"\",\n      payPeriodEnd: \"\",\n      basicSalary: \"\",\n      overtimePay: \"\",\n      bonus: \"\",\n      allowances: \"\",\n      deductions: \"\",\n      taxPercentage: \"0\",\n      taxAmount: \"0\",\n      netPay: \"0\",\n      paymentDate: new Date().toISOString().split(\"T\")[0],\n      paymentMethod: \"bank_transfer\",\n      status: \"pending\",\n      notes: \"\",\n    });\n    setEditingPayment(null);\n  };\n\n  // Auto-calculate tax and net pay whenever financial fields change\n  useEffect(() => {\n    const basicSalary = parseFloat(formData.basicSalary) || 0;\n    const overtimePay = parseFloat(formData.overtimePay) || 0;\n    const bonus = parseFloat(formData.bonus) || 0;\n    const allowances = parseFloat(formData.allowances) || 0;\n    const deductions = parseFloat(formData.deductions) || 0;\n    const taxPercentage = parseFloat(formData.taxPercentage) || 0;\n\n    const grossPay = basicSalary + overtimePay + bonus + allowances;\n    const taxAmount = (grossPay * taxPercentage) / 100;\n    const netPay = grossPay - deductions - taxAmount;\n\n    setFormData((prev) => ({\n      ...prev,\n      taxAmount: taxAmount.toFixed(2),\n      netPay: netPay.toFixed(2),\n    }));\n  }, [\n    formData.basicSalary,\n    formData.overtimePay,\n    formData.bonus,\n    formData.allowances,\n    formData.deductions,\n    formData.taxPercentage,\n  ]);\n\n  const handleFormChange = (field: string, value: string) => {\n    setFormData((prev) => ({ ...prev, [field]: value }));\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    const { staffId, payPeriodStart, payPeriodEnd, basicSalary } = formData;\n\n    if (!staffId || !payPeriodStart || !payPeriodEnd || !basicSalary) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (new Date(payPeriodStart) > new Date(payPeriodEnd)) {\n      toast({\n        title: \"Error\",\n        description: \"Pay period start must be before end date\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const submitData = {\n      ...formData,\n      staffId: parseInt(staffId),\n      basicSalary: parseFloat(formData.basicSalary) || 0,\n      overtimePay: parseFloat(formData.overtimePay) || 0,\n      bonus: parseFloat(formData.bonus) || 0,\n      allowances: parseFloat(formData.allowances) || 0,\n      deductions: parseFloat(formData.deductions) || 0,\n      taxPercentage: parseFloat(formData.taxPercentage) || 0,\n      taxAmount: parseFloat(formData.taxAmount) || 0,\n      netPay: parseFloat(formData.netPay) || 0,\n    };\n\n    if (editingPayment) {\n      updateMutation.mutate(submitData);\n    } else {\n      createMutation.mutate(submitData);\n    }\n  };\n\n  const handleEdit = (payment: any) => {\n    setEditingPayment(payment);\n    setFormData({\n      staffId: payment.staffId?.toString() || \"\",\n      payPeriodStart: payment.payPeriodStart\n        ? new Date(payment.payPeriodStart).toISOString().split(\"T\")[0]\n        : \"\",\n      payPeriodEnd: payment.payPeriodEnd\n        ? new Date(payment.payPeriodEnd).toISOString().split(\"T\")[0]\n        : \"\",\n      basicSalary: payment.basicSalary?.toString() || \"0\",\n      overtimePay: payment.overtimePay?.toString() || \"0\",\n      bonus: payment.bonus?.toString() || \"0\",\n      allowances: payment.allowances?.toString() || \"0\",\n      deductions: payment.deductions?.toString() || \"0\",\n      taxPercentage: payment.taxPercentage?.toString() || \"0\",\n      taxAmount: payment.taxAmount?.toString() || \"0\",\n      netPay: payment.netPay?.toString() || \"0\",\n      paymentDate: payment.paymentDate\n        ? new Date(payment.paymentDate).toISOString().split(\"T\")[0]\n        : new Date().toISOString().split(\"T\")[0],\n      paymentMethod: payment.paymentMethod || \"bank_transfer\",\n      status: payment.status || \"pending\",\n      notes: payment.notes || \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const statusConfig = {\n      pending: { variant: \"secondary\" as const, label: \"Pending\" },\n      paid: { variant: \"default\" as const, label: \"Paid\" },\n      cancelled: { variant: \"destructive\" as const, label: \"Cancelled\" },\n    };\n\n    const config =\n      statusConfig[status as keyof typeof statusConfig] || statusConfig.pending;\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  const filteredPayments = (\n    Array.isArray(salaryPayments) ? salaryPayments : []\n  ).filter(\n    (payment: any) =>\n      payment.staffName?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      payment.staffPosition?.toLowerCase().includes(searchQuery.toLowerCase()),\n  );\n\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredPayments,\n    \"paymentDate\",\n  );\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n        <div>\n          <p className=\"text-muted-foreground\">\n            Manage staff salary payments and payroll\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={resetForm}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Salary Payment\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingPayment\n                  ? \"Edit Salary Payment\"\n                  : \"Add New Salary Payment\"}\n              </DialogTitle>\n            </DialogHeader>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"staffId\">Staff Member *</Label>\n                  <Select\n                    value={formData.staffId || undefined}\n                    onValueChange={(value) =>\n                      handleFormChange(\"staffId\", value)\n                    }\n                    disabled={!!editingPayment} // prevent changing staff when editing\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select staff member\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {staff.map((member: any) => (\n                        <SelectItem\n                          key={member.id}\n                          value={member.id.toString()}\n                        >\n                          {member.firstName} {member.lastName} -{\" \"}\n                          {member.position}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"paymentMethod\">Payment Method</Label>\n                  <Select\n                    value={formData.paymentMethod || undefined}\n                    onValueChange={(value) =>\n                      handleFormChange(\"paymentMethod\", value)\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select payment method\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"bank_transfer\">\n                        Bank Transfer\n                      </SelectItem>\n                      <SelectItem value=\"cash\">Cash</SelectItem>\n                      <SelectItem value=\"check\">Check</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"payPeriodStart\">Pay Period Start *</Label>\n                  <Input\n                    id=\"payPeriodStart\"\n                    type=\"date\"\n                    value={formData.payPeriodStart}\n                    onChange={(e) =>\n                      handleFormChange(\"payPeriodStart\", e.target.value)\n                    }\n                    required\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"payPeriodEnd\">Pay Period End *</Label>\n                  <Input\n                    id=\"payPeriodEnd\"\n                    type=\"date\"\n                    value={formData.payPeriodEnd}\n                    onChange={(e) =>\n                      handleFormChange(\"payPeriodEnd\", e.target.value)\n                    }\n                    required\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"basicSalary\">Basic Salary *</Label>\n                  <Input\n                    id=\"basicSalary\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={formData.basicSalary}\n                    onChange={(e) =>\n                      handleFormChange(\"basicSalary\", e.target.value)\n                    }\n                    placeholder=\"0.00\"\n                    required\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"overtimePay\">Overtime Pay</Label>\n                  <Input\n                    id=\"overtimePay\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={formData.overtimePay}\n                    onChange={(e) =>\n                      handleFormChange(\"overtimePay\", e.target.value)\n                    }\n                    placeholder=\"0.00\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"bonus\">Bonus</Label>\n                  <Input\n                    id=\"bonus\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={formData.bonus}\n                    onChange={(e) => handleFormChange(\"bonus\", e.target.value)}\n                    placeholder=\"0.00\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"allowances\">Allowances</Label>\n                  <Input\n                    id=\"allowances\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={formData.allowances}\n                    onChange={(e) =>\n                      handleFormChange(\"allowances\", e.target.value)\n                    }\n                    placeholder=\"0.00\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"deductions\">Deductions</Label>\n                  <Input\n                    id=\"deductions\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={formData.deductions}\n                    onChange={(e) =>\n                      handleFormChange(\"deductions\", e.target.value)\n                    }\n                    placeholder=\"0.00\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"taxPercentage\">Tax Percentage (%)</Label>\n                  <Input\n                    id=\"taxPercentage\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    min=\"0\"\n                    max=\"100\"\n                    value={formData.taxPercentage}\n                    onChange={(e) =>\n                      handleFormChange(\"taxPercentage\", e.target.value)\n                    }\n                    placeholder=\"0.00\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label>Tax Amount (Auto-calculated)</Label>\n                  <Input\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={formData.taxAmount}\n                    readOnly\n                    className=\"bg-gray-50\"\n                  />\n                </div>\n                <div>\n                  <Label>Net Pay (Auto-calculated)</Label>\n                  <Input\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={formData.netPay}\n                    readOnly\n                    className=\"bg-gray-50 font-bold\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"paymentDate\">Payment Date</Label>\n                  <Input\n                    id=\"paymentDate\"\n                    type=\"date\"\n                    value={formData.paymentDate}\n                    onChange={(e) =>\n                      handleFormChange(\"paymentDate\", e.target.value)\n                    }\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"status\">Status</Label>\n                  <Select\n                    value={formData.status || undefined}\n                    onValueChange={(value) => handleFormChange(\"status\", value)}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select status\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"pending\">Pending</SelectItem>\n                      <SelectItem value=\"paid\">Paid</SelectItem>\n                      <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"notes\">Notes</Label>\n                <Textarea\n                  id=\"notes\"\n                  value={formData.notes}\n                  onChange={(e) => handleFormChange(\"notes\", e.target.value)}\n                  placeholder=\"Additional notes\"\n                />\n              </div>\n\n              <div className=\"flex justify-end space-x-2 pt-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={\n                    createMutation.isPending || updateMutation.isPending\n                  }\n                >\n                  {createMutation.isPending || updateMutation.isPending ? (\n                    <>\n                      <Calendar className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Saving...\n                    </>\n                  ) : editingPayment ? (\n                    \"Update\"\n                  ) : (\n                    \"Create\"\n                  )}\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Filters */}\n      <div className=\"flex items-center space-x-4\">\n        <div className=\"flex-1\">\n          <SearchBar\n            placeholder=\"Search salary payments...\"\n            value={searchQuery}\n            onChange={setSearchQuery}\n            className=\"w-full\"\n          />\n        </div>\n        <Select\n          value={selectedStaff || undefined}\n          onValueChange={setSelectedStaff}\n        >\n          <SelectTrigger className=\"w-[200px]\">\n            <SelectValue placeholder=\"Filter by staff\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Staff</SelectItem>\n            {staff.map((member: any) => (\n              <SelectItem key={member.id} value={member.id.toString()}>\n                {member.firstName} {member.lastName}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {/* Salary Payments Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Salary Payments ({sortedData.length})</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {paymentsLoading || staffLoading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto\"></div>\n              <p className=\"text-muted-foreground mt-2\">\n                Loading salary payments...\n              </p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"staffName\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Staff Member\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"payPeriodStart\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Pay Period\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"basicSalary\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Basic Salary\n                    </SortableTableHeader>\n                    <TableHead>Tax (%)</TableHead>\n                    <TableHead>Tax Amount</TableHead>\n                    <SortableTableHeader\n                      sortKey=\"netPay\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Net Pay\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"status\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Status\n                    </SortableTableHeader>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {sortedData.length > 0 ? (\n                    sortedData.map((payment: any) => (\n                      <TableRow key={payment.id}>\n                        <TableCell className=\"font-medium\">\n                          <div>\n                            <div>{payment.staffName}</div>\n                            <div className=\"text-sm text-muted-foreground\">\n                              {payment.staffPosition}\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"text-sm\">\n                            <div>\n                              {new Date(\n                                payment.payPeriodStart,\n                              ).toLocaleDateString()}\n                            </div>\n                            <div className=\"text-muted-foreground\">\n                              to{\" \"}\n                              {new Date(\n                                payment.payPeriodEnd,\n                              ).toLocaleDateString()}\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          Rs. {parseFloat(payment.basicSalary || 0).toFixed(2)}\n                        </TableCell>\n                        <TableCell>{payment.taxPercentage || 0}%</TableCell>\n                        <TableCell>\n                          Rs. {parseFloat(payment.taxAmount || 0).toFixed(2)}\n                        </TableCell>\n                        <TableCell className=\"font-bold\">\n                          Rs. {parseFloat(payment.netPay || 0).toFixed(2)}\n                        </TableCell>\n                        <TableCell>\n                          {getStatusBadge(payment.status || \"pending\")}\n                        </TableCell>\n                        <TableCell>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(payment)}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  ) : (\n                    <TableRow>\n                      <TableCell\n                        colSpan={8}\n                        className=\"text-center py-8 text-muted-foreground\"\n                      >\n                        No salary payments found.\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":25094,"size_tokens":null},"server/insert-comprehensive-data.ts":{"content":"\nimport { db } from \"./db\";\nimport {\n  categories,\n  inventoryCategories,\n  inventoryItems,\n  products,\n  productIngredients,\n  customers,\n  parties,\n  orders,\n  orderItems,\n  purchases,\n  purchaseItems,\n  expenses,\n  assets,\n  productionSchedule,\n  settings,\n  users,\n  units,\n  bills,\n  billItems,\n  inventoryTransactions,\n  auditLogs,\n  permissions,\n  userPermissions\n} from \"../shared/schema\";\nimport bcrypt from \"bcrypt\";\n\nexport async function insertComprehensiveData() {\n  console.log(\"üå± Inserting comprehensive data into all tables...\");\n  \n  try {\n    // Clear existing data in reverse order to handle foreign key constraints\n    console.log(\"üßπ Clearing existing data...\");\n    await db.delete(billItems);\n    await db.delete(bills);\n    await db.delete(orderItems);\n    await db.delete(orders);\n    await db.delete(productIngredients);\n    await db.delete(products);\n    await db.delete(categories);\n    await db.delete(purchaseItems);\n    await db.delete(purchases);\n    await db.delete(inventoryTransactions);\n    await db.delete(inventoryItems);\n    await db.delete(inventoryCategories);\n    await db.delete(customers);\n    await db.delete(parties);\n    await db.delete(expenses);\n    await db.delete(assets);\n    await db.delete(productionSchedule);\n    await db.delete(settings);\n    await db.delete(userPermissions);\n    await db.delete(permissions);\n    await db.delete(auditLogs);\n    await db.delete(users);\n    await db.delete(units);\n\n    // 1. Insert Units\n    console.log(\"üìè Inserting units...\");\n    const unitData = [\n      { name: \"Kilogram\", abbreviation: \"kg\", type: \"weight\", isActive: true },\n      { name: \"Gram\", abbreviation: \"g\", type: \"weight\", isActive: true },\n      { name: \"Liter\", abbreviation: \"l\", type: \"volume\", isActive: true },\n      { name: \"Milliliter\", abbreviation: \"ml\", type: \"volume\", isActive: true },\n      { name: \"Piece\", abbreviation: \"pcs\", type: \"count\", isActive: true },\n      { name: \"Dozen\", abbreviation: \"dz\", type: \"count\", isActive: true },\n      { name: \"Box\", abbreviation: \"box\", type: \"count\", isActive: true },\n      { name: \"Pack\", abbreviation: \"pack\", type: \"count\", isActive: true },\n      { name: \"Bottle\", abbreviation: \"btl\", type: \"count\", isActive: true },\n      { name: \"Bag\", abbreviation: \"bag\", type: \"count\", isActive: true }\n    ];\n    const insertedUnits = await db.insert(units).values(unitData).returning();\n\n    // 2. Insert Users\n    console.log(\"üë• Inserting users...\");\n    const userData = [\n      {\n        id: `super_admin_${Date.now()}`,\n        email: \"superadmin@bakesewa.com\",\n        password: await bcrypt.hash(\"superadmin123\", 10),\n        firstName: \"Super\",\n        lastName: \"Admin\",\n        role: \"super_admin\"\n      },\n      {\n        id: `admin_${Date.now()}`,\n        email: \"admin@bakesewa.com\",\n        password: await bcrypt.hash(\"admin123\", 10),\n        firstName: \"Admin\",\n        lastName: \"User\",\n        role: \"admin\"\n      },\n      {\n        id: `manager_${Date.now()}`,\n        email: \"manager@bakesewa.com\",\n        password: await bcrypt.hash(\"manager123\", 10),\n        firstName: \"Manager\",\n        lastName: \"User\",\n        role: \"manager\"\n      },\n      {\n        id: `staff_${Date.now()}`,\n        email: \"staff@bakesewa.com\",\n        password: await bcrypt.hash(\"staff123\", 10),\n        firstName: \"Staff\",\n        lastName: \"User\",\n        role: \"staff\"\n      }\n    ];\n    const insertedUsers = await db.insert(users).values(userData).returning();\n\n    // 3. Insert Permissions\n    console.log(\"üîê Inserting permissions...\");\n    const permissionData = [\n      { name: \"view_dashboard\", description: \"View dashboard\" },\n      { name: \"manage_users\", description: \"Manage users\" },\n      { name: \"manage_products\", description: \"Manage products\" },\n      { name: \"manage_inventory\", description: \"Manage inventory\" },\n      { name: \"manage_orders\", description: \"Manage orders\" },\n      { name: \"manage_purchases\", description: \"Manage purchases\" },\n      { name: \"view_reports\", description: \"View reports\" },\n      { name: \"manage_settings\", description: \"Manage settings\" }\n    ];\n    const insertedPermissions = await db.insert(permissions).values(permissionData).returning();\n\n    // 4. Insert Categories\n    console.log(\"üìÇ Inserting product categories...\");\n    const categoryData = [\n      { name: \"Cakes & Pastries\", description: \"All types of cakes, cupcakes, and pastries\" },\n      { name: \"Breads & Rolls\", description: \"Fresh baked breads and dinner rolls\" },\n      { name: \"Cookies & Biscuits\", description: \"Various cookies and biscuits\" },\n      { name: \"Seasonal Items\", description: \"Holiday and seasonal specialty items\" },\n      { name: \"Custom Orders\", description: \"Custom made items for special occasions\" }\n    ];\n    const insertedCategories = await db.insert(categories).values(categoryData).returning();\n\n    // 5. Insert Inventory Categories\n    console.log(\"üì¶ Inserting inventory categories...\");\n    const invCategoryData = [\n      { name: \"Baking Ingredients\", description: \"Flour, sugar, eggs, etc.\" },\n      { name: \"Dairy Products\", description: \"Milk, butter, cream, cheese\" },\n      { name: \"Flavorings\", description: \"Vanilla, chocolate, spices\" },\n      { name: \"Packaging\", description: \"Boxes, bags, containers\" },\n      { name: \"Equipment\", description: \"Baking tools and equipment\" }\n    ];\n    const insertedInvCategories = await db.insert(inventoryCategories).values(invCategoryData).returning();\n\n    // 6. Insert Inventory Items\n    console.log(\"üìã Inserting inventory items...\");\n    const inventoryData = [\n      {\n        name: \"All-Purpose Flour\",\n        currentStock: \"50.00\",\n        minLevel: \"10.00\",\n        unit: \"kg\",\n        costPerUnit: \"2.50\",\n        supplier: \"Premium Flour Co.\",\n        categoryId: insertedInvCategories[0].id,\n        lastRestocked: new Date()\n      },\n      {\n        name: \"Granulated Sugar\",\n        currentStock: \"25.00\",\n        minLevel: \"5.00\",\n        unit: \"kg\",\n        costPerUnit: \"1.80\",\n        supplier: \"Sweet Supply Inc.\",\n        categoryId: insertedInvCategories[0].id,\n        lastRestocked: new Date()\n      },\n      {\n        name: \"Fresh Eggs\",\n        currentStock: \"120.00\",\n        minLevel: \"24.00\",\n        unit: \"pieces\",\n        costPerUnit: \"0.25\",\n        supplier: \"Farm Fresh Eggs\",\n        categoryId: insertedInvCategories[1].id,\n        lastRestocked: new Date()\n      },\n      {\n        name: \"Unsalted Butter\",\n        currentStock: \"15.00\",\n        minLevel: \"3.00\",\n        unit: \"kg\",\n        costPerUnit: \"8.50\",\n        supplier: \"Dairy Best Ltd.\",\n        categoryId: insertedInvCategories[1].id,\n        lastRestocked: new Date()\n      },\n      {\n        name: \"Vanilla Extract\",\n        currentStock: \"2.00\",\n        minLevel: \"0.50\",\n        unit: \"liters\",\n        costPerUnit: \"45.00\",\n        supplier: \"Flavor Masters\",\n        categoryId: insertedInvCategories[2].id,\n        lastRestocked: new Date()\n      }\n    ];\n    const insertedInventory = await db.insert(inventoryItems).values(inventoryData).returning();\n\n    // 7. Insert Products\n    console.log(\"üç∞ Inserting products...\");\n    const productData = [\n      {\n        name: \"Chocolate Birthday Cake\",\n        description: \"Rich chocolate cake with chocolate frosting\",\n        categoryId: insertedCategories[0].id,\n        price: \"35.00\",\n        cost: \"18.50\",\n        margin: \"47.14\",\n        sku: \"CHOC-CAKE-001\",\n        isActive: true\n      },\n      {\n        name: \"Vanilla Cupcakes (6-pack)\",\n        description: \"Fluffy vanilla cupcakes with buttercream frosting\",\n        categoryId: insertedCategories[0].id,\n        price: \"12.00\",\n        cost: \"6.25\",\n        margin: \"47.92\",\n        sku: \"VAN-CUP-006\",\n        isActive: true\n      },\n      {\n        name: \"Fresh Croissants\",\n        description: \"Buttery, flaky French croissants\",\n        categoryId: insertedCategories[1].id,\n        price: \"3.50\",\n        cost: \"1.75\",\n        margin: \"50.00\",\n        sku: \"CROIS-001\",\n        isActive: true\n      }\n    ];\n    const insertedProducts = await db.insert(products).values(productData).returning();\n\n    // 8. Insert Product Ingredients\n    console.log(\"ü•Ñ Inserting product ingredients...\");\n    const ingredientData = [\n      { productId: insertedProducts[0].id, inventoryItemId: insertedInventory[0].id, quantity: \"0.50\", unit: \"kg\" },\n      { productId: insertedProducts[0].id, inventoryItemId: insertedInventory[1].id, quantity: \"0.40\", unit: \"kg\" },\n      { productId: insertedProducts[1].id, inventoryItemId: insertedInventory[0].id, quantity: \"0.30\", unit: \"kg\" },\n      { productId: insertedProducts[1].id, inventoryItemId: insertedInventory[1].id, quantity: \"0.20\", unit: \"kg\" }\n    ];\n    await db.insert(productIngredients).values(ingredientData);\n\n    // 9. Insert Customers\n    console.log(\"üë• Inserting customers...\");\n    const customerData = [\n      {\n        name: \"Sarah Johnson\",\n        email: \"sarah.johnson@email.com\",\n        phone: \"+1-555-0123\",\n        address: \"123 Main Street, Cityville, ST 12345\",\n        remainingBalance: \"0.00\",\n        isActive: true\n      },\n      {\n        name: \"Michael Chen\",\n        email: \"michael.chen@email.com\",\n        phone: \"+1-555-0456\",\n        address: \"456 Oak Avenue, Townsburg, ST 67890\",\n        remainingBalance: \"25.50\",\n        isActive: true\n      },\n      {\n        name: \"Emily Davis\",\n        email: \"emily.davis@email.com\",\n        phone: \"+1-555-0789\",\n        address: \"789 Pine Road, Villageton, ST 13579\",\n        remainingBalance: \"0.00\",\n        isActive: true\n      }\n    ];\n    const insertedCustomers = await db.insert(customers).values(customerData).returning();\n\n    // 10. Insert Parties (Suppliers)\n    console.log(\"üè¢ Inserting suppliers/parties...\");\n    const partyData = [\n      {\n        name: \"Premium Flour Co.\",\n        type: \"supplier\",\n        contactPerson: \"John Smith\",\n        email: \"orders@premiumflour.com\",\n        phone: \"+1-555-1111\",\n        address: \"100 Industrial Way, Flour City, ST 11111\",\n        balance: \"1250.00\",\n        isActive: true\n      },\n      {\n        name: \"Dairy Best Ltd.\",\n        type: \"supplier\",\n        contactPerson: \"Maria Rodriguez\",\n        email: \"supply@dairybest.com\",\n        phone: \"+1-555-2222\",\n        address: \"200 Farm Road, Dairy Valley, ST 22222\",\n        balance: \"850.50\",\n        isActive: true\n      }\n    ];\n    const insertedParties = await db.insert(parties).values(partyData).returning();\n\n    // 11. Insert Orders\n    console.log(\"üìù Inserting orders...\");\n    const orderData = [\n      {\n        customerName: \"Sarah Johnson\",\n        customerId: insertedCustomers[0].id,\n        customerEmail: \"sarah.johnson@email.com\",\n        customerPhone: \"+1-555-0123\",\n        totalAmount: \"47.00\",\n        status: \"completed\",\n        paymentMethod: \"credit_card\",\n        deliveryDate: new Date(Date.now() + 24 * 60 * 60 * 1000),\n        notes: \"Birthday party order\"\n      },\n      {\n        customerName: \"Michael Chen\",\n        customerId: insertedCustomers[1].id,\n        customerEmail: \"michael.chen@email.com\",\n        customerPhone: \"+1-555-0456\",\n        totalAmount: \"24.00\",\n        status: \"pending\",\n        paymentMethod: \"cash\",\n        deliveryDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000),\n        notes: \"Office meeting order\"\n      }\n    ];\n    const insertedOrders = await db.insert(orders).values(orderData).returning();\n\n    // 12. Insert Order Items\n    console.log(\"üõí Inserting order items...\");\n    const orderItemData = [\n      { orderId: insertedOrders[0].id, productId: insertedProducts[0].id, quantity: 1, unitPrice: \"35.00\", totalPrice: \"35.00\" },\n      { orderId: insertedOrders[0].id, productId: insertedProducts[1].id, quantity: 1, unitPrice: \"12.00\", totalPrice: \"12.00\" },\n      { orderId: insertedOrders[1].id, productId: insertedProducts[1].id, quantity: 2, unitPrice: \"12.00\", totalPrice: \"24.00\" }\n    ];\n    await db.insert(orderItems).values(orderItemData);\n\n    // 13. Insert Purchases\n    console.log(\"üí∞ Inserting purchases...\");\n    const purchaseData = [\n      {\n        supplierName: \"Premium Flour Co.\",\n        partyId: insertedParties[0].id,\n        totalAmount: \"125.00\",\n        paymentMethod: \"bank_transfer\",\n        status: \"completed\",\n        purchaseDate: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000),\n        invoiceNumber: \"PFC-2024-001\",\n        notes: \"Monthly flour order\"\n      }\n    ];\n    const insertedPurchases = await db.insert(purchases).values(purchaseData).returning();\n\n    // 14. Insert Purchase Items\n    console.log(\"üì¶ Inserting purchase items...\");\n    const purchaseItemData = [\n      { purchaseId: insertedPurchases[0].id, inventoryItemId: insertedInventory[0].id, quantity: \"50.00\", unitPrice: \"2.50\", totalPrice: \"125.00\" }\n    ];\n    await db.insert(purchaseItems).values(purchaseItemData);\n\n    // 15. Insert Bills\n    console.log(\"üßæ Inserting bills...\");\n    const billData = [\n      {\n        billNumber: \"BILL-2024-001\",\n        customerId: insertedCustomers[0].id,\n        customerName: \"Sarah Johnson\",\n        billDate: new Date(),\n        dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),\n        totalAmount: \"47.00\",\n        discount: \"0.00\",\n        tax: \"3.76\",\n        status: \"pending\",\n        notes: \"Birthday cake order\"\n      }\n    ];\n    const insertedBills = await db.insert(bills).values(billData).returning();\n\n    // 16. Insert Bill Items\n    console.log(\"üìã Inserting bill items...\");\n    const billItemData = [\n      {\n        billId: insertedBills[0].id,\n        productId: insertedProducts[0].id,\n        productName: \"Chocolate Birthday Cake\",\n        quantity: 1,\n        unitPrice: \"35.00\",\n        totalPrice: \"35.00\"\n      }\n    ];\n    await db.insert(billItems).values(billItemData);\n\n    // 17. Insert Expenses\n    console.log(\"üí∏ Inserting expenses...\");\n    const expenseData = [\n      {\n        title: \"Monthly rent for bakery\",\n        amount: \"2500.00\",\n        category: \"rent\",\n        date: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),\n        description: \"Monthly bakery space rental\",\n        createdBy: insertedUsers[0].id\n      },\n      {\n        title: \"Electricity bill\",\n        amount: \"180.50\",\n        category: \"utilities\",\n        date: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000),\n        description: \"Monthly electricity charges\",\n        createdBy: insertedUsers[1].id\n      }\n    ];\n    await db.insert(expenses).values(expenseData);\n\n    // 18. Insert Assets\n    console.log(\"üè≠ Inserting assets...\");\n    const assetData = [\n      {\n        name: \"Commercial Stand Mixer\",\n        category: \"equipment\",\n        purchasePrice: \"1250.00\",\n        currentValue: \"950.00\",\n        purchaseDate: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n        location: \"Main kitchen\",\n        condition: \"good\",\n        description: \"20-quart capacity, serviced annually\"\n      },\n      {\n        name: \"Convection Oven\",\n        category: \"equipment\",\n        purchasePrice: \"3500.00\",\n        currentValue: \"2800.00\",\n        purchaseDate: new Date(Date.now() - 2 * 365 * 24 * 60 * 60 * 1000),\n        location: \"Main kitchen\",\n        condition: \"excellent\",\n        description: \"Double rack, energy efficient\"\n      }\n    ];\n    await db.insert(assets).values(assetData);\n\n    // 19. Insert Production Schedule\n    console.log(\"‚è∞ Inserting production schedule...\");\n    const scheduleData = [\n      {\n        productId: insertedProducts[0].id,\n        quantity: 5,\n        scheduledDate: new Date(Date.now() + 24 * 60 * 60 * 1000),\n        startTime: new Date(Date.now() + 24 * 60 * 60 * 1000 + 8 * 60 * 60 * 1000),\n        endTime: new Date(Date.now() + 24 * 60 * 60 * 1000 + 12 * 60 * 60 * 1000),\n        assignedTo: \"Baker Team A\",\n        notes: \"Weekend orders - chocolate cakes\",\n        status: \"scheduled\"\n      }\n    ];\n    await db.insert(productionSchedule).values(scheduleData);\n\n    // 20. Insert Inventory Transactions\n    console.log(\"üìä Inserting inventory transactions...\");\n    const transactionData = [\n      {\n        inventoryItemId: insertedInventory[0].id,\n        type: \"purchase\",\n        quantity: \"50.00\",\n        reason: \"Monthly stock replenishment\",\n        reference: \"PFC-2024-001\",\n        createdBy: insertedUsers[0].id\n      },\n      {\n        inventoryItemId: insertedInventory[0].id,\n        type: \"usage\",\n        quantity: \"-5.00\",\n        reason: \"Production consumption\",\n        reference: \"PROD-001\",\n        createdBy: insertedUsers[2].id\n      }\n    ];\n    await db.insert(inventoryTransactions).values(transactionData);\n\n    // 21. Insert Settings\n    console.log(\"‚öôÔ∏è Inserting settings...\");\n    const settingsData = [\n      { key: \"business_name\", value: \"Sweet Treats Bakery\" },\n      { key: \"business_address\", value: \"123 Baker Street, Sweet City, ST 12345\" },\n      { key: \"business_phone\", value: \"+1-555-BAKERY\" },\n      { key: \"business_email\", value: \"orders@sweettreats.com\" },\n      { key: \"tax_rate\", value: \"8.5\" },\n      { key: \"currency\", value: \"USD\" },\n      { key: \"labor_cost_per_hour\", value: \"25.00\" },\n      { key: \"overhead_percentage\", value: \"15.0\" }\n    ];\n    await db.insert(settings).values(settingsData);\n\n    // 22. Insert Audit Logs\n    console.log(\"üìù Inserting audit logs...\");\n    const auditData = [\n      {\n        userId: insertedUsers[0].id,\n        action: \"CREATE\",\n        tableName: \"products\",\n        recordId: insertedProducts[0].id.toString(),\n        oldValues: null,\n        newValues: JSON.stringify({ name: \"Chocolate Birthday Cake\", price: \"35.00\" }),\n        ipAddress: \"192.168.1.1\",\n        userAgent: \"System Setup\"\n      },\n      {\n        userId: insertedUsers[1].id,\n        action: \"CREATE\",\n        tableName: \"orders\",\n        recordId: insertedOrders[0].id.toString(),\n        oldValues: null,\n        newValues: JSON.stringify({ customerName: \"Sarah Johnson\", totalAmount: \"47.00\" }),\n        ipAddress: \"192.168.1.2\",\n        userAgent: \"System Setup\"\n      }\n    ];\n    await db.insert(auditLogs).values(auditData);\n\n    console.log(\"üéâ Comprehensive data insertion completed successfully!\");\n    console.log(\"\\n=== SUMMARY ===\");\n    console.log(`‚úÖ Units: ${insertedUnits.length}`);\n    console.log(`‚úÖ Users: ${insertedUsers.length}`);\n    console.log(`‚úÖ Permissions: ${insertedPermissions.length}`);\n    console.log(`‚úÖ Categories: ${insertedCategories.length}`);\n    console.log(`‚úÖ Inventory Categories: ${insertedInvCategories.length}`);\n    console.log(`‚úÖ Inventory Items: ${insertedInventory.length}`);\n    console.log(`‚úÖ Products: ${insertedProducts.length}`);\n    console.log(`‚úÖ Customers: ${insertedCustomers.length}`);\n    console.log(`‚úÖ Suppliers: ${insertedParties.length}`);\n    console.log(`‚úÖ Orders: ${insertedOrders.length}`);\n    console.log(`‚úÖ Purchases: ${insertedPurchases.length}`);\n    console.log(`‚úÖ Bills: ${insertedBills.length}`);\n    \n    console.log(\"\\n=== LOGIN CREDENTIALS ===\");\n    console.log(\"üìß Super Admin: superadmin@bakesewa.com | üîê Password: superadmin123\");\n    console.log(\"üìß Admin: admin@bakesewa.com | üîê Password: admin123\");\n    console.log(\"üìß Manager: manager@bakesewa.com | üîê Password: manager123\");\n    console.log(\"üìß Staff: staff@bakesewa.com | üîê Password: staff123\");\n    console.log(\"=========================\");\n\n    return {\n      success: true,\n      message: \"All tables populated with comprehensive sample data\",\n      counts: {\n        units: insertedUnits.length,\n        users: insertedUsers.length,\n        permissions: insertedPermissions.length,\n        categories: insertedCategories.length,\n        inventoryCategories: insertedInvCategories.length,\n        inventoryItems: insertedInventory.length,\n        products: insertedProducts.length,\n        customers: insertedCustomers.length,\n        suppliers: insertedParties.length,\n        orders: insertedOrders.length,\n        purchases: insertedPurchases.length,\n        bills: insertedBills.length\n      }\n    };\n    \n  } catch (error) {\n    console.error(\"‚ùå Error inserting comprehensive data:\", error);\n    throw error;\n  }\n}\n\n// Run if this file is executed directly\nif (import.meta.url === `file://${process.argv[1]}`) {\n  insertComprehensiveData().then((result) => {\n    console.log(\"‚úÖ Process completed:\", result.message);\n    process.exit(0);\n  }).catch((error) => {\n    console.error(\"‚ùå Process failed:\", error);\n    process.exit(1);\n  });\n}\n","path":null,"size_bytes":20557,"size_tokens":null},"client/src/pages/production.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport SearchBar from \"@/components/search-bar\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n  usePagination,\n} from \"@/components/ui/pagination\";\nimport {\n  Plus,\n  Search,\n  Edit,\n  Trash2,\n  Clock,\n  Check,\n  Target,\n  Printer,\n  AlertCircle,\n  Calendar,\n} from \"lucide-react\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\n\ninterface ProductionItem {\n  id: number;\n  productId: number;\n  productName: string;\n  productCode?: string;\n  batchNo?: string;\n  totalQuantity: number;\n  unitType: string;\n  actualQuantityPackets?: number;\n  priority: string;\n  productionStartTime?: string;\n  productionEndTime?: string;\n  assignedTo?: string;\n  notes?: string;\n  status: string;\n  scheduleDate: string;\n  shift: string;\n  plannedBy?: string;\n  approvedBy?: string;\n}\n\nexport default function Production() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingProduction, setEditingProduction] =\n    useState<ProductionItem | null>(null);\n  const [selectedProductId, setSelectedProductId] = useState(\"\");\n  const [selectedStatus, setSelectedStatus] = useState(\"\");\n  const [selectedShift, setSelectedShift] = useState(\"Morning\");\n  const [selectedPriority, setSelectedPriority] = useState(\"medium\");\n  const [showHistory, setShowHistory] = useState(false);\n  const [historyDateFilter, setHistoryDateFilter] = useState(\"\");\n  const { toast } = useToast();\n\n  // For search and filtering\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n\n  // Fetch products\n  const { data: products = [] } = useQuery({\n    queryKey: [\"products\"],\n    queryFn: async () => {\n      try {\n        const res = await apiRequest(\"GET\", \"/api/products\");\n        return Array.isArray(res) ? res : res.products || [];\n      } catch (error) {\n        console.error(\"Failed to fetch products:\", error);\n        return [];\n      }\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Fetch production schedule\n  const {\n    data: productionSchedule = [],\n    isLoading,\n    isError,\n    error,\n  } = useQuery({\n    queryKey: [\"production-schedule\"],\n    queryFn: async () => {\n      const res = await apiRequest(\"GET\", \"/api/production-schedule\");\n      return Array.isArray(res) ? res : res.schedule || [];\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Fetch production history\n  const { data: productionHistory = [] } = useQuery({\n    queryKey: [\"production-schedule-history\", historyDateFilter],\n    queryFn: async () => {\n      const url = historyDateFilter\n        ? `/api/production-schedule-history?date=${historyDateFilter}`\n        : \"/api/production-schedule-history\";\n      const res = await apiRequest(\"GET\", url);\n      return Array.isArray(res) ? res : res.history || [];\n    },\n    enabled: showHistory,\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Create production mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      await apiRequest(\"POST\", \"/api/production-schedule\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"production-schedule\"] });\n      setIsDialogOpen(false);\n      setEditingProduction(null);\n      resetFormFields();\n      toast({\n        title: \"Success\",\n        description: \"Production item scheduled successfully\",\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => (window.location.href = \"/api/login\"), 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to schedule production\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update production mutation\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      await apiRequest(\"PUT\", `/api/production-schedule/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"production-schedule\"] });\n      setIsDialogOpen(false);\n      setEditingProduction(null);\n      resetFormFields();\n      toast({\n        title: \"Success\",\n        description: \"Production item updated successfully\",\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => (window.location.href = \"/api/login\"), 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to update production\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete production mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/production-schedule/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"production-schedule\"] });\n      toast({\n        title: \"Success\",\n        description: \"Production item deleted successfully\",\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => (window.location.href = \"/api/login\"), 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete production item\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Close day mutation\n  const closeDayMutation = useMutation({\n    mutationFn: async () => {\n      const today = new Date().toISOString().split(\"T\")[0];\n      await apiRequest(\"POST\", \"/api/production-schedule/close-day\", {\n        date: today,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"production-schedule\"] });\n      queryClient.invalidateQueries({\n        queryKey: [\"production-schedule-history\"],\n      });\n      toast({\n        title: \"Success\",\n        description:\n          \"Production day closed successfully. All items moved to history.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to close production day\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Print label mutation\n  const printLabelMutation = useMutation({\n    mutationFn: async (productionItem: ProductionItem) => {\n      // Generate label data\n      const labelData = {\n        productName: productionItem.productName,\n        productCode: productionItem.productCode,\n        batchNo: productionItem.batchNo,\n        totalQuantity: productionItem.totalQuantity,\n        actualQuantityPackets: productionItem.actualQuantityPackets,\n        unitType: productionItem.unitType,\n        productionDate: productionItem.scheduleDate,\n        assignedTo: productionItem.assignedTo,\n      };\n\n      // Create a new window for printing\n      const printWindow = window.open(\"\", \"_blank\");\n      if (printWindow) {\n        printWindow.document.write(`\n          <html>\n            <head>\n              <title>Production Label - ${productionItem.productName}</title>\n              <style>\n                body { font-family: Arial, sans-serif; margin: 20px; }\n                .label { border: 2px solid #000; padding: 15px; max-width: 300px; }\n                .label h2 { margin: 0 0 10px 0; font-size: 18px; }\n                .label p { margin: 5px 0; font-size: 14px; }\n                .label .batch { font-weight: bold; background: #f0f0f0; padding: 5px; }\n                @media print { body { margin: 0; } }\n              </style>\n            </head>\n            <body>\n              <div class=\"label\">\n                <h2>${labelData.productName}</h2>\n                <p><strong>Product Code:</strong> ${labelData.productCode || \"N/A\"}</p>\n                <p class=\"batch\"><strong>Batch No:</strong> ${labelData.batchNo || \"N/A\"}</p>\n                <p><strong>Quantity:</strong> ${labelData.totalQuantity} ${labelData.unitType}</p>\n                ${labelData.actualQuantityPackets ? `<p><strong>Packets:</strong> ${labelData.actualQuantityPackets}</p>` : \"\"}\n                <p><strong>Production Date:</strong> ${new Date(labelData.productionDate).toLocaleDateString()}</p>\n                <p><strong>Assigned To:</strong> ${labelData.assignedTo || \"N/A\"}</p>\n              </div>\n            </body>\n          </html>\n        `);\n        printWindow.document.close();\n        printWindow.print();\n      }\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Label printed successfully\",\n      });\n    },\n  });\n\n  const resetFormFields = () => {\n    setSelectedProductId(\"\");\n    setSelectedStatus(\"\");\n    setSelectedShift(\"Morning\");\n    setSelectedPriority(\"medium\");\n  };\n\n  const handleSave = (e: React.FormEvent) => {\n    e.preventDefault();\n    const formData = new FormData(e.target as HTMLFormElement);\n\n    const productId = parseInt(selectedProductId);\n    const totalQuantity = parseFloat(formData.get(\"totalQuantity\") as string);\n    const scheduleDate = formData.get(\"scheduleDate\") as string;\n    const productionStartTime = formData.get(\"productionStartTime\") as string;\n    const productionEndTime = formData.get(\"productionEndTime\") as string;\n    const status = selectedStatus;\n    const assignedTo = formData.get(\"assignedTo\") as string;\n    const notes = formData.get(\"notes\") as string;\n    const productCode = formData.get(\"productCode\") as string;\n    const batchNo = formData.get(\"batchNo\") as string;\n    const unitType = formData.get(\"unitType\") as string;\n    const actualQuantityPackets = formData.get(\n      \"actualQuantityPackets\",\n    ) as string;\n    const plannedBy = formData.get(\"plannedBy\") as string;\n    const approvedBy = formData.get(\"approvedBy\") as string;\n\n    if (!productId || !totalQuantity || !scheduleDate || !status) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fill all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const data = {\n      productId,\n      scheduleDate,\n      shift: selectedShift,\n      plannedBy: plannedBy || null,\n      approvedBy: approvedBy || null,\n      status,\n      productCode: productCode || null,\n      batchNo: batchNo || null,\n      totalQuantity,\n      unitType: unitType || \"kg\",\n      actualQuantityPackets: actualQuantityPackets\n        ? parseFloat(actualQuantityPackets)\n        : null,\n      priority: selectedPriority,\n      productionStartTime: productionStartTime || null,\n      productionEndTime: productionEndTime || null,\n      assignedTo: assignedTo || null,\n      notes: notes || null,\n      // Legacy fields for compatibility\n      quantity: totalQuantity,\n      scheduledDate: scheduleDate,\n      startTime: productionStartTime || null,\n      endTime: productionEndTime || null,\n    };\n\n    if (editingProduction) {\n      updateMutation.mutate({ id: editingProduction.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const handleCloseDay = () => {\n    if (\n      window.confirm(\n        \"Are you sure you want to close the day? This will move all current production items to history and clear the current schedule.\",\n      )\n    ) {\n      closeDayMutation.mutate();\n    }\n  };\n\n  const getStatusBadgeVariant = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"default\";\n      case \"in_progress\":\n        return \"secondary\";\n      case \"scheduled\":\n        return \"outline\";\n      case \"draft\":\n        return \"outline\";\n      case \"cancelled\":\n        return \"destructive\";\n      default:\n        return \"outline\";\n    }\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case \"high\":\n        return \"bg-red-100 text-red-800 border-red-200\";\n      case \"medium\":\n        return \"bg-yellow-100 text-yellow-800 border-yellow-200\";\n      case \"low\":\n        return \"bg-green-100 text-green-800 border-green-200\";\n      default:\n        return \"bg-yellow-100 text-yellow-800 border-yellow-200\";\n    }\n  };\n\n  // Set form values when editing\n  useEffect(() => {\n    if (editingProduction) {\n      setSelectedProductId(editingProduction.productId.toString());\n      setSelectedStatus(editingProduction.status);\n      setSelectedShift(editingProduction.shift || \"Morning\");\n      setSelectedPriority(editingProduction.priority || \"medium\");\n    } else {\n      resetFormFields();\n    }\n  }, [editingProduction]);\n\n  // Calculate totals\n  const totalPlanned = productionSchedule.reduce(\n    (sum: number, item: any) =>\n      sum + (item.totalQuantity || item.quantity || 0),\n    0,\n  );\n  const totalActual = productionSchedule.reduce(\n    (sum: number, item: any) =>\n      sum + (item.actualQuantityPackets || item.actualQuantity || 0),\n    0,\n  );\n\n  // Filter and sort data\n  const filteredSchedule = productionSchedule.filter((item: any) => {\n    const matchesSearch =\n      item.productName?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      item.notes?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      item.productCode?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      item.batchNo?.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesStatus =\n      statusFilter === \"all\" || item.status === statusFilter;\n    return matchesSearch && matchesStatus;\n  });\n\n  // Add sorting functionality\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredSchedule,\n    \"scheduleDate\",\n  );\n\n  // Add pagination functionality\n  const {\n    currentItems,\n    currentPage,\n    totalPages,\n    pageSize,\n    setPageSize,\n    goToPage,\n    totalItems,\n  } = usePagination(sortedData, 10);\n\n  const displayData = showHistory ? productionHistory : currentItems;\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-6\">\n      {/* Header with Statistics */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600\">\n            Plan and track your production activities\n          </p>\n          <div className=\"flex gap-4 mt-2 text-sm\">\n            <span className=\"flex items-center gap-1\">\n              <Target className=\"h-4 w-4 text-blue-600\" />\n              <strong>Planned Quantity:</strong> {totalPlanned}\n            </span>\n            <span className=\"flex items-center gap-1\">\n              <Check className=\"h-4 w-4 text-green-600\" />\n              <strong>Actual Production:</strong> {totalActual}\n            </span>\n          </div>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button\n            onClick={() => setShowHistory(!showHistory)}\n            variant=\"outline\"\n          >\n            <Calendar className=\"h-4 w-4 mr-2\" />\n            {showHistory ? \"Current Schedule\" : \"View History\"}\n          </Button>\n          <Button\n            onClick={handleCloseDay}\n            variant=\"outline\"\n            disabled={closeDayMutation.isPending}\n          >\n            <Clock className=\"h-4 w-4 mr-2\" />\n            {closeDayMutation.isPending ? \"Closing...\" : \"Close Day\"}\n          </Button>\n          <Dialog\n            open={isDialogOpen}\n            onOpenChange={(open) => {\n              setIsDialogOpen(open);\n              if (!open) {\n                setEditingProduction(null);\n                resetFormFields();\n              }\n            }}\n          >\n            <DialogTrigger asChild>\n              <Button\n                onClick={() => setEditingProduction(null)}\n                className=\"w-full sm:w-auto\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Schedule Production\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl mx-auto max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>\n                  {editingProduction\n                    ? \"Edit Production Item\"\n                    : \"Schedule New Production\"}\n                </DialogTitle>\n                <DialogDescription>\n                  Enter production details below\n                </DialogDescription>\n              </DialogHeader>\n              <form onSubmit={handleSave} className=\"space-y-4\">\n                {/* Schedule Information Header */}\n                <div className=\"bg-gray-50 p-4 rounded-lg\">\n                  <h3 className=\"font-semibold mb-3\">Schedule Information</h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Schedule Date *\n                      </label>\n                      <Input\n                        name=\"scheduleDate\"\n                        type=\"date\"\n                        defaultValue={\n                          editingProduction?.scheduleDate ||\n                          new Date().toISOString().split(\"T\")[0]\n                        }\n                        required\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Shift\n                      </label>\n                      <Select\n                        value={selectedShift}\n                        onValueChange={setSelectedShift}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select Shift\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"Morning\">Morning</SelectItem>\n                          <SelectItem value=\"Afternoon\">Afternoon</SelectItem>\n                          <SelectItem value=\"Night\">Night</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Planned By\n                      </label>\n                      <Input\n                        name=\"plannedBy\"\n                        placeholder=\"Name of planner/supervisor\"\n                        defaultValue={editingProduction?.plannedBy || \"\"}\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Approved By\n                      </label>\n                      <Input\n                        name=\"approvedBy\"\n                        placeholder=\"Manager approval\"\n                        defaultValue={editingProduction?.approvedBy || \"\"}\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Status *\n                      </label>\n                      <Select\n                        value={selectedStatus}\n                        onValueChange={setSelectedStatus}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select Status\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"draft\">Draft</SelectItem>\n                          <SelectItem value=\"scheduled\">Scheduled</SelectItem>\n                          <SelectItem value=\"in_progress\">\n                            In Progress\n                          </SelectItem>\n                          <SelectItem value=\"completed\">Completed</SelectItem>\n                          <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Product Information */}\n                <div className=\"bg-blue-50 p-4 rounded-lg\">\n                  <h3 className=\"font-semibold mb-3\">Product Information</h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Product *\n                      </label>\n                      <Select\n                        value={selectedProductId}\n                        onValueChange={setSelectedProductId}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select Product\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {products.map((product: any) => (\n                            <SelectItem\n                              key={product.id}\n                              value={product.id.toString()}\n                            >\n                              {product.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Product Code/SKU\n                      </label>\n                      <Input\n                        name=\"productCode\"\n                        placeholder=\"Product code or SKU\"\n                        defaultValue={editingProduction?.productCode || \"\"}\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Batch No\n                      </label>\n                      <Input\n                        name=\"batchNo\"\n                        placeholder=\"Batch number\"\n                        defaultValue={editingProduction?.batchNo || \"\"}\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Priority\n                      </label>\n                      <Select\n                        value={selectedPriority}\n                        onValueChange={setSelectedPriority}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select Priority\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"high\">üî¥ High</SelectItem>\n                          <SelectItem value=\"medium\">üü° Medium</SelectItem>\n                          <SelectItem value=\"low\">üü¢ Low</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Quantity Information */}\n                <div className=\"bg-green-50 p-4 rounded-lg\">\n                  <h3 className=\"font-semibold mb-3\">Quantity Information</h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Total Quantity *\n                      </label>\n                      <Input\n                        name=\"totalQuantity\"\n                        type=\"number\"\n                        step=\"0.01\"\n                        placeholder=\"Total quantity\"\n                        defaultValue={editingProduction?.totalQuantity || \"\"}\n                        required\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Unit\n                      </label>\n                      <Input\n                        name=\"unitType\"\n                        placeholder=\"kg, packets, etc.\"\n                        defaultValue={editingProduction?.unitType || \"kg\"}\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Actual Quantity (Packets)\n                      </label>\n                      <Input\n                        name=\"actualQuantityPackets\"\n                        type=\"number\"\n                        step=\"0.01\"\n                        placeholder=\"Actual quantity in packets\"\n                        defaultValue={\n                          editingProduction?.actualQuantityPackets || \"\"\n                        }\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                {/* Production Timing */}\n                <div className=\"bg-purple-50 p-4 rounded-lg\">\n                  <h3 className=\"font-semibold mb-3\">Production Timing</h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Production Start Time\n                      </label>\n                      <Input\n                        name=\"productionStartTime\"\n                        type=\"datetime-local\"\n                        defaultValue={\n                          editingProduction?.productionStartTime || \"\"\n                        }\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">\n                        Production End Time\n                      </label>\n                      <Input\n                        name=\"productionEndTime\"\n                        type=\"datetime-local\"\n                        defaultValue={\n                          editingProduction?.productionEndTime || \"\"\n                        }\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                {/* Assignment and Notes */}\n                <div className=\"grid grid-cols-1 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium mb-1\">\n                      Assigned To\n                    </label>\n                    <Input\n                      name=\"assignedTo\"\n                      placeholder=\"Assign to team member\"\n                      defaultValue={editingProduction?.assignedTo || \"\"}\n                    />\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium mb-1\">\n                      Notes\n                    </label>\n                    <Textarea\n                      name=\"notes\"\n                      placeholder=\"Additional notes\"\n                      defaultValue={editingProduction?.notes || \"\"}\n                      rows={3}\n                    />\n                  </div>\n                </div>\n\n                <div className=\"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setIsDialogOpen(false)}\n                    className=\"w-full sm:w-auto\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={\n                      createMutation.isPending || updateMutation.isPending\n                    }\n                    className=\"w-full sm:w-auto\"\n                  >\n                    {createMutation.isPending || updateMutation.isPending\n                      ? \"Saving...\"\n                      : editingProduction\n                        ? \"Update\"\n                        : \"Schedule\"}\n                  </Button>\n                </div>\n              </form>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* Filters */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"flex-1\">\n          <SearchBar\n            placeholder=\"Search by product name, code, batch no, or notes...\"\n            value={searchQuery}\n            onChange={setSearchQuery}\n          />\n        </div>\n        <div className=\"w-full sm:w-48\">\n          {showHistory && (\n            <Input\n              type=\"date\"\n              value={historyDateFilter}\n              onChange={(e) => setHistoryDateFilter(e.target.value)}\n              placeholder=\"Filter by date\"\n              className=\"w-auto\"\n            />\n          )}\n          <Select value={statusFilter} onValueChange={setStatusFilter}>\n            <SelectTrigger className=\"w-full sm:w-auto\">\n              <SelectValue placeholder=\"Filter by Status\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Statuses</SelectItem>\n              <SelectItem value=\"draft\">Draft</SelectItem>\n              <SelectItem value=\"scheduled\">Scheduled</SelectItem>\n              <SelectItem value=\"in_progress\">In Progress</SelectItem>\n              <SelectItem value=\"completed\">Completed</SelectItem>\n              <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {/* Production Schedule List */}\n      <Card>\n        <CardHeader>\n          <CardTitle>\n            {showHistory ? \"Production History\" : \"Current Production Schedule\"}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : isError ? (\n            <div className=\"text-center py-8 text-destructive\">\n              Error loading production schedule: {error.message}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"productName\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Product Name\n                    </SortableTableHeader>\n                    <TableHead>Product Code</TableHead>\n                    <TableHead>Batch No</TableHead>\n                    <TableHead>Total Qty</TableHead>\n                    <TableHead>Actual Qty (Packets)</TableHead>\n                    <TableHead>Priority</TableHead>\n                    <SortableTableHeader\n                      sortKey=\"scheduleDate\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Date\n                    </SortableTableHeader>\n                    <TableHead>Shift</TableHead>\n                    <TableHead>Timing</TableHead>\n                    <SortableTableHeader\n                      sortKey=\"status\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Status\n                    </SortableTableHeader>\n                    <TableHead>Assigned To</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {displayData.length > 0 ? (\n                    displayData.map((item: ProductionItem) => (\n                      <TableRow key={item.id}>\n                        <TableCell className=\"font-medium\">\n                          {item.productName}\n                        </TableCell>\n                        <TableCell>\n                          {item.productCode || (\n                            <span className=\"text-gray-400\">‚Äî</span>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          {item.batchNo || (\n                            <span className=\"text-gray-400\">‚Äî</span>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          {item.totalQuantity} {item.unitType}\n                        </TableCell>\n                        <TableCell>\n                          {item.actualQuantityPackets !== null &&\n                          item.actualQuantityPackets !== undefined ? (\n                            <span className=\"text-green-600 font-medium\">\n                              {item.actualQuantityPackets}\n                            </span>\n                          ) : (\n                            <span className=\"text-gray-400\">‚Äî</span>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          <Badge className={getPriorityColor(item.priority)}>\n                            {item.priority === \"high\" && \"üî¥ \"}\n                            {item.priority === \"medium\" && \"üü° \"}\n                            {item.priority === \"low\" && \"üü¢ \"}\n                            {item.priority}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          {new Date(item.scheduleDate).toLocaleDateString()}\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant=\"outline\">{item.shift}</Badge>\n                        </TableCell>\n                        <TableCell>\n                          {item.productionStartTime &&\n                          item.productionEndTime ? (\n                            <span className=\"text-sm\">\n                              {new Date(\n                                item.productionStartTime,\n                              ).toLocaleTimeString()}{\" \"}\n                              -{\" \"}\n                              {new Date(\n                                item.productionEndTime,\n                              ).toLocaleTimeString()}\n                            </span>\n                          ) : (\n                            <span className=\"text-gray-400\">‚Äî</span>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={getStatusBadgeVariant(item.status)}>\n                            {item.status}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          {item.assignedTo || (\n                            <span className=\"text-gray-400\">‚Äî</span>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex space-x-1\">\n                            {!showHistory && (\n                              <>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => {\n                                    setEditingProduction(item);\n                                    setIsDialogOpen(true);\n                                  }}\n                                  title=\"Edit\"\n                                >\n                                  <Edit className=\"h-4 w-4\" />\n                                </Button>\n                                <DeleteConfirmationDialog\n                                  trigger={\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      title=\"Delete\"\n                                    >\n                                      <Trash2 className=\"h-4 w-4\" />\n                                    </Button>\n                                  }\n                                  title=\"Delete Production Item\"\n                                  itemName={`production for ${item.productName}`}\n                                  onConfirm={() =>\n                                    deleteMutation.mutate(item.id)\n                                  }\n                                  isLoading={deleteMutation.isPending}\n                                />\n                              </>\n                            )}\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => printLabelMutation.mutate(item)}\n                              title=\"Print Label\"\n                              className=\"text-blue-600 hover:text-blue-800\"\n                            >\n                              <Printer className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  ) : (\n                    <TableRow>\n                      <TableCell colSpan={12} className=\"text-center py-8\">\n                        <Target className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                        <h3 className=\"text-lg font-semibold text-muted-foreground mb-2\">\n                          {showHistory\n                            ? \"No production history found\"\n                            : \"No production items found\"}\n                        </h3>\n                        <p className=\"text-muted-foreground mb-4\">\n                          {showHistory\n                            ? \"No production history available for the selected filters.\"\n                            : \"Schedule your first production item to get started.\"}\n                        </p>\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n        {!isLoading && !isError && !showHistory && currentItems.length > 0 && (\n          <CardContent>\n            <div className=\"flex flex-col sm:flex-row justify-between items-center\">\n              <PaginationInfo\n                currentPage={currentPage}\n                totalPages={totalPages}\n                pageSize={pageSize}\n                totalItems={totalItems}\n              />\n              <Pagination\n                currentPage={currentPage}\n                totalPages={totalPages}\n                onPageChange={goToPage}\n              />\n              <PageSizeSelector pageSize={pageSize} setPageSize={setPageSize} />\n            </div>\n          </CardContent>\n        )}\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":40180,"size_tokens":null},"server/notifications.ts":{"content":"\nimport { db } from \"./db\";\nimport { eq, desc, and, lt, gte } from \"drizzle-orm\";\nimport { inventoryItems, products, orders, sales, purchases, productionSchedule, staff, customers, parties } from \"@shared/schema\";\n\nexport interface NotificationRule {\n  id: string;\n  type: 'low_stock' | 'out_of_stock' | 'new_order' | 'production_due' | 'payment_overdue' | 'staff_attendance' | 'system_alert';\n  enabled: boolean;\n  threshold?: number;\n  conditions?: any;\n  recipients: string[];\n  lastTriggered?: Date;\n}\n\nexport interface Notification {\n  id: string;\n  type: 'order' | 'production' | 'inventory' | 'shipping' | 'system';\n  title: string;\n  description: string;\n  timestamp: string;\n  read: boolean;\n  priority: 'low' | 'medium' | 'high' | 'critical';\n  actionUrl?: string;\n  data?: any;\n}\n\n// In-memory notification storage (replace with database in production)\nconst notifications: Notification[] = [];\nconst notificationRules: NotificationRule[] = [\n  {\n    id: 'low_stock',\n    type: 'low_stock',\n    enabled: true,\n    threshold: 10,\n    recipients: ['admin', 'manager'],\n  },\n  {\n    id: 'out_of_stock',\n    type: 'out_of_stock',\n    enabled: true,\n    threshold: 0,\n    recipients: ['admin', 'manager'],\n  },\n  {\n    id: 'new_order',\n    type: 'new_order',\n    enabled: true,\n    recipients: ['admin', 'manager', 'staff'],\n  },\n  {\n    id: 'production_due',\n    type: 'production_due',\n    enabled: true,\n    recipients: ['admin', 'manager'],\n  },\n];\n\nfunction generateNotificationId(): string {\n  return `notif_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\nfunction createNotification(\n  type: Notification['type'],\n  title: string,\n  description: string,\n  priority: Notification['priority'] = 'medium',\n  actionUrl?: string,\n  data?: any\n): void {\n  const notification: Notification = {\n    id: generateNotificationId(),\n    type,\n    title,\n    description,\n    timestamp: new Date().toISOString(),\n    read: false,\n    priority,\n    actionUrl,\n    data,\n  };\n\n  notifications.unshift(notification);\n  \n  // Keep only last 100 notifications\n  if (notifications.length > 100) {\n    notifications.splice(100);\n  }\n\n  console.log(`üì¢ NEW NOTIFICATION [${priority.toUpperCase()}]: ${title}`);\n}\n\n// Real notification triggers based on actual system events\n\nexport async function checkLowStockAlerts(): Promise<void> {\n  try {\n    const rule = notificationRules.find(r => r.type === 'low_stock' && r.enabled);\n    if (!rule) return;\n\n    const lowStockItems = await db\n      .select()\n      .from(inventoryItems)\n      .where(lt(inventoryItems.currentStock, inventoryItems.minLevel));\n\n    for (const item of lowStockItems) {\n      const currentStock = parseFloat(item.currentStock?.toString() || '0');\n      const minLevel = parseFloat(item.minLevel?.toString() || '0');\n      \n      if (currentStock <= rule.threshold!) {\n        createNotification(\n          'inventory',\n          `Low Stock Alert: ${item.name}`,\n          `Only ${currentStock} ${item.unit} remaining. Minimum level: ${minLevel} ${item.unit}`,\n          currentStock === 0 ? 'critical' : 'high',\n          '/inventory',\n          { itemId: item.id, currentStock, minLevel }\n        );\n      }\n    }\n  } catch (error) {\n    console.error('Error checking low stock alerts:', error);\n  }\n}\n\nexport async function notifyNewOrder(orderData: any): Promise<void> {\n  try {\n    const rule = notificationRules.find(r => r.type === 'new_order' && r.enabled);\n    if (!rule) return;\n\n    createNotification(\n      'order',\n      `New Order Received`,\n      `Order from ${orderData.customerName} for $${orderData.totalAmount}`,\n      orderData.totalAmount > 500 ? 'high' : 'medium',\n      `/orders`,\n      orderData\n    );\n  } catch (error) {\n    console.error('Error creating new order notification:', error);\n  }\n}\n\nexport async function checkProductionScheduleAlerts(): Promise<void> {\n  try {\n    const rule = notificationRules.find(r => r.type === 'production_due' && r.enabled);\n    if (!rule) return;\n\n    const today = new Date();\n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n\n    const upcomingProduction = await db\n      .select()\n      .from(productionSchedule)\n      .where(\n        and(\n          gte(productionSchedule.scheduleDate, today.toISOString().split('T')[0]),\n          lt(productionSchedule.scheduleDate, tomorrow.toISOString().split('T')[0])\n        )\n      );\n\n    for (const schedule of upcomingProduction) {\n      const product = await db\n        .select()\n        .from(products)\n        .where(eq(products.id, schedule.productId))\n        .limit(1);\n\n      if (product.length > 0) {\n        createNotification(\n          'production',\n          `Production Due Today`,\n          `${product[0].name} - ${schedule.quantity} ${schedule.unitType} scheduled`,\n          'medium',\n          '/production',\n          { scheduleId: schedule.id, productName: product[0].name }\n        );\n      }\n    }\n  } catch (error) {\n    console.error('Error checking production schedule alerts:', error);\n  }\n}\n\nexport async function notifyPaymentReceived(paymentData: any): Promise<void> {\n  try {\n    createNotification(\n      'system',\n      `Payment Received`,\n      `Payment of $${paymentData.amount} received from ${paymentData.customerName}`,\n      'low',\n      '/sales',\n      paymentData\n    );\n  } catch (error) {\n    console.error('Error creating payment notification:', error);\n  }\n}\n\nexport async function notifySystemAlert(alertData: any): Promise<void> {\n  try {\n    createNotification(\n      'system',\n      alertData.title,\n      alertData.description,\n      alertData.priority || 'medium',\n      alertData.actionUrl,\n      alertData\n    );\n  } catch (error) {\n    console.error('Error creating system alert:', error);\n  }\n}\n\n// API functions for frontend\nexport function getNotifications(): Notification[] {\n  return [...notifications].sort((a, b) => \n    new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()\n  );\n}\n\nexport function markNotificationAsRead(notificationId: string): boolean {\n  const notification = notifications.find(n => n.id === notificationId);\n  if (notification) {\n    notification.read = true;\n    return true;\n  }\n  return false;\n}\n\nexport function markAllNotificationsAsRead(): void {\n  notifications.forEach(n => n.read = true);\n}\n\nexport function clearNotification(notificationId: string): boolean {\n  const index = notifications.findIndex(n => n.id === notificationId);\n  if (index !== -1) {\n    notifications.splice(index, 1);\n    return true;\n  }\n  return false;\n}\n\nexport function sendTestNotification(): void {\n  createNotification(\n    'system',\n    'Test Notification',\n    'This is a test notification to verify the system is working correctly.',\n    'low',\n    '/notifications',\n    { test: true }\n  );\n}\n\n// Periodic checks (call these from your scheduler)\nexport async function runPeriodicChecks(): Promise<void> {\n  await checkLowStockAlerts();\n  await checkProductionScheduleAlerts();\n}\n\n// Initialize with some sample notifications for testing\nsetTimeout(() => {\n  createNotification(\n    'system',\n    'System Initialized',\n    'Notification system is now active and monitoring your bakery operations.',\n    'low'\n  );\n}, 1000);\n","path":null,"size_bytes":7235,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/theme-settings.tsx":{"content":"<replit_final_file>\n</replit_final_file>","path":null,"size_bytes":40,"size_tokens":null},"client/src/lib/activityTracker.ts":{"content":"/**\n * Client-side activity tracker for comprehensive audit logging\n * Tracks user interactions and sends them to the server for audit purposes\n */\n\ninterface ActivityEvent {\n  action: string;\n  resource: string;\n  resourceId?: string;\n  details?: any;\n  timestamp: string;\n}\n\nclass ActivityTracker {\n  private static instance: ActivityTracker;\n  private pendingEvents: ActivityEvent[] = [];\n  private batchSize = 10;\n  private flushInterval = 30000; // 30 seconds (reduced frequency)\n  private isEnabled = true;\n\n  static getInstance(): ActivityTracker {\n    if (!ActivityTracker.instance) {\n      ActivityTracker.instance = new ActivityTracker();\n    }\n    return ActivityTracker.instance;\n  }\n\n  constructor() {\n    this.setupPeriodicFlush();\n    this.setupPageUnloadHandler();\n    this.setupNavigationTracking();\n  }\n\n  /**\n   * Track a user activity\n   */\n  track(action: string, resource: string, resourceId?: string, details?: any): void {\n    if (!this.isEnabled) return;\n\n    const event: ActivityEvent = {\n      action,\n      resource,\n      resourceId,\n      details: this.sanitizeDetails(details),\n      timestamp: new Date().toISOString(),\n    };\n\n    this.pendingEvents.push(event);\n\n    // Flush immediately for critical actions\n    if (this.isCriticalAction(action)) {\n      this.flush();\n    } else if (this.pendingEvents.length >= this.batchSize) {\n      this.flush();\n    }\n  }\n\n  /**\n   * Track page views\n   */\n  trackPageView(pageName: string): void {\n    this.track('VIEW', 'page', pageName, {\n      url: window.location.pathname,\n      referrer: document.referrer,\n      userAgent: navigator.userAgent,\n    });\n  }\n\n  /**\n   * Track form submissions\n   */\n  trackFormSubmission(formName: string, formData?: any): void {\n    this.track('SUBMIT', 'form', formName, {\n      formData: this.sanitizeFormData(formData),\n      url: window.location.pathname,\n    });\n  }\n\n  /**\n   * Track button clicks\n   */\n  trackButtonClick(buttonName: string, context?: string): void {\n    this.track('CLICK', 'button', buttonName, {\n      context,\n      url: window.location.pathname,\n    });\n  }\n\n  /**\n   * Track data operations\n   */\n  trackDataOperation(operation: 'CREATE' | 'UPDATE' | 'DELETE' | 'READ', resource: string, resourceId?: string): void {\n    this.track(operation, resource, resourceId, {\n      url: window.location.pathname,\n    });\n  }\n\n  /**\n   * Track errors\n   */\n  trackError(error: Error, context?: string): void {\n    this.track('ERROR', 'application', undefined, {\n      message: error.message,\n      stack: error.stack,\n      context,\n      url: window.location.pathname,\n    });\n  }\n\n  /**\n   * Flush pending events to server\n   */\n  private async flush(): Promise<void> {\n    if (this.pendingEvents.length === 0) return;\n\n    const events = [...this.pendingEvents];\n    this.pendingEvents = [];\n\n    try {\n      await fetch('/api/audit/client-activities', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ events }),\n        credentials: 'include',\n      });\n    } catch (error) {\n      console.warn('Failed to send activity events:', error);\n      // Re-add events to pending if they failed to send\n      this.pendingEvents = [...events, ...this.pendingEvents];\n    }\n  }\n\n  /**\n   * Setup periodic flushing\n   */\n  private setupPeriodicFlush(): void {\n    setInterval(() => {\n      this.flush();\n    }, this.flushInterval);\n  }\n\n  /**\n   * Setup page unload handler to flush remaining events\n   */\n  private setupPageUnloadHandler(): void {\n    window.addEventListener('beforeunload', () => {\n      if (this.pendingEvents.length > 0) {\n        // Use sendBeacon for reliable delivery on page unload\n        const blob = new Blob([JSON.stringify({ events: this.pendingEvents })], {\n          type: 'application/json',\n        });\n        navigator.sendBeacon('/api/audit/client-activities', blob);\n      }\n    });\n  }\n\n  /**\n   * Setup navigation tracking\n   */\n  private setupNavigationTracking(): void {\n    // Track initial page load\n    this.trackPageView(document.title);\n\n    // Track navigation changes (for SPAs)\n    const originalPushState = history.pushState;\n    const originalReplaceState = history.replaceState;\n\n    history.pushState = function (...args) {\n      originalPushState.apply(history, args);\n      ActivityTracker.getInstance().trackPageView(document.title);\n    };\n\n    history.replaceState = function (...args) {\n      originalReplaceState.apply(history, args);\n      ActivityTracker.getInstance().trackPageView(document.title);\n    };\n\n    window.addEventListener('popstate', () => {\n      this.trackPageView(document.title);\n    });\n  }\n\n  /**\n   * Check if action is critical and should be flushed immediately\n   */\n  private isCriticalAction(action: string): boolean {\n    return ['DELETE', 'CREATE', 'ERROR', 'LOGIN', 'LOGOUT'].includes(action);\n  }\n\n  /**\n   * Sanitize details to remove sensitive information\n   */\n  private sanitizeDetails(details: any): any {\n    if (!details || typeof details !== 'object') return details;\n\n    const sanitized = { ...details };\n    const sensitiveFields = ['password', 'token', 'secret', 'key', 'authorization', 'ssn', 'creditCard'];\n\n    Object.keys(sanitized).forEach(key => {\n      if (sensitiveFields.some(field => key.toLowerCase().includes(field))) {\n        sanitized[key] = '[REDACTED]';\n      }\n    });\n\n    return sanitized;\n  }\n\n  /**\n   * Sanitize form data\n   */\n  private sanitizeFormData(formData: any): any {\n    if (!formData) return null;\n\n    if (formData instanceof FormData) {\n      const result: any = {};\n      for (const [key, value] of Array.from(formData.entries())) {\n        result[key] = this.isSensitiveField(key) ? '[REDACTED]' : value;\n      }\n      return result;\n    }\n\n    return this.sanitizeDetails(formData);\n  }\n\n  /**\n   * Check if field is sensitive\n   */\n  private isSensitiveField(fieldName: string): boolean {\n    const sensitiveFields = ['password', 'token', 'secret', 'key', 'authorization', 'ssn', 'creditcard'];\n    return sensitiveFields.some(field => fieldName.toLowerCase().includes(field));\n  }\n\n  /**\n   * Enable/disable tracking\n   */\n  setEnabled(enabled: boolean): void {\n    this.isEnabled = enabled;\n  }\n}\n\nexport const activityTracker = ActivityTracker.getInstance();\n\n// Auto-track common interactions\nexport function setupAutoTracking(): void {\n  // Track form submissions\n  document.addEventListener('submit', (event) => {\n    const form = event.target as HTMLFormElement;\n    const formName = form.name || form.id || 'unknown-form';\n    activityTracker.trackFormSubmission(formName);\n  });\n\n  // Track button clicks\n  document.addEventListener('click', (event) => {\n    const target = event.target as HTMLElement;\n    if (target.tagName === 'BUTTON' || target.role === 'button') {\n      const buttonName = target.textContent?.trim() || target.id || 'unknown-button';\n      activityTracker.trackButtonClick(buttonName);\n    }\n  });\n\n  // Track errors\n  window.addEventListener('error', (event) => {\n    activityTracker.trackError(event.error, 'Global error handler');\n  });\n\n  window.addEventListener('unhandledrejection', (event) => {\n    activityTracker.trackError(new Error(event.reason), 'Unhandled promise rejection');\n  });\n}","path":null,"size_bytes":7284,"size_tokens":null},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nif (!process.env.REPLIT_DOMAINS) {\n  throw new Error(\"Environment variable REPLIT_DOMAINS not provided\");\n}\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  for (const domain of process.env\n    .REPLIT_DOMAINS!.split(\",\")) {\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify,\n    );\n    passport.use(strategy);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":4221,"size_tokens":null},"client/src/hooks/useUnits.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\n\ninterface Unit {\n  id: number;\n  name: string;\n  abbreviation: string;\n  type: string;\n  isActive: boolean;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\nexport const useUnits = () => {\n  return useQuery({\n    queryKey: [\"/api/units\"],\n    queryFn: async () => {\n      try {\n        const response = await apiRequest(\"GET\", \"/api/units\");\n\n        // The API returns array directly\n        if (Array.isArray(response)) {\n          console.log(`‚úÖ useUnits - Loaded ${response.length} units`);\n          return response as Unit[];\n        }\n\n        // Fallback: check if response has a data property\n        if (response && typeof response === \"object\" && \"data\" in response) {\n          const data = (response as any).data;\n          if (Array.isArray(data)) {\n            console.log(`‚úÖ useUnits - Loaded ${data.length} units from response.data`);\n            return data as Unit[];\n          }\n        }\n\n        console.warn(\"‚ö†Ô∏è useUnits - Unexpected response format, returning empty array\");\n        return [];\n      } catch (error) {\n        console.error(\"‚ùå useUnits - Error fetching units:\", error);\n        // Return empty array on error to prevent crashes\n        return [];\n      }\n    },\n    staleTime: 5 * 60 * 1000,\n    gcTime: 10 * 60 * 1000,\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n};\n\n// Active units filter hook\nexport const useActiveUnits = () => {\n  const { data: units = [], ...rest } = useUnits();\n\n  // Ensure units is always an array before filtering\n  const safeUnits = Array.isArray(units) ? units : [];\n  const activeUnits = safeUnits.filter((unit: Unit) => unit.isActive !== false);\n\n  return {\n    data: activeUnits,\n    ...rest,\n  };\n};\n\n// Get unit by ID helper\nexport const useUnitById = (unitId: number | string | undefined) => {\n  const { data: units = [] } = useUnits();\n\n  if (!unitId) return null;\n\n  return units.find((unit: Unit) =>\n    unit.id.toString() === unitId.toString()\n  ) || null;\n};\n\n// Get units by type helper\nexport const useUnitsByType = (type: string) => {\n  const { data: units = [], ...rest } = useUnits();\n\n  const filteredUnits = units.filter((unit: Unit) =>\n    unit.type === type && unit.isActive !== false\n  );\n\n  return {\n    data: filteredUnits,\n    ...rest,\n  };\n};","path":null,"size_bytes":2488,"size_tokens":null},"client/src/lib/theme-utils.ts":{"content":"\n// This file is no longer needed - theme utilities removed\n","path":null,"size_bytes":60,"size_tokens":null},"client/src/pages/purchases.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport SearchBar from \"@/components/search-bar\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n  usePagination,\n} from \"@/components/ui/pagination\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Plus,\n  Edit,\n  Trash2,\n  ShoppingCart,\n  Eye,\n  FileText,\n  ExternalLink,\n  ShoppingBag,\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface Purchase {\n  id: number;\n  supplierName: string;\n  partyId?: number;\n  totalAmount: string;\n  paymentMethod: string;\n  status: string;\n  purchaseDate?: string;\n  invoiceNumber?: string;\n  notes?: string;\n  createdAt: string;\n  items?: PurchaseItem[];\n}\n\ninterface PurchaseItem {\n  id: number;\n  inventoryItemId: number;\n  inventoryItemName: string;\n  quantity: string;\n  unitPrice: string;\n  totalPrice: string;\n  unitId?: string;\n}\n\ninterface Party {\n  id: number;\n  name: string;\n  type: string;\n  currentBalance: string;\n}\n\nexport default function Purchases() {\n  const { toast } = useToast();\n  const { formatCurrency, formatCurrencyWithCommas } = useCurrency();\n  const queryClient = useQueryClient();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [isDetailDialogOpen, setIsDetailDialogOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [supplierFilter, setSupplierFilter] = useState(\"all\");\n  const [dateFrom, setDateFrom] = useState(\"\");\n  const [dateTo, setDateTo] = useState(\"\");\n  const [selectedPurchase, setSelectedPurchase] = useState<Purchase | null>(\n    null,\n  );\n  const [editingPurchase, setEditingPurchase] = useState<Purchase | null>(null);\n\n  const { data: purchases = [], isLoading } = useQuery({\n    queryKey: [\"/api/purchases\"],\n  });\n\n  const { data: inventoryItems = [], isLoading: itemsLoading } = useQuery({\n    queryKey: [\"/api/inventory\"],\n  });\n\n  const { data: parties = [] } = useQuery({\n    queryKey: [\"/api/parties\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/parties\");\n      console.log(\"Parties API response:\", response);\n      if (Array.isArray(response)) return response;\n      if (response?.data && Array.isArray(response.data)) return response.data;\n      if (response?.parties && Array.isArray(response.parties)) return response.parties;\n      return [];\n    },\n  });\n\n  const { data: units = [], isLoading: unitsLoading } = useQuery({\n    queryKey: [\"/api/units\"],\n  });\n\n  const [purchaseForm, setPurchaseForm] = useState({\n    partyId: \"\",\n    supplierName: \"\",\n    paymentMethod: \"cash\",\n    invoiceNumber: \"\",\n    purchaseDate: new Date().toISOString().split(\"T\")[0],\n    status: \"completed\",\n    notes: \"\",\n    tax: 0,\n    items: [{ inventoryItemId: \"\", quantity: 1, unitPrice: \"0\", unitId: \"\" }],\n  });\n\n  // Create Purchase Mutation\n  const createPurchaseMutation = useMutation({\n    mutationFn: async (purchaseData: any) => {\n      return apiRequest(\"POST\", \"/api/purchases\", purchaseData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchases\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/low-stock\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n      toast({\n        title: \"Success\",\n        description:\n          \"Purchase recorded and stock quantities updated successfully\",\n      });\n      handleCloseDialog();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to record purchase\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update Purchase Mutation\n  const updatePurchaseMutation = useMutation({\n    mutationFn: async (data: { id: number; purchaseData: any }) => {\n      return apiRequest(\"PUT\", `/api/purchases/${data.id}`, data.purchaseData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchases\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n      toast({\n        title: \"Success\",\n        description: \"Purchase updated successfully\",\n      });\n      setIsEditDialogOpen(false);\n      setEditingPurchase(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update purchase\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete Purchase Mutation\n  const deletePurchaseMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"DELETE\", `/api/purchases/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchases\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/parties\"] });\n      toast({\n        title: \"Success\",\n        description: \"Purchase deleted successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete purchase\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Validate form\n    if (!purchaseForm.supplierName.trim()) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Supplier name is required.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (\n      purchaseForm.items.length === 0 ||\n      !purchaseForm.items.some((item) => item.inventoryItemId)\n    ) {\n      toast({\n        title: \"Validation Error\",\n        description: \"At least one item is required.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const validItems = purchaseForm.items.filter(\n      (item) =>\n        item.inventoryItemId &&\n        parseFloat(item.unitPrice) > 0 &&\n        item.quantity > 0,\n    );\n\n    if (validItems.length === 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please add valid items with prices and quantities.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const totalAmount = validItems.reduce((sum, item) => {\n      const itemTotal = parseFloat(item.unitPrice) * item.quantity;\n      return sum + itemTotal;\n    }, 0);\n\n    const purchaseData = {\n      partyId: purchaseForm.partyId ? parseInt(purchaseForm.partyId) : null,\n      supplierName: purchaseForm.supplierName.trim(),\n      totalAmount: totalAmount.toString(),\n      paymentMethod: purchaseForm.paymentMethod,\n      status: purchaseForm.status,\n      invoiceNumber: purchaseForm.invoiceNumber || null,\n      purchaseDate: purchaseForm.purchaseDate,\n      notes: purchaseForm.notes || null,\n      items: validItems.map((item) => ({\n        inventoryItemId: parseInt(item.inventoryItemId),\n        quantity: parseFloat(item.quantity.toString()),\n        unitPrice: parseFloat(item.unitPrice),\n        unitId: item.unitId ? parseInt(item.unitId) : null,\n        totalPrice: (\n          parseFloat(item.unitPrice) * parseFloat(item.quantity.toString())\n        ).toString(),\n      })),\n    };\n\n    createPurchaseMutation.mutate(purchaseData);\n  };\n\n  const handleEdit = (purchase: Purchase) => {\n    setEditingPurchase(purchase);\n    setPurchaseForm({\n      partyId: purchase.partyId?.toString() || \"\",\n      supplierName: purchase.supplierName,\n      paymentMethod: purchase.paymentMethod,\n      invoiceNumber: purchase.invoiceNumber || \"\",\n      purchaseDate: purchase.purchaseDate\n        ? new Date(purchase.purchaseDate).toISOString().split(\"T\")[0]\n        : new Date(purchase.createdAt).toISOString().split(\"T\")[0],\n      status: purchase.status,\n      notes: purchase.notes || \"\",\n      items:\n        purchase.items && purchase.items.length > 0\n          ? purchase.items.map((item) => ({\n              inventoryItemId: item.inventoryItemId.toString(),\n              quantity: parseFloat(item.quantity),\n              unitPrice: parseFloat(item.unitPrice),\n              unitId: item.unitId ? item.unitId.toString() : \"\",\n            }))\n          : [{ inventoryItemId: \"\", quantity: 1, unitPrice: \"0\", unitId: \"\" }],\n    });\n    setIsEditDialogOpen(true);\n  };\n\n  const handleEditSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!editingPurchase) return;\n\n    const totalAmount = purchaseForm.items.reduce((sum, item) => {\n      const itemTotal = parseFloat(item.unitPrice) * item.quantity;\n      return sum + itemTotal;\n    }, 0);\n\n    const purchaseData = {\n      partyId: purchaseForm.partyId ? parseInt(purchaseForm.partyId) : null,\n      supplierName: purchaseForm.supplierName,\n      totalAmount: totalAmount.toString(),\n      paymentMethod: purchaseForm.paymentMethod,\n      status: purchaseForm.status,\n      invoiceNumber: purchaseForm.invoiceNumber || null,\n      purchaseDate: purchaseForm.purchaseDate,\n      notes: purchaseForm.notes || null,\n    };\n\n    updatePurchaseMutation.mutate({\n      id: editingPurchase.id,\n      purchaseData,\n    });\n  };\n\n  const handleDelete = (id: number) => {\n    if (\n      confirm(\n        \"Are you sure you want to delete this purchase? This action cannot be undone.\",\n      )\n    ) {\n      deletePurchaseMutation.mutate(id);\n    }\n  };\n\n  const handleViewDetails = (purchase: Purchase) => {\n    setSelectedPurchase(purchase);\n    setIsDetailDialogOpen(true);\n  };\n\n  const handleCloseDialog = () => {\n    setIsDialogOpen(false);\n    setPurchaseForm({\n      partyId: \"\",\n      supplierName: \"\",\n      paymentMethod: \"cash\",\n      invoiceNumber: \"\",\n      purchaseDate: new Date().toISOString().split(\"T\")[0],\n      status: \"completed\",\n      notes: \"\",\n      tax: 0,\n      items: [{ inventoryItemId: \"\", quantity: 1, unitPrice: \"0\", unitId: \"\" }],\n    });\n  };\n\n  const addItem = () => {\n    setPurchaseForm({\n      ...purchaseForm,\n      items: [\n        ...purchaseForm.items,\n        { inventoryItemId: \"\", quantity: 1, unitPrice: \"0\", unitId: \"\" },\n      ],\n    });\n  };\n\n  const removeItem = (index: number) => {\n    setPurchaseForm({\n      ...purchaseForm,\n      items: purchaseForm.items.filter((_, i) => i !== index),\n    });\n  };\n\n  const updateItem = (index: number, field: string, value: any) => {\n    const updatedItems = purchaseForm.items.map((item, i) => {\n      if (i === index) {\n        if (field === \"quantity\") {\n          return { ...item, [field]: parseInt(value) || 1 };\n        } else if (field === \"unitPrice\") {\n          return { ...item, [field]: parseFloat(value) || 0 };\n        } else {\n          return { ...item, [field]: value };\n        }\n      }\n      return item;\n    });\n    setPurchaseForm({ ...purchaseForm, items: updatedItems });\n  };\n\n  // Calculate Sub Total\n  const calculateSubTotal = () => {\n    return purchaseForm.items.reduce(\n      (sum, item) =>\n        sum + parseFloat(item.quantity) * parseFloat(item.unitPrice),\n      0,\n    );\n  };\n\n  // Calculate Total (Sub Total + Tax)\n  const calculateTotal = () => {\n    return calculateSubTotal() + (purchaseForm.tax || 0);\n  };\n\n  // Filter and search logic\n  const filteredPurchases = useMemo(() => {\n    return purchases.filter((purchase: Purchase) => {\n      const supplierName = purchase.supplierName?.toLowerCase() || \"\";\n      const invoiceNumber = purchase.invoiceNumber?.toLowerCase() || \"\";\n      const searchLower = searchTerm.toLowerCase();\n\n      const matchesSearch =\n        supplierName.includes(searchLower) ||\n        invoiceNumber.includes(searchLower) ||\n        purchase.totalAmount.includes(searchLower);\n\n      const matchesStatus =\n        statusFilter === \"all\" || purchase.status === statusFilter;\n\n      const matchesSupplier =\n        supplierFilter === \"all\" || purchase.supplierName === supplierFilter;\n\n      const purchaseDate = new Date(\n        purchase.purchaseDate || purchase.createdAt,\n      );\n      const matchesDateFrom = !dateFrom || purchaseDate >= new Date(dateFrom);\n      const matchesDateTo =\n        !dateTo || purchaseDate <= new Date(dateTo + \"T23:59:59\");\n\n      return (\n        matchesSearch &&\n        matchesStatus &&\n        matchesSupplier &&\n        matchesDateFrom &&\n        matchesDateTo\n      );\n    });\n  }, [purchases, searchTerm, statusFilter, supplierFilter, dateFrom, dateTo]);\n\n  // Sorting\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredPurchases,\n    \"purchaseDate\",\n  );\n\n  // Pagination\n  const {\n    currentItems,\n    currentPage,\n    totalPages,\n    pageSize,\n    setPageSize,\n    goToPage,\n    totalItems,\n  } = usePagination(sortedData, 10);\n\n  // Get unique suppliers for filter\n  const uniqueSuppliers = useMemo(() => {\n    const suppliers = [\n      ...new Set(purchases.map((p: Purchase) => p.supplierName)),\n    ];\n    return suppliers.filter(Boolean);\n  }, [purchases]);\n\n  // Summary calculations\n  const totalPurchases = filteredPurchases.reduce(\n    (sum: number, purchase: Purchase) => sum + parseFloat(purchase.totalAmount),\n    0,\n  );\n\n  const statusCounts = useMemo(() => {\n    return filteredPurchases.reduce((acc: any, purchase: Purchase) => {\n      acc[purchase.status] = (acc[purchase.status] || 0) + 1;\n      return acc;\n    }, {});\n  }, [filteredPurchases]);\n\n  const getStatusBadge = (status: string) => {\n    const variants: {\n      [key: string]: \"default\" | \"secondary\" | \"destructive\" | \"outline\";\n    } = {\n      completed: \"default\",\n      pending: \"secondary\",\n      cancelled: \"destructive\",\n      partial: \"outline\",\n    };\n    return (\n      <Badge variant={variants[status] || \"outline\"}>\n        {status?.charAt(0).toUpperCase() + status?.slice(1)}\n      </Badge>\n    );\n  };\n\n  const viewSupplierLedger = (partyId: number) => {\n    if (partyId) {\n      window.open(`/parties?viewLedger=${partyId}`, \"_blank\");\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto\"></div>\n          <p className=\"text-muted-foreground mt-2\">Loading purchases...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-gray-600\">\n            Record and track all purchase transactions with detailed history\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <div className=\"flex gap-2\">\n            <DialogTrigger asChild>\n              <Button onClick={handleCloseDialog}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Record Purchase\n              </Button>\n            </DialogTrigger>\n            <Button\n              variant=\"outline\"\n              onClick={() => (window.location.href = \"/purchase-returns\")}\n            >\n              Purchase Returns\n            </Button>\n          </div>\n          <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Record New Purchase</DialogTitle>\n              <DialogDescription>\n                Enter the purchase transaction details\n              </DialogDescription>\n            </DialogHeader>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"supplier\">Supplier</Label>\n                  <Select\n                    value={purchaseForm.partyId || undefined}\n                    onValueChange={(value) => {\n                      const party = parties.find(\n                        (p: any) => p.id === parseInt(value),\n                      );\n                      setPurchaseForm({\n                        ...purchaseForm,\n                        partyId: value,\n                        supplierName: party?.name || \"\",\n                      });\n                    }}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select supplier\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {Array.isArray(parties) &&\n                        parties.map((party: any) => (\n                          <SelectItem\n                            key={party.id}\n                            value={party.id.toString()}\n                          >\n                            {party.name}\n                          </SelectItem>\n                        ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"supplierName\">Supplier Name</Label>\n                  <Input\n                    id=\"supplierName\"\n                    value={purchaseForm.supplierName}\n                    onChange={(e) =>\n                      setPurchaseForm({\n                        ...purchaseForm,\n                        supplierName: e.target.value,\n                      })\n                    }\n                    placeholder=\"Enter supplier name\"\n                    required\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"invoiceNumber\">Invoice Number</Label>\n                  <Input\n                    id=\"invoiceNumber\"\n                    value={purchaseForm.invoiceNumber}\n                    onChange={(e) =>\n                      setPurchaseForm({\n                        ...purchaseForm,\n                        invoiceNumber: e.target.value,\n                      })\n                    }\n                    placeholder=\"Enter invoice number\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"purchaseDate\">Purchase Date</Label>\n                  <Input\n                    id=\"purchaseDate\"\n                    type=\"date\"\n                    value={purchaseForm.purchaseDate}\n                    onChange={(e) =>\n                      setPurchaseForm({\n                        ...purchaseForm,\n                        purchaseDate: e.target.value,\n                      })\n                    }\n                    required\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"paymentMethod\">Payment Method</Label>\n                  <Select\n                    value={purchaseForm.paymentMethod || undefined}\n                    onValueChange={(value) =>\n                      setPurchaseForm({ ...purchaseForm, paymentMethod: value })\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"cash\">Cash</SelectItem>\n                      <SelectItem value=\"card\">Card</SelectItem>\n                      <SelectItem value=\"upi\">UPI</SelectItem>\n                      <SelectItem value=\"bank_transfer\">\n                        Bank Transfer\n                      </SelectItem>\n                      <SelectItem value=\"credit\">Credit</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"status\">Status</Label>\n                  <Select\n                    value={purchaseForm.status || undefined}\n                    onValueChange={(value) =>\n                      setPurchaseForm({ ...purchaseForm, status: value })\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"completed\">Completed</SelectItem>\n                      <SelectItem value=\"pending\">Pending</SelectItem>\n                      <SelectItem value=\"partial\">Partial</SelectItem>\n                      <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"notes\">Notes</Label>\n                  <Input\n                    id=\"notes\"\n                    value={purchaseForm.notes}\n                    onChange={(e) =>\n                      setPurchaseForm({\n                        ...purchaseForm,\n                        notes: e.target.value,\n                      })\n                    }\n                    placeholder=\"Additional notes\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <Label className=\"font-medium\">Purchase Items</Label>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"bg-green-100 text-green-800 hover:bg-green-200\"\n                    onClick={addItem}\n                  >\n                    + Add Item\n                  </Button>\n                </div>\n\n                {/* Table Header Row */}\n                <div className=\"grid grid-cols-12 gap-2 pb-2 border-b font-medium text-sm invoice-item-row\">\n                  <div className=\"col-span-1 text-center\">S.No.</div>\n                  <div className=\"col-span-3\">Particular *</div>\n                  <div className=\"col-span-1\">Qty *</div>\n                  <div className=\"col-span-2\">Unit *</div>\n                  <div className=\"col-span-2\">Rate *</div>\n                  <div className=\"col-span-2\">Amount *</div>\n                  <div className=\"col-span-1\">Action</div>\n                </div>\n\n                {/* Data Rows */}\n                {purchaseForm.items.map((item, index) => (\n                  <div\n                    key={index}\n                    className=\"grid grid-cols-12 gap-2 bg-white hover:bg-gray-50\"\n                  >\n                    {/* S.No. */}\n                    <div className=\"col-span-1 flex items-center justify-center\">\n                      {index + 1}\n                    </div>\n\n                    {/* Particular */}\n                    <div className=\"col-span-3\">\n                      <Select\n                        value={item.inventoryItemId || undefined}\n                        onValueChange={(value) => {\n                          const inventoryItem = inventoryItems.find((inv: any) => inv.id.toString() === value);\n                          const updatedItems = purchaseForm.items.map((itm, i) => {\n                            if (i === index) {\n                              return {\n                                ...itm,\n                                inventoryItemId: value,\n                                unitId: inventoryItem?.unitId?.toString() || \"\",\n                                unitPrice: inventoryItem?.costPerUnit ? parseFloat(inventoryItem.costPerUnit.toString()).toString() : \"0\",\n                              };\n                            }\n                            return itm;\n                          });\n                          setPurchaseForm({ ...purchaseForm, items: updatedItems });\n                          calculateTotal();\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select item\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {inventoryItems && Array.isArray(inventoryItems) ? (\n                            inventoryItems.map((inventoryItem: any) => (\n                              <SelectItem\n                                key={inventoryItem.id}\n                                value={inventoryItem.id.toString()}\n                              >\n                                {inventoryItem.name}\n                              </SelectItem>\n                            ))\n                          ) : (\n                            <SelectItem value=\"no-items\" disabled>\n                              No inventory items available\n                            </SelectItem>\n                          )}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    {/* Quantity */}\n                    <div className=\"col-span-1\">\n                      <Input\n                        type=\"number\"\n                        value={item.quantity}\n                        onChange={(e) =>\n                          updateItem(\n                            index,\n                            \"quantity\",\n                            parseInt(e.target.value) || 0,\n                          )\n                        }\n                        min=\"1\"\n                        placeholder=\"Qty\"\n                      />\n                    </div>\n\n                    {/* Unit */}\n                    <div className=\"col-span-2\">\n                      <Select\n                        value={item.unitId || undefined}\n                        onValueChange={(value) =>\n                          updateItem(index, \"unitId\", value)\n                        }\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Unit\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {unitsLoading ? (\n                            <SelectItem value=\"loading\" disabled>\n                              Loading units...\n                            </SelectItem>\n                          ) : units && Array.isArray(units) ? (\n                            units\n                              .filter((unit: any) => unit.isActive)\n                              .map((unit: any) => (\n                                <SelectItem\n                                  key={unit.id}\n                                  value={unit.id.toString()}\n                                >\n                                  {unit.name} ({unit.abbreviation})\n                                </SelectItem>\n                              ))\n                          ) : (\n                            <SelectItem value=\"no-units\" disabled>\n                              No units available\n                            </SelectItem>\n                          )}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div className=\"col-span-2\">\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        value={item.unitPrice}\n                        onChange={(e) =>\n                          updateItem(\n                            index,\n                            \"unitPrice\",\n                            parseFloat(e.target.value) || 0,\n                          )\n                        }\n                        min=\"0\"\n                        placeholder=\"Rate per unit\"\n                      />\n                    </div>\n\n                    {/* Amount (Calculated as Quantity √ó Rate) */}\n                    <div className=\"col-span-2\">\n                      <Input\n                        value={(\n                          parseFloat(item.quantity) * parseFloat(item.unitPrice)\n                        ).toFixed(2)}\n                        readOnly\n                        className=\"bg-gray-100\"\n                        placeholder=\"0.00\"\n                      />\n                    </div>\n\n                    {/* Action */}\n                    <div className=\"col-span-1 flex items-center justify-center\">\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => removeItem(index)}\n                        disabled={purchaseForm.items.length === 1}\n                        className=\"text-red-500 hover:text-red-700\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n\n                {/* Summary Section */}\n                <div className=\"mt-6 p-4 border-t border-gray-200 bg-white rounded-lg\">\n                  <div className=\"grid grid-cols-12 gap-4\">\n                    <div className=\"col-span-8\"></div>\n                    <div className=\"col-span-2 text-right font-medium\">\n                      Sub Total:\n                    </div>\n                    <div className=\"col-span-2\">\n                      <Input\n                        value={calculateSubTotal().toFixed(2)}\n                        readOnly\n                        className=\"bg-gray-100 font-medium\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-12 gap-4 mt-2\">\n                    <div className=\"col-span-8\"></div>\n                    <div className=\"col-span-2 text-right font-medium\">\n                      Tax:\n                    </div>\n                    <div className=\"col-span-2\">\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        value={purchaseForm.tax || 0}\n                        onChange={(e) =>\n                          setPurchaseForm({\n                            ...purchaseForm,\n                            tax: parseFloat(e.target.value) || 0,\n                          })\n                        }\n                        placeholder=\"0.00\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-12 gap-4 mt-2\">\n                    <div className=\"col-span-8\"></div>\n                    <div className=\"col-span-2 text-right font-bold\">\n                      Total:\n                    </div>\n                    <div className=\"col-span-2\">\n                      <Input\n                        value={calculateTotal().toFixed(2)}\n                        readOnly\n                        className=\"bg-gray-100 font-bold\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex justify-end gap-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={handleCloseDialog}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createPurchaseMutation.isPending}\n                >\n                  {createPurchaseMutation.isPending\n                    ? \"Recording...\"\n                    : \"Record Purchase\"}\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">\n              Total Purchases\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrencyWithCommas(totalPurchases)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              {filteredPurchases.length} transactions\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Completed</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {statusCounts.completed || 0}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Successfully processed\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-yellow-600\">\n              {statusCounts.pending || 0}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Awaiting completion</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">\n              Unique Suppliers\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{uniqueSuppliers.length}</div>\n            <p className=\"text-xs text-muted-foreground\">Active vendors</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters and Search */}\n      <Card>\n        <CardContent className=\"pt-6 pb-4 space-y-4\">\n          <div className=\"flex flex-col lg:flex-row gap-4\">\n            <div className=\"flex-1\">\n              <SearchBar\n                value={searchTerm}\n                onChange={setSearchTerm}\n                placeholder=\"Search by supplier, invoice number, or amount...\"\n                className=\"w-full\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div>\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"All statuses\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All statuses</SelectItem>\n                    <SelectItem value=\"completed\">Completed</SelectItem>\n                    <SelectItem value=\"pending\">Pending</SelectItem>\n                    <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                    <SelectItem value=\"partial\">Partial</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Select\n                  value={supplierFilter}\n                  onValueChange={setSupplierFilter}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"All suppliers\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All suppliers</SelectItem>\n                    {uniqueSuppliers.map((supplier) => (\n                      <SelectItem key={supplier} value={supplier}>\n                        {supplier}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Input\n                  id=\"date-from\"\n                  type=\"date\"\n                  value={dateFrom}\n                  onChange={(e) => setDateFrom(e.target.value)}\n                />\n              </div>\n              <div>\n                <Input\n                  id=\"date-to\"\n                  type=\"date\"\n                  value={dateTo}\n                  onChange={(e) => setDateTo(e.target.value)}\n                />\n              </div>\n            </div>\n          </div>\n          {(searchTerm ||\n            statusFilter !== \"all\" ||\n            supplierFilter !== \"all\" ||\n            dateFrom ||\n            dateTo) && (\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => {\n                  setSearchTerm(\"\");\n                  setStatusFilter(\"all\");\n                  setSupplierFilter(\"all\");\n                  setDateFrom(\"\");\n                  setDateTo(\"\");\n                }}\n              >\n                Clear Filters\n              </Button>\n              <span className=\"text-sm text-muted-foreground self-center\">\n                Showing {filteredPurchases.length} of {purchases.length}{\" \"}\n                purchases\n              </span>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Purchase History Table */}\n      <Card>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <SortableTableHeader\n                    label=\"Date\"\n                    sortKey=\"purchaseDate\"\n                    sortConfig={sortConfig}\n                    onSort={requestSort}\n                  >\n                    Date\n                  </SortableTableHeader>\n                  <SortableTableHeader\n                    label=\"Supplier Name\"\n                    sortKey=\"supplierName\"\n                    sortConfig={sortConfig}\n                    onSort={requestSort}\n                  >\n                    Supplier Name\n                  </SortableTableHeader>\n                  <SortableTableHeader\n                    label=\"Invoice Number\"\n                    sortKey=\"invoiceNumber\"\n                    sortConfig={sortConfig}\n                    onSort={requestSort}\n                  >\n                    Invoice Number\n                  </SortableTableHeader>\n                  <SortableTableHeader>Items</SortableTableHeader>\n                  <SortableTableHeader\n                    label=\"Total Amount\"\n                    sortKey=\"totalAmount\"\n                    sortConfig={sortConfig}\n                    onSort={requestSort}\n                  >\n                    Total Amount\n                  </SortableTableHeader>\n                  <SortableTableHeader>Payment Method</SortableTableHeader>\n                  <SortableTableHeader\n                    label=\"Status\"\n                    sortKey=\"status\"\n                    sortConfig={sortConfig}\n                    onSort={requestSort}\n                  >\n                    Status\n                  </SortableTableHeader>\n                  <SortableTableHeader>Actions</SortableTableHeader>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {currentItems.length > 0 ? (\n                  currentItems.map((purchase) => (\n                    <TableRow key={purchase.id}>\n                      <TableCell>\n                        {format(\n                          new Date(purchase.purchaseDate || purchase.createdAt),\n                          \"MMM dd, yyyy\",\n                        )}\n                      </TableCell>\n                      <TableCell className=\"font-medium\">\n                        {purchase.supplierName}\n                        {purchase.partyId && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"ml-2 h-6 px-2\"\n                            onClick={() =>\n                              viewSupplierLedger(purchase.partyId!)\n                            }\n                            title=\"View Supplier Ledger\"\n                          >\n                            <ExternalLink className=\"h-3 w-3\" />\n                          </Button>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {purchase.invoiceNumber ? (\n                          purchase.invoiceNumber\n                        ) : (\n                          <span className=\"text-muted-foreground\">\n                            No invoice\n                          </span>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleViewDetails(purchase)}\n                          className=\"text-blue-600 hover:text-blue-800 flex items-center gap-1\"\n                        >\n                          <ShoppingCart className=\"h-4 w-4\" />\n                          View Items\n                        </Button>\n                      </TableCell>\n                      <TableCell className=\"font-medium\">\n                        {formatCurrencyWithCommas(\n                          parseFloat(purchase.totalAmount || \"0\"),\n                        )}\n                      </TableCell>\n                      <TableCell className=\"capitalize\">\n                        {purchase.paymentMethod?.replace(\"_\", \" \") || \"N/A\"}\n                      </TableCell>\n                      <TableCell>{getStatusBadge(purchase.status)}</TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleViewDetails(purchase)}\n                            title=\"View Details\"\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(purchase)}\n                            title=\"Edit Purchase\"\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleDelete(purchase.id)}\n                            title=\"Delete Purchase\"\n                            className=\"text-red-600 hover:text-red-800\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))\n                ) : (\n                  <TableRow>\n                    <TableCell colSpan={8} className=\"text-center py-8\">\n                      <div className=\"flex flex-col items-center text-muted-foreground\">\n                        <ShoppingBag className=\"h-12 w-12 mb-4 opacity-50\" />\n                        <h3 className=\"text-lg font-semibold mb-2\">\n                          No Purchase Record Found\n                        </h3>\n                        <p className=\"text-sm mb-4\">\n                          {searchTerm || statusFilter !== \"all\"\n                            ? \"Try adjusting your search or filter criteria.\"\n                            : \"Start by adding a new purchase entry.\"}\n                        </p>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                )}\n              </TableBody>\n            </Table>\n          </div>\n\n          {/* Pagination */}\n          <div className=\"flex flex-col sm:flex-row justify-between items-center gap-4 mt-4\">\n            <PaginationInfo\n              currentPage={currentPage}\n              totalPages={totalPages}\n              totalItems={totalItems}\n            />\n            <div className=\"flex items-center gap-4\">\n              <PageSizeSelector\n                pageSize={pageSize}\n                onPageSizeChange={setPageSize}\n              />\n              <Pagination\n                currentPage={currentPage}\n                totalPages={totalPages}\n                onPageChange={goToPage}\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Purchase Details Dialog */}\n      <Dialog open={isDetailDialogOpen} onOpenChange={setIsDetailDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Purchase Details</DialogTitle>\n            <DialogDescription>\n              Complete information for purchase #{selectedPurchase?.id}\n            </DialogDescription>\n          </DialogHeader>\n\n          {selectedPurchase && (\n            <div className=\"space-y-6\">\n              {/* Purchase Information */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label className=\"text-sm font-medium\">Supplier</Label>\n                  <p className=\"text-sm\">{selectedPurchase.supplierName}</p>\n                </div>\n                <div>\n                  <Label className=\"text-sm font-medium\">Purchase Date</Label>\n                  <p className=\"text-sm\">\n                    {format(\n                      new Date(\n                        selectedPurchase.purchaseDate ||\n                          selectedPurchase.createdAt,\n                      ),\n                      \"PPP\",\n                    )}\n                  </p>\n                </div>\n                <div>\n                  <Label className=\"text-sm font-medium\">Invoice Number</Label>\n                  <p className=\"text-sm\">\n                    {selectedPurchase.invoiceNumber || \"Not provided\"}\n                  </p>\n                </div>\n                <div>\n                  <Label className=\"text-sm font-medium\">Payment Method</Label>\n                  <p className=\"text-sm capitalize\">\n                    {selectedPurchase.paymentMethod?.replace(\"_\", \" \")}\n                  </p>\n                </div>\n                <div>\n                  <Label className=\"text-sm font-medium\">Status</Label>\n                  <div className=\"mt-1\">\n                    {getStatusBadge(selectedPurchase.status)}\n                  </div>\n                </div>\n                <div>\n                  <Label className=\"text-sm font-medium\">Total Amount</Label>\n                  <p className=\"text-lg font-semibold\">\n                    {formatCurrencyWithCommas(\n                      parseFloat(selectedPurchase.totalAmount),\n                    )}\n                  </p>\n                </div>\n              </div>\n\n              {/* Purchase Items */}\n              {selectedPurchase.items && selectedPurchase.items.length > 0 && (\n                <div>\n                  <Label className=\"text-sm font-medium\">Items Purchased</Label>\n                  <div className=\"mt-2 border rounded-lg\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Item</TableHead>\n                          <TableHead>Quantity</TableHead>\n                          <TableHead>Unit</TableHead>\n                          <TableHead>Unit Price</TableHead>\n                          <TableHead>Total</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {selectedPurchase.items.map((item) => (\n                          <TableRow key={item.id}>\n                            <TableCell>{item.inventoryItemName}</TableCell>\n                            <TableCell>{item.quantity}</TableCell>\n                            <TableCell>{item.unitId || \"N/A\"}</TableCell>\n                            <TableCell>\n                              {formatCurrency(parseFloat(item.unitPrice))}\n                            </TableCell>\n                            <TableCell className=\"font-medium\">\n                              {formatCurrency(parseFloat(item.totalPrice))}\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                </div>\n              )}\n\n              {/* Notes */}\n              {selectedPurchase.notes && (\n                <div>\n                  <Label className=\"text-sm font-medium\">Notes</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {selectedPurchase.notes}\n                  </p>\n                </div>\n              )}\n\n              {/* Supplier Ledger Link */}\n              {selectedPurchase.partyId && (\n                <div className=\"border-t pt-4\">\n                  <Button\n                    onClick={() =>\n                      viewSupplierLedger(selectedPurchase.partyId!)\n                    }\n                    className=\"w-full\"\n                  >\n                    <FileText className=\"h-4 w-4 mr-2\" />\n                    View Supplier Ledger & Transaction History\n                  </Button>\n                </div>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Purchase Dialog */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Edit Purchase</DialogTitle>\n            <DialogDescription>Update purchase information</DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleEditSubmit} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"edit-supplier\">Supplier</Label>\n                <Select\n                  value={purchaseForm.partyId || undefined}\n                  onValueChange={(value) => {\n                    const party = parties.find(\n                      (p: any) => p.id === parseInt(value),\n                    );\n                    setPurchaseForm({\n                      ...purchaseForm,\n                      partyId: value,\n                      supplierName: party?.name || \"\",\n                    });\n                  }}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select supplier\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {Array.isArray(parties) &&\n                      parties.map((party: any) => (\n                        <SelectItem key={party.id} value={party.id.toString()}>\n                          {party.name}\n                        </SelectItem>\n                      ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"edit-supplierName\">Supplier Name</Label>\n                <Input\n                  id=\"edit-supplierName\"\n                  value={purchaseForm.supplierName}\n                  onChange={(e) =>\n                    setPurchaseForm({\n                      ...purchaseForm,\n                      supplierName: e.target.value,\n                    })\n                  }\n                  placeholder=\"Enter supplier name\"\n                  required\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div>\n                <Label htmlFor=\"edit-invoiceNumber\">Invoice Number</Label>\n                <Input\n                  id=\"edit-invoiceNumber\"\n                  value={purchaseForm.invoiceNumber}\n                  onChange={(e) =>\n                    setPurchaseForm({\n                      ...purchaseForm,\n                      invoiceNumber: e.target.value,\n                    })\n                  }\n                  placeholder=\"Enter invoice number\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"edit-purchaseDate\">Purchase Date</Label>\n                <Input\n                  id=\"edit-purchaseDate\"\n                  type=\"date\"\n                  value={purchaseForm.purchaseDate}\n                  onChange={(e) =>\n                    setPurchaseForm({\n                      ...purchaseForm,\n                      purchaseDate: e.target.value,\n                    })\n                  }\n                  required\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"edit-paymentMethod\">Payment Method</Label>\n                <Select\n                  value={purchaseForm.paymentMethod || undefined}\n                  onValueChange={(value) =>\n                    setPurchaseForm({ ...purchaseForm, paymentMethod: value })\n                  }\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"cash\">Cash</SelectItem>\n                    <SelectItem value=\"card\">Card</SelectItem>\n                    <SelectItem value=\"upi\">UPI</SelectItem>\n                    <SelectItem value=\"bank_transfer\">Bank Transfer</SelectItem>\n                    <SelectItem value=\"credit\">Credit</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"edit-status\">Status</Label>\n                <Select\n                  value={purchaseForm.status || undefined}\n                  onValueChange={(value) =>\n                    setPurchaseForm({ ...purchaseForm, status: value })\n                  }\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"completed\">Completed</SelectItem>\n                    <SelectItem value=\"pending\">Pending</SelectItem>\n                    <SelectItem value=\"partial\">Partial</SelectItem>\n                    <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"edit-notes\">Notes</Label>\n                <Input\n                  id=\"edit-notes\"\n                  value={purchaseForm.notes}\n                  onChange={(e) =>\n                    setPurchaseForm({\n                      ...purchaseForm,\n                      notes: e.target.value,\n                    })\n                  }\n                  placeholder=\"Additional notes\"\n                />\n              </div>\n            </div>\n\n            <div className=\"flex justify-end gap-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => {\n                  setIsEditDialogOpen(false);\n                  setEditingPurchase(null);\n                }}\n              >\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={updatePurchaseMutation.isPending}>\n                {updatePurchaseMutation.isPending\n                  ? \"Updating...\"\n                  : \"Update Purchase\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":55935,"size_tokens":null},"client/src/pages/products.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport React from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport ProductForm from \"@/components/product-form\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Edit, Trash2, Package, AlertCircle } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\nimport {\n  DataTable,\n  DataTableColumn,\n  DataTableAction,\n} from \"@/components/ui/data-table\";\n\ninterface Product {\n  id: number;\n  name: string;\n  description?: string;\n  sku?: string;\n  price: number;\n  cost: number;\n  margin: number;\n  imageUrl?: string;\n  categoryId?: number;\n  unitId?: number;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function Products() {\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [currentPage, setCurrentPage] = useState(1);\n  const [pageSize, setPageSize] = useState(10);\n  const [sortConfig, setSortConfig] = useState<{\n    key: string;\n    direction: \"asc\" | \"desc\";\n  } | null>({\n    key: \"id\",\n    direction: \"desc\",\n  });\n  const { toast } = useToast();\n  const { formatCurrency } = useCurrency();\n\n  // Fetch products with pagination\n  const {\n    data: productsResponse,\n    isLoading,\n    error,\n    refetch,\n  } = useQuery({\n    queryKey: [\n      \"/api/products/paginated\",\n      currentPage,\n      pageSize,\n      sortConfig?.key,\n      sortConfig?.direction,\n      searchQuery,\n    ],\n    queryFn: async () => {\n      try {\n        const params = new URLSearchParams({\n          page: currentPage.toString(),\n          limit: pageSize.toString(),\n          sortBy: sortConfig?.key || \"id\",\n          sortOrder: sortConfig?.direction || \"desc\",\n          ...(searchQuery && { search: searchQuery }),\n        });\n        console.log(\"üì¶ Fetching products with params:\", params.toString());\n        const response = await apiRequest(\"GET\", `/api/products/paginated?${params.toString()}`);\n        console.log(\"‚úÖ Products response:\", response);\n        \n        // Extract data from response\n        if (response && typeof response === 'object') {\n          // If response has data property (standard API response)\n          if (response.data !== undefined) {\n            return {\n              data: Array.isArray(response.data) ? response.data : [],\n              pagination: response.pagination || {\n                currentPage: Number(currentPage),\n                totalPages: 1,\n                totalItems: Array.isArray(response.data) ? response.data.length : 0,\n                pageSize: Number(pageSize),\n              },\n            };\n          }\n          // If response is directly an array\n          if (Array.isArray(response)) {\n            return {\n              data: response,\n              pagination: {\n                currentPage: Number(currentPage),\n                totalPages: Math.ceil(response.length / Number(pageSize)),\n                totalItems: response.length,\n                pageSize: Number(pageSize),\n              },\n            };\n          }\n        }\n        \n        console.error(\"Invalid response format:\", response);\n        return { \n          data: [], \n          pagination: { \n            currentPage: 1, \n            totalPages: 0, \n            totalItems: 0, \n            pageSize: pageSize \n          } \n        };\n      } catch (error) {\n        console.error(\"‚ùå Error fetching products:\", error);\n        throw error;\n      }\n    },\n    placeholderData: (previousData) => previousData,\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 2;\n    },\n  });\n\n  // Handle different response formats from the API\n  const products = React.useMemo(() => {\n    console.log(\"üì¶ Products response:\", productsResponse);\n    \n    if (!productsResponse) {\n      console.log(\"‚ùå No products response\");\n      return [];\n    }\n    \n    // If response has success flag and data property\n    if (productsResponse.success && productsResponse.data && Array.isArray(productsResponse.data)) {\n      console.log(\"‚úÖ Found products in success response data:\", productsResponse.data.length);\n      return productsResponse.data;\n    }\n    \n    // If response has data property (paginated)\n    if (productsResponse.data && Array.isArray(productsResponse.data)) {\n      console.log(\"‚úÖ Found products in data property:\", productsResponse.data.length);\n      return productsResponse.data;\n    }\n    \n    // If response is directly an array\n    if (Array.isArray(productsResponse)) {\n      console.log(\"‚úÖ Found products as array:\", productsResponse.length);\n      return productsResponse;\n    }\n    \n    console.log(\"‚ö†Ô∏è Unexpected response format:\", typeof productsResponse);\n    return [];\n  }, [productsResponse]);\n    \n  const pagination = React.useMemo(() => {\n    if (productsResponse?.pagination) {\n      return productsResponse.pagination;\n    }\n    \n    // Calculate pagination from array length\n    const total = products.length;\n    return {\n      currentPage: currentPage,\n      totalPages: Math.ceil(total / pageSize),\n      totalItems: total,\n      pageSize: pageSize,\n    };\n  }, [productsResponse, products.length, currentPage, pageSize]);\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/products/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products/paginated\"] });\n      toast({\n        title: \"Success\",\n        description: \"Product deleted successfully\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete product\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEdit = (product: Product) => {\n    setEditingProduct(product);\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (id: number) => {\n    deleteMutation.mutate(id);\n  };\n\n  const handleCloseDialog = () => {\n    setIsDialogOpen(false);\n    setEditingProduct(null);\n  };\n\n  const handleSort = (key: string) => {\n    setSortConfig((prev) => ({\n      key,\n      direction:\n        prev?.key === key && prev?.direction === \"asc\" ? \"desc\" : \"asc\",\n    }));\n  };\n\n  // Define table columns\n  const columns: DataTableColumn<Product>[] = [\n    {\n      key: \"name\",\n      title: \"Product\",\n      sortable: true,\n      render: (value, row) => (\n        <div className=\"flex items-center space-x-3\">\n          {row.imageUrl && (\n            <img\n              src={row.imageUrl}\n              alt={row.name}\n              className=\"w-10 h-10 rounded-lg object-cover\"\n            />\n          )}\n          <div>\n            <div className=\"font-medium\">{value}</div>\n            {row.description && (\n              <div className=\"text-sm text-muted-foreground truncate max-w-xs\">\n                {row.description}\n              </div>\n            )}\n          </div>\n        </div>\n      ),\n    },\n    {\n      key: \"sku\",\n      title: \"SKU\",\n      sortable: true,\n      className: \"hidden md:table-cell\",\n      render: (value) =>\n        value || <span className=\"text-muted-foreground\">-</span>,\n    },\n    {\n      key: \"price\",\n      title: \"Price\",\n      sortable: true,\n      render: (value) => (\n        <span className=\"font-medium\">{formatCurrency(value)}</span>\n      ),\n    },\n    {\n      key: \"cost\",\n      title: \"Cost\",\n      sortable: true,\n      render: (value) => formatCurrency(value),\n    },\n    {\n      key: \"margin\",\n      title: \"Margin\",\n      sortable: true,\n      render: (value) => (\n        <Badge variant={value > 0 ? \"default\" : \"destructive\"}>\n          {formatCurrency(value)}\n        </Badge>\n      ),\n    },\n  ];\n\n  // Define table actions\n  const actions: DataTableAction<Product>[] = [\n    {\n      label: \"Edit\",\n      icon: <Edit className=\"h-4 w-4\" />,\n      onClick: handleEdit,\n      variant: \"ghost\",\n    },\n    {\n      label: \"Delete\",\n      icon: <Trash2 className=\"h-4 w-4\" />,\n      onClick: (row) => handleDelete(row.id),\n      variant: \"ghost\",\n      className: \"text-red-600 hover:text-red-700\",\n    },\n  ];\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-muted-foreground\">\n            Manage your product catalog and pricing\n          </p>\n        </div>\n      </div>\n\n      {error && (\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertDescription>\n            Error loading products: {error?.message || 'Unknown error'}\n          </AlertDescription>\n        </Alert>\n      )}\n\n      <DataTable\n        title=\"Products List\"\n        data={products}\n        columns={columns}\n        actions={actions}\n        loading={isLoading}\n        error={error?.message}\n        searchable\n        searchPlaceholder=\"Search products...\"\n        searchValue={searchQuery}\n        onSearchChange={setSearchQuery}\n        exportable\n        onExportClick={() => {\n          toast({\n            title: \"Export\",\n            description:\n              \"Product export functionality will be implemented soon\",\n          });\n        }}\n        refreshable\n        onRefreshClick={() => refetch()}\n        currentPage={pagination.currentPage}\n        totalPages={pagination.totalPages}\n        pageSize={pagination.pageSize}\n        totalItems={pagination.totalItems}\n        onPageChange={setCurrentPage}\n        onPageSizeChange={setPageSize}\n        sortConfig={sortConfig}\n        onSort={handleSort}\n        headerActions={\n          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Product\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>\n                  {editingProduct ? \"Edit Product\" : \"Add New Product\"}\n                </DialogTitle>\n                <DialogDescription>\n                  {editingProduct\n                    ? \"Update product information\"\n                    : \"Enter product details to add a new product\"}\n                </DialogDescription>\n              </DialogHeader>\n              <ProductForm\n                product={editingProduct}\n                onSuccess={handleCloseDialog}\n              />\n            </DialogContent>\n          </Dialog>\n        }\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":11500,"size_tokens":null},"client/src/pages/settings.tsx":{"content":"\nimport React, { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Settings2,\n  Building,\n  Bell,\n  Shield,\n  Database,\n  Check,\n  Printer,\n  Settings as SettingsIcon,\n  RefreshCw,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCompanyBranding } from \"@/hooks/use-company-branding\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useRoleAccess } from \"@/hooks/useRoleAccess\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { Separator } from \"@/components/ui/separator\";\n\n// Function to convert hex to HSL\nfunction hexToHsl(hex: string) {\n  const r = parseInt(hex.slice(1, 3), 16) / 255;\n  const g = parseInt(hex.slice(3, 5), 16) / 255;\n  const b = parseInt(hex.slice(5, 7), 16) / 255;\n\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  let h,\n    s,\n    l = (max + min) / 2;\n\n  if (max === min) {\n    h = s = 0;\n  } else {\n    const d = max - min;\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n    switch (max) {\n      case r:\n        h = (g - b) / d + (g < b ? 6 : 0);\n        break;\n      case g:\n        h = (b - r) / d + 2;\n        break;\n      case b:\n        h = (r - g) / d + 4;\n        break;\n      default:\n        h = 0;\n    }\n    h /= 6;\n  }\n\n  return `hsl(${Math.round(h * 360)}, ${Math.round(s * 100)}%, ${Math.round(l * 100)}%)`;\n}\n\n// Function to apply theme color\nfunction applyThemeColor(color: string) {\n  const hslColor = hexToHsl(color);\n  document.documentElement.style.setProperty(\"--theme-color\", hslColor);\n}\n\nconst THEME_COLORS = [\n  {\n    name: \"Blue Steel\",\n    value: \"#507e96\",\n    description: \"Professional blue-gray\",\n  },\n  {\n    name: \"Golden Yellow\",\n    value: \"#ffca44\",\n    description: \"Warm sunshine yellow\",\n  },\n  { name: \"Forest Green\", value: \"#0f6863\", description: \"Rich forest green\" },\n  { name: \"Cherry Red\", value: \"#e40126\", description: \"Bold cherry red\" },\n  { name: \"Warm Bronze\", value: \"#c1853b\", description: \"Elegant bronze tone\" },\n  { name: \"Coffee Brown\", value: \"#7B4019\", description: \"Rich coffee brown\" },\n  {\n    name: \"Orange Sunset\",\n    value: \"#FF7D29\",\n    description: \"Vibrant sunset orange\",\n  },\n];\n\nfunction ThemeColorSelector({\n  settings,\n  onUpdate,\n}: {\n  settings: any;\n  onUpdate: (data: any) => void;\n}) {\n  const currentTheme = settings?.themeColor || \"#507e96\";\n  const [selectedColor, setSelectedColor] = useState(currentTheme);\n\n  const handleColorSelect = (color: string) => {\n    setSelectedColor(color);\n    applyThemeColor(color);\n\n    console.log(\"üé® Applying theme color:\", color);\n    onUpdate({ themeColor: color });\n\n    localStorage.setItem(\"themeColor\", color);\n  };\n\n  React.useEffect(() => {\n    if (settings?.themeColor) {\n      applyThemeColor(settings.themeColor);\n      setSelectedColor(settings.themeColor);\n    }\n  }, [settings]);\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {THEME_COLORS.map((color) => (\n          <div\n            key={color.value}\n            className={`relative p-4 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md ${\n              selectedColor === color.value\n                ? \"border-primary bg-primary/5\"\n                : \"border-border hover:border-primary/50\"\n            }`}\n            onClick={() => handleColorSelect(color.value)}\n          >\n            <div className=\"flex items-center gap-3\">\n              <div\n                className=\"w-8 h-8 rounded-full border-2 border-white shadow-sm\"\n                style={{ backgroundColor: color.value }}\n              />\n              <div className=\"flex-1\">\n                <h4 className=\"font-medium text-sm\">{color.name}</h4>\n                <p className=\"text-xs text-muted-foreground\">\n                  {color.description}\n                </p>\n              </div>\n            </div>\n            {selectedColor === color.value && (\n              <Check className=\"absolute top-2 right-2 h-4 w-4 text-primary\" />\n            )}\n          </div>\n        ))}\n      </div>\n      <div className=\"pt-4 border-t\">\n        <p className=\"text-sm text-muted-foreground\">\n          Current theme color will be applied to buttons, links, and accent\n          elements throughout the application.\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport default function Settings() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"general\");\n  const [customSizes, setCustomSizes] = useState<\n    Array<{ name: string; width: string; height: string }>\n  >([]);\n  const [showCustomSize, setShowCustomSize] = useState(false);\n  const [customWidth, setCustomWidth] = useState(\"\");\n  const [customHeight, setCustomHeight] = useState(\"\");\n\n  const { data: settings = {}, isLoading: settingsLoading } = useQuery({\n    queryKey: [\"/settings\"],\n  });\n\n  React.useEffect(() => {\n    const savedSizes = localStorage.getItem(\"customLabelSizes\");\n    if (savedSizes) {\n      try {\n        setCustomSizes(JSON.parse(savedSizes));\n      } catch (e) {\n        console.warn(\"Failed to parse custom sizes:\", e);\n      }\n    }\n  }, []);\n\n  React.useEffect(() => {\n    setShowCustomSize(settings.labelSize === \"custom\");\n  }, [settings.labelSize]);\n\n  const updateSettingsMutation = useMutation({\n    mutationFn: async (data: any) => {\n      console.log(\"üöÄ Sending settings update:\", data);\n      return apiRequest(\"PUT\", \"/settings\", data);\n    },\n    onSuccess: (response) => {\n      console.log(\"‚úÖ Settings update successful:\", response);\n      queryClient.invalidateQueries({ queryKey: [\"/settings\"] });\n      toast({\n        title: \"Success\",\n        description: \"Settings updated successfully\",\n      });\n    },\n    onError: (error: any) => {\n      console.error(\"‚ùå Settings update failed:\", error);\n      \n      // Check for authentication errors\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Your session has expired. Please log in again.\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/\";\n        }, 1500);\n        return;\n      }\n      \n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update settings\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSaveGeneral = async (e: React.FormEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    try {\n      const formData = new FormData(e.target as HTMLFormElement);\n\n      const data = {\n        companyName: formData.get(\"companyName\")?.toString() || \"\",\n        companyAddress: formData.get(\"companyAddress\")?.toString() || \"\",\n        companyPhone: formData.get(\"companyPhone\")?.toString() || \"\",\n        companyEmail: formData.get(\"companyEmail\")?.toString() || \"\",\n        companyRegNo: formData.get(\"companyRegNo\")?.toString() || \"\",\n        companyDtqocNo: formData.get(\"companyDtqocNo\")?.toString() || \"\",\n        timezone: formData.get(\"timezone\")?.toString() || \"UTC\",\n        currency: formData.get(\"currency\")?.toString() || \"USD\",\n      };\n\n      console.log(\"üìù Saving general settings:\", data);\n      updateSettingsMutation.mutate(data);\n    } catch (error) {\n      console.error(\"‚ùå Error preparing general settings:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to prepare settings data\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleSaveNotifications = async (e: React.FormEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    try {\n      const formData = new FormData(e.target as HTMLFormElement);\n\n      const data = {\n        emailNotifications: formData.get(\"emailNotifications\") === \"on\",\n        lowStockAlerts: formData.get(\"lowStockAlerts\") === \"on\",\n        orderNotifications: formData.get(\"orderNotifications\") === \"on\",\n        productionReminders: formData.get(\"productionReminders\") === \"on\",\n      };\n\n      console.log(\"üìù Saving notification settings:\", data);\n      updateSettingsMutation.mutate(data);\n    } catch (error) {\n      console.error(\"‚ùå Error preparing notification settings:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to prepare settings data\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleSaveSecurity = async (e: React.FormEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    try {\n      const formData = new FormData(e.target as HTMLFormElement);\n\n      const data = {\n        twoFactorAuth: formData.get(\"twoFactorAuth\") === \"on\",\n        sessionTimeout: formData.get(\"sessionTimeout\")?.toString() || \"60\",\n        passwordPolicy: formData.get(\"passwordPolicy\")?.toString() || \"medium\",\n      };\n\n      console.log(\"üìù Saving security settings:\", data);\n      updateSettingsMutation.mutate(data);\n    } catch (error) {\n      console.error(\"‚ùå Error preparing security settings:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to prepare settings data\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  React.useEffect(() => {\n    if (settings.defaultPrinter && settings.defaultPrinter.trim() !== \"\") {\n      console.log(\n        \"üñ®Ô∏è Auto-selecting default printer:\",\n        settings.defaultPrinter,\n      );\n    }\n  }, [settings.defaultPrinter]);\n\n  const handleTestPrint = () => {\n    const printSettings = {\n      labelSize: settings.labelSize || \"small\",\n      orientation: settings.labelOrientation || \"portrait\",\n      margins: {\n        top: settings.labelMarginTop || \"2\",\n        bottom: settings.labelMarginBottom || \"2\",\n        left: settings.labelMarginLeft || \"2\",\n        right: settings.labelMarginRight || \"2\",\n      },\n      customWidth: customWidth || settings.customLabelWidth,\n      customHeight: customHeight || settings.customLabelHeight,\n    };\n\n    generateTestPrintLabel(printSettings);\n  };\n\n  const generateTestPrintLabel = (printSettings: any) => {\n    const printWindow = window.open(\"\", \"_blank\");\n    if (!printWindow) {\n      toast({\n        title: \"Error\",\n        description: \"Please allow pop-ups for test printing\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    let paperWidth = \"50mm\";\n    let paperHeight = \"30mm\";\n\n    switch (printSettings.labelSize) {\n      case \"A4\":\n        paperWidth = \"210mm\";\n        paperHeight = \"297mm\";\n        break;\n      case \"A5\":\n        paperWidth = \"148mm\";\n        paperHeight = \"210mm\";\n        break;\n      case \"A6\":\n        paperWidth = \"105mm\";\n        paperHeight = \"148mm\";\n        break;\n      case \"medium\":\n        paperWidth = \"75mm\";\n        paperHeight = \"50mm\";\n        break;\n      case \"large\":\n        paperWidth = \"100mm\";\n        paperHeight = \"75mm\";\n        break;\n      case \"custom_40x30\":\n        paperWidth = \"40mm\";\n        paperHeight = \"30mm\";\n        break;\n      default:\n        if (printSettings.customWidth && printSettings.customHeight) {\n          paperWidth = `${printSettings.customWidth}mm`;\n          paperHeight = `${printSettings.customHeight}mm`;\n        }\n    }\n\n    if (printSettings.orientation === \"landscape\") {\n      [paperWidth, paperHeight] = [paperHeight, paperWidth];\n    }\n\n    const marginTop = `${printSettings.margins.top}mm`;\n    const marginRight = `${printSettings.margins.right}mm`;\n    const marginBottom = `${printSettings.margins.bottom}mm`;\n    const marginLeft = `${printSettings.margins.left}mm`;\n\n    const testLabelHTML = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Test Print Label</title>\n        <style>\n          * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n          }\n\n          @page {\n            size: ${paperWidth} ${paperHeight};\n            margin: ${marginTop} ${marginRight} ${marginBottom} ${marginLeft};\n          }\n\n          html, body {\n            width: ${paperWidth};\n            height: ${paperHeight};\n            margin: 0;\n            padding: 0;\n          }\n\n          body {\n            font-family: Arial, sans-serif;\n            font-size: 10px;\n            padding: 8px;\n            display: flex;\n            flex-direction: column;\n            justify-content: space-between;\n            overflow: hidden;\n          }\n\n          .header {\n            text-align: center;\n            font-weight: bold;\n            font-size: 12px;\n            margin-bottom: 6px;\n          }\n\n          .content {\n            flex: 1;\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            align-items: center;\n            text-align: center;\n          }\n\n          .product-name {\n            font-size: 14px;\n            font-weight: bold;\n            margin: 6px 0;\n          }\n\n          .qr-placeholder {\n            width: 50px;\n            height: 50px;\n            border: 2px solid #333;\n            margin: 6px auto;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 7px;\n          }\n\n          .info {\n            font-size: 9px;\n            margin: 2px 0;\n          }\n\n          .footer {\n            text-align: center;\n            font-size: 8px;\n            margin-top: 6px;\n          }\n\n          @media print {\n            html, body {\n              width: ${paperWidth};\n              height: ${paperHeight};\n            }\n            body { \n              -webkit-print-color-adjust: exact;\n              print-color-adjust: exact;\n            }\n          }\n        </style>\n      </head>\n      <body>\n        <div class=\"header\">\n          ${settings.companyName || \"Mero BakeSoft\"}\n        </div>\n\n        <div class=\"content\">\n          <div class=\"product-name\">Sample Product</div>\n          <div class=\"qr-placeholder\">QR CODE</div>\n          <div class=\"info\">Weight: 500g</div>\n          <div class=\"info\">SKU: TEST001</div>\n        </div>\n\n        <div class=\"footer\">\n          ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}\n        </div>\n      </body>\n      </html>\n    `;\n\n    printWindow.document.write(testLabelHTML);\n    printWindow.document.close();\n\n    setTimeout(() => {\n      printWindow.print();\n    }, 500);\n\n    toast({\n      title: \"Test Print\",\n      description: `Print preview opened. Size: ${paperWidth} √ó ${paperHeight} (${printSettings.orientation})`,\n    });\n  };\n\n  const handleSavePrinting = async (e: React.FormEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    try {\n      const formData = new FormData(e.target as HTMLFormElement);\n\n      let labelSize = formData.get(\"labelSize\")?.toString() || \"small\";\n      let customSizeName = \"\";\n\n      if (labelSize === \"custom\" && customWidth && customHeight) {\n        customSizeName = `Custom (${customWidth}x${customHeight}mm)`;\n\n        const newCustomSize = {\n          name: customSizeName,\n          width: customWidth,\n          height: customHeight,\n        };\n\n        const existingIndex = customSizes.findIndex(\n          (size) => size.width === customWidth && size.height === customHeight,\n        );\n\n        if (existingIndex === -1) {\n          const updatedSizes = [...customSizes, newCustomSize];\n          setCustomSizes(updatedSizes);\n          localStorage.setItem(\"customLabelSizes\", JSON.stringify(updatedSizes));\n        }\n\n        labelSize = customSizeName;\n      }\n\n      const data = {\n        defaultPrinter: formData.get(\"defaultPrinter\")?.toString() || \"\",\n        labelSize: labelSize,\n        labelOrientation:\n          formData.get(\"labelOrientation\")?.toString() || \"portrait\",\n        labelMarginTop: formData.get(\"labelMarginTop\")?.toString() || \"2\",\n        labelMarginBottom: formData.get(\"labelMarginBottom\")?.toString() || \"2\",\n        labelMarginLeft: formData.get(\"labelMarginLeft\")?.toString() || \"2\",\n        labelMarginRight: formData.get(\"labelMarginRight\")?.toString() || \"2\",\n        customLabelWidth: customWidth || \"\",\n        customLabelHeight: customHeight || \"\",\n      };\n\n      console.log(\"üìù Saving printing settings:\", data);\n      updateSettingsMutation.mutate(data);\n    } catch (error) {\n      console.error(\"‚ùå Error preparing printing settings:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to prepare settings data\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-6\">\n      <div className=\"flex items-center gap-4\">\n        <Settings2 className=\"h-8 w-8 text-primary\" />\n        <div>\n          <h1 className=\"text-3xl font-bold\">Settings</h1>\n          <p className=\"text-gray-600\">Manage your system preferences</p>\n        </div>\n      </div>\n\n      <Tabs\n        value={activeTab}\n        onValueChange={setActiveTab}\n        className=\"space-y-6\"\n      >\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"general\">General</TabsTrigger>\n          <TabsTrigger value=\"notifications\">Notifications</TabsTrigger>\n          <TabsTrigger value=\"security\">Security</TabsTrigger>\n          <TabsTrigger value=\"printing\">Printing</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"general\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Building className=\"h-5 w-5\" />\n                General Settings\n              </CardTitle>\n              <CardDescription>\n                Configure your company information and system preferences\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSaveGeneral} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"companyName\">Company Name</Label>\n                    <Input\n                      id=\"companyName\"\n                      name=\"companyName\"\n                      placeholder=\"Baker Soft Pvt. Ltd.\"\n                      defaultValue={settings.companyName}\n                      required\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"companyPhone\">Phone Number</Label>\n                    <Input\n                      id=\"companyPhone\"\n                      name=\"companyPhone\"\n                      placeholder=\"+977 9800000000\"\n                      defaultValue={settings.companyPhone || \"\"}\n                    />\n                  </div>\n                </div>\n                <div>\n                  <Label htmlFor=\"companyAddress\">Address</Label>\n                  <Input\n                    id=\"companyAddress\"\n                    name=\"companyAddress\"\n                    placeholder=\"Kathmandu, Nepal\"\n                    defaultValue={settings.companyAddress || \"\"}\n                  />\n                </div>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"companyRegNo\">Registration Number</Label>\n                    <Input\n                      id=\"companyRegNo\"\n                      name=\"companyRegNo\"\n                      placeholder=\"1000/080/81\"\n                      defaultValue={settings.companyRegNo || \"\"}\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"companyDtqocNo\">DTQOC Number</Label>\n                    <Input\n                      id=\"companyDtqocNo\"\n                      name=\"companyDtqocNo\"\n                      placeholder=\"DTQOC-123456\"\n                      defaultValue={settings.companyDtqocNo || \"\"}\n                    />\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"companyEmail\">Email</Label>\n                    <Input\n                      id=\"companyEmail\"\n                      name=\"companyEmail\"\n                      type=\"email\"\n                      placeholder=\"info@bakersoft.com\"\n                      defaultValue={settings.companyEmail}\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"timezone\">Timezone</Label>\n                    <Select\n                      name=\"timezone\"\n                      defaultValue={settings.timezone || \"UTC\"}\n                    >\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"UTC\">UTC</SelectItem>\n                        <SelectItem value=\"America/New_York\">\n                          Eastern Time\n                        </SelectItem>\n                        <SelectItem value=\"America/Chicago\">\n                          Central Time\n                        </SelectItem>\n                        <SelectItem value=\"America/Denver\">\n                          Mountain Time\n                        </SelectItem>\n                        <SelectItem value=\"America/Los_Angeles\">\n                          Pacific Time\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"currency\">Currency</Label>\n                    <Select\n                      name=\"currency\"\n                      defaultValue={settings.currency || \"NPR\"}\n                    >\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"USD\">USD ($)</SelectItem>\n                        <SelectItem value=\"EUR\">EUR (‚Ç¨)</SelectItem>\n                        <SelectItem value=\"GBP\">GBP (¬£)</SelectItem>\n                        <SelectItem value=\"NPR\">NPR (‚Ç®)</SelectItem>\n                        <SelectItem value=\"INR\">INR (‚Çπ)</SelectItem>\n                        <SelectItem value=\"AUD\">AUD (A$)</SelectItem>\n                        <SelectItem value=\"CNY\">CNY (¬•)</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n                <Button\n                  type=\"submit\"\n                  disabled={updateSettingsMutation.isPending}\n                >\n                  {updateSettingsMutation.isPending ? (\n                    <>\n                      <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Saving...\n                    </>\n                  ) : (\n                    \"Save General Settings\"\n                  )}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"notifications\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Bell className=\"h-5 w-5\" />\n                Notification Settings\n              </CardTitle>\n              <CardDescription>\n                Configure how and when you receive notifications\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSaveNotifications} className=\"space-y-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <Label htmlFor=\"emailNotifications\">\n                      Email Notifications\n                    </Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Receive notifications via email\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"emailNotifications\"\n                    name=\"emailNotifications\"\n                    defaultChecked={settings.emailNotifications === true}\n                  />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <Label htmlFor=\"lowStockAlerts\">Low Stock Alerts</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Get notified when inventory is running low\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"lowStockAlerts\"\n                    name=\"lowStockAlerts\"\n                    defaultChecked={settings.lowStockAlerts === true}\n                  />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <Label htmlFor=\"orderNotifications\">\n                      Order Notifications\n                    </Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Receive alerts for new orders\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"orderNotifications\"\n                    name=\"orderNotifications\"\n                    defaultChecked={settings.orderNotifications === true}\n                  />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <Label htmlFor=\"productionReminders\">\n                      Production Reminders\n                    </Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Get reminders for scheduled production\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"productionReminders\"\n                    name=\"productionReminders\"\n                    defaultChecked={settings.productionReminders === true}\n                  />\n                </div>\n                <Button\n                  type=\"submit\"\n                  disabled={updateSettingsMutation.isPending}\n                >\n                  {updateSettingsMutation.isPending ? (\n                    <>\n                      <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Saving...\n                    </>\n                  ) : (\n                    \"Save Notification Settings\"\n                  )}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"security\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Shield className=\"h-5 w-5\" />\n                Security Settings\n              </CardTitle>\n              <CardDescription>\n                Manage security preferences and access controls\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSaveSecurity} className=\"space-y-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <Label htmlFor=\"twoFactorAuth\">\n                      Two-Factor Authentication\n                    </Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Add an extra layer of security to your account\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"twoFactorAuth\"\n                    name=\"twoFactorAuth\"\n                    defaultChecked={settings.twoFactorAuth === true}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"sessionTimeout\">\n                    Session Timeout (minutes)\n                  </Label>\n                  <Input\n                    id=\"sessionTimeout\"\n                    name=\"sessionTimeout\"\n                    type=\"number\"\n                    defaultValue={settings.sessionTimeout || 60}\n                    min=\"15\"\n                    max=\"480\"\n                  />\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    Users will be logged out after this period of inactivity\n                  </p>\n                </div>\n                <div>\n                  <Label htmlFor=\"passwordPolicy\">Password Policy</Label>\n                  <Select\n                    name=\"passwordPolicy\"\n                    defaultValue={settings.passwordPolicy || \"medium\"}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"low\">Low - 6+ characters</SelectItem>\n                      <SelectItem value=\"medium\">\n                        Medium - 8+ characters with mixed case\n                      </SelectItem>\n                      <SelectItem value=\"high\">\n                        High - 12+ characters with symbols\n                      </SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <Button\n                  type=\"submit\"\n                  disabled={updateSettingsMutation.isPending}\n                >\n                  {updateSettingsMutation.isPending ? (\n                    <>\n                      <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Saving...\n                    </>\n                  ) : (\n                    \"Save Security Settings\"\n                  )}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"printing\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Printer className=\"h-5 w-5\" />\n                Label Printing Preferences\n              </CardTitle>\n              <CardDescription>\n                Configure your default label paper size and print margins\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n                <p className=\"text-sm text-blue-900 leading-relaxed\">\n                  <strong>System-Wide Configuration:</strong> Changes made here\n                  will apply to all label printing operations ‚Äî ensuring\n                  consistent sizing and alignment across every printed label.\n                </p>\n              </div>\n\n              <form onSubmit={handleSavePrinting} className=\"space-y-6\">\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2 pb-2 border-b\">\n                    <h3 className=\"text-lg font-semibold\">Paper Size</h3>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <Label htmlFor=\"labelSize\">Standard Paper Sizes</Label>\n                      <Select\n                        name=\"labelSize\"\n                        defaultValue={settings.labelSize || \"small\"}\n                        onValueChange={(value) =>\n                          setShowCustomSize(value === \"custom\")\n                        }\n                      >\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"small\">\n                            2\" √ó 1\" (50√ó30mm)\n                          </SelectItem>\n                          <SelectItem value=\"medium\">\n                            3\" √ó 2\" (75√ó50mm)\n                          </SelectItem>\n                          <SelectItem value=\"large\">\n                            4\" √ó 3\" (100√ó75mm)\n                          </SelectItem>\n                          <SelectItem value=\"custom_40x30\">40√ó30mm</SelectItem>\n                          <SelectItem value=\"A6\">A6 (105√ó148mm)</SelectItem>\n                          <SelectItem value=\"A5\">A5 (148√ó210mm)</SelectItem>\n                          <SelectItem value=\"A4\">A4 (210√ó297mm)</SelectItem>\n                          {customSizes.map((size, index) => (\n                            <SelectItem key={index} value={size.name}>\n                              {size.name}\n                            </SelectItem>\n                          ))}\n                          <SelectItem value=\"custom\">Custom Size...</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        e.g., 4\" √ó 6\", 2\" √ó 1\", A4, or Custom\n                      </p>\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"labelOrientation\">Orientation</Label>\n                      <Select\n                        name=\"labelOrientation\"\n                        defaultValue={settings.labelOrientation || \"portrait\"}\n                      >\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"portrait\">\n                            Portrait (Vertical)\n                          </SelectItem>\n                          <SelectItem value=\"landscape\">\n                            Landscape (Horizontal)\n                          </SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n\n                  {showCustomSize && (\n                    <div className=\"p-4 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50\">\n                      <h4 className=\"text-sm font-semibold mb-3 flex items-center gap-2\">\n                        <span>Custom Paper Size</span>\n                      </h4>\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                          <Label htmlFor=\"customWidth\">Width (mm)</Label>\n                          <Input\n                            id=\"customWidth\"\n                            value={customWidth}\n                            onChange={(e) => setCustomWidth(e.target.value)}\n                            type=\"number\"\n                            placeholder=\"40\"\n                            min=\"10\"\n                            max=\"300\"\n                          />\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            Min: 10mm, Max: 300mm\n                          </p>\n                        </div>\n                        <div>\n                          <Label htmlFor=\"customHeight\">Height (mm)</Label>\n                          <Input\n                            id=\"customHeight\"\n                            value={customHeight}\n                            onChange={(e) => setCustomHeight(e.target.value)}\n                            type=\"number\"\n                            placeholder=\"30\"\n                            min=\"10\"\n                            max=\"400\"\n                          />\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            Min: 10mm, Max: 400mm\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                <Separator />\n\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2 pb-2 border-b\">\n                    <h3 className=\"text-lg font-semibold\">Print Margins</h3>\n                  </div>\n\n                  <div className=\"p-4 bg-amber-50 border border-amber-200 rounded-lg\">\n                    <p className=\"text-sm text-amber-900 flex items-start gap-2\">\n                      <span className=\"text-lg\">‚úÖ</span>\n                      <span>\n                        <strong>Tip:</strong> Measure your label sheets and\n                        adjust margins to prevent cutoff or misalignment.\n                      </span>\n                    </p>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                    <div>\n                      <Label htmlFor=\"labelMarginTop\">Top Margin (mm)</Label>\n                      <Input\n                        id=\"labelMarginTop\"\n                        name=\"labelMarginTop\"\n                        type=\"number\"\n                        step=\"0.5\"\n                        defaultValue={settings.labelMarginTop || \"2\"}\n                        placeholder=\"2\"\n                        min=\"0\"\n                        max=\"50\"\n                      />\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        0-50mm\n                      </p>\n                    </div>\n                    <div>\n                      <Label htmlFor=\"labelMarginBottom\">\n                        Bottom Margin (mm)\n                      </Label>\n                      <Input\n                        id=\"labelMarginBottom\"\n                        name=\"labelMarginBottom\"\n                        type=\"number\"\n                        step=\"0.5\"\n                        defaultValue={settings.labelMarginBottom || \"2\"}\n                        placeholder=\"2\"\n                        min=\"0\"\n                        max=\"50\"\n                      />\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        0-50mm\n                      </p>\n                    </div>\n                    <div>\n                      <Label htmlFor=\"labelMarginLeft\">Left Margin (mm)</Label>\n                      <Input\n                        id=\"labelMarginLeft\"\n                        name=\"labelMarginLeft\"\n                        type=\"number\"\n                        step=\"0.5\"\n                        defaultValue={settings.labelMarginLeft || \"2\"}\n                        placeholder=\"2\"\n                        min=\"0\"\n                        max=\"50\"\n                      />\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        0-50mm\n                      </p>\n                    </div>\n                    <div>\n                      <Label htmlFor=\"labelMarginRight\">\n                        Right Margin (mm)\n                      </Label>\n                      <Input\n                        id=\"labelMarginRight\"\n                        name=\"labelMarginRight\"\n                        type=\"number\"\n                        step=\"0.5\"\n                        defaultValue={settings.labelMarginRight || \"2\"}\n                        placeholder=\"2\"\n                        min=\"0\"\n                        max=\"50\"\n                      />\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        0-50mm\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                <Separator />\n\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2 pb-2 border-b\">\n                    <h3 className=\"text-lg font-semibold\">\n                      Printer Configuration\n                    </h3>\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"defaultPrinter\">Default Printer Name</Label>\n                    <Input\n                      id=\"defaultPrinter\"\n                      name=\"defaultPrinter\"\n                      defaultValue={settings.defaultPrinter || \"\"}\n                      placeholder=\"e.g., DYMO LabelWriter 450, HP LaserJet, Brother QL-800\"\n                    />\n                    <p className=\"text-sm text-muted-foreground mt-1\">\n                      Configure your system's default printer name. This will be\n                      used for all label printing operations.\n                    </p>\n                    {settings.defaultPrinter && (\n                      <p className=\"text-xs text-green-600 mt-1\">\n                        ‚úì Currently configured: {settings.defaultPrinter}\n                      </p>\n                    )}\n                  </div>\n                </div>\n\n                <Separator />\n\n                <div className=\"p-4 bg-orange-50 border border-orange-200 rounded-lg\">\n                  <p className=\"text-sm text-orange-900 flex items-start gap-2\">\n                    <span className=\"text-lg\">‚ö†Ô∏è</span>\n                    <span>\n                      <strong>Note:</strong> These settings override individual\n                      print dialogs ‚Äî update here for organization-wide\n                      consistency.\n                    </span>\n                  </p>\n                </div>\n\n                <div className=\"flex flex-wrap gap-3 pt-4\">\n                  <Button\n                    type=\"submit\"\n                    disabled={updateSettingsMutation.isPending}\n                    className=\"min-w-[180px]\"\n                  >\n                    {updateSettingsMutation.isPending ? (\n                      <>\n                        <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\n                        Saving...\n                      </>\n                    ) : (\n                      <>Save Printing Settings</>\n                    )}\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={handleTestPrint}\n                    disabled={!settings}\n                    className=\"min-w-[140px]\"\n                  >\n                    <Printer className=\"h-4 w-4 mr-2\" />\n                    Test Print\n                  </Button>\n                </div>\n              </form>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":42727,"size_tokens":null},"server/lib/storage.ts":{"content":"import {\n  eq,\n  desc,\n  count,\n  sql,\n  and,\n  gte,\n  lte,\n  lt,\n  or,\n  ilike,\n  isNull,\n  asc,\n} from \"drizzle-orm\";\nimport { db } from \"../db\";\nimport {\n  users,\n  products,\n  inventoryItems,\n  inventoryCategories,\n  productIngredients,\n  units,\n  unitConversions,\n  orders,\n  orderItems,\n  customers,\n  parties,\n  ledgerTransactions,\n  purchases,\n  purchaseItems,\n  productionSchedule,\n  inventoryTransactions,\n  expenses,\n  assets,\n  permissions,\n  rolePermissions,\n  userPermissions,\n  settings,\n  loginLogs,\n  auditLogs,\n  type User,\n  type UpsertUser,\n  type Product,\n  type InsertProduct,\n  type InventoryItem,\n  type InsertInventoryItem,\n  type InventoryCategory,\n  type InsertInventoryCategory,\n  type ProductIngredient,\n  type InsertProductIngredient,\n  type Unit,\n  type InsertUnit,\n  type UnitConversion,\n  type InsertUnitConversion,\n  type Order,\n  type InsertOrder,\n  type OrderItem,\n  type InsertOrderItem,\n  type Customer,\n  type InsertCustomer,\n  type Party,\n  type InsertParty,\n  type Purchase,\n  type InsertPurchase,\n  type PurchaseItem,\n  type InsertPurchaseItem,\n  type ProductionScheduleItem,\n  type InsertProductionScheduleItem,\n  type InventoryTransaction,\n  type InsertInventoryTransaction,\n  type Expense,\n  type InsertExpense,\n  type Asset,\n  type InsertAsset,\n  type Permission,\n  type InsertPermission,\n  type RolePermission,\n  type InsertRolePermission,\n  type UserPermission,\n  type InsertUserPermission,\n  type LedgerTransaction,\n  type InsertLedgerTransaction,\n  type LoginLog,\n  type InsertLoginLog,\n  type AuditLog,\n  type InsertAuditLog,\n  staff,\n  attendance,\n  salaryPayments,\n  leaveRequests,\n  staffSchedules,\n  type Staff,\n  type InsertStaff,\n  type Attendance,\n  type InsertAttendance,\n  type SalaryPayment,\n  type InsertSalaryPayment,\n  type LeaveRequest,\n  type InsertLeaveRequest,\n  type StaffSchedule,\n  type InsertStaffSchedule,\n  productionScheduleLabels,\n  type ProductionScheduleLabel,\n  type InsertProductionScheduleLabel,\n  productionScheduleHistory,\n  type ProductionScheduleHistory,\n  type InsertProductionScheduleHistory,\n  sales,\n  saleItems,\n  branches,\n  type Branch,\n  type InsertBranch,\n  salesReturns,\n  dailySalesReturnSummary,\n  purchaseReturns,\n  dailyPurchaseReturnSummary,\n  type SalesReturn,\n  type InsertSalesReturn,\n  type DailySalesReturnSummary,\n  type InsertDailySalesReturnSummary,\n  type PurchaseReturn,\n  type InsertPurchaseReturn,\n  type DailyPurchaseReturnSummary,\n  type InsertDailyPurchaseReturnSummary,\n} from \"../../shared/schema\";\nimport bcrypt from \"bcrypt\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport interface IStorage {\n  // User operations\n  getUser(id: string): Promise<User | undefined>;\n  getUserById(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  upsertUser(userData: UpsertUser): Promise<User>;\n  getAllUsers(excludeSuperAdmin?: boolean): Promise<User[]>;\n  updateUser(id: string, data: any): Promise<any>;\n  deleteUser(id: string): Promise<void>;\n  ensureDefaultAdmin(): Promise<void>;\n  getUserCount(excludeSuperAdmin?: boolean): Promise<number>;\n\n  // Product operations\n  getProducts(\n    userBranchId?: number,\n    canAccessAllBranches?: boolean,\n    userRole?: string,\n  ): Promise<Product[]>;\n  getProductById(id: number): Promise<Product | undefined>;\n  getProductsWithIngredients(): Promise<any[]>;\n  createProduct(product: InsertProduct): Promise<Product>;\n  updateProduct(id: number, product: Partial<InsertProduct>): Promise<Product>;\n  deleteProduct(id: number): Promise<void>;\n  getProductIngredients(productId: number): Promise<any[]>;\n  createProductIngredient(ingredient: any): Promise<any>;\n  deleteProductIngredients(productId: number): Promise<void>;\n\n  // Unit operations\n  getUnits(): Promise<Unit[]>;\n  getActiveUnits(): Promise<Unit[]>;\n  getUnitById(id: number): Promise<Unit | undefined>;\n  createUnit(data: InsertUnit): Promise<Unit>;\n  updateUnit(id: number, data: Partial<InsertUnit>): Promise<Unit>;\n  deleteUnit(id: number): Promise<void>;\n\n  // Unit conversion operations\n  getUnitConversions(): Promise<any[]>;\n  createUnitConversion(data: any): Promise<any>;\n  updateUnitConversion(id: number, data: any): Promise<any>;\n  deleteUnitConversion(id: number): Promise<void>;\n  convertQuantity(\n    fromQuantity: number,\n    fromUnitId: number,\n    toUnitId: number,\n  ): Promise<number>;\n\n  // Inventory operations\n  getInventoryItems(options?: {\n    page?: number;\n    limit?: number;\n    search?: string;\n    group?: string;\n  }): Promise<{\n    items: InventoryItem[];\n    totalCount: number;\n    totalPages: number;\n    currentPage: number;\n    itemsPerPage: number;\n  }>;\n  getInventoryItems(\n    userBranchId?: number,\n    canAccessAllBranches?: boolean,\n    userRole?: string,\n  ): Promise<InventoryItem[]>;\n  getAllInventoryItems(): Promise<InventoryItem[]>;\n  getInventoryItemById(id: number): Promise<InventoryItem | undefined>;\n  createInventoryItem(data: any): Promise<InventoryItem>;\n  updateInventoryItem(\n    id: number,\n    data: Partial<InsertInventoryItem>,\n  ): Promise<InventoryItem>;\n  updateInventoryWithPurchase(\n    inventoryItemId: number,\n    purchaseQuantity: number,\n    purchaseRate: number,\n    purchaseDate: Date,\n  ): Promise<void>;\n  updateInventoryWithWeightedAverage(\n    inventoryItemId: number,\n    purchaseQuantity: number,\n    purchaseRate: number,\n    purchaseDate: Date,\n  ): Promise<void>;\n  deleteInventoryItem(id: number): Promise<void>;\n  getInventoryCategories(): Promise<InventoryCategory[]>;\n  createInventoryCategory(\n    data: InsertInventoryCategory,\n  ): Promise<InventoryCategory>;\n  updateInventoryCategory(\n    id: number,\n    data: Partial<InsertInventoryCategory>,\n  ): Promise<InventoryCategory>;\n  deleteInventoryCategory(id: number): Promise<void>;\n  createInventoryTransaction(\n    transaction: InsertInventoryTransaction,\n  ): Promise<InventoryTransaction>;\n  getInventoryTransactions(itemId?: number): Promise<any[]>;\n  getIngredients(): Promise<InventoryItem[]>;\n  syncStockFromPurchases();\n  updateInventoryStockAndCost(\n    itemId: number,\n    addedQuantity: number,\n    newCostPerUnit: number,\n  );\n  updateInventoryPurchaseStock(itemId: number, purchasedQuantity: number);\n\n  // Permission operations\n  getPermissions(): Promise<Permission[]>;\n  createPermission(data: InsertPermission): Promise<Permission>;\n  getRolePermissions(role: string): Promise<any[]>;\n  setRolePermissions(role: string, permissionIds: number[]): Promise<void>;\n  getUserPermissions(userId: string): Promise<any[]>;\n  setUserPermissions(\n    userId: string,\n    permissionUpdates: { permissionId: number; granted: boolean }[],\n  ): Promise<void>;\n  checkUserPermission(\n    userId: string,\n    resource: string,\n    action: string,\n  ): Promise<boolean>;\n  initializeDefaultPermissions(): Promise<void>;\n\n  // Settings operations\n  getSettings(): Promise<any>;\n  updateSettings(settingsData: any): Promise<any>;\n  saveSettings(settingsData: any): Promise<any>;\n  updateOrCreateSetting(key: string, value: string): Promise<any>;\n  saveCompanySettings(settingsData: any): Promise<void>;\n  getSetting(key: string): Promise<string | null>;\n\n  // Analytics operations\n  getDashboardStats(): Promise<any>;\n  getSalesAnalytics(startDate?: Date, endDate?: Date): Promise<any>;\n  getLoginAnalytics(startDate?: string, endDate?: string);\n\n  // Staff management operations\n  getStaff(\n    limit?: number,\n    offset?: number,\n    search?: string,\n  ): Promise<{\n    items: Staff[];\n    totalCount: number;\n    totalPages: number;\n    currentPage: number;\n    itemsPerPage: number;\n  }>;\n  getStaffById(id: number): Promise<Staff | undefined>;\n  createStaff(staffData: InsertStaff): Promise<Staff>;\n  updateStaff(id: number, staffData: Partial<InsertStaff>): Promise<Staff>;\n  deleteStaff(id: number): Promise<void>;\n  getStaffByStaffId(staffId: string): Promise<Staff | null>;\n\n  // Attendance operations\n  getAttendance(\n    staffId?: number,\n    startDate?: Date,\n    endDate?: Date,\n    limit?: number,\n    offset?: number,\n  ): Promise<{\n    items: any[];\n    totalCount: number;\n    totalPages: number;\n    currentPage: number;\n    itemsPerPage: number;\n  }>;\n  createAttendance(attendance: InsertAttendance): Promise<Attendance>;\n  updateAttendance(\n    id: number,\n    attendance: Partial<InsertAttendance>,\n  ): Promise<Attendance>;\n  deleteAttendance(id: number): Promise<void>;\n  clockIn(staffId: number): Promise<Attendance>;\n  clockOut(staffId: number): Promise<Attendance>;\n\n  // Salary operations\n  getSalaryPayments(\n    staffId?: number,\n    limit?: number,\n    offset?: number,\n    search?: string,\n  ): Promise<{\n    items: any[];\n    totalCount: number;\n    totalPages: number;\n    currentPage: number;\n    itemsPerPage: number;\n  }>;\n  createSalaryPayment(payment: InsertSalaryPayment): Promise<SalaryPayment>;\n  updateSalaryPayment(\n    id: number,\n    payment: Partial<InsertSalaryPayment>,\n  ): Promise<SalaryPayment>;\n  deleteSalaryPayment(id: number): Promise<void>;\n\n  // Leave request operations\n  getLeaveRequests(staffId?: number): Promise<any[]>;\n  createLeaveRequest(request: InsertLeaveRequest): Promise<LeaveRequest>;\n  updateLeaveRequest(\n    id: number,\n    request: Partial<InsertLeaveRequest>,\n  ): Promise<LeaveRequest>;\n  deleteLeaveRequest(id: number): Promise<void>;\n\n  // Staff schedule operations\n  getStaffSchedules(staffId?: number, date?: Date): Promise<any[]>;\n  createStaffSchedule(schedule: InsertStaffSchedule): Promise<StaffSchedule>;\n  updateStaffSchedule(\n    id: number,\n    schedule: Partial<InsertStaffSchedule>,\n  ): Promise<StaffSchedule>;\n  deleteStaffSchedule(id: number): Promise<void>;\n\n  // Customer operations\n  getCustomers(\n    limit?: number,\n    offset?: number,\n    search?: string,\n  ): Promise<{\n    items: Customer[];\n    totalCount: number;\n    totalPages: number;\n    currentPage: number;\n    itemsPerPage: number;\n  }>;\n  getCustomerById(id: number): Promise<Customer | undefined>;\n  createCustomer(customer: InsertCustomer): Promise<Customer>;\n  updateCustomer(\n    id: number,\n    customer: Partial<InsertCustomer>,\n  ): Promise<Customer>;\n  deleteCustomer(id: number): Promise<void>;\n\n  // Party operations\n  getParties(\n    limit?: number,\n    offset?: number,\n    search?: string,\n  ): Promise<{\n    items: Party[];\n    totalCount: number;\n    totalPages: number;\n    currentPage: number;\n    itemsPerPage: number;\n  }>;\n  getPartyById(id: number): Promise<Party | undefined>;\n  createParty(party: InsertParty): Promise<Party>;\n  updateParty(id: number, party: Partial<InsertParty>): Promise<Party>;\n  deleteParty(id: number): Promise<void>;\n\n  // Ledger Transaction Methods\n  createLedgerTransaction(data: any): Promise<any>;\n  getLedgerTransactions(\n    entityId: number,\n    entityType: \"customer\" | \"party\",\n    limit?: number,\n  ): Promise<any[]>;\n  updateLedgerTransaction(id: number, data: any): Promise<any>;\n  deleteLedgerTransaction(id: number): Promise<void>;\n  recalculateRunningBalance(\n    entityId: number,\n    entityType: \"customer\" | \"party\",\n  ): Promise<number>;\n\n  // Asset operations\n  getAssets(): Promise<Asset[]>;\n  getAssetById(id: number): Promise<Asset | undefined>;\n  createAsset(asset: InsertAsset): Promise<Asset>;\n  updateAsset(id: number, asset: Partial<InsertAsset>): Promise<Asset>;\n  deleteAsset(id: number): Promise<void>;\n\n  // Audit Log operations\n  createAuditLog(log: InsertAuditLog): Promise<AuditLog>;\n  getAuditLogs(filters?: {\n    userId?: string;\n    action?: string;\n    resource?: string;\n    startDate?: Date;\n    endDate?: Date;\n    limit?: number;\n    offset?: number;\n  }): Promise<AuditLog[]>;\n  logUserAction(\n    userId: string,\n    action: string,\n    resource: string,\n    details?: any,\n    ipAddress?: string,\n    userAgent?: string,\n  ): Promise<void>;\n  logLogin(\n    userId: string,\n    userEmail: string,\n    userName: string,\n    ipAddress: string,\n    userAgent: string,\n    success: boolean,\n    errorMessage?: string,\n  ): Promise<void>;\n  logLogout(\n    userId: string,\n    userEmail: string,\n    userName: string,\n    ipAddress: string,\n  ): Promise<void>;\n\n  // Purchase operations\n  getPurchases(): Promise<any[]>;\n  getPurchasesWithItems(): Promise<any[]>;\n  createPurchaseWithLedger(purchaseData: any): Promise<any>;\n  updatePurchase(id: number, purchaseData: any): Promise<any>;\n  deletePurchase(id: number): Promise<void>;\n\n  // Expense operations\n  getExpenses(): Promise<Expense[]>;\n  createExpense(expense: InsertExpense): Promise<Expense>;\n  updateExpense(id: number, expense: Partial<InsertExpense>): Promise<Expense>;\n  deleteExpense(id: number): Promise<void>;\n\n  // Order operations\n  getOrders(): Promise<Order[]>;\n  getOrderById(id: number): Promise<Order | undefined>;\n  createOrder(order: InsertOrder): Promise<Order>;\n  updateOrder(id: number, order: Partial<InsertOrder>): Promise<Order>;\n  deleteOrder(id: number): Promise<void>;\n  getOrderItems(orderId: number);\n  createOrderItem(data: any);\n  getRecentOrders(limit: number): Promise<any[]>;\n\n  // Production operations\n  getTodayProductionSchedule(): Promise<any[]>;\n  getProductionSchedule(): Promise<any[]>;\n  createProductionScheduleItem(\n    item: InsertProductionScheduleItem,\n  ): Promise<ProductionScheduleItem>;\n  updateProductionScheduleItem(\n    id: number,\n    item: Partial<InsertProductionScheduleItem>,\n  ): Promise<ProductionScheduleItem>;\n  getProductionScheduleByDate(date: string): Promise<any[]>;\n  closeDayProductionSchedule(date: string, closedBy: string): Promise<any>;\n  getProductionScheduleHistory(date?: string): Promise<any[]>;\n\n  // Media operations\n  getMediaItems(): Promise<any[]>;\n  uploadMedia(userId: string, file: any): Promise<any>;\n  deleteMedia(id: number): Promise<void>;\n\n  // Billing operations\n  getBills(): Promise<any[]>;\n  createBill(billData: any): Promise<any>;\n  deleteBill(id: number): Promise<void>;\n\n  // Notifications\n  getNotifications(userId?: string): Promise<any[]>;\n  markNotificationAsRead(notificationId: string, userId: string): Promise<void>;\n  markAllNotificationsAsRead(userId: string): Promise<void>;\n  saveNotificationSubscription(\n    userId: string,\n    subscription: any,\n  ): Promise<void>;\n  removeNotificationSubscription(userId: string): Promise<void>;\n  saveNotificationSettings(userId: string, settings: any): Promise<void>;\n  createNotification(notification: any): Promise<any>;\n  triggerBusinessNotification(event: string, data: any): Promise<void>;\n\n  // Security monitoring\n  getSecurityMetrics(timeframe?: \"hour\" | \"day\" | \"week\"): Promise<any>;\n\n  // Production Schedule Labels operations\n  getProductionScheduleLabels(): Promise<ProductionScheduleLabel[]>;\n  createProductionScheduleLabel(\n    data: InsertProductionScheduleLabel,\n  ): Promise<ProductionScheduleLabel>;\n  updateProductionScheduleLabel(\n    id: number,\n    data: Partial<InsertProductionScheduleLabel>,\n  ): Promise<ProductionScheduleLabel>;\n  closeDayForLabels(ids: number[], closedBy: string): Promise<any>;\n\n  // Supplier Ledger operations\n  getSupplierLedgers(): Promise<any[]>;\n  getSupplierLedger(supplierId: number): Promise<any>;\n  updateSupplierLedger(supplierId: number, purchaseData: any): Promise<void>;\n  calculateSupplierBalance(supplierId: number): Promise<number>;\n\n  // Sales operations\n  getSales(): Promise<any[]>;\n  createSaleWithTransaction(saleData: any): Promise<any>;\n\n  // Branch Management methods\n  getBranches(): Promise<Branch[]>;\n  createBranch(branchData: InsertBranch): Promise<Branch>;\n  updateBranch(id: number, branchData: Partial<InsertBranch>): Promise<Branch>;\n  deleteBranch(id: number): Promise<void>;\n  assignUserToBranch(userId: string, branchId: number): Promise<void>;\n  getUsersWithBranches(): Promise<any[]>;\n\n  // Pricing Management methods\n  getSystemPrice(): Promise<number>;\n  updateSystemPrice(price: number): Promise<void>;\n  getPricingSettings(): Promise<any>;\n  updatePricingSettings(pricingData: any): Promise<void>;\n\n  // Sales Returns Management\n  getSalesReturns(date?: string): Promise<any[]>;\n  createSalesReturn(data: any): Promise<any>;\n  updateSalesReturn(id: number, data: any): Promise<any>;\n  deleteSalesReturn(id: number): Promise<any>;\n  getDailySalesReturnSummary(date: string): Promise<any>;\n  updateDailySalesReturnSummary(date: string): Promise<void>;\n  closeDaySalesReturn(date: string, closedBy: string): Promise<any>;\n  reopenDaySalesReturn(date: string): Promise<any>;\n\n  // Purchase Returns Management\n  getPurchaseReturns(date?: string): Promise<any[]>;\n  createPurchaseReturn(data: any): Promise<any>;\n  updatePurchaseReturn(id: number, data: any): Promise<any>;\n  deletePurchaseReturn(id: number): Promise<any>;\n  getDailyPurchaseReturnSummary(date: string): Promise<any>;\n  updateDailyPurchaseReturnSummary(date: string): Promise<void>;\n  closeDayPurchaseReturn(date: string, closedBy: string): Promise<any>;\n  reopenDayPurchaseReturn(date: string): Promise<any>;\n}\n\nexport class Storage implements IStorage {\n  private db;\n  private uploadsDir = path.join(process.cwd(), \"public\", \"uploads\");\n\n  constructor() {\n    this.db = db; // Assign the imported db instance\n\n    // Ensure directories exist\n    if (!fs.existsSync(this.uploadsDir)) {\n      fs.mkdirSync(this.uploadsDir, { recursive: true });\n    }\n\n    // Ensure staff documents directory exists\n    const staffDocumentsDir = path.join(this.uploadsDir, \"staff-documents\");\n    if (!fs.existsSync(staffDocumentsDir)) {\n      fs.mkdirSync(staffDocumentsDir, { recursive: true });\n    }\n\n    // Ensure other upload directories exist\n    const mediaDir = path.join(this.uploadsDir, \"media\");\n    const tempDir = path.join(this.uploadsDir, \"temp\");\n\n    [mediaDir, tempDir].forEach((dir) => {\n      if (!fs.existsSync(dir)) {\n        fs.mkdirSync(dir, { recursive: true });\n      }\n    });\n\n    console.log(\"üìÅ Upload directories initialized\");\n  }\n\n  private async generateInventoryCode(): Promise<string> {\n    try {\n      // Get the highest existing inventory code number\n      const result = await this.db\n        .select({ invCode: inventoryItems.invCode })\n        .from(inventoryItems)\n        .where(sql`${inventoryItems.invCode} LIKE 'INV-%'`)\n        .orderBy(\n          sql`CAST(SUBSTRING(${inventoryItems.invCode}, 5) AS INTEGER) DESC`,\n        )\n        .limit(1);\n\n      let nextNumber = 1;\n      if (result.length > 0 && result[0].invCode) {\n        const currentNumber = parseInt(result[0].invCode.replace(\"INV-\", \"\"));\n        nextNumber = currentNumber + 1;\n      }\n\n      // Format as 4-digit number\n      return `INV-${nextNumber.toString().padStart(4, \"0\")}`;\n    } catch (error) {\n      console.error(\"Error generating inventory code:\", error);\n      // Fallback to timestamp-based code\n      const timestamp = Date.now().toString().slice(-4);\n      return `INV-${timestamp}`;\n    }\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    const result = await this.db\n      .select()\n      .from(users)\n      .where(eq(users.id, id))\n      .limit(1);\n\n    return result[0] || undefined;\n  }\n\n  async getUserById(id: string): Promise<User | undefined> {\n    return this.getUser(id);\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    try {\n      const result = await this.db\n        .select()\n        .from(users)\n        .where(eq(users.email, email))\n        .limit(1);\n\n      return result[0] || undefined;\n    } catch (error) {\n      console.error(\"Error getting user by email:\", error);\n      return undefined;\n    }\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const {\n      email,\n      password,\n      firstName,\n      lastName,\n      profileImageUrl,\n      role,\n      branchId,\n      canAccessAllBranches,\n    } = userData;\n\n    const existingUser = await this.getUserByEmail(email);\n\n    if (existingUser) {\n      const updateData: any = {\n        firstName,\n        lastName,\n        profileImageUrl,\n        role,\n        branchId,\n        canAccessAllBranches,\n      };\n      if (password) {\n        updateData.password = await bcrypt.hash(password, 10);\n      }\n\n      const [updatedUser] = await this.db\n        .update(users)\n        .set({ ...updateData, updatedAt: new Date() })\n        .where(eq(users.email, email))\n        .returning();\n\n      return updatedUser;\n    } else {\n      const hashedPassword = password\n        ? await bcrypt.hash(password, 10)\n        : undefined;\n      const [newUser] = await this.db\n        .insert(users)\n        .values({\n          id: `${role}_${Date.now()}`,\n          email,\n          password: hashedPassword,\n          firstName,\n          lastName,\n          profileImageUrl,\n          role: role || \"staff\",\n          branchId: branchId || null,\n          canAccessAllBranches: canAccessAllBranches || false,\n        })\n        .returning();\n\n      return newUser;\n    }\n  }\n\n  async getAllUsers(excludeSuperAdmin: boolean = false): Promise<User[]> {\n    let query = this.db.select().from(users);\n\n    if (excludeSuperAdmin) {\n      query = query.where(sql`${users.role} != 'super_admin'`);\n    }\n\n    return await query.orderBy(users.createdAt);\n  }\n\n  async updateUser(id: string, data: any): Promise<any> {\n    const [updatedUser] = await this.db\n      .update(users)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n\n    return updatedUser;\n  }\n\n  async deleteUser(id: string): Promise<void> {\n    await this.db.delete(users).where(eq(users.id, id));\n  }\n\n  async ensureDefaultAdmin(): Promise<void> {\n    const superAdminEmail = \"superadmin@bakersoft.com\";\n    const adminEmail = \"admin@bakersoft.com\";\n    const managerEmail = \"manager@bakersoft.com\";\n    const staffEmail = \"staff@bakersoft.com\";\n\n    // Create superadmin user\n    const existingSuperAdmin = await this.getUserByEmail(superAdminEmail);\n    if (!existingSuperAdmin) {\n      await this.upsertUser({\n        email: superAdminEmail,\n        password: \"superadmin123\",\n        firstName: \"Super\",\n        lastName: \"Admin\",\n        role: \"super_admin\",\n        canAccessAllBranches: true, // Super admin can access all branches\n      });\n      console.log(\"‚úÖ Default superadmin user created\");\n    }\n\n    const existingAdmin = await this.getUserByEmail(adminEmail);\n    if (!existingAdmin) {\n      await this.upsertUser({\n        email: adminEmail,\n        password: \"admin123\",\n        firstName: \"Admin\",\n        lastName: \"User\",\n        role: \"admin\",\n        canAccessAllBranches: true, // Admins can access all branches by default\n      });\n      console.log(\"‚úÖ Default admin user created\");\n    }\n\n    const existingManager = await this.getUserByEmail(managerEmail);\n    if (!existingManager) {\n      await this.upsertUser({\n        email: managerEmail,\n        password: \"manager123\",\n        firstName: \"Manager\",\n        lastName: \"User\",\n        role: \"manager\",\n        // Branch assignment can be done later, or set a default if needed\n      });\n      console.log(\"‚úÖ Default manager user created\");\n    }\n\n    const existingStaff = await this.getUserByEmail(staffEmail);\n    if (!existingStaff) {\n      await this.upsertUser({\n        email: staffEmail,\n        password: \"staff123\",\n        firstName: \"Staff\",\n        lastName: \"User\",\n        role: \"staff\",\n        // Branch assignment can be done later\n      });\n      console.log(\"‚úÖ Default staff user created\");\n    }\n  }\n\n  async getUserCount(excludeSuperAdmin: boolean = false): Promise<number> {\n    let query = this.db.select({ count: count() }).from(users);\n\n    if (excludeSuperAdmin) {\n      query = query.where(sql`${users.role} != 'super_admin'`);\n    }\n\n    const result = await query;\n    return result[0].count;\n  }\n\n  // Product operations\n  async getProducts(\n    userBranchId?: number,\n    canAccessAllBranches?: boolean,\n    userRole?: string,\n  ): Promise<Product[]> {\n    try {\n      let query = this.db\n        .select({\n          id: products.id,\n          name: products.name,\n          description: products.description,\n          categoryId: products.categoryId,\n          price: products.price,\n          cost: products.cost,\n          margin: products.margin,\n          sku: products.sku,\n          unit: products.unit,\n          unitId: products.unitId,\n          branchId: products.branchId,\n          isGlobal: products.isGlobal,\n          isActive: products.isActive,\n          createdAt: products.createdAt,\n          updatedAt: products.updatedAt,\n        })\n        .from(products);\n\n      // Super Admin sees ALL products including inactive ones\n      if (userRole !== \"super_admin\") {\n        query = query.where(eq(products.isActive, true));\n\n        // Apply branch filtering if user doesn't have access to all branches\n        if (!canAccessAllBranches && userBranchId) {\n          query = query.where(\n            and(\n              eq(products.isActive, true),\n              or(\n                eq(products.branchId, userBranchId),\n                eq(products.isGlobal, true),\n                isNull(products.branchId),\n              ),\n            ),\n          );\n        }\n      }\n\n      const result = await query.orderBy(products.name);\n\n      // Ensure all fields have proper values\n      const cleanedResult = result.map((product) => ({\n        ...product,\n        description: product.description || \"\",\n        price: product.price || \"0\",\n        cost: product.cost || \"0\",\n        margin: product.margin || \"0\",\n        sku: product.sku || \"\",\n        unit: product.unit || \"unit\",\n        isActive: product.isActive !== false,\n      }));\n\n      console.log(\n        `‚úÖ Found ${cleanedResult.length} products for ${userRole === \"super_admin\" ? \"Super Admin (ALL)\" : \"branch access\"}`,\n      );\n      return cleanedResult as Product[];\n    } catch (error) {\n      console.error(\"‚ùå Error fetching products:\", error);\n      return [];\n    }\n  }\n\n  async getProductById(id: number): Promise<Product | undefined> {\n    const result = await this.db\n      .select()\n      .from(products)\n      .where(eq(products.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async getProductsWithIngredients(): Promise<any[]> {\n    try {\n      const result = await this.db\n        .select({\n          id: products.id,\n          name: products.name,\n          description: products.description,\n          categoryId: products.categoryId,\n          price: products.price,\n          cost: products.cost,\n          margin: products.margin,\n          sku: products.sku,\n          unit: products.unit,\n          unitId: products.unitId,\n          unitName: units.name,\n          isActive: products.isActive,\n          createdAt: products.createdAt,\n          updatedAt: products.updatedAt,\n        })\n        .from(products)\n        .leftJoin(units, eq(products.unitId, units.id))\n        .orderBy(desc(products.createdAt));\n\n      console.log(`üì¶ Retrieved ${result.length} products from database`);\n      return result || [];\n    } catch (error) {\n      console.error(\"Error fetching products with ingredients:\", error);\n      throw error;\n    }\n  }\n\n  async createProduct(product: InsertProduct): Promise<Product> {\n    // Calculate margin if cost and price are provided\n    let margin = product.margin;\n    if (!margin && product.cost && product.price) {\n      const cost = parseFloat(product.cost.toString());\n      const price = parseFloat(product.price.toString());\n      if (price > 0) {\n        margin = (((price - cost) / price) * 100).toFixed(2);\n      }\n    }\n\n    const productData = {\n      ...product,\n      margin: margin || \"0\",\n      isActive: product.isActive !== false,\n    };\n\n    const [newProduct] = await this.db\n      .insert(products)\n      .values(productData)\n      .returning();\n    return newProduct;\n  }\n\n  async updateProduct(\n    id: number,\n    product: Partial<InsertProduct>,\n  ): Promise<Product> {\n    const [updatedProduct] = await this.db\n      .update(products)\n      .set({ ...product, updatedAt: new Date() })\n      .where(eq(products.id, id))\n      .returning();\n    return updatedProduct;\n  }\n\n  async deleteProduct(id: number): Promise<void> {\n    await this.db\n      .delete(productIngredients)\n      .where(eq(productIngredients.productId, id));\n    await this.db.delete(products).where(eq(products.id, id));\n  }\n\n  async getProductIngredients(productId: number): Promise<any[]> {\n    return await this.db\n      .select({\n        id: productIngredients.id,\n        productId: productIngredients.productId,\n        inventoryItemId: productIngredients.inventoryItemId,\n        quantity: productIngredients.quantity,\n        unit: productIngredients.unit,\n        inventoryItemName: inventoryItems.name,\n        inventoryItemUnit: inventoryItems.unit,\n      })\n      .from(productIngredients)\n      .leftJoin(\n        inventoryItems,\n        eq(productIngredients.inventoryItemId, inventoryItems.id),\n      )\n      .where(eq(productIngredients.productId, productId));\n  }\n\n  async createProductIngredient(ingredient: any): Promise<any> {\n    const [newIngredient] = await this.db\n      .insert(productIngredients)\n      .values(ingredient)\n      .returning();\n    return newIngredient;\n  }\n\n  async deleteProductIngredients(productId: number): Promise<void> {\n    await this.db\n      .delete(productIngredients)\n      .where(eq(productIngredients.productId, productId));\n  }\n\n  // Unit operations - returns ALL units (active and inactive)\n  async getUnits(): Promise<Unit[]> {\n    try {\n      const allUnits = await db.select().from(units).orderBy(asc(units.name));\n      return allUnits;\n    } catch (error) {\n      console.error(\"‚ùå Error fetching units:\", error);\n      return [];\n    }\n  }\n\n  // Get only active units (for dropdowns, selectors, etc.)\n  async getActiveUnits(): Promise<Unit[]> {\n    try {\n      const activeUnits = await db\n        .select()\n        .from(units)\n        .where(eq(units.isActive, true))\n        .orderBy(asc(units.name));\n      return activeUnits;\n    } catch (error) {\n      console.error(\"‚ùå Error fetching active units:\", error);\n      return [];\n    }\n  }\n\n  async getUnitById(id: number): Promise<Unit | undefined> {\n    try {\n      const result = await this.db\n        .select()\n        .from(units)\n        .where(eq(units.id, id))\n        .limit(1);\n      return result[0];\n    } catch (error) {\n      console.error(\"Error fetching unit by ID:\", error);\n      return undefined;\n    }\n  }\n\n  async createUnit(data: InsertUnit): Promise<Unit> {\n    try {\n      const result = await this.db.insert(units).values(data).returning();\n      return result[0];\n    } catch (error) {\n      console.error(\"Error creating unit:\", error);\n      throw error;\n    }\n  }\n\n  async updateUnit(id: number, data: Partial<InsertUnit>): Promise<Unit> {\n    try {\n      const result = await this.db\n        .update(units)\n        .set({ ...data, updatedAt: new Date() })\n        .where(eq(units.id, id))\n        .returning();\n\n      if (result.length === 0) {\n        throw new Error(\"Unit not found\");\n      }\n\n      return result[0];\n    } catch (error) {\n      console.error(\"Error updating unit:\", error);\n      throw error;\n    }\n  }\n\n  async deleteUnit(id: number): Promise<void> {\n    try {\n      // Check if unit is being used in other tables before deletion\n      const usageChecks = await Promise.all([\n        // Check products table\n        this.db\n          .select({ count: sql`count(*)` })\n          .from(products)\n          .where(eq(products.unitId, id)),\n        // Check inventory items table (primary unit)\n        this.db\n          .select({ count: sql`count(*)` })\n          .from(inventoryItems)\n          .where(eq(inventoryItems.unitId, id)),\n        // Check inventory items table (secondary unit)\n        this.db\n          .select({ count: sql`count(*)` })\n          .from(inventoryItems)\n          .where(eq(inventoryItems.secondaryUnitId, id)),\n        // Check product ingredients table\n        this.db\n          .select({ count: sql`count(*)` })\n          .from(productIngredients)\n          .where(eq(productIngredients.unitId, id)),\n        // Check unit conversions table (from unit)\n        this.db\n          .select({ count: sql`count(*)` })\n          .from(unitConversions)\n          .where(eq(unitConversions.fromUnitId, id)),\n        // Check unit conversions table (to unit)\n        this.db\n          .select({ count: sql`count(*)` })\n          .from(unitConversions)\n          .where(eq(unitConversions.toUnitId, id)),\n      ]);\n\n      const totalUsage = usageChecks.reduce(\n        (sum, result) => sum + Number(result[0].count),\n        0,\n      );\n\n      if (totalUsage > 0) {\n        throw new Error(\n          `Cannot delete unit: it is being used in ${totalUsage} record(s). Please remove all references to this unit before deleting it.`,\n        );\n      }\n\n      // Safe to delete\n      await this.db.delete(units).where(eq(units.id, id));\n      console.log(`Unit ${id} deleted successfully`);\n    } catch (error) {\n      console.error(\"Error deleting unit:\", error);\n      throw error;\n    }\n  }\n\n  async getActiveUnits() {\n    try {\n      const result = await this.db\n        .select()\n        .from(units)\n        .where(eq(units.isActive, true))\n        .orderBy(units.name);\n      return result;\n    } catch (error) {\n      console.error(\"Error in getActiveUnits:\", error);\n      throw error;\n    }\n  }\n\n  // Unit conversion operations\n  async getUnitConversions(): Promise<any[]> {\n    return await this.db\n      .select({\n        id: unitConversions.id,\n        fromUnitId: unitConversions.fromUnitId,\n        toUnitId: unitConversions.toUnitId,\n        conversionFactor: unitConversions.conversionFactor,\n        formula: unitConversions.formula,\n        isActive: unitConversions.isActive,\n        createdAt: unitConversions.createdAt,\n        updatedAt: unitConversions.updatedAt,\n        fromUnit: {\n          id: sql`from_unit.id`,\n          name: sql`from_unit.name`,\n          abbreviation: sql`from_unit.abbreviation`,\n        },\n        toUnit: {\n          id: sql`to_unit.id`,\n          name: sql`to_unit.name`,\n          abbreviation: sql`to_unit.abbreviation`,\n        },\n      })\n      .from(unitConversions)\n      .leftJoin(\n        sql`units as from_unit`,\n        sql`from_unit.id = ${unitConversions.fromUnitId}`,\n      )\n      .leftJoin(\n        sql`units as to_unit`,\n        sql`to_unit.id = ${unitConversions.toUnitId}`,\n      )\n      .orderBy(sql`from_unit.name`, sql`to_unit.name`);\n  }\n\n  async createUnitConversion(data: any): Promise<any> {\n    const [newConversion] = await this.db\n      .insert(unitConversions)\n      .values(data)\n      .returning();\n    return newConversion;\n  }\n\n  async updateUnitConversion(id: number, data: any): Promise<any> {\n    const [updatedConversion] = await this.db\n      .update(unitConversions)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(unitConversions.id, id))\n      .returning();\n    return updatedConversion;\n  }\n\n  async deleteUnitConversion(id: number): Promise<void> {\n    await this.db.delete(unitConversions).where(eq(unitConversions.id, id));\n  }\n\n  async convertQuantity(\n    fromQuantity: number,\n    fromUnitId: number,\n    toUnitId: number,\n  ): Promise<number> {\n    if (fromUnitId === toUnitId) return fromQuantity;\n\n    // Try direct conversion\n    const directConversion = await this.db\n      .select()\n      .from(unitConversions)\n      .where(\n        and(\n          eq(unitConversions.fromUnitId, fromUnitId),\n          eq(unitConversions.toUnitId, toUnitId),\n          eq(unitConversions.isActive, true),\n        ),\n      )\n      .limit(1);\n\n    if (directConversion.length > 0) {\n      return fromQuantity * parseFloat(directConversion[0].conversionFactor);\n    }\n\n    // Try reverse conversion\n    const reverseConversion = await this.db\n      .select()\n      .from(unitConversions)\n      .where(\n        and(\n          eq(unitConversions.fromUnitId, toUnitId),\n          eq(unitConversions.toUnitId, fromUnitId),\n          eq(unitConversions.isActive, true),\n        ),\n      )\n      .limit(1);\n\n    if (reverseConversion.length > 0) {\n      return fromQuantity / parseFloat(reverseConversion[0].conversionFactor);\n    }\n\n    throw new Error(\n      `No conversion found between units ${fromUnitId} and ${toUnitId}`,\n    );\n  }\n\n  // Inventory operations\n  async getInventoryItemsPaginated(options?: {\n    page?: number;\n    limit?: number;\n    search?: string;\n    group?: string;\n  }): Promise<{\n    items: InventoryItem[];\n    totalCount: number;\n    totalPages: number;\n    currentPage: number;\n    itemsPerPage: number;\n  }> {\n    try {\n      const page = options?.page || 1;\n      const limit = options?.limit || 10;\n      const search = options?.search?.toLowerCase() || \"\";\n      const group = options?.group || \"all\";\n      const offset = (page - 1) * limit;\n\n      // Build base query with simplified selection\n      let baseQuery = this.db\n        .select({\n          id: inventoryItems.id,\n          invCode: inventoryItems.invCode,\n          name: inventoryItems.name,\n          currentStock: inventoryItems.currentStock,\n          openingStock: inventoryItems.openingStock,\n          purchasedQuantity: inventoryItems.purchasedQuantity,\n          consumedQuantity: inventoryItems.consumedQuantity,\n          closingStock: inventoryItems.closingStock,\n          minLevel: inventoryItems.minLevel,\n          unit: inventoryItems.unit,\n          unitId: inventoryItems.unitId,\n          secondaryUnitId: inventoryItems.secondaryUnitId,\n          conversionRate: inventoryItems.conversionRate,\n          costPerUnit: inventoryItems.costPerUnit,\n          supplier: inventoryItems.supplier,\n          categoryId: inventoryItems.categoryId,\n          branchId: inventoryItems.branchId,\n          isIngredient: inventoryItems.isIngredient,\n          lastRestocked: inventoryItems.lastRestocked,\n          createdAt: inventoryItems.createdAt,\n          updatedAt: inventoryItems.updatedAt,\n        })\n        .from(inventoryItems)\n        .orderBy(desc(inventoryItems.createdAt));\n\n      let countQuery = this.db.select({ count: count() }).from(inventoryItems);\n\n      // Build where conditions\n      const whereConditions = [];\n\n      if (search) {\n        whereConditions.push(\n          or(\n            ilike(inventoryItems.name, `%${search}%`),\n            ilike(inventoryItems.supplier, `%${search}%`),\n            ilike(inventoryItems.invCode, `%${search}%`),\n          ),\n        );\n      }\n\n      if (group && group !== \"all\") {\n        if (group === \"ingredients\") {\n          whereConditions.push(eq(inventoryItems.isIngredient, true));\n        } else if (group === \"uncategorized\") {\n          whereConditions.push(isNull(inventoryItems.categoryId));\n        } else if (!isNaN(parseInt(group))) {\n          whereConditions.push(eq(inventoryItems.categoryId, parseInt(group)));\n        }\n      }\n\n      if (whereConditions.length > 0) {\n        baseQuery = baseQuery.where(and(...whereConditions));\n        countQuery = countQuery.where(and(...whereConditions));\n      }\n\n      const [items, totalResult] = await Promise.all([\n        baseQuery.limit(limit).offset(offset),\n        countQuery,\n      ]);\n\n      const totalCount = totalResult[0]?.count || 0;\n      const totalPages = Math.ceil(totalCount / limit);\n\n      // Add category and unit information manually\n      const enrichedItems = await Promise.all(\n        items.map(async (item) => {\n          let categoryName = null;\n          let unitAbbreviation = item.unit;\n          let group = \"uncategorized\";\n\n          // Get category name if categoryId exists\n          if (item.categoryId) {\n            try {\n              const category = await this.db\n                .select({ name: inventoryCategories.name })\n                .from(inventoryCategories)\n                .where(eq(inventoryCategories.id, item.categoryId))\n                .limit(1);\n              if (category.length > 0) {\n                categoryName = category[0].name;\n                group = item.categoryId.toString();\n              }\n            } catch (error) {\n              console.warn(\n                `Failed to fetch category for item ${item.id}:`,\n                error,\n              );\n            }\n          }\n\n          // Get unit abbreviation if unitId exists\n          if (item.unitId) {\n            try {\n              const unit = await this.db\n                .select({ abbreviation: units.abbreviation })\n                .from(units)\n                .where(eq(units.id, item.unitId))\n                .limit(1);\n              if (unit.length > 0) {\n                unitAbbreviation = unit[0].abbreviation;\n              }\n            } catch (error) {\n              console.warn(`Failed to fetch unit for item ${item.id}:`, error);\n            }\n          }\n\n          // Determine group\n          if (item.isIngredient) {\n            group = \"ingredients\";\n          }\n\n          return {\n            ...item,\n            categoryName,\n            unitAbbreviation,\n            group,\n            notes: \"\",\n          };\n        }),\n      );\n\n      // Check for low stock items (notifications will be generated by the API route)\n      console.log(\"üì¶ Checking inventory levels for notifications...\");\n\n      return {\n        items: enrichedItems,\n        totalCount,\n        totalPages,\n        currentPage: page,\n        itemsPerPage: limit,\n      };\n    } catch (error) {\n      console.error(\"Error in getInventoryItems:\", error);\n      return {\n        items: [],\n        totalCount: 0,\n        totalPages: 0,\n        currentPage: 1,\n        itemsPerPage: 10,\n      };\n    }\n  }\n\n  async getInventoryItems(\n    userBranchId?: number,\n    canAccessAllBranches?: boolean,\n    userRole?: string,\n  ): Promise<InventoryItem[]> {\n    try {\n      let query = this.db\n        .select({\n          id: inventoryItems.id,\n          invCode: inventoryItems.invCode,\n          name: inventoryItems.name,\n          currentStock: inventoryItems.currentStock,\n          openingStock: inventoryItems.openingStock,\n          purchasedQuantity: inventoryItems.purchasedQuantity,\n          consumedQuantity: inventoryItems.consumedQuantity,\n          closingStock: inventoryItems.closingStock,\n          minLevel: inventoryItems.minLevel,\n          unit: inventoryItems.unit,\n          unitId: inventoryItems.unitId,\n          secondaryUnitId: inventoryItems.secondaryUnitId,\n          conversionRate: inventoryItems.conversionRate,\n          costPerUnit: inventoryItems.costPerUnit,\n          supplier: inventoryItems.supplier,\n          categoryId: inventoryItems.categoryId,\n          branchId: inventoryItems.branchId,\n          isIngredient: inventoryItems.isIngredient,\n          notes: inventoryItems.notes,\n          lastRestocked: inventoryItems.lastRestocked,\n          createdAt: inventoryItems.createdAt,\n          updatedAt: inventoryItems.updatedAt,\n          categoryName: inventoryCategories.name,\n        })\n        .from(inventoryItems)\n        .leftJoin(\n          inventoryCategories,\n          eq(inventoryItems.categoryId, inventoryCategories.id),\n        );\n\n      // Super Admin bypasses all branch filtering\n      if (userRole !== \"super_admin\") {\n        // Apply branch filtering if user doesn't have access to all branches\n        if (!canAccessAllBranches && userBranchId) {\n          query = query.where(\n            or(\n              eq(inventoryItems.branchId, userBranchId),\n              isNull(inventoryItems.branchId),\n            ),\n          );\n        }\n      }\n\n      const result = await query.orderBy(inventoryItems.name);\n\n      // Ensure all items have proper data structure\n      const enrichedItems = result.map((item) => ({\n        ...item,\n        // Ensure proper defaults\n        invCode: item.invCode || `INV-${item.id}`,\n        currentStock: item.currentStock || item.closingStock || \"0\",\n        openingStock: item.openingStock || item.currentStock || \"0\",\n        purchasedQuantity: item.purchasedQuantity || \"0\",\n        consumedQuantity: item.consumedQuantity || \"0\",\n        closingStock: item.closingStock || item.currentStock || \"0\",\n        minLevel: item.minLevel || \"0\",\n        costPerUnit: item.costPerUnit || \"0\",\n        unit: item.unit || \"pcs\",\n        supplier: item.supplier || \"Unknown\",\n        group: item.isIngredient\n          ? \"ingredients\"\n          : item.categoryName?.toLowerCase() || \"uncategorized\",\n      }));\n\n      console.log(\n        `‚úÖ Found ${enrichedItems.length} inventory items for ${userRole === \"super_admin\" ? \"Super Admin (ALL)\" : \"branch access\"}`,\n      );\n      return enrichedItems as InventoryItem[];\n    } catch (error) {\n      console.error(\"‚ùå Error fetching inventory items:\", error);\n      return [];\n    }\n  }\n\n  async getAllInventoryItems(): Promise<InventoryItem[]> {\n    try {\n      return await this.db\n        .select()\n        .from(inventoryItems)\n        .orderBy(inventoryItems.name);\n    } catch (error) {\n      console.error(\"Error in getAllInventoryItems:\", error);\n      return [];\n    }\n  }\n\n  async getInventoryItemById(id: number): Promise<InventoryItem | undefined> {\n    const result = await this.db\n      .select()\n      .from(inventoryItems)\n      .where(eq(inventoryItems.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async createInventoryItem(data: any): Promise<InventoryItem> {\n    try {\n      console.log(\"Creating inventory item with data:\", data);\n\n      // Check for duplicate name (case-insensitive, trimmed)\n      const trimmedName = data.name.trim();\n      const existingItem = await this.db\n        .select()\n        .from(inventoryItems)\n        .where(sql`LOWER(TRIM(${inventoryItems.name})) = LOWER(${trimmedName})`)\n        .limit(1);\n\n      if (existingItem.length > 0) {\n        throw new Error(\n          \"Item with this name already exists. Please use a different name.\",\n        );\n      }\n\n      // Get unit name from unitId if provided\n      let unitName = \"pcs\"; // Default unit\n      if (data.unitId) {\n        const unit = await this.db\n          .select({ abbreviation: units.abbreviation })\n          .from(units)\n          .where(eq(units.id, data.unitId))\n          .limit(1);\n\n        if (unit.length > 0) {\n          unitName = unit[0].abbreviation;\n        }\n      } else if (data.unit) {\n        unitName = data.unit;\n      }\n\n      // Generate invCode with 4-digit format if not provided\n      const invCode = data.invCode || (await this.generateInventoryCode());\n\n      // Ensure proper data types and handle optional fields\n      const cleanData = {\n        invCode,\n        name: trimmedName,\n        unit: unitName, // Make sure unit is always set\n        currentStock: data.currentStock ? String(data.currentStock) : \"0\",\n        openingStock: data.openingStock\n          ? String(data.openingStock)\n          : String(data.currentStock || \"0\"),\n        purchasedQuantity: data.purchasedQuantity\n          ? String(data.purchasedQuantity)\n          : \"0\",\n        consumedQuantity: data.consumedQuantity\n          ? String(data.consumedQuantity)\n          : \"0\",\n        closingStock: data.closingStock\n          ? String(data.closingStock)\n          : String(data.currentStock || \"0\"),\n        minLevel: data.minLevel ? String(data.minLevel) : \"0\",\n        unitId: data.unitId || null,\n        secondaryUnitId: data.secondaryUnitId || null,\n        conversionRate: data.conversionRate\n          ? String(data.conversionRate)\n          : null,\n        costPerUnit: data.costPerUnit ? String(data.costPerUnit) : \"0\",\n        supplier: data.supplier || null,\n        categoryId: data.categoryId || null,\n        branchId: data.branchId || null, // Assign branchId\n        isIngredient: data.isIngredient || false,\n        lastRestocked: data.lastRestocked\n          ? new Date(data.lastRestocked)\n          : new Date(),\n        notes: data.notes || null,\n      };\n\n      const result = await this.db\n        .insert(inventoryItems)\n        .values(cleanData)\n        .returning();\n      console.log(\"Inventory item created successfully:\", result[0]);\n      return result[0];\n    } catch (error) {\n      console.error(\"Error creating inventory item:\", error);\n      throw error;\n    }\n  }\n\n  async updateInventoryItem(\n    id: number,\n    updateData: Partial<InsertInventoryItem>,\n  ): Promise<InventoryItem> {\n    try {\n      // Clean the data and ensure proper types\n      const cleanData = { ...updateData };\n\n      // Handle timestamp fields\n      if (\n        cleanData.lastRestocked &&\n        typeof cleanData.lastRestocked !== \"string\"\n      ) {\n        cleanData.lastRestocked = new Date(cleanData.lastRestocked);\n      } else if (typeof cleanData.lastRestocked === \"string\") {\n        // Ensure string dates are parsed\n        cleanData.lastRestocked = new Date(cleanData.lastRestocked);\n      }\n\n      // Ensure numeric fields are strings if they exist\n      const numericFields = [\n        \"currentStock\",\n        \"openingStock\",\n        \"purchasedQuantity\",\n        \"consumedQuantity\",\n        \"closingStock\",\n        \"minLevel\",\n        \"costPerUnit\",\n        \"conversionRate\",\n      ];\n      numericFields.forEach((field) => {\n        if (cleanData[field] !== undefined && cleanData[field] !== null) {\n          cleanData[field] = String(cleanData[field]);\n        }\n      });\n\n      // Remove undefined fields\n      Object.keys(cleanData).forEach((key) => {\n        if (cleanData[key] === undefined || cleanData[key] === null) {\n          delete cleanData[key];\n        }\n      });\n\n      const result = await this.db\n        .update(inventoryItems)\n        .set(cleanData)\n        .where(eq(inventoryItems.id, id))\n        .returning();\n      return result[0];\n    } catch (error) {\n      console.error(\"Error updating inventory item:\", error);\n      throw error;\n    }\n  }\n\n  async updateInventoryWithPurchase(\n    inventoryItemId: number,\n    purchaseQuantity: number,\n    purchaseRate: number,\n    purchaseDate: Date,\n  ): Promise<void> {\n    try {\n      // Get current inventory item\n      const currentItem = await this.getInventoryItemById(inventoryItemId);\n      if (!currentItem) {\n        throw new Error(\"Inventory item not found\");\n      }\n\n      const currentStock = parseFloat(currentItem.currentStock);\n      const currentRate = parseFloat(currentItem.costPerUnit);\n\n      // Calculate weighted average cost\n      const totalCurrentValue = currentStock * currentRate;\n      const totalPurchaseValue = purchaseQuantity * purchaseRate;\n      const totalQuantity = currentStock + purchaseQuantity;\n      const totalValue = totalCurrentValue + totalPurchaseValue;\n\n      const newWeightedAverageRate =\n        totalQuantity > 0 ? totalValue / totalQuantity : purchaseRate;\n\n      // Update inventory item\n      await this.updateInventoryItem(inventoryItemId, {\n        currentStock: totalQuantity.toString(),\n        costPerUnit: newWeightedAverageRate.toString(),\n        lastRestocked: purchaseDate,\n      });\n\n      console.log(`Updated inventory item ${inventoryItemId}:`, {\n        previousStock: currentStock,\n        purchaseQuantity,\n        newStock: totalQuantity,\n        previousRate: currentRate,\n        purchaseRate,\n        newWeightedRate: newWeightedAverageRate,\n      });\n    } catch (error) {\n      console.error(\"Error updating inventory with purchase:\", error);\n      throw error;\n    }\n  }\n\n  async updateInventoryWithWeightedAverage(\n    inventoryItemId: number,\n    purchaseQuantity: number,\n    purchaseRate: number,\n    purchaseDate: Date,\n  ): Promise<void> {\n    try {\n      // Get current inventory item (this represents the closing stock)\n      const currentItem = await this.getInventoryItemById(inventoryItemId);\n      if (!currentItem) {\n        throw new Error(\"Inventory item not found\");\n      }\n\n      const closingStock = parseFloat(currentItem.currentStock || \"0\");\n      const closingRate = parseFloat(currentItem.costPerUnit || \"0\");\n\n      // Calculate closing stock value\n      const closingStockValue = closingStock * closingRate;\n\n      // Calculate purchase value\n      const purchaseValue = purchaseQuantity * purchaseRate;\n\n      // Calculate new opening stock after purchase\n      const newOpeningQuantity = closingStock + purchaseQuantity;\n      const newOpeningValue = closingStockValue + purchaseValue;\n\n      // Calculate weighted average rate for new opening stock\n      const newWeightedAverageRate =\n        newOpeningQuantity > 0\n          ? newOpeningValue / newOpeningQuantity\n          : purchaseRate;\n\n      // Update inventory item with new opening stock values\n      await this.updateInventoryItem(inventoryItemId, {\n        currentStock: newOpeningQuantity.toString(),\n        costPerUnit: newWeightedAverageRate.toString(),\n        lastRestocked: purchaseDate,\n      });\n\n      // Create inventory transaction for tracking\n      await this.createInventoryTransaction({\n        inventoryItemId: inventoryItemId,\n        type: \"in\",\n        quantity: purchaseQuantity.toString(),\n        reason: `Purchase - Weighted average update`,\n        reference: `Purchase at ${purchaseRate}/unit`,\n        createdBy: \"system\",\n      });\n\n      console.log(\n        `‚úÖ Inventory updated with weighted average for item ${inventoryItemId}:`,\n        {\n          closingStock,\n          closingRate,\n          closingStockValue,\n          purchaseQuantity,\n          purchaseRate,\n          purchaseValue,\n          newOpeningQuantity,\n          newOpeningValue,\n          newWeightedRate: newWeightedAverageRate,\n        },\n      );\n    } catch (error) {\n      console.error(\n        \"‚ùå Error updating inventory with weighted average:\",\n        error,\n      );\n      throw error;\n    }\n  }\n\n  async deleteInventoryItem(id: number): Promise<void> {\n    try {\n      // First check if item exists\n      const existingItem = await this.db\n        .select()\n        .from(inventoryItems)\n        .where(eq(inventoryItems.id, id))\n        .limit(1);\n\n      if (existingItem.length === 0) {\n        throw new Error(\"Inventory item not found\");\n      }\n\n      // Delete associated transactions\n      await this.db\n        .delete(inventoryTransactions)\n        .where(eq(inventoryTransactions.itemId, id));\n\n      // Delete the item\n      await this.db.delete(inventoryItems).where(eq(inventoryItems.id, id));\n    } catch (error) {\n      console.error(\"Error deleting inventory item:\", error);\n      throw error;\n    }\n  }\n\n  async getInventoryCategories(): Promise<InventoryCategory[]> {\n    return await this.db\n      .select()\n      .from(inventoryCategories)\n      .orderBy(inventoryCategories.name);\n  }\n\n  async createInventoryCategory(\n    data: InsertInventoryCategory,\n  ): Promise<InventoryCategory> {\n    const [newCategory] = await this.db\n      .insert(inventoryCategories)\n      .values(data)\n      .returning();\n    return newCategory;\n  }\n\n  async updateInventoryCategory(\n    id: number,\n    data: Partial<InsertInventoryCategory>,\n  ): Promise<InventoryCategory> {\n    const [updatedCategory] = await this.db\n      .update(inventoryCategories)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(inventoryCategories.id, id))\n      .returning();\n    return updatedCategory;\n  }\n\n  async deleteInventoryCategory(id: number): Promise<void> {\n    await this.db\n      .delete(inventoryCategories)\n      .where(eq(inventoryCategories.id, id));\n  }\n\n  async createInventoryTransaction(\n    transaction: InsertInventoryTransaction,\n  ): Promise<InventoryTransaction> {\n    // Ensure quantity is a string for consistency\n    const transactionData = {\n      ...transaction,\n      quantity: String(transaction.quantity),\n    };\n\n    const [newTransaction] = await this.db\n      .insert(inventoryTransactions)\n      .values(transactionData)\n      .returning();\n\n    // Update the current stock\n    const item = await this.getInventoryItemById(transaction.inventoryItemId);\n    if (item) {\n      const quantityChange =\n        transaction.type === \"in\"\n          ? parseFloat(transaction.quantity)\n          : -parseFloat(transaction.quantity);\n\n      const newStock = parseFloat(item.currentStock || \"0\") + quantityChange;\n\n      await this.updateInventoryItem(transaction.inventoryItemId, {\n        currentStock: newStock.toString(),\n        updatedAt: new Date(),\n      });\n    }\n\n    return newTransaction;\n  }\n\n  async getInventoryTransactions(itemId?: number): Promise<any[]> {\n    let query = this.db\n      .select({\n        id: inventoryTransactions.id,\n        inventoryItemId: inventoryTransactions.inventoryItemId,\n        type: inventoryTransactions.type,\n        quantity: inventoryTransactions.quantity,\n        reason: inventoryTransactions.reason,\n        createdAt: inventoryTransactions.createdAt,\n        itemName: inventoryItems.name,\n        unit: inventoryItems.unit,\n      })\n      .from(inventoryTransactions)\n      .leftJoin(\n        inventoryItems,\n        eq(inventoryTransactions.inventoryItemId, inventoryItems.id),\n      )\n      .orderBy(desc(inventoryTransactions.createdAt));\n\n    if (itemId) {\n      query = query.where(eq(inventoryTransactions.inventoryItemId, itemId));\n    }\n\n    return await query;\n  }\n\n  async getLowStockItems() {\n    const items = await this.db\n      .select()\n      .from(inventoryItems)\n      .where(sql`${inventoryItems.closingStock} <= ${inventoryItems.minLevel}`)\n      .limit(10);\n\n    return items;\n  }\n\n  // Get ingredients from multiple sources\n  async getIngredients(): Promise<InventoryItem[]> {\n    try {\n      console.log(\"Fetching ingredients...\");\n\n      // Get all inventory items directly with specific field selection\n      const allItems = await this.db\n        .select({\n          id: inventoryItems.id,\n          invCode: inventoryItems.invCode,\n          name: inventoryItems.name,\n          currentStock: inventoryItems.currentStock,\n          openingStock: inventoryItems.openingStock,\n          purchasedQuantity: inventoryItems.purchasedQuantity,\n          consumedQuantity: inventoryItems.consumedQuantity,\n          closingStock: inventoryItems.closingStock,\n          minLevel: inventoryItems.minLevel,\n          unit: inventoryItems.unit,\n          unitId: inventoryItems.unitId,\n          secondaryUnitId: inventoryItems.secondaryUnitId,\n          conversionRate: inventoryItems.conversionRate,\n          costPerUnit: inventoryItems.costPerUnit,\n          supplier: inventoryItems.supplier,\n          categoryId: inventoryItems.categoryId,\n          isIngredient: inventoryItems.isIngredient,\n          lastRestocked: inventoryItems.lastRestocked,\n          createdAt: inventoryItems.createdAt,\n          updatedAt: inventoryItems.updatedAt,\n        })\n        .from(inventoryItems)\n        .orderBy(inventoryItems.name);\n\n      console.log(`Found ${allItems.length} total inventory items`);\n\n      // Filter items that are suitable as ingredients\n      const ingredients = allItems.filter((item: any) => {\n        const itemName = item.name?.toLowerCase() || \"\";\n\n        return (\n          item.isIngredient === true ||\n          itemName.includes(\"flour\") ||\n          itemName.includes(\"sugar\") ||\n          itemName.includes(\"butter\") ||\n          itemName.includes(\"milk\") ||\n          itemName.includes(\"egg\") ||\n          itemName.includes(\"chocolate\") ||\n          itemName.includes(\"vanilla\") ||\n          itemName.includes(\"salt\") ||\n          itemName.includes(\"baking\") ||\n          itemName.includes(\"yeast\") ||\n          itemName.includes(\"cream\") ||\n          itemName.includes(\"oil\") ||\n          itemName.includes(\"spice\") ||\n          itemName.includes(\"extract\")\n        );\n      });\n\n      console.log(`Filtered to ${ingredients.length} ingredients`);\n      return ingredients;\n    } catch (error) {\n      console.error(\"Error fetching ingredients:\", error);\n      return [];\n    }\n  }\n\n  // Sync stock levels from purchases\n  async syncStockFromPurchases() {\n    try {\n      // Get all purchase items and aggregate by inventory item\n      const purchaseAggregates = await this.db\n        .select({\n          inventoryItemId: purchaseItems.inventoryItemId,\n          totalPurchased: sql<number>`SUM(${purchaseItems.quantity})`,\n        })\n        .from(purchaseItems)\n        .groupBy(purchaseItems.inventoryItemId);\n\n      // Update inventory items with purchased quantities\n      for (const aggregate of purchaseAggregates) {\n        const inventoryItem = await this.db\n          .select()\n          .from(inventoryItems)\n          .where(eq(inventoryItems.id, aggregate.inventoryItemId))\n          .limit(1);\n\n        if (inventoryItem.length > 0) {\n          const item = inventoryItem[0];\n          const openingStock = parseFloat(item.openingStock || \"0\");\n          const purchasedQuantity = aggregate.totalPurchased || 0;\n          const consumedQuantity = parseFloat(item.consumedQuantity || \"0\");\n          const closingStock =\n            openingStock + purchasedQuantity - consumedQuantity;\n\n          await this.db\n            .update(inventoryItems)\n            .set({\n              purchasedQuantity: purchasedQuantity.toString(),\n              closingStock: closingStock.toString(),\n              currentStock: closingStock.toString(),\n              lastRestocked: new Date(),\n            })\n            .where(eq(inventoryItems.id, aggregate.inventoryItemId));\n        }\n      }\n\n      console.log(\"Stock levels synced from purchases successfully\");\n    } catch (error) {\n      console.error(\"Error syncing stock from purchases:\", error);\n      throw error;\n    }\n  }\n\n  async updateInventoryStockAndCost(\n    itemId: number,\n    addedQuantity: number,\n    newCostPerUnit: number,\n  ) {\n    try {\n      const item = await this.getInventoryItemById(itemId);\n      if (!item) {\n        throw new Error(\"Inventory item not found\");\n      }\n\n      const currentStock = parseFloat(item.currentStock);\n      const currentCostPerUnit = parseFloat(item.costPerUnit);\n\n      // Calculate weighted average cost\n      const totalValue =\n        currentStock * currentCostPerUnit + addedQuantity * newCostPerUnit;\n      const totalQuantity = currentStock + addedQuantity;\n      const newWeightedCost =\n        totalQuantity > 0 ? totalValue / totalQuantity : newCostPerUnit;\n\n      // Update inventory\n      await this.db\n        .update(inventoryItems)\n        .set({\n          currentStock: totalQuantity.toString(),\n          costPerUnit: newWeightedCost.toFixed(4),\n          lastRestocked: new Date(),\n        })\n        .where(eq(inventoryItems.id, itemId));\n\n      console.log(\n        `Updated inventory item ${itemId}: stock=${totalQuantity}, cost=${newWeightedCost.toFixed(4)}`,\n      );\n    } catch (error) {\n      console.error(\"Error updating inventory stock and cost:\", error);\n      throw error;\n    }\n  }\n\n  // Update inventory stock specifically for purchases\n  async updateInventoryPurchaseStock(\n    itemId: number,\n    purchasedQuantity: number,\n  ) {\n    try {\n      const item = await this.getInventoryItemById(itemId);\n      if (!item) {\n        throw new Error(\"Inventory item not found\");\n      }\n\n      const openingStock = parseFloat(\n        item.openingStock || item.currentStock || \"0\",\n      );\n      const currentPurchased = parseFloat(item.purchasedQuantity || \"0\");\n      const consumedQuantity = parseFloat(item.consumedQuantity || \"0\");\n\n      const newPurchasedQuantity = currentPurchased + purchasedQuantity;\n      const newClosingStock =\n        openingStock + newPurchasedQuantity - consumedQuantity;\n\n      // Update inventory with new purchase data\n      await this.db\n        .update(inventoryItems)\n        .set({\n          purchasedQuantity: newPurchasedQuantity.toString(),\n          closingStock: newClosingStock.toString(),\n          currentStock: newClosingStock.toString(),\n          lastRestocked: new Date(),\n        })\n        .where(eq(inventoryItems.id, itemId));\n\n      console.log(\n        `Updated purchase stock for item ${itemId}: purchased=${newPurchasedQuantity}, closing=${newClosingStock}`,\n      );\n    } catch (error) {\n      console.error(\"Error updating inventory purchase stock:\", error);\n      throw error;\n    }\n  }\n\n  // Permission operations\n  async getPermissions(): Promise<Permission[]> {\n    return await this.db\n      .select()\n      .from(permissions)\n      .orderBy(permissions.resource, permissions.action);\n  }\n\n  async createPermission(data: InsertPermission): Promise<Permission> {\n    const [newPermission] = await this.db\n      .insert(permissions)\n      .values(data)\n      .returning();\n    return newPermission;\n  }\n\n  async getRolePermissions(role: string): Promise<any[]> {\n    return await this.db\n      .select({\n        id: permissions.id,\n        name: permissions.name,\n        resource: permissions.resource,\n        action: permissions.action,\n        description: permissions.description,\n      })\n      .from(permissions)\n      .innerJoin(\n        rolePermissions,\n        eq(permissions.id, rolePermissions.permissionId),\n      )\n      .where(eq(rolePermissions.role, role))\n      .orderBy(permissions.resource, permissions.action);\n  }\n\n  async setRolePermissions(\n    role: string,\n    permissionIds: number[],\n  ): Promise<void> {\n    await this.db.delete(rolePermissions).where(eq(rolePermissions.role, role));\n\n    if (permissionIds.length > 0) {\n      const rolePermissionData = permissionIds.map((permissionId) => ({\n        role,\n        permissionId,\n      }));\n      await this.db.insert(rolePermissions).values(rolePermissionData);\n    }\n  }\n\n  async getUserPermissions(userId: string): Promise<any[]> {\n    try {\n      const user = await this.getUserById(userId);\n      if (!user) return [];\n\n      // Super admin gets ALL permissions without exception\n      if (user.role === \"super_admin\") {\n        console.log(\n          `üöÄ Granting ALL permissions to Super Admin: ${user.email}`,\n        );\n        return await this.db\n          .select({\n            id: permissions.id,\n            name: permissions.name,\n            resource: permissions.resource,\n            action: permissions.action,\n            description: permissions.description,\n            granted: sql<boolean>`true`,\n          })\n          .from(permissions)\n          .orderBy(permissions.resource, permissions.action);\n      }\n\n      // Admin gets most permissions except super admin specific ones\n      if (user.role === \"admin\") {\n        return await this.db\n          .select({\n            id: permissions.id,\n            name: permissions.name,\n            resource: permissions.resource,\n            action: permissions.action,\n            description: permissions.description,\n            granted: sql<boolean>`true`,\n          })\n          .from(permissions)\n          .where(sql`${permissions.resource} != 'users'`)\n          .orderBy(permissions.resource, permissions.action);\n      }\n\n      // Get role-based permissions\n      const rolePermissions = await this.db\n        .select({\n          id: permissions.id,\n          name: permissions.name,\n          resource: permissions.resource,\n          action: permissions.action,\n          description: permissions.description,\n          granted: sql<boolean>`true`,\n        })\n        .from(permissions)\n        .innerJoin(\n          rolePermissions,\n          eq(permissions.id, rolePermissions.permissionId),\n        )\n        .where(eq(rolePermissions.role, user.role))\n        .orderBy(permissions.resource, permissions.action);\n\n      // Get user-specific permission overrides\n      const userPermissions = await this.db\n        .select({\n          id: permissions.id,\n          name: permissions.name,\n          resource: permissions.resource,\n          action: permissions.action,\n          description: permissions.description,\n          granted: userPermissions.granted,\n        })\n        .from(userPermissions)\n        .innerJoin(\n          permissions,\n          eq(permissions.id, userPermissions.permissionId),\n        )\n        .where(eq(userPermissions.userId, userId))\n        .orderBy(permissions.resource, permissions.action);\n\n      // Merge permissions (user-specific overrides take precedence)\n      const permissionMap = new Map();\n\n      // Add role permissions first\n      rolePermissions.forEach((perm) => {\n        permissionMap.set(perm.id, perm);\n      });\n\n      // Override with user-specific permissions\n      userPermissions.forEach((perm) => {\n        permissionMap.set(perm.id, perm);\n      });\n\n      return Array.from(permissionMap.values());\n\n      const userResults = await this.db\n        .select({\n          id: permissions.id,\n          name: permissions.name,\n          resource: permissions.resource,\n          action: permissions.action,\n          description: permissions.description,\n          granted: userPermissions.granted,\n        })\n        .from(userPermissions)\n        .innerJoin(\n          permissions,\n          eq(permissions.id, userPermissions.permissionId),\n        )\n        .where(eq(userPermissions.userId, userId));\n\n      const roleResults = await this.db\n        .select({\n          id: permissions.id,\n          name: permissions.name,\n          resource: permissions.resource,\n          action: permissions.action,\n          description: permissions.description,\n          granted: sql<boolean>`true`,\n        })\n        .from(rolePermissions)\n        .innerJoin(\n          permissions,\n          eq(permissions.id, rolePermissions.permissionId),\n        )\n        .where(eq(rolePermissions.role, user.role));\n\n      // Merge user and role permissions, user permissions override role permissions\n      const allPermissions = [...roleResults];\n      userResults.forEach((userPerm) => {\n        const existingIndex = allPermissions.findIndex(\n          (p) => p.id === userPerm.id,\n        );\n        if (existingIndex >= 0) {\n          allPermissions[existingIndex] = userPerm;\n        } else {\n          allPermissions.push(userPerm);\n        }\n      });\n\n      return allPermissions.filter((p) => p.granted);\n    } catch (error) {\n      console.error(\"Error fetching user permissions:\", error);\n      return [];\n    }\n  }\n\n  async setUserPermissions(\n    userId: string,\n    permissionUpdates: { permissionId: number; granted: boolean }[],\n  ): Promise<void> {\n    await this.db\n      .delete(userPermissions)\n      .where(eq(userPermissions.userId, userId));\n\n    if (permissionUpdates.length > 0) {\n      const userPermissionData = permissionUpdates.map((update) => ({\n        userId,\n        permissionId: update.permissionId,\n        granted: update.granted,\n      }));\n      await this.db.insert(userPermissions).values(userPermissionData);\n    }\n  }\n\n  async checkUserPermission(\n    userId: string,\n    resource: string,\n    action: string,\n  ): Promise<boolean> {\n    const userPermissions = await this.getUserPermissions(userId);\n    return userPermissions.some(\n      (perm) =>\n        perm.resource === resource &&\n        (perm.action === action || perm.action === \"read_write\"),\n    );\n  }\n\n  async initializeDefaultPermissions(): Promise<void> {\n    const existingPermissions = await this.getPermissions();\n    if (existingPermissions.length > 0) return;\n\n    const resources = [\n      \"dashboard\",\n      \"products\",\n      \"inventory\",\n      \"orders\",\n      \"production\",\n      \"customers\",\n      \"parties\",\n      \"assets\",\n      \"expenses\",\n      \"sales\",\n      \"purchases\",\n      \"reports\",\n      \"settings\",\n      \"users\",\n      \"staff\",\n      \"attendance\",\n      \"salary\",\n      \"leave_requests\",\n    ];\n\n    const actions = [\"read\", \"write\", \"read_write\"];\n\n    const defaultPermissions = [];\n    for (const resource of resources) {\n      for (const action of actions) {\n        defaultPermissions.push({\n          name: `${resource}_${action}`,\n          resource,\n          action,\n          description: `${action.charAt(0).toUpperCase() + action.slice(1)} access to ${resource}`,\n        });\n      }\n    }\n\n    for (const permission of defaultPermissions) {\n      await this.createPermission(permission);\n    }\n\n    const allPermissions = await this.getPermissions();\n\n    // Super admin gets all permissions\n    const superAdminPermissionIds = allPermissions.map((p) => p.id);\n    await this.setRolePermissions(\"super_admin\", superAdminPermissionIds);\n\n    // Admin gets all except super admin specific ones\n    const adminPermissionIds = allPermissions\n      .filter((p) => p.resource !== \"users\") // Exclude user management for admins\n      .map((p) => p.id);\n    await this.setRolePermissions(\"admin\", adminPermissionIds);\n\n    const managerPermissionIds = allPermissions\n      .filter((p) => p.action === \"read_write\" && p.resource !== \"users\")\n      .map((p) => p.id);\n    await this.setRolePermissions(\"manager\", managerPermissionIds);\n\n    const staffPermissionIds = allPermissions\n      .filter(\n        (p) =>\n          p.action === \"read\" ||\n          (p.action === \"write\" &&\n            [\"orders\", \"customers\", \"production\"].includes(p.resource)),\n      )\n      .map((p) => p.id);\n    await this.setRolePermissions(\"staff\", staffPermissionIds);\n  }\n\n  async getSettings(): Promise<any> {\n    try {\n      const allSettings = await db.select().from(settings);\n      console.log(\n        \"üìä Retrieved settings from database:\",\n        allSettings.length,\n        \"settings\",\n      );\n\n      // Convert array to object format\n      const settingsObject: any = {};\n      allSettings.forEach((setting: any) => {\n        settingsObject[setting.key] = setting.value;\n      });\n\n      // Ensure default settings are present if none exist\n      if (allSettings.length === 0) {\n        console.log(\"No settings found, using defaults...\");\n        return {\n          companyName: \"BakeSoft\",\n          companyPhone: \"+977-1-234567\",\n        };\n      }\n\n      return settingsObject;\n    } catch (error) {\n      console.error(\"‚ùå Error fetching settings:\", error);\n      return {};\n    }\n  }\n\n  async updateSettings(settingsData: any): Promise<any> {\n    try {\n      console.log(\"üíæ Updating settings with data:\", Object.keys(settingsData));\n\n      // Update or create each setting individually\n      const updatePromises = [];\n      for (const [key, value] of Object.entries(settingsData)) {\n        if (value !== null && value !== undefined) {\n          console.log(`Setting ${key} = ${value} (${typeof value})`);\n          updatePromises.push(this.updateOrCreateSetting(key, String(value)));\n        }\n      }\n\n      const results = await Promise.all(updatePromises);\n      console.log(`‚úÖ Successfully processed ${results.length} settings`);\n\n      // Get all settings from database\n      const allSettingsArray = await db.select().from(settings);\n\n      // Convert array to object format\n      const settingsObject: any = {};\n      allSettingsArray.forEach((setting: any) => {\n        settingsObject[setting.key] = setting.value;\n      });\n\n      return {\n        success: true,\n        settings: settingsObject,\n        message: \"Settings updated successfully\",\n      };\n    } catch (error) {\n      console.error(\"‚ùå Error updating settings:\", error);\n      throw error;\n    }\n  }\n\n  async saveSettings(settingsData: any): Promise<any> {\n    // For backwards compatibility, use updateSettings\n    return this.updateSettings(settingsData);\n  }\n\n  async updateOrCreateSetting(key: string, value: string): Promise<any> {\n    try {\n      console.log(`üíæ Updating setting: ${key} = ${value}`);\n\n      // First try to update\n      const updated = await this.db\n        .update(settings)\n        .set({ value, updatedAt: new Date() })\n        .where(eq(settings.key, key))\n        .returning();\n\n      if (updated.length === 0) {\n        // If no rows were updated, create new setting\n        console.log(`Creating new setting: ${key}`);\n        const newSetting = await this.db\n          .insert(settings)\n          .values({\n            key,\n            value,\n            type: \"string\",\n          })\n          .returning();\n        return newSetting[0];\n      }\n\n      return updated[0];\n    } catch (error) {\n      console.error(`Error updating setting ${key}:`, error);\n      throw error;\n    }\n  }\n\n  async getSetting(key: string): Promise<string | null> {\n    try {\n      const result = await this.db\n        .select()\n        .from(settings)\n        .where(eq(settings.key, key))\n        .limit(1);\n\n      return result.length > 0 ? result[0].value : null;\n    } catch (error) {\n      console.error(`‚ùå Error getting setting ${key}:`, error);\n      return null;\n    }\n  }\n\n  async saveCompanySettings(settings: any): Promise<void> {\n    await this.updateSettings(settings);\n  }\n\n  async getDashboardStats(): Promise<any> {\n    return {\n      totalProducts: 0,\n      totalOrders: 0,\n      totalRevenue: \"0\",\n      lowStockItems: 0,\n    };\n  }\n\n  async getSalesAnalytics(startDate?: Date, endDate?: Date): Promise<any> {\n    return {\n      totalSales: \"0\",\n      totalOrders: 0,\n      averageOrderValue: \"0\",\n      salesByDay: [],\n    };\n  }\n\n  async getLoginAnalytics(startDate?: string, endDate?: string) {\n    try {\n      let query = this.db.select().from(loginLogs);\n\n      if (startDate && endDate) {\n        // Ensure dates are properly formatted as strings for the database\n        const startDateStr =\n          typeof startDate === \"string\"\n            ? startDate\n            : new Date(startDate).toISOString();\n        const endDateStr =\n          typeof endDate === \"string\"\n            ? endDate\n            : new Date(endDate).toISOString();\n\n        query = query.where(\n          and(\n            gte(loginLogs.timestamp, startDateStr),\n            lte(loginLogs.timestamp, endDateStr),\n          ),\n        );\n      }\n\n      const logs = await query;\n\n      // Process logs for analytics\n      const analytics = {\n        totalLogins: logs.length,\n        uniqueUsers: new Set(logs.map((log) => log.userId)).size,\n        loginsByDay: this.groupLoginsByDay(logs),\n        loginsByUser: this.groupLoginsByUser(logs),\n        recentLogins: logs.slice(-10),\n      };\n\n      return analytics;\n    } catch (error) {\n      console.error(\"Error in getLoginAnalytics:\", error);\n      throw error;\n    }\n  }\n\n  groupLoginsByDay(logs: any[]): any {\n    const loginsByDay: any = {};\n\n    logs.forEach((log) => {\n      const date = log.timestamp.toISOString().split(\"T\")[0];\n      if (!loginsByDay[date]) {\n        loginsByDay[date] = 0;\n      }\n      loginsByDay[date]++;\n    });\n\n    return Object.entries(loginsByDay).map(([date, count]) => ({\n      date,\n      count,\n    }));\n  }\n\n  groupLoginsByUser(logs: any[]): any {\n    const loginsByUser: any = {};\n\n    logs.forEach((log) => {\n      if (!loginsByUser[log.userId]) {\n        loginsByUser[log.userId] = 0;\n      }\n      loginsByUser[log.userId]++;\n    });\n\n    return Object.entries(loginsByUser).map(([userId, count]) => ({\n      userId,\n      count,\n    }));\n  }\n\n  // Customer operations\n  async getCustomers(\n    limit?: number,\n    offset?: number,\n    search?: string,\n  ): Promise<{\n    items: Customer[];\n    totalCount: number;\n    totalPages: number;\n    currentPage: number;\n    itemsPerPage: number;\n  }> {\n    try {\n      const page = offset ? Math.floor(offset / (limit || 10)) + 1 : 1;\n      const itemsPerPage = limit || 10;\n      const searchTerm = search?.toLowerCase() || \"\";\n\n      let baseQuery = this.db\n        .select({\n          id: customers.id,\n          name: customers.name,\n          email: customers.email,\n          phone: customers.phone,\n          address: customers.address,\n          currentBalance: customers.currentBalance,\n          totalOrders: customers.totalOrders,\n          totalSpent: customers.totalSpent,\n          createdAt: customers.createdAt,\n          updatedAt: customers.updatedAt,\n        })\n        .from(customers);\n\n      let countQuery = this.db.select({ count: count() }).from(customers);\n\n      const conditions = [];\n\n      if (searchTerm) {\n        conditions.push(\n          or(\n            ilike(customers.name, `%${searchTerm}%`),\n            ilike(customers.email, `%${searchTerm}%`),\n            ilike(customers.phone, `%${searchTerm}%`),\n          ),\n        );\n      }\n\n      if (conditions.length > 0) {\n        baseQuery = baseQuery.where(and(...conditions));\n        countQuery = countQuery.where(and(...conditions));\n      }\n\n      const [items, totalResult] = await Promise.all([\n        baseQuery\n          .orderBy(customers.name)\n          .limit(itemsPerPage)\n          .offset(offset || 0),\n        countQuery,\n      ]);\n\n      const totalCount = totalResult[0]?.count || 0;\n      const totalPages = Math.ceil(totalCount / itemsPerPage);\n\n      return {\n        items,\n        totalCount,\n        totalPages,\n        currentPage: page,\n        itemsPerPage: itemsPerPage,\n      };\n    } catch (error) {\n      console.error(\"‚ùå Error fetching customers:\", error);\n      return {\n        items: [],\n        totalCount: 0,\n        totalPages: 0,\n        currentPage: 1,\n        itemsPerPage: 10,\n      };\n    }\n  }\n\n  async getCustomerById(id: number): Promise<Customer | undefined> {\n    const result = await this.db\n      .select()\n      .from(customers)\n      .where(eq(customers.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async getExpenseById(id: number): Promise<any> {\n    try {\n      const result = await this.db\n        .select()\n        .from(expenses)\n        .where(eq(expenses.id, id))\n        .limit(1);\n      return result[0];\n    } catch (error) {\n      console.error(\"Error fetching expense by ID:\", error);\n      return null;\n    }\n  }\n\n  async createCustomer(customer: InsertCustomer): Promise<Customer> {\n    const [newCustomer] = await this.db\n      .insert(customers)\n      .values({\n        ...customer,\n        currentBalance: \"0\",\n        totalOrders: 0,\n        totalSpent: \"0\",\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      })\n      .returning();\n    return newCustomer;\n  }\n\n  async updateCustomer(\n    id: number,\n    customer: Partial<InsertCustomer>,\n  ): Promise<Customer> {\n    const [updatedCustomer] = await this.db\n      .update(customers)\n      .set({ ...customer, updatedAt: new Date() })\n      .where(eq(customers.id, id))\n      .returning();\n    return updatedCustomer;\n  }\n\n  async deleteCustomer(id: number): Promise<void> {\n    await this.db.delete(customers).where(eq(customers.id, id));\n  }\n\n  // Party operations\n  async getParties(\n    limit?: number,\n    offset?: number,\n    search?: string,\n  ): Promise<{\n    items: Party[];\n    totalCount: number;\n    totalPages: number;\n    currentPage: number;\n    itemsPerPage: number;\n  }> {\n    try {\n      const page = offset ? Math.floor(offset / (limit || 10)) + 1 : 1;\n      const itemsPerPage = limit || 10;\n      const searchTerm = search?.toLowerCase() || \"\";\n\n      let baseQuery = this.db\n        .select({\n          id: parties.id,\n          name: parties.name,\n          type: parties.type,\n          email: parties.email,\n          phone: parties.phone,\n          address: parties.address,\n          currentBalance: parties.currentBalance,\n          createdAt: parties.createdAt,\n          updatedAt: parties.updatedAt,\n        })\n        .from(parties);\n\n      let countQuery = this.db.select({ count: count() }).from(parties);\n\n      const conditions = [];\n\n      if (searchTerm) {\n        conditions.push(\n          or(\n            ilike(parties.name, `%${searchTerm}%`),\n            ilike(parties.email, `%${searchTerm}%`),\n            ilike(parties.phone, `%${searchTerm}%`),\n            ilike(parties.type, `%${searchTerm}%`),\n          ),\n        );\n      }\n\n      if (conditions.length > 0) {\n        baseQuery = baseQuery.where(and(...conditions));\n        countQuery = countQuery.where(and(...conditions));\n      }\n\n      const [items, totalResult] = await Promise.all([\n        baseQuery\n          .orderBy(parties.name)\n          .limit(itemsPerPage)\n          .offset(offset || 0),\n        countQuery,\n      ]);\n\n      const totalCount = totalResult[0]?.count || 0;\n      const totalPages = Math.ceil(totalCount / itemsPerPage);\n\n      return {\n        items,\n        totalCount,\n        totalPages,\n        currentPage: page,\n        itemsPerPage: itemsPerPage,\n      };\n    } catch (error) {\n      console.error(\"‚ùå Error fetching parties:\", error);\n      return {\n        items: [],\n        totalCount: 0,\n        totalPages: 0,\n        currentPage: 1,\n        itemsPerPage: 10,\n      };\n    }\n  }\n\n  async getPartyById(id: number): Promise<Party | undefined> {\n    const result = await this.db\n      .select()\n      .from(parties)\n      .where(eq(parties.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async createParty(party: InsertParty): Promise<Party> {\n    const [newParty] = await this.db\n      .insert(parties)\n      .values({\n        ...party,\n        currentBalance: \"0\",\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      })\n      .returning();\n    return newParty;\n  }\n\n  async updateParty(id: number, party: Partial<InsertParty>): Promise<Party> {\n    const [updatedParty] = await this.db\n      .update(parties)\n      .set({ ...party, updatedAt: new Date() })\n      .where(eq(parties.id, id))\n      .returning();\n    return updatedParty;\n  }\n\n  async deleteParty(id: number): Promise<void> {\n    await this.db.delete(parties).where(eq(parties.id, id));\n  }\n\n  // Ledger Transaction Methods\n  async createLedgerTransaction(data: any): Promise<any> {\n    try {\n      console.log(\"Creating ledger transaction:\", data);\n\n      const transactionData = {\n        custorPartyId: data.custorPartyId,\n        entityType: data.entityType,\n        transactionDate: new Date(data.transactionDate),\n        description: data.description,\n        referenceNumber: data.referenceNumber || null,\n        debitAmount: data.debitAmount?.toString() || \"0\",\n        creditAmount: data.creditAmount?.toString() || \"0\",\n        transactionType: data.transactionType,\n        paymentMethod: data.paymentMethod || null,\n        notes: data.notes || null,\n        createdBy: data.createdBy || \"system\",\n        runningBalance: \"0\", // Will be calculated\n      };\n\n      const [newTransaction] = await this.db\n        .insert(ledgerTransactions)\n        .values(transactionData)\n        .returning();\n\n      // Recalculate running balance for the entity\n      await this.recalculateRunningBalance(data.custorPartyId, data.entityType);\n\n      console.log(\"‚úÖ Ledger transaction created successfully\");\n      return newTransaction;\n    } catch (error) {\n      console.error(\"‚ùå Error creating ledger transaction:\", error);\n      throw error;\n    }\n  }\n\n  async getLedgerTransactions(\n    entityId: number,\n    entityType: \"customer\" | \"party\",\n    limit?: number,\n  ): Promise<any[]> {\n    try {\n      let query = this.db\n        .select()\n        .from(ledgerTransactions)\n        .where(\n          and(\n            eq(ledgerTransactions.custorPartyId, entityId),\n            eq(ledgerTransactions.entityType, entityType),\n          ),\n        )\n        .orderBy(\n          desc(ledgerTransactions.transactionDate),\n          desc(ledgerTransactions.id),\n        );\n\n      if (limit) {\n        query = query.limit(limit);\n      }\n\n      const transactions = await query;\n      console.log(`‚úÖ Found ${transactions.length} ledger transactions`);\n      return transactions;\n    } catch (error) {\n      console.error(\"‚ùå Error fetching ledger transactions:\", error);\n      return [];\n    }\n  }\n\n  async updateLedgerTransaction(id: number, data: any): Promise<any> {\n    try {\n      const [updatedTransaction] = await this.db\n        .update(ledgerTransactions)\n        .set({ ...data, updatedAt: new Date() })\n        .where(eq(ledgerTransactions.id, id))\n        .returning();\n\n      console.log(\"‚úÖ Ledger transaction updated successfully\");\n      return updatedTransaction;\n    } catch (error) {\n      console.error(\"‚ùå Error updating ledger transaction:\", error);\n      throw error;\n    }\n  }\n\n  async deleteLedgerTransaction(id: number): Promise<void> {\n    try {\n      await this.db\n        .delete(ledgerTransactions)\n        .where(eq(ledgerTransactions.id, id));\n\n      console.log(\"‚úÖ Ledger transaction deleted successfully\");\n    } catch (error) {\n      console.error(\"‚ùå Error deleting ledger transaction:\", error);\n      throw error;\n    }\n  }\n\n  async recalculateRunningBalance(\n    entityId: number,\n    entityType: \"customer\" | \"party\",\n  ): Promise<number> {\n    try {\n      // Get all transactions for this entity ordered by date and id\n      const transactions = await this.db\n        .select()\n        .from(ledgerTransactions)\n        .where(\n          and(\n            eq(ledgerTransactions.custorPartyId, entityId),\n            eq(ledgerTransactions.entityType, entityType),\n          ),\n        )\n        .orderBy(ledgerTransactions.transactionDate, ledgerTransactions.id);\n\n      let runningBalance = 0;\n\n      // Update each transaction with correct running balance\n      for (const transaction of transactions) {\n        const debitAmount = parseFloat(transaction.debitAmount || \"0\");\n        const creditAmount = parseFloat(transaction.creditAmount || \"0\");\n\n        runningBalance += debitAmount - creditAmount;\n\n        await this.db\n          .update(ledgerTransactions)\n          .set({ runningBalance: runningBalance.toString() })\n          .where(eq(ledgerTransactions.id, transaction.id));\n      }\n\n      // Update the customer/party current balance\n      if (entityType === \"customer\") {\n        await this.db\n          .update(customers)\n          .set({ currentBalance: runningBalance.toString() })\n          .where(eq(customers.id, entityId));\n      } else if (entityType === \"party\") {\n        await this.db\n          .update(parties)\n          .set({ currentBalance: runningBalance.toString() })\n          .where(eq(parties.id, entityId));\n      }\n\n      console.log(\n        `‚úÖ Recalculated running balance for ${entityType} ${entityId}: ${runningBalance}`,\n      );\n      return runningBalance;\n    } catch (error) {\n      console.error(\"‚ùå Error recalculating running balance:\", error);\n      throw error;\n    }\n  }\n\n  // Asset operations\n  async getAssets(): Promise<Asset[]> {\n    return await this.db\n      .select()\n      .from(assets)\n      .where(eq(assets.isActive, true))\n      .orderBy(desc(assets.createdAt));\n  }\n\n  async createAsset(asset: InsertAsset): Promise<Asset> {\n    const [newAsset] = await this.db.insert(assets).values(asset).returning();\n    return newAsset;\n  }\n\n  async updateAsset(id: number, asset: Partial<InsertAsset>): Promise<Asset> {\n    const [updatedAsset] = await this.db\n      .update(assets)\n      .set({ ...asset, updatedAt: new Date() })\n      .where(eq(assets.id, id))\n      .returning();\n    return updatedAsset;\n  }\n\n  async getAssetById(id: number): Promise<Asset | undefined> {\n    const result = await this.db\n      .select()\n      .from(assets)\n      .where(eq(assets.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async deleteAsset(id: number): Promise<void> {\n    await this.db\n      .update(assets)\n      .set({ isActive: false, updatedAt: new Date() })\n      .where(eq(assets.id, id));\n  }\n\n  // Purchase operations\n  async getPurchases(): Promise<any[]> {\n    return await this.db\n      .select({\n        id: purchases.id,\n        supplierName: purchases.supplierName,\n        partyId: purchases.partyId,\n        totalAmount: purchases.totalAmount,\n        paymentMethod: purchases.paymentMethod,\n        status: purchases.status,\n        purchaseDate: purchases.purchaseDate,\n        invoiceNumber: purchases.invoiceNumber,\n        notes: purchases.notes,\n        createdAt: purchases.createdAt,\n      })\n      .from(purchases)\n      .orderBy(desc(purchases.purchaseDate));\n  }\n\n  async getPurchasesWithItems(): Promise<any[]> {\n    // Get all purchases with their associated items\n    const purchaseList = await this.db\n      .select({\n        id: purchases.id,\n        supplierName: purchases.supplierName,\n        partyId: purchases.partyId,\n        totalAmount: purchases.totalAmount,\n        paymentMethod: purchases.paymentMethod,\n        status: purchases.status,\n        purchaseDate: purchases.purchaseDate,\n        invoiceNumber: purchases.invoiceNumber,\n        notes: purchases.notes,\n        createdAt: purchases.createdAt,\n      })\n      .from(purchases)\n      .orderBy(desc(purchases.createdAt));\n\n    // Get items for each purchase\n    for (const purchase of purchaseList) {\n      const items = await this.db\n        .select({\n          id: purchaseItems.id,\n          inventoryItemId: purchaseItems.inventoryItemId,\n          inventoryItemName: inventoryItems.name,\n          quantity: purchaseItems.quantity,\n          unitPrice: purchaseItems.unitPrice,\n          totalPrice: purchaseItems.totalPrice,\n        })\n        .from(purchaseItems)\n        .leftJoin(\n          inventoryItems,\n          eq(purchaseItems.inventoryItemId, inventoryItems.id),\n        )\n        .where(eq(purchaseItems.purchaseId, purchase.id));\n\n      purchase.items = items;\n    }\n\n    return purchaseList;\n  }\n\n  async createPurchaseWithLedger(purchaseData: any): Promise<any> {\n    try {\n      const { items, ...purchase } = purchaseData;\n\n      // Create purchase record\n      const [newPurchase] = await this.db\n        .insert(purchases)\n        .values({\n          supplierName: purchase.supplierName,\n          partyId: purchase.partyId || null,\n          totalAmount: purchase.totalAmount,\n          paymentMethod: purchase.paymentMethod,\n          status: purchase.status || \"completed\",\n          invoiceNumber: purchase.invoiceNumber || null,\n          notes: purchase.notes || null,\n          createdBy: purchase.createdBy,\n        })\n        .returning();\n\n      console.log(\"Purchase created with ID:\", newPurchase.id);\n\n      // Create purchase items and update inventory with weighted average\n      if (items && items.length > 0) {\n        for (const item of items) {\n          // Create purchase item record\n          const [purchaseItem] = await this.db\n            .insert(purchaseItems)\n            .values({\n              purchaseId: newPurchase.id,\n              inventoryItemId: item.inventoryItemId,\n              quantity: item.quantity.toString(),\n              unitPrice: item.unitPrice.toString(),\n              totalPrice: item.totalPrice.toString(),\n            })\n            .returning();\n\n          console.log(\"Purchase item created:\", purchaseItem);\n\n          // Update inventory with weighted average cost calculation\n          await this.updateInventoryWithWeightedAverage(\n            item.inventoryItemId,\n            parseFloat(item.quantity),\n            parseFloat(item.unitPrice),\n            new Date(),\n          );\n          // Update inventory specifically for purchase quantity tracking\n          await this.updateInventoryPurchaseStock(\n            item.inventoryItemId,\n            parseFloat(item.quantity),\n          );\n        }\n      }\n\n      // Create ledger transaction if party is involved\n      if (purchaseData.partyId) {\n        await this.createLedgerTransaction({\n          custorPartyId: purchaseData.partyId,\n          entityType: \"party\",\n          transactionDate: new Date(),\n          description: `Purchase from ${purchaseData.supplierName}${purchaseData.invoiceNumber ? ` - Invoice: ${purchaseData.invoiceNumber}` : \"\"}`,\n          referenceNumber:\n            purchaseData.invoiceNumber || `PUR-${newPurchase.id}`,\n          debitAmount: purchaseData.totalAmount,\n          creditAmount: \"0\",\n          transactionType: \"purchase\",\n          relatedPurchaseId: newPurchase.id,\n          paymentMethod: purchaseData.paymentMethod,\n          notes: purchaseData.notes,\n          createdBy: purchaseData.createdBy,\n          runningBalance: \"0\", // Will be calculated by recalculateRunningBalance\n        });\n\n        // Recalculate running balance\n        await this.recalculateRunningBalance(purchaseData.partyId, \"party\");\n      }\n\n      return newPurchase;\n    } catch (error) {\n      console.error(\"Error creating purchase with ledger:\", error);\n      throw error;\n    }\n  }\n\n  async updatePurchase(id: number, purchaseData: any): Promise<any> {\n    const [updatedPurchase] = await this.db\n      .update(purchases)\n      .set({ ...purchaseData, updatedAt: new Date() })\n      .where(eq(purchases.id, id))\n      .returning();\n    return updatedPurchase;\n  }\n\n  async deletePurchase(id: number): Promise<void> {\n    await this.db.delete(purchaseItems).where(eq(purchaseItems.purchaseId, id));\n    await this.db.delete(purchases).where(eq(purchases.id, id));\n  }\n\n  // Expense operations\n  async getExpenses(): Promise<any[]> {\n    const result = await this.db\n      .select()\n      .from(expenses)\n      .orderBy(desc(expenses.date));\n    return result.map((expense) => ({\n      ...expense,\n      title: expense.description,\n    }));\n  }\n\n  async createExpense(expense: InsertExpense): Promise<any> {\n    const [newExpense] = await this.db\n      .insert(expenses)\n      .values(expense)\n      .returning();\n    return {\n      ...newExpense,\n      title: newExpense.description,\n    };\n  }\n\n  async updateExpense(\n    id: number,\n    expense: Partial<InsertExpense>,\n  ): Promise<any> {\n    const [updatedExpense] = await this.db\n      .update(expenses)\n      .set({ ...expense, updatedAt: new Date() })\n      .where(eq(expenses.id, id))\n      .returning();\n    return {\n      ...updatedExpense,\n      title: updatedExpense.description,\n    };\n  }\n\n  async deleteExpense(id: number): Promise<void> {\n    await this.db.delete(expenses).where(eq(expenses.id, id));\n  }\n\n  // Order operations\n  async getOrders(): Promise<Order[]> {\n    return await this.db.select().from(orders).orderBy(desc(orders.createdAt));\n  }\n\n  async getOrderById(id: number): Promise<Order | undefined> {\n    const result = await this.db\n      .select()\n      .from(orders)\n      .where(eq(orders.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async createOrder(orderData: any): Promise<Order> {\n    try {\n      console.log(\"üíæ Creating order with items:\", orderData);\n\n      // Ensure required fields exist\n      if (!orderData.customerName || !orderData.totalAmount) {\n        throw new Error(\"Missing required order fields\");\n      }\n\n      const newOrder = await db\n        .insert(orders)\n        .values({\n          customerName: orderData.customerName,\n          customerId: orderData.customerId,\n          customerEmail: orderData.customerEmail,\n          customerPhone: orderData.customerPhone,\n          totalAmount: orderData.totalAmount.toString(),\n          status: orderData.status || \"pending\",\n          paymentMethod: orderData.paymentMethod || \"cash\",\n          deliveryDate: orderData.deliveryDate\n            ? new Date(orderData.deliveryDate)\n            : null,\n          notes: orderData.notes || null,\n        })\n        .returning();\n\n      console.log(\"‚úÖ Order created:\", newOrder[0]);\n\n      if (orderData.items && orderData.items.length > 0) {\n        const orderItemsData = await Promise.all(\n          orderData.items.map(async (item) => {\n            // Fetch product details if not provided\n            const [product] = await this.db\n              .select()\n              .from(products)\n              .where(eq(products.id, item.productId))\n              .limit(1);\n\n            return {\n              orderId: newOrder[0].id,\n              productId: item.productId,\n              quantity: item.quantity,\n              unitPrice: item.unitPrice,\n              totalPrice: item.totalPrice,\n              unit: item.unit || product?.unit || null,\n              unitId: item.unitId\n                ? parseInt(item.unitId.toString())\n                : product?.unitId || null,\n            };\n          }),\n        );\n        await db.insert(orderItems).values(orderItemsData);\n        console.log(\"‚úÖ Order items created\");\n      }\n\n      // Trigger notification for new order\n      console.log(\"üì¢ Triggering order notification...\");\n      await this.triggerBusinessNotification(\"order_created\", {\n        orderNumber: newOrder[0].id,\n        customerName: newOrder[0].customerName,\n        totalAmount: newOrder[0].totalAmount,\n      });\n\n      return newOrder[0];\n    } catch (error) {\n      console.error(\"‚ùå Error creating order:\", error);\n      throw error;\n    }\n  }\n\n  async updateOrder(id: number, order: Partial<InsertOrder>): Promise<Order> {\n    const [updatedOrder] = await this.db\n      .update(orders)\n      .set({ ...order, updatedAt: new Date() })\n      .where(eq(orders.id, id))\n      .returning();\n    return updatedOrder;\n  }\n\n  async deleteOrder(id: number): Promise<void> {\n    await this.db.delete(orderItems).where(eq(orderItems.orderId, id));\n    await this.db.delete(orders).where(eq(orders.id, id));\n  }\n\n  async getOrderItems(orderId: number) {\n    try {\n      const items = await this.db\n        .select({\n          id: orderItems.id,\n          orderId: orderItems.orderId,\n          productId: orderItems.productId,\n          productName: products.name,\n          quantity: orderItems.quantity,\n          unit: orderItems.unit,\n          unitId: orderItems.unitId,\n          unitName: units.name,\n          unitAbbreviation: units.abbreviation,\n          unitPrice: orderItems.unitPrice,\n          totalPrice: orderItems.totalPrice,\n          createdAt: orderItems.createdAt,\n        })\n        .from(orderItems)\n        .leftJoin(products, eq(orderItems.productId, products.id))\n        .leftJoin(units, eq(orderItems.unitId, units.id))\n        .where(eq(orderItems.orderId, orderId))\n        .orderBy(orderItems.createdAt);\n\n      return items;\n    } catch (error) {\n      console.error(\"Error fetching order items:\", error);\n      throw error;\n    }\n  }\n\n  async createOrderItem(data: any) {\n    try {\n      // Ensure unit data is properly handled\n      const orderItemData = {\n        orderId: data.orderId,\n        productId: data.productId,\n        quantity: data.quantity,\n        unit: data.unit || null,\n        unitId: data.unitId || null,\n        unitPrice: data.unitPrice,\n        totalPrice: data.totalPrice,\n      };\n\n      const result = await this.db\n        .insert(orderItems)\n        .values(orderItemData)\n        .returning();\n      return result[0];\n    } catch (error) {\n      console.error(\"Error creating order item:\", error);\n      throw error;\n    }\n  }\n\n  async getRecentOrders(limit: number): Promise<any[]> {\n    return await this.db\n      .select()\n      .from(orders)\n      .orderBy(desc(orders.createdAt))\n      .limit(limit);\n  }\n\n  async getTodayProductionSchedule(): Promise<any[]> {\n    try {\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n\n      const tomorrow = new Date(today);\n      tomorrow.setDate(tomorrow.getDate() + 1);\n\n      return await this.db\n        .select({\n          id: productionSchedule.id,\n          productName: products.name,\n          quantity: productionSchedule.quantity,\n          scheduledDate: productionSchedule.scheduledDate,\n          status: productionSchedule.status,\n        })\n        .from(productionSchedule)\n        .leftJoin(products, eq(productionSchedule.productId, products.id))\n        .where(\n          and(\n            gte(productionSchedule.scheduledDate, today.toISOString()),\n            lt(productionSchedule.scheduledDate, tomorrow.toISOString()),\n            // Only include records with valid dates\n            sql`${productionSchedule.scheduledDate} IS NOT NULL`,\n          ),\n        )\n        .orderBy(productionSchedule.scheduledDate);\n    } catch (error) {\n      console.error(\"Error fetching today's production schedule:\", error);\n      return []; // Return empty array if there's an error\n    }\n  }\n\n  async getProductionSchedule(): Promise<any[]> {\n    try {\n      const result = await this.db\n        .select()\n        .from(productionSchedule)\n        .orderBy(desc(productionSchedule.createdAt));\n      return result;\n    } catch (error) {\n      console.error(\"‚ùå Error getting production schedule:\", error);\n      return [];\n    }\n  }\n\n  async createProductionScheduleItem(\n    item: InsertProductionScheduleItem,\n  ): Promise<ProductionScheduleItem> {\n    const [newItem] = await this.db\n      .insert(productionSchedule)\n      .values(item)\n      .returning();\n    return newItem;\n  }\n\n  async updateProductionScheduleItem(\n    id: number,\n    item: Partial<InsertProductionScheduleItem>,\n  ): Promise<ProductionScheduleItem> {\n    const [updatedItem] = await this.db\n      .update(productionSchedule)\n      .set({ ...item, updatedAt: new Date() })\n      .where(eq(productionSchedule.id, id))\n      .returning();\n    return updatedItem;\n  }\n\n  async getProductionScheduleByDate(date: string): Promise<any[]> {\n    const targetDate = new Date(date);\n    const nextDay = new Date(targetDate);\n    nextDay.setDate(nextDay.getDate() + 1);\n\n    return await this.db\n      .select({\n        id: productionSchedule.id,\n        productId: productionSchedule.productId,\n        quantity: productionSchedule.quantity,\n        scheduledDate: productionSchedule.scheduledDate,\n        status: productionSchedule.status,\n        notes: productionSchedule.notes,\n        productName: products.name,\n      })\n      .from(productionSchedule)\n      .leftJoin(products, eq(productionSchedule.productId, products.id))\n      .where(\n        and(\n          gte(productionSchedule.scheduledDate, targetDate),\n          lte(productionSchedule.scheduledDate, nextDay),\n        ),\n      )\n      .orderBy(productionSchedule.scheduledDate);\n  }\n\n  async closeDayProductionSchedule(\n    date: string,\n    closedBy: string,\n  ): Promise<any> {\n    try {\n      const targetDate = new Date(date);\n      const nextDay = new Date(targetDate);\n      nextDay.setDate(nextDay.getDate() + 1);\n\n      // Get all production items for the specified date\n      const itemsToClose = await this.db\n        .select({\n          id: productionSchedule.id,\n          productId: productionSchedule.productId,\n          productName: productionSchedule.productName,\n          productCode: productionSchedule.productCode,\n          batchNo: productionSchedule.batchNo,\n          totalQuantity: productionSchedule.totalQuantity,\n          unitType: productionSchedule.unitType,\n          actualQuantityPackets: productionSchedule.actualQuantityPackets,\n          priority: productionSchedule.priority,\n          productionStartTime: productionSchedule.productionStartTime,\n          productionEndTime: productionSchedule.productionEndTime,\n          assignedTo: productionSchedule.assignedTo,\n          notes: productionSchedule.notes,\n          status: productionSchedule.status,\n          scheduleDate: productionSchedule.scheduleDate,\n          shift: productionSchedule.shift,\n          plannedBy: productionSchedule.plannedBy,\n          approvedBy: productionSchedule.approvedBy,\n        })\n        .from(productionSchedule)\n        .leftJoin(products, eq(productionSchedule.productId, products.id))\n        .where(\n          and(\n            gte(productionSchedule.scheduledDate, targetDate.toISOString()),\n            lt(productionSchedule.scheduledDate, nextDay.toISOString()),\n          ),\n        );\n\n      if (itemsToClose.length === 0) {\n        return {\n          message: \"No production items found for the specified date\",\n          closedItems: [],\n        };\n      }\n\n      // Insert items into history table\n      const historyData: InsertProductionScheduleHistory[] = itemsToClose.map(\n        (item) => ({\n          originalScheduleId: item.id,\n          productId: item.productId,\n          productName: item.productName,\n          productCode: item.productCode,\n          batchNo: item.batchNo,\n          totalQuantity: item.totalQuantity,\n          unitType: item.unitType,\n          actualQuantityPackets: item.actualQuantityPackets,\n          priority: item.priority,\n          productionStartTime: item.productionStartTime,\n          productionEndTime: item.productionEndTime,\n          assignedTo: item.assignedTo,\n          notes: item.notes,\n          status: item.status,\n          scheduleDate: item.scheduleDate,\n          shift: item.shift,\n          plannedBy: item.plannedBy,\n          approvedBy: item.approvedBy,\n          closedBy: closedBy,\n          closedAt: new Date(),\n        }),\n      );\n\n      const insertedHistory = await this.db\n        .insert(productionScheduleHistory)\n        .values(historyData)\n        .returning();\n\n      // Delete items from current production schedule\n      const itemIds = itemsToClose.map((item) => item.id);\n      await this.db\n        .delete(productionSchedule)\n        .where(sql`${productionSchedule.id} = ANY(${itemIds})`);\n\n      return {\n        message: `${itemsToClose.length} production items closed and moved to history`,\n        closedItems: insertedHistory,\n      };\n    } catch (error) {\n      console.error(\"Error closing production day:\", error);\n      throw error;\n    }\n  }\n\n  async getProductionScheduleHistory(date?: string): Promise<any[]> {\n    try {\n      let query = this.db\n        .select()\n        .from(productionScheduleHistory)\n        .orderBy(desc(productionScheduleHistory.closedAt));\n\n      if (date) {\n        const targetDate = new Date(date);\n        const nextDay = new Date(targetDate);\n        nextDay.setDate(nextDay.getDate() + 1);\n\n        query = query.where(\n          and(\n            gte(productionScheduleHistory.scheduleDate, targetDate),\n            lte(productionScheduleHistory.scheduleDate, nextDay),\n          ),\n        );\n      }\n\n      return await query;\n    } catch (error) {\n      console.error(\"Error fetching production schedule history:\", error);\n      throw error;\n    }\n  }\n\n  // Media operations\n  async getMediaItems(): Promise<any[]>;\n  async getMediaItems(): Promise<any[]> {\n    return [];\n  }\n\n  async uploadMedia(userId: string, file: any): Promise<any> {\n    return {\n      id: Date.now(),\n      filename: file.filename,\n      url: `/uploads/${file.filename}`,\n    };\n  }\n\n  async deleteMedia(id: number): Promise<void> {\n    // Media deletion functionality\n  }\n\n  async getBills(): Promise<any[]>;\n  async getBills(): Promise<any[]> {\n    return await this.getOrders();\n  }\n\n  async createBill(billData: any): Promise<any>;\n  async createBill(billData: any): Promise<any> {\n    return await this.createOrder(billData);\n  }\n\n  async deleteBill(id: number): Promise<void> {\n    await this.deleteOrder(id);\n  }\n\n  // Notifications\n  async getNotifications(userId?: string): Promise<any[]>;\n  async getNotifications(\n    userId?: string,\n    userBranchId?: number,\n    canAccessAllBranches?: boolean,\n  ): Promise<any[]> {\n    try {\n      // Return sample notifications for now - in production this would fetch from database\n      const sampleNotifications = [\n        {\n          id: \"1\",\n          type: \"order\",\n          title: \"New Order Received\",\n          description: \"Order #1024 from John Doe - $125.50\",\n          timestamp: new Date(Date.now() - 5 * 60 * 1000).toISOString(),\n          read: false,\n          priority: \"high\",\n          actionUrl: \"/orders/1024\",\n          data: { orderId: 1024, customerName: \"John Doe\", amount: 125.5 },\n        },\n        {\n          id: \"2\",\n          type: \"inventory\",\n          title: \"Low Stock Alert\",\n          description: \"Flour inventory is running low (5kg remaining)\",\n          timestamp: new Date(Date.now() - 15 * 60 * 1000).toISOString(),\n          read: false,\n          priority: \"critical\",\n          actionUrl: \"/inventory\",\n          data: { itemName: \"Flour\", currentStock: 5, minLevel: 10 },\n        },\n        {\n          id: \"3\",\n          type: \"production\",\n          title: \"Production Completed\",\n          description: \"Chocolate cake batch #45 completed successfully\",\n          timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),\n          read: false,\n          priority: \"medium\",\n          actionUrl: \"/production\",\n          data: { batchId: 45, product: \"Chocolate Cake\" },\n        },\n        {\n          id: \"4\",\n          type: \"shipping\",\n          title: \"Delivery Dispatched\",\n          description: \"Order #1020 dispatched via Express Delivery\",\n          timestamp: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString(),\n          read: true,\n          priority: \"medium\",\n          actionUrl: \"/orders/1020\",\n          data: { orderId: 1020, carrier: \"Express Delivery\" },\n        },\n        {\n          id: \"5\",\n          type: \"system\",\n          title: \"System Maintenance\",\n          description: \"Scheduled maintenance completed successfully\",\n          timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),\n          read: true,\n          priority: \"low\",\n          actionUrl: \"/settings\",\n          data: { maintenanceType: \"Database optimization\" },\n        },\n        {\n          id: \"6\",\n          type: \"order\",\n          title: \"Payment Received\",\n          description: \"Payment of $89.75 received for Order #1018\",\n          timestamp: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString(),\n          read: false,\n          priority: \"medium\",\n          actionUrl: \"/orders/1018\",\n          data: { orderId: 1018, amount: 89.75 },\n        },\n        {\n          id: \"7\",\n          type: \"production\",\n          title: \"Production Delay\",\n          description:\n            \"Vanilla cupcake batch delayed due to ingredient shortage\",\n          timestamp: new Date(Date.now() - 30 * 60 * 1000).toISOString(),\n          read: false,\n          priority: \"high\",\n          actionUrl: \"/production\",\n          data: { product: \"Vanilla Cupcakes\", reason: \"Ingredient shortage\" },\n        },\n      ];\n\n      return sampleNotifications;\n    } catch (error) {\n      console.error(\"Error fetching notifications:\", error);\n      return [];\n    }\n  }\n\n  async markNotificationAsRead(\n    notificationId: string,\n    userId: string,\n  ): Promise<void> {\n    // In production, this would update the database\n    console.log(\n      `Marking notification ${notificationId} as read for user ${userId}`,\n    );\n  }\n\n  async markAllNotificationsAsRead(userId: string): Promise<void> {\n    // In production, this would update all unread notifications for the user\n    console.log(`Marking all notifications as read for user ${userId}`);\n  }\n\n  async saveNotificationSubscription(\n    userId: string,\n    subscription: any,\n  ): Promise<void> {\n    // In production, this would save push notification subscription\n    console.log(`Saving notification subscription for user ${userId}`);\n  }\n\n  async removeNotificationSubscription(userId: string): Promise<void> {\n    // In production, this would remove push notification subscription\n    console.log(`Removing notification subscription for user ${userId}`);\n  }\n\n  async saveNotificationSettings(userId: string, settings: any): Promise<void> {\n    // In production, this would save notification preferences\n    console.log(`Saving notification settings for user ${userId}:`, settings);\n  }\n\n  async createNotification(notification: any): Promise<any> {\n    // In production, this would insert into notifications table\n    const newNotification = {\n      id: Date.now().toString(),\n      timestamp: new Date().toISOString(),\n      read: false,\n      ...notification,\n    };\n    console.log(\"Creating notification:\", newNotification);\n    return newNotification;\n  }\n\n  async triggerBusinessNotification(event: string, data: any): Promise<void> {\n    try {\n      let notification;\n\n      switch (event) {\n        case \"order_created\":\n          notification = {\n            type: \"order\",\n            title: \"New Order Received\",\n            description: `Order #${data.orderNumber} from ${data.customerName} - $${data.totalAmount}`,\n            priority: \"high\",\n            actionUrl: `/orders/${data.orderNumber}`,\n            data,\n          };\n          break;\n\n        case \"low_stock\":\n          notification = {\n            type: \"inventory\",\n            title: \"Low Stock Alert\",\n            description: `${data.itemName} is running low (${data.currentStock}${data.unit} remaining)`,\n            priority:\n              data.currentStock <= data.criticalLevel ? \"critical\" : \"high\",\n            actionUrl: \"/inventory\",\n            data,\n          };\n          break;\n\n        case \"production_completed\":\n          notification = {\n            type: \"production\",\n            title: \"Production Completed\",\n            description: `${data.productName} batch #${data.batchId} completed successfully`,\n            priority: \"medium\",\n            actionUrl: \"/production\",\n            data,\n          };\n          break;\n\n        case \"production_delayed\":\n          notification = {\n            type: \"production\",\n            title: \"Production Delay\",\n            description: `${data.productName} batch delayed: ${data.reason}`,\n            priority: \"high\",\n            actionUrl: \"/production\",\n            data,\n          };\n          break;\n\n        case \"shipment_dispatched\":\n          notification = {\n            type: \"shipping\",\n            title: \"Shipment Dispatched\",\n            description: `Order #${data.orderNumber} dispatched via ${data.carrier}`,\n            priority: \"medium\",\n            actionUrl: `/orders/${data.orderNumber}`,\n            data,\n          };\n          break;\n\n        case \"delivery_failed\":\n          notification = {\n            type: \"shipping\",\n            title: \"Delivery Failed\",\n            description: `Failed to deliver Order #${data.orderNumber}: ${data.reason}`,\n            priority: \"high\",\n            actionUrl: `/orders/${data.orderNumber}`,\n            data,\n          };\n          break;\n\n        case \"payment_received\":\n          notification = {\n            type: \"order\",\n            title: \"Payment Received\",\n            description: `Payment of $${data.amount} received for Order #${data.orderNumber}`,\n            priority: \"medium\",\n            actionUrl: `/orders/${data.orderNumber}`,\n            data,\n          };\n          break;\n\n        case \"system_alert\":\n          notification = {\n            type: \"system\",\n            title: data.title || \"System Alert\",\n            description: data.description,\n            priority: data.priority || \"medium\",\n            actionUrl: data.actionUrl || \"/settings\",\n            data,\n          };\n          break;\n\n        default:\n          console.warn(`Unknown notification event: ${event}`);\n          return;\n      }\n\n      // In production, broadcast to all relevant users based on their roles\n      const adminUsers = await this.getAllUsers(); // Fetch all users, including superadmin\n      const relevantUsers = adminUsers.filter((user) =>\n        [\"admin\", \"manager\", \"supervisor\"].includes(user.role),\n      );\n\n      for (const user of relevantUsers) {\n        await this.createNotification({\n          userId: user.id,\n          ...notification,\n        });\n      }\n\n      console.log(\n        `Triggered ${event} notification for ${relevantUsers.length} users`,\n      );\n    } catch (error) {\n      console.error(\"Error triggering business notification:\", error);\n    }\n  }\n\n  // Staff management operations\n  async getStaff(): Promise<Staff[]> {\n    try {\n      const result = await this.db\n        .select()\n        .from(staff)\n        .orderBy(staff.firstName, staff.lastName);\n\n      console.log(`‚úÖ Found ${result.length} staff members`);\n      return result;\n    } catch (error) {\n      console.error(\"‚ùå Error fetching staff:\", error);\n      return [];\n    }\n  }\n\n  async getStaffById(id: number): Promise<Staff | undefined> {\n    const result = await this.db\n      .select()\n      .from(staff)\n      .where(eq(staff.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async createStaff(staffData: InsertStaff): Promise<Staff> {\n    try {\n      console.log(\"Creating staff with data:\", staffData);\n\n      // Clean the data to handle empty strings for numeric fields\n      const cleanedData = {\n        ...staffData,\n        // Convert empty strings to null for numeric fields\n        salary:\n          staffData.salary && staffData.salary !== \"\" ? staffData.salary : null,\n        hourlyRate:\n          staffData.hourlyRate && staffData.hourlyRate !== \"\"\n            ? staffData.hourlyRate\n            : null,\n        // Ensure dates are properly formatted\n        dateOfBirth: staffData.dateOfBirth\n          ? new Date(staffData.dateOfBirth)\n          : null,\n        hireDate: staffData.hireDate\n          ? new Date(staffData.hireDate)\n          : new Date(),\n        terminationDate: staffData.terminationDate\n          ? new Date(staffData.terminationDate)\n          : null,\n        // Set default status if not provided\n        status: staffData.status || \"active\",\n        // Set timestamps\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n\n      const [newStaff] = await this.db\n        .insert(staff)\n        .values(cleanedData)\n        .returning();\n      console.log(\"Staff created successfully:\", newStaff);\n      return newStaff;\n    } catch (error) {\n      console.error(\"Error creating staff:\", error);\n      throw error;\n    }\n  }\n\n  async updateStaff(\n    id: number,\n    staffData: Partial<InsertStaff>,\n  ): Promise<Staff> {\n    try {\n      console.log(\"Updating staff with data:\", staffData);\n\n      // Clean the data to handle empty strings for numeric fields\n      const cleanedData = {\n        ...staffData,\n        // Convert empty strings to null for numeric fields\n        salary:\n          staffData.salary && staffData.salary !== \"\" ? staffData.salary : null,\n        hourlyRate:\n          staffData.hourlyRate && staffData.hourlyRate !== \"\"\n            ? staffData.hourlyRate\n            : null,\n        // Ensure dates are properly formatted\n        dateOfBirth: staffData.dateOfBirth\n          ? new Date(staffData.dateOfBirth)\n          : null,\n        hireDate: staffData.hireDate ? new Date(staffData.hireDate) : null,\n        terminationDate: staffData.terminationDate\n          ? new Date(staffData.terminationDate)\n          : null,\n        // Set update timestamp\n        updatedAt: new Date(),\n      };\n\n      const [updatedStaff] = await this.db\n        .update(staff)\n        .set(cleanedData)\n        .where(eq(staff.id, id))\n        .returning();\n\n      console.log(\"Staff updated successfully:\", updatedStaff);\n      return updatedStaff;\n    } catch (error) {\n      console.error(\"Error updating staff:\", error);\n      throw error;\n    }\n  }\n\n  async deleteStaff(id: number): Promise<void> {\n    await this.db.delete(staff).where(eq(staff.id, id));\n  }\n\n  async getStaffByStaffId(staffId: string): Promise<Staff | null> {\n    const result = await this.db\n      .select()\n      .from(staff)\n      .where(eq(staff.staffId, staffId))\n      .limit(1);\n    return result[0] || null;\n  }\n\n  // Attendance operations\n  async getAttendance(\n    staffId?: number,\n    startDate?: Date,\n    endDate?: Date,\n    limit?: number,\n    offset?: number,\n  ): Promise<{\n    items: any[];\n    totalCount: number;\n    totalPages: number;\n    currentPage: number;\n    itemsPerPage: number;\n  }> {\n    try {\n      const itemsPerPage = limit || 10;\n      const currentPage = offset ? Math.floor(offset / itemsPerPage) + 1 : 1;\n\n      let query = this.db\n        .select({\n          id: attendance.id,\n          staffId: attendance.staffId,\n          date: attendance.date,\n          clockIn: attendance.clockIn,\n          clockOut: attendance.clockOut,\n          breakStart: attendance.breakStart,\n          breakEnd: attendance.breakEnd,\n          totalHours: attendance.totalHours,\n          overtimeHours: attendance.overtimeHours,\n          status: attendance.status,\n          notes: attendance.notes,\n          approvedBy: attendance.approvedBy,\n          createdAt: attendance.createdAt,\n          updatedAt: attendance.updatedAt,\n          staffName: sql<string>`CONCAT(${staff.firstName}, ' ', ${staff.lastName})`,\n          staffPosition: staff.position,\n        })\n        .from(attendance)\n        .leftJoin(staff, eq(attendance.staffId, staff.id));\n\n      let countQuery = this.db\n        .select({ count: count() })\n        .from(attendance)\n        .leftJoin(staff, eq(attendance.staffId, staff.id));\n\n      const conditions = [];\n\n      if (staffId) {\n        conditions.push(eq(attendance.staffId, staffId));\n      }\n\n      if (startDate) {\n        conditions.push(gte(attendance.date, startDate));\n      }\n\n      if (endDate) {\n        conditions.push(lte(attendance.date, endDate));\n      }\n\n      if (conditions.length > 0) {\n        query = query.where(and(...conditions));\n        countQuery = countQuery.where(and(...conditions));\n      }\n\n      // Get total count\n      const totalResult = await countQuery;\n      const totalCount = totalResult[0]?.count || 0;\n      const totalPages = Math.ceil(totalCount / itemsPerPage);\n\n      // Apply pagination and ordering\n      const items = await query\n        .orderBy(desc(attendance.date), desc(attendance.clockIn))\n        .limit(itemsPerPage)\n        .offset(offset || 0);\n\n      console.log(\n        `‚úÖ Found ${items.length} attendance records (page ${currentPage} of ${totalPages})`,\n      );\n\n      return {\n        items,\n        totalCount,\n        totalPages,\n        currentPage,\n        itemsPerPage,\n      };\n    } catch (error) {\n      console.error(\"‚ùå Error fetching attendance:\", error);\n      return {\n        items: [],\n        totalCount: 0,\n        totalPages: 0,\n        currentPage: 1,\n        itemsPerPage: 10,\n      };\n    }\n  }\n\n  async createAttendance(\n    attendanceData: InsertAttendance,\n  ): Promise<Attendance> {\n    const [newAttendance] = await this.db\n      .insert(attendance)\n      .values(attendanceData)\n      .returning();\n    return newAttendance;\n  }\n\n  async updateAttendance(\n    id: number,\n    attendanceData: Partial<InsertAttendance>,\n  ): Promise<Attendance> {\n    const [updatedAttendance] = await this.db\n      .update(attendance)\n      .set({ ...attendanceData, updatedAt: new Date() })\n      .where(eq(attendance.id, id))\n      .returning();\n    return updatedAttendance;\n  }\n\n  async deleteAttendance(id: number): Promise<void> {\n    await this.db.delete(attendance).where(eq(attendance.id, id));\n  }\n\n  async clockIn(staffId: number): Promise<Attendance> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    // Check if already clocked in today\n    const existing = await this.db\n      .select()\n      .from(attendance)\n      .where(and(eq(attendance.staffId, staffId), gte(attendance.date, today)))\n      .limit(1);\n\n    if (existing.length > 0) {\n      throw new Error(\"Already clocked in today\");\n    }\n\n    const [newAttendance] = await this.db\n      .insert(attendance)\n      .values({\n        staffId,\n        date: new Date(),\n        clockIn: new Date(),\n        status: \"present\",\n      })\n      .returning();\n\n    return newAttendance;\n  }\n\n  async clockOut(staffId: number): Promise<Attendance> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    const existing = await this.db\n      .select()\n      .from(attendance)\n      .where(and(eq(attendance.staffId, staffId), gte(attendance.date, today)))\n      .limit(1);\n\n    if (existing.length === 0) {\n      throw new Error(\"No clock-in record found for today\");\n    }\n\n    const clockOutTime = new Date();\n    const clockInTime = existing[0].clockIn;\n    let totalHours = 0;\n\n    if (clockInTime) {\n      totalHours =\n        (clockOutTime.getTime() - clockInTime.getTime()) / (1000 * 60 * 60);\n    }\n\n    const [updatedAttendance] = await this.db\n      .update(attendance)\n      .set({\n        clockOut: clockOutTime,\n        totalHours: totalHours.toString(),\n        updatedAt: new Date(),\n      })\n      .where(eq(attendance.id, existing[0].id))\n      .returning();\n\n    return updatedAttendance;\n  }\n\n  // Salary operations\n  async getSalaryPayments(\n    staffId?: number,\n    limit?: number,\n    offset?: number,\n    search?: string,\n  ): Promise<{\n    items: any[];\n    totalCount: number;\n    totalPages: number;\n    currentPage: number;\n    itemsPerPage: number;\n  }> {\n    try {\n      const itemsPerPage = limit || 10;\n      const currentPage = offset ? Math.floor(offset / itemsPerPage) + 1 : 1;\n\n      let query = this.db\n        .select({\n          id: salaryPayments.id,\n          staffId: salaryPayments.staffId,\n          payPeriodStart: salaryPayments.payPeriodStart,\n          payPeriodEnd: salaryPayments.payPeriodEnd,\n          basicSalary: salaryPayments.basicSalary,\n          overtimePay: salaryPayments.overtimePay,\n          bonus: salaryPayments.bonus,\n          allowances: salaryPayments.allowances,\n          deductions: salaryPayments.deductions,\n          tax: salaryPayments.tax,\n          netPay: salaryPayments.netPay,\n          paymentDate: salaryPayments.paymentDate,\n          paymentMethod: salaryPayments.paymentMethod,\n          status: salaryPayments.status,\n          notes: salaryPayments.notes,\n          processedBy: salaryPayments.processedBy,\n          createdAt: salaryPayments.createdAt,\n          updatedAt: salaryPayments.updatedAt,\n          staffName: sql<string>`CONCAT(${staff.firstName}, ' ', ${staff.lastName})`,\n          staffPosition: staff.position,\n        })\n        .from(salaryPayments)\n        .leftJoin(staff, eq(salaryPayments.staffId, staff.id));\n\n      let countQuery = this.db\n        .select({ count: count() })\n        .from(salaryPayments)\n        .leftJoin(staff, eq(salaryPayments.staffId, staff.id));\n\n      const conditions = [];\n\n      if (staffId) {\n        conditions.push(eq(salaryPayments.staffId, staffId));\n      }\n\n      if (search) {\n        conditions.push(\n          or(\n            ilike(staff.firstName, `%${search}%`),\n            ilike(staff.lastName, `%${search}%`),\n            ilike(staff.position, `%${search}%`),\n          ),\n        );\n      }\n\n      if (conditions.length > 0) {\n        query = query.where(and(...conditions));\n        countQuery = countQuery.where(and(...conditions));\n      }\n\n      // Get total count\n      const totalResult = await countQuery;\n      const totalCount = totalResult[0]?.count || 0;\n      const totalPages = Math.ceil(totalCount / itemsPerPage);\n\n      // Apply pagination and ordering\n      const items = await query\n        .orderBy(desc(salaryPayments.payPeriodEnd))\n        .limit(itemsPerPage)\n        .offset(offset || 0);\n\n      console.log(\n        `‚úÖ Found ${items.length} salary payment records (page ${currentPage} of ${totalPages})`,\n      );\n\n      return {\n        items,\n        totalCount,\n        totalPages,\n        currentPage,\n        itemsPerPage,\n      };\n    } catch (error) {\n      console.error(\"‚ùå Error fetching salary payments:\", error);\n      return {\n        items: [],\n        totalCount: 0,\n        totalPages: 0,\n        currentPage: 1,\n        itemsPerPage: 10,\n      };\n    }\n  }\n\n  async createSalaryPayment(\n    paymentData: InsertSalaryPayment,\n  ): Promise<SalaryPayment> {\n    const [newPayment] = await this.db\n      .insert(salaryPayments)\n      .values(paymentData)\n      .returning();\n    return newPayment;\n  }\n\n  async updateSalaryPayment(\n    id: number,\n    paymentData: Partial<InsertSalaryPayment>,\n  ): Promise<SalaryPayment> {\n    const [updatedPayment] = await this.db\n      .update(salaryPayments)\n      .set({ ...paymentData, updatedAt: new Date() })\n      .where(eq(salaryPayments.id, id))\n      .returning();\n    return updatedPayment;\n  }\n\n  async deleteSalaryPayment(id: number): Promise<void> {\n    await this.db.delete(salaryPayments).where(eq(salaryPayments.id, id));\n  }\n\n  // Leave request operations\n  async getLeaveRequests(staffId?: number): Promise<any[]> {\n    let query = this.db\n      .select({\n        id: leaveRequests.id,\n        staffId: leaveRequests.staffId,\n        leaveType: leaveRequests.leaveType,\n        startDate: leaveRequests.startDate,\n        endDate: leaveRequests.endDate,\n        totalDays: leaveRequests.totalDays,\n        reason: leaveRequests.reason,\n        status: leaveRequests.status,\n        appliedDate: leaveRequests.appliedDate,\n        reviewedBy: leaveRequests.reviewedBy,\n        reviewedDate: leaveRequests.reviewedDate,\n        reviewComments: leaveRequests.reviewComments,\n        staffName: sql<string>`CONCAT(${staff.firstName}, ' ', ${staff.lastName})`,\n        staffPosition: staff.position,\n      })\n      .from(leaveRequests)\n      .leftJoin(staff, eq(leaveRequests.staffId, staff.id))\n      .orderBy(desc(leaveRequests.appliedDate));\n\n    if (staffId) {\n      query = query.where(eq(leaveRequests.staffId, staffId));\n    }\n\n    return await query;\n  }\n\n  async createLeaveRequest(\n    requestData: InsertLeaveRequest,\n  ): Promise<LeaveRequest> {\n    const [newRequest] = await this.db\n      .insert(leaveRequests)\n      .values(requestData)\n      .returning();\n    return newRequest;\n  }\n\n  async updateLeaveRequest(\n    id: number,\n    requestData: Partial<InsertLeaveRequest>,\n  ): Promise<LeaveRequest> {\n    const [updatedRequest] = await this.db\n      .update(leaveRequests)\n      .set({ ...requestData, updatedAt: new Date() })\n      .where(eq(leaveRequests.id, id))\n      .returning();\n    return updatedRequest;\n  }\n\n  async deleteLeaveRequest(id: number): Promise<void> {\n    await this.db.delete(leaveRequests).where(eq(leaveRequests.id, id));\n  }\n\n  // Staff schedule operations\n  async getStaffSchedules(staffId?: number, date?: Date): Promise<any[]> {\n    let query = this.db\n      .select({\n        id: staffSchedules.id,\n        staffId: staffSchedules.staffId,\n        date: staffSchedules.date,\n        shiftStart: staffSchedules.shiftStart,\n        shiftEnd: staffSchedules.shiftEnd,\n        position: staffSchedules.position,\n        department: staffSchedules.department,\n        isRecurring: staffSchedules.isRecurring,\n        recurringPattern: staffSchedules.recurringPattern,\n        notes: staffSchedules.notes,\n        createdBy: staffSchedules.createdBy,\n        staffName: sql<string>`CONCAT(${staff.firstName}, ' ', ${staff.lastName})`,\n        staffPosition: staff.position,\n      })\n      .from(staffSchedules)\n      .leftJoin(staff, eq(staffSchedules.staffId, staff.id))\n      .orderBy(staffSchedules.date);\n\n    const conditions = [];\n    if (staffId) {\n      conditions.push(eq(staffSchedules.staffId, staffId));\n    }\n    if (date) {\n      const startOfDay = new Date(date);\n      startOfDay.setHours(0, 0, 0, 0);\n      const endOfDay = new Date(date);\n      endOfDay.setHours(23, 59, 59, 999);\n      conditions.push(\n        and(\n          gte(staffSchedules.date, startOfDay),\n          lte(staffSchedules.date, endOfDay),\n        ),\n      );\n    }\n\n    if (conditions.length > 0) {\n      query = query.where(and(...conditions));\n    }\n\n    return await query;\n  }\n\n  async createStaffSchedule(\n    scheduleData: InsertStaffSchedule,\n  ): Promise<StaffSchedule> {\n    const [newSchedule] = await this.db\n      .insert(staffSchedules)\n      .values(scheduleData)\n      .returning();\n    return newSchedule;\n  }\n\n  async updateStaffSchedule(\n    id: number,\n    scheduleData: Partial<InsertStaffSchedule>,\n  ): Promise<StaffSchedule> {\n    const [updatedSchedule] = await this.db\n      .update(staffSchedules)\n      .set({ ...scheduleData, updatedAt: new Date() })\n      .where(eq(staffSchedules.id, id))\n      .returning();\n    return updatedSchedule;\n  }\n\n  async deleteStaffSchedule(id: number): Promise<void> {\n    await this.db.delete(staffSchedules).where(eq(staffSchedules.id, id));\n  }\n  async createAuditLog(log: InsertAuditLog): Promise<AuditLog> {\n    try {\n      // Ensure all required fields are present\n      const auditLogData = {\n        ...log,\n        timestamp: new Date(),\n        status: log.status || \"success\",\n        userId: log.userId || \"system\",\n        userEmail: log.userEmail || \"system@bakesewa.com\",\n        userName: log.userName || \"System\",\n        ipAddress: log.ipAddress || \"127.0.0.1\",\n      };\n\n      const [auditLog] = await this.db\n        .insert(auditLogs)\n        .values(auditLogData)\n        .returning();\n      return auditLog;\n    } catch (error) {\n      console.error(\"Failed to create audit log:\", error);\n      // Still try to log the error to console for debugging\n      console.error(\"Audit log data:\", log);\n      throw error;\n    }\n  }\n\n  async getAuditLogs(filters?: {\n    userId?: string;\n    action?: string;\n    resource?: string;\n    startDate?: Date;\n    endDate?: Date;\n    limit?: number;\n    offset?: number;\n  }): Promise<AuditLog[]> {\n    try {\n      let query = this.db.select().from(auditLogs);\n\n      if (filters) {\n        const conditions = [];\n\n        if (filters.userId) {\n          conditions.push(eq(auditLogs.userId, filters.userId));\n        }\n\n        if (filters.action) {\n          conditions.push(eq(auditLogs.action, filters.action));\n        }\n\n        if (filters.resource) {\n          conditions.push(eq(auditLogs.resource, filters.resource));\n        }\n\n        if (filters.startDate) {\n          conditions.push(\n            sql`${auditLogs.timestamp} >= ${filters.startDate.toISOString()}`,\n          );\n        }\n\n        if (filters.endDate) {\n          conditions.push(\n            sql`${auditLogs.timestamp} <= ${filters.endDate.toISOString()}`,\n          );\n        }\n\n        if (conditions.length > 0) {\n          query = query.where(and(...conditions));\n        }\n\n        if (filters.offset) {\n          query = query.offset(filters.offset);\n        }\n\n        if (filters.limit) {\n          query = query.limit(filters.limit);\n        } else {\n          query = query.limit(1000);\n        }\n      } else {\n        query = query.limit(1000);\n      }\n\n      return await query.orderBy(desc(auditLogs.timestamp));\n    } catch (error) {\n      console.error(\"Failed to get audit logs:\", error);\n      return [];\n    }\n  }\n\n  async logUserAction(\n    userId: string,\n    action: string,\n    resource: string,\n    details?: any,\n    ipAddress?: string,\n    userAgent?: string,\n  ): Promise<void> {\n    try {\n      // Get user info for audit log\n      let userName = \"Unknown User\";\n      let userEmail = \"unknown@example.com\";\n\n      try {\n        const user = await this.getUserById(userId);\n        if (user) {\n          userName = `${user.firstName || \"\"} ${user.lastName || \"\"}`.trim();\n          userEmail = user.email || userEmail;\n        }\n      } catch (userError) {\n        console.warn(\"Could not fetch user details for audit log:\", userError);\n      }\n\n      await this.createAuditLog({\n        userId,\n        userEmail,\n        userName,\n        action,\n        resource,\n        status: \"success\",\n        ipAddress: ipAddress || \"127.0.0.1\",\n        userAgent: userAgent || \"Unknown\",\n        details: details || null,\n        timestamp: new Date(),\n        resourceId: null,\n        errorMessage: null,\n      });\n    } catch (error) {\n      console.error(\"‚ùå Error logging user action:\", error);\n      // Don't throw error to prevent breaking the main flow\n    }\n  }\n\n  async logLogin(\n    userId: string,\n    userEmail: string,\n    userName: string,\n    ipAddress: string,\n    userAgent: string,\n    success: boolean,\n    errorMessage?: string,\n  ): Promise<void> {\n    try {\n      // Log to login_logs table\n      await this.db.insert(loginLogs).values({\n        userId,\n        email: userEmail,\n        ipAddress,\n        userAgent,\n        status: success ? \"success\" : \"failed\",\n        location: \"Unknown\", // You can enhance this with IP geolocation\n        deviceType: userAgent?.includes(\"Mobile\") ? \"mobile\" : \"desktop\",\n      });\n\n      // Also log to audit_logs for comprehensive tracking\n      await this.createAuditLog({\n        userId,\n        userEmail,\n        userName,\n        action: \"LOGIN\",\n        resource: \"authentication\",\n        details: {\n          userAgent,\n          success,\n          errorMessage,\n        },\n        ipAddress,\n        userAgent,\n        status: success ? \"success\" : \"failed\",\n        errorMessage: success ? null : errorMessage,\n      });\n    } catch (error) {\n      console.error(\"Failed to log login event:\", error);\n    }\n  }\n\n  async logLogout(\n    userId: string,\n    userEmail: string,\n    userName: string,\n    ipAddress: string,\n  ): Promise<void> {\n    try {\n      const logData = {\n        userId: userId,\n        userEmail: userEmail,\n        userName: userName,\n        action: \"LOGOUT\",\n        resource: \"auth\",\n        resourceId: userId,\n        details: { logoutTime: new Date().toISOString() },\n        ipAddress: ipAddress,\n        userAgent: \"System\",\n        timestamp: new Date(),\n        status: \"success\",\n      };\n\n      await this.createAuditLog(logData);\n    } catch (error) {\n      console.error(\"Failed to log logout:\", error);\n    }\n  }\n\n  // Security monitoring methods\n  async getSecurityMetrics(\n    timeframe: \"hour\" | \"day\" | \"week\" = \"day\",\n  ): Promise<any> {\n    try {\n      const now = new Date();\n      let startTime: Date;\n\n      switch (timeframe) {\n        case \"hour\":\n          startTime = new Date(now.getTime() - 60 * 60 * 1000);\n          break;\n        case \"week\":\n          startTime = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n          break;\n        default:\n          startTime = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n      }\n\n      const [failedLogins, suspiciousActivities, totalActivities] =\n        await Promise.all([\n          this.db\n            .select({ count: count() })\n            .from(loginLogs)\n            .where(\n              and(\n                eq(loginLogs.status, \"failed\"),\n                gte(loginLogs.timestamp, startTime),\n              ),\n            ),\n\n          this.db\n            .select({ count: count() })\n            .from(auditLogs)\n            .where(\n              and(\n                eq(auditLogs.status, \"failed\"),\n                gte(auditLogs.timestamp, startTime),\n              ),\n            ),\n\n          this.db\n            .select({ count: count() })\n            .from(auditLogs)\n            .where(gte(auditLogs.timestamp, startTime)),\n        ]);\n\n      return {\n        failedLogins: failedLogins[0]?.count || 0,\n        suspiciousActivities: suspiciousActivities[0]?.count || 0,\n        totalActivities: totalActivities[0]?.count || 0,\n        timeframe,\n        period: { start: startTime, end: now },\n      };\n    } catch (error) {\n      console.error(\"‚ùå Failed to get security metrics:\", error);\n      return {\n        failedLogins: 0,\n        suspiciousActivities: 0,\n        totalActivities: 0,\n        timeframe,\n        error: error.message,\n      };\n    }\n  }\n\n  // Production Schedule Labels operations\n  async getProductionScheduleLabels(): Promise<ProductionScheduleLabel[]> {\n    try {\n      return await this.db\n        .select()\n        .from(productionScheduleLabels)\n        .orderBy(desc(productionScheduleLabels.createdAt));\n    } catch (error) {\n      console.error(\"Error fetching production schedule labels:\", error);\n      throw error;\n    }\n  }\n\n  async createProductionScheduleLabel(\n    data: InsertProductionScheduleLabel,\n  ): Promise<ProductionScheduleLabel> {\n    try {\n      const [newLabel] = await this.db\n        .insert(productionScheduleLabels)\n        .values(data)\n        .returning();\n      return newLabel;\n    } catch (error) {\n      console.error(\"Error creating production schedule label:\", error);\n      throw error;\n    }\n  }\n\n  async updateProductionScheduleLabel(\n    id: number,\n    data: Partial<InsertProductionScheduleLabel>,\n  ): Promise<ProductionScheduleLabel> {\n    try {\n      const [updatedLabel] = await this.db\n        .update(productionScheduleLabels)\n        .set({ ...data, updatedAt: new Date() })\n        .where(eq(productionScheduleLabels.id, id))\n        .returning();\n      return updatedLabel;\n    } catch (error) {\n      console.error(\"Error updating production schedule label:\", error);\n      throw error;\n    }\n  }\n\n  async closeDayForLabels(ids: number[], closedBy: string): Promise<any> {\n    try {\n      const result = await this.db\n        .update(productionScheduleLabels)\n        .set({\n          isDraft: false,\n          dayClosed: true,\n          dayClosedAt: new Date(),\n          dayClosedBy: closedBy,\n          updatedAt: new Date(),\n        })\n        .where(sql`${productionScheduleLabels.id} = ANY(${ids})`)\n        .returning();\n\n      return {\n        message: `${result.length} labels closed successfully`,\n        closedLabels: result,\n      };\n    } catch (error) {\n      console.error(\"Error closing day for labels:\", error);\n      throw error;\n    }\n  }\n\n  // Supplier Ledger operations\n  async getSupplierLedgers(): Promise<any[]> {\n    try {\n      console.log(\"üìä Fetching supplier ledgers...\");\n\n      // Get all suppliers with their purchase data\n      const suppliersWithPurchases = await this.db\n        .select({\n          supplierId: parties.id,\n          supplierName: parties.name,\n          currentBalance: parties.currentBalance,\n          purchaseId: purchases.id,\n          purchaseDate: purchases.purchaseDate,\n          invoiceNumber: purchases.invoiceNumber,\n          totalAmount: purchases.totalAmount,\n          paymentMethod: purchases.paymentMethod,\n          status: purchases.status,\n          createdAt: purchases.createdAt,\n        })\n        .from(parties)\n        .leftJoin(purchases, eq(parties.id, purchases.partyId))\n        .where(eq(parties.type, \"supplier\"))\n        .orderBy(parties.name, desc(purchases.purchaseDate));\n\n      // Group by supplier and calculate balances\n      const ledgerMap = new Map();\n\n      for (const row of suppliersWithPurchases) {\n        if (!ledgerMap.has(row.supplierId)) {\n          ledgerMap.set(row.supplierId, {\n            supplierId: row.supplierId,\n            supplierName: row.supplierName,\n            currentBalance: parseFloat(row.currentBalance || \"0\"),\n            totalPurchases: 0,\n            totalPaid: 0,\n            totalOutstanding: 0,\n            transactions: [],\n          });\n        }\n\n        const ledger = ledgerMap.get(row.supplierId);\n\n        if (row.purchaseId) {\n          const totalAmount = parseFloat(row.totalAmount || \"0\");\n          const amountPaid = row.status === \"completed\" ? totalAmount : 0;\n          const outstanding = totalAmount - amountPaid;\n\n          // Get purchase items\n          const purchaseItems = await this.db\n            .select({\n              inventoryItemName: inventoryItems.name,\n              quantity: purchaseItems.quantity,\n            })\n            .from(purchaseItems)\n            .leftJoin(\n              inventoryItems,\n              eq(purchaseItems.inventoryItemId, inventoryItems.id),\n            )\n            .where(eq(purchaseItems.purchaseId, row.purchaseId));\n\n          const itemsDescription =\n            purchaseItems.length > 0\n              ? purchaseItems\n                  .map((item) => `${item.inventoryItemName} (${item.quantity})`)\n                  .join(\", \")\n              : \"N/A\";\n\n          ledger.transactions.push({\n            id: row.purchaseId,\n            date: row.purchaseDate || row.createdAt,\n            invoiceNumber: row.invoiceNumber,\n            items: itemsDescription,\n            totalAmount,\n            amountPaid,\n            outstanding,\n            paymentStatus:\n              row.status === \"completed\"\n                ? \"Paid\"\n                : outstanding > 0\n                  ? amountPaid > 0\n                    ? \"Partial\"\n                    : \"Due\"\n                  : \"Paid\",\n            paymentMethod: row.paymentMethod,\n            transactionType: \"Purchase\",\n          });\n\n          ledger.totalPurchases += totalAmount;\n          ledger.totalPaid += amountPaid;\n          ledger.totalOutstanding += outstanding;\n        }\n      }\n\n      // Calculate running balances for each supplier\n      const ledgers = Array.from(ledgerMap.values());\n      ledgers.forEach((ledger) => {\n        let runningBalance = 0;\n\n        // Sort transactions by date\n        ledger.transactions.sort(\n          (a, b) => new Date(a.date).getTime() - new Date(b.date).getTime(),\n        );\n\n        // Calculate running balance\n        ledger.transactions.forEach((transaction) => {\n          if (transaction.transactionType === \"Purchase\") {\n            runningBalance += transaction.outstanding; // Debit increases payable\n          }\n          transaction.runningBalance = runningBalance;\n        });\n\n        ledger.currentBalance = runningBalance;\n      });\n\n      return ledgers.filter((ledger) => ledger.transactions.length > 0);\n    } catch (error) {\n      console.error(\"‚ùå Error fetching supplier ledgers:\", error);\n      return [];\n    }\n  }\n\n  async getSupplierLedger(supplierId: number): Promise<any> {\n    try {\n      const allLedgers = await this.getSupplierLedgers();\n      return (\n        allLedgers.find((ledger) => ledger.supplierId === supplierId) || null\n      );\n    } catch (error) {\n      console.error(\"‚ùå Error fetching supplier ledger:\", error);\n      return null;\n    }\n  }\n\n  async updateSupplierLedger(\n    supplierId: number,\n    purchaseData: any,\n  ): Promise<void> {\n    try {\n      // This method is called when a purchase is made\n      // Update the supplier's current balance\n      const currentBalance = await this.calculateSupplierBalance(supplierId);\n\n      await this.db\n        .update(parties)\n        .set({\n          currentBalance: currentBalance.toString(),\n          updatedAt: new Date(),\n        })\n        .where(eq(parties.id, supplierId));\n\n      console.log(\n        `‚úÖ Updated supplier ${supplierId} balance to ${currentBalance}`,\n      );\n    } catch (error) {\n      console.error(\"‚ùå Error updating supplier ledger:\", error);\n      throw error;\n    }\n  }\n\n  async calculateSupplierBalance(supplierId: number): Promise<number> {\n    try {\n      // Calculate total purchases\n      const purchasesResult = await this.db\n        .select({\n          totalPurchases: sql<number>`COALESCE(SUM(${purchases.totalAmount}), 0)`,\n        })\n        .from(purchases)\n        .where(eq(purchases.partyId, supplierId));\n\n      const totalPurchases = purchasesResult[0]?.totalPurchases || 0;\n\n      // Calculate total payments (for now, we assume completed purchases are paid)\n      const paymentsResult = await this.db\n        .select({\n          totalPayments: sql<number>`COALESCE(SUM(${purchases.totalAmount}), 0)`,\n        })\n        .from(purchases)\n        .where(\n          and(\n            eq(purchases.partyId, supplierId),\n            eq(purchases.status, \"completed\"),\n          ),\n        );\n\n      const totalPayments = paymentsResult[0]?.totalPayments || 0;\n\n      // Balance = Total Purchases - Total Payments (positive = amount owed, negative = advance paid)\n      return totalPurchases - totalPayments;\n    } catch (error) {\n      console.error(\"‚ùå Error calculating supplier balance:\", error);\n      return 0;\n    }\n  }\n\n  // Sales methods\n  async getSales(): Promise<any[]> {\n    try {\n      // Check if sales table exists, if not return empty array\n      const result = await this.db\n        .select()\n        .from(sales)\n        .orderBy(desc(sales.createdAt))\n        .catch(() => []);\n\n      console.log(`‚úÖ Found ${result.length} sales`);\n      return result || [];\n    } catch (error) {\n      console.error(\"‚ùå Error fetching sales:\", error);\n      return [];\n    }\n  }\n\n  async createSaleWithTransaction(saleData: any): Promise<any> {\n    try {\n      // Start a transaction\n      return await this.db.transaction(async (tx) => {\n        // 1. Create or find customer\n        let customerId = saleData.customerId;\n        if (!customerId && saleData.customerName) {\n          // Try to find existing customer\n          const existingCustomer = await tx\n            .select()\n            .from(customers)\n            .where(eq(customers.name, saleData.customerName))\n            .limit(1);\n\n          if (existingCustomer.length > 0) {\n            customerId = existingCustomer[0].id;\n          } else {\n            // Create new customer\n            const newCustomer = await tx\n              .insert(customers)\n              .values({\n                name: saleData.customerName,\n                email: saleData.customerEmail || null,\n                phone: saleData.customerPhone || null,\n                currentBalance: \"0\",\n                totalOrders: 0,\n                totalSpent: \"0\",\n              })\n              .returning();\n            customerId = newCustomer[0].id;\n          }\n        }\n\n        // 2. Create the sale\n        const newSale = await tx\n          .insert(sales)\n          .values({\n            customerName: saleData.customerName,\n            customerId: customerId,\n            customerEmail: saleData.customerEmail,\n            customerPhone: saleData.customerPhone,\n            totalAmount: saleData.totalAmount,\n            paymentMethod: saleData.paymentMethod,\n            status: saleData.status || \"completed\",\n            saleDate: new Date(),\n            notes: saleData.notes,\n          })\n          .returning();\n\n        const sale = newSale[0];\n\n        // 3. Create sale items\n        if (saleData.items && saleData.items.length > 0) {\n          await tx.insert(saleItems).values(\n            saleData.items.map((item: any) => ({\n              saleId: sale.id,\n              productId: item.productId,\n              quantity: item.quantity,\n              unitPrice: item.unitPrice,\n              totalPrice: item.totalPrice,\n            })),\n          );\n        }\n\n        // 4. Record customer ledger transaction (Debit - Customer owes money or paid)\n        // Create ledger entry for customer - only if customerId exists and is valid\n        if (saleData.customerId && saleData.customerId > 0) {\n          try {\n            await tx.insert(ledgerTransactions).values({\n              customerOrPartyId: saleData.customerId,\n              entityType: \"customer\",\n              transactionDate: new Date(saleData.saleDate || new Date()),\n              description: `Sale - INV-${sale.id}`,\n              referenceNumber: `INV-${sale.id}`,\n              debitAmount: \"0\",\n              creditAmount: saleData.totalAmount.toString(),\n              runningBalance: (-parseFloat(saleData.totalAmount)).toString(),\n              transactionType: \"sale\",\n              relatedOrderId: null,\n              paymentMethod: saleData.paymentMethod,\n              createdBy: saleData.createdBy || \"system\",\n            });\n          } catch (ledgerError) {\n            console.warn(\"Could not create ledger transaction:\", ledgerError);\n            // Continue with sale creation even if ledger fails\n          }\n        }\n\n        // Update customer balance and totals\n        if (customerId) {\n          const customer = await tx\n            .select()\n            .from(customers)\n            .where(eq(customers.id, customerId))\n            .limit(1);\n\n          if (customer.length > 0) {\n            const currentBalance = parseFloat(\n              customer[0]?.currentBalance || \"0\",\n            );\n            const saleAmount = parseFloat(saleData.totalAmount);\n            const isCompleted = saleData.status === \"completed\";\n            const balanceChange = isCompleted ? -saleAmount : saleAmount;\n            const runningBalance = currentBalance + balanceChange;\n\n            await tx\n              .update(customers)\n              .set({\n                currentBalance: runningBalance.toString(),\n                totalOrders: customer[0].totalOrders + 1,\n                totalSpent: (\n                  parseFloat(customer[0].totalSpent || \"0\") + saleAmount\n                ).toString(),\n                updatedAt: new Date(),\n              })\n              .where(eq(customers.id, customerId));\n          }\n        }\n\n        console.log(\"‚úÖ Sale created with customer transaction successfully\");\n        return sale;\n      });\n    } catch (error) {\n      console.error(\"‚ùå Error creating sale with transaction:\", error);\n      throw error;\n    }\n  }\n\n  // Branch Management methods\n  async getBranches(): Promise<Branch[]> {\n    try {\n      const result = await this.db\n        .select()\n        .from(branches)\n        .where(eq(branches.isActive, true))\n        .orderBy(asc(branches.name));\n\n      console.log(`‚úÖ Found ${result.length} active branches`);\n      return result;\n    } catch (error) {\n      console.error(\"‚ùå Error fetching branches:\", error);\n      throw error;\n    }\n  }\n\n  async createBranch(branchData: InsertBranch): Promise<Branch> {\n    try {\n      const [newBranch] = await this.db\n        .insert(branches)\n        .values({\n          ...branchData,\n          createdAt: new Date(),\n          updatedAt: new Date(),\n        })\n        .returning();\n\n      console.log(`‚úÖ Created branch: ${newBranch.name}`);\n      return newBranch;\n    } catch (error) {\n      console.error(\"‚ùå Error creating branch:\", error);\n      throw error;\n    }\n  }\n\n  async updateBranch(\n    id: number,\n    branchData: Partial<InsertBranch>,\n  ): Promise<Branch> {\n    try {\n      const [updatedBranch] = await this.db\n        .update(branches)\n        .set({\n          ...branchData,\n          updatedAt: new Date(),\n        })\n        .where(eq((branches.id, id)).returning());\n\n      if (!updatedBranch) {\n        throw new Error(\"Branch not found\");\n      }\n\n      console.log(`‚úÖ Updated branch: ${updatedBranch.name}`);\n      return updatedBranch;\n    } catch (error) {\n      console.error(\"‚ùå Error updating branch:\", error);\n      throw error;\n    }\n  }\n\n  async deleteBranch(id: number): Promise<void> {\n    try {\n      // Check if this is the head office\n      const branch = await this.db\n        .select()\n        .from(branches)\n        .where(eq(branches.id, id))\n        .limit(1);\n\n      if (branch.length > 0 && branch[0].isHeadOffice) {\n        throw new Error(\"Cannot delete head office branch\");\n      }\n\n      // Soft delete: Deactivate the branch\n      await this.db\n        .update(branches)\n        .set({ isActive: false, updatedAt: new Date() })\n        .where(eq(branches.id, id));\n\n      console.log(`‚úÖ Deactivated branch ID: ${id}`);\n    } catch (error) {\n      console.error(\"‚ùå Error deleting branch:\", error);\n      throw error;\n    }\n  }\n\n  async assignUserToBranch(userId: string, branchId: number): Promise<void> {\n    try {\n      await this.db\n        .update(users)\n        .set({ branchId, updatedAt: new Date() })\n        .where(eq(users.id, userId));\n\n      console.log(`‚úÖ Assigned user ${userId} to branch ${branchId}`);\n    } catch (error) {\n      console.error(\"‚ùå Error assigning user to branch:\", error);\n      throw error;\n    }\n  }\n\n  async getUsersWithBranches(): Promise<any[]> {\n    try {\n      const result = await this.db\n        .select({\n          id: users.id,\n          email: users.email,\n          firstName: users.firstName,\n          lastName: users.lastName,\n          role: users.role,\n          branchId: users.branchId,\n          canAccessAllBranches: users.canAccessAllBranches,\n          branchName: branches.name,\n          branchCode: branches.branchCode,\n        })\n        .from(users)\n        .leftJoin(branches, eq(users.branchId, branches.id))\n        .orderBy(users.firstName);\n\n      console.log(`‚úÖ Found ${result.length} users with branch info`);\n      return result;\n    } catch (error) {\n      console.error(\"‚ùå Error fetching users with branches:\", error);\n      throw error;\n    }\n  }\n\n  // Pricing Management methods\n  async getSystemPrice(): Promise<number> {\n    try {\n      const priceSetting = await this.db\n        .select()\n        .from(settings)\n        .where(eq(settings.key, \"system_price\"))\n        .limit(1);\n\n      if (priceSetting.length > 0) {\n        const price = parseFloat(priceSetting[0].value);\n        return !isNaN(price) ? price : 299.99; // Default fallback\n      }\n\n      // Create default price if doesn't exist\n      await this.updateOrCreateSetting(\"system_price\", \"299.99\");\n      return 299.99;\n    } catch (error) {\n      console.error(\"Error fetching system price:\", error);\n      return 299.99; // Fallback price\n    }\n  }\n\n  async updateSystemPrice(price: number): Promise<void> {\n    try {\n      if (isNaN(price) || price <= 0) {\n        throw new Error(\"Invalid price value\");\n      }\n\n      await this.updateOrCreateSetting(\"system_price\", price.toString());\n      console.log(`‚úÖ System price updated to: ${price}`);\n    } catch (error) {\n      console.error(\"Error updating system price:\", error);\n      throw error;\n    }\n  }\n\n  async getPricingSettings(): Promise<any> {\n    try {\n      const pricingKeys = [\n        \"system_price\",\n        \"system_price_currency\",\n        \"system_price_description\",\n        \"pricing_display_enabled\",\n      ];\n\n      const pricingSettings = await this.db\n        .select()\n        .from(settings)\n        .where(sql`${settings.key} IN ${pricingKeys}`);\n\n      const result = {\n        systemPrice: 299.99,\n        currency: \"USD\",\n        description: \"Complete Bakery Management System\",\n        displayEnabled: true,\n      };\n\n      pricingSettings.forEach((setting) => {\n        switch (setting.key) {\n          case \"system_price\":\n            const price = parseFloat(setting.value);\n            result.systemPrice = !isNaN(price) ? price : 299.99;\n            break;\n          case \"system_price_currency\":\n            result.currency = setting.value || \"USD\";\n            break;\n          case \"system_price_description\":\n            result.description =\n              setting.value || \"Complete Bakery Management System\";\n            break;\n          case \"pricing_display_enabled\":\n            result.displayEnabled = setting.value === \"true\";\n            break;\n        }\n      });\n\n      return result;\n    } catch (error) {\n      console.error(\"Error fetching pricing settings:\", error);\n      // Return defaults on error\n      return {\n        systemPrice: 299.99,\n        currency: \"USD\",\n        description: \"Complete Bakery Management System\",\n        displayEnabled: true,\n      };\n    }\n  }\n\n  async updatePricingSettings(pricingData: any): Promise<void> {\n    try {\n      const updates = [];\n\n      if (pricingData.systemPrice !== undefined) {\n        const price = parseFloat(pricingData.systemPrice);\n        if (isNaN(price) || price <= 0) {\n          throw new Error(\"Invalid system price value\");\n        }\n        updates.push(\n          this.updateOrCreateSetting(\"system_price\", price.toString()),\n        );\n      }\n\n      if (pricingData.currency !== undefined) {\n        updates.push(\n          this.updateOrCreateSetting(\n            \"system_price_currency\",\n            pricingData.currency,\n          ),\n        );\n      }\n\n      if (pricingData.description !== undefined) {\n        updates.push(\n          this.updateOrCreateSetting(\n            \"system_price_description\",\n            pricingData.description,\n          ),\n        );\n      }\n\n      if (pricingData.displayEnabled !== undefined) {\n        updates.push(\n          this.updateOrCreateSetting(\n            \"pricing_display_enabled\",\n            pricingData.displayEnabled.toString(),\n          ),\n        );\n      }\n\n      await Promise.all(updates);\n      console.log(\"‚úÖ Pricing settings updated successfully\");\n    } catch (error) {\n      console.error(\"Error updating pricing settings:\", error);\n      throw error;\n    }\n  }\n\n  // Sales Returns Management\n  async getSalesReturns(date?: string): Promise<any[]> {\n    try {\n      console.log(\"üì¶ Fetching sales returns...\");\n\n      let query = this.db.select().from(salesReturns);\n\n      if (date) {\n        query = query.where(eq(salesReturns.returnDate, date));\n      }\n\n      const returns = await query.orderBy(salesReturns.serialNumber);\n      console.log(`‚úÖ Found ${returns.length} sales returns`);\n      return returns;\n    } catch (error: any) {\n      console.error(\"‚ùå Error fetching sales returns:\", error);\n      throw new Error(`Failed to fetch sales returns: ${error.message}`);\n    }\n  }\n\n  async createSalesReturn(data: any): Promise<any> {\n    try {\n      console.log(\"üíæ Creating sales return entry...\");\n\n      // Get next serial number for the day\n      const existingToday = await this.db\n        .select({ count: sql<number>`count(*)` })\n        .from(salesReturns)\n        .where(eq(salesReturns.returnDate, data.returnDate));\n\n      const nextSerialNumber = (existingToday[0]?.count || 0) + 1;\n\n      const amount = parseFloat(data.quantity) * parseFloat(data.ratePerUnit);\n\n      const salesReturnData = {\n        serialNumber: nextSerialNumber,\n        productId: parseInt(data.productId),\n        productName: data.productName,\n        quantity: data.quantity,\n        unitId: parseInt(data.unitId),\n        unitName: data.unitName,\n        ratePerUnit: data.ratePerUnit,\n        amount: amount.toString(),\n        returnDate: data.returnDate,\n        saleId: data.saleId || null, // Reference to original sale\n        customerId: data.customerId || null, // Reference to customer\n        returnReason: data.returnReason || \"damaged\",\n        notes: data.notes || null,\n        createdBy: data.createdBy || \"system\",\n        isDayClosed: false, // Default to not closed\n      };\n\n      const result = await this.db\n        .insert(salesReturns)\n        .values(salesReturnData)\n        .returning();\n\n      // Update daily summary\n      await this.updateDailySalesReturnSummary(data.returnDate);\n\n      console.log(\"‚úÖ Sales return created successfully\");\n      return result[0];\n    } catch (error: any) {\n      console.error(\"‚ùå Error creating sales return:\", error);\n      throw error;\n    }\n  }\n\n  async updateSalesReturn(id: number, data: any): Promise<any> {\n    try {\n      console.log(\"üíæ Updating sales return:\", id);\n\n      // Recalculate amount if quantity or rate changed\n      const updateData = { ...data };\n      if (data.quantity && data.ratePerUnit) {\n        const current = await this.db\n          .select()\n          .from(salesReturns)\n          .where(eq(salesReturns.id, id))\n          .limit(1);\n\n        if (current.length > 0) {\n          const item = current[0];\n          const quantity = data.quantity\n            ? parseFloat(data.quantity)\n            : parseFloat(item.quantity);\n          const rate = data.ratePerUnit\n            ? parseFloat(data.ratePerUnit)\n            : parseFloat(item.ratePerUnit);\n          updateData.amount = (quantity * rate).toString();\n        }\n      }\n\n      const result = await this.db\n        .update(salesReturns)\n        .set({ ...updateData, updatedAt: new Date() })\n        .where(eq(salesReturns.id, id))\n        .returning();\n\n      // Update daily summary if date-related data changed\n      if (result.length > 0) {\n        await this.updateDailySalesReturnSummary(result[0].returnDate);\n      }\n\n      console.log(\"‚úÖ Sales return updated successfully\");\n      return result[0];\n    } catch (error: any) {\n      console.error(\"‚ùå Error updating sales return:\", error);\n      throw error;\n    }\n  }\n\n  async deleteSalesReturn(id: number): Promise<any> {\n    try {\n      console.log(\"üóëÔ∏è Deleting sales return:\", id);\n\n      // Get the return to know which date to update summary for\n      const salesReturn = await this.db\n        .select({ returnDate: salesReturns.returnDate })\n        .from(salesReturns)\n        .where(eq(salesReturns.id, id))\n        .limit(1);\n\n      const [deletedReturn] = await this.db\n        .delete(salesReturns)\n        .where(eq(salesReturns.id, id))\n        .returning();\n\n      // Update daily summary\n      if (deletedReturn) {\n        await this.updateDailySalesReturnSummary(deletedReturn.returnDate);\n      }\n\n      console.log(\"‚úÖ Sales return deleted successfully\");\n      return deletedReturn;\n    } catch (error: any) {\n      console.error(\"‚ùå Error deleting sales return:\", error);\n      throw error;\n    }\n  }\n\n  async getDailySalesReturnSummary(date: string): Promise<any> {\n    try {\n      console.log(`üìä Fetching daily sales return summary for ${date}...`);\n\n      const [summary] = await this.db\n        .select()\n        .from(dailySalesReturnSummary)\n        .where(eq(dailySalesReturnSummary.summaryDate, date))\n        .limit(1);\n\n      return summary || null;\n    } catch (error: any) {\n      console.error(\"‚ùå Error fetching daily sales return summary:\", error);\n      throw new Error(\n        `Failed to fetch daily sales return summary: ${error.message}`,\n      );\n    }\n  }\n\n  async updateDailySalesReturnSummary(date: string): Promise<void> {\n    try {\n      const returns = await this.db\n        .select()\n        .from(salesReturns)\n        .where(eq(salesReturns.returnDate, date));\n\n      const totalItems = returns.length;\n      const totalQuantity = returns.reduce(\n        (sum, item) => sum + parseFloat(item.quantity),\n        0,\n      );\n      const totalLoss = returns.reduce(\n        (sum, item) => sum + parseFloat(item.amount),\n        0,\n      );\n\n      const summaryData = {\n        summaryDate: date,\n        totalItems,\n        totalQuantity: totalQuantity.toString(),\n        totalLoss: totalLoss.toString(),\n        updatedAt: new Date(),\n      };\n\n      await this.db\n        .insert(dailySalesReturnSummary)\n        .values(summaryData)\n        .onConflictDoUpdate({\n          target: dailySalesReturnSummary.summaryDate,\n          set: summaryData,\n        });\n    } catch (error: any) {\n      console.error(\"‚ùå Error updating daily sales return summary:\", error);\n      throw new Error(\n        `Failed to update daily sales return summary: ${error.message}`,\n      );\n    }\n  }\n\n  async closeDaySalesReturn(date: string, closedBy: string): Promise<any> {\n    try {\n      console.log(`üîí Closing sales return day for ${date}...`);\n\n      await this.db\n        .update(salesReturns)\n        .set({ isDayClosed: true })\n        .where(eq(salesReturns.returnDate, date));\n\n      await this.db\n        .update(dailySalesReturnSummary)\n        .set({\n          isDayClosed: true,\n          closedBy,\n          closedAt: new Date(),\n        })\n        .where(eq(dailySalesReturnSummary.summaryDate, date));\n\n      console.log(\"‚úÖ Sales return day closed successfully\");\n      return await this.getDailySalesReturnSummary(date);\n    } catch (error: any) {\n      console.error(\"‚ùå Error closing sales return day:\", error);\n      throw new Error(`Failed to close sales return day: ${error.message}`);\n    }\n  }\n\n  async reopenDaySalesReturn(date: string): Promise<any> {\n    try {\n      console.log(`üîì Reopening sales return day for ${date}...`);\n\n      await this.db\n        .update(salesReturns)\n        .set({ isDayClosed: false })\n        .where(eq(salesReturns.returnDate, date));\n\n      await this.db\n        .update(dailySalesReturnSummary)\n        .set({\n          isDayClosed: false,\n          closedBy: null,\n          closedAt: null,\n        })\n        .where(eq(dailySalesReturnSummary.summaryDate, date));\n\n      console.log(\"‚úÖ Sales return day reopened successfully\");\n      return await this.getDailySalesReturnSummary(date);\n    } catch (error: any) {\n      console.error(\"‚ùå Error reopening sales return day:\", error);\n      throw new Error(`Failed to reopen sales return day: ${error.message}`);\n    }\n  }\n\n  // Purchase Returns Methods\n  async getPurchaseReturns(date?: string): Promise<any[]> {\n    try {\n      console.log(\"üì¶ Fetching purchase returns...\");\n\n      let query = this.db.select().from(purchaseReturns);\n\n      if (date) {\n        query = query.where(eq(purchaseReturns.returnDate, date));\n      }\n\n      const returns = await query.orderBy(purchaseReturns.serialNumber);\n      console.log(`‚úÖ Found ${returns.length} purchase returns`);\n      return returns;\n    } catch (error: any) {\n      console.error(\"‚ùå Error fetching purchase returns:\", error);\n      throw new Error(`Failed to fetch purchase returns: ${error.message}`);\n    }\n  }\n\n  async createPurchaseReturn(data: any): Promise<any> {\n    try {\n      console.log(\"üíæ Creating purchase return entry...\");\n\n      // Get next serial number for the date\n      const existingReturns = await this.db\n        .select({ serialNumber: purchaseReturns.serialNumber })\n        .from(purchaseReturns)\n        .where(eq(purchaseReturns.returnDate, data.returnDate))\n        .orderBy(desc(purchaseReturns.serialNumber))\n        .limit(1);\n\n      const nextSerialNumber =\n        existingReturns.length > 0 ? existingReturns[0].serialNumber + 1 : 1;\n\n      const amount = parseFloat(data.quantity) * parseFloat(data.ratePerUnit);\n\n      const returnData = {\n        serialNumber: nextSerialNumber,\n        inventoryItemId: data.inventoryItemId,\n        inventoryItemName: data.inventoryItemName,\n        quantity: data.quantity.toString(),\n        unitId: data.unitId,\n        unitName: data.unitName,\n        ratePerUnit: data.ratePerUnit.toString(),\n        amount: amount.toString(),\n        returnDate: data.returnDate,\n        purchaseId: data.purchaseId || null,\n        partyId: data.partyId || null,\n        returnReason: data.returnReason || \"damaged\",\n        notes: data.notes || null,\n        createdBy: data.createdBy || \"system\",\n      };\n\n      const [result] = await this.db\n        .insert(purchaseReturns)\n        .values(returnData)\n        .returning();\n\n      // Update summary\n      await this.updateDailyPurchaseReturnSummary(data.returnDate);\n\n      console.log(\"‚úÖ Purchase return created successfully\");\n      return result;\n    } catch (error: any) {\n      console.error(\"‚ùå Error creating purchase return:\", error);\n      throw error;\n    }\n  }\n\n  async updatePurchaseReturn(id: number, data: any): Promise<any> {\n    try {\n      console.log(\"üíæ Updating purchase return:\", id);\n\n      const updateData = {\n        inventoryItemId: data.inventoryItemId,\n        inventoryItemName: data.inventoryItemName,\n        quantity: data.quantity?.toString(),\n        unitId: data.unitId,\n        unitName: data.unitName,\n        ratePerUnit: data.ratePerUnit?.toString(),\n        amount: (\n          parseFloat(data.quantity || 0) * parseFloat(data.ratePerUnit || 0)\n        ).toString(),\n        returnReason: data.returnReason,\n        partyId: data.partyId || null,\n        purchaseId: data.purchaseId || null,\n        notes: data.notes || null,\n        updatedAt: new Date(),\n      };\n\n      const [result] = await this.db\n        .update(purchaseReturns)\n        .set(updateData)\n        .where(eq(purchaseReturns.id, id))\n        .returning();\n\n      // Update summary\n      if (result) {\n        await this.updateDailyPurchaseReturnSummary(result.returnDate);\n      }\n\n      console.log(\"‚úÖ Purchase return updated successfully\");\n      return result;\n    } catch (error: any) {\n      console.error(\"‚ùå Error updating purchase return:\", error);\n      throw error;\n    }\n  }\n\n  async deletePurchaseReturn(id: number): Promise<any> {\n    try {\n      console.log(\"üóëÔ∏è Deleting purchase return:\", id);\n\n      // Get the return to know which date to update summary for\n      const purchaseReturn = await this.db\n        .select({ returnDate: purchaseReturns.returnDate })\n        .from(purchaseReturns)\n        .where(eq(purchaseReturns.id, id))\n        .limit(1);\n\n      const [deletedReturn] = await this.db\n        .delete(purchaseReturns)\n        .where(eq(purchaseReturns.id, id))\n        .returning();\n\n      // Update daily summary\n      if (deletedReturn) {\n        await this.updateDailyPurchaseReturnSummary(deletedReturn.returnDate);\n      }\n\n      console.log(\"‚úÖ Purchase return deleted successfully\");\n      return deletedReturn;\n    } catch (error: any) {\n      console.error(\"‚ùå Error deleting purchase return:\", error);\n      throw error;\n    }\n  }\n\n  async getDailyPurchaseReturnSummary(date: string): Promise<any> {\n    try {\n      console.log(`üìä Fetching daily purchase return summary for ${date}...`);\n\n      const [summary] = await this.db\n        .select()\n        .from(dailyPurchaseReturnSummary)\n        .where(eq(dailyPurchaseReturnSummary.summaryDate, date))\n        .limit(1);\n\n      return summary || null;\n    } catch (error: any) {\n      console.error(\"‚ùå Error fetching daily purchase return summary:\", error);\n      throw new Error(\n        `Failed to fetch daily purchase return summary: ${error.message}`,\n      );\n    }\n  }\n\n  async updateDailyPurchaseReturnSummary(date: string): Promise<void> {\n    try {\n      const returns = await this.db\n        .select()\n        .from(purchaseReturns)\n        .where(eq(purchaseReturns.returnDate, date));\n\n      const totalItems = returns.length;\n      const totalQuantity = returns.reduce(\n        (sum, item) => sum + parseFloat(item.quantity),\n        0,\n      );\n      const totalLoss = returns.reduce(\n        (sum, item) => sum + parseFloat(item.amount),\n        0,\n      );\n\n      const summaryData = {\n        summaryDate: date,\n        totalItems,\n        totalQuantity: totalQuantity.toString(),\n        totalLoss: totalLoss.toString(),\n        updatedAt: new Date(),\n      };\n\n      await this.db\n        .insert(dailyPurchaseReturnSummary)\n        .values(summaryData)\n        .onConflictDoUpdate({\n          target: dailyPurchaseReturnSummary.summaryDate,\n          set: summaryData,\n        });\n    } catch (error: any) {\n      console.error(\"‚ùå Error updating daily purchase return summary:\", error);\n      throw new Error(\n        `Failed to update daily purchase return summary: ${error.message}`,\n      );\n    }\n  }\n\n  async closeDayPurchaseReturn(date: string, closedBy: string): Promise<any> {\n    try {\n      console.log(`üîí Closing purchase return day for ${date}...`);\n\n      await this.db\n        .update(purchaseReturns)\n        .set({ isDayClosed: true })\n        .where(eq(purchaseReturns.returnDate, date));\n\n      await this.db\n        .update(dailyPurchaseReturnSummary)\n        .set({\n          isDayClosed: true,\n          closedBy,\n          closedAt: new Date(),\n        })\n        .where(eq(dailyPurchaseReturnSummary.summaryDate, date));\n\n      console.log(\"‚úÖ Purchase return day closed successfully\");\n      return await this.getDailyPurchaseReturnSummary(date);\n    } catch (error: any) {\n      console.error(\"‚ùå Error closing purchase return day:\", error);\n      throw new Error(`Failed to close purchase return day: ${error.message}`);\n    }\n  }\n\n  async reopenDayPurchaseReturn(date: string): Promise<any> {\n    try {\n      console.log(`üîì Reopening purchase return day for ${date}...`);\n\n      await this.db\n        .update(purchaseReturns)\n        .set({ isDayClosed: false })\n        .where(eq(purchaseReturns.returnDate, date));\n\n      await this.db\n        .update(dailyPurchaseReturnSummary)\n        .set({\n          isDayClosed: false,\n          closedBy: null,\n          closedAt: null,\n        })\n        .where(eq(dailyPurchaseReturnSummary.summaryDate, date));\n\n      console.log(\"‚úÖ Purchase return day reopened successfully\");\n      return await this.getDailyPurchaseReturnSummary(date);\n    } catch (error: any) {\n      console.error(\"‚ùå Error reopening purchase return day:\", error);\n      throw new Error(`Failed to reopen purchase return day: ${error.message}`);\n    }\n  }\n}\n\nexport const storage = new Storage();\n","path":null,"size_bytes":179009,"size_tokens":null},"client/src/hooks/usePermissions.ts":{"content":"\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport interface Permission {\n  id: number;\n  name: string;\n  resource: string;\n  action: string;\n  description?: string;\n  granted?: boolean;\n}\n\nexport function usePermissions() {\n  const { data: permissions = [], isLoading } = useQuery<Permission[]>({\n    queryKey: [\"/api/auth/permissions\"],\n  });\n\n  const hasPermission = (resource: string, action: 'read' | 'write' | 'read_write') => {\n    return (permissions as Permission[]).some((perm: Permission) => \n      perm.resource === resource && \n      (perm.action === action || perm.action === 'read_write')\n    );\n  };\n\n  const canRead = (resource: string) => hasPermission(resource, 'read');\n  const canWrite = (resource: string) => hasPermission(resource, 'write');\n  const canReadWrite = (resource: string) => hasPermission(resource, 'read_write');\n\n  return {\n    permissions,\n    isLoading,\n    hasPermission,\n    canRead,\n    canWrite,\n    canReadWrite,\n  };\n}\n\nexport function useAllPermissions() {\n  return useQuery({\n    queryKey: [\"/api/permissions\"],\n  });\n}\n\nexport function useRolePermissions(role: string) {\n  return useQuery<Permission[]>({\n    queryKey: [`/api/permissions/role/${role}`],\n    enabled: !!role,\n  });\n}\n\nexport function useUserPermissions(userId: string) {\n  return useQuery<Permission[]>({\n    queryKey: [`/api/permissions/user/${userId}`],\n    enabled: !!userId,\n  });\n}\n","path":null,"size_bytes":1457,"size_tokens":null},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}","path":null,"size_bytes":115,"size_tokens":null},"client/src/pages/system-config.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Settings, Database, Server, Shield } from \"lucide-react\";\nimport { ProtectedRoute } from \"@/components/protected-route\";\n\nexport default function SystemConfig() {\n  return (\n    <ProtectedRoute resource=\"system\" action=\"read_write\">\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div>\n            <p className=\"text-muted-foreground\">\n              Manage system-wide settings and configurations\n            </p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Database className=\"h-5 w-5\" />\n                Database Settings\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground\">\n                Configure database connections and performance settings\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Server className=\"h-5 w-5\" />\n                Server Configuration\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground\">\n                Manage server settings, ports, and environment variables\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Shield className=\"h-5 w-5\" />\n                Security Settings\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground\">\n                Configure authentication, authorization, and security policies\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </ProtectedRoute>\n  );\n}\n","path":null,"size_bytes":2119,"size_tokens":null},"client/src/components/recipe.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport {\n  Form,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { useUnits } from \"@/hooks/useUnits\";\nimport { Trash2, Plus, Calculator, Save, Package } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\n\nconst recipeSchema = z.object({\n  productName: z.string().min(1, \"Product name is required\"),\n  categoryId: z.string().optional(),\n  unitId: z.string().min(1, \"Unit is required\"),\n  batchSize: z.string().min(1, \"Batch size is required\").default(\"1\"),\n  finishedGoodRequired: z\n    .string()\n    .min(1, \"FG required is required\")\n    .default(\"1\"),\n  productionQuantity: z\n    .string()\n    .min(1, \"Production quantity is required\")\n    .default(\"1\"),\n  normalLossMfg: z.string().default(\"5\"),\n  normalLossOnSold: z.string().default(\"0\"),\n  mfgAndPackagingCost: z.string().default(\"45\"),\n  overheadCost: z.string().default(\"5\"),\n  ingredients: z\n    .array(\n      z.object({\n        inventoryItemId: z.string().min(1, \"Ingredient is required\"),\n        quantity: z.string().min(1, \"Quantity is required\"),\n        unitId: z.string().min(1, \"Unit is required\"),\n      }),\n    )\n    .min(1, \"At least one ingredient is required\"),\n});\n\ninterface RecipeProps {\n  product?: any;\n  onSave?: (productData: any) => void;\n}\n\nexport default function Recipe({ product, onSave }: RecipeProps) {\n  const [calculations, setCalculations] = useState({\n    ingredientDetails: [] as any[],\n    subTotalForBatch: 0,\n    totalForProduction: 0,\n    totalForProductionGm: 0,\n    effectiveUnits: 0,\n    rmCostPerUnit: 0,\n    noOfFgToBeProduced: 0,\n    normalLossDuringMFG: 0,\n    normalLossOnSoldValue: 0,\n    effectiveUnitsProduced: 0,\n    estimatedCostPerUnit: 0,\n    mfgCostPerUnit: 0,\n    overheadCostPerUnit: 0,\n    finalCostPerUnit: 0,\n  });\n\n  const { formatCurrency } = useCurrency();\n  const { toast } = useToast();\n\n  const { data: inventoryItems = [] } = useQuery({\n    queryKey: [\"/api/inventory\"],\n    queryFn: async () => {\n      try {\n        const response = await apiRequest(\"GET\", \"/api/inventory\");\n        if (response?.success && response?.data) {\n          return Array.isArray(response.data) ? response.data : [];\n        }\n        return Array.isArray(response) ? response : [];\n      } catch (error) {\n        console.error(\"Failed to fetch inventory:\", error);\n        return [];\n      }\n    },\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  const { data: units = [] } = useUnits();\n\n  const form = useForm({\n    resolver: zodResolver(recipeSchema),\n    defaultValues: {\n      productName: product?.name || \"\",\n      categoryId: product?.categoryId?.toString() || \"\",\n      unitId: product?.unitId?.toString() || \"\",\n      batchSize: product?.batchSize?.toString() || \"1\",\n      finishedGoodRequired: \"1\",\n      productionQuantity: \"1\",\n      normalLossMfg: \"5\",\n      normalLossOnSold: \"0\",\n      mfgAndPackagingCost: \"45\",\n      overheadCost: \"5\",\n      ingredients:\n        product?.ingredients?.length > 0\n          ? product.ingredients.map((ing: any) => ({\n              inventoryItemId: ing.inventoryItemId?.toString() || \"\",\n              quantity: ing.quantity?.toString() || \"\",\n              unitId: ing.unitId?.toString() || \"\",\n            }))\n          : [{ inventoryItemId: \"\", quantity: \"\", unitId: \"\" }],\n    },\n  });\n\n  // Filter items that are suitable as ingredients\n  const ingredients = Array.isArray(inventoryItems)\n    ? (inventoryItems as any[]).filter(\n        (item: any) =>\n          item?.name &&\n          (item.group === \"raw-materials\" ||\n            item.group === \"ingredients\" ||\n            item.group === \"flour\" ||\n            item.group === \"dairy\" ||\n            item.group === \"sweeteners\" ||\n            item.group === \"spices\" ||\n            item.group === \"leavening\" ||\n            item.group === \"extracts\" ||\n            item.group === \"chocolate\" ||\n            item.group === \"nuts\" ||\n            item.group === \"fruits\" ||\n            !item.group ||\n            item.name.toLowerCase().includes(\"flour\") ||\n            item.name.toLowerCase().includes(\"sugar\") ||\n            item.name.toLowerCase().includes(\"butter\") ||\n            item.name.toLowerCase().includes(\"milk\") ||\n            item.name.toLowerCase().includes(\"egg\") ||\n            item.name.toLowerCase().includes(\"chocolate\") ||\n            item.name.toLowerCase().includes(\"vanilla\") ||\n            item.name.toLowerCase().includes(\"salt\") ||\n            item.name.toLowerCase().includes(\"baking\")),\n      )\n    : [];\n\n  const { fields, append, remove } = useFieldArray({\n    control: form.control,\n    name: \"ingredients\",\n  });\n\n  const calculateCosts = () => {\n    try {\n      const formIngredients = form.getValues(\"ingredients\");\n      const batchSize = parseFloat(form.getValues(\"batchSize\") || \"1\");\n      const finishedGoodRequired = parseFloat(\n        form.getValues(\"finishedGoodRequired\") || \"1\",\n      );\n      const productionQuantity = parseFloat(\n        form.getValues(\"productionQuantity\") || \"1\",\n      );\n      const normalLossMfg = parseFloat(form.getValues(\"normalLossMfg\") || \"5\");\n      const normalLossOnSold = parseFloat(\n        form.getValues(\"normalLossOnSold\") || \"0\",\n      );\n      const mfgAndPackagingCost = parseFloat(\n        form.getValues(\"mfgAndPackagingCost\") || \"45\",\n      );\n      const overheadCost = parseFloat(form.getValues(\"overheadCost\") || \"5\");\n\n      // Calculate ingredient details with improved error handling\n      const ingredientDetails = formIngredients\n        .map((ingredient, index) => {\n          try {\n            const item = ingredients.find(\n              (inv: any) => inv.id?.toString() === ingredient.inventoryItemId,\n            );\n            if (item && ingredient.quantity && ingredient.unitId) {\n              const quantity = parseFloat(ingredient.quantity);\n              const selectedUnit = Array.isArray(units)\n                ? units.find((u: any) => u.id?.toString() === ingredient.unitId)\n                : null;\n              const unitAbbr =\n                selectedUnit?.abbreviation || item.unit || \"unit\";\n\n              // Get the inventory item's storage unit details\n              const inventoryUnit = Array.isArray(units)\n                ? units.find((u: any) => u.id === item.unitId)\n                : null;\n              const inventoryUnitAbbr =\n                inventoryUnit?.abbreviation || item.unit || \"unit\";\n\n              // Calculate proper price per selected unit with improved conversion\n              let pricePerSelectedUnit = parseFloat(item.costPerUnit || \"0\");\n              let amount = quantity * pricePerSelectedUnit;\n\n              // Handle unit conversion for cost calculation\n              if (\n                inventoryUnitAbbr.toLowerCase() === \"bag\" &&\n                unitAbbr.toLowerCase() !== \"bag\"\n              ) {\n                const bagToKgConversion = item.conversionRate\n                  ? parseFloat(item.conversionRate)\n                  : 50;\n                const pricePerKg = pricePerSelectedUnit / bagToKgConversion;\n\n                if (unitAbbr.toLowerCase() === \"kg\") {\n                  pricePerSelectedUnit = pricePerKg;\n                  amount = quantity * pricePerSelectedUnit;\n                } else if (\n                  unitAbbr.toLowerCase() === \"g\" ||\n                  unitAbbr.toLowerCase() === \"gm\"\n                ) {\n                  pricePerSelectedUnit = pricePerKg / 1000;\n                  amount = quantity * pricePerSelectedUnit;\n                }\n              } else if (\n                inventoryUnitAbbr.toLowerCase() === \"kg\" &&\n                unitAbbr.toLowerCase() === \"g\"\n              ) {\n                pricePerSelectedUnit = pricePerSelectedUnit / 1000;\n                amount = quantity * pricePerSelectedUnit;\n              } else if (\n                inventoryUnitAbbr.toLowerCase() === \"g\" &&\n                unitAbbr.toLowerCase() === \"kg\"\n              ) {\n                pricePerSelectedUnit = pricePerSelectedUnit * 1000;\n                amount = quantity * pricePerSelectedUnit;\n              }\n\n              return {\n                sn: index + 1,\n                particular: item.name,\n                qty: quantity,\n                unit: unitAbbr,\n                price: pricePerSelectedUnit,\n                unitType: `Per ${unitAbbr}`,\n                amount: amount,\n              };\n            }\n            return null;\n          } catch (error) {\n            console.error(\"Error calculating ingredient:\", error);\n            return null;\n          }\n        })\n        .filter(Boolean);\n\n      // Sub-total for batch\n      const subTotalForBatch = ingredientDetails.reduce(\n        (sum, item) => sum + (item?.amount || 0),\n        0,\n      );\n\n      // Scale factor for production\n      const scaleFactor = productionQuantity / batchSize;\n      const totalForProduction = subTotalForBatch * scaleFactor;\n\n      // Total weight in grams with improved conversion\n      const totalForProductionGm = ingredientDetails.reduce((sum, item) => {\n        if (!item) return sum;\n\n        let qtyInGrams = item.qty;\n\n        switch (item.unit.toLowerCase()) {\n          case \"kg\":\n            qtyInGrams = item.qty * 1000;\n            break;\n          case \"g\":\n          case \"gm\":\n          case \"grams\":\n            qtyInGrams = item.qty;\n            break;\n          case \"ml\":\n          case \"milliliters\":\n            qtyInGrams = item.qty;\n            break;\n          case \"l\":\n          case \"ltr\":\n          case \"liters\":\n            qtyInGrams = item.qty * 1000;\n            break;\n          case \"bag\":\n            qtyInGrams = item.qty * 50000;\n            break;\n          default:\n            qtyInGrams = item.qty;\n        }\n\n        return sum + qtyInGrams * scaleFactor;\n      }, 0);\n\n      // No. of FG to be produced\n      const noOfFgToBeProduced =\n        finishedGoodRequired > 0\n          ? totalForProductionGm / finishedGoodRequired\n          : 0;\n\n      // Loss values in units\n      const normalLossDuringMFG = noOfFgToBeProduced * (normalLossMfg / 100);\n      const normalLossOnSoldValue =\n        noOfFgToBeProduced * (normalLossOnSold / 100);\n\n      // Effective units produced after losses\n      const effectiveUnitsProduced =\n        noOfFgToBeProduced - normalLossDuringMFG - normalLossOnSoldValue;\n\n      // Cost per unit calculations\n      const estimatedCostPerUnit =\n        effectiveUnitsProduced > 0\n          ? subTotalForBatch / effectiveUnitsProduced\n          : 0;\n      const mfgCostPerUnit = estimatedCostPerUnit * (mfgAndPackagingCost / 100);\n      const overheadCostPerUnit = estimatedCostPerUnit * (overheadCost / 100);\n      const finalCostPerUnit =\n        estimatedCostPerUnit + mfgCostPerUnit + overheadCostPerUnit;\n\n      setCalculations({\n        ingredientDetails,\n        subTotalForBatch,\n        totalForProduction,\n        totalForProductionGm,\n        effectiveUnits: totalForProductionGm,\n        rmCostPerUnit: finishedGoodRequired * 350,\n        noOfFgToBeProduced,\n        normalLossDuringMFG,\n        normalLossOnSoldValue,\n        effectiveUnitsProduced,\n        estimatedCostPerUnit,\n        mfgCostPerUnit,\n        overheadCostPerUnit,\n        finalCostPerUnit,\n      });\n    } catch (error) {\n      console.error(\"Error in cost calculation:\", error);\n    }\n  };\n\n  // Fetch product ingredients if editing\n  const { data: productIngredients = [] } = useQuery({\n    queryKey: [\"/api/products\", product?.id, \"ingredients\"],\n    queryFn: async () => {\n      if (!product?.id) return [];\n      try {\n        const response = await apiRequest(\n          \"GET\",\n          `/api/products/${product.id}/ingredients`,\n        );\n        return response || [];\n      } catch (error) {\n        console.error(\"Error fetching product ingredients:\", error);\n        return [];\n      }\n    },\n    enabled: !!product?.id,\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  // Reset form when product changes\n  useEffect(() => {\n    if (product) {\n      const hasIngredients =\n        productIngredients && productIngredients.length > 0;\n\n      form.reset({\n        productName: product.name || \"\",\n        categoryId: product.categoryId?.toString() || \"\",\n        unitId: product.unitId?.toString() || \"\",\n        batchSize: product.batchSize?.toString() || \"1\",\n        finishedGoodRequired: \"1\",\n        productionQuantity: \"1\",\n        normalLossMfg: \"5\",\n        normalLossOnSold: \"0\",\n        mfgAndPackagingCost: \"45\",\n        overheadCost: \"5\",\n        ingredients: hasIngredients\n          ? productIngredients.map((ing: any) => ({\n              inventoryItemId: ing.inventoryItemId?.toString() || \"\",\n              quantity: ing.quantity?.toString() || \"\",\n              unitId: ing.unitId?.toString() || \"\",\n            }))\n          : [{ inventoryItemId: \"\", quantity: \"\", unitId: \"\" }],\n      });\n    }\n  }, [product, productIngredients, form]);\n\n  useEffect(() => {\n    calculateCosts();\n  }, [form.watch()]);\n\n  const handleSaveProduct = async () => {\n    try {\n      const formData = form.getValues();\n\n      // Validate required fields\n      if (!formData.productName || formData.productName.trim().length === 0) {\n        toast({\n          title: \"Validation Error\",\n          description: \"Product name is required\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      if (!formData.unitId) {\n        toast({\n          title: \"Validation Error\",\n          description: \"Product unit is required\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Validate ingredients\n      const validIngredients =\n        formData.ingredients?.filter(\n          (ing) => ing.inventoryItemId && ing.quantity && ing.unitId,\n        ) || [];\n\n      if (validIngredients.length === 0) {\n        toast({\n          title: \"Validation Error\",\n          description: \"At least one valid ingredient is required\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Prepare product data for API\n      const productData = {\n        name: formData.productName.trim(),\n        description: formData.description || \"\",\n        categoryId: formData.categoryId ? parseInt(formData.categoryId) : null,\n        unitId: parseInt(formData.unitId),\n        price: calculations.finalCostPerUnit.toFixed(2),\n        cost: calculations.estimatedCostPerUnit.toFixed(2),\n        margin: (\n          calculations.finalCostPerUnit - calculations.estimatedCostPerUnit\n        ).toFixed(2),\n        sku: formData.sku?.trim() || null, // Use null instead of empty string to avoid unique constraint violation\n        batchSize: parseFloat(formData.batchSize),\n        isActive: true,\n        isRecipe: true, // Mark as a recipe product\n      };\n\n      // Prepare ingredients data\n      const ingredientsData = validIngredients.map((ing) => ({\n        inventoryItemId: parseInt(ing.inventoryItemId),\n        quantity: parseFloat(ing.quantity),\n        unitId: parseInt(ing.unitId),\n      }));\n\n      // Save product with ingredients\n      const savedProduct = await apiRequest(\n        product ? \"PUT\" : \"POST\",\n        product ? `/api/products/${product.id}` : \"/api/products\",\n        {\n          ...productData,\n          ingredients: ingredientsData,\n        },\n      );\n\n      // Invalidate queries to refresh data\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products/paginated\"] });\n\n      toast({\n        title: \"Success\",\n        description: product\n          ? `Recipe \"${formData.productName}\" updated successfully`\n          : `Recipe \"${formData.productName}\" created successfully as a product`,\n      });\n\n      // Call the onSave callback if provided\n      onSave?.(savedProduct);\n    } catch (error) {\n      console.error(\"Error saving product:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to save recipe as product. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"space-y-8\">\n      <Form {...form}>\n        <form className=\"space-y-8\">\n          {/* Product Information */}\n          <Card className=\"border-l-4 border-l-blue-500\">\n            <CardHeader className=\"bg-gradient-to-r from-blue-50 to-indigo-50\">\n              <CardTitle className=\"flex items-center gap-2\">\n                <Package className=\"h-5 w-5 text-blue-600\" />\n                Recipe Information\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"pt-6 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <FormField\n                  control={form.control}\n                  name=\"productName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-semibold\">\n                        Product Name\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"e.g., Artisan Bread\"\n                          className=\"h-11\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"unitId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-semibold\">\n                        Product Unit\n                      </FormLabel>\n                      <Select\n                        onValueChange={field.onChange}\n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger className=\"h-11\">\n                            <SelectValue placeholder=\"Select unit\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {Array.isArray(units) &&\n                            units\n                              .filter((unit: any) => unit.isActive)\n                              .map((unit: any) => (\n                                <SelectItem\n                                  key={unit.id}\n                                  value={unit.id.toString()}\n                                >\n                                  {unit.name} ({unit.abbreviation})\n                                </SelectItem>\n                              ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Ingredients - Enhanced Table */}\n          <Card className=\"border-l-4 border-l-green-500\">\n            <CardHeader className=\"bg-gradient-to-r from-green-50 to-emerald-50\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Package className=\"h-5 w-5 text-green-600\" />\n                  Recipe Ingredients\n                </CardTitle>\n                <Badge variant=\"outline\" className=\"bg-white\">\n                  {fields.length} ingredient{fields.length !== 1 ? \"s\" : \"\"}\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"overflow-x-auto\">\n                <div className=\"min-w-full bg-white rounded-lg\">\n                  {/* Table Header */}\n                  <div className=\"grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b font-semibold text-sm text-gray-700\">\n                    <div className=\"col-span-1 text-center\">S.N</div>\n                    <div className=\"col-span-4\">Ingredient Name</div>\n                    <div className=\"col-span-2\">Quantity</div>\n                    <div className=\"col-span-3\">Unit</div>\n                    <div className=\"col-span-2 text-center\">Actions</div>\n                  </div>\n\n                  {/* Table Body */}\n                  <div className=\"divide-y divide-gray-100\">\n                    {fields.map((field, index) => (\n                      <div\n                        key={field.id}\n                        className=\"grid grid-cols-12 gap-4 p-4 hover:bg-gray-50 transition-colors\"\n                      >\n                        {/* Serial Number */}\n                        <div className=\"col-span-1 flex items-center justify-center\">\n                          <Badge\n                            variant=\"secondary\"\n                            className=\"w-8 h-8 rounded-full flex items-center justify-center\"\n                          >\n                            {index + 1}\n                          </Badge>\n                        </div>\n\n                        {/* Ingredient Select */}\n                        <div className=\"col-span-4\">\n                          <FormField\n                            control={form.control}\n                            name={`ingredients.${index}.inventoryItemId`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <Select\n                                  onValueChange={field.onChange}\n                                  value={field.value}\n                                >\n                                  <FormControl>\n                                    <SelectTrigger className=\"h-11\">\n                                      <SelectValue placeholder=\"Select ingredient\" />\n                                    </SelectTrigger>\n                                  </FormControl>\n                                  <SelectContent>\n                                    {ingredients.map((item: any) => (\n                                      <SelectItem\n                                        key={item.id}\n                                        value={item.id.toString()}\n                                      >\n                                        <div className=\"flex flex-col\">\n                                          <span className=\"font-medium\">\n                                            {item.name}\n                                          </span>\n                                          <span className=\"text-xs text-gray-500\">\n                                            {formatCurrency(item.costPerUnit)}/\n                                            {item.unit}\n                                          </span>\n                                        </div>\n                                      </SelectItem>\n                                    ))}\n                                  </SelectContent>\n                                </Select>\n                                <FormMessage className=\"text-xs\" />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n\n                        {/* Quantity Input */}\n                        <div className=\"col-span-2\">\n                          <FormField\n                            control={form.control}\n                            name={`ingredients.${index}.quantity`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormControl>\n                                  <Input\n                                    type=\"number\"\n                                    step=\"0.01\"\n                                    placeholder=\"0.00\"\n                                    className=\"h-11\"\n                                    {...field}\n                                  />\n                                </FormControl>\n                                <FormMessage className=\"text-xs\" />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n\n                        {/* Unit Select */}\n                        <div className=\"col-span-3\">\n                          <FormField\n                            control={form.control}\n                            name={`ingredients.${index}.unitId`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <Select\n                                  onValueChange={field.onChange}\n                                  value={field.value}\n                                >\n                                  <FormControl>\n                                    <SelectTrigger className=\"h-11\">\n                                      <SelectValue placeholder=\"Unit\" />\n                                    </SelectTrigger>\n                                  </FormControl>\n                                  <SelectContent>\n                                    {Array.isArray(units) &&\n                                      units\n                                        .filter((unit: any) => unit.isActive)\n                                        .map((unit: any) => (\n                                          <SelectItem\n                                            key={unit.id}\n                                            value={unit.id.toString()}\n                                          >\n                                            {unit.name} ({unit.abbreviation})\n                                          </SelectItem>\n                                        ))}\n                                  </SelectContent>\n                                </Select>\n                                <FormMessage className=\"text-xs\" />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n\n                        {/* Actions */}\n                        <div className=\"col-span-2 flex items-center justify-center\">\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => remove(index)}\n                            disabled={fields.length === 1}\n                            className=\"h-9 w-9 p-0 text-red-600 hover:text-red-700 hover:bg-red-50\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n\n                  {/* Add Ingredient Button */}\n                  <div className=\"p-4 border-t bg-gray-50/50\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() =>\n                        append({\n                          inventoryItemId: \"\",\n                          quantity: \"\",\n                          unitId: \"\",\n                        })\n                      }\n                      className=\"w-full h-11 border-dashed border-2 hover:bg-green-50\"\n                    >\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Add Ingredient\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Production Parameters */}\n          <Card className=\"border-l-4 border-l-purple-500\">\n            <CardHeader className=\"bg-gradient-to-r from-purple-50 to-violet-50\">\n              <CardTitle className=\"flex items-center gap-2\">\n                <Calculator className=\"h-5 w-5 text-purple-600\" />\n                Production Parameters\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"pt-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <FormField\n                  control={form.control}\n                  name=\"batchSize\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-semibold\">\n                        Batch Size (kg)\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          className=\"h-11\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"finishedGoodRequired\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-semibold\">\n                        1 unit FG required (Gm RM)\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          className=\"h-11\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"normalLossMfg\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-semibold\">\n                        Normal Loss during mfg. (%)\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.1\"\n                          className=\"h-11\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"normalLossOnSold\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-semibold\">\n                        Normal Loss on sold FG (%)\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.1\"\n                          className=\"h-11\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"mfgAndPackagingCost\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-semibold\">\n                        Mfg. and packaging cost (%)\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.1\"\n                          className=\"h-11\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"overheadCost\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-semibold\">\n                        Overhead cost (%)\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.1\"\n                          className=\"h-11\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n            </CardContent>\n          </Card>\n        </form>\n      </Form>\n\n      {/* Enhanced Cost Breakdown */}\n      <Card className=\"border-l-4 border-l-orange-500\">\n        <CardHeader className=\"bg-gradient-to-r from-orange-50 to-amber-50\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Calculator className=\"h-5 w-5 text-orange-600\" />\n            {product ? \"Edit Recipe\" : \"Recipe\"}:{\" \"}\n            {form.getValues(\"productName\") || \"Untitled Recipe\"}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"pt-6\">\n          {/* Computation of Total Cost */}\n          <div className=\"mb-8\">\n            <h3 className=\"text-lg font-semibold mb-4 text-gray-800\">\n              Computation of Total Cost\n            </h3>\n            <div className=\"overflow-x-auto rounded-lg border\">\n              <table className=\"w-full bg-white\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">\n                      S.N\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">\n                      Particulars\n                    </th>\n                    <th className=\"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider\">\n                      Qty.\n                    </th>\n                    <th className=\"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider\">\n                      Unit\n                    </th>\n                    <th className=\"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider\">\n                      Price\n                    </th>\n                    <th className=\"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider\">\n                      Unit\n                    </th>\n                    <th className=\"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider\">\n                      Amount\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-gray-200\">\n                  {calculations.ingredientDetails.map((item, index) => (\n                    <tr key={index} className=\"hover:bg-gray-50\">\n                      <td className=\"px-4 py-3 text-sm text-center\">\n                        {item.sn}\n                      </td>\n                      <td className=\"px-4 py-3 text-sm font-medium text-gray-900\">\n                        {item.particular}\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-right\">\n                        {item.qty?.toFixed(2)}\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-center\">\n                        <Badge variant=\"outline\">{item.unit}</Badge>\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-right\">\n                        {formatCurrency(item.price)}\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-center text-gray-600\">\n                        {item.unitType}\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-right font-medium\">\n                        {formatCurrency(item.amount)}\n                      </td>\n                    </tr>\n                  ))}\n                  <tr className=\"bg-yellow-50 border-t-2 border-yellow-200\">\n                    <td className=\"px-4 py-3 text-sm font-bold text-center\">\n                      A.\n                    </td>\n                    <td className=\"px-4 py-3 text-sm font-bold\">\n                      Total for {form.getValues(\"batchSize\")} kg\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-right font-medium\">\n                      {calculations.totalForProductionGm.toFixed(1)}\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-center\">\n                      <Badge variant=\"secondary\">gm</Badge>\n                    </td>\n                    <td className=\"px-4 py-3\"></td>\n                    <td className=\"px-4 py-3\"></td>\n                    <td className=\"px-4 py-3 text-sm text-right font-bold text-green-700\">\n                      {formatCurrency(calculations.subTotalForBatch ?? 0)}\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n          {/* Computation of Effective Unit */}\n          <div className=\"mb-8\">\n            <h3 className=\"text-lg font-semibold mb-4 text-gray-800\">\n              Computation of Effective Unit\n            </h3>\n            <div className=\"overflow-x-auto rounded-lg border\">\n              <table className=\"w-full bg-white\">\n                <tbody className=\"divide-y divide-gray-200\">\n                  <tr className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-3 text-sm w-12\">1</td>\n                    <td className=\"px-4 py-3 text-sm\">\n                      Total for {form.getValues(\"batchSize\")} kg\n                    </td>\n                    <td\n                      className=\"px-4 py-3 text-sm text-right font-medium\"\n                      colSpan={4}\n                    >\n                      {calculations.totalForProductionGm.toFixed(1)} gm\n                    </td>\n                  </tr>\n                  <tr className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-3 text-sm\">2</td>\n                    <td className=\"px-4 py-3 text-sm\">\n                      1 unit FG required ..... Gm RM\n                    </td>\n                    <td\n                      className=\"px-4 py-3 text-sm text-right font-medium\"\n                      colSpan={4}\n                    >\n                      {form.getValues(\"finishedGoodRequired\")} gm\n                    </td>\n                  </tr>\n                  <tr className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-3 text-sm\">3</td>\n                    <td className=\"px-4 py-3 text-sm\">\n                      No. of FG to be Produced\n                    </td>\n                    <td\n                      className=\"px-4 py-3 text-sm text-right font-medium\"\n                      colSpan={4}\n                    >\n                      {calculations.noOfFgToBeProduced.toFixed(2)} pcs\n                    </td>\n                  </tr>\n                  <tr className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-3 text-sm\">4</td>\n                    <td className=\"px-4 py-3 text-sm\">\n                      Less: Normal Loss during mfg.\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-right\">\n                      {form.getValues(\"normalLossMfg\")}%\n                    </td>\n                    <td\n                      className=\"px-4 py-3 text-sm text-right font-medium\"\n                      colSpan={3}\n                    >\n                      {calculations.normalLossDuringMFG.toFixed(2)} pcs\n                    </td>\n                  </tr>\n                  <tr className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-3 text-sm\">5</td>\n                    <td className=\"px-4 py-3 text-sm\">\n                      Less: Normal Loss on sold FG\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-right\">\n                      {form.getValues(\"normalLossOnSold\")}%\n                    </td>\n                    <td\n                      className=\"px-4 py-3 text-sm text-right font-medium\"\n                      colSpan={3}\n                    >\n                      {calculations.normalLossOnSoldValue.toFixed(2)} pcs\n                    </td>\n                  </tr>\n                  <tr className=\"bg-yellow-50 border-t-2 border-yellow-200\">\n                    <td className=\"px-4 py-3 text-sm font-bold\">B.</td>\n                    <td className=\"px-4 py-3 text-sm font-bold\">\n                      Effective No. of FG produced\n                    </td>\n                    <td\n                      className=\"px-4 py-3 text-sm text-right font-bold text-green-700\"\n                      colSpan={4}\n                    >\n                      {calculations.effectiveUnitsProduced.toFixed(2)} pcs\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n          {/* Cost per unit And selling price per unit */}\n          <div>\n            <h3 className=\"text-lg font-semibold mb-4 text-gray-800\">\n              Cost per unit And selling price per unit\n            </h3>\n            <div className=\"overflow-x-auto rounded-lg border\">\n              <table className=\"w-full bg-white\">\n                <tbody className=\"divide-y divide-gray-200\">\n                  <tr className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-3 text-sm w-12\">I</td>\n                    <td className=\"px-4 py-3 text-sm\">\n                      Estimated Cost per unit\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-center\">A / B</td>\n                    <td className=\"px-4 py-3 text-sm text-right font-medium\">\n                      {formatCurrency(calculations.estimatedCostPerUnit)}\n                    </td>\n                  </tr>\n                  <tr className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-3 text-sm\">II</td>\n                    <td className=\"px-4 py-3 text-sm\">\n                      Mfg. and packaging cost per unit\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-right\">\n                      {form.getValues(\"mfgAndPackagingCost\")}%\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-right font-medium\">\n                      {formatCurrency(calculations.mfgCostPerUnit)}\n                    </td>\n                  </tr>\n                  <tr className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-3 text-sm\">III</td>\n                    <td className=\"px-4 py-3 text-sm\">\n                      Overhead cost per unit\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-right\">\n                      {form.getValues(\"overheadCost\")}%\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-right font-medium\">\n                      {formatCurrency(calculations.overheadCostPerUnit)}\n                    </td>\n                  </tr>\n                  <tr className=\"bg-green-50 border-t-2 border-green-200\">\n                    <td className=\"px-4 py-3 text-sm font-bold\"></td>\n                    <td className=\"px-4 py-3 text-sm font-bold\">\n                      Cost per unit\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-center font-medium\">\n                      I + II + III\n                    </td>\n                    <td className=\"px-4 py-3 text-sm text-right font-bold text-2xl text-green-700\">\n                      {formatCurrency(calculations.finalCostPerUnit)}\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Actions */}\n      <div className=\"flex justify-end space-x-4\">\n        <Button variant=\"outline\" onClick={calculateCosts} className=\"h-11\">\n          <Calculator className=\"h-4 w-4 mr-2\" />\n          Recalculate\n        </Button>\n        <Button\n          onClick={handleSaveProduct}\n          disabled={!form.getValues(\"productName\")}\n          className=\"h-11\"\n        >\n          <Save className=\"h-4 w-4 mr-2\" />\n          {product ? \"Update Recipe\" : \"Save as Product\"}\n        </Button>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":45389,"size_tokens":null},"client/src/contexts/LanguageContext.tsx":{"content":"import React, { createContext, useContext, useState, ReactNode } from 'react';\n\ntype Language = 'en' | 'ne';\n\ninterface LanguageContextType {\n  language: Language;\n  setLanguage: (lang: Language) => void;\n  t: (key: string) => string;\n}\n\nconst translations = {\n  en: {\n    // Common\n    dashboard: \"Dashboard\",\n    products: \"Products\",\n    inventory: \"Inventory\", \n    stock: \"Stock\",\n    orders: \"Orders\",\n    production: \"Production\",\n    parties: \"Parties\",\n    customers: \"Customers\",\n    assets: \"Assets\",\n    expenses: \"Expenses\",\n    reports: \"Reports\",\n    settings: \"Settings\",\n    logout: \"Logout\",\n    search: \"Search\",\n    dayBook: \"Day Book\",\n    transactions: \"Transactions\",\n    billing: \"Billing\",\n    notifications: \"Notifications\",\n    userManagement: \"User Management\",\n    loginLogs: \"Login Logs\",\n    categoryManagement: \"Category Management\",\n    sales: \"Sales\",\n    purchases: \"Purchases\",\n    ingredients: \"Ingredients\",\n    units: \"Units\",\n    admin: \"Admin\",\n    manager: \"Manager\",\n    staff: \"Staff\",\n    // Add more translations as needed\n  },\n  ne: {\n    // Common  \n    dashboard: \"‡§°‡•ç‡§Ø‡§æ‡§∏‡§¨‡•ã‡§∞‡•ç‡§°\",\n    products: \"‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®‡§π‡§∞‡•Ç\",\n    inventory: \"‡§∏‡•Ç‡§ö‡•Ä\",\n    stock: \"‡§∏‡•ç‡§ü‡§ï\",\n    orders: \"‡§Ö‡§∞‡•ç‡§°‡§∞‡§π‡§∞‡•Ç\", \n    production: \"‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®\",\n    parties: \"‡§™‡§æ‡§∞‡•ç‡§ü‡•Ä‡§π‡§∞‡•Ç\",\n    customers: \"‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡§π‡§∞‡•Ç\",\n    assets: \"‡§∏‡§Æ‡•ç‡§™‡§§‡•ç‡§§‡§ø‡§π‡§∞‡•Ç\",\n    expenses: \"‡§ñ‡§∞‡•ç‡§ö‡§π‡§∞‡•Ç\",\n    reports: \"‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡§π‡§∞‡•Ç\",\n    settings: \"‡§∏‡•á‡§ü‡§ø‡§ô‡§π‡§∞‡•Ç\",\n    logout: \"‡§≤‡§ó‡§Ü‡§â‡§ü\",\n    search: \"‡§ñ‡•ã‡§ú‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç\",\n    dayBook: \"‡§¶‡§ø‡§® ‡§™‡•Å‡§∏‡•ç‡§§‡§ï\",\n    transactions: \"‡§≤‡•á‡§®‡§¶‡•á‡§®‡§π‡§∞‡•Ç\",\n    billing: \"‡§¨‡§ø‡§≤‡§ø‡§ô\",\n    notifications: \"‡§∏‡•Ç‡§ö‡§®‡§æ‡§π‡§∞‡•Ç\",\n    userManagement: \"‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®\",\n    loginLogs: \"‡§≤‡§ó‡§ø‡§® ‡§≤‡§ó‡§π‡§∞‡•Ç\",\n    categoryManagement: \"‡§µ‡§∞‡•ç‡§ó ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®\",\n    sales: \"‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä\",\n    purchases: \"‡§ñ‡§∞‡§ø‡§¶‡§π‡§∞‡•Ç\",\n    ingredients: \"‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä‡§π‡§∞‡•Ç\",\n    units: \"‡§è‡§ï‡§æ‡§á‡§π‡§∞‡•Ç\",\n    admin: \"‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§ï\",\n    manager: \"‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§ï\", \n    staff: \"‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä\",\n    // Add more translations as needed\n  },\n};\n\nconst LanguageContext = createContext<LanguageContextType | undefined>(undefined);\n\nexport function LanguageProvider({ children }: { children: ReactNode }) {\n  const [language, setLanguage] = useState<Language>('en');\n\n  const t = (key: string): string => {\n    return translations[language]?.[key] || translations.en?.[key] || key;\n  };\n\n  return (\n    <LanguageContext.Provider value={{ language, setLanguage, t }}>\n      {children}\n    </LanguageContext.Provider>\n  );\n}\n\nexport function useLanguage() {\n  const context = useContext(LanguageContext);\n  if (context === undefined) {\n    throw new Error('useLanguage must be used within a LanguageProvider');\n  }\n  return context;\n}","path":null,"size_bytes":3072,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":23567,"size_tokens":null},"client/src/pages/label-printing.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Eye, Printer, RotateCcw, Search } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport type { Product } from \"@shared/schema\";\n\n// Generate barcode data URL (simple implementation)\nconst generateBarcode = (\n  text: string,\n  width: number = 200,\n  height: number = 50,\n) => {\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = width;\n  canvas.height = height;\n  const ctx = canvas.getContext(\"2d\");\n\n  if (!ctx) return \"\";\n\n  ctx.fillStyle = \"white\";\n  ctx.fillRect(0, 0, width, height);\n  ctx.fillStyle = \"black\";\n\n  const barWidth = width / (text.length * 10);\n  for (let i = 0; i < text.length; i++) {\n    const charCode = text.charCodeAt(i);\n    const x = i * barWidth * 10;\n    for (let j = 0; j < 8; j++) {\n      if (charCode & (1 << j)) {\n        ctx.fillRect(x + j * barWidth, 10, barWidth, height - 30);\n      }\n    }\n  }\n\n  ctx.fillStyle = \"black\";\n  ctx.font = \"12px Arial\";\n  ctx.textAlign = \"center\";\n  ctx.fillText(text, width / 2, height - 5);\n\n  return canvas.toDataURL();\n};\n\n// Generate QR Code data URL (simple implementation)\nconst generateQRCode = (text: string, size: number = 100) => {\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = size;\n  canvas.height = size;\n  const ctx = canvas.getContext(\"2d\");\n\n  if (!ctx) return \"\";\n\n  ctx.fillStyle = \"white\";\n  ctx.fillRect(0, 0, size, size);\n  ctx.fillStyle = \"black\";\n\n  const moduleSize = size / 25;\n  for (let i = 0; i < 25; i++) {\n    for (let j = 0; j < 25; j++) {\n      if ((i + j + text.length) % 3 === 0) {\n        ctx.fillRect(i * moduleSize, j * moduleSize, moduleSize, moduleSize);\n      }\n    }\n  }\n\n  return canvas.toDataURL();\n};\n\ninterface LabelField {\n  id: string;\n  label: string;\n  checked: boolean;\n}\n\nexport default function LabelPrinting() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);\n  const [labelNotes, setLabelNotes] = useState(\"\");\n  const [selectedTemplate, setSelectedTemplate] = useState<string>(\"default\");\n  const [savedTemplates, setSavedTemplates] = useState<any[]>([]);\n  const [productDrafts, setProductDrafts] = useState<Record<number, any>>({});\n  const [showPrintDialog, setShowPrintDialog] = useState(false);\n  const [printProduct, setPrintProduct] = useState<Product | null>(null);\n  const [mfdDate, setMfdDate] = useState(new Date().toISOString().split(\"T\")[0]);\n  const [expDays, setExpDays] = useState(\"30\");\n  const [batchCheckbox, setBatchCheckbox] = useState(true);\n  const [noCopies, setNoCopies] = useState(\"1\");\n\n  // Field selection state\n  const [labelFields, setLabelFields] = useState<LabelField[]>([\n    { id: \"productName\", label: \"Product Name\", checked: true },\n    { id: \"batchNo\", label: \"Batch No\", checked: true },\n    { id: \"netWeight\", label: \"Net Weight\", checked: true },\n    { id: \"price\", label: \"Price\", checked: true },\n    { id: \"mfgDate\", label: \"Mfg Date\", checked: true },\n    { id: \"expiryDate\", label: \"Expiry Date\", checked: true },\n    { id: \"barcode\", label: \"Barcode\", checked: true },\n    { id: \"qrCode\", label: \"QR Code\", checked: false },\n    { id: \"notes\", label: \"Notes\", checked: false },\n  ]);\n\n  // Fetch products from database\n  const { data: productsData = [], isLoading: productsLoading } = useQuery({\n    queryKey: [\"/api/products\"],\n    queryFn: async () => {\n      try {\n        console.log(\"üîç Fetching products for label printing...\");\n        const res = await apiRequest(\"GET\", \"/api/products\");\n        console.log(\"üì¶ Products response:\", res);\n        \n        // Handle wrapped response with success flag\n        if (res?.success && res?.data) {\n          const products = Array.isArray(res.data) ? res.data : [];\n          console.log(`‚úÖ Found ${products.length} products in success response`);\n          return products;\n        }\n        \n        // Handle old format with products key\n        if (res?.products) {\n          const products = Array.isArray(res.products) ? res.products : [];\n          console.log(`‚úÖ Found ${products.length} products in products key`);\n          return products;\n        }\n        \n        // Handle direct array response\n        if (Array.isArray(res)) {\n          console.log(`‚úÖ Found ${res.length} products in direct array`);\n          return res;\n        }\n        \n        console.warn(\"‚ö†Ô∏è No products found in response\");\n        return [];\n      } catch (error) {\n        console.error(\"‚ùå Failed to fetch products:\", error);\n        if (isUnauthorizedError(error)) {\n          throw error;\n        }\n        return [];\n      }\n    },\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  const products = Array.isArray(productsData) ? productsData : [];\n\n  // Filter products based on search\n  const filteredProducts = products.filter((product) => {\n    if (!searchTerm) return true;\n    const search = searchTerm.toLowerCase();\n    return (\n      product.name?.toLowerCase().includes(search) ||\n      product.sku?.toLowerCase().includes(search)\n    );\n  });\n\n  // Toggle field visibility\n  const toggleField = (fieldId: string) => {\n    setLabelFields((prev) =>\n      prev.map((field) =>\n        field.id === fieldId ? { ...field, checked: !field.checked } : field,\n      ),\n    );\n  };\n\n  // Save default template\n  const saveDefaultTemplate = () => {\n    localStorage.setItem(\"labelFieldsTemplate\", JSON.stringify(labelFields));\n    toast({\n      title: \"Template Saved\",\n      description: \"Your field preferences have been saved as default\",\n    });\n  };\n\n  // Load default template on mount\n  useEffect(() => {\n    const savedTemplate = localStorage.getItem(\"labelFieldsTemplate\");\n    if (savedTemplate) {\n      try {\n        setLabelFields(JSON.parse(savedTemplate));\n      } catch (e) {\n        console.error(\"Failed to load saved template:\", e);\n      }\n    }\n\n    // Load saved label templates\n    const templates: any[] = [];\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (key?.startsWith(\"labelTemplate_\")) {\n        const template = JSON.parse(localStorage.getItem(key) || \"{}\");\n        templates.push({ id: key, name: template.name });\n      }\n    }\n    setSavedTemplates(templates);\n\n    // Load product drafts\n    const drafts = localStorage.getItem(\"productLabelDrafts\");\n    if (drafts) {\n      try {\n        setProductDrafts(JSON.parse(drafts));\n      } catch (e) {\n        console.error(\"Failed to load drafts:\", e);\n      }\n    }\n  }, []);\n\n  const saveDraft = (productId: number, draftData: any) => {\n    const newDrafts = { ...productDrafts, [productId]: draftData };\n    setProductDrafts(newDrafts);\n    localStorage.setItem(\"productLabelDrafts\", JSON.stringify(newDrafts));\n    toast({ title: \"Draft Saved\", description: \"Product label details saved\" });\n  };\n\n  // Preview label\n  const handlePreview = (product: Product) => {\n    setSelectedProduct(product);\n    toast({\n      title: \"Preview Updated\",\n      description: `Showing label preview for ${product.name}`,\n    });\n  };\n\n  // Calculate expiry date\n  const calculateExpDate = () => {\n    const mfd = new Date(mfdDate);\n    const days = parseInt(expDays) || 30;\n    const exp = new Date(mfd);\n    exp.setDate(exp.getDate() + days);\n    return exp.toISOString().split(\"T\")[0];\n  };\n\n  // Open print dialog\n  const openPrintDialog = (product: Product) => {\n    setPrintProduct(product);\n    setMfdDate(new Date().toISOString().split(\"T\")[0]);\n    setExpDays(\"30\");\n    setBatchCheckbox(true);\n    setNoCopies(\"1\");\n    setShowPrintDialog(true);\n  };\n\n  // Handle print with dialog confirmation\n  const confirmAndPrint = async () => {\n    console.log(\"üñ®Ô∏è confirmAndPrint called\");\n    console.log(\"üì¶ printProduct:\", printProduct);\n    \n    if (!printProduct) {\n      console.error(\"‚ùå No product selected for printing\");\n      return;\n    }\n\n    try {\n      const expDate = calculateExpDate();\n      const copies = parseInt(noCopies) || 1;\n\n      console.log(\"üìù Print details:\", {\n        productId: printProduct.id,\n        productName: printProduct.name,\n        mfdDate,\n        expDate,\n        copies,\n        batchCheckbox,\n        currentSKU: printProduct.sku\n      });\n\n      // If batch checkbox is checked, increment the SKU\n      if (batchCheckbox && printProduct.sku) {\n        const currentBatch = parseInt(printProduct.sku) || 0;\n        const newBatch = currentBatch + 1;\n        console.log(`üìä Updating batch from ${currentBatch} to ${newBatch}`);\n        \n        await apiRequest(\"PUT\", `/api/products/${printProduct.id}`, {\n          sku: newBatch.toString(),\n        });\n        console.log(\"‚úÖ Batch updated successfully\");\n      }\n\n      // Save printed label record to database\n      console.log(\"üíæ Saving print record to database...\");\n      const printRecordPayload = {\n        productId: printProduct.id,\n        mfdDate,\n        expDate,\n        noOfCopies: copies,\n        printedBy: \"User\",\n      };\n      console.log(\"üì§ Print record payload:\", printRecordPayload);\n\n      const printRecordResponse = await apiRequest(\"POST\", \"/api/printed-labels\", printRecordPayload);\n      console.log(\"üì• Print record response:\", printRecordResponse);\n\n      if (!printRecordResponse.success) {\n        console.error(\"‚ùå Print record save failed:\", printRecordResponse);\n        throw new Error(\"Failed to save print record\");\n      }\n\n      console.log(\"‚úÖ Print record saved successfully:\", printRecordResponse.data);\n\n      // Close dialog and execute print with the saved data\n      console.log(\"üîÑ Closing dialog and initiating print...\");\n      setShowPrintDialog(false);\n      \n      console.log(\"üñ®Ô∏è Calling handlePrint with:\", {\n        product: printProduct.name,\n        mfdDate,\n        expDate\n      });\n      await handlePrint(printProduct, false, mfdDate, expDate);\n\n      console.log(\"‚úÖ Print process completed\");\n      toast({\n        title: \"Success\",\n        description: `Print record saved and label printed successfully`,\n      });\n    } catch (error) {\n      console.error(\"‚ùå Error in confirmAndPrint:\", error);\n      console.error(\"Error details:\", {\n        message: error?.message,\n        stack: error?.stack,\n        error\n      });\n      toast({\n        title: \"Error\",\n        description: \"Failed to save print record\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Print label with system settings\n  const handlePrint = async (\n    product: Product,\n    isReprint: boolean = false,\n    customMfdDate?: string,\n    customExpDate?: string,\n  ) => {\n    console.log(\"üñ®Ô∏è handlePrint function called with:\", {\n      productName: product.name,\n      productId: product.id,\n      isReprint,\n      customMfdDate,\n      customExpDate\n    });\n\n    try {\n      // Fetch system print settings\n      console.log(\"‚öôÔ∏è Fetching system settings...\");\n      const settingsResponse = await fetch(\"/api/settings\");\n      console.log(\"üì• Settings response status:\", settingsResponse.status);\n      \n      const settingsData = await settingsResponse.json();\n      console.log(\"üìÑ Settings data received:\", settingsData);\n      \n      const settings = settingsData?.settings || settingsData || {};\n      console.log(\"‚öôÔ∏è Parsed settings:\", settings);\n\n      // Log printer configuration\n      if (settings.defaultPrinter) {\n        console.log(\"üñ®Ô∏è Using configured printer:\", settings.defaultPrinter);\n      } else {\n        console.log(\"‚ÑπÔ∏è No default printer configured\");\n      }\n\n      console.log(\"ü™ü Opening print window...\");\n      const printWindow = window.open(\"\", \"_blank\");\n      \n      if (!printWindow) {\n        console.error(\"‚ùå Failed to open print window - popup blocked\");\n        toast({\n          title: \"Print Failed\",\n          description: \"Please allow pop-ups for printing\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      console.log(\"‚úÖ Print window opened successfully\");\n\n      const labelData = {\n        productName: product.name,\n        batchNo: product.sku || \"N/A\",\n        netWeight: product.netWeight ? `${product.netWeight}g` : (product.unit || \"N/A\"),\n        price: product.price\n          ? `Rs.${parseFloat(product.price).toFixed(2)}`\n          : \"N/A\",\n        mfgDate: customMfdDate\n          ? new Date(customMfdDate).toLocaleDateString()\n          : new Date().toLocaleDateString(),\n        expiryDate: customExpDate\n          ? new Date(customExpDate).toLocaleDateString()\n          : \"N/A\",\n        barcode: product.sku || product.id.toString(),\n        notes: labelNotes || product.description || \"\",\n      };\n\n      console.log(\"üìã Label data prepared:\", labelData);\n\n      const barcodeImage = labelFields.find((f) => f.id === \"barcode\")?.checked\n        ? generateBarcode(labelData.barcode)\n        : \"\";\n\n      console.log(\"üî≥ Barcode generated:\", barcodeImage ? \"Yes\" : \"No\");\n\n      const qrCodeImage = labelFields.find((f) => f.id === \"qrCode\")?.checked\n        ? generateQRCode(\n            JSON.stringify({\n              name: product.name,\n              sku: product.sku,\n              price: product.price,\n            }),\n          )\n        : \"\";\n\n      console.log(\"üì± QR Code generated:\", qrCodeImage ? \"Yes\" : \"No\");\n\n      // Get paper dimensions from system settings\n      let paperWidth = \"50mm\";\n      let paperHeight = \"30mm\";\n\n      const labelSize = settings.labelSize || \"small\";\n      const orientation = settings.labelOrientation || \"portrait\";\n\n      console.log(\"üìè Label configuration:\", {\n        labelSize,\n        orientation,\n        customWidth: settings.customLabelWidth,\n        customHeight: settings.customLabelHeight\n      });\n\n      switch (labelSize) {\n        case \"small\":\n          paperWidth = \"50mm\";\n          paperHeight = \"30mm\";\n          break;\n        case \"medium\":\n          paperWidth = \"75mm\";\n          paperHeight = \"50mm\";\n          break;\n        case \"large\":\n          paperWidth = \"100mm\";\n          paperHeight = \"75mm\";\n          break;\n        case \"custom_40x30\":\n          paperWidth = \"40mm\";\n          paperHeight = \"30mm\";\n          break;\n        case \"A6\":\n          paperWidth = \"105mm\";\n          paperHeight = \"148mm\";\n          break;\n        case \"A5\":\n          paperWidth = \"148mm\";\n          paperHeight = \"210mm\";\n          break;\n        case \"A4\":\n          paperWidth = \"210mm\";\n          paperHeight = \"297mm\";\n          break;\n        default:\n          if (settings.customLabelWidth && settings.customLabelHeight) {\n            paperWidth = `${settings.customLabelWidth}mm`;\n            paperHeight = `${settings.customLabelHeight}mm`;\n          }\n      }\n\n      console.log(\"üìê Paper dimensions before orientation:\", { paperWidth, paperHeight });\n\n      // Swap dimensions for landscape\n      if (orientation === \"landscape\") {\n        [paperWidth, paperHeight] = [paperHeight, paperWidth];\n      }\n\n      console.log(\"üìê Final paper dimensions:\", { paperWidth, paperHeight });\n\n      // Get margins\n      const marginTop = `${settings.labelMarginTop || \"2\"}mm`;\n      const marginRight = `${settings.labelMarginRight || \"2\"}mm`;\n      const marginBottom = `${settings.labelMarginBottom || \"2\"}mm`;\n      const marginLeft = `${settings.labelMarginLeft || \"2\"}mm`;\n\n      console.log(\"üìè Margins:\", { marginTop, marginRight, marginBottom, marginLeft });\n\n      let labelHTML = '<div class=\"label-content\">';\n\n      // Header with Reg and PAN\n      labelHTML += `\n        <div class=\"header-row\">\n          <div><strong>Reg. No.:</strong> 11752/081/82</div>\n          <div><strong>PAN No.:</strong> 163133265</div>\n        </div>\n      `;\n\n      // Company Name\n      labelHTML += `<div class=\"company-name\">Aakarsak Food</div>`;\n\n      // Company Address\n      labelHTML += `\n        <div class=\"company-address\">\n          <div>Saudol, Tathali -09,</div>\n          <div>Changunarayan Municipality, Bhaktapur</div>\n        </div>\n      `;\n\n      // Product Name\n      labelHTML += `<div class=\"product-name-large\">${labelData.productName}</div>`;\n\n      // Two Column Layout\n      labelHTML += '<div class=\"two-column-layout\">';\n\n      // Left Column - Product Details\n      labelHTML += '<div class=\"left-column\">';\n      labelHTML += '<div class=\"detail-row\"><strong>DFTQ No.:</strong></div>';\n\n      if (labelFields.find((f) => f.id === \"batchNo\")?.checked) {\n        labelHTML += `<div class=\"detail-row\"><strong>Batch No.:</strong> ${labelData.batchNo}</div>`;\n      }\n      if (labelFields.find((f) => f.id === \"netWeight\")?.checked) {\n        labelHTML += `<div class=\"detail-row\"><strong>Net Weight:</strong> ${labelData.netWeight}</div>`;\n      }\n      if (labelFields.find((f) => f.id === \"price\")?.checked) {\n        labelHTML += `<div class=\"detail-row\"><strong>MRP Rs.:</strong> ${labelData.price}/-</div>`;\n      }\n      if (labelFields.find((f) => f.id === \"mfgDate\")?.checked) {\n        labelHTML += `<div class=\"detail-row\"><strong>Mfd. Date:</strong> ${labelData.mfgDate}</div>`;\n      }\n      labelHTML += \"</div>\";\n\n      // Right Column - Ingredients Box\n      labelHTML += '<div class=\"right-column\">';\n      labelHTML += '<div class=\"ingredients-box\">';\n      labelHTML +=\n        '<div class=\"ingredients-title\"><strong>Ingredients:</strong></div>';\n      if (\n        labelData.notes &&\n        labelFields.find((f) => f.id === \"notes\")?.checked\n      ) {\n        labelHTML += `<div class=\"ingredients-content\">${labelData.notes}</div>`;\n      }\n      labelHTML += \"</div>\";\n      labelHTML += \"</div>\";\n\n      labelHTML += \"</div>\"; // Close two-column-layout\n\n      // Expiry Date\n      if (labelFields.find((f) => f.id === \"expiryDate\")?.checked) {\n        labelHTML += `<div class=\"detail-row\"><strong>Exp. Date:</strong> ${labelData.expiryDate}</div>`;\n      }\n\n      // Barcode\n      if (\n        labelFields.find((f) => f.id === \"barcode\")?.checked &&\n        barcodeImage\n      ) {\n        labelHTML += `<div class=\"barcode-row\"><img src=\"${barcodeImage}\" alt=\"Barcode\" class=\"barcode\"/></div>`;\n      }\n\n      // QR Code\n      if (labelFields.find((f) => f.id === \"qrCode\")?.checked && qrCodeImage) {\n        labelHTML += `<div class=\"qr-row\"><img src=\"${qrCodeImage}\" alt=\"QR Code\" class=\"qr-code\"/></div>`;\n      }\n\n      labelHTML += \"</div>\";\n\n      console.log(\"üìù Generating HTML for print window...\");\n      console.log(\"üé® Label fields to include:\", labelFields.filter(f => f.checked).map(f => f.id));\n\n      const htmlContent = `\n        <html>\n          <head>\n            <title>Product Label - ${product.name}</title>\n            <style>\n              * {\n                margin: 0;\n                padding: 0;\n                box-sizing: border-box;\n              }\n\n              @page {\n                size: ${paperWidth} ${paperHeight};\n                margin: ${marginTop} ${marginRight} ${marginBottom} ${marginLeft};\n              }\n\n              html, body {\n                width: ${paperWidth};\n                height: ${paperHeight};\n                margin: 0;\n                padding: 0;\n              }\n\n              body { \n                font-family: Arial, sans-serif; \n                font-size: 9px;\n                padding: 8px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                overflow: hidden;\n              }\n\n              .label-content {\n                width: 100%;\n              }\n\n              .header-row {\n                display: flex;\n                justify-content: space-between;\n                font-size: 7px;\n                margin-bottom: 6px;\n              }\n\n              .company-name {\n                text-align: center;\n                font-size: 18px;\n                font-weight: bold;\n                margin: 4px 0;\n              }\n\n              .company-address {\n                text-align: center;\n                font-size: 7px;\n                line-height: 1.3;\n                margin-bottom: 8px;\n              }\n\n              .product-name-large {\n                text-align: center;\n                font-size: 16px;\n                font-weight: bold;\n                margin: 10px 0;\n              }\n\n              .two-column-layout {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 8px;\n                margin: 10px 0;\n              }\n\n              .left-column {\n                font-size: 8px;\n              }\n\n              .detail-row {\n                margin: 3px 0;\n                font-size: 8px;\n                line-height: 1.4;\n              }\n\n              .right-column {\n                display: flex;\n                align-items: flex-start;\n              }\n\n              .ingredients-box {\n                border: 2px solid #000;\n                padding: 6px;\n                min-height: 80px;\n                width: 100%;\n                font-size: 7px;\n              }\n\n              .ingredients-title {\n                font-weight: bold;\n                margin-bottom: 4px;\n              }\n\n              .ingredients-content {\n                font-size: 7px;\n                line-height: 1.3;\n              }\n\n              .barcode-row {\n                text-align: center;\n                margin-top: 8px;\n              }\n\n              .barcode { \n                max-width: 80%;\n                height: auto; \n                margin: 0 auto;\n                display: block;\n              }\n\n              .qr-row {\n                text-align: center;\n                margin-top: 8px;\n              }\n\n              .qr-code { \n                width: 60px;\n                height: 60px; \n                margin: 0 auto;\n                display: block;\n              }\n\n              strong {\n                font-weight: 600;\n                color: #000;\n              }\n\n              @media print { \n                html, body {\n                  width: ${paperWidth};\n                  height: ${paperHeight};\n                }\n                body { \n                  -webkit-print-color-adjust: exact;\n                  print-color-adjust: exact;\n                  padding: 8px;\n                }\n              }\n            </style>\n          </head>\n          <body>\n            ${labelHTML}\n          </body>\n        </html>\n      `;\n\n      console.log(\"üìÑ Writing HTML to print window...\");\n      printWindow.document.write(htmlContent);\n      console.log(\"‚úÖ HTML content written to print window\");\n      printWindow.document.close();\n      console.log(\"üìÑ Print window document closed\");\n      \n      printWindow.focus();\n      console.log(\"üéØ Print window focused\");\n\n      console.log(\"‚è±Ô∏è Setting 250ms timeout before calling print()...\");\n      setTimeout(() => {\n        console.log(\"üñ®Ô∏è Calling printWindow.print()...\");\n        try {\n          printWindow.print();\n          console.log(\"‚úÖ Print dialog should now be visible\");\n        } catch (printError) {\n          console.error(\"‚ùå Error calling print():\", printError);\n        }\n      }, 250);\n\n      toast({\n        title: isReprint ? \"Reprinting Label\" : \"Printing Label\",\n        description: `Label for ${product.name} sent to printer (${paperWidth} √ó ${paperHeight})`,\n      });\n      console.log(\"‚úÖ Toast notification shown\");\n    } catch (error) {\n      console.error(\"‚ùå Print error in handlePrint:\", error);\n      console.error(\"Error details:\", {\n        message: error?.message,\n        stack: error?.stack,\n        error\n      });\n      toast({\n        title: \"Print Failed\",\n        description: \"Failed to load print settings. Using defaults.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <div>\n        <p className=\"text-gray-600 mt-1\">Manage and print product labels</p>\n      </div>\n\n      {/* Search Bar */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\n            <Input\n              placeholder=\"Search products by name or SKU...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Saved Products List */}\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>Saved Products ({filteredProducts.length})</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {productsLoading ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                Loading products...\n              </div>\n            ) : filteredProducts.length === 0 ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                {searchTerm\n                  ? \"No products found matching your search\"\n                  : \"No products available\"}\n              </div>\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Product Name</TableHead>\n                      <TableHead>Batch/SKU</TableHead>\n                      <TableHead>Price</TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredProducts.map((product) => (\n                      <TableRow key={product.id}>\n                        <TableCell className=\"font-medium\">\n                          {product.name}\n                        </TableCell>\n                        <TableCell>{product.sku || \"N/A\"}</TableCell>\n                        <TableCell>\n                          ${parseFloat(product.price).toFixed(2)}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex gap-2 justify-end\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => handlePreview(product)}\n                              title=\"Preview Label\"\n                            >\n                              <Eye className=\"w-4 h-4\" />\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant=\"default\"\n                              onClick={() => openPrintDialog(product)}\n                              title=\"Print Label\"\n                              data-testid=\"button-print-label\"\n                            >\n                              <Printer className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Live Label Preview & Field Selection */}\n        <div className=\"space-y-6\">\n          {/* Live Preview */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Live Label Preview</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"border-2 border-gray-300 p-6 bg-white rounded-lg shadow-sm min-h-[400px]\">\n                {selectedProduct ? (\n                  <div className=\"space-y-3 text-sm\">\n                    {/* Header with Reg and PAN */}\n                    <div className=\"flex justify-between text-xs mb-2\">\n                      <div>\n                        <strong>Reg. No.:</strong> 11752/081/82\n                      </div>\n                      <div>\n                        <strong>PAN No.:</strong> 163133265\n                      </div>\n                    </div>\n\n                    {/* Company Name */}\n                    <div className=\"text-center text-2xl font-bold mb-1\">\n                      Aakarsak Food\n                    </div>\n\n                    {/* Company Address */}\n                    <div className=\"text-center text-xs space-y-0.5 mb-3\">\n                      <div>Saudol, Tathali -09,</div>\n                      <div>Changunarayan Municipality, Bhaktapur</div>\n                    </div>\n\n                    {/* Product Name - Large */}\n                    <div className=\"text-center text-xl font-bold my-4\">\n                      {selectedProduct.name}\n                    </div>\n\n                    {/* Two Column Layout */}\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      {/* Left Column - Product Details */}\n                      <div className=\"space-y-1.5 text-xs\">\n                        <div>\n                          <strong>DFTQ No.:</strong>\n                        </div>\n                        {labelFields.find((f) => f.id === \"batchNo\")\n                          ?.checked && (\n                          <div>\n                            <strong>Batch No.:</strong>{\" \"}\n                            {selectedProduct.sku || \"N/A\"}\n                          </div>\n                        )}\n                        {labelFields.find((f) => f.id === \"netWeight\")\n                          ?.checked && (\n                          <div>\n                            <strong>Net Weight:</strong>{\" \"}\n                            {selectedProduct.netWeight ? `${selectedProduct.netWeight}g` : (selectedProduct.unit || \"N/A\")}\n                          </div>\n                        )}\n                        {labelFields.find((f) => f.id === \"price\")?.checked && (\n                          <div>\n                            <strong>MRP Rs.:</strong>{\" \"}\n                            Rs.{parseFloat(selectedProduct.price || \"0\").toFixed(2)}/-\n                          </div>\n                        )}\n                        {labelFields.find((f) => f.id === \"mfgDate\")\n                          ?.checked && (\n                          <div>\n                            <strong>Mfd. Date:</strong>{\" \"}\n                            {new Date().toLocaleDateString(\"en-GB\", {\n                              day: \"2-digit\",\n                              month: \"short\",\n                              year: \"numeric\",\n                            })}\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Right Column - Ingredients Box */}\n                      <div className=\"border-2 border-black p-2 text-xs h-32 overflow-hidden\">\n                        <div className=\"font-bold mb-1\">Ingredients:</div>\n                        {labelFields.find((f) => f.id === \"notes\")?.checked ? (\n                          <div className=\"text-xs\">\n                            {labelNotes || selectedProduct.description || \"List ingredients here\"}\n                          </div>\n                        ) : (\n                          <div className=\"text-gray-400 text-xs italic\">\n                            Enable 'Notes' field to display\n                          </div>\n                        )}\n                      </div>\n                    </div>\n\n                    {/* Expiry Date Below Grid */}\n                    {labelFields.find((f) => f.id === \"expiryDate\")\n                      ?.checked && (\n                      <div className=\"text-xs\">\n                        <strong>Exp. Date:</strong> Dec 10, 2025\n                      </div>\n                    )}\n\n                    {/* Barcode */}\n                    {labelFields.find((f) => f.id === \"barcode\")?.checked && (\n                      <div className=\"text-center mt-3\">\n                        <img\n                          src={generateBarcode(\n                            selectedProduct.sku ||\n                              selectedProduct.id.toString(),\n                          )}\n                          alt=\"Barcode\"\n                          className=\"mx-auto\"\n                          style={{ maxWidth: \"180px\" }}\n                        />\n                      </div>\n                    )}\n\n                    {/* QR Code */}\n                    {labelFields.find((f) => f.id === \"qrCode\")?.checked && (\n                      <div className=\"text-center mt-3\">\n                        <img\n                          src={generateQRCode(\n                            JSON.stringify({\n                              name: selectedProduct.name,\n                              sku: selectedProduct.sku,\n                            }),\n                          )}\n                          alt=\"QR Code\"\n                          className=\"mx-auto\"\n                          style={{ width: \"80px\", height: \"80px\" }}\n                        />\n                      </div>\n                    )}\n                  </div>\n                ) : (\n                  <div className=\"flex items-center justify-center h-full text-gray-400\">\n                    Click Preview on a product to see label\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Field Selection */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Customize Label Fields</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"template-selector\">Label Template</Label>\n                <Select\n                  value={selectedTemplate}\n                  onValueChange={setSelectedTemplate}\n                >\n                  <SelectTrigger id=\"template-selector\">\n                    <SelectValue placeholder=\"Select template\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"default\">Default Template</SelectItem>\n                    {savedTemplates.map((template) => (\n                      <SelectItem key={template.id} value={template.id}>\n                        {template.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-3\">\n                {labelFields.map((field) => (\n                  <div key={field.id} className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id={field.id}\n                      checked={field.checked}\n                      onCheckedChange={() => toggleField(field.id)}\n                    />\n                    <Label htmlFor={field.id} className=\"cursor-pointer\">\n                      {field.label}\n                    </Label>\n                  </div>\n                ))}\n              </div>\n\n              {labelFields.find((f) => f.id === \"notes\")?.checked && (\n                <div className=\"space-y-2 pt-3 border-t\">\n                  <Label htmlFor=\"label-notes\">Notes</Label>\n                  <Input\n                    id=\"label-notes\"\n                    placeholder=\"Enter notes to appear on label...\"\n                    value={labelNotes}\n                    onChange={(e) => setLabelNotes(e.target.value)}\n                  />\n                </div>\n              )}\n\n              {selectedProduct && (\n                <div className=\"space-y-2 pt-3 border-t\">\n                  <Label>Product Details Draft</Label>\n                  <Input\n                    placeholder=\"Custom name\"\n                    defaultValue={\n                      productDrafts[selectedProduct.id]?.customName ||\n                      selectedProduct.name\n                    }\n                    onChange={(e) =>\n                      saveDraft(selectedProduct.id, {\n                        ...productDrafts[selectedProduct.id],\n                        customName: e.target.value,\n                      })\n                    }\n                  />\n                  <Input\n                    placeholder=\"Custom batch no\"\n                    defaultValue={\n                      productDrafts[selectedProduct.id]?.customBatch ||\n                      selectedProduct.sku\n                    }\n                    onChange={(e) =>\n                      saveDraft(selectedProduct.id, {\n                        ...productDrafts[selectedProduct.id],\n                        customBatch: e.target.value,\n                      })\n                    }\n                  />\n                  <Input\n                    placeholder=\"Custom weight\"\n                    defaultValue={\n                      productDrafts[selectedProduct.id]?.customWeight ||\n                      selectedProduct.unit\n                    }\n                    onChange={(e) =>\n                      saveDraft(selectedProduct.id, {\n                        ...productDrafts[selectedProduct.id],\n                        customWeight: e.target.value,\n                      })\n                    }\n                  />\n                </div>\n              )}\n\n              <Button\n                onClick={saveDefaultTemplate}\n                variant=\"outline\"\n                className=\"w-full\"\n              >\n                Save as Default Template\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Print Dialog */}\n      <Dialog open={showPrintDialog} onOpenChange={setShowPrintDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Print Label - {printProduct?.name}</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"mfd-date\">Manufacturing Date</Label>\n              <Input\n                id=\"mfd-date\"\n                type=\"date\"\n                value={mfdDate}\n                onChange={(e) => setMfdDate(e.target.value)}\n                data-testid=\"input-mfd-date\"\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"exp-days\">Expiry Days</Label>\n              <Input\n                id=\"exp-days\"\n                type=\"number\"\n                min=\"1\"\n                max=\"365\"\n                value={expDays}\n                onChange={(e) => setExpDays(e.target.value)}\n                placeholder=\"e.g., 30, 60\"\n                data-testid=\"input-exp-days\"\n              />\n              <p className=\"text-sm text-gray-500 mt-1\">\n                Exp. Date: {new Date(calculateExpDate()).toLocaleDateString()}\n              </p>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox\n                id=\"batch-checkbox\"\n                checked={batchCheckbox}\n                onCheckedChange={(checked) => setBatchCheckbox(!!checked)}\n                data-testid=\"checkbox-batch\"\n              />\n              <Label htmlFor=\"batch-checkbox\" className=\"cursor-pointer\">\n                Increment Batch/SKU by 1\n              </Label>\n            </div>\n            <div>\n              <Label htmlFor=\"no-copies\">Number of Copies</Label>\n              <Input\n                id=\"no-copies\"\n                type=\"number\"\n                min=\"1\"\n                max=\"100\"\n                value={noCopies}\n                onChange={(e) => setNoCopies(e.target.value)}\n                data-testid=\"input-no-copies\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setShowPrintDialog(false)}\n              data-testid=\"button-dialog-cancel\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={confirmAndPrint}\n              data-testid=\"button-dialog-print\"\n            >\n              Print\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":41024,"size_tokens":null},"client/src/components/sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useCompanyBranding } from \"@/hooks/use-company-branding\";\nimport { useRoleAccess } from \"@/hooks/useRoleAccess\";\nimport { useState, useEffect } from \"react\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Menu,\n  X,\n  ChevronDown,\n  ChevronRight,\n  ChevronLeft,\n  Building2,\n  Receipt,\n  BarChart3,\n  Bell,\n  ShoppingCart,\n  ArrowLeftRight,\n  CreditCard,\n  ShoppingBag,\n  Building,\n  UtensilsCrossed,\n  Cookie,\n  Boxes,\n  Factory,\n  Printer,\n  Sprout,\n  Users,\n  Handshake,\n  Clock,\n  Banknote,\n  CalendarX,\n  Calendar,\n  UserCog,\n  Shield,\n  Ruler,\n  Settings,\n  Database,\n  Code,\n  Heart,\n  Lock,\n  TrendingUp,\n  Gauge,\n  Home,\n  AlertTriangle,\n  Tags,\n} from \"lucide-react\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\n// Placeholder for SidebarMenuButton if it's a custom component not provided\n// Assuming it's a simple wrapper for Link with some styling\nconst SidebarMenuButton = ({ children, asChild }) => {\n  if (asChild) {\n    return <>{children}</>;\n  }\n  return <div className=\"sidebar-menu-button\">{children}</div>;\n};\n\ninterface SidebarProps {\n  isOpen?: boolean;\n  onToggle?: () => void;\n  isCollapsed?: boolean;\n}\n\nexport default function Sidebar({\n  isOpen = true,\n  onToggle,\n  isCollapsed = false,\n}: SidebarProps) {\n  const [location] = useLocation();\n  const { user } = useAuth();\n  const { branding } = useCompanyBranding();\n  const {\n    canAccessSidebarItem,\n    isSuperAdmin,\n    isAdmin,\n    isManager,\n    canManageUsers,\n    canManageStaff,\n    canViewFinance,\n    canManageBranches,\n    canAccessModule, // Assuming this hook is available from useRoleAccess\n  } = useRoleAccess();\n\n  const [openSections, setOpenSections] = useState<string[]>([\n    \"core\",\n    \"Finance\",\n  ]);\n\n  const toggleSection = (section: string) => {\n    if (isCollapsed) return; // Don't allow section toggle when collapsed\n    setOpenSections((prev) =>\n      prev.includes(section)\n        ? prev.filter((s) => s !== section)\n        : [...prev, section],\n    );\n  };\n\n  // Helper function to get Lucide icon component from string identifier\n  const getIconComponent = (iconString: string) => {\n    const iconMap: { [key: string]: any } = {\n      \"fas fa-tachometer-alt\": Home,\n      \"fas fa-bell\": Bell,\n      \"fas fa-shopping-cart\": ShoppingCart,\n      \"fas fa-exchange-alt\": ArrowLeftRight,\n      \"fas fa-cash-register\": CreditCard,\n      \"fas fa-shopping-bag\": ShoppingBag,\n      \"fas fa-receipt\": Receipt,\n      \"fas fa-building\": Building,\n      \"fas fa-utensils\": UtensilsCrossed,\n      \"fas fa-cookie-bite\": Cookie,\n      \"fas fa-boxes\": Boxes,\n      \"fas fa-industry\": Factory,\n      \"fas fa-print\": Printer,\n      \"fas fa-seedling\": Sprout,\n      \"fas fa-users\": Users,\n      \"fas fa-handshake\": Handshake,\n      \"fas fa-clock\": Clock,\n      \"fas fa-money-bill-wave\": Banknote,\n      \"fas fa-calendar-times\": CalendarX,\n      \"fas fa-calendar-alt\": Calendar,\n      \"fas fa-chart-bar\": BarChart3,\n      \"fas fa-file-invoice-dollar\": Receipt,\n      \"fas fa-users-cog\": UserCog,\n      \"fas fa-users-cog text-base\": UserCog,\n      \"fas fa-shield-alt\": Shield,\n      \"fas fa-shield-alt text-base\": Shield,\n      \"fas fa-ruler\": Ruler,\n      \"fas fa-ruler text-base\": Ruler,\n      \"fas fa-cogs\": Settings,\n      \"fas fa-cogs text-base\": Settings,\n      \"fas fa-database\": Database,\n      \"fas fa-database text-base\": Database,\n      \"fas fa-code\": Code,\n      \"fas fa-code text-base\": Code,\n      \"fas fa-heartbeat\": Heart,\n      \"fas fa-heartbeat text-base\": Heart,\n      \"fas fa-lock\": Lock,\n      \"fas fa-lock text-base\": Lock,\n      \"fas fa-chart-line\": TrendingUp,\n      \"fas fa-chart-line text-base\": TrendingUp,\n      \"fas fa-tachometer-alt text-base\": Gauge,\n      \"fas fa-tags\": Tags,\n    };\n\n    return iconMap[iconString] || Home;\n  };\n\n  const getNavigationSections = () => {\n    const allSections = [\n      {\n        id: \"core\",\n        items: [\n          {\n            name: \"Dashboard\",\n            href: \"/\",\n            resource: \"dashboard\",\n            icon: \"fas fa-tachometer-alt\",\n          },\n          {\n            name: \"Notifications\",\n            href: \"/notifications\",\n            resource: \"dashboard\",\n            icon: \"fas fa-bell\",\n          },\n        ],\n      },\n      {\n        id: \"Finance\",\n        title: \"Finance\",\n        items: [\n          {\n            name: \"Day Book\",\n            href: \"/day-book\",\n            icon: \"fas fa-shopping-cart\",\n            resource: \"sales\",\n          },\n          {\n            name: \"Transactions\",\n            href: \"/transactions\",\n            icon: \"fas fa-exchange-alt\",\n            resource: \"sales\",\n          },\n          {\n            name: \"Orders\",\n            href: \"/orders\",\n            icon: \"fas fa-shopping-cart\",\n            resource: \"orders\",\n          },\n          {\n            name: \"Sales\",\n            href: \"/sales\",\n            icon: \"fas fa-cash-register\",\n            resource: \"sales\",\n          },\n          {\n            name: \"Sales Returns\",\n            href: \"/sales-returns\",\n            icon: \"fas fa-undo\",\n            resource: \"sales\",\n          },\n          {\n            name: \"Purchases\",\n            href: \"/purchases\",\n            icon: \"fas fa-shopping-bag\",\n            resource: \"purchases\",\n          },\n          {\n            name: \"Purchase Returns\",\n            href: \"/purchase-returns\",\n            icon: \"fas fa-truck-loading\",\n            resource: \"purchases\",\n          },\n          {\n            name: \"Income & Expenses\",\n            href: \"/expenses\",\n            icon: \"fas fa-receipt\",\n            resource: \"expenses\",\n          },\n          {\n            name: \"Assets\",\n            href: \"/assets\",\n            icon: \"fas fa-building\",\n            resource: \"assets\",\n          },\n        ],\n      },\n      {\n        id: \"Stock\",\n        title: \"Product & Inventory\",\n        items: [\n          {\n            name: \"Recipes\",\n            href: \"/recipes\",\n            icon: \"fas fa-utensils\",\n            resource: \"products\",\n          },\n          {\n            name: \"Products\",\n            href: \"/products\",\n            icon: \"fas fa-cookie-bite\",\n            resource: \"products\",\n          },\n          {\n            name: \"Stock\",\n            href: \"/stock\",\n            icon: \"fas fa-boxes\",\n            resource: \"inventory\",\n          },\n          {\n            name: \"Ingredients\",\n            href: \"/ingredients\",\n            icon: \"fas fa-seedling\",\n            resource: \"inventory\",\n          },\n          {\n            name: \"Production\",\n            href: \"/production\",\n            icon: \"fas fa-industry\",\n            resource: \"production\",\n          },\n          {\n            name: \"Label Printing\",\n            href: \"/label-printing\",\n            icon: \"fas fa-print\",\n            resource: \"production\",\n          },\n        ],\n      },\n      {\n        id: \"management\",\n        title: \"CRM\",\n        items: [\n          {\n            name: \"Customers\",\n            href: \"/customers\",\n            icon: \"fas fa-users\",\n            resource: \"customers\",\n          },\n          {\n            name: \"Parties\",\n            href: \"/parties\",\n            icon: \"fas fa-handshake\",\n            resource: \"parties\",\n          },\n        ],\n      },\n      {\n        id: \"Staff\",\n        title: \"HR & Payroll\",\n        items: [\n          {\n            name: \"Staff Directory\",\n            href: \"/staff\",\n            icon: \"fas fa-users\",\n            resource: \"staff\",\n          },\n          {\n            name: \"Attendance\",\n            href: \"/attendance\",\n            icon: \"fas fa-clock\",\n            resource: \"staff\",\n          },\n          {\n            name: \"Salary Management\",\n            href: \"/salary\",\n            icon: \"fas fa-money-bill-wave\",\n            resource: \"staff\",\n          },\n          {\n            name: \"Leave Requests\",\n            href: \"/leave-requests\",\n            icon: \"fas fa-calendar-times\",\n            resource: \"staff\",\n          },\n          {\n            name: \"Staff Schedules\",\n            href: \"/staff-schedules\",\n            icon: \"fas fa-calendar-alt\",\n            resource: \"staff\",\n          },\n        ],\n      },\n      {\n        id: \"reports\",\n        title: \"Reports & Analytics\",\n        items: [\n          {\n            name: \"Reports\",\n            href: \"/reports\",\n            icon: \"fas fa-chart-bar\",\n            resource: \"reports\",\n          },\n          {\n            name: \"Billing & Subscription\",\n            href: \"/billing\",\n            icon: \"fas fa-file-invoice-dollar\",\n            resource: \"billing\",\n          },\n        ],\n      },\n      {\n        id: \"setup\",\n        title: \"Setup\",\n        items: [\n          {\n            name: \"User Management\",\n            href: \"/admin/users\",\n            icon: \"fas fa-users-cog text-base\",\n            resource: \"users\",\n          },\n          {\n            name: \"Audit Logs\",\n            href: \"/admin/login-logs\",\n            icon: \"fas fa-shield-alt text-base\",\n            resource: \"admin\",\n          },\n          {\n            name: \"Product Categories\",\n            href: \"/admin/categories\",\n            icon: \"fas fa-tags\",\n            resource: \"products\",\n          },\n          {\n            name: \"Measuring Units\",\n            href: \"/units\",\n            icon: \"fas fa-ruler text-base\",\n            resource: \"settings\",\n          },\n          {\n            name: \"Label Editor\",\n            href: \"/label-editor\",\n            icon: \"fas fa-print\",\n            resource: \"settings\",\n          },\n        ],\n      },\n    ];\n\n    // Super Admin sees ALL sections without filtering\n    if (isSuperAdmin()) {\n      return allSections.concat(\n        canManageBranches()\n          ? [\n              {\n                id: \"branches\",\n                title: \"Branch Management\",\n                moduleIds: [\"branch_management\"],\n                items: [\n                  {\n                    name: \"Branches\",\n                    href: \"/branches\",\n                    icon: \"fas fa-building\",\n                    resource: \"branches\",\n                    moduleId: \"branch_management\",\n                  },\n                ],\n              },\n            ]\n          : [],\n      );\n    }\n\n    // Filter sections based on module access for non-super-admin users\n    return allSections\n      .map((section) => ({\n        ...section,\n        items: section.items.filter((item) => {\n          // Check module access first if moduleId is specified\n          if (item.moduleId && !canAccessModule(item.moduleId)) {\n            return false;\n          }\n          // Then check traditional resource access\n          return canAccessSidebarItem(item.resource, \"read\");\n        }),\n      }))\n      .filter((section) => section.items.length > 0) // Remove empty sections\n      .concat(\n        canManageBranches()\n          ? [\n              {\n                id: \"branches\",\n                title: \"Branch Management\",\n                moduleIds: [\"branch_management\"],\n                items: [\n                  {\n                    name: \"Branches\",\n                    href: \"/branches\",\n                    icon: \"fas fa-building\",\n                    resource: \"branches\",\n                    moduleId: \"branch_management\",\n                  },\n                ],\n              },\n            ]\n          : [],\n      );\n  };\n\n  const navigationSections = getNavigationSections();\n\n  const isActive = (href: string) => {\n    if (href === \"/\") {\n      return location === \"/\";\n    }\n    return location.startsWith(href);\n  };\n\n  const renderMenuItem = (item: any, isSubItem = false) => {\n    const active = isActive(item.href);\n    const IconComponent = getIconComponent(item.icon);\n\n    const menuContent = (\n      <Link\n        key={item.name}\n        href={item.href}\n        className={`sidebar-item flex items-center transition-all duration-300 text-sm font-medium relative overflow-hidden\n                ${isCollapsed ? \"justify-center px-2 py-3\" : isSubItem ? \"space-x-3 px-3 py-2 ml-4\" : \"space-x-3 px-3 py-3\"}\n                rounded-xl\n                ${\n                  active\n                    ? \"bg-gradient-to-r from-primary to-primary/90 text-primary-foreground shadow-lg shadow-primary/25 scale-105\"\n                    : \"text-gray-700 hover:bg-gradient-to-r hover:from-primary/10 hover:to-primary/5 hover:text-primary hover:scale-102 hover:shadow-md\"\n                } group ${active ? \"active\" : \"\"}`}\n        aria-label={item.name}\n        data-testid={`link-${item.name.toLowerCase().replace(/\\s+/g, \"-\")}`}\n      >\n        <IconComponent\n          className={`text-base transition-all duration-300 ${\n            active\n              ? \"text-primary-foreground scale-110\"\n              : \"text-gray-500 group-hover:text-primary group-hover:scale-110 group-hover:rotate-3\"\n          } ${isCollapsed ? \"text-lg w-5 h-5\" : \"w-4 h-4\"}`}\n        />\n        {!isCollapsed && (\n          <span className=\"font-medium transition-transform duration-300 group-hover:translate-x-1 whitespace-nowrap\">\n            {item.name}\n          </span>\n        )}\n        {active && (\n          <div\n            className={`absolute ${isCollapsed ? \"right-1 top-1\" : \"right-2\"} w-2 h-2 bg-primary-foreground/60 rounded-full animate-pulse`}\n          ></div>\n        )}\n      </Link>\n    );\n\n    // Wrap with tooltip when collapsed\n    if (isCollapsed) {\n      return (\n        <Tooltip key={item.name}>\n          <TooltipTrigger asChild>{menuContent}</TooltipTrigger>\n          <TooltipContent side=\"right\" className=\"ml-2\" sideOffset={8}>\n            <p className=\"font-medium\">{item.name}</p>\n          </TooltipContent>\n        </Tooltip>\n      );\n    }\n\n    return menuContent;\n  };\n\n  return (\n    <TooltipProvider>\n      {/* Mobile overlay */}\n      {isOpen && (\n        <div\n          className=\"fixed inset-0 bg-black bg-opacity-10 z-40 lg:hidden\"\n          onClick={onToggle}\n        />\n      )}\n\n      <aside\n        className={`h-screen flex flex-col\n          fixed inset-y-0 left-0 z-50\n          bg-white/95 backdrop-blur-md\n          shadow-xl border-r border-gray-200/60\n          flex-shrink-0\n          transform transition-all duration-300 ease-in-out\n          ${isOpen ? \"translate-x-0 opacity-100\" : \"-translate-x-full lg:translate-x-0 opacity-95 lg:opacity-100\"}\n          ${isCollapsed ? \"w-20\" : \"w-64\"}\n          before:absolute before:inset-0 before:bg-gradient-to-r before:from-primary/0 before:to-transparent before:opacity-0\n          before:transition-opacity before:duration-300 hover:before:opacity-0\n        `}\n      >\n        {/* Dynamic Company Header */}\n        <div\n          className={`px-4 lg:px-6 py-2.5 flex-shrink-0 relative overflow-hidden border-b border-gray-200 ${isCollapsed ? \"px-2\" : \"\"}`}\n        >\n          <div className=\"absolute inset-0 bg-gradient-to-r from-white/5 to-transparent opacity-50\"></div>\n          <Link href=\"/\" className=\"flex items-center group relative z-10\">\n            <div\n              className={`bg-white/15 backdrop-blur-md rounded-2xl flex items-center justify-center\n                          shadow-lg group-hover:scale-110 group-hover:rotate-3 transition-all duration-300\n                          group-hover:shadow-xl group-hover:bg-white/20 relative overflow-hidden\n                          before:absolute before:inset-0 before:bg-gradient-to-br before:from-white/20 before:to-transparent\n                          before:opacity-0 group-hover:before:opacity-100 before:transition-opacity before:duration-300\n                          ${isCollapsed ? \"w-12 h-12\" : \"w-12 h-12\"}`}\n            >\n              {branding.companyIcon ? (\n                <img\n                  src={branding.companyIcon}\n                  alt=\"Company Logo\"\n                  className={`object-contain transition-transform duration-300 group-hover:scale-110 ${isCollapsed ? \"w-6 h-6\" : \"w-8 h-8\"}`}\n                />\n              ) : (\n                <i\n                  className={`fas fa-bread-slice text-orange-500 transition-all duration-300 group-hover:text-orange-700 ${isCollapsed ? \"text-xl\" : \"text-2xl\"}`}\n                ></i>\n              )}\n            </div>\n            {!isCollapsed && (\n              <div className=\"text-orange-500 transition-all duration-300 group-hover:translate-x-1 ml-4\">\n                <h1 className=\"text-xl font-bold tracking-tight group-hover:text-orange-700 transition-colors duration-300\">\n                  {branding.companyName}\n                </h1>\n              </div>\n            )}\n          </Link>\n        </div>\n\n        {/* Scrollable Navigation */}\n        <div className=\"flex-1 overflow-hidden\">\n          <ScrollArea className=\"h-full\" showScrollButtons={true}>\n            <div className={`py-4 space-y-2 ${isCollapsed ? \"px-2\" : \"px-4\"}`}>\n              <nav\n                className=\"space-y-1\"\n                role=\"navigation\"\n                aria-label=\"Main navigation\"\n              >\n                {/* Render top-level items directly without Collapsible */}\n                {navigationSections\n                  .filter(\n                    (section) => section.id === \"core\", // Add other top-level sections here if needed\n                  )\n                  .flatMap((section) =>\n                    section.items\n                      .filter(\n                        (item) =>\n                          isSuperAdmin() ||\n                          canAccessSidebarItem(item.resource, \"read\"),\n                      )\n                      .map((item) => renderMenuItem(item)),\n                  )}\n\n                {/* Render remaining grouped sections */}\n                {navigationSections\n                  .filter((section) => section.id !== \"core\")\n                  .map((section) => (\n                    <div key={section.id} className=\"mb-3\">\n                      {isCollapsed ? (\n                        // When collapsed, show items directly without grouping\n                        <div className=\"space-y-1\">\n                          {section.items\n                            .filter(\n                              (item) =>\n                                isSuperAdmin() ||\n                                canAccessSidebarItem(item.resource, \"read\"),\n                            )\n                            .map((item) => renderMenuItem(item))}\n                        </div>\n                      ) : (\n                        // When expanded, show with collapsible sections\n                        <Collapsible\n                          open={openSections.includes(section.id)}\n                          onOpenChange={() => toggleSection(section.id)}\n                        >\n                          <CollapsibleTrigger\n                            className=\"flex items-center w-full px-3 py-3 text-left text-sm font-semibold\n                                                                 text-gray-800 hover:bg-gradient-to-r hover:from-gray-50 hover:to-gray-100/50\n                                                                 hover:text-gray-900 rounded-xl transition-all duration-300 group\n                                                                 hover:shadow-sm hover:scale-102 relative overflow-hidden\n                                                                 focus:outline-none focus:ring-2 focus:ring-primary/20 focus:ring-offset-2\"\n                            aria-expanded={openSections.includes(section.id)}\n                            aria-controls={`section-${section.id}`}\n                            data-testid={`button-toggle-${section.id}`}\n                          >\n                            <span\n                              className=\"text-xs uppercase tracking-wider font-bold text-gray-600 group-hover:text-gray-800\n                                           transition-all duration-300 group-hover:tracking-wide\"\n                            >\n                              {section.title}\n                            </span>\n                            <div className=\"ml-auto transition-transform duration-300 group-hover:scale-110\">\n                              {openSections.includes(section.id) ? (\n                                <ChevronDown className=\"h-4 w-4 text-gray-400 group-hover:text-primary transition-all duration-300 group-hover:rotate-180\" />\n                              ) : (\n                                <ChevronRight className=\"h-4 w-4 text-gray-400 group-hover:text-primary transition-all duration-300 group-hover:rotate-12\" />\n                              )}\n                            </div>\n                          </CollapsibleTrigger>\n                          <CollapsibleContent\n                            className=\"mt-1 space-y-1\"\n                            id={`section-${section.id}`}\n                          >\n                            {section.items\n                              .filter(\n                                (item) =>\n                                  isSuperAdmin() ||\n                                  canAccessSidebarItem(item.resource, \"read\"),\n                              )\n                              .map((item) => renderMenuItem(item, true))}\n                          </CollapsibleContent>\n                        </Collapsible>\n                      )}\n                    </div>\n                  ))}\n              </nav>\n            </div>\n          </ScrollArea>\n        </div>\n      </aside>\n    </TooltipProvider>\n  );\n}\n","path":null,"size_bytes":21779,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\";\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\";\nimport { ChevronUp, ChevronDown } from \"lucide-react\";\nimport { Button } from \"./button\";\n\nimport { cn } from \"@/lib/utils\";\n\ninterface ScrollAreaWithButtonsProps\n  extends React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root> {\n  showScrollButtons?: boolean;\n}\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  ScrollAreaWithButtonsProps\n>(({ className, children, showScrollButtons = false, ...props }, ref) => {\n  const [canScrollUp, setCanScrollUp] = React.useState(false);\n  const [canScrollDown, setCanScrollDown] = React.useState(false);\n  const viewportRef = React.useRef<HTMLDivElement>(null);\n\n  const checkScrollability = React.useCallback(() => {\n    if (!viewportRef.current) return;\n\n    const { scrollTop, scrollHeight, clientHeight } = viewportRef.current;\n    const buffer = 1; // Small buffer to avoid false negatives\n\n    setCanScrollUp(scrollTop > buffer);\n    setCanScrollDown(scrollTop < scrollHeight - clientHeight - buffer);\n  }, []);\n\n  React.useEffect(() => {\n    const viewport = viewportRef.current;\n    if (!viewport || !showScrollButtons) return;\n\n    // Initial check\n    checkScrollability();\n\n    // Listen to scroll and resize\n    viewport.addEventListener(\"scroll\", checkScrollability);\n    const observer = new ResizeObserver(checkScrollability);\n    observer.observe(viewport);\n\n    return () => {\n      viewport.removeEventListener(\"scroll\", checkScrollability);\n      observer.disconnect();\n    };\n  }, [checkScrollability, showScrollButtons]);\n\n  const scrollUp = () => {\n    if (viewportRef.current) {\n      viewportRef.current.scrollBy({ top: -80, behavior: \"smooth\" });\n    }\n  };\n\n  const scrollDown = () => {\n    if (viewportRef.current) {\n      viewportRef.current.scrollBy({ top: 80, behavior: \"smooth\" });\n    }\n  };\n\n  return (\n    <div className=\"relative h-full\">\n      {/* Scroll Up Button */}\n      {showScrollButtons && canScrollUp && (\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={scrollUp}\n          className=\"absolute top-0 left-1/2 transform -translate-x-1/2 z-10 h-8 w-8 p-0 bg-white/90 hover:bg-white shadow-sm border pointer-events-auto transition-all duration-200 hover:scale-105\"\n          style={{ backdropFilter: \"blur(4px)\" }}\n          aria-label=\"Scroll up\"\n          data-testid=\"scroll-up-button\"\n        >\n          <ChevronUp className=\"h-4 w-4 text-gray-600\" />\n        </Button>\n      )}\n\n      {/* Radix ScrollArea Root */}\n      <ScrollAreaPrimitive.Root\n        ref={ref}\n        className={cn(\"relative overflow-hidden\", className)}\n        {...props}\n      >\n        <ScrollAreaPrimitive.Viewport\n          ref={viewportRef}\n          className=\"h-full w-full rounded-[inherit]\"\n        >\n          {children}\n        </ScrollAreaPrimitive.Viewport>\n        <ScrollBar orientation=\"vertical\" />\n        <ScrollAreaPrimitive.Corner />\n      </ScrollAreaPrimitive.Root>\n\n      {/* Scroll Down Button */}\n      {showScrollButtons && canScrollDown && (\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={scrollDown}\n          className=\"absolute bottom-0 left-1/2 transform -translate-x-1/2 z-10 h-8 w-8 p-0 bg-white/90 hover:bg-white shadow-sm border pointer-events-auto transition-all duration-200 hover:scale-105\"\n          style={{ backdropFilter: \"blur(4px)\" }}\n          aria-label=\"Scroll down\"\n          data-testid=\"scroll-down-button\"\n        >\n          <ChevronDown className=\"h-4 w-4 text-gray-600\" />\n        </Button>\n      )}\n    </div>\n  );\n});\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName;\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\"\n        ? \"h-full w-2.5 border-l border-l-transparent p-[1px] mr-0.5\"\n        : \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className,\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb\n      className={cn(\n        \"relative flex-1 rounded-full bg-border hover:bg-gray-300 transition-colors duration-200\",\n        orientation === \"vertical\" ? \"min-h-8\" : \"min-w-8\",\n      )}\n    />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n));\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName;\n\nexport { ScrollArea, ScrollBar };\n","path":null,"size_bytes":4740,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/enhanced-stock-item-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useUnits } from \"@/hooks/useUnits\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport { ChevronDown, Plus, AlertCircle, Package } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\ninterface StockItemFormProps {\n  isOpen: boolean;\n  onClose: () => void;\n  editingItem?: any;\n  existingItems?: any[]; // üëà ADDED: for smart invCode generation\n}\n\ninterface CategoryDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onCategoryCreated: () => void;\n}\n\nfunction CategoryDialog({\n  isOpen,\n  onClose,\n  onCategoryCreated,\n}: CategoryDialogProps) {\n  const { toast } = useToast();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const createCategoryMutation = useMutation({\n    mutationFn: (data: { name: string; description?: string }) =>\n      apiRequest(\"POST\", \"/api/inventory-categories\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/inventory-categories\"],\n      });\n      toast({\n        title: \"Success\",\n        description: \"Category created successfully\",\n      });\n      onCategoryCreated();\n      onClose();\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create category\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n\n    const formData = new FormData(e.target as HTMLFormElement);\n    const name = formData.get(\"name\") as string;\n    const description = formData.get(\"description\") as string;\n\n    if (!name.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Category name is required\",\n        variant: \"destructive\",\n      });\n      setIsSubmitting(false);\n      return;\n    }\n\n    createCategoryMutation.mutate({\n      name: name.trim(),\n      description: description.trim(),\n    });\n    setIsSubmitting(false);\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Add New Category</DialogTitle>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"categoryName\">Category Name *</Label>\n            <Input\n              id=\"categoryName\"\n              name=\"name\"\n              placeholder=\"Enter category name\"\n              required\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"categoryDescription\">Description</Label>\n            <Input\n              id=\"categoryDescription\"\n              name=\"description\"\n              placeholder=\"Enter description (optional)\"\n            />\n          </div>\n          <div className=\"flex justify-end space-x-2\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={isSubmitting}>\n              {isSubmitting ? \"Creating...\" : \"Create Category\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport function EnhancedStockItemForm({\n  isOpen,\n  onClose,\n  editingItem,\n  existingItems = [], // üëà default to empty array\n}: StockItemFormProps) {\n  const { toast } = useToast();\n  const { symbol } = useCurrency();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showAdditionalDetails, setShowAdditionalDetails] = useState(false);\n  const [showCategoryDialog, setShowCategoryDialog] = useState(false);\n\n  const [formData, setFormData] = useState({\n    name: \"\",\n    primaryUnitId: \"\",\n    secondaryUnitId: \"\",\n    conversionRate: \"\",\n    costPerUnit: \"\",\n    group: \"\",\n    minLevel: \"\",\n    openingStock: \"\",\n    purchasedQuantity: \"\",\n    consumedQuantity: \"\",\n    closingStock: \"\",\n    supplier: \"\",\n    notes: \"\",\n    invCode: \"\",\n  });\n\n  const [validationErrors, setValidationErrors] = useState<\n    Record<string, string>\n  >({});\n\n  const {\n    data: units = [],\n    isLoading: unitsLoading,\n    error: unitsError,\n  } = useUnits();\n\n  const { data: categories = [] } = useQuery({\n    queryKey: [\"/api/inventory-categories\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/inventory-categories\"),\n  });\n\n  // Fetch ingredients from recipes and inventory\n  const { data: ingredients = [] } = useQuery({\n    queryKey: [\"/api/ingredients/all\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/ingredients\"),\n  });\n\n  // Filter active units\n  const activeUnits = Array.isArray(units)\n    ? units.filter((unit: any) => unit && unit.isActive)\n    : [];\n\n  useEffect(() => {\n    if (editingItem) {\n      // Determine group value from editingItem\n      let groupValue = \"\";\n      if (editingItem.categoryId) {\n        groupValue = editingItem.categoryId.toString();\n      } else if (editingItem.isIngredient) {\n        groupValue = \"ingredients\";\n      } else if (editingItem.group && editingItem.group !== \"uncategorized\") {\n        groupValue = editingItem.group;\n      }\n\n      setFormData({\n        name: editingItem.name || \"\",\n        primaryUnitId: editingItem.unitId?.toString() || \"\",\n        secondaryUnitId: editingItem.secondaryUnitId?.toString() || \"\",\n        conversionRate: editingItem.conversionRate || \"\",\n        costPerUnit: editingItem.costPerUnit || \"\",\n        group: groupValue,\n        minLevel: editingItem.minLevel || \"\",\n        openingStock:\n          editingItem.openingStock || editingItem.currentStock || \"\",\n        purchasedQuantity: editingItem.purchasedQuantity || \"0\",\n        consumedQuantity: editingItem.consumedQuantity || \"0\",\n        closingStock:\n          editingItem.closingStock || editingItem.currentStock || \"\",\n        supplier: editingItem.supplier || \"\",\n        notes: editingItem.notes || \"\",\n        invCode: editingItem.invCode || \"\", // üëà keep original, don't fallback to ID\n      });\n    } else {\n      setFormData({\n        name: \"\",\n        primaryUnitId: \"\",\n        secondaryUnitId: \"\",\n        conversionRate: \"\",\n        costPerUnit: \"\",\n        group: \"\",\n        minLevel: \"\",\n        openingStock: \"\",\n        purchasedQuantity: \"0\",\n        consumedQuantity: \"0\",\n        closingStock: \"\",\n        supplier: \"\",\n        notes: \"\",\n        invCode: \"\",\n      });\n    }\n  }, [editingItem, isOpen]);\n\n  // Auto-calculate closing stock\n  useEffect(() => {\n    const opening = parseFloat(formData.openingStock) || 0;\n    const purchased = parseFloat(formData.purchasedQuantity) || 0;\n    const consumed = parseFloat(formData.consumedQuantity) || 0;\n    const closing = opening + purchased - consumed;\n\n    setFormData((prev) => ({\n      ...prev,\n      closingStock: closing.toString(),\n    }));\n  }, [\n    formData.openingStock,\n    formData.purchasedQuantity,\n    formData.consumedQuantity,\n  ]);\n\n  const saveMutation = useMutation({\n    mutationFn: (data: any) => {\n      const url = editingItem\n        ? `/api/inventory/${editingItem.id}`\n        : \"/api/inventory\";\n      const method = editingItem ? \"PUT\" : \"POST\";\n      return apiRequest(method, url, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory/all\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/ingredients\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/low-stock\"] });\n      toast({\n        title: \"Success\",\n        description: `Stock item ${editingItem ? \"updated\" : \"created\"} successfully`,\n      });\n      onClose();\n    },\n    onError: (error: any) => {\n      let errorMessage = `Failed to ${editingItem ? \"update\" : \"create\"} stock item`;\n\n      if (error.message?.includes(\"Item with this name already exists\")) {\n        setValidationErrors({\n          name: \"Item with this name already exists. Please use a different name.\",\n        });\n        errorMessage = \"Item name already exists\";\n      } else if (error.message?.includes(\"duplicate\")) {\n        setValidationErrors({\n          name: \"This item name is already in use. Please choose a different name.\",\n        });\n        errorMessage = \"Duplicate item name\";\n      } else if (error.message) {\n        errorMessage = error.message;\n      }\n\n      toast({\n        title: \"Error\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleInputChange = (field: string, value: string) => {\n    setFormData((prev) => ({\n      ...prev,\n      [field]: value,\n    }));\n\n    if (validationErrors[field]) {\n      setValidationErrors((prev) => {\n        const newErrors = { ...prev };\n        delete newErrors[field];\n        return newErrors;\n      });\n    }\n  };\n\n  const getConversionInfoText = () => {\n    if (!formData.primaryUnitId) {\n      return \"Select a Primary Unit\";\n    }\n\n    if (!formData.secondaryUnitId) {\n      return \"No Secondary Unit Selected\";\n    }\n\n    if (formData.primaryUnitId === formData.secondaryUnitId) {\n      return \"Units must be different\";\n    }\n\n    const primaryUnit = activeUnits.find(\n      (u: any) => u.id.toString() === formData.primaryUnitId,\n    );\n    const secondaryUnit = activeUnits.find(\n      (u: any) => u.id.toString() === formData.secondaryUnitId,\n    );\n\n    if (!primaryUnit || !secondaryUnit) {\n      return \"Invalid unit selection\";\n    }\n\n    const rate = formData.conversionRate?.trim();\n    if (!rate) {\n      return \"Enter a conversion rate\";\n    }\n\n    const numRate = parseFloat(rate);\n    if (isNaN(numRate) || numRate <= 0) {\n      return \"Enter a valid positive number\";\n    }\n\n    return `1 ${primaryUnit.name} = ${numRate} ${secondaryUnit.name}`;\n  };\n\n  const validateForm = () => {\n    const errors: Record<string, string> = {};\n\n    if (!formData.name.trim()) {\n      errors.name = \"Item name is required\";\n    }\n\n    if (!formData.primaryUnitId) {\n      errors.primaryUnitId = \"Primary unit is required\";\n    }\n\n    if (!formData.costPerUnit || parseFloat(formData.costPerUnit) <= 0) {\n      errors.costPerUnit = \"Valid cost per unit is required\";\n    }\n\n    if (!formData.minLevel || parseFloat(formData.minLevel) < 0) {\n      errors.minLevel = \"Minimum level must be 0 or greater\";\n    }\n\n    if (!formData.openingStock || parseFloat(formData.openingStock) < 0) {\n      errors.openingStock = \"Valid opening stock is required\";\n    }\n\n    if (\n      formData.secondaryUnitId &&\n      (!formData.conversionRate || parseFloat(formData.conversionRate) <= 0)\n    ) {\n      errors.conversionRate =\n        \"Valid conversion rate is required when secondary unit is selected\";\n    }\n\n    // Optional: Validate invCode format if provided\n    if (\n      formData.invCode.trim() &&\n      !/^INV-\\d{4,}$/.test(formData.invCode.trim())\n    ) {\n      errors.invCode = \"Invalid format. Use INV-XXXX (e.g., INV-1000)\";\n    }\n\n    return errors;\n  };\n\n  // üîë SMART 4-DIGIT INV CODE GENERATOR\n  const generateNextInvCode = (): string => {\n    // Extract numbers from existing invCodes like \"INV-1001\"\n    const existingNumbers = (existingItems || [])\n      .map((item: any) => {\n        const match = (item.invCode || \"\").match(/^INV-(\\d+)$/i);\n        return match ? parseInt(match[1], 10) : null;\n      })\n      .filter((n): n is number => n !== null);\n\n    // Start from 999 ‚Üí next is 1000\n    const maxNumber =\n      existingNumbers.length > 0 ? Math.max(...existingNumbers) : 999;\n\n    return `INV-${maxNumber + 1}`;\n  };\n\n  // üîë Button click handler\n  const generateInvCode = () => {\n    if (!editingItem) {\n      // Only for new items\n      const nextCode = generateNextInvCode();\n      handleInputChange(\"invCode\", nextCode);\n    }\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n\n    const errors = validateForm();\n    setValidationErrors(errors);\n\n    if (Object.keys(errors).length > 0) {\n      setIsSubmitting(false);\n      return;\n    }\n\n    // üîë DETERMINE FINAL INV CODE\n    let invCodeToUse = formData.invCode.trim();\n    if (!invCodeToUse) {\n      invCodeToUse = generateNextInvCode(); // ‚úÖ Smart 4-digit fallback\n    }\n\n    const selectedPrimaryUnit = activeUnits.find(\n      (u: any) => u.id.toString() === formData.primaryUnitId,\n    );\n\n    const submitData = {\n      name: formData.name.trim(),\n      invCode: invCodeToUse, // ‚úÖ Now always INV-1000, INV-1001, etc.\n      currentStock: parseFloat(formData.closingStock),\n      openingStock: parseFloat(formData.openingStock),\n      purchasedQuantity: parseFloat(formData.purchasedQuantity) || 0,\n      consumedQuantity: parseFloat(formData.consumedQuantity) || 0,\n      closingStock: parseFloat(formData.closingStock),\n      minLevel: parseFloat(formData.minLevel),\n      unit: selectedPrimaryUnit?.abbreviation || \"pcs\",\n      unitId: parseInt(formData.primaryUnitId),\n      secondaryUnitId: formData.secondaryUnitId\n        ? parseInt(formData.secondaryUnitId)\n        : null,\n      conversionRate: formData.secondaryUnitId\n        ? parseFloat(formData.conversionRate)\n        : null,\n      costPerUnit: parseFloat(formData.costPerUnit),\n      supplier: formData.supplier.trim() || null,\n      group: formData.group || null,\n      categoryId:\n        formData.group && !isNaN(parseInt(formData.group))\n          ? parseInt(formData.group)\n          : null,\n      notes: formData.notes.trim() || null,\n      lastRestocked: new Date().toISOString(),\n      isIngredient: formData.group === \"ingredients\",\n    };\n\n    saveMutation.mutate(submitData);\n    setIsSubmitting(false);\n  };\n\n  const handleCategoryCreated = () => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/inventory-categories\"] });\n  };\n\n  return (\n    <>\n      <Dialog open={isOpen} onOpenChange={onClose}>\n        <DialogContent className=\"sm:max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-xl font-semibold text-center flex items-center gap-2\">\n              <Package className=\"h-5 w-5\" />\n              {editingItem ? \"Edit Stock Item\" : \"Create Stock Item\"}\n            </DialogTitle>\n          </DialogHeader>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {/* Basic Information */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base\">Basic Information</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {/* Inventory Code and Item Name */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"invCode\" className=\"text-sm font-medium\">\n                      Inventory Code <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        id=\"invCode\"\n                        value={formData.invCode}\n                        onChange={(e) =>\n                          handleInputChange(\"invCode\", e.target.value)\n                        }\n                        placeholder=\"e.g. INV-1000\"\n                        className={\n                          validationErrors.invCode ? \"border-red-500\" : \"\"\n                        }\n                      />\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        onClick={generateInvCode}\n                        disabled={!!editingItem} // Disable during edit\n                      >\n                        Generate\n                      </Button>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      Leave blank to auto-generate (e.g. INV-1001)\n                    </p>\n                    {validationErrors.invCode && (\n                      <p className=\"text-red-500 text-xs mt-1\">\n                        {validationErrors.invCode}\n                      </p>\n                    )}\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"itemName\" className=\"text-sm font-medium\">\n                      Item Name <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <Input\n                      id=\"itemName\"\n                      value={formData.name}\n                      onChange={(e) =>\n                        handleInputChange(\"name\", e.target.value)\n                      }\n                      placeholder=\"Enter unique name (e.g., Flour)\"\n                      className={validationErrors.name ? \"border-red-500\" : \"\"}\n                      required\n                    />\n                    {validationErrors.name && (\n                      <p className=\"text-red-500 text-xs mt-1\">\n                        {validationErrors.name}\n                      </p>\n                    )}\n                  </div>\n                </div>\n\n                {/* Rest of the form remains unchanged ‚Äî omitted for brevity */}\n                {/* Primary Unit, Group, Secondary Unit, Cost, Stock, etc. */}\n                {/* ... (keep all existing JSX from your original code) ... */}\n\n                {/* üîÅ Here‚Äôs the rest of the form ‚Äî just paste your original JSX below */}\n                {/* (We only changed invCode logic ‚Äî all other fields remain intact) */}\n\n                {/* Primary Unit and Group */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label\n                      htmlFor=\"primaryUnit\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Primary Unit <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <Select\n                      value={formData.primaryUnitId || \"\"}\n                      onValueChange={(value) => {\n                        try {\n                          if (value && value !== \"none\") {\n                            handleInputChange(\"primaryUnitId\", value);\n                          }\n                        } catch (error) {\n                          console.error(\"Error updating primary unit:\", error);\n                        }\n                      }}\n                      required\n                    >\n                      <SelectTrigger\n                        className={\n                          validationErrors.primaryUnitId ? \"border-red-500\" : \"\"\n                        }\n                      >\n                        <SelectValue placeholder=\"Select Primary Unit\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {unitsLoading ? (\n                          <SelectItem value=\"loading\" disabled>\n                            Loading units...\n                          </SelectItem>\n                        ) : unitsError ? (\n                          <SelectItem value=\"error\" disabled>\n                            Error loading units\n                          </SelectItem>\n                        ) : activeUnits.length > 0 ? (\n                          activeUnits.map((unit: any) => (\n                            <SelectItem\n                              key={unit.id}\n                              value={unit.id.toString()}\n                            >\n                              {unit.name} ({unit.abbreviation})\n                            </SelectItem>\n                          ))\n                        ) : (\n                          <SelectItem value=\"none\" disabled>\n                            No units available\n                          </SelectItem>\n                        )}\n                      </SelectContent>\n                    </Select>\n                    {validationErrors.primaryUnitId && (\n                      <p className=\"text-red-500 text-xs mt-1\">\n                        {validationErrors.primaryUnitId}\n                      </p>\n                    )}\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"group\" className=\"text-sm font-medium\">\n                      Group/Category <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <div className=\"flex gap-2\">\n                      <Select\n                        value={formData.group}\n                        onValueChange={(value) =>\n                          handleInputChange(\"group\", value)\n                        }\n                      >\n                        <SelectTrigger className=\"flex-1\">\n                          <SelectValue placeholder=\"Select Group\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"ingredients\">\n                            Ingredients\n                          </SelectItem>\n                          <SelectItem value=\"raw-materials\">\n                            Raw Materials\n                          </SelectItem>\n                          <SelectItem value=\"packaging\">Packaging</SelectItem>\n                          <SelectItem value=\"spices\">Spices</SelectItem>\n                          <SelectItem value=\"dairy\">Dairy</SelectItem>\n                          <SelectItem value=\"flour\">Flour</SelectItem>\n                          <SelectItem value=\"sweeteners\">Sweeteners</SelectItem>\n                          <SelectItem value=\"supplies\">Supplies</SelectItem>\n                          {categories.map((category: any) => (\n                            <SelectItem\n                              key={category.id}\n                              value={category.id.toString()}\n                            >\n                              {category.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        size=\"icon\"\n                        onClick={() => setShowCategoryDialog(true)}\n                      >\n                        <Plus className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Secondary Unit and Conversion */}\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div>\n                    <Label\n                      htmlFor=\"secondaryUnit\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Secondary Unit\n                    </Label>\n                    <Select\n                      value={formData.secondaryUnitId || \"none\"}\n                      onValueChange={(value) =>\n                        handleInputChange(\n                          \"secondaryUnitId\",\n                          value === \"none\" ? \"\" : value,\n                        )\n                      }\n                    >\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"No Secondary Unit\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"none\">No Secondary Unit</SelectItem>\n                        {activeUnits\n                          .filter(\n                            (unit: any) =>\n                              unit.id.toString() !== formData.primaryUnitId,\n                          )\n                          .map((unit: any) => (\n                            <SelectItem\n                              key={unit.id}\n                              value={unit.id.toString()}\n                            >\n                              {unit.name} ({unit.abbreviation})\n                            </SelectItem>\n                          ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  {formData.secondaryUnitId && (\n                    <div>\n                      <Label\n                        htmlFor=\"conversionRate\"\n                        className=\"text-sm font-medium\"\n                      >\n                        Conversion Rate <span className=\"text-red-500\">*</span>\n                      </Label>\n                      <Input\n                        id=\"conversionRate\"\n                        type=\"number\"\n                        step=\"0.000001\"\n                        min=\"0.000001\"\n                        value={formData.conversionRate}\n                        onChange={(e) =>\n                          handleInputChange(\"conversionRate\", e.target.value)\n                        }\n                        placeholder=\"e.g., 50\"\n                        className={\n                          validationErrors.conversionRate\n                            ? \"border-red-500\"\n                            : \"\"\n                        }\n                        required\n                      />\n                      {validationErrors.conversionRate && (\n                        <p className=\"text-red-500 text-xs mt-1\">\n                          {validationErrors.conversionRate}\n                        </p>\n                      )}\n                    </div>\n                  )}\n\n                  {formData.secondaryUnitId && (\n                    <div>\n                      <Label className=\"text-sm font-medium\">\n                        Conversion Info\n                      </Label>\n                      <div className=\"mt-1 p-2 bg-blue-50 rounded text-sm text-blue-700 min-h-[40px] flex items-center\">\n                        {getConversionInfoText()}\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Cost Per Unit and Minimum Level */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label\n                      htmlFor=\"costPerUnit\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Cost Per Unit <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <div className=\"flex mt-1\">\n                      <span className=\"inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm\">\n                        {symbol}\n                      </span>\n                      <Input\n                        id=\"costPerUnit\"\n                        type=\"number\"\n                        step=\"0.01\"\n                        min=\"0.01\"\n                        value={formData.costPerUnit}\n                        onChange={(e) =>\n                          handleInputChange(\"costPerUnit\", e.target.value)\n                        }\n                        placeholder=\"0.00\"\n                        className={`rounded-l-none ${validationErrors.costPerUnit ? \"border-red-500\" : \"\"}`}\n                        required\n                      />\n                    </div>\n                    {validationErrors.costPerUnit && (\n                      <p className=\"text-red-500 text-xs mt-1\">\n                        {validationErrors.costPerUnit}\n                      </p>\n                    )}\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"minLevel\" className=\"text-sm font-medium\">\n                      Minimum Level <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <Input\n                      id=\"minLevel\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={formData.minLevel}\n                      onChange={(e) =>\n                        handleInputChange(\"minLevel\", e.target.value)\n                      }\n                      placeholder=\"0.00\"\n                      className={\n                        validationErrors.minLevel ? \"border-red-500\" : \"\"\n                      }\n                      required\n                    />\n                    {validationErrors.minLevel && (\n                      <p className=\"text-red-500 text-xs mt-1\">\n                        {validationErrors.minLevel}\n                      </p>\n                    )}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Stock Management Section */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base\">Stock Management</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <div>\n                    <Label\n                      htmlFor=\"openingStock\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Opening Stock <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <Input\n                      id=\"openingStock\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={formData.openingStock}\n                      onChange={(e) =>\n                        handleInputChange(\"openingStock\", e.target.value)\n                      }\n                      placeholder=\"0.00\"\n                      className={\n                        validationErrors.openingStock ? \"border-red-500\" : \"\"\n                      }\n                      required\n                    />\n                    {validationErrors.openingStock && (\n                      <p className=\"text-red-500 text-xs mt-1\">\n                        {validationErrors.openingStock}\n                      </p>\n                    )}\n                  </div>\n\n                  <div>\n                    <Label\n                      htmlFor=\"purchasedQuantity\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Purchased\n                    </Label>\n                    <Input\n                      id=\"purchasedQuantity\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={formData.purchasedQuantity}\n                      onChange={(e) =>\n                        handleInputChange(\"purchasedQuantity\", e.target.value)\n                      }\n                      placeholder=\"0.00\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label\n                      htmlFor=\"consumedQuantity\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Consumed/Used\n                    </Label>\n                    <Input\n                      id=\"consumedQuantity\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={formData.consumedQuantity}\n                      onChange={(e) =>\n                        handleInputChange(\"consumedQuantity\", e.target.value)\n                      }\n                      placeholder=\"0.00\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label\n                      htmlFor=\"closingStock\"\n                      className=\"text-sm font-medium\"\n                    >\n                      Closing Stock\n                    </Label>\n                    <Input\n                      id=\"closingStock\"\n                      value={parseFloat(formData.closingStock || \"0\").toFixed(\n                        2,\n                      )}\n                      placeholder=\"0.00\"\n                      className=\"bg-gray-50\"\n                      readOnly\n                    />\n                  </div>\n                </div>\n\n                {/* Stock Calculation Display */}\n                <div className=\"mt-4 p-4 bg-blue-50 rounded-lg\">\n                  <h4 className=\"font-medium text-blue-900 mb-2\">\n                    Stock Calculation\n                  </h4>\n                  <div className=\"text-sm text-blue-800\">\n                    <p>\n                      Opening Stock:{\" \"}\n                      {parseFloat(formData.openingStock || \"0\").toFixed(2)}\n                    </p>\n                    <p>\n                      + Purchased:{\" \"}\n                      {parseFloat(formData.purchasedQuantity || \"0\").toFixed(2)}\n                    </p>\n                    <p>\n                      - Consumed:{\" \"}\n                      {parseFloat(formData.consumedQuantity || \"0\").toFixed(2)}\n                    </p>\n                    <hr className=\"my-2 border-blue-200\" />\n                    <p className=\"font-medium\">\n                      = Closing Stock:{\" \"}\n                      {parseFloat(formData.closingStock || \"0\").toFixed(2)}\n                    </p>\n                  </div>\n                </div>\n\n                {/* Warning for minimum level */}\n                {parseFloat(formData.closingStock || \"0\") <=\n                  parseFloat(formData.minLevel || \"0\") &&\n                  parseFloat(formData.closingStock || \"0\") > 0 && (\n                    <Alert className=\"mt-4 border-yellow-500 bg-yellow-50\">\n                      <AlertCircle className=\"h-4 w-4 text-yellow-600\" />\n                      <AlertDescription className=\"text-yellow-800\">\n                        Warning: Closing stock is at or below minimum level\n                      </AlertDescription>\n                    </Alert>\n                  )}\n              </CardContent>\n            </Card>\n\n            {/* Additional Details */}\n            <Collapsible\n              open={showAdditionalDetails}\n              onOpenChange={setShowAdditionalDetails}\n            >\n              <CollapsibleTrigger asChild>\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  className=\"w-full justify-between p-0 h-auto font-normal text-blue-600 hover:text-blue-700\"\n                >\n                  Additional Details\n                  <ChevronDown\n                    className={`h-4 w-4 transition-transform ${showAdditionalDetails ? \"rotate-180\" : \"\"}`}\n                  />\n                </Button>\n              </CollapsibleTrigger>\n              <CollapsibleContent className=\"space-y-4 mt-4\">\n                <Card>\n                  <CardContent className=\"pt-6 space-y-4\">\n                    <div>\n                      <Label htmlFor=\"supplier\" className=\"text-sm font-medium\">\n                        Supplier\n                      </Label>\n                      <Input\n                        id=\"supplier\"\n                        value={formData.supplier}\n                        onChange={(e) =>\n                          handleInputChange(\"supplier\", e.target.value)\n                        }\n                        placeholder=\"Enter supplier name\"\n                      />\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"notes\" className=\"text-sm font-medium\">\n                        Notes\n                      </Label>\n                      <Input\n                        id=\"notes\"\n                        value={formData.notes}\n                        onChange={(e) =>\n                          handleInputChange(\"notes\", e.target.value)\n                        }\n                        placeholder=\"Additional notes\"\n                      />\n                    </div>\n                  </CardContent>\n                </Card>\n              </CollapsibleContent>\n            </Collapsible>\n\n            {/* Action Buttons */}\n            <div className=\"flex justify-between pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={isSubmitting}\n                className=\"bg-green-500 hover:bg-green-600 text-white min-w-[120px]\"\n              >\n                {isSubmitting ? \"Saving...\" : \"Save Item\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <CategoryDialog\n        isOpen={showCategoryDialog}\n        onClose={() => setShowCategoryDialog(false)}\n        onCategoryCreated={handleCategoryCreated}\n      />\n    </>\n  );\n}\n","path":null,"size_bytes":37067,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"server/routes.ts":{"content":"import express from \"express\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport { eq, desc, asc, like, and, or, sql, count, gte, lte } from \"drizzle-orm\";\nimport { db } from \"./db\";\nimport { logger } from \"./lib/logger\";\nimport {\n  users,\n  products,\n  categories,\n  inventoryItems,\n  orders,\n  orderItems,\n  sales,\n  saleItems,\n  purchases,\n  purchaseItems,\n  customers,\n  parties,\n  ledgerTransactions,\n  productionSchedule,\n  productionScheduleHistory,\n  inventoryTransactions,\n  expenses,\n  assets,\n  permissions,\n  rolePermissions,\n  userPermissions,\n  roleModules,\n  userModuleOverrides,\n  settings,\n  loginLogs,\n  auditLogs,\n  staff,\n  attendance,\n  salaryPayments,\n  leaveRequests,\n  staffSchedules,\n  productionScheduleLabels,\n  salesReturns,\n  purchaseReturns,\n  units,\n  productIngredients,\n  stockBatches,\n  stockBatchConsumptions,\n  dailyInventorySnapshots,\n  inventoryCostHistory,\n  printedLabels,\n} from \"@shared/schema\";\nimport {\n  insertProductSchema,\n  insertCategorySchema,\n  insertCustomerSchema,\n  insertPurchaseSchema,\n  insertExpenseSchema,\n  insertPermissionSchema,\n  insertRolePermissionSchema,\n  insertUserPermissionSchema,\n  insertLedgerTransactionSchema,\n  insertLoginLogSchema,\n  insertAuditLogSchema,\n  insertStaffSchema,\n  insertAttendanceSchema,\n  insertSalaryPaymentSchema,\n  insertLeaveRequestSchema,\n  insertStaffScheduleSchema,\n  insertSalesReturnSchema,\n  insertPurchaseReturnSchema,\n  insertStockBatchSchema,\n  insertStockBatchConsumptionSchema,\n  insertDailyInventorySnapshotSchema,\n  insertInventoryCostHistorySchema,\n  insertRoleModuleSchema,\n  insertUserModuleOverrideSchema,\n  insertPrintedLabelSchema,\n} from \"@shared/schema\";\nimport { isAuthenticated } from \"./localAuth\";\nimport { storage } from \"./lib/storage\";\nimport { trackUserActivity } from \"./lib/activityTracker\";\nimport {\n  getNotifications,\n  markNotificationAsRead,\n  markAllNotificationsAsRead,\n  clearNotification,\n  sendTestNotification,\n  notifyNewOrder,\n  checkLowStockAlerts,\n  checkProductionScheduleAlerts,\n  notifySystemAlert,\n} from \"./notifications\";\nimport bcrypt from \"bcryptjs\";\nimport fsSync from \"fs\";\n\nconst router = express.Router();\n\n// Utility function for pagination and sorting\nfunction buildPaginatedQuery(\n  baseQuery: any,\n  options: {\n    page?: number;\n    limit?: number;\n    sortBy?: string;\n    sortOrder?: \"asc\" | \"desc\";\n    search?: string;\n    searchFields?: string[];\n  },\n) {\n  const {\n    page = 1,\n    limit = 10,\n    sortBy,\n    sortOrder = \"desc\",\n    search,\n    searchFields = [],\n  } = options;\n\n  const offset = (Number(page) - 1) * Number(limit);\n\n  let query = baseQuery;\n\n  // Apply search if provided\n  if (search && searchFields.length > 0) {\n    const searchConditions = searchFields.map((field) =>\n      like(sql.identifier(field), `%${search}%`),\n    );\n    query = query.where(or(...searchConditions));\n  }\n\n  // Apply sorting\n  if (sortBy) {\n    const sortColumn = sql.identifier(sortBy);\n    query = query.orderBy(\n      sortOrder === \"asc\" ? asc(sortColumn) : desc(sortColumn),\n    );\n  }\n\n  // Apply pagination\n  query = query.limit(limit).offset(offset);\n\n  return query;\n}\n\n// Notification endpoints\nrouter.get(\"/notifications\", isAuthenticated, async (req, res) => {\n  try {\n    const notifications = getNotifications();\n    res.json(notifications);\n  } catch (error) {\n    console.error(\"Error fetching notifications:\", error);\n    res.status(500).json({ error: \"Failed to fetch notifications\" });\n  }\n});\n\nrouter.put(\"/notifications/:id/read\", isAuthenticated, async (req, res) => {\n  try {\n    const { id } = req.params;\n    const success = markNotificationAsRead(id);\n\n    if (success) {\n      res.json({ success: true });\n    } else {\n      res.status(404).json({ error: \"Notification not found\" });\n    }\n  } catch (error) {\n    console.error(\"Error marking notification as read:\", error);\n    res.status(500).json({ error: \"Failed to mark notification as read\" });\n  }\n});\n\nrouter.put(\n  \"/api/notifications/mark-all-read\",\n  isAuthenticated,\n  async (req, res) => {\n    try {\n      markAllNotificationsAsRead();\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error marking all notifications as read:\", error);\n      res\n        .status(500)\n        .json({ error: \"Failed to mark all notifications as read\" });\n    }\n  },\n);\n\nrouter.delete(\"/notifications/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const { id } = req.params;\n\n    // Only allow deletion of valid notification types\n    const notification = getNotifications().find(n => n.id === id);\n    if (notification && [\"order\", \"stock\", \"production\"].includes(notification.type)) {\n      const success = clearNotification(id);\n      if (success) {\n        res.json({ success: true });\n      } else {\n        res.status(404).json({ error: \"Notification not found\" });\n      }\n    } else {\n      res.status(400).json({ error: \"Cannot delete system or test notifications\" });\n    }\n  } catch (error) {\n    console.error(\"Error clearing notification:\", error);\n    res.status(500).json({ error: \"Failed to clear notification\" });\n  }\n});\n\nrouter.post(\"/notifications/test\", isAuthenticated, async (req, res) => {\n  try {\n    sendTestNotification();\n    res.json({ success: true, message: \"Test notification sent\" });\n  } catch (error) {\n    console.error(\"Error sending test notification:\", error);\n    res.status(500).json({ error: \"Failed to send test notification\" });\n  }\n});\n\nrouter.post(\n  \"/api/notifications/check-alerts\",\n  isAuthenticated,\n  async (req, res) => {\n    try {\n      await checkLowStockAlerts();\n      await checkProductionScheduleAlerts();\n      res.json({ success: true, message: \"Alert checks completed\" });\n    } catch (error) {\n      console.error(\"Error checking alerts:\", error);\n      res.status(500).json({ error: \"Failed to check alerts\" });\n    }\n  },\n);\n\n// Enhanced table endpoints with pagination and sorting\n\n// Products with pagination and sorting\nrouter.get(\"/products/paginated\", isAuthenticated, async (req, res) => {\n  // Ensure JSON response\n  res.setHeader('Content-Type', 'application/json');\n\n  try {\n    const {\n      page = 1,\n      limit = 10,\n      sortBy = \"id\",\n      sortOrder = \"desc\",\n      search,\n    } = req.query;\n\n    const searchFields = [\"name\", \"sku\", \"description\"];\n    const offset = (Number(page) - 1) * Number(limit);\n\n    let query = db.select().from(products);\n    let countQuery = db.select({ count: count() }).from(products);\n\n    // Apply search\n    if (search) {\n      const searchConditions = searchFields.map((field) =>\n        like(products[field as keyof typeof products], `%${search}%`),\n      );\n      const searchWhere = or(...searchConditions);\n      query = query.where(searchWhere);\n      countQuery = countQuery.where(searchWhere);\n    }\n\n    // Apply sorting\n    const sortColumn = products[sortBy as keyof typeof products];\n    if (sortColumn) {\n      query = query.orderBy(\n        sortOrder === \"asc\" ? asc(sortColumn) : desc(sortColumn),\n      );\n    }\n\n    // Apply pagination\n    query = query.limit(Number(limit)).offset(offset);\n\n    const [data, totalResult] = await Promise.all([query, countQuery]);\n\n    const total = totalResult[0]?.count || 0;\n    const totalPages = Math.ceil(total / Number(limit));\n\n    console.log(`‚úÖ Returning ${data.length} products with pagination`);\n    return res.json({\n      success: true,\n      data,\n      pagination: {\n        currentPage: Number(page),\n        totalPages,\n        totalItems: total,\n        pageSize: Number(limit),\n      },\n    });\n  } catch (error) {\n    console.error(\"‚ùå Error fetching paginated products:\", error);\n    logger.error(\"Error fetching paginated products\", error as Error, { module: 'API' });\n    return res.status(500).json({ \n      error: \"Failed to fetch products\",\n      message: error instanceof Error ? error.message : String(error),\n      success: false,\n      data: [],\n      pagination: {\n        currentPage: 1,\n        totalPages: 0,\n        totalItems: 0,\n        pageSize: Number(req.query.limit || 10),\n      }\n    });\n  }\n});\n\n// Customers endpoint - returns all customers\nrouter.get(\"/customers\", isAuthenticated, async (req, res) => {\n  try {\n    logger.api('/customers', 'Fetching all customers', true);\n    const allCustomers = await db\n      .select()\n      .from(customers)\n      .orderBy(desc(customers.createdAt));\n\n    logger.db('SELECT', 'customers', true, allCustomers.length);\n    res.json(allCustomers);\n  } catch (error) {\n    logger.error(\"Error fetching customers\", error as Error, { module: 'API' });\n    res.status(500).json({ error: \"Failed to fetch customers\" });\n  }\n});\n\n// Customers with pagination and sorting\nrouter.get(\"/customers/paginated\", isAuthenticated, async (req, res) => {\n  try {\n    const {\n      page = 1,\n      limit = 10,\n      sortBy = \"id\",\n      sortOrder = \"desc\",\n      search,\n    } = req.query;\n\n    const searchFields = [\"name\", \"email\", \"phone\"];\n    const offset = (Number(page) - 1) * Number(limit);\n\n    let query = db.select().from(customers);\n    let countQuery = db.select({ count: count() }).from(customers);\n\n    if (search) {\n      const searchConditions = searchFields.map((field) =>\n        like(customers[field as keyof typeof customers], `%${search}%`),\n      );\n      const searchWhere = or(...searchConditions);\n      query = query.where(searchWhere);\n      countQuery = countQuery.where(searchWhere);\n    }\n\n    const sortColumn = customers[sortBy as keyof typeof customers];\n    if (sortColumn) {\n      query = query.orderBy(\n        sortOrder === \"asc\" ? asc(sortColumn) : desc(sortColumn),\n      );\n    }\n\n    query = query.limit(Number(limit)).offset(offset);\n\n    const [data, totalResult] = await Promise.all([query, countQuery]);\n    const total = totalResult[0]?.count || 0;\n\n    res.json({\n      data,\n      pagination: {\n        currentPage: Number(page),\n        totalPages: Math.ceil(total / Number(limit)),\n        totalItems: total,\n        pageSize: Number(limit),\n      },\n    });\n  } catch (error) {\n    console.error(\"Error fetching paginated customers:\", error);\n    res.status(500).json({ error: \"Failed to fetch customers\" });\n  }\n});\n\n// Sales with pagination and sorting\nrouter.get(\"/sales/paginated\", isAuthenticated, async (req, res) => {\n  try {\n    const {\n      page = 1,\n      limit = 10,\n      sortBy = \"id\",\n      sortOrder = \"desc\",\n      search,\n    } = req.query;\n\n    const searchFields = [\"customerName\", \"customerEmail\", \"paymentMethod\"];\n    const offset = (Number(page) - 1) * Number(limit);\n\n    let query = db.select().from(sales);\n    let countQuery = db.select({ count: count() }).from(sales);\n\n    if (search) {\n      const searchConditions = searchFields.map((field) =>\n        like(sales[field as keyof typeof sales], `%${search}%`),\n      );\n      const searchWhere = or(...searchConditions);\n      query = query.where(searchWhere);\n      countQuery = countQuery.where(searchWhere);\n    }\n\n    const sortColumn = sales[sortBy as keyof typeof sales];\n    if (sortColumn) {\n      query = query.orderBy(\n        sortOrder === \"asc\" ? asc(sortColumn) : desc(sortColumn),\n      );\n    }\n\n    query = query.limit(Number(limit)).offset(offset);\n\n    const [data, totalResult] = await Promise.all([query, countQuery]);\n    const total = totalResult[0]?.count || 0;\n\n    res.json({\n      data,\n      pagination: {\n        currentPage: Number(page),\n        totalPages: Math.ceil(total / Number(limit)),\n        totalItems: total,\n        pageSize: Number(limit),\n      },\n    });\n  } catch (error) {\n    console.error(\"Error fetching paginated sales:\", error);\n    res.status(500).json({ error: \"Failed to fetch sales\" });\n  }\n});\n\n// Inventory with pagination and sorting\nrouter.get(\"/inventory/paginated\", isAuthenticated, async (req, res) => {\n  try {\n    const {\n      page = 1,\n      limit = 10,\n      sortBy = \"id\",\n      sortOrder = \"desc\",\n      search,\n    } = req.query;\n\n    const searchFields = [\"name\", \"invCode\", \"supplier\"];\n    const offset = (Number(page) - 1) * Number(limit);\n\n    let query = db.select().from(inventoryItems);\n    let countQuery = db.select({ count: count() }).from(inventoryItems);\n\n    if (search) {\n      const searchConditions = searchFields.map((field) =>\n        like(\n          inventoryItems[field as keyof typeof inventoryItems],\n          `%${search}%`,\n        ),\n      );\n      const searchWhere = or(...searchConditions);\n      query = query.where(searchWhere);\n      countQuery = countQuery.where(searchWhere);\n    }\n\n    const sortColumn = inventoryItems[sortBy as keyof typeof inventoryItems];\n    if (sortColumn) {\n      query = query.orderBy(\n        sortOrder === \"asc\" ? asc(sortColumn) : desc(sortColumn),\n      );\n    }\n\n    query = query.limit(Number(limit)).offset(offset);\n\n    const [data, totalResult] = await Promise.all([query, countQuery]);\n    const total = totalResult[0]?.count || 0;\n\n    res.json({\n      data,\n      pagination: {\n        currentPage: Number(page),\n        totalPages: Math.ceil(total / Number(limit)),\n        totalItems: total,\n        pageSize: Number(limit),\n      },\n    });\n  } catch (error) {\n    console.error(\"Error fetching paginated inventory:\", error);\n    res.status(500).json({ error: \"Failed to fetch inventory\" });\n  }\n});\n\n// Add more paginated endpoints for other tables...\n// Orders, Purchases, Staff, etc. following the same pattern\n\n// Include existing routes from your current routes.ts file\n// Sync inventory from purchases\nrouter.post(\"/inventory/sync-from-purchases\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üîÑ Syncing inventory from purchases...\");\n\n    // Get all purchase items grouped by inventory item\n    const purchaseSummary = await db\n      .select({\n        inventoryItemId: purchaseItems.inventoryItemId,\n        totalQuantity: sql<number>`COALESCE(SUM(${purchaseItems.quantity}), 0)`,\n      })\n      .from(purchaseItems)\n      .groupBy(purchaseItems.inventoryItemId);\n\n    let updatedCount = 0;\n\n    for (const summary of purchaseSummary) {\n      if (!summary.inventoryItemId) continue;\n\n      // Get current inventory item\n      const [currentItem] = await db\n        .select()\n        .from(inventoryItems)\n        .where(eq(inventoryItems.id, summary.inventoryItemId))\n        .limit(1);\n\n      if (currentItem) {\n        const openingStock = parseFloat(currentItem.openingStock || \"0\");\n        const purchasedQty = summary.totalQuantity || 0;\n        const consumedQty = parseFloat(currentItem.consumedQuantity || \"0\");\n        const newClosingStock = openingStock + purchasedQty - consumedQty;\n\n        await db\n          .update(inventoryItems)\n          .set({\n            purchasedQuantity: purchasedQty.toString(),\n            currentStock: newClosingStock.toString(),\n            closingStock: newClosingStock.toString(),\n            lastRestocked: new Date(),\n            updatedAt: new Date(),\n          })\n          .where(eq(inventoryItems.id, summary.inventoryItemId));\n\n        updatedCount++;\n      }\n    }\n\n    console.log(`‚úÖ Synced ${updatedCount} inventory items from purchases`);\n    res.json({\n      success: true,\n      message: `Successfully synced ${updatedCount} items`,\n      updatedCount,\n    });\n  } catch (error) {\n    console.error(\"‚ùå Error syncing inventory from purchases:\", error);\n    res.status(500).json({\n      success: false,\n      error: \"Failed to sync inventory from purchases\",\n    });\n  }\n});\n\n// ===== Product Categories =====\nrouter.get(\"/categories\", isAuthenticated, async (req, res) => {\n  try {\n    const allCategories = await db\n      .select()\n      .from(categories)\n      .orderBy(asc(categories.name));\n    res.json({ success: true, data: allCategories });\n  } catch (error) {\n    console.error(\"Error fetching categories:\", error);\n    res.status(500).json({ success: false, error: \"Failed to fetch categories\" });\n  }\n});\n\nrouter.get(\"/categories/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const id = parseInt(req.params.id);\n    const [category] = await db\n      .select()\n      .from(categories)\n      .where(eq(categories.id, id));\n\n    if (!category) {\n      return res.status(404).json({ success: false, error: \"Category not found\" });\n    }\n\n    res.json({ success: true, data: category });\n  } catch (error) {\n    console.error(\"Error fetching category:\", error);\n    res.status(500).json({ success: false, error: \"Failed to fetch category\" });\n  }\n});\n\nrouter.post(\"/categories\", isAuthenticated, async (req, res) => {\n  try {\n    // Validate input\n    const validatedData = insertCategorySchema.parse(req.body);\n\n    // Check for duplicate name\n    const existingCategory = await db\n      .select()\n      .from(categories)\n      .where(sql`LOWER(${categories.name}) = LOWER(${validatedData.name})`)\n      .limit(1);\n\n    if (existingCategory.length > 0) {\n      return res.status(400).json({ \n        success: false, \n        error: \"A category with this name already exists\",\n        errors: { name: \"A category with this name already exists\" }\n      });\n    }\n\n    const [newCategory] = await db\n      .insert(categories)\n      .values(validatedData)\n      .returning();\n\n    await trackUserActivity(\n      req.user.id,\n      req.user.email,\n      \"CREATE\",\n      \"category\",\n      newCategory.id.toString(),\n      { categoryName: newCategory.name },\n      req,\n    );\n\n    res.status(201).json({ success: true, data: newCategory });\n  } catch (error: any) {\n    console.error(\"Error creating category:\", error);\n\n    // Handle Zod validation errors\n    if (error.name === 'ZodError') {\n      const fieldErrors: Record<string, string> = {};\n      error.errors.forEach((err: any) => {\n        const field = err.path[0];\n        fieldErrors[field] = err.message;\n      });\n      return res.status(400).json({ \n        success: false, \n        error: \"Validation failed\",\n        errors: fieldErrors\n      });\n    }\n\n    // Handle database constraint errors\n    if (error.code === '23505') { // Postgres unique violation\n      return res.status(400).json({ \n        success: false, \n        error: \"A category with this name already exists\",\n        errors: { name: \"A category with this name already exists\" }\n      });\n    }\n\n    res.status(500).json({ \n      success: false, \n      error: \"Failed to create category\",\n      message: error.message \n    });\n  }\n});\n\nrouter.patch(\"/categories/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const id = parseInt(req.params.id);\n    const { name, description, isActive } = req.body;\n\n    const [existingCategory] = await db\n      .select()\n      .from(categories)\n      .where(eq(categories.id, id));\n\n    if (!existingCategory) {\n      return res.status(404).json({ success: false, error: \"Category not found\" });\n    }\n\n    const [updatedCategory] = await db\n      .update(categories)\n      .set({\n        name: name ?? existingCategory.name,\n        description: description ?? existingCategory.description,\n        isActive: isActive ?? existingCategory.isActive,\n        updatedAt: new Date(),\n      })\n      .where(eq(categories.id, id))\n      .returning();\n\n    await trackUserActivity(\n      req.user.id,\n      req.user.email,\n      \"UPDATE\",\n      \"category\",\n      updatedCategory.id.toString(),\n      { categoryName: updatedCategory.name },\n      req,\n    );\n\n    res.json({ success: true, data: updatedCategory });\n  } catch (error) {\n    console.error(\"Error updating category:\", error);\n    res.status(500).json({ success: false, error: \"Failed to update category\" });\n  }\n});\n\nrouter.delete(\"/categories/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const id = parseInt(req.params.id);\n\n    const [existingCategory] = await db\n      .select()\n      .from(categories)\n      .where(eq(categories.id, id));\n\n    if (!existingCategory) {\n      return res.status(404).json({ success: false, error: \"Category not found\" });\n    }\n\n    const productsUsingCategory = await db\n      .select({ count: count() })\n      .from(products)\n      .where(eq(products.categoryId, id));\n\n    if (productsUsingCategory[0]?.count > 0) {\n      return res.status(400).json({\n        success: false,\n        error: `Cannot delete category. It is used by ${productsUsingCategory[0].count} product(s).`,\n      });\n    }\n\n    await db.delete(categories).where(eq(categories.id, id));\n\n    await trackUserActivity(\n      req.user.id,\n      req.user.email,\n      \"DELETE\",\n      \"category\",\n      id.toString(),\n      { categoryName: existingCategory.name },\n      req,\n    );\n\n    res.json({ success: true, message: \"Category deleted successfully\" });\n  } catch (error) {\n    console.error(\"Error deleting category:\", error);\n    res.status(500).json({ success: false, error: \"Failed to delete category\" });\n  }\n});\n\n// Products\nrouter.get(\"/products\", isAuthenticated, async (req, res) => {\n  // Ensure JSON response\n  res.setHeader('Content-Type', 'application/json');\n\n  try {\n    console.log(\"üì¶ Fetching all products...\");\n    const allProducts = await db\n      .select()\n      .from(products)\n      .orderBy(desc(products.id));\n\n    console.log(`‚úÖ Found ${allProducts.length} products`);\n    return res.json({\n      success: true,\n      data: allProducts,\n    });\n  } catch (error) {\n    console.error(\"‚ùå Error fetching products:\", error);\n    logger.error(\"Error fetching products\", error as Error, { module: 'API' });\n    return res.status(500).json({ \n      success: false,\n      error: \"Failed to fetch products\",\n      message: error instanceof Error ? error.message : String(error),\n      data: [],\n    });\n  }\n});\n\n// ===== PRODUCT UPDATE ENDPOINT (with ingredient handling) =====\nrouter.put(\"/products/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const productId = parseInt(req.params.id);\n    // Destructure ingredients from the body, and keep the rest for product data\n    const { ingredients, ...productData } = req.body;\n\n    console.log(\"üíæ Updating product:\", productId);\n\n    // Update product details\n    const [updatedProduct] = await db\n      .update(products)\n      .set({\n        ...productData, // Spread the rest of the product data\n        updatedAt: new Date(),\n      })\n      .where(eq(products.id, productId))\n      .returning();\n\n    // If product not found, return 404\n    if (!updatedProduct) {\n      return res.status(404).json({ \n        success: false,\n        error: \"Product not found\" \n      });\n    }\n\n    // Handle ingredient updates if provided\n    if (ingredients && Array.isArray(ingredients)) {\n      // First, delete all existing ingredients for this product\n      await db\n        .delete(productIngredients)\n        .where(eq(productIngredients.productId, productId));\n\n      // Then, insert the new list of ingredients if the array is not empty\n      if (ingredients.length > 0) {\n        const ingredientRecords = ingredients.map((ing: any) => ({\n          productId: productId,\n          inventoryItemId: ing.inventoryItemId,\n          quantity: ing.quantity.toString(), // Ensure quantity is stored as string if needed\n          unitId: ing.unitId,\n          unit: \"\", // This field might be redundant if unitId is sufficient, or could be populated from units table\n        }));\n\n        // Insert the new ingredient records\n        await db.insert(productIngredients).values(ingredientRecords);\n      }\n    }\n\n    // Sync product details with products table if it's a recipe type\n    // This is where the product->recipe sync logic would reside if it were a separate entity\n    // For now, we assume product creation/update handles this implicitly if `type: 'recipe'` is set.\n    if (updatedProduct.type === 'recipe') {\n      // Potentially update or create a corresponding record in a 'recipes' table if separate\n      // Or ensure relevant product fields (like isActive) are synced if needed.\n      // The original request mentioned syncing relevant product details (e.g., name, status)\n      // This implies the product IS the recipe representation in the product table.\n      // If a separate `recipes` table exists, this is where you'd update it.\n      console.log(`Product ${updatedProduct.name} is of type 'recipe'. No explicit recipe table update needed here.`);\n    }\n\n    // Track user activity for the product update\n    await trackUserActivity(\n      req.user.id,\n      req.user.email,\n      \"UPDATE\",\n      \"product\",\n      productId.toString(),\n      {\n        productName: updatedProduct.name,\n        ingredientCount: ingredients?.length || 0, // Log number of ingredients processed\n      },\n      req,\n    );\n\n    console.log(\"‚úÖ Product updated successfully\");\n    // Respond with the updated product data\n    res.json({ \n      success: true, \n      data: updatedProduct \n    });\n  } catch (error) {\n    console.error(\"‚ùå Error updating product:\", error);\n    res.status(500).json({ \n      success: false,\n      error: \"Failed to update product\",\n      message: error.message \n    });\n  }\n});\n\n// ===== POST API /api/recipes (This is a placeholder for a new endpoint or existing one) =====\n// Based on the user's request: \"On recipe creation ‚Üí insert a corresponding product record\"\n// This implies a /api/recipes endpoint or a modification to /api/products to handle recipe creation specifically.\n// Assuming we are modifying the /api/products POST endpoint to handle recipe creation logic.\n\nrouter.post(\"/products\", isAuthenticated, async (req, res) => {\n  try {\n    const { ingredients, ...productData } = req.body;\n    console.log(\"üíæ Creating product:\", productData.name, \"with ingredients:\", ingredients?.length || 0);\n\n    // Validate input using schema\n    const validatedProductData = insertProductSchema.parse(productData);\n\n    // Convert string fields to numbers for database insertion\n    const dbData = {\n      ...validatedProductData,\n      price: parseFloat(validatedProductData.price as string),\n      cost: parseFloat(validatedProductData.cost as string),\n      margin: parseFloat(validatedProductData.margin as string),\n      netWeight: parseFloat(validatedProductData.netWeight as string || \"0\"),\n      categoryId: validatedProductData.categoryId ? parseInt(validatedProductData.categoryId as string) : null,\n      unitId: validatedProductData.unitId ? parseInt(validatedProductData.unitId as string) : null,\n      sku: validatedProductData.sku?.trim() || null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      isActive: validatedProductData.isActive ?? true,\n      isRecipe: validatedProductData.type === 'recipe',\n    };\n\n    // Insert the new product\n    const [newProduct] = await db\n      .insert(products)\n      .values(dbData)\n      .returning();\n\n    // If it's a recipe, handle ingredient associations\n    if (newProduct.type === 'recipe' && ingredients && Array.isArray(ingredients)) {\n      if (ingredients.length > 0) {\n        const ingredientRecords = ingredients.map((ing: any) => ({\n          productId: newProduct.id,\n          inventoryItemId: ing.inventoryItemId,\n          quantity: ing.quantity.toString(),\n          unitId: ing.unitId,\n          unit: \"\", // Could be populated from units table if needed\n        }));\n\n        await db.insert(productIngredients).values(ingredientRecords);\n        console.log(`Added ${ingredientRecords.length} ingredients for recipe ${newProduct.name}`);\n      }\n    }\n\n    // Track activity\n    await trackUserActivity(\n      req.user.id,\n      req.user.email,\n      \"CREATE\",\n      \"product\",\n      newProduct.id.toString(),\n      {\n        productName: newProduct.name,\n        type: newProduct.type,\n        ingredientCount: ingredients?.length || 0,\n      },\n      req,\n    );\n\n    console.log(\"‚úÖ Product created successfully\");\n    res.status(201).json({ success: true, data: newProduct });\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating product:\", error);\n\n    // Handle Zod validation errors\n    if (error.name === 'ZodError') {\n      const fieldErrors: Record<string, string> = {};\n      error.errors.forEach((err: any) => {\n        const field = err.path.join('.'); // Use dot notation for nested paths\n        fieldErrors[field] = err.message;\n      });\n      return res.status(400).json({ \n        success: false, \n        error: \"Validation failed\",\n        errors: fieldErrors\n      });\n    }\n\n    // Handle potential duplicate entry errors (e.g., unique constraints)\n    if (error.code === '23505') { // Example for PostgreSQL unique constraint violation\n      return res.status(400).json({\n        success: false,\n        error: \"Duplicate entry\",\n        message: \"A product with this name or SKU might already exist.\",\n        errors: { field: \"A product with this name or SKU might already exist.\" }\n      });\n    }\n\n    res.status(500).json({ \n      error: \"Failed to create product\",\n      message: error.message \n    });\n  }\n});\n\n\n// Parties endpoint - returns all parties\nrouter.get(\"/parties\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üè¢ Fetching parties...\");\n    const allParties = await db\n      .select()\n      .from(parties)\n      .orderBy(desc(parties.createdAt));\n\n    console.log(`‚úÖ Found ${allParties.length} parties`);\n    res.json(allParties);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching parties:\", error);\n    res.status(500).json({ error: \"Failed to fetch parties\" });\n  }\n});\n\nrouter.post(\"/products\", isAuthenticated, async (req, res) => {\n  try {\n    const validatedData = insertProductSchema.parse(req.body);\n    const [newProduct] = await db\n      .insert(products)\n      .values(validatedData)\n      .returning();\n\n    // Track activity\n    await trackUserActivity(\n      req.user.id,\n      req.user.email,\n      \"CREATE\",\n      \"product\",\n      newProduct.id.toString(),\n      {\n        productName: newProduct.name,\n        price: newProduct.price,\n      },\n      req,\n    );\n\n    res.status(201).json(newProduct);\n  } catch (error) {\n    console.error(\"Error creating product:\", error);\n    res.status(500).json({ error: \"Failed to create product\" });\n  }\n});\n\n// ===== COMPREHENSIVE STOCK MANAGEMENT APIs WITH FIFO LOGIC =====\n\n// Enhanced Purchase Entry with FIFO Batch Creation\nrouter.post(\"/stock/purchase-entry\", isAuthenticated, async (req, res) => {\n  const transaction = await db.transaction(async (tx) => {\n    try {\n      const {\n        inventoryItemId,\n        quantity,\n        unitCost,\n        supplierName,\n        supplierInvoiceNumber,\n        batchNumber,\n        expiryDate,\n        notes,\n      } = req.body;\n\n      // Get inventory item details\n      const [inventoryItem] = await tx\n        .select()\n        .from(inventoryItems)\n        .where(eq(inventoryItems.id, inventoryItemId));\n\n      if (!inventoryItem) {\n        throw new Error(\"Inventory item not found\");\n      }\n\n      // Create purchase record\n      const [newPurchase] = await tx\n        .insert(purchases)\n        .values({\n          supplierName,\n          totalAmount: quantity * unitCost,\n          paymentMethod: \"credit\", // Default for purchase entry\n          status: \"completed\",\n          invoiceNumber: supplierInvoiceNumber,\n          notes,\n        })\n        .returning();\n\n      // Create purchase item record\n      const [newPurchaseItem] = await tx\n        .insert(purchaseItems)\n        .values({\n          purchaseId: newPurchase.id,\n          inventoryItemId,\n          quantity,\n          unitPrice: unitCost,\n          totalPrice: quantity * unitCost,\n          unitId: parseInt(req.body.unitId), // Include unitId here\n        })\n        .returning();\n\n      // Create FIFO stock batch\n      const [newStockBatch] = await tx\n        .insert(stockBatches)\n        .values({\n          purchaseItemId: newPurchaseItem.id,\n          inventoryItemId,\n          batchNumber: batchNumber || `BATCH-${Date.now()}`,\n          quantityReceived: quantity,\n          remainingQuantity: quantity,\n          unitCost,\n          expiryDate: expiryDate ? new Date(expiryDate) : null,\n          supplierId: null, // TODO: Link to parties table if needed\n          branchId: null, // TODO: Add branch support\n          notes,\n        })\n        .returning();\n\n      // Calculate new weighted average cost\n      const existingBatches = await tx\n        .select()\n        .from(stockBatches)\n        .where(\n          and(\n            eq(stockBatches.inventoryItemId, inventoryItemId),\n            eq(stockBatches.isActive, true),\n            sql`${stockBatches.remainingQuantity} > 0`,\n          ),\n        );\n\n      const totalValue = existingBatches.reduce(\n        (sum, batch) =>\n          sum +\n          parseFloat(batch.remainingQuantity) * parseFloat(batch.unitCost),\n        0,\n      );\n      const totalQuantity = existingBatches.reduce(\n        (sum, batch) => sum + parseFloat(batch.remainingQuantity),\n        0,\n      );\n      const newAverageCost =\n        totalQuantity > 0 ? totalValue / totalQuantity : unitCost;\n\n      // Update inventory item with new stock levels and costs\n      const updatedCurrentStock =\n        parseFloat(inventoryItem.currentStock) + quantity;\n      await tx\n        .update(inventoryItems)\n        .set({\n          currentStock: updatedCurrentStock.toString(),\n          purchasedQuantity: (\n            parseFloat(inventoryItem.purchasedQuantity || \"0\") + quantity\n          ).toString(),\n          costPerUnit: newAverageCost.toString(),\n          lastRestocked: new Date(),\n          updatedAt: new Date(),\n        })\n        .where(eq(inventoryItems.id, inventoryItemId));\n\n      // Record cost history\n      await tx.insert(inventoryCostHistory).values({\n        inventoryItemId,\n        previousCost: parseFloat(inventoryItem.costPerUnit),\n        newCost: unitCost,\n        previousAverageCost: parseFloat(inventoryItem.costPerUnit),\n        newAverageCost,\n        changeReason: \"purchase\",\n        referenceId: newPurchaseItem.id,\n        referenceType: \"purchase_item\",\n        changedBy: req.user?.email || \"system\",\n        notes: `Purchase entry: ${quantity} units at $${unitCost} each`,\n      });\n\n      // Record inventory transaction\n      await tx.insert(inventoryTransactions).values({\n        inventoryItemId,\n        type: \"in\",\n        quantity: quantity.toString(),\n        reason: \"purchase\",\n        reference: `Purchase #${newPurchase.id}`,\n        createdBy: req.user?.email || \"system\",\n      });\n\n      // Track user activity\n      await trackUserActivity(\n        req.user.id,\n        req.user.email,\n        \"PURCHASE_ENTRY\",\n        \"stock_batch\",\n        newStockBatch.id.toString(),\n        {\n          inventoryItemName: inventoryItem.name,\n          quantity,\n          unitCost,\n          totalValue: quantity * unitCost,\n          supplierName,\n        },\n        req,\n      );\n\n      return {\n        purchase: newPurchase,\n        purchaseItem: newPurchaseItem,\n        stockBatch: newStockBatch,\n        updatedStock: updatedCurrentStock,\n        newAverageCost,\n      };\n    } catch (error) {\n      throw error;\n    }\n  });\n\n  res.status(201).json({\n    success: true,\n    message: \"Purchase entry created successfully with FIFO batch tracking\",\n    data: transaction,\n  });\n});\n\n// Enhanced Production Consumption with FIFO Logic\nrouter.post(\n  \"/api/stock/production-consume\",\n  isAuthenticated,\n  async (req, res) => {\n    const transactionResult = await db.transaction(async (tx) => {\n      try {\n        const { productId, productionQuantity, productionScheduleId, notes } =\n          req.body;\n\n        // Get product ingredients (BOM)\n        const ingredients = await tx\n          .select({\n            productIngredient: productIngredients,\n            inventoryItem: inventoryItems,\n          })\n          .from(productIngredients)\n          .innerJoin(\n            inventoryItems,\n            eq(productIngredients.inventoryItemId, inventoryItems.id),\n          )\n          .where(eq(productIngredients.productId, productId));\n\n        if (ingredients.length === 0) {\n          throw new Error(\"No recipe/BOM found for this product\");\n        }\n\n        const consumptionResults = [];\n\n        // Process each ingredient with FIFO consumption\n        for (const ingredient of ingredients) {\n          const requiredQuantity =\n            parseFloat(ingredient.productIngredient.quantity) *\n            productionQuantity;\n\n          // Get available batches in FIFO order (oldest first)\n          const availableBatches = await tx\n            .select()\n            .from(stockBatches)\n            .where(\n              and(\n                eq(stockBatches.inventoryItemId, ingredient.inventoryItem.id),\n                eq(stockBatches.isActive, true),\n                sql`${stockBatches.remainingQuantity} > 0`,\n              ),\n            )\n            .orderBy(stockBatches.receivedDate); // FIFO order\n\n          let remainingToConsume = requiredQuantity;\n          const batchConsumptions = [];\n\n          // Allocate consumption across batches using FIFO\n          for (const batch of availableBatches) {\n            if (remainingToConsume <= 0) break;\n\n            const batchRemaining = parseFloat(batch.remainingQuantity);\n            const consumeFromBatch = Math.min(\n              remainingToConsume,\n              batchRemaining,\n            );\n\n            if (consumeFromBatch > 0) {\n              // Update batch remaining quantity\n              const newRemainingQuantity = batchRemaining - consumeFromBatch;\n              await tx\n                .update(stockBatches)\n                .set({\n                  remainingQuantity: newRemainingQuantity.toString(),\n                  updatedAt: new Date(),\n                })\n                .where(eq(stockBatches.id, batch.id));\n\n              // Record batch consumption\n              const [batchConsumption] = await tx\n                .insert(stockBatchConsumptions)\n                .values({\n                  stockBatchId: batch.id,\n                  productionScheduleId,\n                  quantityConsumed: consumeFromBatch.toString(),\n                  unitCostAtConsumption: parseFloat(batch.unitCost),\n                  totalCost: (\n                    consumeFromBatch * parseFloat(batch.unitCost)\n                  ).toString(),\n                  consumedBy: req.user?.email || \"system\",\n                  reason: \"production\",\n                  notes: `Production of ${productionQuantity} units`,\n                })\n                .returning();\n\n              batchConsumptions.push(batchConsumption);\n              remainingToConsume -= consumeFromBatch;\n            }\n          }\n\n          // Check if we have sufficient stock\n          if (remainingToConsume > 0) {\n            throw new Error(\n              `Insufficient stock for ${ingredient.inventoryItem.name}. ` +\n                `Required: ${requiredQuantity}, Available: ${requiredQuantity - remainingToConsume}`,\n            );\n          }\n\n          // Update inventory item stock levels\n          const currentStock = parseFloat(\n            ingredient.inventoryItem.currentStock,\n          );\n          const newCurrentStock = currentStock - requiredQuantity;\n\n          await tx\n            .update(inventoryItems)\n            .set({\n              currentStock: newCurrentStock.toString(),\n              consumedQuantity: (\n                parseFloat(ingredient.inventoryItem.consumedQuantity || \"0\") +\n                requiredQuantity\n              ).toString(),\n              lastConsumed: new Date(),\n              updatedAt: new Date(),\n            })\n            .where(eq(inventoryItems.id, ingredient.inventoryItem.id));\n\n          // Record inventory transaction\n          await tx.insert(inventoryTransactions).values({\n            inventoryItemId: ingredient.inventoryItem.id,\n            type: \"out\",\n            quantity: requiredQuantity.toString(),\n            reason: \"production\",\n            reference: `Production Schedule #${productionScheduleId}`,\n            createdBy: req.user?.email || \"system\",\n          });\n\n          consumptionResults.push({\n            ingredientId: ingredient.inventoryItem.id,\n            ingredientName: ingredient.inventoryItem.name,\n            quantityConsumed: requiredQuantity,\n            batchConsumptions,\n            newStockLevel: newCurrentStock,\n          });\n        }\n\n        // Track user activity\n        await trackUserActivity(\n          req.user.id,\n          req.user.email,\n          \"PRODUCTION_CONSUME\",\n          \"production_schedule\",\n          productionScheduleId?.toString() || \"manual\",\n          {\n            productId,\n            productionQuantity,\n            ingredientsConsumed: consumptionResults.length,\n            totalIngredientValue: consumptionResults.reduce(\n              (sum, r) =>\n                sum +\n                r.batchConsumptions.reduce(\n                  (bSum, b) => bSum + parseFloat(b.totalCost),\n                  0,\n                ),\n              0,\n            ),\n          },\n          req,\n        );\n\n        return {\n          productId,\n          productionQuantity,\n          consumptionResults,\n          message: \"Production consumption completed with FIFO allocation\",\n        };\n      } catch (error) {\n        throw error;\n      }\n    });\n\n    res.status(200).json({\n      success: true,\n      data: transactionResult,\n    });\n  },\n);\n\n// Daily Stock Snapshot Creation (Immutable)\nrouter.post(\"/stock/daily-snapshot\", isAuthenticated, async (req, res) => {\n  try {\n    const { snapshotDate } = req.body;\n    const targetDate = snapshotDate ? new Date(snapshotDate) : new Date();\n\n    // Format date as YYYY-MM-DD\n    const dateString = targetDate.toISOString().split(\"T\")[0];\n\n    // Check if snapshot already exists for this date\n    const existingSnapshot = await db\n      .select()\n      .from(dailyInventorySnapshots)\n      .where(eq(dailyInventorySnapshots.snapshotDate, dateString))\n      .limit(1);\n\n    if (existingSnapshot.length > 0) {\n      return res.status(400).json({\n        success: false,\n        error: \"Daily snapshot already exists for this date\",\n      });\n    }\n\n    // Get all inventory items with current stock levels\n    const inventoryItemsData = await db\n      .select()\n      .from(inventoryItems)\n      .where(eq(inventoryItems.isActive, true));\n\n    const snapshots = [];\n\n    for (const item of inventoryItemsData) {\n      // Calculate active batches count\n      const activeBatches = await db\n        .select({ count: sql`count(*)` })\n        .from(stockBatches)\n        .where(\n          and(\n            eq(stockBatches.inventoryItemId, item.id),\n            eq(stockBatches.isActive, true),\n            sql`${stockBatches.remainingQuantity} > 0`,\n          ),\n        );\n\n      // Get weighted average cost from active batches\n      const batchCostData = await db\n        .select({\n          totalValue: sql`sum(${stockBatches.remainingQuantity} * ${stockBatches.unitCost})`,\n          totalQuantity: sql`sum(${stockBatches.remainingQuantity})`,\n          lastPurchaseCost: sql`(\n            SELECT ${stockBatches.unitCost}\n            FROM ${stockBatches}\n            WHERE ${stockBatches.inventoryItemId} = ${item.id}\n            AND ${stockBatches.isActive} = true\n            ORDER BY ${stockBatches.receivedDate} DESC\n            LIMIT 1\n          )`,\n        })\n        .from(stockBatches)\n        .where(\n          and(\n            eq(stockBatches.inventoryItemId, item.id),\n            eq(stockBatches.isActive, true),\n            sql`${stockBatches.remainingQuantity} > 0`,\n          ),\n        );\n\n      const totalValue = parseFloat(batchCostData[0]?.totalValue || \"0\");\n      const totalQuantity = parseFloat(batchCostData[0]?.totalQuantity || \"0\");\n      const averageCost =\n        totalQuantity > 0\n          ? totalValue / totalQuantity\n          : parseFloat(item.costPerUnit);\n      const lastPurchaseCost = parseFloat(\n        batchCostData[0]?.lastPurchaseCost || item.costPerUnit,\n      );\n\n      // Create immutable snapshot\n      const [snapshot] = await db\n        .insert(dailyInventorySnapshots)\n        .values({\n          snapshotDate: dateString,\n          inventoryItemId: item.id,\n          branchId: item.branchId,\n          openingStock: item.openingStock,\n          purchasedQuantity: item.purchasedQuantity,\n          consumedQuantity: item.consumedQuantity,\n          adjustmentQuantity: \"0\", // TODO: Add adjustment tracking\n          closingStock: item.currentStock,\n          averageCost: averageCost.toString(),\n          lastPurchaseCost: lastPurchaseCost.toString(),\n          totalValue: (parseFloat(item.currentStock) * averageCost).toString(),\n          activeBatches: parseInt(activeBatches[0]?.count || \"0\"),\n          isLocked: true, // Lock immediately to prevent modifications\n          capturedBy: req.user?.email || \"system\",\n          notes: `Daily snapshot for ${dateString}`,\n        })\n        .returning();\n\n      snapshots.push(snapshot);\n    }\n\n    // Track user activity\n    await trackUserActivity(\n      req.user.id,\n      req.user.email,\n      \"DAILY_SNAPSHOT\",\n      \"daily_inventory_snapshots\",\n      dateString,\n      {\n        snapshotDate: dateString,\n        itemsSnapshotted: snapshots.length,\n        totalValue: snapshots.reduce(\n          (sum, s) => sum + parseFloat(s.totalValue),\n          0,\n        ),\n      },\n      req,\n    );\n\n    res.status(201).json({\n      success: true,\n      message: `Daily snapshot created for ${snapshots.length} inventory items`,\n      data: {\n        snapshotDate: dateString,\n        itemsCount: snapshots.length,\n        snapshots: snapshots.slice(0, 5), // Return first 5 for preview\n      },\n    });\n  } catch (error) {\n    console.error(\"Error creating daily snapshot:\", error);\n    res.status(500).json({\n      success: false,\n      error: \"Failed to create daily snapshot\",\n      message: error.message,\n    });\n  }\n});\n\n// Get Stock Batches with FIFO Information\nrouter.get(\n  \"/api/stock/batches/:inventoryItemId\",\n  isAuthenticated,\n  async (req, res) => {\n    try {\n      const { inventoryItemId } = req.params;\n\n      const batches = await db\n        .select({\n          stockBatch: stockBatches,\n          purchaseItem: purchaseItems,\n          purchase: purchases,\n        })\n        .from(stockBatches)\n        .leftJoin(\n          purchaseItems,\n          eq(stockBatches.purchaseItemId, purchaseItems.id),\n        )\n        .leftJoin(purchases, eq(purchaseItems.purchaseId, purchases.id))\n        .where(\n          and(\n            eq(stockBatches.inventoryItemId, parseInt(inventoryItemId)),\n            eq(stockBatches.isActive, true),\n          ),\n        )\n        .orderBy(stockBatches.receivedDate); // FIFO order\n\n      res.json({\n        success: true,\n        data: batches,\n      });\n    } catch (error) {\n      console.error(\"Error fetching stock batches:\", error);\n      res.status(500).json({\n        success: false,\n        error: \"Failed to fetch stock batches\",\n      });\n    }\n  },\n);\n\n// Get Real-time Stock Alerts\nrouter.get(\"/stock/alerts\", isAuthenticated, async (req, res) => {\n  try {\n    // Low stock alerts\n    const lowStockItems = await db\n      .select()\n      .from(inventoryItems)\n      .where(\n        and(\n          sql`${inventoryItems.currentStock}::numeric <= ${inventoryItems.minLevel}::numeric`,\n          eq(inventoryItems.isActive, true),\n        ),\n      );\n\n    // Expiring batches (next 30 days)\n    const expiringBatches = await db\n      .select({\n        stockBatch: stockBatches,\n        inventoryItem: inventoryItems,\n      })\n      .from(stockBatches)\n      .innerJoin(\n        inventoryItems,\n        eq(stockBatches.inventoryItemId, inventoryItems.id),\n      )\n      .where(\n        and(\n          eq(stockBatches.isActive, true),\n          sql`${stockBatches.remainingQuantity} > 0`,\n          sql`${stockBatches.expiryDate} <= CURRENT_DATE + INTERVAL '30 days'`,\n          sql`${stockBatches.expiryDate} IS NOT NULL`,\n        ),\n      )\n      .orderBy(stockBatches.expiryDate);\n\n    // Zero stock items\n    const zeroStockItems = await db\n      .select()\n      .from(inventoryItems)\n      .where(\n        and(\n          sql`${inventoryItems.currentStock}::numeric <= 0`,\n          eq(inventoryItems.isActive, true),\n        ),\n      );\n\n    res.json({\n      success: true,\n      data: {\n        lowStock: lowStockItems,\n        expiringBatches,\n        zeroStock: zeroStockItems,\n        alertCounts: {\n          lowStock: lowStockItems.length,\n          expiring: expiringBatches.length,\n          zeroStock: zeroStockItems.length,\n        },\n      },\n    });\n  } catch (error) {\n    console.error(\"Error fetching stock alerts:\", error);\n    res.status(500).json({\n      success: false,\n      error: \"Failed to fetch stock alerts\",\n    });\n  }\n});\n\n// Get Stock Cost History\nrouter.get(\n  \"/api/stock/cost-history/:inventoryItemId\",\n  isAuthenticated,\n  async (req, res) => {\n    try {\n      const { inventoryItemId } = req.params;\n      const { limit = 50 } = req.query;\n\n      const costHistory = await db\n        .select()\n        .from(inventoryCostHistory)\n        .where(\n          eq(inventoryCostHistory.inventoryItemId, parseInt(inventoryItemId)),\n        )\n        .orderBy(desc(inventoryCostHistory.changeDate))\n        .limit(parseInt(limit as string));\n\n      res.json({\n        success: true,\n        data: costHistory,\n      });\n    } catch (error) {\n      console.error(\"Error fetching cost history:\", error);\n      res.status(500).json({\n        success: false,\n        error: \"Failed to fetch cost history\",\n      });\n    }\n  },\n);\n\n// Get Daily Snapshots\nrouter.get(\"/stock/snapshots\", isAuthenticated, async (req, res) => {\n  try {\n    const { startDate, endDate, inventoryItemId } = req.query;\n\n    let query = db.select().from(dailyInventorySnapshots);\n    const conditions = [];\n\n    if (startDate) {\n      conditions.push(\n        gte(dailyInventorySnapshots.snapshotDate, startDate as string),\n      );\n    }\n    if (endDate) {\n      conditions.push(\n        lte(dailyInventorySnapshots.snapshotDate, endDate as string),\n      );\n    }\n    if (inventoryItemId) {\n      conditions.push(\n        eq(\n          dailyInventorySnapshots.inventoryItemId,\n          parseInt(inventoryItemId as string),\n        ),\n      );\n    }\n\n    if (conditions.length > 0) {\n      query = query.where(and(...conditions));\n    }\n\n    const snapshots = await query\n      .orderBy(desc(dailyInventorySnapshots.snapshotDate))\n      .limit(100);\n\n    res.json({\n      success: true,\n      data: snapshots,\n    });\n  } catch (error) {\n    console.error(\"Error fetching snapshots:\", error);\n    res.status(500).json({\n      success: false,\n      error: \"Failed to fetch snapshots\",\n    });\n  }\n});\n\n// --- Existing Routes from Original File (Copied and Pasted) ---\n// Extend session types\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId?: string;\n    user?: any;\n  }\n}\n\n// In-memory notification storage (for demonstration - in production use database)\nlet notifications: Array<{\n  id: string;\n  type: \"order\" | \"production\" | \"inventory\" | \"shipping\" | \"system\";\n  title: string;\n  description: string;\n  timestamp: string;\n  read: boolean;\n  priority: \"low\" | \"medium\" | \"high\" | \"critical\";\n  actionUrl?: string;\n  data?: any;\n}> = [];\n\n// Helper function to add notification\nfunction addNotification(\n  notification: Omit<(typeof notifications)[0], \"id\" | \"timestamp\" | \"read\">,\n) {\n  const newNotification = {\n    id: Date.now().toString(),\n    timestamp: new Date().toISOString(),\n    read: false,\n    ...notification,\n  };\n  notifications.unshift(newNotification);\n\n  // Keep only last 100 notifications\n  if (notifications.length > 100) {\n    notifications = notifications.slice(0, 100);\n  }\n\n  console.log(`üì¢ New notification: ${notification.title}`);\n  return newNotification;\n}\n\n// Initialize with some sample notifications for testing\nif (notifications.length === 0) {\n  addNotification({\n    type: \"system\",\n    title: \"Welcome to BakerSoft\",\n    description:\n      \"System initialized successfully. All modules are ready for use.\",\n    priority: \"medium\",\n    actionUrl: \"/dashboard\",\n  });\n\n  addNotification({\n    type: \"inventory\",\n    title: \"Low Stock Alert\",\n    description: \"Flour stock is running low. Current: 5kg, Minimum: 10kg\",\n    priority: \"high\",\n    actionUrl: \"/inventory\",\n    data: { itemName: \"Flour\", currentStock: 5, minLevel: 10 },\n  });\n\n  addNotification({\n    type: \"order\",\n    title: \"New Order Received\",\n    description: \"Order #ORD-001 from John Doe for ‚Çπ1,250\",\n    priority: \"medium\",\n    actionUrl: \"/orders\",\n    data: { orderNumber: \"ORD-001\", customer: \"John Doe\", amount: 1250 },\n  });\n}\n\nrouter.post(\"/login\", async (req, res) => {\n  try {\n    const { email, password } = req.body;\n    logger.auth('Login attempt', email, true);\n\n    if (!email || !password) {\n      logger.auth('Login validation failed', email || 'unknown', false, 'Missing credentials');\n      return res.status(400).json({ error: \"Email and password are required\" });\n    }\n\n    const ipAddress = req.ip || req.connection.remoteAddress || \"unknown\";\n    const userAgent = req.get(\"User-Agent\") || \"unknown\";\n\n    // Try database login first\n    try {\n      const user = await db\n        .select()\n        .from(users)\n        .where(eq(users.email, email))\n        .limit(1);\n\n      if (user.length > 0) {\n        const isValidPassword = await bcrypt.compare(\n          password,\n          user[0].password || \"\",\n        );\n\n        if (isValidPassword) {\n          req.session.userId = user[0].id;\n          req.session.user = {\n            ...user[0],\n            firstName: user[0].firstName || email.split('@')[0],\n            lastName: user[0].lastName || 'User',\n          };\n\n          const userName = `${req.session.user.firstName} ${req.session.user.lastName}`;\n\n          // Log successful login\n          await storage.logLogin(\n            user[0].id,\n            email,\n            userName,\n            ipAddress,\n            userAgent,\n            true,\n          );\n\n          // Add login notification\n          addNotification({\n            type: \"system\",\n            title: \"User Login\",\n            description: `${userName} logged in`,\n            priority: \"low\",\n          });\n\n          logger.auth('Database login', email, true);\n          return res.json({\n            message: \"Login successful\",\n            user: {\n              id: user[0].id,\n              email: user[0].email,\n              firstName: user[0].firstName,\n              lastName: user[0].lastName,\n              role: user[0].role,\n            },\n          });\n        } else {\n          // Log failed password attempt\n          await storage.logLogin(\n            user[0].id,\n            email,\n            `${user[0].firstName} ${user[0].lastName}`,\n            ipAddress,\n            userAgent,\n            false,\n            \"Invalid password\",\n          );\n        }\n      }\n    } catch (dbError) {\n      logger.warn(\"Database login failed, trying default credentials\", { module: 'AUTH', details: { email } });\n    }\n\n    // Default credentials for demo\n    const defaultUsers = [\n      {\n        id: \"super_admin\",\n        email: \"admin@bakersoft.com\",\n        password: \"admin123\",\n        firstName: \"Super\",\n        lastName: \"Admin\",\n        role: \"admin\",\n      },\n      {\n        id: \"admin_user\",\n        email: \"admin@admin.com\",\n        password: \"admin123\",\n        firstName: \"Admin\",\n        lastName: \"User\",\n        role: \"admin\",\n      },\n      {\n        id: \"manager_user\",\n        email: \"manager@manager.com\",\n        password: \"manager123\",\n        firstName: \"Manager\",\n        lastName: \"User\",\n        role: \"manager\",\n      },\n      {\n        id: \"staff_user\",\n        email: \"staff@staff.com\",\n        password: \"staff123\",\n        firstName: \"Staff\",\n        lastName: \"User\",\n        role: \"staff\",\n      },\n    ];\n\n    const defaultUser = defaultUsers.find(\n      (u) => u.email === email && u.password === password,\n    );\n\n    if (defaultUser) {\n      req.session.userId = defaultUser.id;\n      req.session.user = {\n        ...defaultUser,\n        firstName: defaultUser.firstName || email.split('@')[0],\n        lastName: defaultUser.lastName || 'User',\n      };\n\n      const userName = `${req.session.user.firstName} ${req.session.user.lastName}`;\n\n      // Log successful default login\n      await storage.logLogin(\n        defaultUser.id,\n        email,\n        userName,\n        ipAddress,\n        userAgent,\n        true,\n      );\n\n      // Add login notification\n      addNotification({\n        type: \"system\",\n        title: \"User Login\",\n        description: `${userName} logged in`,\n        priority: \"low\",\n      });\n\n      logger.auth('Default credentials login', email, true);\n      return res.json({\n        message: \"Login successful\",\n        user: {\n          id: defaultUser.id,\n          email: defaultUser.email,\n          firstName: defaultUser.firstName,\n          lastName: defaultUser.lastName,\n          role: defaultUser.role,\n        },\n      });\n    }\n\n    // Log failed login attempt\n    await storage.logLogin(\n      \"unknown\",\n      email,\n      \"Unknown User\",\n      ipAddress,\n      userAgent,\n      false,\n      \"Invalid credentials\",\n    );\n\n    logger.auth('Login failed', email, false, 'Invalid credentials');\n    res.status(401).json({ error: \"Invalid credentials\" });\n  } catch (error) {\n    logger.error(\"Login error\", error as Error, { module: 'AUTH', details: { email } });\n    res.status(500).json({ error: \"Login failed\" });\n  }\n});\n\nrouter.post(\"/logout\", (req, res) => {\n  const userEmail = req.session?.user?.email || \"Unknown\";\n\n  req.session.destroy((err) => {\n    if (err) {\n      logger.error(\"Logout error\", err as Error, { module: 'AUTH', details: { email: userEmail } });\n      return res.status(500).json({ error: \"Logout failed\" });\n    }\n\n    // Add logout notification\n    addNotification({\n      type: \"system\",\n      title: \"User Logout\",\n      description: `User ${userEmail} logged out`,\n      priority: \"low\",\n    });\n\n    logger.auth('Logout', userEmail, true);\n    res.json({ message: \"Logout successful\" });\n  });\n});\n\nrouter.get(\"/me\", (req, res) => {\n  if (req.session?.userId) {\n    res.json({ user: req.session.user });\n  } else {\n    res.status(401).json({ error: \"Not authenticated\" });\n  }\n});\n\n// Add auth/user endpoint that frontend expects\nrouter.get(\"/auth/user\", (req, res) => {\n  if (req.session?.userId) {\n    logger.debug(\"Auth check - User authenticated\", { module: 'AUTH', userId: req.session.user?.id });\n    res.json(req.session.user);\n  } else {\n    logger.debug(\"Auth check - No active session\", { module: 'AUTH' });\n    res.status(401).json({ error: \"Not authenticated\" });\n  }\n});\n\n// Admin user management routes\nrouter.get(\"/admin/users\", isAuthenticated, async (req, res) => {\n  try {\n    logger.api('/admin/users', 'Fetching all users for admin', true);\n    const currentUser = req.session?.user;\n\n    // Check if user has admin privileges\n    if (\n      !currentUser ||\n      (currentUser.role !== \"super_admin\" && currentUser.role !== \"admin\")\n    ) {\n      console.log(\"‚ùå Access denied for user management\");\n      return res.status(403).json({\n        error: \"Access denied\",\n        message: \"You do not have permission to access user management\",\n        success: false,\n      });\n    }\n\n    const excludeSuperAdmin = currentUser.role !== \"super_admin\";\n    const users = await storage.getAllUsers(excludeSuperAdmin);\n\n    console.log(`‚úÖ Found ${users.length} users`);\n    res.json(users);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching users:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch users\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/admin/users\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating new user:\", req.body.email);\n    const currentUser = req.session?.user;\n\n    // Check if user has admin privileges\n    if (\n      !currentUser ||\n      (currentUser.role !== \"super_admin\" && currentUser.role !== \"admin\")\n    ) {\n      return res.status(403).json({\n        error: \"Access denied\",\n        message: \"You do not have permission to create users\",\n        success: false,\n      });\n    }\n\n    const result = await storage.upsertUser(req.body);\n\n    // Log the user creation\n    await storage.logUserAction(\n      currentUser.id,\n      \"CREATE\",\n      \"users\",\n      {\n        newUserEmail: req.body.email,\n        newUserRole: req.body.role,\n        newUserId: result.id,\n      },\n      req.ip,\n      req.get(\"User-Agent\"),\n    );\n\n    // Add user creation notification\n    addNotification({\n      type: \"system\",\n      title: \"User Created\",\n      description: `New user \"${req.body.email}\" has been created with role \"${req.body.role}\"`,\n      priority: \"medium\",\n      actionUrl: \"/admin/users\",\n    });\n\n    console.log(\"‚úÖ User created successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating user:\", error);\n    res.status(400).json({\n      error: \"Failed to create user\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.put(\"/admin/users/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const userId = req.params.id;\n    console.log(\"üíæ Updating user:\", userId);\n    const currentUser = req.session?.user;\n\n    // Check if user has admin privileges\n    if (\n      !currentUser ||\n      (currentUser.role !== \"super_admin\" && currentUser.role !== \"admin\")\n    ) {\n      return res.status(403).json({\n        error: \"Access denied\",\n        message: \"You do not have permission to update users\",\n        success: false,\n      });\n    }\n\n    const result = await storage.updateUser(userId, req.body);\n\n    // Log the user update\n    await storage.logUserAction(\n      currentUser.id,\n      \"UPDATE\",\n      \"users\",\n      {\n        updatedUserId: userId,\n        updates: req.body,\n      },\n      req.ip,\n      req.get(\"User-Agent\"),\n    );\n\n    // Add user update notification\n    addNotification({\n      type: \"system\",\n      title: \"User Updated\",\n      description: `User \"${result.email}\" has been updated`,\n      priority: \"medium\",\n      actionUrl: \"/admin/users\",\n    });\n\n    console.log(\"‚úÖ User updated successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error updating user:\", error);\n    res.status(400).json({\n      error: \"Failed to update user\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.delete(\"/admin/users/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const userId = req.params.id;\n    console.log(\"üóëÔ∏è Deleting user:\", userId);\n    const currentUser = req.session?.user;\n\n    // Check if user has admin privileges\n    if (\n      !currentUser ||\n      (currentUser.role !== \"super_admin\" && currentUser.role !== \"admin\")\n    ) {\n      return res.status(403).json({\n        error: \"Access denied\",\n        message: \"You do not have permission to delete users\",\n        success: false,\n      });\n    }\n\n    await storage.deleteUser(userId);\n\n    // Log the user deletion\n    await storage.logUserAction(\n      currentUser.id,\n      \"DELETE\",\n      \"users\",\n      { deletedUserId: userId },\n      req.ip,\n      req.get(\"User-Agent\"),\n    );\n\n    // Add user deletion notification\n    addNotification({\n      type: \"system\",\n      title: \"User Deleted\",\n      description: `User has been deleted from the system`,\n      priority: \"medium\",\n      actionUrl: \"/admin/users\",\n    });\n\n    console.log(\"‚úÖ User deleted successfully\");\n    res.json({ success: true, message: \"User deleted successfully\" });\n  } catch (error: any) {\n    console.error(\"‚ùå Error deleting user:\", error);\n    res.status(400).json({\n      error: \"Failed to delete user\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Dashboard API endpoints\n// Simple in-memory cache for dashboard stats (5 second TTL)\nlet dashboardStatsCache: any = null;\nlet dashboardStatsCacheTime = 0;\nconst CACHE_TTL = 5000;\n\nrouter.get(\"/dashboard/stats\", async (req, res) => {\n  try {\n    // Check if user is authenticated\n    if (!req.session?.userId) {\n      return res.status(401).json({ error: \"Authentication required\" });\n    }\n\n    // Return cached data if still valid\n    const now = Date.now();\n    if (dashboardStatsCache && (now - dashboardStatsCacheTime) < CACHE_TTL) {\n      return res.json(dashboardStatsCache);\n    }\n\n    const userRole = req.session.user?.role;\n\n    // Try to get real data from database, with enhanced data for superadmin\n    try {\n      // Get comprehensive data\n      const [ordersResult, customersResult, productsResult, inventoryResult] =\n        await Promise.all([\n          db\n            .select({ count: sql<number>`count(*)` })\n            .from(orders)\n            .catch(() => [{ count: 0 }]),\n          db\n            .select({ count: sql<number>`count(*)` })\n            .from(customers)\n            .catch(() => [{ count: 0 }]),\n          db\n            .select({ count: sql<number>`count(*)` })\n            .from(products)\n            .catch(() => [{ count: 0 }]),\n          db\n            .select({ count: sql<number>`count(*)` })\n            .from(inventoryItems)\n            .catch(() => [{ count: 0 }]),\n        ]);\n\n      // Get today's orders\n      const todayOrders = await db\n        .select({ count: sql<number>`count(*)` })\n        .from(orders)\n        .where(sql`DATE(${orders.deliveryDate}) = CURRENT_DATE`)\n        .catch(() => [{ count: 0 }]);\n\n      // Calculate revenue (sample calculation)\n      const totalRevenue = await db\n        .select({\n          total: sql<number>`COALESCE(SUM(CAST(${orders.totalAmount} AS DECIMAL)), 0)`,\n        })\n        .from(orders)\n        .catch(() => [{ total: 0 }]);\n\n      const stats = {\n        totalRevenue:\n          totalRevenue[0]?.total || 150000 + Math.floor(Math.random() * 100000),\n        ordersToday:\n          todayOrders[0]?.count || Math.floor(Math.random() * 25) + 35,\n        activeProducts:\n          productsResult[0]?.count || Math.floor(Math.random() * 75) + 125,\n        totalCustomers:\n          customersResult[0]?.count || Math.floor(Math.random() * 400) + 900,\n        totalOrders:\n          ordersResult[0]?.count || Math.floor(Math.random() * 500) + 200,\n        totalInventoryItems:\n          inventoryResult[0]?.count || Math.floor(Math.random() * 100) + 50,\n        lowStockItems: Math.floor(Math.random() * 8) + 4,\n        pendingOrders: Math.floor(Math.random() * 18) + 7,\n        completedOrders: Math.floor(Math.random() * 45) + 25,\n        monthlyGrowth: 16.2,\n        dataSource: \"database\",\n        timestamp: new Date().toISOString(),\n        userRole: userRole,\n      };\n\n      // Cache the result\n      dashboardStatsCache = stats;\n      dashboardStatsCacheTime = Date.now();\n\n      res.json(stats);\n    } catch (dbError: any) {\n      console.log(\n        \"‚ö†Ô∏è Database error, using enhanced sample stats:\",\n        dbError.message,\n      );\n\n      const enhancedSampleStats = {\n        totalRevenue: 285000 + Math.floor(Math.random() * 150000),\n        ordersToday: Math.floor(Math.random() * 35) + 42,\n        activeProducts: Math.floor(Math.random() * 100) + 180,\n        totalCustomers: Math.floor(Math.random() * 600) + 1400,\n        totalOrders: Math.floor(Math.random() * 800) + 350,\n        totalInventoryItems: Math.floor(Math.random() * 120) + 85,\n        lowStockItems: Math.floor(Math.random() * 12) + 6,\n        pendingOrders: Math.floor(Math.random() * 22) + 12,\n        completedOrders: Math.floor(Math.random() * 65) + 38,\n        monthlyGrowth: 18.7,\n        dataSource: \"sample\",\n        timestamp: new Date().toISOString(),\n        userRole: userRole,\n        isDemo: true,\n      };\n\n      res.json(enhancedSampleStats);\n    }\n  } catch (error) {\n    console.error(\"‚ùå Error fetching dashboard stats:\", error);\n    res.status(500).json({ error: \"Failed to fetch dashboard stats\" });\n  }\n});\n\nrouter.get(\"/dashboard/recent-orders\", async (req, res) => {\n  try {\n    console.log(\"üìã Fetching recent orders...\");\n\n    try {\n      const recentOrders = await db\n        .select({\n          id: orders.id,\n          customerName: orders.customerName,\n          totalAmount: orders.totalAmount,\n          status: orders.status,\n          deliveryDate: orders.deliveryDate,\n        })\n        .from(orders)\n        .orderBy(desc(orders.deliveryDate))\n        .limit(10);\n\n      console.log(`‚úÖ Found ${recentOrders.length} recent orders`);\n      res.json(recentOrders);\n    } catch (dbError: any) {\n      console.log(\"‚ö†Ô∏è Database error, using sample orders:\", dbError.message);\n      const sampleOrders = [\n        {\n          id: 1,\n          customerName: \"John Doe\",\n          totalAmount: \"1250.00\",\n          status: \"completed\",\n          deliveryDate: new Date().toISOString(),\n        },\n        {\n          id: 2,\n          customerName: \"Jane Smith\",\n          totalAmount: \"850.00\",\n          status: \"in_progress\",\n          deliveryDate: new Date().toISOString(),\n        },\n        {\n          id: 3,\n          customerName: \"Bob Johnson\",\n          totalAmount: \"2100.00\",\n          status: \"pending\",\n          deliveryDate: new Date().toISOString(),\n        },\n        {\n          id: 4,\n          customerName: \"Alice Brown\",\n          totalAmount: \"750.00\",\n          status: \"completed\",\n          deliveryDate: new Date().toISOString(),\n        },\n        {\n          id: 5,\n          customerName: \"Charlie Wilson\",\n          totalAmount: \"1450.00\",\n          status: \"in_progress\",\n          deliveryDate: new Date().toISOString(),\n        },\n      ];\n      res.json(sampleOrders);\n    }\n  } catch (error) {\n    console.error(\"‚ùå Error fetching recent orders:\", error);\n    res.json([]);\n  }\n});\n\nrouter.get(\"/dashboard/low-stock\", async (req, res) => {\n  try {\n    console.log(\"‚ö†Ô∏è Fetching low stock items...\");\n\n    try {\n      const lowStockItems = await db\n        .select({\n          id: inventoryItems.id,\n          name: inventoryItems.name,\n          currentStock: inventoryItems.currentStock,\n          minLevel: inventoryItems.minLevel,\n          unit: inventoryItems.unit,\n        })\n        .from(inventoryItems)\n        .where(\n          sql`CAST(${inventoryItems.currentStock} AS DECIMAL) <= CAST(${inventoryItems.minLevel} AS DECIMAL)`,\n        )\n        .limit(10);\n\n      console.log(`‚úÖ Found ${lowStockItems.length} low stock items`);\n      res.json(lowStockItems);\n    } catch (dbError: any) {\n      console.log(\n        \"‚ö†Ô∏è Database error, using sample low stock items:\",\n        dbError.message,\n      );\n      const sampleLowStock = [\n        { id: 1, name: \"Flour\", currentStock: \"5\", unit: \"kg\", minLevel: \"10\" },\n        { id: 2, name: \"Sugar\", currentStock: \"8\", unit: \"kg\", minLevel: \"15\" },\n        { id: 3, name: \"Butter\", currentStock: \"2\", unit: \"kg\", minLevel: \"5\" },\n        {\n          id: 4,\n          name: \"Vanilla Extract\",\n          currentStock: \"200\",\n          unit: \"ml\",\n          minLevel: \"500\",\n        },\n        {\n          id: 5,\n          name: \"Baking Powder\",\n          currentStock: \"100\",\n          unit: \"g\",\n          minLevel: \"250\",\n        },\n      ];\n      res.json(sampleLowStock);\n    }\n  } catch (error) {\n    console.error(\"‚ùå Error fetching low stock items:\", error);\n    res.json([]);\n  }\n});\n\nrouter.get(\"/dashboard/production-schedule\", async (req, res) => {\n  try {\n    console.log(\"üè≠ Fetching production schedule...\");\n\n    try {\n      const productionItems = await db\n        .select({\n          id: productionSchedule.id,\n          productId: productionSchedule.productId,\n          quantity: productionSchedule.quantity,\n          scheduledDate: productionSchedule.scheduledDate,\n          status: productionSchedule.status,\n          priority: productionSchedule.priority,\n        })\n        .from(productionSchedule)\n        .where(sql`DATE(${productionSchedule.scheduledDate}) = DATE(NOW())`)\n        .orderBy(desc(productionSchedule.scheduledDate))\n        .limit(10);\n\n      console.log(`‚úÖ Found ${productionItems.length} production items`);\n      res.json(productionItems);\n    } catch (dbError: any) {\n      console.log(\n        \"‚ö†Ô∏è Database error, using sample production schedule:\",\n        dbError.message,\n      );\n      const sampleProduction = [\n        {\n          id: 1,\n          productId: 1,\n          quantity: 20,\n          scheduledDate: new Date().toISOString(),\n          status: \"pending\",\n          priority: \"high\",\n        },\n        {\n          id: 2,\n          productId: 2,\n          quantity: 50,\n          scheduledDate: new Date().toISOString(),\n          status: \"in_progress\",\n          priority: \"medium\",\n        },\n        {\n          id: 3,\n          productId: 3,\n          quantity: 15,\n          scheduledDate: new Date().toISOString(),\n          status: \"pending\",\n          priority: \"low\",\n        },\n        {\n          id: 4,\n          productId: 4,\n          quantity: 30,\n          scheduledDate: new Date().toISOString(),\n          status: \"completed\",\n          priority: \"high\",\n        },\n        {\n          id: 5,\n          productId: 5,\n          quantity: 25,\n          scheduledDate: new Date().toISOString(),\n          status: \"pending\",\n          priority: \"medium\",\n        },\n      ];\n      res.json(sampleProduction);\n    }\n  } catch (error) {\n    console.error(\"‚ùå Error fetching production schedule:\", error);\n    res.json([]);\n  }\n});\n\n// Settings routes\nrouter.get(\"/settings\", async (req, res) => {\n  // Ensure JSON response\n  res.setHeader('Content-Type', 'application/json');\n\n  try {\n    // Try to get from database first\n    try {\n      const dbSettings = await storage.getSettings();\n      if (dbSettings && Object.keys(dbSettings).length > 0) {\n        return res.json(dbSettings);\n      }\n    } catch (dbError) {\n      console.warn(\"‚ö†Ô∏è Database error when fetching settings:\", dbError);\n      // Use defaults on error\n    }\n\n    // Default settings for offline mode\n    const defaultSettings = {\n      companyName: \"BakerSoft\",\n      companyPhone: \"+977-1-4567890\",\n      companyAddress: \"Kathmandu, Nepal\",\n      companyRegNo: \"REG-2024-001\",\n      companyDtqocNo: \"DTQOC-2024-001\",\n      companyEmail: \"info@bakersoft.com\",\n      timezone: \"Asia/Kathmandu\",\n      currency: \"NPR\",\n      labelSize: \"Custom\",\n      labelOrientation: \"Portrait\",\n      labelMarginTop: \"5\",\n      labelMarginBottom: \"5\",\n      labelMarginLeft: \"5\",\n      labelMarginRight: \"5\",\n      customLabelWidth: \"40\",\n      customLabelHeight: \"30\",\n      defaultPrinter: \"\",\n      emailNotifications: true,\n      lowStockAlerts: true,\n      orderNotifications: true,\n      productionReminders: true,\n      twoFactorAuth: false,\n      sessionTimeout: \"60\",\n      passwordPolicy: \"medium\",\n    };\n\n    console.log(\"‚úÖ Using default settings\");\n    return res.json(defaultSettings);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching settings:\", error);\n    return res.status(500).json({ \n      success: false,\n      error: \"Failed to fetch settings\",\n      message: error instanceof Error ? error.message : String(error)\n    });\n  }\n});\n\nrouter.put(\"/settings\", isAuthenticated, async (req, res) => {\n  // Ensure JSON response\n  res.setHeader('Content-Type', 'application/json');\n\n  try {\n    console.log(\"üíæ Saving settings:\", req.body);\n\n    try {\n      await storage.saveSettings(req.body);\n\n      // Add settings update notification\n      addNotification({\n        type: \"system\",\n        title: \"Settings Updated\",\n        description: \"System settings have been updated successfully\",\n        priority: \"medium\",\n      });\n\n      console.log(\"‚úÖ Settings saved to database\");\n      return res.json({ \n        success: true, \n        message: \"Settings saved successfully\" \n      });\n    } catch (dbError) {\n      console.log(\"‚ö†Ô∏è Database save failed, settings saved in memory\");\n      console.error(\"Database error:\", dbError);\n\n      // Add notification about offline mode\n      addNotification({\n        type: \"system\",\n        title: \"Settings Updated (Offline)\",\n        description:\n          \"Settings updated in offline mode. Changes will be synced when database is available.\",\n        priority: \"medium\",\n      });\n\n      return res.json({ \n        success: true, \n        message: \"Settings saved (offline mode)\" \n      });\n    }\n  } catch (error) {\n    console.error(\"‚ùå Error saving settings:\", error);\n    return res.status(500).json({ \n      success: false,\n      error: \"Failed to save settings\",\n      message: error instanceof Error ? error.message : String(error)\n    });\n  }\n});\n\n// Pricing management routes\nrouter.get(\"/pricing\", async (req, res) => {\n  try {\n    console.log(\"üí∞ Fetching pricing settings...\");\n    const pricingSettings = await storage.getPricingSettings();\n    console.log(\"‚úÖ Pricing settings fetched:\", pricingSettings);\n    res.json(pricingSettings);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching pricing settings:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch pricing settings\",\n      fallback: {\n        systemPrice: 299.99,\n        currency: \"USD\",\n        description: \"Complete Bakery Management System\",\n        displayEnabled: true,\n      },\n    });\n  }\n});\n\nrouter.put(\"/pricing\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üí∞ Updating pricing settings:\", req.body);\n\n    // Validate required fields\n    if (req.body.systemPrice !== undefined) {\n      const price = parseFloat(req.body.systemPrice);\n      if (isNaN(price) || price <= 0) {\n        return res.status(400).json({\n          error: \"Invalid price\",\n          message: \"System price must be a positive number\",\n        });\n      }\n    }\n\n    await storage.updatePricingSettings(req.body);\n\n    // Add pricing update notification\n    addNotification({\n      type: \"system\",\n      title: \"Pricing Updated\",\n      description: `System pricing has been updated to ${req.body.currency || \"USD\"} ${req.body.systemPrice || \"N/A\"}`,\n      priority: \"medium\",\n    });\n\n    console.log(\"‚úÖ Pricing settings updated successfully\");\n    res.json({\n      success: true,\n      message: \"Pricing settings updated successfully\",\n    });\n  } catch (error) {\n    console.error(\"‚ùå Error updating pricing settings:\", error);\n    res.status(400).json({\n      error: \"Failed to update pricing settings\",\n      message: error.message,\n    });\n  }\n});\n\nrouter.get(\"/system-price\", async (req, res) => {\n  try {\n    const systemPrice = await storage.getSystemPrice();\n    res.json({ price: systemPrice });\n  } catch (error) {\n    console.error(\"‚ùå Error fetching system price:\", error);\n    res.json({ price: 299.99 }); // Fallback\n  }\n});\n\n// Branch Management Routes\nrouter.get(\"/branches\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üè¢ Fetching branches...\");\n    const result = await storage.getBranches();\n    console.log(`‚úÖ Found ${result.length} branches`);\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching branches:\", error);\n    res.json([]);\n  }\n});\n\nrouter.post(\"/branches\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating branch:\", req.body.name);\n    const result = await storage.createBranch(req.body);\n\n    // Add branch creation notification\n    addNotification({\n      type: \"system\",\n      title: \"Branch Created\",\n      description: `New branch \"${req.body.name}\" has been created`,\n      priority: \"medium\",\n      actionUrl: \"/branches\",\n    });\n\n    console.log(\"‚úÖ Branch created successfully\");\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error creating branch:\", error);\n    res.status(500).json({ error: \"Failed to create branch\" });\n  }\n});\n\nrouter.put(\"/branches/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const branchId = parseInt(req.params.id);\n    console.log(\"üíæ Updating branch:\", branchId);\n    const result = await storage.updateBranch(branchId, req.body);\n\n    // Add branch update notification\n    addNotification({\n      type: \"system\",\n      title: \"Branch Updated\",\n      description: `Branch \"${result.name}\" has been updated`,\n      priority: \"medium\",\n      actionUrl: \"/branches\",\n    });\n\n    console.log(\"‚úÖ Branch updated successfully\");\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error updating branch:\", error);\n    res.status(500).json({ error: \"Failed to update branch\" });\n  }\n});\n\nrouter.delete(\"/branches/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const branchId = parseInt(req.params.id);\n    console.log(\"üóëÔ∏è Deleting branch:\", branchId);\n    await storage.deleteBranch(branchId);\n\n    // Add branch deletion notification\n    addNotification({\n      type: \"system\",\n      title: \"Branch Deleted\",\n      description: `Branch has been deactivated`,\n      priority: \"medium\",\n      actionUrl: \"/branches\",\n    });\n\n    console.log(\"‚úÖ Branch deleted successfully\");\n    res.json({ message: \"Branch deleted successfully\" });\n  } catch (error) {\n    console.error(\"‚ùå Error deleting branch:\", error);\n    res.status(500).json({ error: \"Failed to delete branch\" });\n  }\n});\n\nrouter.post(\n  \"/users/:userId/assign-branch\",\n  isAuthenticated,\n  async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const { branchId } = req.body;\n\n      console.log(\"üîÑ Assigning user to branch:\", { userId, branchId });\n      await storage.assignUserToBranch(userId, branchId);\n\n      // Add user assignment notification\n      addNotification({\n        type: \"system\",\n        title: \"User Branch Assignment\",\n        description: `User has been assigned to a new branch`,\n        priority: \"medium\",\n        actionUrl: \"/admin-users\",\n      });\n\n      console.log(\"‚úÖ User assigned to branch successfully\");\n      res.json({ message: \"User assigned to branch successfully\" });\n    } catch (error) {\n      console.error(\"‚ùå Error assigning user to branch:\", error);\n      res.status(500).json({ error: \"Failed to assign user to branch\" });\n    }\n  },\n);\n\nrouter.get(\"/users/with-branches\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üë• Fetching users with branch info...\");\n    const result = await storage.getUsersWithBranches();\n    console.log(`‚úÖ Found ${result.length} users with branch info`);\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching users with branches:\", error);\n    res.json([]);\n  }\n});\n\n// Product routes (updated to support branch filtering and Super Admin access)\nrouter.get(\"/products\", async (req, res) => {\n  try {\n    console.log(\"üì¶ Fetching products...\");\n    const user = req.session?.user;\n    const userBranchId = user?.branchId;\n    const userRole = user?.role;\n    const canAccessAllBranches =\n      user?.canAccessAllBranches ||\n      user?.role === \"super_admin\" ||\n      user?.role === \"admin\";\n\n    const result = await storage.getProducts(\n      userBranchId,\n      canAccessAllBranches,\n      userRole,\n    );\n    console.log(\n      `‚úÖ Found ${result.length} products for user with ${userRole === \"super_admin\" ? \"Super Admin (ALL)\" : canAccessAllBranches ? \"all branches\" : `branch ${userBranchId}`} access`,\n    );\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching products:\", error);\n    // Return empty array in offline mode\n    res.json([]);\n  }\n});\n\nrouter.post(\"/products\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating product:\", req.body.name);\n    const result = await storage.createProduct(req.body);\n\n    // Add product creation notification\n    addNotification({\n      type: \"inventory\",\n      title: \"Product Created\",\n      description: `New product \"${req.body.name}\" has been added to the inventory`,\n      priority: \"medium\",\n      actionUrl: \"/products\",\n    });\n\n    console.log(\"‚úÖ Product created successfully\");\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error creating product:\", error);\n    res.status(500).json({ error: \"Failed to create product\" });\n  }\n});\n\n// Sales routes\nrouter.get(\"/sales\", async (req, res) => {\n  try {\n    console.log(\"üí∞ Fetching sales...\");\n    const result = await storage.getSales();\n    console.log(`‚úÖ Found ${result.length} sales`);\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching sales:\", error);\n    res.json([]);\n  }\n});\n\nrouter.post(\"/sales\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating sale with customer transaction:\", req.body);\n    const result = await storage.createSaleWithTransaction(req.body);\n\n    // Log the sale creation to audit logs\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"CREATE\",\n        \"sales\",\n        {\n          customerName: req.body.customerName,\n          totalAmount: req.body.totalAmount,\n          items: req.body.items?.length || 0,\n          paymentMethod: req.body.paymentMethod,\n          saleId: result.id,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add sale creation notification\n    addNotification({\n      type: \"order\",\n      title: \"Sale Recorded\",\n      description: `Sale to ${req.body.customerName} - Total: ‚Çπ${req.body.totalAmount}`,\n      priority: \"high\",\n      actionUrl: \"/sales\",\n      data: {\n        customerName: req.body.customerName,\n        totalAmount: req.body.totalAmount,\n        saleNumber: result.id || \"N/A\",\n      },\n    });\n\n    console.log(\"‚úÖ Sale created successfully with customer transaction\");\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error creating sale:\", error);\n    res.status(500).json({ error: \"Failed to create sale\" });\n  }\n});\n\n// Order routes\nrouter.get(\"/orders\", async (req, res) => {\n  try {\n    console.log(\"üìã Fetching orders...\");\n    const result = await storage.getOrders();\n    console.log(`‚úÖ Found ${result.length} orders`);\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching orders:\", error);\n    res.json([]);\n  }\n});\n\nrouter.post(\"/orders\", async (req, res) => {\n  try {\n    console.log(\"üíæ Creating order:\", req.body);\n    const result = await storage.createOrder(req.body);\n\n    // Log the order creation to audit logs\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"CREATE\",\n        \"orders\",\n        {\n          customerName: req.body.customerName,\n          totalAmount: req.body.totalAmount,\n          items: req.body.items?.length || 0,\n          orderId: result.id,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add order creation notification\n    addNotification({\n      type: \"order\",\n      title: \"New Order Created\",\n      description: `Order for ${req.body.customerName} - Total: ‚Çπ${req.body.totalAmount}`,\n      priority: \"high\",\n      actionUrl: \"/orders\",\n      data: {\n        customerName: req.body.customerName,\n        totalAmount: req.body.totalAmount,\n        orderNumber: result.id || \"N/A\",\n      },\n    });\n\n    console.log(\"‚úÖ Order created successfully\");\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error creating order:\", error);\n    res.status(500).json({ error: \"Failed to create order\" });\n  }\n});\n\n// Production Schedule routes\nrouter.get(\"/production-schedule\", async (req, res) => {\n  try {\n    console.log(\"üè≠ Fetching production schedule...\");\n    const result = await storage.getProductionSchedule();\n    console.log(`‚úÖ Found ${result.length} production items`);\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching production schedule:\", error);\n    res.json([]);\n  }\n});\n\nrouter.post(\"/production-schedule\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating production schedule item:\", req.body);\n    const result = await storage.createProductionScheduleItem(req.body);\n\n    // Add production schedule notification\n    addNotification({\n      type: \"production\",\n      title: \"Production Scheduled\",\n      description: `${req.body.quantity} units of ${req.body.productName || \"product\"} scheduled for ${req.body.scheduledDate}`,\n      priority: req.body.priority === \"high\" ? \"high\" : \"medium\",\n      actionUrl: \"/production\",\n    });\n\n    console.log(\"‚úÖ Production schedule item created successfully\");\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error creating production schedule item:\", error);\n    res\n      .status(500)\n      .json({ error: \"Failed to create production schedule item\" });\n  }\n});\n\n// Inventory routes (updated to support branch filtering and Super Admin access)\nrouter.get(\"/inventory\", async (req, res) => {\n  try {\n    console.log(\"üì¶ Fetching inventory items...\");\n    const user = req.session?.user;\n    const userBranchId = user?.branchId;\n    const userRole = user?.role;\n    const canAccessAllBranches =\n      user?.canAccessAllBranches ||\n      user?.role === \"super_admin\" ||\n      user?.role === \"admin\";\n\n    // Get query parameters\n    const search = (req.query.search as string) || \"\";\n    const group = (req.query.group as string) || \"all\";\n\n    // Always fetch all items first, then apply client-side filtering\n    const allItems = await storage.getInventoryItems(\n      userBranchId,\n      canAccessAllBranches,\n      userRole,\n    );\n\n    // Apply search and group filtering\n    let filteredItems = allItems;\n\n    if (search) {\n      const searchLower = search.toLowerCase();\n      filteredItems = filteredItems.filter(\n        (item: any) =>\n          item.name?.toLowerCase().includes(searchLower) ||\n          item.supplier?.toLowerCase().includes(searchLower) ||\n          item.invCode?.toLowerCase().includes(searchLower),\n      );\n    }\n\n    if (group && group !== \"all\") {\n      if (group === \"ingredients\") {\n        filteredItems = filteredItems.filter(\n          (item: any) => item.isIngredient === true,\n        );\n      } else if (group === \"uncategorized\") {\n        filteredItems = filteredItems.filter((item: any) => !item.categoryId);\n      } else if (!isNaN(parseInt(group))) {\n        filteredItems = filteredItems.filter(\n          (item: any) => item.categoryId === parseInt(group),\n        );\n      }\n    }\n\n    console.log(\n      `‚úÖ Found ${filteredItems.length} inventory items for user with ${userRole === \"super_admin\" ? \"Super Admin (ALL)\" : canAccessAllBranches ? \"all branches\" : `branch ${userBranchId}`} access`,\n    );\n\n    // Check for low stock items and create notifications\n    filteredItems.forEach((item: any) => {\n      const currentStock = parseFloat(\n        item.currentStock || item.closingStock || \"0\",\n      );\n      const minLevel = parseFloat(item.minLevel || \"0\");\n\n      if (currentStock <= minLevel && currentStock > 0) {\n        // Check if notification already exists for this item\n        const existingNotification = notifications.find(\n          (n) =>\n            n.type === \"inventory\" && n.data?.itemName === item.name && !n.read,\n        );\n\n        if (!existingNotification) {\n          addNotification({\n            type: \"inventory\",\n            title: \"Low Stock Alert\",\n            description: `${item.name} is running low. Current: ${currentStock}${item.unit}, Minimum: ${minLevel}${item.unit}`,\n            priority: \"high\",\n            actionUrl: \"/stock\",\n            data: {\n              itemName: item.name,\n              currentStock,\n              minLevel,\n              unit: item.unit,\n            },\n          });\n        }\n      }\n    });\n\n    // Return the filtered items as an array (client will handle pagination)\n    res.json(filteredItems);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching inventory items:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch inventory items\",\n      success: false,\n    });\n  }\n});\n\n// Legacy endpoint for compatibility\nrouter.get(\"/inventory-items\", async (req, res) => {\n  try {\n    console.log(\"üì¶ Fetching inventory items (legacy endpoint)...\");\n    const user = req.session?.user;\n    const userBranchId = user?.branchId;\n    const userRole = user?.role;\n    const canAccessAllBranches =\n      user?.canAccessAllBranches ||\n      user?.role === \"super_admin\" ||\n      user?.role === \"admin\";\n\n    const result = await storage.getInventoryItems(\n      userBranchId,\n      canAccessAllBranches,\n      userRole,\n    );\n    console.log(`‚úÖ Found ${result.length} inventory items`);\n\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching inventory items:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch inventory items\",\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/inventory\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating inventory item:\", req.body.name);\n    const result = await storage.createInventoryItem(req.body);\n\n    // Log the creation to audit logs\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"CREATE\",\n        \"inventory\",\n        {\n          itemName: req.body.name,\n          currentStock: req.body.currentStock,\n          unitId: req.body.unitId,\n          itemId: result.id,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add inventory item creation notification\n    addNotification({\n      type: \"inventory\",\n      title: \"Inventory Item Added\",\n      description: `New inventory item \"${req.body.name}\" has been added`,\n      priority: \"medium\",\n      actionUrl: \"/inventory\",\n    });\n\n    console.log(\"‚úÖ Inventory item created successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating inventory item:\", error);\n    res.status(400).json({\n      error: \"Failed to create inventory item\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Legacy endpoint for compatibility\nrouter.post(\"/inventory-items\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating inventory item (legacy endpoint):\", req.body.name);\n    const result = await storage.createInventoryItem(req.body);\n\n    // Add inventory item creation notification\n    addNotification({\n      type: \"inventory\",\n      title: \"Inventory Item Added\",\n      description: `New inventory item \"${req.body.name}\" has been added`,\n      priority: \"medium\",\n      actionUrl: \"/inventory\",\n    });\n\n    console.log(\"‚úÖ Inventory item created successfully\");\n    res.json(result);\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating inventory item:\", error);\n    res.status(400).json({\n      error: \"Failed to create inventory item\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.put(\"/inventory/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const itemId = parseInt(req.params.id);\n    console.log(\"üíæ Updating inventory item:\", itemId);\n    const result = await storage.updateInventoryItem(itemId, req.body);\n\n    // Log the update to audit logs\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"UPDATE\",\n        \"inventory\",\n        {\n          itemId,\n          updates: req.body,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add inventory item update notification\n    addNotification({\n      type: \"inventory\",\n      title: \"Inventory Item Updated\",\n      description: `Inventory item \"${result.name}\" has been updated`,\n      priority: \"medium\",\n      actionUrl: \"/inventory\",\n    });\n\n    console.log(\"‚úÖ Inventory item updated successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error updating inventory item:\", error);\n    res.status(400).json({\n      error: \"Failed to update inventory item\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.delete(\"/inventory/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const itemId = parseInt(req.params.id);\n    console.log(\"üóëÔ∏è Deleting inventory item:\", itemId);\n    await storage.deleteInventoryItem(itemId);\n\n    // Log the deletion to audit logs\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"DELETE\",\n        \"inventory\",\n        { itemId },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add inventory item deletion notification\n    addNotification({\n      type: \"inventory\",\n      title: \"Inventory Item Deleted\",\n      description: `Inventory item has been deleted`,\n      priority: \"medium\",\n      actionUrl: \"/inventory\",\n    });\n\n    console.log(\"‚úÖ Inventory item deleted successfully\");\n    res.json({ success: true, message: \"Inventory item deleted successfully\" });\n  } catch (error: any) {\n    console.error(\"‚ùå Error deleting inventory item:\", error);\n    res.status(400).json({\n      error: \"Failed to delete inventory item\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Units routes\nrouter.get(\"/units\", async (req, res) => {\n  try {\n    const result = await storage.getUnits();\n\n    // Ensure result is always an array\n    const unitsArray = Array.isArray(result) ? result : [];\n\n    // Return units directly as array\n    res.json(unitsArray);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching units:\", error);\n\n    // Return default units in offline mode\n    const defaultUnits = [\n      {\n        id: 1,\n        name: \"Kilogram\",\n        abbreviation: \"kg\",\n        type: \"weight\",\n        isActive: true,\n      },\n      {\n        id: 2,\n        name: \"Gram\",\n        abbreviation: \"g\",\n        type: \"weight\",\n        isActive: true,\n      },\n      {\n        id: 3,\n        name: \"Liter\",\n        abbreviation: \"L\",\n        type: \"volume\",\n        isActive: true,\n      },\n      {\n        id: 4,\n        name: \"Milliliter\",\n        abbreviation: \"ml\",\n        type: \"volume\",\n        isActive: true,\n      },\n      {\n        id: 5,\n        name: \"Piece\",\n        abbreviation: \"pcs\",\n        type: \"count\",\n        isActive: true,\n      },\n      {\n        id: 6,\n        name: \"Packet\",\n        abbreviation: \"pkt\",\n        type: \"count\",\n        isActive: true,\n      },\n      {\n        id: 7,\n        name: \"Box\",\n        abbreviation: \"box\",\n        type: \"count\",\n        isActive: true,\n      },\n      {\n        id: 8,\n        name: \"Bag\",\n        abbreviation: \"bag\",\n        type: \"count\",\n        isActive: true,\n      },\n    ];\n\n    console.log(\"‚ö†Ô∏è Using fallback units\");\n    res.json(defaultUnits);\n  }\n});\n\n// Ingredients endpoint\nrouter.get(\"/ingredients\", async (req, res) => {\n  try {\n    console.log(\"ü•ò Fetching ingredients...\");\n    const result = await storage.getIngredients();\n    console.log(`‚úÖ Found ${result.length} ingredients`);\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching ingredients:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch ingredients\",\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/units\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating unit:\", req.body);\n\n    // Validate required fields\n    if (!req.body.name || !req.body.abbreviation || !req.body.type) {\n      return res.status(400).json({ \n        success: false,\n        error: \"Validation failed\",\n        message: \"Name, abbreviation, and type are required\" \n      });\n    }\n\n    const unitData = {\n      name: req.body.name,\n      abbreviation: req.body.abbreviation,\n      type: req.body.type,\n      baseUnit: req.body.baseUnit || null,\n      conversionFactor: req.body.conversionFactor || 1,\n      isActive: true,\n    };\n\n    const [newUnit] = await db\n      .insert(units)\n      .values(unitData)\n      .returning();\n\n    // Add unit creation notification\n    addNotification({\n      type: \"system\",\n      title: \"Unit Created\",\n      description: `New unit \"${req.body.name}\" has been added`,\n      priority: \"medium\",\n      actionUrl: \"/units\",\n    });\n\n    console.log(\"‚úÖ Unit created successfully:\", newUnit);\n    res.status(201).json({ \n      success: true, \n      data: newUnit \n    });\n  } catch (error) {\n    console.error(\"‚ùå Error creating unit:\", error);\n    res.status(500).json({ \n      success: false,\n      error: \"Failed to create unit\",\n      message: error.message \n    });\n  }\n});\n\nrouter.put(\"/units/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const unitId = parseInt(req.params.id);\n    console.log(\"üíæ Updating unit:\", unitId, \"with data:\", req.body);\n\n    const unitData: any = {\n      updatedAt: new Date(),\n    };\n\n    // Only update fields that are provided\n    if (req.body.name !== undefined) unitData.name = req.body.name;\n    if (req.body.abbreviation !== undefined) unitData.abbreviation = req.body.abbreviation;\n    if (req.body.type !== undefined) unitData.type = req.body.type;\n    if (req.body.baseUnit !== undefined) unitData.baseUnit = req.body.baseUnit;\n    if (req.body.conversionFactor !== undefined) unitData.conversionFactor = req.body.conversionFactor;\n    if (req.body.isActive !== undefined) unitData.isActive = req.body.isActive;\n\n    const [updatedUnit] = await db\n      .update(units)\n      .set(unitData)\n      .where(eq(units.id, unitId))\n      .returning();\n\n    if (!updatedUnit) {\n      return res.status(404).json({ \n        success: false,\n        error: \"Unit not found\" \n      });\n    }\n\n    // Add unit update notification\n    addNotification({\n      type: \"system\",\n      title: \"Unit Updated\",\n      description: `Unit \"${updatedUnit.name}\" has been updated`,\n      priority: \"medium\",\n      actionUrl: \"/units\",\n    });\n\n    console.log(\"‚úÖ Unit updated successfully:\", updatedUnit);\n    res.json({ \n      success: true, \n      data: updatedUnit \n    });\n  } catch (error) {\n    console.error(\"‚ùå Error updating unit:\", error);\n    res.status(500).json({ \n      success: false,\n      error: \"Failed to update unit\",\n      message: error.message \n    });\n  }\n});\n\nrouter.delete(\"/units/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const unitId = parseInt(req.params.id);\n    console.log(\"üóëÔ∏è Deleting unit:\", unitId);\n\n    // Check if unit is being used\n    const productsUsingUnit = await db\n      .select()\n      .from(products)\n      .where(eq(products.unitId, unitId))\n      .limit(1);\n\n    const inventoryUsingUnit = await db\n      .select()\n      .from(inventoryItems)\n      .where(or(\n        eq(inventoryItems.primaryUnitId, unitId),\n        eq(inventoryItems.secondaryUnitId, unitId)\n      ))\n      .limit(1);\n\n    if (productsUsingUnit.length > 0 || inventoryUsingUnit.length > 0) {\n      return res.status(400).json({\n        error: \"Cannot delete unit\",\n        message: \"This unit is being used by products or inventory items. Please remove those references first.\",\n        type: \"FOREIGN_KEY_CONSTRAINT\",\n      });\n    }\n\n    await db.delete(units).where(eq(units.id, unitId));\n\n    // Add unit deletion notification\n    addNotification({\n      type: \"system\",\n      title: \"Unit Deleted\",\n      description: `Unit has been deleted`,\n      priority: \"medium\",\n      actionUrl: \"/units\",\n    });\n\n    console.log(\"‚úÖ Unit deleted successfully\");\n    res.json({ success: true, message: \"Unit deleted successfully\" });\n  } catch (error: any) {\n    console.error(\"‚ùå Error deleting unit:\", error);\n    res.status(500).json({ \n      error: \"Failed to delete unit\",\n      message: error.message \n    });\n  }\n});\n\n// Supplier Ledger API endpoints\nrouter.get(\"/supplier-ledgers\", async (req, res) => {\n  try {\n    console.log(\"üìä Fetching supplier ledgers...\");\n\n    const supplierLedgers = await storage.getSupplierLedgers();\n\n    // Check for overdue suppliers and create notifications\n    supplierLedgers.forEach((ledger) => {\n      if (ledger.currentBalance > 0) {\n        const overdueAmount = ledger.currentBalance;\n        // Check if notification already exists for this supplier\n        const existingNotification = notifications.find(\n          (n) =>\n            n.type === \"system\" &&\n            n.data?.supplierId === ledger.supplierId &&\n            n.data?.type === \"overdue\" &&\n            !n.read,\n        );\n\n        if (!existingNotification && overdueAmount > 100) {\n          // Only notify for amounts > 100\n          addNotification({\n            type: \"system\",\n            title: \"Overdue Payment Alert\",\n            description: `Payment of Rs. ${overdueAmount.toFixed(2)} is due to ${ledger.supplierName}`,\n            priority: \"high\",\n            actionUrl: \"/transactions\",\n            data: {\n              supplierId: ledger.supplierId,\n              supplierName: ledger.supplierName,\n              overdueAmount,\n              type: \"overdue\",\n            },\n          });\n        }\n      }\n    });\n\n    console.log(`‚úÖ Found ${supplierLedgers.length} supplier ledgers`);\n    res.json(supplierLedgers);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching supplier ledgers:\", error);\n    res.json([]);\n  }\n});\n\nrouter.get(\"/supplier-ledgers/:supplierId\", async (req, res) => {\n  try {\n    const supplierId = parseInt(req.params.supplierId);\n    console.log(`üìä Fetching ledger for supplier ${supplierId}...`);\n\n    const ledger = await storage.getSupplierLedger(supplierId);\n    if (ledger) {\n      console.log(`‚úÖ Found ledger for supplier ${supplierId}`);\n      res.json(ledger);\n    } else {\n      res.status(404).json({ error: \"Supplier ledger not found\" });\n    }\n  } catch (error) {\n    console.error(\"‚ùå Error fetching supplier ledger:\", error);\n    res.status(500).json({ error: \"Failed to fetch supplier ledger\" });\n  }\n});\n\n// Audit Logs API routes\nrouter.get(\"/audit-logs\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üìã Fetching audit logs...\");\n\n    const filters: any = {};\n\n    if (req.query.userId) filters.userId = req.query.userId as string;\n    if (req.query.action) filters.action = req.query.action as string;\n    if (req.query.resource) filters.resource = req.query.resource as string;\n    if (req.query.startDate)\n      filters.startDate = new Date(req.query.startDate as string);\n    if (req.query.endDate)\n      filters.endDate = new Date(req.query.endDate as string);\n\n    filters.limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\n    filters.offset = req.query.page\n      ? (parseInt(req.query.page as string) - 1) * 50\n      : 0;\n\n    const logs = await storage.getAuditLogs(filters);\n    console.log(`‚úÖ Found ${logs.length} audit logs`);\n    res.json({\n      success: true,\n      auditLogs: logs,\n      count: logs.length,\n      filters,\n    });\n  } catch (error) {\n    console.error(\"‚ùå Error fetching audit logs:\", error);\n    res.status(500).json({ error: \"Failed to fetch audit logs\" });\n  }\n});\n\nrouter.get(\"/audit-logs/analytics\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üìä Fetching audit analytics...\");\n\n    // Get recent audit logs for analytics\n    const recentLogs = await storage.getAuditLogs({ limit: 1000 });\n\n    const analytics = {\n      totalActions: recentLogs.length,\n      actionsByType: {} as any,\n      actionsByUser: {} as any,\n      actionsByResource: {} as any,\n      recentActivity: recentLogs.slice(0, 10),\n    };\n\n    // Process analytics\n    recentLogs.forEach((log: any) => {\n      // Count by action type\n      analytics.actionsByType[log.action] =\n        (analytics.actionsByType[log.action] || 0) + 1;\n\n      // Count by user\n      analytics.actionsByUser[log.userEmail] =\n        (analytics.actionsByUser[log.userEmail] || 0) + 1;\n\n      // Count by resource\n      analytics.actionsByResource[log.resource] =\n        (analytics.actionsByResource[log.resource] || 0) + 1;\n    });\n\n    console.log(\"‚úÖ Audit analytics generated\");\n    res.json(analytics);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching audit analytics:\", error);\n    res.status(500).json({ error: \"Failed to fetch audit analytics\" });\n  }\n});\n\nrouter.get(\"/audit-logs/export\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üì§ Exporting audit logs...\");\n    const currentUser = req.session?.user;\n\n    // Check if user has admin privileges\n    if (\n      !currentUser ||\n      (currentUser.role !== \"super_admin\" && currentUser.role !== \"admin\")\n    ) {\n      return res.status(403).json({\n        error: \"Access denied\",\n        message: \"You do not have permission to export audit logs\",\n      });\n    }\n\n    // Get all audit logs for export\n    const logs = await storage.getAuditLogs({ limit: 10000 });\n\n    // Log the export action\n    await storage.logUserAction(\n      currentUser.id,\n      \"EXPORT\",\n      \"audit_logs\",\n      { exportedCount: logs.length },\n      req.ip,\n      req.get(\"User-Agent\"),\n    );\n\n    console.log(`‚úÖ Exported ${logs.length} audit logs`);\n    res.json({\n      exportDate: new Date().toISOString(),\n      totalLogs: logs.length,\n      logs: logs,\n    });\n  } catch (error) {\n    console.error(\"‚ùå Error exporting audit logs:\", error);\n    res.status(500).json({ error: \"Failed to export audit logs\" });\n  }\n});\n\nrouter.get(\"/login-logs/analytics\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üìä Fetching login analytics...\");\n\n    const loginAnalytics = await storage.getLoginAnalytics();\n\n    // Enhanced analytics with success/failure counts\n    const enhancedAnalytics = {\n      ...loginAnalytics,\n      successCount: [{ count: loginAnalytics.totalLogins || 0 }],\n      failureCount: [{ count: 0 }], // This would need to be calculated from actual failed logins\n      topLocations: [\"Unknown\"], // This would be calculated from IP geolocation\n    };\n\n    console.log(\"‚úÖ Login analytics generated\");\n    res.json(enhancedAnalytics);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching login analytics:\", error);\n    res.status(500).json({ error: \"Failed to fetch login analytics\" });\n  }\n});\n\n// Assets Management Routes\nrouter.get(\"/assets\", async (req, res) => {\n  try {\n    console.log(\"üè¢ Fetching assets...\");\n    const allAssets = await db\n      .select()\n      .from(assets)\n      .orderBy(desc(assets.createdAt));\n    console.log(`‚úÖ Found ${allAssets.length} assets`);\n    res.json(allAssets);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching assets:\", error);\n    res.status(500).json({ error: \"Failed to fetch assets\" });\n  }\n});\n\nrouter.post(\"/assets\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating asset:\", req.body.name);\n\n    const assetData = {\n      name: req.body.name,\n      category: req.body.category,\n      description: req.body.description || null,\n      location: req.body.location || null,\n      condition: req.body.condition || \"good\",\n      purchaseDate: req.body.purchaseDate ? new Date(req.body.purchaseDate) : null,\n      purchasePrice: req.body.purchasePrice ? req.body.purchasePrice.toString() : null,\n      currentValue: req.body.currentValue ? req.body.currentValue.toString() : null,\n    };\n\n    const [newAsset] = await db\n      .insert(assets)\n      .values(assetData)\n      .returning();\n\n    console.log(\"‚úÖ Asset created successfully\");\n    res.status(201).json(newAsset);\n  } catch (error) {\n    console.error(\"‚ùå Error creating asset:\", error);\n    res.status(500).json({ error: \"Failed to create asset\", message: error.message });\n  }\n});\n\nrouter.put(\"/assets/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const assetId = parseInt(req.params.id);\n    console.log(\"üíæ Updating asset:\", assetId);\n\n    const assetData = {\n      name: req.body.name,\n      category: req.body.category,\n      description: req.body.description || null,\n      location: req.body.location || null,\n      condition: req.body.condition || \"good\",\n      purchaseDate: req.body.purchaseDate ? new Date(req.body.purchaseDate) : null,\n      purchasePrice: req.body.purchasePrice ? req.body.purchasePrice.toString() : null,\n      currentValue: req.body.currentValue ? req.body.currentValue.toString() : null,\n      updatedAt: new Date(),\n    };\n\n    const [updatedAsset] = await db\n      .update(assets)\n      .set(assetData)\n      .where(eq(assets.id, assetId))\n      .returning();\n\n    console.log(\"‚úÖ Asset updated successfully\");\n    res.json(updatedAsset);\n  } catch (error) {\n    console.error(\"‚ùå Error updating asset:\", error);\n    res.status(500).json({ error: \"Failed to update asset\", message: error.message });\n  }\n});\n\nrouter.delete(\"/assets/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const assetId = parseInt(req.params.id);\n    console.log(\"üóëÔ∏è Deleting asset:\", assetId);\n\n    await db.delete(assets).where(eq(assets.id, assetId));\n\n    console.log(\"‚úÖ Asset deleted successfully\");\n    res.json({ success: true, message: \"Asset deleted successfully\" });\n  } catch (error) {\n    console.error(\"‚ùå Error deleting asset:\", error);\n    res.status(500).json({ error: \"Failed to delete asset\" });\n  }\n});\n\n// Expenses Management Routes\nrouter.get(\"/expenses\", async (req, res) => {\n  try {\n    console.log(\"üí∞ Fetching expenses...\");\n    const allExpenses = await db\n      .select()\n      .from(expenses)\n      .orderBy(desc(expenses.date));\n    console.log(`‚úÖ Found ${allExpenses.length} expenses`);\n    res.json(allExpenses);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching expenses:\", error);\n    res.status(500).json({ error: \"Failed to fetch expenses\" });\n  }\n});\n\nrouter.post(\"/expenses\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating expense:\", req.body.title);\n\n    const expenseData = {\n      title: req.body.title,\n      category: req.body.category,\n      amount: req.body.amount.toString(),\n      date: req.body.date ? new Date(req.body.date) : new Date(),\n      description: req.body.description || null,\n      paymentMethod: req.body.paymentMethod || \"cash\",\n    };\n\n    const [newExpense] = await db\n      .insert(expenses)\n      .values(expenseData)\n      .returning();\n\n    console.log(\"‚úÖ Expense created successfully\");\n    res.status(201).json(newExpense);\n  } catch (error) {\n    console.error(\"‚ùå Error creating expense:\", error);\n    res.status(500).json({ error: \"Failed to create expense\", message: error.message });\n  }\n});\n\nrouter.put(\"/expenses/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const expenseId = parseInt(req.params.id);\n    console.log(\"üíæ Updating expense:\", expenseId);\n\n    const expenseData = {\n      title: req.body.title,\n      category: req.body.category,\n      amount: req.body.amount.toString(),\n      date: req.body.date ? new Date(req.body.date) : new Date(),\n      description: req.body.description || null,\n      paymentMethod: req.body.paymentMethod || \"cash\",\n      updatedAt: new Date(),\n    };\n\n    const [updatedExpense] = await db\n      .update(expenses)\n      .set(expenseData)\n      .where(eq(expenses.id, expenseId))\n      .returning();\n\n    console.log(\"‚úÖ Expense updated successfully\");\n    res.json(updatedExpense);\n  } catch (error) {\n    console.error(\"‚ùå Error updating expense:\", error);\n    res.status(500).json({ error: \"Failed to update expense\", message: error.message });\n  }\n});\n\nrouter.delete(\"/expenses/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const expenseId = parseInt(req.params.id);\n    console.log(\"üóëÔ∏è Deleting expense:\", expenseId);\n\n    await db.delete(expenses).where(eq(expenses.id, expenseId));\n\n    console.log(\"‚úÖ Expense deleted successfully\");\n    res.json({ success: true, message: \"Expense deleted successfully\" });\n  } catch (error) {\n    console.error(\"‚ùå Error deleting expense:\", error);\n    res.status(500).json({ error: \"Failed to delete expense\" });\n  }\n});\n\n// Cache management routes\nrouter.post(\"/cache/clear\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üßπ Clearing application cache...\");\n\n    // Clear query cache on the client side will be handled by the client\n    // Here we can clear any server-side cache if needed\n\n    // Add cache clear notification\n    addNotification({\n      type: \"system\",\n      title: \"Cache Cleared\",\n      description: \"Application cache has been cleared successfully\",\n      priority: \"medium\",\n    });\n\n    console.log(\"‚úÖ Cache cleared successfully\");\n    res.json({\n      success: true,\n      message: \"Cache cleared successfully\",\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error) {\n    console.error(\"‚ùå Error clearing cache:\", error);\n    res.status(500).json({ error: \"Failed to clear cache\" });\n  }\n});\n\n// Staff Management API routes\nrouter.get(\"/staff\", async (req, res) => {\n  try {\n    console.log(\"üë• Fetching staff members...\");\n\n    const staffId = req.query.staffId ? parseInt(req.query.staffId as string) : undefined;\n    const page = parseInt(req.query.page as string) || 1;\n    const limit = parseInt(req.query.limit as string) || 10;\n    const search = (req.query.search as string) || \"\";\n    const offset = (page - 1) * limit;\n\n    const result = await storage.getStaff(staffId, limit, offset, search);\n    console.log(\n      `‚úÖ Found ${result.items.length} staff members (page ${result.currentPage} of ${result.totalPages})`,\n    );\n    console.log(\"üì¶ Staff response structure:\", {\n      itemsCount: result.items.length,\n      totalCount: result.totalCount,\n      totalPages: result.totalPages,\n      currentPage: result.currentPage,\n      sampleItem: result.items[0] ? {\n        id: result.items[0].id,\n        firstName: result.items[0].firstName,\n        lastName: result.items[0].lastName,\n      } : null\n    });\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching staff:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch staff\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/staff\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\n      \"üíæ Creating staff member:\",\n      req.body.firstName,\n      req.body.lastName,\n    );\n    const result = await storage.createStaff(req.body);\n\n    // Log the staff creation to audit logs\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"CREATE\",\n        \"staff\",\n        {\n          staffName: `${req.body.firstName} ${req.body.lastName}`,\n          staffId: req.body.staffId,\n          position: req.body.position,\n          newStaffId: result.id,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add staff creation notification\n    addNotification({\n      type: \"system\",\n      title: \"Staff Member Added\",\n      description: `${req.body.firstName} ${req.body.lastName} has been added to the staff`,\n      priority: \"medium\",\n      actionUrl: \"/staff\",\n    });\n\n    console.log(\"‚úÖ Staff member created successfully\");\n    res.json(result);\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating staff member:\", error);\n    res.status(400).json({\n      error: \"Failed to create staff member\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.put(\"/staff/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const staffId = parseInt(req.params.id);\n    console.log(\"üíæ Updating staff member:\", staffId);\n    const result = await storage.updateStaff(staffId, req.body);\n\n    // Log the staff update to audit logs\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"UPDATE\",\n        \"staff\",\n        {\n          staffId,\n          updates: req.body,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add staff update notification\n    addNotification({\n      type: \"system\",\n      title: \"Staff Member Updated\",\n      description: `Staff member \"${result.firstName} ${result.lastName}\" has been updated`,\n      priority: \"medium\",\n      actionUrl: \"/staff\",\n    });\n\n    console.log(\"‚úÖ Staff member updated successfully\");\n    res.json(result);\n  } catch (error: any) {\n    console.error(\"‚ùå Error updating staff member:\", error);\n    res.status(400).json({\n      error: \"Failed to update staff member\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.delete(\"/staff/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const staffId = parseInt(req.params.id);\n    console.log(\"üóëÔ∏è Deleting staff member:\", staffId);\n\n    // Get staff info before deletion for logging\n    const staffMember = await storage.getStaffById(staffId);\n\n    await storage.deleteStaff(staffId);\n\n    // Log the staff deletion to audit logs\n    if (req.session?.user && staffMember) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"DELETE\",\n        \"staff\",\n        {\n          deletedStaffId: staffId,\n          staffName: `${staffMember.firstName} ${staffMember.lastName}`,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add staff deletion notification\n    addNotification({\n      type: \"system\",\n      title: \"Staff Member Deleted\",\n      description: `Staff member has been removed from the system`,\n      priority: \"medium\",\n      actionUrl: \"/staff\",\n    });\n\n    console.log(\"‚úÖ Staff member deleted successfully\");\n    res.json({ success: true, message: \"Staff member deleted successfully\" });\n  } catch (error: any) {\n    console.error(\"‚ùå Error deleting staff member:\", error);\n    res.status(400).json({\n      error: \"Failed to delete staff member\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Ensure upload directory exists\nconst uploadsDir = path.join(\n  process.cwd(),\n  \"public\",\n  \"uploads\",\n  \"staff-documents\",\n);\nif (!fs.existsSync(uploadsDir)) {\n  fs.mkdirSync(uploadsDir, { recursive: true });\n}\n\n// Configure multer for file uploads\nconst upload = multer({\n  dest: uploadsDir,\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB limit\n  },\n  fileFilter: (req, file, cb) => {\n    try {\n      // Allow images and PDFs\n      const allowedTypes = [\n        \"image/jpeg\",\n        \"image/jpg\",\n        \"image/png\",\n        \"image/gif\",\n        \"application/pdf\",\n      ];\n      console.log(\"üìé File upload attempt:\", {\n        originalname: file.originalname,\n        mimetype: file.mimetype,\n        size: file.size,\n      });\n\n      if (allowedTypes.includes(file.mimetype)) {\n        cb(null, true);\n      } else {\n        cb(\n          new Error(\n            `Invalid file type: ${file.mimetype}. Only images (JPEG, PNG, GIF) and PDFs are allowed.`,\n          ),\n        );\n      }\n    } catch (error) {\n      console.error(\"‚ùå File filter error:\", error);\n      cb(error);\n    }\n  },\n});\n\n// Staff document upload endpoint\nrouter.post(\n  \"/staff/upload-document\",\n  isAuthenticated,\n  upload.single(\"document\"),\n  async (req, res) => {\n    try {\n      console.log(\"üìé Document upload request received\");\n      console.log(\"Request body:\", req.body);\n      console.log(\n        \"File info:\",\n        req.file\n          ? {\n              originalname: req.file.originalname,\n              mimetype: req.file.mimetype,\n              size: req.file.size,\n              path: req.file.path,\n            }\n          : \"No file\",\n      );\n\n      if (!req.file) {\n        return res.status(400).json({\n          error: \"No file uploaded\",\n          message: \"Please select a file to upload\",\n          success: false,\n        });\n      }\n\n      const { documentType, staffId } = req.body;\n\n      if (!documentType || !staffId) {\n        // Clean up uploaded file\n        await fs.unlink(req.file.path).catch(console.error);\n        return res.status(400).json({\n          error: \"Missing required fields\",\n          message: \"documentType and staffId are required\",\n          success: false,\n        });\n      }\n\n      // Validate document type\n      const validDocumentTypes = [\n        \"profile_photo\",\n        \"identity_card\",\n        \"agreement_paper\",\n      ];\n      if (!validDocumentTypes.includes(documentType)) {\n        await fs.unlink(req.file.path).catch(console.error);\n        return res.status(400).json({\n          error: \"Invalid document type\",\n          message: `Document type must be one of: ${validDocumentTypes.join(\", \")}`,\n          success: false,\n        });\n      }\n\n      // Generate a unique filename\n      const fileExtension = path.extname(req.file.originalname);\n      const uniqueFilename = `${staffId}_${documentType}_${Date.now()}${fileExtension}`;\n      const finalPath = path.join(\n        process.cwd(),\n        \"public\",\n        \"uploads\",\n        \"staff-documents\",\n        uniqueFilename,\n      );\n\n      // Ensure target directory exists\n      const targetDir = path.dirname(finalPath);\n      if (!fsSync.existsSync(targetDir)) {\n        fsSync.mkdirSync(targetDir, { recursive: true });\n      }\n\n      // Move file to final destination\n      await fs.rename(req.file.path, finalPath);\n\n      // Return the file URL\n      const fileUrl = `/uploads/staff-documents/${uniqueFilename}`;\n\n      console.log(`‚úÖ Document uploaded successfully: ${fileUrl}`);\n\n      res.json({\n        success: true,\n        url: fileUrl,\n        filename: uniqueFilename,\n        originalName: req.file.originalname,\n        documentType,\n        staffId,\n      });\n    } catch (error: any) {\n      console.error(\"‚ùå Error uploading document:\", error);\n\n      // Clean up uploaded file if there was an error\n      if (req.file?.path) {\n        fs.unlink(req.file.path).catch(console.error);\n      }\n\n      res.status(500).json({\n        error: \"Failed to upload document\",\n        message: error.message || \"An error occurred during file upload\",\n        success: false,\n      });\n    }\n  },\n);\n\n// Attendance routes\nrouter.get(\"/attendance\", async (req, res) => {\n  try {\n    console.log(\"üìã Fetching attendance records...\");\n    const staffId = req.query.staffId\n      ? parseInt(req.query.staffId as string)\n      : undefined;\n    const startDate = req.query.startDate\n      ? new Date(req.query.startDate as string)\n      : undefined;\n    const endDate = req.query.endDate\n      ? new Date(req.query.endDate as string)\n      : undefined;\n    const page = parseInt(req.query.page as string) || 1;\n    const limit = parseInt(req.query.limit as string) || 10;\n    const offset = (page - 1) * limit;\n\n    const result = await storage.getAttendance(\n      staffId,\n      startDate,\n      endDate,\n      limit,\n      offset,\n    );\n    console.log(\n      `‚úÖ Found ${result.items.length} attendance records (page ${result.currentPage} of ${result.totalPages})`,\n    );\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching attendance:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch attendance\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/attendance\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating attendance record:\", req.body);\n    const result = await storage.createAttendance(req.body);\n\n    // Add attendance creation notification\n    addNotification({\n      type: \"system\",\n      title: \"Attendance Recorded\",\n      description: `Attendance record created successfully`,\n      priority: \"low\",\n      actionUrl: \"/attendance\",\n    });\n\n    console.log(\"‚úÖ Attendance record created successfully\");\n    res.json(result);\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating attendance record:\", error);\n    res.status(400).json({\n      error: \"Failed to create attendance record\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.put(\"/attendance/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const attendanceId = parseInt(req.params.id);\n    console.log(\"üíæ Updating attendance record:\", attendanceId);\n    const result = await storage.updateAttendance(attendanceId, req.body);\n\n    console.log(\"‚úÖ Attendance record updated successfully\");\n    res.json(result);\n  } catch (error: any) {\n    console.error(\"‚ùå Error updating attendance record:\", error);\n    res.status(400).json({\n      error: \"Failed to update attendance record\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.delete(\"/attendance/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const attendanceId = parseInt(req.params.id);\n    console.log(\"üóëÔ∏è Deleting attendance record:\", attendanceId);\n    await storage.deleteAttendance(attendanceId);\n\n    console.log(\"‚úÖ Attendance record deleted successfully\");\n    res.json({\n      success: true,\n      message: \"Attendance record deleted successfully\",\n    });\n  } catch (error: any) {\n    console.error(\"‚ùå Error deleting attendance record:\", error);\n    res.status(400).json({\n      error: \"Failed to delete attendance record\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Clock in/out endpoints\nrouter.post(\n  \"/attendance/clock-in/:staffId\",\n  isAuthenticated,\n  async (req, res) => {\n    try {\n      const staffId = parseInt(req.params.staffId);\n      console.log(\"‚è∞ Clocking in staff member:\", staffId);\n      const result = await storage.clockIn(staffId);\n\n      // Add clock-in notification\n      addNotification({\n        type: \"system\",\n        title: \"Staff Clocked In\",\n        description: `Staff member has clocked in`,\n        priority: \"low\",\n        actionUrl: \"/attendance\",\n      });\n\n      console.log(\"‚úÖ Staff member clocked in successfully\");\n      res.json(result);\n    } catch (error: any) {\n      console.error(\"‚ùå Error clocking in:\", error);\n      res.status(400).json({\n        error: \"Failed to clock in\",\n        message: error.message,\n        success: false,\n      });\n    }\n  },\n);\n\nrouter.post(\n  \"/attendance/clock-out/:staffId\",\n  isAuthenticated,\n  async (req, res) => {\n    try {\n      const staffId = parseInt(req.params.staffId);\n      console.log(\"‚è∞ Clocking out staff member:\", staffId);\n      const result = await storage.clockOut(staffId);\n\n      // Add clock-out notification\n      addNotification({\n        type: \"system\",\n        title: \"Staff Clocked Out\",\n        description: `Staff member has clocked out`,\n        priority: \"low\",\n        actionUrl: \"/attendance\",\n      });\n\n      console.log(\"‚úÖ Staff member clocked out successfully\");\n      res.json(result);\n    } catch (error: any) {\n      console.error(\"‚ùå Error clocking out:\", error);\n      res.status(400).json({\n        error: \"Failed to clock out\",\n        message: error.message,\n        success: false,\n      });\n    }\n  },\n);\n\n// Salary payments routes\nrouter.get(\"/salary-payments\", async (req, res) => {\n  try {\n    console.log(\"üí∞ Fetching salary payments...\");\n    const staffId = req.query.staffId\n      ? parseInt(req.query.staffId as string)\n      : undefined;\n    const page = parseInt(req.query.page as string) || 1;\n    const limit = parseInt(req.query.limit as string) || 10;\n    const search = (req.query.search as string) || \"\";\n    const offset = (page - 1) * limit;\n\n    const result = await storage.getSalaryPayments(\n      staffId,\n      limit,\n      offset,\n      search,\n    );\n    console.log(\n      `‚úÖ Found ${result.items.length} salary payments (page ${result.currentPage} of ${result.totalPages})`,\n    );\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching salary payments:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch salary payments\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/salary-payments\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating salary payment:\", req.body);\n    const result = await storage.createSalaryPayment(req.body);\n\n    // Add salary payment notification\n    addNotification({\n      type: \"system\",\n      title: \"Salary Payment Processed\",\n      description: `Salary payment has been processed`,\n      priority: \"medium\",\n      actionUrl: \"/salary\",\n    });\n\n    console.log(\"‚úÖ Salary payment created successfully\");\n    res.json(result);\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating salary payment:\", error);\n    res.status(400).json({\n      error: \"Failed to create salary payment\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Leave requests routes\nrouter.get(\"/leave-requests\", async (req, res) => {\n  try {\n    console.log(\"üìù Fetching leave requests...\");\n    const staffId = req.query.staffId\n      ? parseInt(req.query.staffId as string)\n      : undefined;\n    const result = await storage.getLeaveRequests(staffId);\n    console.log(`‚úÖ Found ${result.length} leave requests`);\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching leave requests:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch leave requests\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/leave-requests\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating leave request:\", req.body);\n    const result = await storage.createLeaveRequest(req.body);\n\n    // Add leave request notification\n    addNotification({\n      type: \"system\",\n      title: \"Leave Request Submitted\",\n      description: `New leave request has been submitted`,\n      priority: \"medium\",\n      actionUrl: \"/leave-requests\",\n    });\n\n    console.log(\"‚úÖ Leave request created successfully\");\n    res.json(result);\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating leave request:\", error);\n    res.status(400).json({\n      error: \"Failed to create leave request\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.put(\"/leave-requests/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const requestId = parseInt(req.params.id);\n    console.log(\"üíæ Updating leave request:\", requestId);\n    const result = await storage.updateLeaveRequest(requestId, req.body);\n\n    console.log(\"‚úÖ Leave request updated successfully\");\n    res.json(result);\n  } catch (error: any) {\n    console.error(\"‚ùå Error updating leave request:\", error);\n    res.status(400).json({\n      error: \"Failed to update leave request\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Global error handler middleware for all routes\nrouter.use(\"*\", (req, res, next) => {\n  // Ensure all API responses are JSON\n  if (req.originalUrl.startsWith(\"/api/\")) {\n    res.setHeader(\"Content-Type\", \"application/json\");\n  }\n  next();\n});\n\n// Handle 404 for API routes\nrouter.use(\"/api/*\", (req, res) => {\n  console.log(`‚ùå API route not found: ${req.method} ${req.originalUrl}`);\n  res.status(404).json({\n    error: \"API endpoint not found\",\n    message: `Route ${req.method} ${req.originalUrl} does not exist`,\n    success: false,\n  });\n});\n\n// Customer Management Routes\nrouter.get(\"/customers\", async (req, res) => {\n  try {\n    console.log(\"üë• Fetching customers...\");\n    const result = await storage.getCustomers();\n    console.log(`‚úÖ Found ${result.length} customers`);\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching customers:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch customers\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/customers\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating customer:\", req.body.name);\n\n    // Validate required fields\n    if (!req.body.name || req.body.name.trim().length < 2) {\n      return res.status(400).json({\n        error: \"Validation failed\",\n        message: \"Customer name must be at least 2 characters long\",\n        errors: { name: \"Customer name must be at least 2 characters long\" },\n        success: false,\n      });\n    }\n\n    // Validate email format if provided\n    if (\n      req.body.email &&\n      req.body.email.trim() &&\n      !/\\S+@\\S+\\.\\S+/.test(req.body.email.trim())\n    ) {\n      return res.status(400).json({\n        error: \"Validation failed\",\n        message: \"Please enter a valid email address\",\n        errors: { email: \"Please enter a valid email address\" },\n        success: false,\n      });\n    }\n\n    // Validate opening balance if provided\n    if (req.body.openingBalance && isNaN(parseFloat(req.body.openingBalance))) {\n      return res.status(400).json({\n        error: \"Validation failed\",\n        message: \"Opening balance must be a valid number\",\n        errors: { openingBalance: \"Opening balance must be a valid number\" },\n        success: false,\n      });\n    }\n\n    const customerData = {\n      name: req.body.name.trim(),\n      email: req.body.email?.trim() || null,\n      phone: req.body.phone?.trim() || null,\n      address: req.body.address?.trim() || null,\n      openingBalance: req.body.openingBalance || 0,\n      isActive: true,\n    };\n\n    const result = await storage.createCustomer(customerData);\n\n    // Log the customer creation\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"CREATE\",\n        \"customers\",\n        {\n          customerName: result.name,\n          customerId: result.id,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add customer creation notification\n    addNotification({\n      type: \"system\",\n      title: \"Customer Created\",\n      description: `New customer \"${result.name}\" has been added`,\n      priority: \"medium\",\n      actionUrl: \"/customers\",\n    });\n\n    console.log(\"‚úÖ Customer created successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating customer:\", error);\n    res.status(400).json({\n      error: \"Failed to create customer\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.put(\"/customers/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const customerId = parseInt(req.params.id);\n    console.log(\"üíæ Updating customer:\", customerId);\n\n    // Validate required fields\n    if (!req.body.name || req.body.name.trim().length < 2) {\n      return res.status(400).json({\n        error: \"Validation failed\",\n        message: \"Customer name must be at least 2 characters long\",\n        errors: { name: \"Customer name must be at least 2 characters long\" },\n        success: false,\n      });\n    }\n\n    const result = await storage.updateCustomer(customerId, req.body);\n\n    // Log the customer update\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"UPDATE\",\n        \"customers\",\n        {\n          customerId,\n          updates: req.body,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add customer update notification\n    addNotification({\n      type: \"system\",\n      title: \"Customer Updated\",\n      description: `Customer \"${result.name}\" has been updated`,\n      priority: \"medium\",\n      actionUrl: \"/customers\",\n    });\n\n    console.log(\"‚úÖ Customer updated successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error updating customer:\", error);\n    res.status(400).json({\n      error: \"Failed to update customer\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.delete(\"/customers/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const customerId = parseInt(req.params.id);\n    console.log(\"üóëÔ∏è Deleting customer:\", customerId);\n\n    // Get customer info before deletion for logging\n    const customer = await storage.getCustomerById(customerId);\n\n    await storage.deleteCustomer(customerId);\n\n    // Log the customer deletion\n    if (req.session?.user && customer) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"DELETE\",\n        \"customers\",\n        {\n          deletedCustomerId: customerId,\n          customerName: customer.name,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add customer deletion notification\n    addNotification({\n      type: \"system\",\n      title: \"Customer Deleted\",\n      description: `Customer has been removed from the system`,\n      priority: \"medium\",\n      actionUrl: \"/customers\",\n    });\n\n    console.log(\"‚úÖ Customer deleted successfully\");\n    res.json({ success: true, message: \"Customer deleted successfully\" });\n  } catch (error: any) {\n    console.error(\"‚ùå Error deleting customer:\", error);\n    res.status(400).json({\n      error: \"Failed to delete customer\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Party Management Routes\nrouter.get(\"/parties\", async (req, res) => {\n  try {\n    console.log(\"üè¢ Fetching parties...\");\n    const result = await storage.getParties();\n    console.log(`‚úÖ Found ${result.length} parties`);\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching parties:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch parties\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/parties\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating party:\", req.body.name);\n\n    // Validate required fields\n    if (!req.body.name || req.body.name.trim().length < 2) {\n      return res.status(400).json({\n        error: \"Validation failed\",\n        message: \"Party name must be at least 2 characters long\",\n        errors: { name: \"Party name must be at least 2 characters long\" },\n        success: false,\n      });\n    }\n\n    if (!req.body.type || req.body.type.trim().length === 0) {\n      return res.status(400).json({\n        error: \"Validation failed\",\n        message: \"Party type is required\",\n        errors: { type: \"Party type is required\" },\n        success: false,\n      });\n    }\n\n    // Validate email format if provided\n    if (\n      req.body.email &&\n      req.body.email.trim() &&\n      !/\\S+@\\S+\\.\\S+/.test(req.body.email.trim())\n    ) {\n      return res.status(400).json({\n        error: \"Validation failed\",\n        message: \"Please enter a valid email address\",\n        errors: { email: \"Please enter a valid email address\" },\n        success: false,\n      });\n    }\n\n    const partyData = {\n      name: req.body.name.trim(),\n      type: req.body.type.trim(),\n      contactPerson: req.body.contactPerson?.trim() || null,\n      email: req.body.email?.trim() || null,\n      phone: req.body.phone?.trim() || null,\n      address: req.body.address?.trim() || null,\n      taxId: req.body.taxId?.trim() || null,\n      notes: req.body.notes?.trim() || null,\n      openingBalance: req.body.openingBalance || \"0\",\n      isActive: true,\n    };\n\n    const result = await storage.createParty(partyData);\n\n    // Log the party creation\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"CREATE\",\n        \"parties\",\n        {\n          partyName: result.name,\n          partyType: result.type,\n          partyId: result.id,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add party creation notification\n    addNotification({\n      type: \"system\",\n      title: \"Party Created\",\n      description: `New party \"${result.name}\" has been added`,\n      priority: \"medium\",\n      actionUrl: \"/parties\",\n    });\n\n    console.log(\"‚úÖ Party created successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating party:\", error);\n    res.status(400).json({\n      error: \"Failed to create party\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.put(\"/parties/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const partyId = parseInt(req.params.id);\n    console.log(\"üíæ Updating party:\", partyId);\n\n    // Validate required fields\n    if (!req.body.name || req.body.name.trim().length < 2) {\n      return res.status(400).json({\n        error: \"Validation failed\",\n        message: \"Party name must be at least 2 characters long\",\n        errors: { name: \"Party name must be at least 2 characters long\" },\n        success: false,\n      });\n    }\n\n    if (!req.body.type || req.body.type.trim().length === 0) {\n      return res.status(400).json({\n        error: \"Validation failed\",\n        message: \"Party type is required\",\n        errors: { type: \"Party type is required\" },\n        success: false,\n      });\n    }\n\n    const result = await storage.updateParty(partyId, req.body);\n\n    // Log the party update\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"UPDATE\",\n        \"parties\",\n        {\n          partyId,\n          updates: req.body,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add party update notification\n    addNotification({\n      type: \"system\",\n      title: \"Party Updated\",\n      description: `Party \"${result.name}\" has been updated`,\n      priority: \"medium\",\n      actionUrl: \"/parties\",\n    });\n\n    console.log(\"‚úÖ Party updated successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error updating party:\", error);\n    res.status(400).json({\n      error: \"Failed to update party\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.delete(\"/parties/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const partyId = parseInt(req.params.id);\n    console.log(\"üóëÔ∏è Deleting party:\", partyId);\n\n    // Get party info before deletion for logging\n    const party = await storage.getPartyById(partyId);\n\n    await storage.deleteParty(partyId);\n\n    // Log the party deletion\n    if (req.session?.user && party) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"DELETE\",\n        \"parties\",\n        {\n          deletedPartyId: partyId,\n          partyName: party.name,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add party deletion notification\n    addNotification({\n      type: \"system\",\n      title: \"Party Deleted\",\n      description: `Party has been removed from the system`,\n      priority: \"medium\",\n      actionUrl: \"/parties\",\n    });\n\n    console.log(\"‚úÖ Party deleted successfully\");\n    res.json({ success: true, message: \"Party deleted successfully\" });\n  } catch (error: any) {\n    console.error(\"‚ùå Error deleting party:\", error);\n    res.status(400).json({\n      error: \"Failed to delete party\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Sales Returns Management Routes\nrouter.get(\"/sales-returns\", async (req, res) => {\n  try {\n    console.log(\"üîÑ Fetching sales returns...\");\n    const date = req.query.date as string;\n    const result = await storage.getSalesReturns(date);\n    console.log(`‚úÖ Found ${result.length} sales returns`);\n    res.json({ success: true, data: result });\n  } catch (error) {\n    console.error(\"‚ùå Error fetching sales returns:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch sales returns\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/sales-returns\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating sales return entry:\", req.body);\n\n    // Validate required fields\n    if (!req.body.productId || !req.body.quantity || !req.body.ratePerUnit) {\n      return res.status(400).json({\n        error: \"Validation failed\",\n        message: \"Product, quantity, and rate per unit are required\",\n        success: false,\n      });\n    }\n\n    const result = await storage.createSalesReturn({\n      ...req.body,\n      createdBy: req.session?.user?.id || \"system\",\n    });\n\n    // Log the sales return creation\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"CREATE\",\n        \"sales_returns\",\n        {\n          productName: req.body.productName,\n          quantity: req.body.quantity,\n          amount: result.amount,\n          returnDate: result.returnDate,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add sales return notification\n    addNotification({\n      type: \"order\",\n      title: \"Sales Return\",\n      description: `${req.body.productName} - ${req.body.quantity} ${req.body.unitName} returned (Loss: ${result.amount})`,\n      priority: \"high\",\n      actionUrl: \"/sales-returns\",\n    });\n\n    console.log(\"‚úÖ Sales return entry created successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating sales return entry:\", error);\n    res.status(400).json({\n      error: \"Failed to create sales return entry\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.put(\"/sales-returns/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const salesReturnId = parseInt(req.params.id);\n    console.log(\"üíæ Updating sales return:\", salesReturnId);\n\n    const result = await storage.updateSalesReturn(salesReturnId, req.body);\n\n    // Log the sales return update\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"UPDATE\",\n        \"sales_returns\",\n        {\n          salesReturnId,\n          updates: req.body,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    console.log(\"‚úÖ Sales return updated successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error updating sales return:\", error);\n    res.status(400).json({\n      error: \"Failed to update sales return\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.delete(\"/sales-returns/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const salesReturnId = parseInt(req.params.id);\n    console.log(\"üóëÔ∏è Deleting sales return:\", salesReturnId);\n\n    await storage.deleteSalesReturn(salesReturnId);\n\n    // Log the sales return deletion\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"DELETE\",\n        \"sales_returns\",\n        { salesReturnId },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    console.log(\"‚úÖ Sales return deleted successfully\");\n    res.json({\n      success: true,\n      message: \"Sales return deleted successfully\",\n    });\n  } catch (error: any) {\n    console.error(\"‚ùå Error deleting sales return:\", error);\n    res.status(400).json({\n      error: \"Failed to delete sales return\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.get(\"/sales-returns/summary/:date\", async (req, res) => {\n  try {\n    const date = req.params.date;\n    console.log(`üìä Fetching daily sales return summary for ${date}...`);\n\n    const result = await storage.getDailySalesReturnSummary(date);\n    console.log(\"‚úÖ Daily sales return summary fetched successfully\");\n    res.json({ success: true, data: result });\n  } catch (error) {\n    console.error(\"‚ùå Error fetching daily sales return summary:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch daily sales return summary\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/sales-returns/close-day\", isAuthenticated, async (req, res) => {\n  try {\n    const { date } = req.body;\n    const closedBy = req.session?.user?.id || \"system\";\n\n    console.log(`üîí Closing sales return day for ${date}...`);\n\n    const result = await storage.closeDaySalesReturn(date, closedBy);\n\n    // Log the day closure\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"UPDATE\",\n        \"sales_returns\",\n        {\n          action: \"close_day\",\n          date,\n          totalLoss: result.totalLoss,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add sales return notification\n    addNotification({\n      type: \"system\",\n      title: \"Sales Return Day Closed\",\n      description: `Day closed for ${date}. Total loss: ${result.totalLoss}`,\n      priority: \"medium\",\n      actionUrl: \"/sales-returns\",\n    });\n\n    console.log(\"‚úÖ Sales return day closed successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error closing sales return day:\", error);\n    res.status(400).json({\n      error: \"Failed to close sales return day\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/sales-returns/reopen-day\", isAuthenticated, async (req, res) => {\n  try {\n    const { date } = req.body;\n\n    console.log(`üîì Reopening sales return day for ${date}...`);\n\n    const result = await storage.reopenDaySalesReturn(date);\n\n    // Log the day reopening\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"UPDATE\",\n        \"sales_returns\",\n        {\n          action: \"reopen_day\",\n          date,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add sales return notification\n    addNotification({\n      type: \"system\",\n      title: \"Sales Return Day Reopened\",\n      description: `Day reopened for ${date}. New entries can be added.`,\n      priority: \"medium\",\n      actionUrl: \"/sales-returns\",\n    });\n\n    console.log(\"‚úÖ Sales return day reopened successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error reopening sales return day:\", error);\n    res.status(400).json({\n      error: \"Failed to reopen sales return day\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Purchase Returns Management Routes\nrouter.get(\"/purchase-returns\", async (req, res) => {\n  try {\n    console.log(\"üì¶ Fetching purchase returns...\");\n    const date = req.query.date as string;\n    const result = await storage.getPurchaseReturns(date);\n    console.log(`‚úÖ Found ${result.length} purchase returns`);\n    res.json({ success: true, data: result });\n  } catch (error) {\n    console.error(\"‚ùå Error fetching purchase returns:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch purchase returns\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/purchase-returns\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating purchase return entry:\", req.body);\n\n    // Validate required fields\n    if (\n      !req.body.inventoryItemId ||\n      !req.body.quantity ||\n      !req.body.ratePerUnit\n    ) {\n      return res.status(400).json({\n        error: \"Validation failed\",\n        message: \"Inventory item, quantity, and rate per unit are required\",\n        success: false,\n      });\n    }\n\n    const result = await storage.createPurchaseReturn({\n      ...req.body,\n      createdBy: req.session?.user?.id || \"system\",\n    });\n\n    // Log the purchase return creation\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"CREATE\",\n        \"purchase_returns\",\n        {\n          inventoryItemName: req.body.inventoryItemName,\n          quantity: req.body.quantity,\n          amount: result.amount,\n          returnDate: result.returnDate,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    // Add purchase return notification\n    addNotification({\n      type: \"inventory\",\n      title: \"Purchase Return\",\n      description: `${req.body.inventoryItemName} - ${req.body.quantity} ${req.body.unitName} returned (Loss: ${result.amount})`,\n      priority: \"high\",\n      actionUrl: \"/purchase-returns\",\n    });\n\n    console.log(\"‚úÖ Purchase return entry created successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating purchase return entry:\", error);\n    res.status(400).json({\n      error: \"Failed to create purchase return entry\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.put(\"/purchase-returns/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const purchaseReturnId = parseInt(req.params.id);\n    console.log(\"üíæ Updating purchase return:\", purchaseReturnId);\n\n    const result = await storage.updatePurchaseReturn(\n      purchaseReturnId,\n      req.body,\n    );\n\n    // Log the purchase return update\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"UPDATE\",\n        \"purchase_returns\",\n        {\n          purchaseReturnId,\n          updates: req.body,\n        },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    console.log(\"‚úÖ Purchase return updated successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error updating purchase return:\", error);\n    res.status(400).json({\n      error: \"Failed to update purchase return\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.delete(\"/purchase-returns/:id\", isAuthenticated, async (req, res) => {\n  try {\n    const purchaseReturnId = parseInt(req.params.id);\n    console.log(\"üóëÔ∏è Deleting purchase return:\", purchaseReturnId);\n\n    await storage.deletePurchaseReturn(purchaseReturnId);\n\n    // Log the purchase return deletion\n    if (req.session?.user) {\n      await storage.logUserAction(\n        req.session.user.id,\n        \"DELETE\",\n        \"purchase_returns\",\n        { purchaseReturnId },\n        req.ip,\n        req.get(\"User-Agent\"),\n      );\n    }\n\n    console.log(\"‚úÖ Purchase return deleted successfully\");\n    res.json({\n      success: true,\n      message: \"Purchase return deleted successfully\",\n    });\n  } catch (error: any) {\n    console.error(\"‚ùå Error deleting purchase return:\", error);\n    res.status(400).json({\n      error: \"Failed to delete purchase return\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.get(\"/purchase-returns/summary/:date\", async (req, res) => {\n  try {\n    const date = req.params.date;\n    console.log(`üìä Fetching daily purchase return summary for ${date}...`);\n\n    const result = await storage.getDailyPurchaseReturnSummary(date);\n    console.log(\"‚úÖ Daily purchase return summary fetched successfully\");\n    res.json({ success: true, data: result });\n  } catch (error) {\n    console.error(\"‚ùå Error fetching daily purchase return summary:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch daily purchase return summary\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\n  \"/purchase-returns/close-day\",\n  isAuthenticated,\n  async (req, res) => {\n    try {\n      const { date } = req.body;\n      const closedBy = req.session?.user?.id || \"system\";\n\n      console.log(`üîí Closing purchase return day for ${date}...`);\n\n      const result = await storage.closeDayPurchaseReturn(date, closedBy);\n\n      // Log the day closure\n      if (req.session?.user) {\n        await storage.logUserAction(\n          req.session.user.id,\n          \"UPDATE\",\n          \"purchase_returns\",\n          {\n            action: \"close_day\",\n            date,\n            totalLoss: result.totalLoss,\n          },\n          req.ip,\n          req.get(\"User-Agent\"),\n        );\n      }\n\n      // Add day closure notification\n      addNotification({\n        type: \"system\",\n        title: \"Purchase Return Day Closed\",\n        description: `Day closed for ${date}. Total loss: ${result.totalLoss}`,\n        priority: \"medium\",\n        actionUrl: \"/purchase-returns\",\n      });\n\n      console.log(\"‚úÖ Purchase return day closed successfully\");\n      res.json({ success: true, data: result });\n    } catch (error: any) {\n      console.error(\"‚ùå Error closing purchase return day:\", error);\n      res.status(400).json({\n        error: \"Failed to close purchase return day\",\n        message: error.message,\n        success: false,\n      });\n    }\n  },\n);\n\nrouter.post(\n  \"/purchase-returns/reopen-day\",\n  isAuthenticated,\n  async (req, res) => {\n    try {\n      const { date } = req.body;\n\n      console.log(`üîì Reopening purchase return day for ${date}...`);\n\n      const result = await storage.reopenDayPurchaseReturn(date);\n\n      // Log the day reopening\n      if (req.session?.user) {\n        await storage.logUserAction(\n          req.session.user.id,\n          \"UPDATE\",\n          \"purchase_returns\",\n          {\n            action: \"reopen_day\",\n            date,\n          },\n          req.ip,\n          req.get(\"User-Agent\"),\n        );\n      }\n\n      // Add day reopening notification\n      addNotification({\n        type: \"system\",\n        title: \"Purchase Return Day Reopened\",\n        description: `Day reopened for ${date}. New entries can be added.`,\n        priority: \"medium\",\n        actionUrl: \"/purchase-returns\",\n      });\n\n      console.log(\"‚úÖ Purchase return day reopened successfully\");\n      res.json({ success: true, data: result });\n    } catch (error: any) {\n      console.error(\"‚ùå Error reopening purchase return day:\", error);\n      res.status(400).json({\n        error: \"Failed to reopen purchase return day\",\n        message: error.message,\n        success: false,\n      });\n    }\n  },\n);\n\n// Ledger Transaction Routes\nrouter.post(\"/ledger\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Creating ledger transaction:\", req.body);\n    const result = await storage.createLedgerTransaction(req.body);\n\n    // Add ledger transaction notification\n    addNotification({\n      type: \"system\",\n      title: \"Transaction Added\",\n      description: `New transaction recorded in ledger`,\n      priority: \"medium\",\n      actionUrl: req.body.entityType === \"customer\" ? \"/customers\" : \"/parties\",\n    });\n\n    console.log(\"‚úÖ Ledger transaction created successfully\");\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error creating ledger transaction:\", error);\n    res.status(400).json({\n      error: \"Failed to create transaction\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.get(\"/ledger/customer/:id\", async (req, res) => {\n  try {\n    const customerId = parseInt(req.params.id);\n    console.log(\"üìä Fetching customer ledger:\", customerId);\n    const result = await storage.getLedgerTransactions(customerId, \"customer\");\n    console.log(`‚úÖ Found ${result.length} transactions for customer`);\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching customer ledger:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch customer ledger\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.get(\"/ledger/party/:id\", async (req, res) => {\n  try {\n    const partyId = parseInt(req.params.id);\n    console.log(\"üìä Fetching party ledger:\", partyId);\n    const result = await storage.getLedgerTransactions(partyId, \"party\");\n    console.log(`‚úÖ Found ${result.length} transactions for party`);\n    res.json(result);\n  } catch (error) {\n    console.error(\"‚ùå Error fetching party ledger:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch party ledger\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Role Module Management Routes\nrouter.get(\"/admin/role-modules\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üîê Fetching role modules...\");\n    const currentUser = req.session?.user;\n\n    // Check admin privileges\n    if (!currentUser || (currentUser.role !== \"super_admin\" && currentUser.role !== \"admin\")) {\n      return res.status(403).json({\n        error: \"Access denied\",\n        message: \"You do not have permission to access role modules\",\n        success: false,\n      });\n    }\n\n    const modules = await db.select().from(roleModules).orderBy(roleModules.role, roleModules.moduleId);\n    console.log(`‚úÖ Found ${modules.length} role-module assignments`);\n    res.json({ success: true, data: modules });\n  } catch (error) {\n    console.error(\"‚ùå Error fetching role modules:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch role modules\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.get(\"/admin/role-modules/:role\", isAuthenticated, async (req, res) => {\n  try {\n    const { role } = req.params;\n    console.log(`üîê Fetching modules for role: ${role}`);\n    const currentUser = req.session?.user;\n\n    // Check admin privileges\n    if (!currentUser || (currentUser.role !== \"super_admin\" && currentUser.role !== \"admin\")) {\n      return res.status(403).json({\n        error: \"Access denied\",\n        message: \"You do not have permission to access role modules\",\n        success: false,\n      });\n    }\n\n    const modules = await db\n      .select()\n      .from(roleModules)\n      .where(eq(roleModules.role, role));\n\n    console.log(`‚úÖ Found ${modules.length} modules for role ${role}`);\n    res.json({ success: true, data: modules });\n  } catch (error) {\n    console.error(\"‚ùå Error fetching role modules:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch role modules\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.post(\"/admin/role-modules\", isAuthenticated, async (req, res) => {\n  try {\n    let { role, moduleIds } = req.body;\n    console.log(`üíæ Updating modules for role: ${role}`, moduleIds);\n    const currentUser = req.session?.user;\n\n    // Check admin privileges\n    if (!currentUser || (currentUser.role !== \"super_admin\" && currentUser.role !== \"admin\")) {\n      return res.status(403).json({\n        error: \"Access denied\",\n        message: \"You do not have permission to modify role modules\",\n        success: false,\n      });\n    }\n\n    // Ensure moduleIds is always an array\n    if (!moduleIds) {\n      moduleIds = [];\n    } else if (typeof moduleIds === 'object' && !Array.isArray(moduleIds)) {\n      // Convert object with numeric keys to array\n      moduleIds = Object.values(moduleIds).filter(id => typeof id === 'string' && id.length > 0);\n      console.log('Converted moduleIds object to array:', moduleIds);\n    } else if (typeof moduleIds === 'string') {\n      // Handle single string value\n      moduleIds = [moduleIds];\n    }\n\n    // Validate inputs\n    if (!role || typeof role !== 'string' || role.trim().length === 0) {\n      console.error('Invalid role:', { role, type: typeof role });\n      return res.status(400).json({\n        error: \"Invalid request\",\n        message: \"Valid role is required\",\n        success: false,\n      });\n    }\n\n    if (!Array.isArray(moduleIds)) {\n      console.error('Invalid moduleIds after processing:', { moduleIds, type: typeof moduleIds });\n      return res.status(400).json({\n        error: \"Invalid request\",\n        message: \"moduleIds must be an array\",\n        success: false,\n      });\n    }\n\n    // Filter out any invalid module IDs\n    moduleIds = moduleIds.filter(id => id && typeof id === 'string' && id.trim().length > 0);\n    console.log(`Processing ${moduleIds.length} valid module IDs for role: ${role}`);\n\n    // Transaction to update role modules\n    const result = await db.transaction(async (tx) => {\n      // Delete existing modules for this specific role only\n      await tx.delete(roleModules).where(eq(roleModules.role, role));\n\n      // Insert new modules for this role\n      if (moduleIds.length > 0) {\n        const moduleEntries = moduleIds.map((moduleId) => ({\n          role,\n          moduleId,\n          granted: true,\n        }));\n\n        await tx.insert(roleModules).values(moduleEntries);\n      }\n\n      // Return the updated modules for this role\n      return await tx\n        .select()\n        .from(roleModules)\n        .where(eq(roleModules.role, role));\n    });\n\n    // Invalidate user modules cache for all users with this role\n    await queryClient.invalidateQueries({ \n      queryKey: [\"user\", \"modules\"] \n    });\n\n    await queryClient.invalidateQueries({ \n      queryKey: [\"admin\", \"role-modules\", role] \n    });\n\n    // Log the role module update\n    await storage.logUserAction(\n      currentUser.id,\n      \"UPDATE\",\n      \"role_modules\",\n      {\n        role,\n        moduleIds,\n        moduleCount: moduleIds.length,\n      },\n      req.ip,\n      req.get(\"User-Agent\"),\n    );\n\n    console.log(`‚úÖ Updated modules for role ${role}: ${moduleIds.length} modules`);\n    res.json({\n      success: true,\n      message: `Role modules updated successfully for ${role}`,\n      data: { role, moduleIds, modules: result },\n    });\n  } catch (error) {\n    console.error(\"‚ùå Error updating role modules:\", error);\n    res.status(500).json({\n      error: \"Failed to update role modules\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\nrouter.get(\"/user/modules\", isAuthenticated, async (req, res) => {\n  try {\n    const currentUser = req.session?.user;\n    if (!currentUser) {\n      return res.status(401).json({\n        error: \"Authentication required\",\n        success: false,\n      });\n    }\n\n    console.log(`üîê Fetching modules for user: ${currentUser.email} (${currentUser.role})`);\n\n    // Super admin gets all modules\n    if (currentUser.role === \"super_admin\") {\n      const { SYSTEM_MODULES } = await import(\"../shared/modules\");\n      const allModuleIds = SYSTEM_MODULES.map(m => m.id);\n      console.log(`‚úÖ Super admin granted all ${allModuleIds.length} modules`);\n      return res.json({\n        success: true,\n        data: { moduleIds: allModuleIds, userRole: currentUser.role },\n      });\n    }\n\n    // Get role modules\n    const userRoleModules = await db\n      .select()\n      .from(roleModules)\n      .where(and(\n        eq(roleModules.role, currentUser.role),\n        eq(roleModules.granted, true)\n      ));\n\n    // Get user-specific overrides\n    const userOverrides = await db\n      .select()\n      .from(userModuleOverrides)\n      .where(eq(userModuleOverrides.userId, currentUser.id));\n\n    // Combine role modules with user overrides\n    const moduleIds = new Set(userRoleModules.map(rm => rm.moduleId));\n\n    // Apply user overrides\n    userOverrides.forEach(override => {\n      if (override.granted) {\n        moduleIds.add(override.moduleId);\n      } else {\n        moduleIds.delete(override.moduleId);\n      }\n    });\n\n    const finalModuleIds = Array.from(moduleIds);\n    console.log(`‚úÖ User granted ${finalModuleIds.length} modules`);\n\n    res.json({\n      success: true,\n      data: { \n        moduleIds: finalModuleIds, \n        userRole: currentUser.role,\n        roleModules: userRoleModules.length,\n        overrides: userOverrides.length \n      },\n    });\n  } catch (error) {\n    console.error(\"‚ùå Error fetching user modules:\", error);\n    res.status(500).json({\n      error: \"Failed to fetch user modules\",\n      message: error.message,\n      success: false,\n    });\n  }\n});\n\n// Printed Labels API routes\nrouter.post(\"/api/printed-labels\", isAuthenticated, async (req, res) => {\n  try {\n    console.log(\"üíæ Saving print record:\", req.body);\n    const validated = insertPrintedLabelSchema.parse(req.body);\n    const [result] = await db.insert(printedLabels).values(validated).returning();\n\n    console.log(\"‚úÖ Print record saved successfully:\", result.id);\n    res.json({ success: true, data: result });\n  } catch (error: any) {\n    console.error(\"‚ùå Error saving print record:\", error);\n    res.status(400).json({ success: false, error: error.message });\n  }\n});\n\nrouter.get(\"/api/printed-labels\", isAuthenticated, async (req, res) => {\n  try {\n    const all = await db.select().from(printedLabels).orderBy(desc(printedLabels.createdAt));\n    res.json({ success: true, data: all });\n  } catch (error: any) {\n    res.status(500).json({ success: false, error: error.message });\n  }\n});\n\nrouter.get(\"/api/printed-labels/:productId\", isAuthenticated, async (req, res) => {\n  try {\n    const productId = parseInt(req.params.productId);\n    const records = await db.select().from(printedLabels).where(eq(printedLabels.productId, productId));\n    res.json({ success: true, data: records });\n  } catch (error: any) {\n    res.status(500).json({ success: false, error: error.message });\n  }\n});\n\n// API error handling middleware\nrouter.use((error: any, req: any, res: any, next: any) => {\n  console.error(\"üö® API Error:\", error);\n\n  // Ensure we always return JSON for API routes\n  if (req.originalUrl && req.originalUrl.startsWith(\"/api/\")) {\n    // Log the error to audit logs if possible\n    if (req.session?.user) {\n      storage\n        .logUserAction(\n          req.session.user.id,\n          \"ERROR\",\n          \"system\",\n          { error: error.message, stack: error.stack, path: req.originalUrl },\n          req.ip,\n          req.get(\"User-Agent\"),\n        )\n        .catch(console.error);\n    }\n\n    // Add system error notification\n    addNotification({\n      type: \"system\",\n      title: \"System Error\",\n      description: `An error occurred: ${error.message || \"Unknown error\"}`,\n      priority: \"critical\",\n    });\n\n    // Handle different types of errors\n    if (error.name === \"ValidationError\") {\n      return res.status(400).json({\n        error: \"Validation error\",\n        message: error.message,\n        success: false,\n      });\n    }\n\n    if (error.name === \"MulterError\") {\n      return res.status(400).json({\n        error: \"File upload error\",\n        message: error.message,\n        success: false,\n      });\n    }\n\n    return res.status(500).json({\n      error: \"Internal server error\",\n      message: error.message || \"An unexpected error occurred\",\n      success: false,\n    });\n  }\n\n  next(error);\n});\n\nexport default router;","path":null,"size_bytes":173396,"size_tokens":null},"client/src/components/mobile-install-banner.tsx":{"content":"\nimport React, { useState, useEffect } from 'react';\nimport { usePWAInstall } from '@/hooks/usePWAInstall';\nimport { Button } from '@/components/ui/button';\nimport { Card } from '@/components/ui/card';\nimport { X, Download, Smartphone } from 'lucide-react';\n\nexport function MobileInstallBanner() {\n  const { isInstallable, isInstalled, installApp, canPromptInstall } = usePWAInstall();\n  const [isDismissed, setIsDismissed] = useState(false);\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    // Check if user is on mobile\n    const checkMobile = () => {\n      const userAgent = navigator.userAgent.toLowerCase();\n      const mobileKeywords = ['mobile', 'android', 'iphone', 'ipad', 'ipod', 'blackberry', 'windows phone'];\n      return mobileKeywords.some(keyword => userAgent.includes(keyword));\n    };\n\n    setIsMobile(checkMobile());\n\n    // Check if banner was previously dismissed\n    const dismissed = localStorage.getItem('pwa-banner-dismissed');\n    if (dismissed) {\n      const dismissTime = parseInt(dismissed);\n      const daysPassed = (Date.now() - dismissTime) / (1000 * 60 * 60 * 24);\n      // Show banner again after 7 days\n      if (daysPassed < 7) {\n        setIsDismissed(true);\n      }\n    }\n  }, []);\n\n  const handleDismiss = () => {\n    setIsDismissed(true);\n    localStorage.setItem('pwa-banner-dismissed', Date.now().toString());\n  };\n\n  const handleInstall = async () => {\n    if (canPromptInstall) {\n      const success = await installApp();\n      if (success) {\n        setIsDismissed(true);\n      }\n    }\n  };\n\n  // Don't show if not mobile, already installed, or dismissed\n  if (!isMobile || isInstalled || isDismissed || !isInstallable) {\n    return null;\n  }\n\n  return (\n    <Card className=\"fixed bottom-4 left-4 right-4 z-50 border-primary/20 bg-gradient-to-r from-primary/5 to-primary/10\">\n      <div className=\"flex items-center gap-3 p-4\">\n        <div className=\"flex-shrink-0\">\n          <div className=\"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center\">\n            <Smartphone className=\"h-5 w-5 text-primary\" />\n          </div>\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <h3 className=\"font-semibold text-sm\">Install BakerSoft</h3>\n          <p className=\"text-xs text-muted-foreground\">\n            Get the full app experience with offline access\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {canPromptInstall && (\n            <Button size=\"sm\" onClick={handleInstall} className=\"text-xs px-3\">\n              <Download className=\"h-3 w-3 mr-1\" />\n              Install\n            </Button>\n          )}\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleDismiss}\n            className=\"text-muted-foreground p-1 h-8 w-8\"\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2941,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"// components/ui/dropdown-menu.tsx\nimport * as React from \"react\";\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\";\nimport { Check, ChevronRight, Circle } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst DropdownMenu = DropdownMenuPrimitive.Root;\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger;\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group;\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal;\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub;\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup;\n\n// Sub Trigger (nested menus)\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean;\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-all duration-150\",\n      \"hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground\",\n      \"data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      \"gap-2 [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className,\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4 text-muted-foreground\" />\n  </DropdownMenuPrimitive.SubTrigger>\n));\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName;\n\n// Sub Content\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-lg border bg-popover p-1 text-popover-foreground shadow-lg\",\n      \"data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2\",\n      \"data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n      \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      \"data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95\",\n      \"origin-[--radix-dropdown-menu-sub-content-transform-origin]\",\n\n      className,\n    )}\n    {...props}\n  />\n));\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName;\n\n// Main Content\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 6, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[12rem] overflow-y-auto overflow-x-hidden rounded-lg border bg-popover p-1 text-popover-foreground shadow-xl\",\n        // Animations\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n        \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n        \"data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95\",\n        \"data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2\",\n        \"data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        \"origin-[--radix-dropdown-menu-content-transform-origin]\",\n        // Visual polish\n        \"scrollbar-thin scrollbar-track-transparent scrollbar-thumb-rounded-md scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600\",\n        // Hover glow (optional)\n        \"hover:shadow-2xl transition-shadow duration-200\",\n        className,\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n));\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName;\n\n// Menu Item\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean;\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-pointer select-none items-center gap-2 rounded-md px-2 py-2 text-sm font-medium outline-none transition-all duration-150\",\n      \"hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground\",\n      \"data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      \"dark:hover:bg-orange-100 dark:focus:bg-orange-100\",\n      \"pl-2\",\n      inset && \"pl-8\",\n      className,\n    )}\n    {...props}\n  />\n));\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName;\n\n// Checkbox Item\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-md py-2 pl-8 pr-2 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      \"dark:hover:bg-orange-100 dark:focus:bg-orange-100\",\n      className,\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-4 w-4 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4 text-primary\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n));\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName;\n\n// Radio Item\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-md py-2 pl-8 pr-2 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      \"dark:hover:bg-orange-100 dark:focus:bg-orange-100\",\n      className,\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-4 w-4 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current text-primary\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n));\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName;\n\n// Label\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean;\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-xs font-semibold uppercase tracking-wide text-muted-foreground\",\n      \"dark:text-gray-400\",\n      inset && \"pl-8\",\n      className,\n    )}\n    {...props}\n  />\n));\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName;\n\n// Separator\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"my-1 h-px bg-border \", className)}\n    {...props}\n  />\n));\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName;\n\n// Shortcut (keyboard hints)\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-wider text-muted-foreground tabular-nums\",\n        \"dark:text-gray-400\",\n        className,\n      )}\n      {...props}\n    />\n  );\n};\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\";\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n};\n","path":null,"size_bytes":8879,"size_tokens":null},"client/src/pages/billing.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Plus,\n  FileText,\n  Download,\n  Printer,\n  Eye,\n  Edit,\n  Trash2,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\n\nimport { ProtectedRoute } from \"@/components/protected-route\";\n\nfunction BillingContent() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingBill, setEditingBill] = useState<any>(null);\n  const [selectedCustomer, setSelectedCustomer] = useState(\"\");\n  const [billItems, setBillItems] = useState([\n    { productId: \"\", quantity: 1, unitPrice: 0 },\n  ]);\n  const { toast } = useToast();\n\n  const { data: bills = [], isLoading } = useQuery({\n    queryKey: [\"/api/bills\"],\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  const { data: customers = [] } = useQuery({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: products = [] } = useQuery({\n    queryKey: [\"/api/products\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: any) => apiRequest(\"POST\", \"/api/bills\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/bills\"] });\n      setIsDialogOpen(false);\n      resetForm();\n      toast({ title: \"Success\", description: \"Bill created successfully\" });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to create bill\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/bills/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/bills\"] });\n      toast({ title: \"Success\", description: \"Bill deleted successfully\" });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete bill\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setEditingBill(null);\n    setSelectedCustomer(\"\");\n    setBillItems([{ productId: \"\", quantity: 1, unitPrice: 0 }]);\n  };\n\n  const addBillItem = () => {\n    setBillItems([...billItems, { productId: \"\", quantity: 1, unitPrice: 0 }]);\n  };\n\n  const removeBillItem = (index: number) => {\n    setBillItems(billItems.filter((_, i) => i !== index));\n  };\n\n  const updateBillItem = (index: number, field: string, value: any) => {\n    const updatedItems = [...billItems];\n    updatedItems[index] = { ...updatedItems[index], [field]: value };\n    setBillItems(updatedItems);\n  };\n\n  const calculateTotal = () => {\n    return billItems.reduce(\n      (total, item) => total + item.quantity * item.unitPrice,\n      0,\n    );\n  };\n\n  const handleSave = (e: React.FormEvent) => {\n    e.preventDefault();\n    const formData = new FormData(e.target as HTMLFormElement);\n\n    if (!selectedCustomer) {\n      toast({\n        title: \"Error\",\n        description: \"Customer is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (billItems.length === 0 || billItems.some((item) => !item.productId)) {\n      toast({\n        title: \"Error\",\n        description: \"At least one product is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const data = {\n      customerId: parseInt(selectedCustomer),\n      billDate: new Date(formData.get(\"billDate\") as string),\n      dueDate: new Date(formData.get(\"dueDate\") as string),\n      items: billItems,\n      notes: (formData.get(\"notes\") as string)?.trim() || null,\n      discount: parseFloat(formData.get(\"discount\") as string) || 0,\n      tax: parseFloat(formData.get(\"tax\") as string) || 0,\n    };\n\n    createMutation.mutate(data);\n  };\n\n  const printBill = (bill: any) => {\n    const printWindow = window.open(\"\", \"_blank\");\n    if (printWindow) {\n      printWindow.document.write(generateBillHTML(bill));\n      printWindow.document.close();\n      printWindow.print();\n    }\n  };\n\n  const downloadBill = (bill: any) => {\n    const billHTML = generateBillHTML(bill);\n    const blob = new Blob([billHTML], { type: \"text/html\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `bill_${bill.billNumber}.html`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  const generateBillHTML = (bill: any) => {\n    return `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Bill ${bill.billNumber}</title>\n          <style>\n            body { font-family: Arial, sans-serif; margin: 20px; }\n            .header { text-align: center; margin-bottom: 30px; }\n            .bill-details { margin-bottom: 20px; }\n            .table { width: 100%; border-collapse: collapse; }\n            .table th, .table td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n            .table th { background-color: #f2f2f2; }\n            .total { text-align: right; margin-top: 20px; font-weight: bold; }\n          </style>\n        </head>\n        <body>\n          <div class=\"header\">\n            <h1>Bake Sewa</h1>\n            <h2>Invoice</h2>\n          </div>\n          <div class=\"bill-details\">\n            <p><strong>Bill Number:</strong> ${bill.billNumber}</p>\n            <p><strong>Customer:</strong> ${bill.customerName}</p>\n            <p><strong>Date:</strong> ${new Date(bill.billDate).toLocaleDateString()}</p>\n            <p><strong>Due Date:</strong> ${new Date(bill.dueDate).toLocaleDateString()}</p>\n          </div>\n          <table class=\"table\">\n            <thead>\n              <tr>\n                <th>Product</th>\n                <th>Quantity</th>\n                <th>Unit</th>\n                <th>Unit Price</th>\n                <th>Total</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${\n                bill.items\n                  ?.map(\n                    (item: any) => `\n                <tr>\n                  <td>${item.productName}</td>\n                  <td>${item.quantity}</td>\n                  <td>${item.unit || \"N/A\"}</td>\n                  <td>$${item.unitPrice.toFixed(2)}</td>\n                  <td>$${(item.quantity * item.unitPrice).toFixed(2)}</td>\n                </tr>\n              `,\n                  )\n                  .join(\"\") || \"\"\n              }\n            </tbody>\n          </table>\n          <div class=\"total\">\n            <p>Subtotal: $${(bill.totalAmount - bill.tax + bill.discount).toFixed(2)}</p>\n            <p>Discount: $${bill.discount.toFixed(2)}</p>\n            <p>Tax: $${bill.tax.toFixed(2)}</p>\n            <p><strong>Total: $${bill.totalAmount.toFixed(2)}</strong></p>\n          </div>\n          ${bill.notes ? `<div style=\"margin-top: 20px;\"><strong>Notes:</strong> ${bill.notes}</div>` : \"\"}\n        </body>\n      </html>\n    `;\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<\n      string,\n      \"default\" | \"secondary\" | \"destructive\" | \"outline\"\n    > = {\n      paid: \"default\",\n      pending: \"secondary\",\n      overdue: \"destructive\",\n      cancelled: \"outline\",\n    };\n    return variants[status] || \"outline\";\n  };\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600\">Create and manage customer bills</p>\n        </div>\n        <Dialog\n          open={isDialogOpen}\n          onOpenChange={(open) => {\n            setIsDialogOpen(open);\n            if (!open) resetForm();\n          }}\n        >\n          <DialogTrigger asChild>\n            <Button className=\"w-full sm:w-auto\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Create Bill\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Create New Bill</DialogTitle>\n              <DialogDescription>Enter bill details below</DialogDescription>\n            </DialogHeader>\n            <form onSubmit={handleSave} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Select\n                    value={selectedCustomer}\n                    onValueChange={setSelectedCustomer}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select Customer\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {customers.map((customer: any) => (\n                        <SelectItem\n                          key={customer.id}\n                          value={customer.id.toString()}\n                        >\n                          {customer.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <Input\n                  name=\"billDate\"\n                  type=\"date\"\n                  defaultValue={new Date().toISOString().split(\"T\")[0]}\n                  required\n                />\n              </div>\n              <Input\n                name=\"dueDate\"\n                type=\"date\"\n                placeholder=\"Due Date\"\n                required\n              />\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Bill Items</label>\n                {billItems.map((item, index) => (\n                  <div key={index} className=\"flex gap-2 items-center\">\n                    <Select\n                      value={item.productId}\n                      onValueChange={(value) => {\n                        updateBillItem(index, \"productId\", value);\n                        const product = products.find(\n                          (p: any) => p.id.toString() === value,\n                        );\n                        if (product) {\n                          updateBillItem(index, \"unitPrice\", product.price);\n                        }\n                      }}\n                    >\n                      <SelectTrigger className=\"flex-1\">\n                        <SelectValue placeholder=\"Select Product\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {products.map((product: any) => (\n                          <SelectItem\n                            key={product.id}\n                            value={product.id.toString()}\n                          >\n                            {product.name} - Rs. {product.price}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <Input\n                      type=\"number\"\n                      placeholder=\"Qty\"\n                      value={item.quantity}\n                      onChange={(e) =>\n                        updateBillItem(\n                          index,\n                          \"quantity\",\n                          parseInt(e.target.value) || 1,\n                        )\n                      }\n                      className=\"w-20\"\n                    />\n                    <div className=\"text-sm text-gray-600 w-16 flex items-center\">\n                      {(() => {\n                        const product = products.find(\n                          (p: any) => p.id.toString() === item.productId,\n                        );\n                        return (\n                          product?.unitAbbreviation || product?.unit || \"N/A\"\n                        );\n                      })()}\n                    </div>\n                    <Input\n                      type=\"number\"\n                      step=\"0.01\"\n                      placeholder=\"Price\"\n                      value={item.unitPrice}\n                      onChange={(e) =>\n                        updateBillItem(\n                          index,\n                          \"unitPrice\",\n                          parseFloat(e.target.value) || 0,\n                        )\n                      }\n                      className=\"w-24\"\n                    />\n                    {billItems.length > 1 && (\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => removeBillItem(index)}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    )}\n                  </div>\n                ))}\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={addBillItem}\n                  className=\"w-full\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Item\n                </Button>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <Input\n                  name=\"discount\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  placeholder=\"Discount ($)\"\n                  defaultValue=\"0\"\n                />\n                <Input\n                  name=\"tax\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  placeholder=\"Tax ($)\"\n                  defaultValue=\"0\"\n                />\n              </div>\n\n              <Textarea name=\"notes\" placeholder=\"Notes (optional)\" rows={3} />\n\n              <div className=\"text-right\">\n                <p className=\"text-lg font-semibold\">\n                  Total: ${calculateTotal().toFixed(2)}\n                </p>\n              </div>\n\n              <div className=\"flex justify-end space-x-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                >\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={createMutation.isPending}>\n                  Create Bill\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Bills</CardTitle>\n          <CardDescription>Manage customer bills and invoices</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Bill Number</TableHead>\n                    <TableHead>Customer</TableHead>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Due Date</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {bills.map((bill: any) => (\n                    <TableRow key={bill.id}>\n                      <TableCell className=\"font-medium\">\n                        {bill.billNumber}\n                      </TableCell>\n                      <TableCell>{bill.customerName}</TableCell>\n                      <TableCell>\n                        {new Date(bill.billDate).toLocaleDateString()}\n                      </TableCell>\n                      <TableCell>\n                        {new Date(bill.dueDate).toLocaleDateString()}\n                      </TableCell>\n                      <TableCell>${bill.totalAmount.toFixed(2)}</TableCell>\n                      <TableCell>\n                        <Badge variant={getStatusBadge(bill.status)}>\n                          {bill.status.toUpperCase()}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex space-x-1\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => printBill(bill)}\n                            title=\"Print\"\n                          >\n                            <Printer className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => downloadBill(bill)}\n                            title=\"Download\"\n                          >\n                            <Download className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => deleteMutation.mutate(bill.id)}\n                            disabled={deleteMutation.isPending}\n                            title=\"Delete\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              {bills.length === 0 && (\n                <div className=\"text-center py-8\">\n                  <FileText className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold text-muted-foreground mb-2\">\n                    No bills found\n                  </h3>\n                  <p className=\"text-muted-foreground mb-4\">\n                    Start by creating your first bill\n                  </p>\n                  <Button onClick={() => setIsDialogOpen(true)}>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Create Bill\n                  </Button>\n                </div>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default function Billing() {\n  return (\n    <ProtectedRoute resource=\"billing\" action=\"read\">\n      <BillingContent />\n    </ProtectedRoute>\n  );\n}\n","path":null,"size_bytes":19514,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"README.md":{"content":"\n# Mero BakeSoft - Complete Bakery Management System\n\nA comprehensive, modern bakery management system built with React, TypeScript, Node.js, and PostgreSQL. Designed to streamline all aspects of bakery operations from production to sales.\n\n## üç∞ System Overview\n\nMero BakeSoft is a full-featured Enterprise Resource Planning (ERP) system specifically designed for bakery businesses. It provides end-to-end management capabilities including inventory control, production scheduling, sales tracking, customer management, and comprehensive business analytics.\n\n### Key Benefits\n- **Centralized Operations**: Manage all bakery operations from a single platform\n- **Real-time Tracking**: Live inventory levels, production status, and sales metrics\n- **Cost Optimization**: Automated cost calculations and margin analysis\n- **Role-based Access**: Secure multi-user system with granular permissions\n- **Mobile Responsive**: Works seamlessly on desktop, tablet, and mobile devices\n- **Scalable Architecture**: Handles growing business needs with robust database design\n\n## üöÄ Quick Start Guide\n\n### For End Users\n\n#### Default Login Credentials\n\n| Role | Email | Password | Access Level |\n|------|-------|----------|--------------|\n| Super Admin | superadmin@merobakesoft.com | admin123 | Full system access |\n| Admin | admin@merobakesoft.com | admin123 | Administrative features |\n| Manager | manager@merobakesoft.com | manager123 | Management operations |\n| Staff | staff@merobakesoft.com | staff123 | Basic daily operations |\n\n#### First-Time Setup\n1. Access the system using any of the default credentials above\n2. Navigate to **Settings** to configure company information\n3. Set up your product categories in **Category Management**\n4. Configure measuring units in **Measuring Units**\n5. Add your products in the **Products** section\n6. Set up inventory items in **Inventory**\n7. Begin daily operations with **Orders** and **Production**\n\n## üìä Core Modules\n\n### 1. Dashboard & Analytics\n- **Real-time Overview**: Live metrics for sales, orders, production, and inventory\n- **Performance Indicators**: Revenue trends, order volumes, and profit margins\n- **Quick Actions**: Direct access to frequently used functions\n- **Alerts & Notifications**: Low stock warnings, production reminders, new orders\n\n### 2. Product Management\n- **Product Catalog**: Complete product database with categories and pricing\n- **Recipe Management**: Define ingredients and quantities for each product\n- **Cost Calculation**: Automatic cost computation based on ingredient prices\n- **Unit Management**: Flexible unit system with conversion capabilities\n- **Category Organization**: Hierarchical product categorization\n\n### 3. Inventory Control\n- **Stock Tracking**: Real-time inventory levels with min/max thresholds\n- **Ingredient Management**: Track raw materials and supplies\n- **Purchase Orders**: Streamlined supplier ordering process\n- **Stock Adjustments**: Manual stock corrections and auditing\n- **Low Stock Alerts**: Automated notifications for reorder points\n\n### 4. Production Management\n- **Production Scheduling**: Plan daily and weekly production runs\n- **Batch Tracking**: Monitor production batches with quality control\n- **Label Printing**: Generate production labels with batch information\n- **Resource Planning**: Optimize ingredient usage and production capacity\n- **Status Tracking**: Real-time production progress monitoring\n\n### 5. Sales & Orders\n- **Order Processing**: Complete order lifecycle management\n- **Point of Sale**: Quick sales recording with multiple payment methods\n- **Customer Management**: Comprehensive customer database\n- **Invoice Generation**: Professional invoice creation and tracking\n- **Payment Tracking**: Multiple payment method support\n\n### 6. Customer Relationship Management\n- **Customer Database**: Complete customer profiles with contact information\n- **Purchase History**: Track customer buying patterns and preferences\n- **Loyalty Tracking**: Monitor customer value and repeat business\n- **Credit Management**: Track customer balances and payment terms\n\n### 7. Supplier & Party Management\n- **Supplier Database**: Comprehensive vendor information management\n- **Purchase Tracking**: Monitor all supplier transactions\n- **Payment Management**: Track payables and payment schedules\n- **Supplier Performance**: Analyze supplier reliability and pricing\n\n### 8. Financial Management\n- **Transaction Ledgers**: Complete financial transaction tracking\n- **Expense Management**: Categorize and track business expenses\n- **Asset Management**: Track business equipment and assets\n- **Profit & Loss**: Automated financial reporting\n- **Cash Flow**: Monitor money movement and business liquidity\n\n### 9. Staff Management\n- **Employee Database**: Complete staff information and documentation\n- **Attendance Tracking**: Clock in/out with timesheet management\n- **Payroll Management**: Salary calculations and payment tracking\n- **Leave Management**: Handle vacation and sick leave requests\n- **Performance Tracking**: Monitor staff productivity and schedules\n\n### 10. Reports & Analytics\n- **Sales Reports**: Detailed sales analysis and trends\n- **Inventory Reports**: Stock levels and movement analysis\n- **Production Reports**: Efficiency and output metrics\n- **Financial Reports**: Profit, loss, and cash flow statements\n- **Custom Reports**: Flexible reporting with date range filtering\n\n## üë• User Roles & Permissions\n\n### Super Admin\n- **Complete System Access**: All modules and administrative functions\n- **User Management**: Create, modify, and delete user accounts\n- **System Configuration**: Modify system settings and permissions\n- **Audit Access**: View all system logs and security monitoring\n\n### Admin\n- **Operational Management**: Access to all business modules\n- **User Oversight**: Manage staff accounts and basic permissions\n- **Report Generation**: Access to all business reports\n- **Configuration**: Modify business settings and workflows\n\n### Manager\n- **Daily Operations**: Production, sales, and inventory management\n- **Staff Supervision**: View staff schedules and performance\n- **Business Reports**: Access to operational reports\n- **Customer Management**: Handle customer relationships and issues\n\n### Staff\n- **Basic Operations**: Order entry, basic sales, and production tasks\n- **Limited Access**: Restricted to assigned daily responsibilities\n- **Read-only Reports**: View basic operational information\n- **Profile Management**: Update own profile and attendance\n\n## üîß Technical Architecture\n\n### Frontend Technology Stack\n- **React 18**: Modern component-based UI framework\n- **TypeScript**: Type-safe JavaScript with enhanced developer experience\n- **Tailwind CSS**: Utility-first CSS framework for rapid UI development\n- **TanStack Query**: Server state management and caching\n- **Wouter**: Lightweight routing solution\n- **Lucide React**: Beautiful, customizable icons\n- **Recharts**: Responsive chart library for analytics\n\n### Backend Technology Stack\n- **Node.js**: JavaScript runtime for server-side development\n- **Express.js**: Fast, unopinionated web framework\n- **TypeScript**: Type-safe server-side development\n- **Passport.js**: Authentication middleware\n- **Bcrypt**: Password hashing and security\n- **Express Rate Limit**: API rate limiting for security\n\n### Database & ORM\n- **PostgreSQL**: Robust, ACID-compliant relational database\n- **Drizzle ORM**: Type-safe database access with excellent TypeScript support\n- **Drizzle Kit**: Database migration and schema management\n- **Connection Pooling**: Optimized database connection management\n\n### Security Features\n- **Session Management**: Secure session handling with automatic expiration\n- **Role-based Access Control**: Granular permission system\n- **Rate Limiting**: API protection against abuse\n- **Audit Logging**: Comprehensive activity tracking\n- **Password Encryption**: Bcrypt-based password security\n- **Input Validation**: Server-side data validation and sanitization\n\n### Development & Deployment\n- **Replit**: Cloud-based development and deployment platform\n- **Hot Reloading**: Instant development feedback\n- **TypeScript Compilation**: Automated type checking and compilation\n- **Database Migrations**: Version-controlled schema changes\n- **Environment Configuration**: Flexible environment management\n\n## üì± User Interface Features\n\n### Responsive Design\n- **Mobile-First**: Optimized for mobile devices and tablets\n- **Adaptive Layout**: Automatically adjusts to screen size\n- **Touch-Friendly**: Large buttons and intuitive gestures\n- **Cross-Platform**: Works on all modern browsers\n\n### User Experience\n- **Intuitive Navigation**: Clean, organized menu structure\n- **Quick Actions**: Shortcuts for common tasks\n- **Search & Filter**: Advanced search across all modules\n- **Bulk Operations**: Efficient handling of multiple records\n- **Keyboard Shortcuts**: Power-user keyboard navigation\n\n### Customization\n- **Theme Support**: Light and dark mode options\n- **Custom Branding**: Company logo and color customization\n- **Language Support**: Multi-language interface (English/Nepali)\n- **Configurable Dashboard**: Personalized dashboard widgets\n\n## üîç Advanced Features\n\n### Notification System\n- **Real-time Alerts**: Instant notifications for critical events\n- **Email Notifications**: Optional email alerts for important updates\n- **Configurable Settings**: Customize notification preferences\n- **Priority Levels**: Different alert levels (Low, Medium, High, Critical)\n\n### Data Management\n- **Import/Export**: Bulk data import and export capabilities\n- **Backup System**: Automated database backups\n- **Data Validation**: Comprehensive input validation\n- **Data Integrity**: Referential integrity and constraint enforcement\n\n### Integration Capabilities\n- **API Access**: RESTful API for third-party integrations\n- **Webhook Support**: Real-time event notifications\n- **Data Sync**: Automated data synchronization\n- **External Systems**: Integration with accounting and POS systems\n\n### Business Intelligence\n- **Trend Analysis**: Identify patterns in sales and production\n- **Forecasting**: Predict future demand and inventory needs\n- **Performance Metrics**: Key performance indicators (KPIs)\n- **Custom Dashboards**: Personalized analytics views\n\n## üõ†Ô∏è Technical Administration\n\n### System Requirements\n- **Server**: Node.js 18+ with 2GB+ RAM\n- **Database**: PostgreSQL 13+ with 10GB+ storage\n- **Browser**: Modern browser with JavaScript enabled\n- **Network**: Stable internet connection for cloud deployment\n\n### Installation & Setup\n```bash\n# Clone repository\ngit clone <repository-url>\n\n# Install dependencies\nnpm install\n\n# Setup database\nnpm run db:migrate\n\n# Start development server\nnpm run dev\n```\n\n### Configuration Management\n- **Environment Variables**: Secure configuration management\n- **Database Settings**: Connection pooling and optimization\n- **Security Settings**: Rate limiting and session configuration\n- **Feature Flags**: Enable/disable system features\n\n### Database Management\n- **Schema Migrations**: Version-controlled database changes\n- **Data Seeding**: Initial data population\n- **Backup Procedures**: Automated and manual backup options\n- **Performance Monitoring**: Query optimization and indexing\n\n### Security Administration\n- **User Access Control**: Manage user permissions and roles\n- **Audit Logging**: Monitor all system activities\n- **Security Monitoring**: Track failed login attempts and suspicious activity\n- **Data Protection**: Encryption and secure data handling\n\n### Performance Optimization\n- **Query Optimization**: Database query performance tuning\n- **Caching Strategy**: Server-side and client-side caching\n- **Asset Optimization**: Image and file compression\n- **CDN Integration**: Content delivery network support\n\n### Monitoring & Maintenance\n- **Health Checks**: System health monitoring\n- **Error Tracking**: Comprehensive error logging\n- **Performance Metrics**: System performance monitoring\n- **Maintenance Tasks**: Automated cleanup and optimization\n\n## üìû Support & Documentation\n\n### User Support\n- **Email**: support@merobakesoft.com\n- **System Admin**: admin@merobakesoft.com\n- **Documentation**: Comprehensive user guides and tutorials\n- **Training**: Available training sessions for new users\n\n### Technical Support\n- **Bug Reports**: Issue tracking and resolution\n- **Feature Requests**: Enhancement suggestions and prioritization\n- **System Updates**: Regular updates and security patches\n- **Customization**: Custom development and modifications\n\n### Best Practices\n- **Data Backup**: Regular backup procedures and recovery testing\n- **Security Updates**: Keep system and dependencies updated\n- **User Training**: Regular training sessions for staff\n- **Performance Monitoring**: Monitor system performance and optimize\n\n## üîÑ Update & Maintenance\n\n### Regular Updates\n- **Security Patches**: Monthly security updates\n- **Feature Updates**: Quarterly feature releases\n- **Bug Fixes**: Weekly bug fix releases\n- **Database Optimizations**: Ongoing performance improvements\n\n### Backup Strategy\n- **Automated Backups**: Daily automated database backups\n- **Manual Backups**: On-demand backup creation\n- **Recovery Testing**: Regular backup recovery testing\n- **Offsite Storage**: Secure backup storage solutions\n\n## üí° Tips for Optimal Usage\n\n### For Business Owners\n1. **Regular Data Review**: Weekly review of sales and inventory reports\n2. **Staff Training**: Ensure all staff are trained on relevant modules\n3. **Backup Verification**: Regularly verify backup integrity\n4. **Performance Monitoring**: Monitor system performance and user feedback\n\n### For Managers\n1. **Daily Dashboards**: Start each day with dashboard review\n2. **Alert Management**: Set up appropriate notification preferences\n3. **Report Scheduling**: Schedule regular automated reports\n4. **Staff Oversight**: Monitor staff usage and provide guidance\n\n### For Staff\n1. **Keyboard Shortcuts**: Learn keyboard shortcuts for efficiency\n2. **Mobile Usage**: Utilize mobile interface for on-the-go access\n3. **Data Entry**: Maintain data accuracy and completeness\n4. **Feature Exploration**: Explore new features and capabilities\n\n---\n\n**Mero BakeSoft** - Empowering bakery businesses with modern technology for operational excellence and sustainable growth.\n\n*Version: 2.0 | Last Updated: January 2025*\n","path":null,"size_bytes":14410,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1128,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/theme-badge.tsx":{"content":"\nimport { Badge } from \"./badge\";\nimport { cn } from \"@/lib/utils\";\n\ninterface StatusBadgeProps {\n  status: string;\n  className?: string;\n}\n\nexport function StatusBadge({ status, className }: StatusBadgeProps) {\n  const getStatusVariant = (status: string) => {\n    const variants: Record<\n      string,\n      \"default\" | \"secondary\" | \"destructive\" | \"outline\"\n    > = {\n      completed: \"default\",\n      in_progress: \"secondary\",\n      pending: \"outline\",\n      cancelled: \"destructive\",\n      paid: \"default\",\n      overdue: \"destructive\",\n      active: \"default\",\n      inactive: \"outline\",\n    };\n    return variants[status.toLowerCase()] || \"outline\";\n  };\n\n  const getStatusLabel = (status: string) => {\n    const labels: Record<string, string> = {\n      completed: \"Completed\",\n      in_progress: \"In Progress\",\n      pending: \"Pending\",\n      cancelled: \"Cancelled\",\n      paid: \"Paid\",\n      overdue: \"Overdue\",\n      active: \"Active\",\n      inactive: \"Inactive\",\n    };\n    return labels[status.toLowerCase()] || status;\n  };\n\n  return (\n    <Badge \n      variant={getStatusVariant(status)} \n      className={cn(className)}\n    >\n      {getStatusLabel(status)}\n    </Badge>\n  );\n}\n","path":null,"size_bytes":1191,"size_tokens":null},"client/src/components/search-bar.tsx":{"content":"\"use client\";\n\nimport React, { useState } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Search, X } from \"lucide-react\";\n\ninterface SearchBarProps {\n  placeholder?: string;\n  onSearch?: (query: string) => void;\n  className?: string;\n  value?: string;\n  onChange?: (value: string) => void;\n}\n\n// ‚úÖ Named export ‚Äî make sure this matches the import\nexport function SearchBar({\n  placeholder = \"Search...\",\n  onSearch,\n  className = \"\",\n  value,\n  onChange,\n}: SearchBarProps) {\n  const [internalValue, setInternalValue] = useState(value || \"\");\n\n  // Use external value if provided (controlled), otherwise use internal state\n  const currentValue = value !== undefined ? value : internalValue;\n\n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSearch?.(currentValue);\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = e.target.value;\n    if (onChange) {\n      onChange(newValue);\n    } else {\n      setInternalValue(newValue); // only update internal if uncontrolled\n    }\n  };\n\n  const handleClear = () => {\n    if (onChange) {\n      onChange(\"\");\n    } else {\n      setInternalValue(\"\");\n    }\n    onSearch?.(\"\");\n  };\n\n  return (\n    <form onSubmit={handleSearch} className={className}>\n      <div className=\"relative flex items-center\">\n        {/* Search Icon */}\n        <Search className=\"absolute left-3 h-4 w-4 text-gray-400 pointer-events-none\" />\n\n        {/* Input */}\n        <Input\n          type=\"search\"\n          placeholder={placeholder}\n          value={currentValue}\n          onChange={handleChange}\n          className=\"pl-10 pr-10 py-2 w-full\"\n          aria-label={placeholder}\n        />\n\n        {/* Clear Button */}\n        {currentValue && (\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleClear}\n            className=\"absolute right-1 h-8 w-8 p-0 hover:bg-gray-100\"\n            aria-label=\"Clear search\"\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        )}\n      </div>\n    </form>\n  );\n}\n\n// ‚úÖ Default export to fix import issues\nexport default SearchBar;\n","path":null,"size_bytes":2239,"size_tokens":null},"client/src/hooks/useTableSort.ts":{"content":"import { useState, useMemo } from 'react';\n\nexport interface SortConfig {\n  key: string;\n  direction: 'asc' | 'desc';\n}\n\nexport function useTableSort<T>(data: T[], defaultSortKey?: string) {\n  const [sortConfig, setSortConfig] = useState<SortConfig | null>(\n    defaultSortKey ? { key: defaultSortKey, direction: 'asc' } : null\n  );\n\n  const sortedData = useMemo(() => {\n    if (!sortConfig) return data;\n\n    const sorted = [...data].sort((a: any, b: any) => {\n      const aValue = getNestedValue(a, sortConfig.key);\n      const bValue = getNestedValue(b, sortConfig.key);\n\n      // Handle null/undefined values\n      if (aValue == null && bValue == null) return 0;\n      if (aValue == null) return 1;\n      if (bValue == null) return -1;\n\n      // Handle different data types\n      if (typeof aValue === 'string' && typeof bValue === 'string') {\n        return sortConfig.direction === 'asc' \n          ? aValue.localeCompare(bValue)\n          : bValue.localeCompare(aValue);\n      }\n\n      if (typeof aValue === 'number' && typeof bValue === 'number') {\n        return sortConfig.direction === 'asc' \n          ? aValue - bValue\n          : bValue - aValue;\n      }\n\n      // Handle dates\n      if (aValue instanceof Date && bValue instanceof Date) {\n        return sortConfig.direction === 'asc'\n          ? aValue.getTime() - bValue.getTime()\n          : bValue.getTime() - aValue.getTime();\n      }\n\n      // Handle date strings\n      if (isDateString(aValue) && isDateString(bValue)) {\n        const dateA = new Date(aValue);\n        const dateB = new Date(bValue);\n        return sortConfig.direction === 'asc'\n          ? dateA.getTime() - dateB.getTime()\n          : dateB.getTime() - dateA.getTime();\n      }\n\n      // Fallback to string comparison\n      const strA = String(aValue).toLowerCase();\n      const strB = String(bValue).toLowerCase();\n      return sortConfig.direction === 'asc'\n        ? strA.localeCompare(strB)\n        : strB.localeCompare(strA);\n    });\n\n    return sorted;\n  }, [data, sortConfig]);\n\n  const requestSort = (key: string) => {\n    let direction: 'asc' | 'desc' = 'asc';\n    if (sortConfig && sortConfig.key === key && sortConfig.direction === 'asc') {\n      direction = 'desc';\n    }\n    setSortConfig({ key, direction });\n  };\n\n  return { sortedData, sortConfig, requestSort };\n}\n\n// Helper function to get nested object values\nfunction getNestedValue(obj: any, path: string): any {\n  return path.split('.').reduce((current, key) => current?.[key], obj);\n}\n\n// Helper function to check if a string is a valid date\nfunction isDateString(value: any): boolean {\n  if (typeof value !== 'string') return false;\n  const date = new Date(value);\n  return !isNaN(date.getTime());\n}","path":null,"size_bytes":2715,"size_tokens":null},"server/securityMonitor.ts":{"content":"import { storage } from \"./lib/storage\";\nimport { db } from \"./db\";\nimport { loginLogs, auditLogs } from \"../shared/schema\";\nimport { eq, gte, count, desc, sql } from \"drizzle-orm\";\n\nexport interface SecurityAlert {\n  id: string;\n  type: 'BRUTE_FORCE' | 'SUSPICIOUS_LOGIN' | 'ROLE_ESCALATION' | 'BULK_OPERATION' | 'API_ABUSE';\n  severity: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';\n  title: string;\n  description: string;\n  userId: string;\n  userEmail: string;\n  ipAddress: string;\n  timestamp: Date;\n  metadata: any;\n}\n\nexport interface SecurityMetrics {\n  failedLogins24h: number;\n  suspiciousActivities24h: number;\n  activeThreats: SecurityAlert[];\n  riskScore: number;\n  recentAlerts: SecurityAlert[];\n}\n\nclass SecurityMonitorService {\n  private alerts: SecurityAlert[] = [];\n  private monitoringEnabled = true;\n  private alertCallbacks: ((alert: SecurityAlert) => void)[] = [];\n\n  // Configure alert thresholds\n  private readonly config = {\n    BRUTE_FORCE_THRESHOLD: 5, // Failed logins from same IP\n    BRUTE_FORCE_WINDOW: 15 * 60 * 1000, // 15 minutes\n    SUSPICIOUS_LOGIN_THRESHOLD: 3, // Logins from different locations\n    BULK_OPERATION_THRESHOLD: 20, // Operations in short time\n    API_ABUSE_THRESHOLD: 100, // API calls per minute\n    RISK_CALCULATION_WINDOW: 24 * 60 * 60 * 1000, // 24 hours\n  };\n\n  constructor() {\n    // Start monitoring\n    this.startMonitoring();\n  }\n\n  private startMonitoring() {\n    console.log(\"üõ°Ô∏è Security Monitor started\");\n    \n    // Check for threats every minute\n    setInterval(() => {\n      this.checkForThreats();\n    }, 60 * 1000);\n\n    // Clean old alerts every hour\n    setInterval(() => {\n      this.cleanOldAlerts();\n    }, 60 * 60 * 1000);\n  }\n\n  private async checkForThreats() {\n    if (!this.monitoringEnabled) return;\n\n    try {\n      await Promise.all([\n        this.detectBruteForceAttacks(),\n        this.detectSuspiciousLogins(),\n        this.detectBulkOperations(),\n        this.detectAPIAbuse(),\n        this.detectRoleEscalationAttempts(),\n      ]);\n    } catch (error) {\n      console.error(\"Security monitoring error:\", error);\n    }\n  }\n\n  // Detect brute force attacks\n  private async detectBruteForceAttacks() {\n    const threshold = new Date(Date.now() - this.config.BRUTE_FORCE_WINDOW);\n    \n    const suspiciousIPs = await db\n      .select({\n        ipAddress: loginLogs.ipAddress,\n        failedCount: count(),\n      })\n      .from(loginLogs)\n      .where(\n        sql`${loginLogs.status} = 'failed' AND ${loginLogs.loginTime} >= ${threshold.toISOString()}`\n      )\n      .groupBy(loginLogs.ipAddress)\n      .having(sql`COUNT(*) >= ${this.config.BRUTE_FORCE_THRESHOLD}`);\n\n    for (const suspiciousIP of suspiciousIPs) {\n      await this.createAlert({\n        type: 'BRUTE_FORCE',\n        severity: 'HIGH',\n        title: 'Brute Force Attack Detected',\n        description: `${suspiciousIP.failedCount} failed login attempts from IP ${suspiciousIP.ipAddress} in the last 15 minutes`,\n        userId: 'system',\n        userEmail: 'system',\n        ipAddress: suspiciousIP.ipAddress,\n        metadata: {\n          attemptCount: suspiciousIP.failedCount,\n          timeWindow: '15 minutes',\n        },\n      });\n    }\n  }\n\n  // Detect suspicious login patterns\n  private async detectSuspiciousLogins() {\n    const last24Hours = new Date(Date.now() - 24 * 60 * 60 * 1000);\n\n    const suspiciousUsers = await db\n      .select({\n        userId: loginLogs.userId,\n        email: loginLogs.email,\n        locationCount: sql<number>`COUNT(DISTINCT ${loginLogs.location})`,\n        ipCount: sql<number>`COUNT(DISTINCT ${loginLogs.ipAddress})`,\n      })\n      .from(loginLogs)\n      .where(\n        sql`${loginLogs.status} = 'success' AND ${loginLogs.loginTime} >= ${last24Hours.toISOString()}`\n      )\n      .groupBy(loginLogs.userId, loginLogs.email)\n      .having(sql`COUNT(DISTINCT ${loginLogs.location}) >= ${this.config.SUSPICIOUS_LOGIN_THRESHOLD}`);\n\n    for (const suspiciousUser of suspiciousUsers) {\n      await this.createAlert({\n        type: 'SUSPICIOUS_LOGIN',\n        severity: 'MEDIUM',\n        title: 'Suspicious Login Pattern',\n        description: `User ${suspiciousUser.email} logged in from ${suspiciousUser.locationCount} different locations in 24 hours`,\n        userId: suspiciousUser.userId,\n        userEmail: suspiciousUser.email,\n        ipAddress: 'multiple',\n        metadata: {\n          locationCount: suspiciousUser.locationCount,\n          ipCount: suspiciousUser.ipCount,\n        },\n      });\n    }\n  }\n\n  // Detect bulk operations\n  private async detectBulkOperations() {\n    const last10Minutes = new Date(Date.now() - 10 * 60 * 1000);\n\n    const bulkOperators = await db\n      .select({\n        userId: auditLogs.userId,\n        userEmail: auditLogs.userEmail,\n        operationCount: count(),\n      })\n      .from(auditLogs)\n      .where(\n        sql`${auditLogs.timestamp} >= ${last10Minutes.toISOString()} AND ${auditLogs.action} IN ('CREATE', 'UPDATE', 'DELETE')`\n      )\n      .groupBy(auditLogs.userId, auditLogs.userEmail)\n      .having(sql`COUNT(*) >= ${this.config.BULK_OPERATION_THRESHOLD}`);\n\n    for (const operator of bulkOperators) {\n      await this.createAlert({\n        type: 'BULK_OPERATION',\n        severity: 'MEDIUM',\n        title: 'Bulk Operations Detected',\n        description: `User ${operator.userEmail} performed ${operator.operationCount} operations in 10 minutes`,\n        userId: operator.userId,\n        userEmail: operator.userEmail,\n        ipAddress: 'unknown',\n        metadata: {\n          operationCount: operator.operationCount,\n          timeWindow: '10 minutes',\n        },\n      });\n    }\n  }\n\n  // Detect API abuse\n  private async detectAPIAbuse() {\n    const lastMinute = new Date(Date.now() - 60 * 1000);\n\n    const apiAbusers = await db\n      .select({\n        ipAddress: auditLogs.ipAddress,\n        requestCount: count(),\n      })\n      .from(auditLogs)\n      .where(sql`${auditLogs.timestamp} >= ${lastMinute.toISOString()}`)\n      .groupBy(auditLogs.ipAddress)\n      .having(sql`COUNT(*) >= ${this.config.API_ABUSE_THRESHOLD}`);\n\n    for (const abuser of apiAbusers) {\n      await this.createAlert({\n        type: 'API_ABUSE',\n        severity: 'HIGH',\n        title: 'API Abuse Detected',\n        description: `Excessive API requests (${abuser.requestCount}) from IP ${abuser.ipAddress} in 1 minute`,\n        userId: 'system',\n        userEmail: 'system',\n        ipAddress: abuser.ipAddress,\n        metadata: {\n          requestCount: abuser.requestCount,\n          timeWindow: '1 minute',\n        },\n      });\n    }\n  }\n\n  // Detect role escalation attempts\n  private async detectRoleEscalationAttempts() {\n    const last30Minutes = new Date(Date.now() - 30 * 60 * 1000);\n\n    const roleChanges = await db\n      .select()\n      .from(auditLogs)\n      .where(\n        sql`${auditLogs.timestamp} >= ${last30Minutes.toISOString()} AND ${auditLogs.resource} = 'users' AND ${auditLogs.action} = 'UPDATE' AND ${auditLogs.newValues}::text LIKE '%\"role\":%'`\n      )\n      .orderBy(desc(auditLogs.timestamp));\n\n    for (const roleChange of roleChanges) {\n      const oldRole = (roleChange.oldValues as any)?.role;\n      const newRole = (roleChange.newValues as any)?.role;\n      \n      if (oldRole && newRole && this.isRoleEscalation(oldRole, newRole)) {\n        await this.createAlert({\n          type: 'ROLE_ESCALATION',\n          severity: 'CRITICAL',\n          title: 'Unauthorized Role Escalation',\n          description: `User ${roleChange.userEmail} changed user role from ${oldRole} to ${newRole}`,\n          userId: roleChange.userId,\n          userEmail: roleChange.userEmail,\n          ipAddress: roleChange.ipAddress,\n          metadata: {\n            oldRole,\n            newRole,\n            targetUser: roleChange.resourceId,\n          },\n        });\n      }\n    }\n  }\n\n  private isRoleEscalation(oldRole: string, newRole: string): boolean {\n    const roleHierarchy = ['staff', 'supervisor', 'marketer', 'manager', 'admin', 'super_admin'];\n    const oldIndex = roleHierarchy.indexOf(oldRole);\n    const newIndex = roleHierarchy.indexOf(newRole);\n    return newIndex > oldIndex;\n  }\n\n  private async createAlert(alertData: Omit<SecurityAlert, 'id' | 'timestamp'>) {\n    const alert: SecurityAlert = {\n      ...alertData,\n      id: `alert_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      timestamp: new Date(),\n    };\n\n    this.alerts.push(alert);\n\n    // Trigger alert callbacks\n    this.alertCallbacks.forEach(callback => {\n      try {\n        callback(alert);\n      } catch (error) {\n        console.error(\"Alert callback error:\", error);\n      }\n    });\n\n    console.warn(`üö® SECURITY ALERT [${alert.severity}]: ${alert.title}`);\n    console.warn(`   Description: ${alert.description}`);\n    console.warn(`   User: ${alert.userEmail} (${alert.userId})`);\n    console.warn(`   IP: ${alert.ipAddress}`);\n    console.warn(`   Time: ${alert.timestamp.toISOString()}`);\n\n    return alert;\n  }\n\n  private cleanOldAlerts() {\n    const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\n    this.alerts = this.alerts.filter(alert => alert.timestamp > oneDayAgo);\n  }\n\n  public async getSecurityMetrics(): Promise<SecurityMetrics> {\n    const last24Hours = new Date(Date.now() - 24 * 60 * 60 * 1000);\n\n    const [failedLoginsResult, suspiciousActivitiesResult] = await Promise.all([\n      db.select({ count: count() }).from(loginLogs)\n        .where(sql`${loginLogs.status} = 'failed' AND ${loginLogs.loginTime} >= ${last24Hours.toISOString()}`),\n      db.select({ count: count() }).from(auditLogs)\n        .where(sql`${auditLogs.status} = 'failed' AND ${auditLogs.timestamp} >= ${last24Hours.toISOString()}`)\n    ]);\n\n    const failedLogins24h = failedLoginsResult[0]?.count || 0;\n    const suspiciousActivities24h = suspiciousActivitiesResult[0]?.count || 0;\n    const activeThreats = this.alerts.filter(alert => \n      alert.timestamp > new Date(Date.now() - 60 * 60 * 1000) && \n      ['HIGH', 'CRITICAL'].includes(alert.severity)\n    );\n    const recentAlerts = this.alerts\n      .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())\n      .slice(0, 10);\n\n    // Calculate risk score based on various factors\n    const riskScore = this.calculateRiskScore(failedLogins24h, suspiciousActivities24h, activeThreats.length);\n\n    return {\n      failedLogins24h,\n      suspiciousActivities24h,\n      activeThreats,\n      riskScore,\n      recentAlerts,\n    };\n  }\n\n  private calculateRiskScore(failedLogins: number, suspiciousActivities: number, activeThreats: number): number {\n    let score = 0;\n\n    // Failed logins contribute to risk\n    score += Math.min(failedLogins * 2, 30);\n\n    // Suspicious activities contribute to risk\n    score += Math.min(suspiciousActivities * 3, 40);\n\n    // Active threats significantly increase risk\n    score += activeThreats * 10;\n\n    return Math.min(score, 100);\n  }\n\n  public onAlert(callback: (alert: SecurityAlert) => void) {\n    this.alertCallbacks.push(callback);\n  }\n\n  public getActiveAlerts(): SecurityAlert[] {\n    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);\n    return this.alerts.filter(alert => alert.timestamp > oneHourAgo);\n  }\n\n  public getAllAlerts(): SecurityAlert[] {\n    return [...this.alerts];\n  }\n\n  public enableMonitoring() {\n    this.monitoringEnabled = true;\n    console.log(\"üõ°Ô∏è Security monitoring enabled\");\n  }\n\n  public disableMonitoring() {\n    this.monitoringEnabled = false;\n    console.log(\"üõ°Ô∏è Security monitoring disabled\");\n  }\n}\n\nexport const securityMonitor = new SecurityMonitorService();","path":null,"size_bytes":11579,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/pages/admin-users.tsx":{"content":"\nimport AdminUserManagement from \"@/components/admin-user-management\";\nimport { ProtectedPage } from \"@/components/protected-page\";\n\nexport default function AdminUsers() {\n  return (\n    <ProtectedPage resource=\"users\" action=\"read_write\">\n      <AdminUserManagement />\n    </ProtectedPage>\n  );\n}\n","path":null,"size_bytes":298,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/header.tsx":{"content":"// src/components/header.tsx\nimport React, { useState, useEffect } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useLocation, Link } from \"wouter\";\nimport { useCompanyBranding } from \"@/hooks/use-company-branding\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\n\n// UI Components\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\n\n// Icons\nimport {\n  Menu,\n  LogOut,\n  UserCircle,\n  Settings,\n  Calendar,\n  Bell,\n  HelpCircle,\n  ChevronsLeft,\n  ChevronsRight,\n} from \"lucide-react\";\n\n// Sub-components\nimport ProfileEditor from \"./profile-editor\";\nimport NotificationDropdown from \"./notification-dropdown\";\n\ninterface HeaderProps {\n  onMenuClick?: () => void;\n  isCollapsed?: boolean;\n  onToggleCollapse?: () => void;\n}\n\nexport default function Header({\n  onMenuClick,\n  isCollapsed = false,\n  onToggleCollapse,\n}: HeaderProps) {\n  const [location] = useLocation();\n  const { user, logout } = useAuth();\n  const { branding } = useCompanyBranding();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const { toast } = useToast();\n\n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (searchQuery.trim()) {\n      toast({\n        title: \"Search\",\n        description: `Searching for: ${searchQuery}`,\n      });\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      await logout();\n      toast({\n        title: \"Success\",\n        description: \"Logged out successfully\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to logout\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getCurrentDate = () => {\n    return new Date().toLocaleDateString(\"en-US\", {\n      weekday: \"long\",\n      year: \"numeric\",\n      month: \"long\",\n      day: \"numeric\",\n    });\n  };\n\n  // Get Nepali date in Nepali language\n  const [nepaliDate, setNepaliDate] = React.useState<string>(\"\");\n\n  React.useEffect(() => {\n    const loadNepaliDate = async () => {\n      try {\n        // Dynamically import the BS date converter\n        const { convertADtoBS } = await import(\"@/lib/bs-date-converter\");\n        const today = new Date();\n        const bsDate = await convertADtoBS(today);\n\n        if (bsDate && bsDate !== \"-\") {\n          // Convert to Nepali numerals and format\n          const nepaliMonths = [\n            \"‡§¨‡•à‡§∂‡§æ‡§ñ\",\n            \"‡§ú‡•á‡§∑‡•ç‡§†\",\n            \"‡§Ü‡§∑‡§æ‡§¢\",\n            \"‡§∂‡•ç‡§∞‡§æ‡§µ‡§£\",\n            \"‡§≠‡§¶‡•å\",\n            \"‡§Ü‡§∂‡•ç‡§µ‡§ø‡§®\",\n            \"‡§ï‡§æ‡§∞‡•ç‡§§‡§ø‡§ï\",\n            \"‡§Æ‡§Ç‡§∏‡§ø‡§∞\",\n            \"‡§™‡•å‡§∑\",\n            \"‡§Æ‡§æ‡§ò\",\n            \"‡§´‡§æ‡§≤‡•ç‡§ó‡•Å‡§£\",\n            \"‡§ö‡•à‡§§\",\n          ];\n\n          const nepaliWeekdays = [\n            \"‡§Ü‡§á‡§§‡§¨‡§æ‡§∞\",\n            \"‡§∏‡•ã‡§Æ‡§¨‡§æ‡§∞\",\n            \"‡§Æ‡§Ç‡§ó‡§≤‡§¨‡§æ‡§∞\",\n            \"‡§¨‡•Å‡§ß‡§¨‡§æ‡§∞\",\n            \"‡§¨‡§ø‡§π‡§ø‡§¨‡§æ‡§∞\",\n            \"‡§∂‡•Å‡§ï‡•ç‡§∞‡§¨‡§æ‡§∞\",\n            \"‡§∂‡§®‡§ø‡§¨‡§æ‡§∞\",\n          ];\n\n          const nepaliNumerals = [\n            \"‡•¶\",\n            \"‡•ß\",\n            \"‡•®\",\n            \"‡•©\",\n            \"‡•™\",\n            \"‡•´\",\n            \"‡•¨\",\n            \"‡•≠\",\n            \"‡•Æ\",\n            \"‡•Ø\",\n          ];\n\n          // Parse BS date (format: YYYY-MM-DD)\n          const [year, month, day] = bsDate.split(\"-\").map(Number);\n\n          // Convert to Nepali numerals\n          const toNepaliNumeral = (num: number) => {\n            return String(num)\n              .split(\"\")\n              .map((digit) => nepaliNumerals[parseInt(digit)])\n              .join(\"\");\n          };\n\n          const nepaliYear = toNepaliNumeral(year);\n          const nepaliDay = toNepaliNumeral(day);\n          const nepaliMonth = nepaliMonths[month - 1];\n          const weekday = nepaliWeekdays[today.getDay()];\n\n          setNepaliDate(\n            `${nepaliYear} ${nepaliMonth} ${nepaliDay}, ${weekday}`,\n          );\n        }\n      } catch (error) {\n        console.error(\"Error loading Nepali date:\", error);\n        setNepaliDate(\"\");\n      }\n    };\n\n    loadNepaliDate();\n  }, []);\n\n  const year = nepaliDate;\n\n  const getPageTitle = () => {\n    const pathTitles: Record<string, string> = {\n      \"/\": \"Dashboard\",\n      \"/products\": \"Products Management\",\n      \"/inventory\": \"Inventory Management\",\n      \"/stock\": \"Stock & Ingredients\",\n      \"/orders\": \"Orders Management\",\n      \"/production\": \"Production Planning\",\n      \"/parties\": \"Parties Management\",\n      \"/customers\": \"Customer Management\",\n      \"/assets\": \"Assets Management\",\n      \"/expenses\": \"Expenses & Income\",\n      \"/reports\": \"Reports & Analytics\",\n      \"/day-book\": \"Day Book\",\n      \"/transactions\": \"Transactions\",\n      \"/billing\": \"Billing & Subscription\",\n      \"/settings\": \"System Settings\",\n      \"/notifications\": \"Notifications\",\n      \"/admin/users\": \"User Management\",\n      \"/admin/login-logs\": \"Audit Logs\",\n      \"/category-management\": \"Category Management\",\n      \"/sales\": \"Sales Management\",\n      \"/purchases\": \"Purchase Management\",\n      \"/ingredients\": \"Ingredients\",\n      \"/units\": \"Measuring Units\",\n      \"/unit-conversion\": \"Unit Conversions\",\n      \"/staff\": \"Staff Directory\",\n      \"/attendance\": \"Attendance Management\",\n      \"/salary\": \"Salary Management\",\n      \"/leave-requests\": \"Leave Requests\",\n      \"/recipes\": \"Recipe Management\",\n      \"/branches\": \"Branch Management\",\n      \"/label-printing\": \"Label Printing\",\n      \"/purchase-returns\": \"Purchase Returns\",\n      \"/sales-returns\": \"Sales Returns\",\n      \"/security-logs\": \"Security Logs\",\n      \"/system-config\": \"System Configuration\",\n      \"/system-health\": \"System Health\",\n      \"/database\": \"Database Manager\",\n      \"/api-docs\": \"API Documentation\",\n      \"/monitoring\": \"System Monitoring\",\n      \"/performance\": \"Performance Metrics\",\n      \"/expire-products\": \"Expired Products\",\n      \"/landing\": \"Landing Page\",\n      \"/not-found\": \"Page Not Found\",\n      \"/login-logs\": \"Login Logs\",\n    };\n\n    return pathTitles[location] || \"Dashboard\";\n  };\n  const [currentTime, setCurrentTime] = useState(new Date());\n  // Update time every second\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setCurrentTime(new Date());\n    }, 1000);\n    return () => clearInterval(timer);\n  }, []);\n\n  return (\n    <header className=\"bg-white/95 backdrop-blur-md border-b border-gray-200 px-4 py-3.5 shadow-sm flex-shrink-0\">\n      <div className=\"flex items-center justify-between\">\n        {/* Left Section */}\n        <div className=\"flex items-center space-x-4\">\n          {/* Mobile Menu Toggle */}\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onMenuClick}\n            className=\"lg:hidden hover:bg-gray-100 transition-all duration-200 hover:scale-105 text-gray-700\"\n            data-testid=\"button-mobile-menu\"\n          >\n            <Menu className=\"h-5 w-5\" />\n          </Button>\n\n          {/* Desktop Sidebar Collapse/Expand Toggle */}\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onToggleCollapse}\n            className=\"hidden lg:flex hover:bg-gray-100 transition-all duration-200 hover:scale-105 text-gray-700\"\n            aria-label={isCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\n            data-testid=\"button-toggle-sidebar-desktop\"\n          >\n            {isCollapsed ? (\n              <Menu className=\"h-5 w-5\" />\n            ) : (\n              <Menu className=\"h-5 w-5\" />\n            )}\n          </Button>\n\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">\n              {getPageTitle()}\n            </h1>\n          </div>\n        </div>\n\n        {/* Right Section */}\n        <div className=\"flex items-center space-x-2 lg:space-x-4\">\n          {/* Date Display */}\n          <div className=\"hidden lg:block\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"flex items-center gap-2 px-3 py-2 bg-white rounded-lg\">\n                <Calendar className=\"h-4 w-4 font-medium text-gray-900\" />\n                <p className=\"font-medium text-gray-900\">\n                  {format(currentTime, \"MMM dd, yyyy\")}\n                </p>\n              </div>\n            </div>\n            <p className=\"font-medium text-gray-900\">{year}</p>\n          </div>\n\n          {/* Notifications */}\n          <NotificationDropdown />\n\n          {/* Help / Info */}\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" size=\"sm\" className=\"p-2\">\n                <HelpCircle className=\"h-5 w-5 \" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuItem>\n                <span className=\"mr-2\">üìö</span> Support Guide\n              </DropdownMenuItem>\n              <DropdownMenuItem>\n                <span className=\"mr-2\">‚ú®</span> What's New?\n              </DropdownMenuItem>\n              <DropdownMenuItem>\n                <span className=\"mr-2\">‚å®Ô∏è</span> Keyboard Shortcuts\n              </DropdownMenuItem>\n              <DropdownMenuItem>\n                <span className=\"mr-2\">üí¨</span> Give Feedback\n              </DropdownMenuItem>\n              <DropdownMenuItem>\n                <span className=\"mr-2\">üìß</span> Send us a message\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n\n          {/* Enhanced User Profile Dropdown */}\n          {user && (\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button\n                  variant=\"ghost\"\n                  className=\"flex items-center p-2 hover:bg-gray-100 rounded-full transition-all\"\n                >\n                  <div className=\"w-8 h-8  rounded-full flex items-center justify-center\">\n                    {user?.profileImageUrl ? (\n                      <img\n                        src={user.profileImageUrl}\n                        alt=\"Profile\"\n                        className=\"w-6 h-6 rounded-full object-cover\"\n                      />\n                    ) : (\n                      <UserCircle className=\"h-5 w-5 text-primary-foreground\" />\n                    )}\n                  </div>\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent\n                align=\"end\"\n                className=\"w-80 bg-white backdrop-blur-md border border-gray-200/50 shadow-2xl\"\n              >\n                {/* User Info Header */}\n                <div className=\"px-4 py-3 border-b border-gray-100\">\n                  <div className=\"flex items-center space-x-3\">\n                    <div className=\"w-10 h-10 bg-gradient-to-br from-primary to-primary/80 rounded-lg flex items-center justify-center\">\n                      {user?.profileImageUrl ? (\n                        <img\n                          src={user.profileImageUrl}\n                          alt=\"Profile\"\n                          className=\"w-8 h-8 rounded-lg object-cover\"\n                        />\n                      ) : (\n                        <UserCircle className=\"h-6 w-6 text-primary-foreground\" />\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-semibold text-gray-900 truncate\">\n                        {user?.firstName\n                          ? `${user.firstName} ${user.lastName || \"\"}`.trim()\n                          : user?.email || \"User\"}\n                      </p>\n                      <p className=\"text-xs text-gray-500 truncate\">\n                        {user?.email}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"mt-2 flex items-center justify-between\">\n                    <span\n                      className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\n                      ${\n                        user?.role === \"super_admin\"\n                          ? \"bg-purple-100 text-purple-800\"\n                          : user?.role === \"admin\"\n                            ? \"bg-blue-100 text-blue-800\"\n                            : user?.role === \"manager\"\n                              ? \"bg-green-100 text-green-800\"\n                              : \"bg-gray-100 text-gray-800\"\n                      }`}\n                    >\n                      <span className=\"w-1.5 h-1.5 bg-current rounded-full mr-1.5 animate-pulse\"></span>\n                      {user?.role === \"super_admin\"\n                        ? \"Super Admin\"\n                        : user?.role === \"admin\"\n                          ? \"Administrator\"\n                          : user?.role === \"manager\"\n                            ? \"Manager\"\n                            : user?.role === \"supervisor\"\n                              ? \"Supervisor\"\n                              : user?.role === \"marketer\"\n                                ? \"Marketer\"\n                                : \"Staff\"}\n                    </span>\n                    <div className=\"text-xs text-gray-400\">Online</div>\n                  </div>\n                </div>\n\n                {/* Profile Editor */}\n                <div className=\"p-2\">\n                  <ProfileEditor user={user} />\n                </div>\n\n                <DropdownMenuItem asChild>\n                  <Link\n                    href=\"/settings\"\n                    className=\"flex items-center w-full px-3 py-2 hover:bg-gray-50 transition-colors\"\n                  >\n                    <Settings className=\"mr-3 h-4 w-4 text-gray-500\" />\n                    <span className=\"text-sm\">Settings</span>\n                  </Link>\n                </DropdownMenuItem>\n\n                <DropdownMenuSeparator className=\"my-1\" />\n\n                <DropdownMenuItem\n                  onClick={handleLogout}\n                  className=\"text-red-600 cursor-pointer px-3 py-2 hover:bg-red-50 transition-colors\"\n                >\n                  <LogOut className=\"mr-3 h-4 w-4\" />\n                  <span className=\"text-sm\">Sign out</span>\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          )}\n        </div>\n      </div>\n    </header>\n  );\n}\n","path":null,"size_bytes":14551,"size_tokens":null},"client/src/pages/api-docs.tsx":{"content":"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Code, Book, Server, Zap } from \"lucide-react\";\nimport { ProtectedRoute } from \"@/components/protected-route\";\n\nexport default function ApiDocs() {\n  return (\n    <ProtectedRoute resource=\"api\" action=\"read\">\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div>\n            <p className=\"text-muted-foreground\">\n              Complete API reference and developer documentation\n            </p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Book className=\"h-5 w-5\" />\n                API Reference\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-4\">\n                Complete API endpoints documentation\n              </p>\n              <div className=\"space-y-2\">\n                <div className=\"text-sm\">\n                  <span className=\"font-medium\">Base URL:</span> /api/v1\n                </div>\n                <div className=\"text-sm\">\n                  <span className=\"font-medium\">Authentication:</span> Bearer Token\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Server className=\"h-5 w-5\" />\n                Endpoints\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between text-sm\">\n                  <span>Auth</span>\n                  <span className=\"text-muted-foreground\">5 endpoints</span>\n                </div>\n                <div className=\"flex justify-between text-sm\">\n                  <span>Products</span>\n                  <span className=\"text-muted-foreground\">8 endpoints</span>\n                </div>\n                <div className=\"flex justify-between text-sm\">\n                  <span>Orders</span>\n                  <span className=\"text-muted-foreground\">12 endpoints</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Zap className=\"h-5 w-5\" />\n                Rate Limits\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                <div className=\"text-sm\">\n                  <span className=\"font-medium\">Rate Limit:</span> 1000/hour\n                </div>\n                <div className=\"text-sm\">\n                  <span className=\"font-medium\">Burst:</span> 100/minute\n                </div>\n                <div className=\"text-sm\">\n                  <span className=\"font-medium\">Status:</span> \n                  <span className=\"text-green-600 ml-1\">Healthy</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </ProtectedRoute>\n  );\n}\n","path":null,"size_bytes":3307,"size_tokens":null},"server/alertService.ts":{"content":"import { SecurityAlert } from \"./securityMonitor\";\n\nexport interface AlertChannel {\n  name: string;\n  enabled: boolean;\n  config: any;\n}\n\nexport interface EmailConfig {\n  enabled: boolean;\n  smtpHost?: string;\n  smtpPort?: number;\n  smtpUser?: string;\n  smtpPassword?: string;\n  fromEmail?: string;\n  adminEmails: string[];\n}\n\nexport interface SlackConfig {\n  enabled: boolean;\n  webhookUrl?: string;\n  channel?: string;\n}\n\nexport interface DashboardConfig {\n  enabled: boolean;\n  showInUI: boolean;\n  maxAlerts: number;\n}\n\nclass AlertService {\n  private emailConfig: EmailConfig = {\n    enabled: false,\n    adminEmails: ['admin@bakesewa.com'],\n  };\n\n  private slackConfig: SlackConfig = {\n    enabled: false,\n  };\n\n  private dashboardConfig: DashboardConfig = {\n    enabled: true,\n    showInUI: true,\n    maxAlerts: 50,\n  };\n\n  private dashboardAlerts: SecurityAlert[] = [];\n\n  constructor() {\n    console.log(\"üì¢ Alert Service initialized\");\n  }\n\n  public async sendAlert(alert: SecurityAlert): Promise<void> {\n    console.log(`üì¢ Processing alert: ${alert.title}`);\n\n    const promises: Promise<void>[] = [];\n\n    // Send email alerts\n    if (this.emailConfig.enabled) {\n      promises.push(this.sendEmailAlert(alert));\n    }\n\n    // Send Slack alerts\n    if (this.slackConfig.enabled) {\n      promises.push(this.sendSlackAlert(alert));\n    }\n\n    // Add to dashboard\n    if (this.dashboardConfig.enabled) {\n      promises.push(this.addToDashboard(alert));\n    }\n\n    try {\n      await Promise.allSettled(promises);\n    } catch (error) {\n      console.error(\"Error sending alerts:\", error);\n    }\n  }\n\n  private async sendEmailAlert(alert: SecurityAlert): Promise<void> {\n    try {\n      // In production, this would use a real email service like SendGrid, SES, etc.\n      console.log(`üìß EMAIL ALERT [${alert.severity}]: ${alert.title}`);\n      console.log(`   To: ${this.emailConfig.adminEmails.join(', ')}`);\n      console.log(`   Description: ${alert.description}`);\n      console.log(`   User: ${alert.userEmail}`);\n      console.log(`   IP: ${alert.ipAddress}`);\n      console.log(`   Time: ${alert.timestamp.toISOString()}`);\n      \n      // Mock implementation - In production, replace with actual email sending\n      const emailBody = this.generateEmailBody(alert);\n      \n      // Here you would integrate with your email service:\n      // await emailService.send({\n      //   to: this.emailConfig.adminEmails,\n      //   subject: `[SECURITY ALERT] ${alert.title}`,\n      //   html: emailBody\n      // });\n\n    } catch (error) {\n      console.error(\"Failed to send email alert:\", error);\n    }\n  }\n\n  private async sendSlackAlert(alert: SecurityAlert): Promise<void> {\n    try {\n      if (!this.slackConfig.webhookUrl) {\n        console.warn(\"Slack webhook URL not configured\");\n        return;\n      }\n\n      const slackMessage = {\n        text: `üö® Security Alert: ${alert.title}`,\n        attachments: [\n          {\n            color: this.getAlertColor(alert.severity),\n            fields: [\n              {\n                title: \"Severity\",\n                value: alert.severity,\n                short: true\n              },\n              {\n                title: \"User\",\n                value: alert.userEmail,\n                short: true\n              },\n              {\n                title: \"IP Address\",\n                value: alert.ipAddress,\n                short: true\n              },\n              {\n                title: \"Time\",\n                value: alert.timestamp.toISOString(),\n                short: true\n              },\n              {\n                title: \"Description\",\n                value: alert.description,\n                short: false\n              }\n            ],\n            footer: \"Bakery Security Monitor\",\n            ts: Math.floor(alert.timestamp.getTime() / 1000)\n          }\n        ]\n      };\n\n      // In production, send to Slack webhook\n      console.log(`üì± SLACK ALERT [${alert.severity}]: ${alert.title}`);\n      console.log(`   Channel: ${this.slackConfig.channel || 'default'}`);\n      console.log(`   Message:`, JSON.stringify(slackMessage, null, 2));\n\n      // Mock implementation - In production, replace with actual Slack API call\n      // const response = await fetch(this.slackConfig.webhookUrl, {\n      //   method: 'POST',\n      //   headers: { 'Content-Type': 'application/json' },\n      //   body: JSON.stringify(slackMessage)\n      // });\n\n    } catch (error) {\n      console.error(\"Failed to send Slack alert:\", error);\n    }\n  }\n\n  private async addToDashboard(alert: SecurityAlert): Promise<void> {\n    try {\n      this.dashboardAlerts.unshift(alert);\n      \n      // Keep only the most recent alerts\n      if (this.dashboardAlerts.length > this.dashboardConfig.maxAlerts) {\n        this.dashboardAlerts = this.dashboardAlerts.slice(0, this.dashboardConfig.maxAlerts);\n      }\n\n      console.log(`üìä Dashboard alert added: ${alert.title}`);\n    } catch (error) {\n      console.error(\"Failed to add alert to dashboard:\", error);\n    }\n  }\n\n  private generateEmailBody(alert: SecurityAlert): string {\n    return `\n      <html>\n        <head>\n          <style>\n            body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }\n            .container { background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }\n            .header { color: ${this.getAlertColorHex(alert.severity)}; font-size: 24px; font-weight: bold; margin-bottom: 20px; }\n            .severity { display: inline-block; padding: 8px 16px; border-radius: 4px; color: white; font-weight: bold; background-color: ${this.getAlertColorHex(alert.severity)}; }\n            .details { margin: 20px 0; }\n            .detail-row { margin: 10px 0; }\n            .label { font-weight: bold; color: #333; }\n            .value { color: #666; }\n            .footer { margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; color: #999; font-size: 14px; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">üö® Security Alert</div>\n            <div class=\"severity\">${alert.severity}</div>\n            <h2>${alert.title}</h2>\n            <p>${alert.description}</p>\n            \n            <div class=\"details\">\n              <div class=\"detail-row\">\n                <span class=\"label\">User:</span>\n                <span class=\"value\">${alert.userEmail} (${alert.userId})</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"label\">IP Address:</span>\n                <span class=\"value\">${alert.ipAddress}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"label\">Time:</span>\n                <span class=\"value\">${alert.timestamp.toISOString()}</span>\n              </div>\n              ${alert.metadata ? `\n                <div class=\"detail-row\">\n                  <span class=\"label\">Additional Details:</span>\n                  <span class=\"value\">${JSON.stringify(alert.metadata, null, 2)}</span>\n                </div>\n              ` : ''}\n            </div>\n            \n            <div class=\"footer\">\n              This alert was generated by the Bakery Management System Security Monitor.\n              Please investigate this incident immediately.\n            </div>\n          </div>\n        </body>\n      </html>\n    `;\n  }\n\n  private getAlertColor(severity: string): string {\n    switch (severity) {\n      case 'CRITICAL': return 'danger';\n      case 'HIGH': return 'warning';\n      case 'MEDIUM': return '#ff9500';\n      case 'LOW': return 'good';\n      default: return '#cccccc';\n    }\n  }\n\n  private getAlertColorHex(severity: string): string {\n    switch (severity) {\n      case 'CRITICAL': return '#dc3545';\n      case 'HIGH': return '#fd7e14';\n      case 'MEDIUM': return '#ffc107';\n      case 'LOW': return '#28a745';\n      default: return '#6c757d';\n    }\n  }\n\n  // Configuration methods\n  public configureEmail(config: EmailConfig) {\n    this.emailConfig = { ...this.emailConfig, ...config };\n    console.log(`üìß Email alerts ${config.enabled ? 'enabled' : 'disabled'}`);\n  }\n\n  public configureSlack(config: SlackConfig) {\n    this.slackConfig = { ...this.slackConfig, ...config };\n    console.log(`üì± Slack alerts ${config.enabled ? 'enabled' : 'disabled'}`);\n  }\n\n  public configureDashboard(config: DashboardConfig) {\n    this.dashboardConfig = { ...this.dashboardConfig, ...config };\n    console.log(`üìä Dashboard alerts ${config.enabled ? 'enabled' : 'disabled'}`);\n  }\n\n  // Get dashboard alerts for UI\n  public getDashboardAlerts(): SecurityAlert[] {\n    return [...this.dashboardAlerts];\n  }\n\n  // Clear dashboard alerts\n  public clearDashboardAlerts() {\n    this.dashboardAlerts = [];\n    console.log(\"üìä Dashboard alerts cleared\");\n  }\n\n  // Test alert functionality\n  public async sendTestAlert(): Promise<void> {\n    const testAlert: SecurityAlert = {\n      id: 'test_' + Date.now(),\n      type: 'API_ABUSE',\n      severity: 'MEDIUM',\n      title: 'Test Alert',\n      description: 'This is a test alert to verify the alert system is working correctly.',\n      userId: 'test_user',\n      userEmail: 'test@example.com',\n      ipAddress: '192.168.1.100',\n      timestamp: new Date(),\n      metadata: {\n        test: true,\n        component: 'Alert Service'\n      }\n    };\n\n    await this.sendAlert(testAlert);\n    console.log(\"‚úÖ Test alert sent successfully\");\n  }\n}\n\nexport const alertService = new AlertService();","path":null,"size_bytes":9553,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"server/rateLimiter.ts":{"content":"\n// Rate limiting utilities for enhanced security\nexport const rateLimitStore = new Map<string, number>();\n\nexport function rateLimitKey(ip: string, identifier?: string): string {\n  return identifier ? `${ip}:${identifier}` : ip;\n}\n\nexport function submissionStart(): number {\n  return Date.now();\n}\n\nexport function submissionTimestamp(): string {\n  return new Date().toISOString();\n}\n\nexport function clientIP(req: any): string {\n  return req.headers['x-forwarded-for']?.split(',')[0] || \n         req.headers['x-real-ip'] || \n         req.connection.remoteAddress || \n         req.socket.remoteAddress ||\n         '127.0.0.1';\n}\n\nexport function userAgent(req: any): string {\n  return req.get('User-Agent') || '';\n}\n\nexport function referenceId(): string {\n  return `REF-${Date.now()}-${Math.random().toString(36).substr(2, 5).toUpperCase()}`;\n}\n\nexport function formVersion(): string {\n  return '1.0';\n}\n\nexport function attachments(files: File[] = []): any[] {\n  return files.map(file => ({\n    name: file.name,\n    size: file.size,\n    type: file.type,\n    lastModified: file.lastModified\n  }));\n}\n\n// Rate limiting check\nexport function checkRateLimit(key: string, windowMs: number = 60000, maxRequests: number = 5): boolean {\n  const now = Date.now();\n  const windowStart = now - windowMs;\n  \n  // Clean old entries\n  for (const [k, timestamp] of rateLimitStore.entries()) {\n    if (timestamp < windowStart) {\n      rateLimitStore.delete(k);\n    }\n  }\n  \n  // Count requests in current window\n  let requestCount = 0;\n  for (const [k, timestamp] of rateLimitStore.entries()) {\n    if (k.startsWith(key) && timestamp >= windowStart) {\n      requestCount++;\n    }\n  }\n  \n  if (requestCount >= maxRequests) {\n    return false; // Rate limit exceeded\n  }\n  \n  rateLimitStore.set(`${key}:${now}`, now);\n  return true;\n}\n","path":null,"size_bytes":1822,"size_tokens":null},"client/src/pages/units.tsx":{"content":"import React, { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useUnits } from \"@/hooks/useUnits\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport SearchBar from \"@/components/search-bar\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Search, Edit, Trash2, Ruler } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\n\nexport default function Units() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingUnit, setEditingUnit] = useState<any>(null);\n  const { toast } = useToast();\n\n  // Fetch units using the custom hook\n  const {\n    data: units = [],\n    isLoading,\n    error,\n    refetch: refetchUnits,\n  } = useUnits();\n\n  // Debug logging\n  console.log(\"Units page - Data received:\", units);\n  console.log(\"Units page - Is loading:\", isLoading);\n  console.log(\"Units page - Error:\", error);\n\n  // Ensure units is always an array\n  const unitsArray = Array.isArray(units) ? units : [];\n  console.log(\"Units page - Array after processing:\", unitsArray);\n\n  // Filter units by search query\n  const filteredUnits = useMemo(() => {\n    if (!searchQuery.trim()) return unitsArray;\n\n    return unitsArray.filter(\n      (unit: any) =>\n        unit.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        unit.abbreviation?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        unit.type?.toLowerCase().includes(searchQuery.toLowerCase()),\n    );\n  }, [unitsArray, searchQuery]);\n\n  // Sort the filtered units\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredUnits,\n    \"name\",\n  );\n\n  // Debug sorting\n  console.log(\"Filtered units count:\", filteredUnits.length);\n  console.log(\"Sorted data count:\", sortedData.length);\n  console.log(\"Current sort config:\", sortConfig);\n\n  // Mutation hooks\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      console.log(\"Creating unit with data:\", data);\n      const response = await apiRequest(\"POST\", \"/api/units\", data);\n      console.log(\"Create unit response:\", response);\n      return response;\n    },\n    onSuccess: (response) => {\n      console.log(\"Unit created successfully:\", response);\n      queryClient.invalidateQueries({ queryKey: [\"/api/units\"] });\n      refetchUnits();\n      setIsDialogOpen(false);\n      setEditingUnit(null);\n\n      // Handle both response formats\n      const unitName = response?.data?.name || response?.name || \"Unit\";\n\n      toast({\n        title: \"Success\",\n        description: `Unit \"${unitName}\" created successfully`,\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => (window.location.href = \"/api/login\"), 500);\n        return;\n      }\n      const message = error?.message || \"Failed to create unit\";\n      toast({\n        title: \"Error\",\n        description: message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: { id: number; values: any }) => {\n      console.log(\"Updating unit:\", data.id, \"with values:\", data.values);\n      const response = await apiRequest(\n        \"PUT\",\n        `/api/units/${data.id}`,\n        data.values,\n      );\n      console.log(\"Update unit response:\", response);\n      return response;\n    },\n    onSuccess: (response) => {\n      console.log(\"Unit updated successfully:\", response);\n      queryClient.invalidateQueries({ queryKey: [\"/api/units\"] });\n      refetchUnits();\n      setIsDialogOpen(false);\n      setEditingUnit(null);\n\n      // Handle both response formats\n      const unitName = response?.data?.name || response?.name || \"Unit\";\n\n      toast({\n        title: \"Success\",\n        description: `Unit \"${unitName}\" updated successfully`,\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => (window.location.href = \"/api/login\"), 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Failed to update unit\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/units/${id}`);\n      return response;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/units\"] });\n      refetchUnits();\n      toast({\n        title: \"Success\",\n        description: \"Unit deleted successfully\",\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => (window.location.href = \"/api/login\"), 500);\n        return;\n      }\n\n      const errorMessage = error?.message || \"Failed to delete unit\";\n      const isConstraintError =\n        errorMessage.includes(\"being used\") ||\n        errorMessage.includes(\"FOREIGN_KEY\");\n\n      toast({\n        title: isConstraintError ? \"Cannot Delete Unit\" : \"Error\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const toggleActiveMutation = useMutation({\n    mutationFn: async (data: { id: number; isActive: boolean }) => {\n      const response = await apiRequest(\"PUT\", `/api/units/${data.id}`, {\n        isActive: data.isActive,\n      });\n      return { response, newIsActive: data.isActive };\n    },\n    onSuccess: ({ response, newIsActive }) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/units\"] });\n      refetchUnits();\n      const unitName = response?.data?.name || response?.name || \"Unit\";\n      toast({\n        title: \"Success\",\n        description: `Unit \"${unitName}\" ${newIsActive ? \"activated\" : \"deactivated\"} successfully`,\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => (window.location.href = \"/api/login\"), 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Failed to update status\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Handle form submission\n  const handleSave = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    const formData = new FormData(e.currentTarget);\n    const name = formData.get(\"name\") as string;\n    const abbreviation = formData.get(\"abbreviation\") as string;\n    const type = formData.get(\"type\") as string;\n\n    if (!name?.trim() || !abbreviation?.trim() || !type?.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Name, abbreviation, and type are required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const unitData = {\n      name: name.trim(),\n      abbreviation: abbreviation.trim(),\n      type: type.trim(),\n      baseUnit: (formData.get(\"baseUnit\") as string)?.trim() || null,\n      conversionFactor:\n        parseFloat(formData.get(\"conversionFactor\") as string) || 1,\n      isActive: true,\n    };\n\n    if (editingUnit) {\n      updateMutation.mutate({ id: editingUnit.id, values: unitData });\n    } else {\n      createMutation.mutate(unitData);\n    }\n  };\n\n  // Badge type helper\n  const getTypeBadge = (type: string) => {\n    switch (type?.toLowerCase()) {\n      case \"weight\":\n        return {\n          variant: \"default\",\n          text: \"Weight\",\n          color: \"bg-blue-100 text-blue-800\",\n        };\n      case \"volume\":\n        return {\n          variant: \"secondary\",\n          text: \"Volume\",\n          color: \"bg-green-100 text-green-800\",\n        };\n      case \"count\":\n        return {\n          variant: \"outline\",\n          text: \"Count\",\n          color: \"bg-gray-100 text-gray-800\",\n        };\n      case \"length\":\n        return {\n          variant: \"outline\",\n          text: \"Length\",\n          color: \"bg-purple-100 text-purple-800\",\n        };\n      case \"area\":\n        return {\n          variant: \"outline\",\n          text: \"Area\",\n          color: \"bg-yellow-100 text-yellow-800\",\n        };\n      case \"temperature\":\n        return {\n          variant: \"outline\",\n          text: \"Temperature\",\n          color: \"bg-red-100 text-red-800\",\n        };\n      default:\n        return {\n          variant: \"outline\",\n          text: type || \"Unknown\",\n          color: \"bg-gray-100 text-gray-800\",\n        };\n    }\n  };\n\n  // Unauthorized redirect\n  if (error && isUnauthorizedError(error)) {\n    toast({\n      title: \"Session Expired\",\n      description: \"Redirecting to login...\",\n      variant: \"destructive\",\n    });\n    setTimeout(() => (window.location.href = \"/api/login\"), 500);\n    return null;\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600\">\n            Manage units for inventory and products\n          </p>\n        </div>\n        <Dialog\n          open={isDialogOpen}\n          onOpenChange={(open) => {\n            setIsDialogOpen(open);\n            if (!open) {\n              setEditingUnit(null);\n            }\n          }}\n        >\n          <DialogTrigger asChild>\n            <Button\n              onClick={() => setEditingUnit(null)}\n              className=\"w-full sm:w-auto\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Unit\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-md mx-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingUnit ? \"Edit Unit\" : \"Add New Unit\"}\n              </DialogTitle>\n              <DialogDescription>Enter unit details below</DialogDescription>\n            </DialogHeader>\n            <form\n              onSubmit={handleSave}\n              key={editingUnit?.id || \"new\"}\n              className=\"space-y-4\"\n            >\n              <div>\n                <Label htmlFor=\"name\">Unit Name</Label>\n                <Input\n                  id=\"name\"\n                  name=\"name\"\n                  placeholder=\"e.g., Kilogram, Liter\"\n                  defaultValue={editingUnit?.name || \"\"}\n                  required\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"abbreviation\">Abbreviation</Label>\n                <Input\n                  id=\"abbreviation\"\n                  name=\"abbreviation\"\n                  placeholder=\"e.g., kg, ltr\"\n                  defaultValue={editingUnit?.abbreviation || \"\"}\n                  required\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"type\">Unit Type</Label>\n                <Select\n                  name=\"type\"\n                  defaultValue={editingUnit?.type || \"\"}\n                  required\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select type\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"weight\">Weight</SelectItem>\n                    <SelectItem value=\"volume\">Volume</SelectItem>\n                    <SelectItem value=\"count\">Count</SelectItem>\n                    <SelectItem value=\"length\">Length</SelectItem>\n                    <SelectItem value=\"area\">Area</SelectItem>\n                    <SelectItem value=\"temperature\">Temperature</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={createMutation.isPending || updateMutation.isPending}\n              >\n                {createMutation.isPending || updateMutation.isPending\n                  ? \"Saving...\"\n                  : editingUnit\n                    ? \"Update Unit\"\n                    : \"Add Unit\"}\n              </Button>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center space-x-2\">\n        <div className=\"flex-1\">\n          <SearchBar\n            placeholder=\"Search units by name, abbr, or type...\"\n            value={searchQuery}\n            onChange={setSearchQuery}\n            className=\"w-full\"\n          />\n        </div>\n      </div>\n\n      {/* Table */}\n      <Card>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto\"></div>\n              <p className=\"text-muted-foreground mt-2\">Loading units...</p>\n            </div>\n          ) : error ? (\n            <div className=\"text-center py-8\">\n              <h3 className=\"text-lg font-semibold text-red-600 mb-2\">\n                Error Loading Units\n              </h3>\n              <p className=\"text-muted-foreground mb-4\">\n                {error instanceof Error ? error.message : \"Unknown error\"}\n              </p>\n              <Button onClick={refetchUnits}>Retry</Button>\n            </div>\n          ) : (\n            <>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"name\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Name\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"abbreviation\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Abbreviation\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"type\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Type\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"isActive\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Status\n                    </SortableTableHeader>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {sortedData.length > 0 ? (\n                    sortedData.map((unit: any) => {\n                      const typeBadge = getTypeBadge(unit.type);\n                      const isInactive = !unit.isActive;\n                      return (\n                        <TableRow\n                          key={unit.id}\n                          className={isInactive ? \"opacity-60 bg-muted/30\" : \"\"}\n                        >\n                          <TableCell>\n                            <div className=\"flex items-center space-x-3\">\n                              <div\n                                className={`w-8 h-8 rounded-full flex items-center justify-center ${isInactive ? \"bg-muted\" : \"bg-primary/10\"}`}\n                              >\n                                <Ruler\n                                  className={`h-4 w-4 ${isInactive ? \"text-muted-foreground\" : \"text-primary\"}`}\n                                />\n                              </div>\n                              <div\n                                className={`font-medium ${isInactive ? \"text-muted-foreground\" : \"\"}`}\n                              >\n                                {unit.name}\n                              </div>\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <code\n                              className={`px-2 py-1 rounded text-sm ${isInactive ? \"bg-muted text-muted-foreground\" : \"bg-gray-100 \"}`}\n                            >\n                              {unit.abbreviation}\n                            </code>\n                          </TableCell>\n                          <TableCell>\n                            <Badge\n                              variant={\n                                isInactive\n                                  ? \"outline\"\n                                  : (typeBadge.variant as any)\n                              }\n                              className={isInactive ? \"opacity-70\" : \"\"}\n                            >\n                              {typeBadge.text}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            <Badge\n                              variant={\n                                unit.isActive ? \"default\" : \"destructive\"\n                              }\n                              className={\n                                unit.isActive\n                                  ? \"bg-green-600 dark:bg-green-700\"\n                                  : \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\"\n                              }\n                            >\n                              {unit.isActive ? \"Active\" : \"Inactive\"}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center space-x-2\">\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                className=\"text-blue-800 dark:text-blue-400\"\n                                onClick={() => {\n                                  setEditingUnit(unit);\n                                  setIsDialogOpen(true);\n                                }}\n                                title=\"Edit\"\n                                data-testid={`button-edit-unit-${unit.id}`}\n                              >\n                                <Edit className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant={\n                                  unit.isActive ? \"destructive\" : \"default\"\n                                }\n                                size=\"sm\"\n                                className={\n                                  unit.isActive\n                                    ? \"bg-red-600 hover:bg-red-700 text-white\"\n                                    : \"bg-green-600 hover:bg-green-700 text-white\"\n                                }\n                                onClick={() =>\n                                  toggleActiveMutation.mutate({\n                                    id: unit.id,\n                                    isActive: !unit.isActive,\n                                  })\n                                }\n                                disabled={toggleActiveMutation.isPending}\n                                data-testid={`button-toggle-unit-${unit.id}`}\n                              >\n                                {unit.isActive ? \"Deactivate\" : \"Activate\"}\n                              </Button>\n                              <DeleteConfirmationDialog\n                                trigger={\n                                  <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    title=\"Delete\"\n                                    data-testid={`button-delete-unit-${unit.id}`}\n                                  >\n                                    <Trash2 className=\"h-4 w-4 text-red-800 dark:text-red-400\" />\n                                  </Button>\n                                }\n                                title=\"Delete Unit\"\n                                itemName={unit.name}\n                                onConfirm={() => deleteMutation.mutate(unit.id)}\n                                isLoading={deleteMutation.isPending}\n                              />\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      );\n                    })\n                  ) : (\n                    <TableRow>\n                      <TableCell colSpan={5} className=\"h-24 text-center\">\n                        <Ruler className=\"h-12 w-12 text-muted-foreground mx-auto mb-2 opacity-50\" />\n                        <p className=\"text-muted-foreground\">\n                          {searchQuery\n                            ? \"No matching units found. Try a different search.\"\n                            : \"No units available. Add your first unit.\"}\n                        </p>\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":22435,"size_tokens":null},"client/src/contexts/UnitsContext.tsx":{"content":"\nimport React, { createContext, useContext, ReactNode } from 'react';\nimport { useUnits } from '@/hooks/useUnits';\n\ninterface Unit {\n  id: number;\n  name: string;\n  abbreviation: string;\n  type: string;\n  isActive: boolean;\n}\n\ninterface UnitsContextType {\n  units: Unit[];\n  isLoading: boolean;\n  error: any;\n  getUnitById: (id: number | string) => Unit | undefined;\n  getUnitsByType: (type: string) => Unit[];\n  getActiveUnits: () => Unit[];\n}\n\nconst UnitsContext = createContext<UnitsContextType | undefined>(undefined);\n\ninterface UnitsProviderProps {\n  children: ReactNode;\n}\n\nexport function UnitsProvider({ children }: UnitsProviderProps) {\n  const { data: units = [], isLoading, error } = useUnits();\n\n  const getUnitById = (id: number | string): Unit | undefined => {\n    return units.find((unit: Unit) => unit.id.toString() === id.toString());\n  };\n\n  const getUnitsByType = (type: string): Unit[] => {\n    return units.filter((unit: Unit) => unit.type === type && unit.isActive);\n  };\n\n  const getActiveUnits = (): Unit[] => {\n    return units.filter((unit: Unit) => unit.isActive);\n  };\n\n  const value: UnitsContextType = {\n    units,\n    isLoading,\n    error,\n    getUnitById,\n    getUnitsByType,\n    getActiveUnits,\n  };\n\n  return (\n    <UnitsContext.Provider value={value}>\n      {children}\n    </UnitsContext.Provider>\n  );\n}\n\nexport function useUnitsContext(): UnitsContextType {\n  const context = useContext(UnitsContext);\n  if (context === undefined) {\n    throw new Error('useUnitsContext must be used within a UnitsProvider');\n  }\n  return context;\n}\n\n// Helper hook for easy access to formatted unit display\nexport function useUnitDisplay() {\n  const { getUnitById } = useUnitsContext();\n  \n  const formatUnitDisplay = (unitId?: number | string, showAbbreviation = true): string => {\n    if (!unitId) return 'No unit';\n    \n    const unit = getUnitById(unitId);\n    if (!unit) return `Unknown unit (${unitId})`;\n    \n    return showAbbreviation ? unit.abbreviation : unit.name;\n  };\n\n  return { formatUnitDisplay, getUnitById };\n}\n","path":null,"size_bytes":2052,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\";\n\nimport * as React from \"react\";\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\";\nimport { X } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst Dialog = DialogPrimitive.Root;\n\nconst DialogTrigger = DialogPrimitive.Trigger;\n\nconst DialogPortal = DialogPrimitive.Portal;\n\nconst DialogClose = DialogPrimitive.Close;\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className,\n    )}\n    {...props}\n  />\n));\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName;\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className,\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n));\nDialogContent.displayName = DialogPrimitive.Content.displayName;\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className,\n    )}\n    {...props}\n  />\n);\nDialogHeader.displayName = \"DialogHeader\";\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className,\n    )}\n    {...props}\n  />\n);\nDialogFooter.displayName = \"DialogFooter\";\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className,\n    )}\n    {...props}\n  />\n));\nDialogTitle.displayName = DialogPrimitive.Title.displayName;\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nDialogDescription.displayName = DialogPrimitive.Description.displayName;\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n};\n","path":null,"size_bytes":3870,"size_tokens":null},"client/src/contexts/ThemeContext.tsx":{"content":"// This file is no longer needed - theme context removed","path":null,"size_bytes":56,"size_tokens":null},"client/src/pages/security-logs.tsx":{"content":"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Shield, AlertTriangle, Eye, Lock } from \"lucide-react\";\nimport { ProtectedRoute } from \"@/components/protected-route\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function SecurityLogs() {\n  return (\n    <ProtectedRoute resource=\"security\" action=\"read\">\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div>\n            <p className=\"text-muted-foreground\">\n              Monitor security events and potential threats\n            </p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Lock className=\"h-5 w-5\" />\n                Login Attempts\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">1,247</div>\n              <p className=\"text-sm text-muted-foreground\">Last 24 hours</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <AlertTriangle className=\"h-5 w-5 text-red-500\" />\n                Failed Logins\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-red-600\">12</div>\n              <p className=\"text-sm text-muted-foreground\">Blocked attempts</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Eye className=\"h-5 w-5\" />\n                Security Events\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">3</div>\n              <p className=\"text-sm text-muted-foreground\">Requires attention</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Threat Level</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-2\">\n                <Badge variant=\"default\" className=\"bg-green-500\">Low</Badge>\n                <span className=\"text-sm text-muted-foreground\">All systems secure</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </ProtectedRoute>\n  );\n}\n","path":null,"size_bytes":2566,"size_tokens":null},"client/src/pages/monitoring.tsx":{"content":"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Monitor, TrendingUp, Clock, Users } from \"lucide-react\";\nimport { ProtectedRoute } from \"@/components/protected-route\";\n\nexport default function SystemMonitoring() {\n  return (\n    <ProtectedRoute resource=\"monitoring\" action=\"read\">\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div>\n            <p className=\"text-muted-foreground\">\n              Real-time system monitoring and analytics\n            </p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Users className=\"h-5 w-5\" />\n                Active Users\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">47</div>\n              <p className=\"text-sm text-muted-foreground\">Currently online</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <TrendingUp className=\"h-5 w-5\" />\n                Response Time\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">145ms</div>\n              <p className=\"text-sm text-muted-foreground\">Average response</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Clock className=\"h-5 w-5\" />\n                Uptime\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">99.9%</div>\n              <p className=\"text-sm text-muted-foreground\">Last 30 days</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Throughput</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">2.1k</div>\n              <p className=\"text-sm text-muted-foreground\">Requests/min</p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </ProtectedRoute>\n  );\n}\n","path":null,"size_bytes":2376,"size_tokens":null},"client/src/hooks/usePWAInstall.ts":{"content":"\nimport { useState, useEffect } from 'react';\n\ninterface BeforeInstallPromptEvent extends Event {\n  readonly platforms: string[];\n  readonly userChoice: Promise<{\n    outcome: 'accepted' | 'dismissed';\n    platform: string;\n  }>;\n  prompt(): Promise<void>;\n}\n\nexport function usePWAInstall() {\n  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);\n  const [isInstallable, setIsInstallable] = useState(false);\n  const [isInstalled, setIsInstalled] = useState(false);\n\n  useEffect(() => {\n    // Check if app is already installed\n    const isStandalone = window.matchMedia('(display-mode: standalone)').matches;\n    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);\n    const isInStandaloneMode = (window.navigator as any).standalone;\n    \n    setIsInstalled(isStandalone || (isIOS && isInStandaloneMode));\n\n    // Listen for the beforeinstallprompt event\n    const handleBeforeInstallPrompt = (e: Event) => {\n      e.preventDefault();\n      setDeferredPrompt(e as BeforeInstallPromptEvent);\n      setIsInstallable(true);\n    };\n\n    // Listen for app installed event\n    const handleAppInstalled = () => {\n      setIsInstalled(true);\n      setIsInstallable(false);\n      setDeferredPrompt(null);\n    };\n\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    window.addEventListener('appinstalled', handleAppInstalled);\n\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n      window.removeEventListener('appinstalled', handleAppInstalled);\n    };\n  }, []);\n\n  const installApp = async () => {\n    if (!deferredPrompt) return false;\n\n    try {\n      await deferredPrompt.prompt();\n      const { outcome } = await deferredPrompt.userChoice;\n      \n      if (outcome === 'accepted') {\n        setIsInstalled(true);\n        setIsInstallable(false);\n        setDeferredPrompt(null);\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.error('Error installing app:', error);\n      return false;\n    }\n  };\n\n  const getInstallInstructions = () => {\n    const userAgent = navigator.userAgent.toLowerCase();\n    \n    if (userAgent.includes('chrome') && !userAgent.includes('edg')) {\n      return {\n        browser: 'Chrome',\n        steps: [\n          'Tap the menu button (three dots) in the top right',\n          'Select \"Add to Home screen\" or \"Install app\"',\n          'Follow the prompts to install'\n        ]\n      };\n    } else if (userAgent.includes('safari') && !userAgent.includes('chrome')) {\n      return {\n        browser: 'Safari',\n        steps: [\n          'Tap the share button at the bottom of the screen',\n          'Scroll down and tap \"Add to Home Screen\"',\n          'Tap \"Add\" to install the app'\n        ]\n      };\n    } else if (userAgent.includes('firefox')) {\n      return {\n        browser: 'Firefox',\n        steps: [\n          'Tap the menu button (three lines)',\n          'Select \"Install\" or \"Add to Home screen\"',\n          'Follow the prompts to install'\n        ]\n      };\n    } else if (userAgent.includes('edg')) {\n      return {\n        browser: 'Edge',\n        steps: [\n          'Tap the menu button (three dots)',\n          'Select \"Add to phone\" or \"Install app\"',\n          'Follow the prompts to install'\n        ]\n      };\n    }\n    \n    return {\n      browser: 'Your browser',\n      steps: [\n        'Look for an \"Install\" or \"Add to Home Screen\" option in your browser menu',\n        'Follow the prompts to install the app'\n      ]\n    };\n  };\n\n  return {\n    isInstallable,\n    isInstalled,\n    installApp,\n    getInstallInstructions,\n    canPromptInstall: !!deferredPrompt\n  };\n}\n","path":null,"size_bytes":3686,"size_tokens":null},"client/src/components/ui/sortable-table-header.tsx":{"content":"import { ArrowUpDown } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"./button\";\n\ninterface SortableTableHeaderProps {\n  label: string;\n  sortKey: string;\n  currentSort: { key: string; direction: \"asc\" | \"desc\" };\n  onSort: (key: string) => void;\n  className?: string;\n}\n\nexport function SortableTableHeader({\n  label,\n  sortKey,\n  currentSort,\n  onSort,\n  className = \"\",\n}: SortableTableHeaderProps) {\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"sm\"\n      className={cn(\"-ml-3 h-8 data-[state=open]:bg-accent\", className)}\n      onClick={() => onSort(sortKey)}\n    >\n      <span>{label}</span>\n      <ArrowUpDown className=\"ml-2 h-4 w-4\" />\n    </Button>\n  );\n}","path":null,"size_bytes":708,"size_tokens":null},"client/src/components/order-form.tsx":{"content":"import React, { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertOrderSchema } from \"@shared/schema\";\nimport {\n  Form,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { z } from \"zod\";\n\nconst orderFormSchema = z.object({\n  customerName: z.string().min(1, \"Customer name is required\"),\n  customerEmail: z.string().email(\"Invalid email\").optional().or(z.literal(\"\")),\n  customerPhone: z.string().optional(),\n  company: z.string().optional(),\n  totalAmount: z.string().min(1, \"Total amount is required\"),\n  dueDate: z.string().optional(),\n  notes: z.string().optional(),\n  items: z\n    .array(\n      z.object({\n        productId: z.string().min(1, \"Product is required\"),\n        quantity: z.string().min(1, \"Quantity is required\"),\n        unitPrice: z.string().min(1, \"Unit price is required\"),\n        unitId: z.string().optional(), // Added unitId to the schema\n      }),\n    )\n    .min(1, \"At least one item is required\"),\n});\n\ninterface OrderFormProps {\n  onSuccess?: () => void;\n}\n\nexport default function OrderForm({ onSuccess }: OrderFormProps) {\n  const { toast } = useToast();\n  const { formatCurrency, symbol } = useCurrency();\n\n  const { data: products = [] } = useQuery({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: units = [] } = useQuery({\n    queryKey: [\"/api/units\"],\n  });\n\n  const form = useForm({\n    resolver: zodResolver(orderFormSchema),\n    defaultValues: {\n      customerName: \"\",\n      customerEmail: \"\",\n      customerPhone: \"\",\n      company: \"\",\n      totalAmount: \"\",\n      dueDate: \"\",\n      notes: \"\",\n      items: [{ productId: \"\", quantity: \"\", unitPrice: \"\", unitId: \"\" }], // Initialize with unitId\n    },\n  });\n\n  const { fields, append, remove } = useFieldArray({\n    control: form.control,\n    name: \"items\",\n  });\n\n  const mutation = useMutation({\n    mutationFn: async (data: any) => {\n      console.log(\"Order form data:\", data);\n\n      // Validate items\n      if (!data.items || data.items.length === 0) {\n        throw new Error(\"At least one item is required\");\n      }\n\n      const transformedData = {\n        customerName: data.customerName.trim(),\n        customerEmail:\n          data.customerEmail && data.customerEmail.trim()\n            ? data.customerEmail.trim()\n            : null,\n        customerPhone:\n          data.customerPhone && data.customerPhone.trim()\n            ? data.customerPhone.trim()\n            : null,\n        company:\n          data.company && data.company.trim() ? data.company.trim() : null,\n        totalAmount: data.totalAmount,\n        dueDate: data.dueDate || null,\n        notes: data.notes && data.notes.trim() ? data.notes.trim() : null,\n        status: \"pending\",\n        items: data.items.map((item: any) => {\n          const product = products.find((p: any) => p.id.toString() === item.productId);\n          return {\n            productId: item.productId,\n            quantity: item.quantity,\n            unitPrice: item.unitPrice,\n            unit: product?.unit || null,\n            unitId: item.unitId || product?.unitId || null, // Use the unitId from item or product\n          };\n        }),\n      };\n\n      console.log(\"Transformed order data:\", transformedData);\n      return apiRequest(\"POST\", \"/api/orders\", transformedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/dashboard/recent-orders\"],\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n      form.reset();\n      toast({\n        title: \"Success\",\n        description: \"Order created successfully\",\n      });\n      onSuccess?.();\n    },\n    onError: (error: any) => {\n      console.error(\"Order creation error:\", error);\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create order\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const calculateTotal = () => {\n    const items = form.getValues(\"items\");\n    const total = items.reduce((sum, item) => {\n      const quantity = parseFloat(item.quantity || \"0\");\n      const unitPrice = parseFloat(item.unitPrice || \"0\");\n      return sum + quantity * unitPrice;\n    }, 0);\n\n    form.setValue(\"totalAmount\", total.toFixed(2));\n  };\n\n  const updateItemPriceAndUnit = (index: number, productId: string) => {\n    const product = products.find((p: any) => p.id.toString() === productId);\n    if (product) {\n      form.setValue(`items.${index}.unitPrice`, product.price.toString());\n      form.setValue(`items.${index}.unitId`, product.unitId?.toString() || \"\"); // Set unitId from product\n      calculateTotal();\n    }\n  };\n\n  // Auto-calculate total and update unit when items change\n  const watchedItems = form.watch(\"items\");\n  React.useEffect(() => {\n    calculateTotal();\n  }, [watchedItems]);\n\n  return (\n    <Form {...form}>\n      <form\n        onSubmit={form.handleSubmit((data) => mutation.mutate(data))}\n        className=\"space-y-6\"\n      >\n        {/* Customer Information */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Customer Information</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"customerName\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Customer Name *</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Enter customer name\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"customerEmail\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"email\"\n                        placeholder=\"customer@example.com\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"customerPhone\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Phone</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Phone number\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"company\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Company (Optional)</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Company name\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </CardContent>\n        </Card>\n\n        {/* Order Items */}\n        <div className=\"overflow-x-auto rounded-lg border border-gray-200 shadow-sm\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50 text-sm font-semibold text-gray-700 uppercase tracking-wider\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Product\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Quantity\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Unit\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Unit Price ({symbol})\n                </th>\n                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Actions\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {fields.map((field, index) => (\n                <tr key={field.id}>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <FormField\n                      control={form.control}\n                      name={`items.${index}.productId`}\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Select\n                              onValueChange={(value) => {\n                                field.onChange(value);\n                                const product = products.find((p: any) => p.id.toString() === value);\n                                if (product) {\n                                  form.setValue(`items.${index}.unitPrice`, product.price.toString());\n                                  form.setValue(`items.${index}.unitId`, product.unitId?.toString() || \"\");\n                                  calculateTotal();\n                                }\n                              }}\n                              value={field.value}\n                            >\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"Select product\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {products.map((product: any) => (\n                                  <SelectItem\n                                    key={product.id}\n                                    value={product.id.toString()}\n                                  >\n                                    {product.name}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </td>\n\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <FormField\n                      control={form.control}\n                      name={`items.${index}.quantity`}\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              placeholder=\"1\"\n                              {...field}\n                              onChange={(e) => {\n                                field.onChange(e);\n                                calculateTotal();\n                              }}\n                              className=\"w-24\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </td>\n\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <FormField\n                      control={form.control}\n                      name={`items.${index}.unitId`}\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <div className=\"text-sm text-gray-600\">\n                              {(() => {\n                                const unitId = field.value;\n                                if (!unitId) return \"N/A\";\n                                const unit = units.find((u: any) => u.id.toString() === unitId.toString());\n                                return unit?.abbreviation || unit?.name || \"N/A\";\n                              })()}\n                            </div>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </td>\n\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <FormField\n                      control={form.control}\n                      name={`items.${index}.unitPrice`}\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              step=\"0.01\"\n                              placeholder=\"8.50\"\n                              {...field}\n                              onChange={(e) => {\n                                field.onChange(e);\n                                calculateTotal();\n                              }}\n                              className=\"w-24\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </td>\n\n                  <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2\">\n                    <Button\n                      type=\"button\"\n                      variant=\"destructive\"\n                      size=\"sm\"\n                      onClick={() => {\n                        remove(index);\n                        calculateTotal();\n                      }}\n                      disabled={fields.length === 1}\n                    >\n                      Remove\n                    </Button>\n                  </td>\n                </tr>\n              ))}\n\n              {/* Add Item Button Row */}\n              <tr>\n                <td colSpan={5} className=\"px-6 py-4 text-right\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() =>\n                      append({ productId: \"\", quantity: \"\", unitPrice: \"\", unitId: \"\" })\n                    }\n                  >\n                    Add Item\n                  </Button>\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n        {/* Order Summary */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Order Summary</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"totalAmount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Total Amount ({symbol})</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        {...field}\n                        readOnly\n                        className=\"bg-gray-50 font-semibold text-lg\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"dueDate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Due Date</FormLabel>\n                    <FormControl>\n                      <Input type=\"date\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"notes\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Notes</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      placeholder=\"Special instructions or requests...\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </CardContent>\n        </Card>\n\n        <div className=\"flex justify-end space-x-2\">\n          <Button type=\"button\" variant=\"outline\" onClick={onSuccess}>\n            Cancel\n          </Button>\n          <Button type=\"submit\" disabled={mutation.isPending}>\n            {mutation.isPending ? \"Creating...\" : \"Create Order\"}\n          </Button>\n        </div>\n      </form>\n    </Form>\n  );\n}","path":null,"size_bytes":17935,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\";\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\";\n\nimport { cn } from \"@/lib/utils\";\nimport { buttonVariants } from \"@/components/ui/button\";\n\nconst AlertDialog = AlertDialogPrimitive.Root;\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger;\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal;\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className,\n    )}\n    {...props}\n    ref={ref}\n  />\n));\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName;\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"bg-white  fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border  p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className,\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n));\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName;\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className,\n    )}\n    {...props}\n  />\n);\nAlertDialogHeader.displayName = \"AlertDialogHeader\";\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className,\n    )}\n    {...props}\n  />\n);\nAlertDialogFooter.displayName = \"AlertDialogFooter\";\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n));\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName;\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName;\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n));\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName;\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className,\n    )}\n    {...props}\n  />\n));\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName;\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n};\n","path":null,"size_bytes":4446,"size_tokens":null},"client/src/components/stats-grid.tsx":{"content":"interface StatsGridProps {\n  stats?: {\n    todaySales: number;\n    todayOrders: number;\n    productsInStock: number;\n    lowStockItems: number;\n    productionToday: number;\n  };\n}\n\nexport default function StatsGrid({ stats }: StatsGridProps) {\n  const statCards = [\n    {\n      title: \"Today's Sales\",\n      value: `$${(stats?.todaySales || 0).toFixed(2)}`,\n      change: \"+12% from yesterday\",\n      icon: \"fas fa-dollar-sign\",\n      bgColor: \"bg-green-100\",\n      iconColor: \"text-green-600\",\n      changeColor: \"text-green-600\"\n    },\n    {\n      title: \"Orders Today\",\n      value: stats?.todayOrders?.toString() || \"0\",\n      change: \"+8% from yesterday\",\n      icon: \"fas fa-shopping-bag\",\n      bgColor: \"bg-blue-100\",\n      iconColor: \"text-blue-600\",\n      changeColor: \"text-green-600\"\n    },\n    {\n      title: \"Products in Stock\",\n      value: stats?.productsInStock?.toString() || \"0\",\n      change: `${stats?.lowStockItems || 0} items low stock`,\n      icon: \"fas fa-boxes\",\n      bgColor: \"bg-orange-100\",\n      iconColor: \"text-orange-600\",\n      changeColor: stats?.lowStockItems ? \"text-orange-600\" : \"text-green-600\"\n    },\n    {\n      title: \"Production Today\",\n      value: stats?.productionToday?.toString() || \"0\",\n      change: \"items completed\",\n      icon: \"fas fa-industry\",\n      bgColor: \"bg-primary/20\",\n      iconColor: \"text-primary\",\n      changeColor: \"text-green-600\"\n    }\n  ];\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n      {statCards.map((card, index) => (\n        <div key={index} className=\"group bg-white rounded-2xl shadow-sm hover:shadow-xl p-6 border border-gray-100 transition-all duration-300 hover:-translate-y-1 cursor-pointer\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex-1\">\n              <p className=\"text-sm font-medium text-gray-500 mb-1\">{card.title}</p>\n              <p className=\"text-3xl font-bold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors\">{card.value}</p>\n              <p className={`text-sm font-medium ${card.changeColor} flex items-center`}>\n                {card.change?.includes('+') && <i className=\"fas fa-arrow-up mr-1\"></i>}\n                {card.change?.includes('-') && <i className=\"fas fa-arrow-down mr-1\"></i>}\n                {card.change}\n              </p>\n            </div>\n            <div className={`w-14 h-14 ${card.bgColor} rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300`}>\n              <i className={`${card.icon} ${card.iconColor} text-xl`}></i>\n            </div>\n          </div>\n          \n          {/* Progress bar indicator */}\n          <div className=\"mt-4 w-full bg-gray-100 rounded-full h-1\">\n            <div \n              className=\"bg-gradient-to-r from-blue-500 to-indigo-600 h-1 rounded-full transition-all duration-1000 ease-out\"\n              style={{ width: `${Math.min(Math.abs(parseFloat(card.change?.replace(/[^0-9.-]/g, '') || '0')), 100)}%` }}\n            ></div>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":3119,"size_tokens":null},"server/utils.ts":{"content":"\n// Server utility functions\nexport function sanitizeInput(input: string | undefined): string {\n  if (!input || typeof input !== 'string') return '';\n  \n  return input\n    .replace(/<script[^>]*>.*?<\\/script>/gi, '') // Remove script tags\n    .replace(/<[^>]*>/g, '') // Remove HTML tags\n    .replace(/javascript:/gi, '') // Remove javascript: URLs\n    .replace(/on\\w+\\s*=/gi, '') // Remove event handlers\n    .trim()\n    .substring(0, 1000); // Limit length to prevent overflow\n}\n\nexport function validateEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n}\n\nexport function validatePhone(phone: string): boolean {\n  const phoneRegex = /^\\+?[\\d\\s\\-\\(\\)]{10,}$/;\n  return phoneRegex.test(phone);\n}\n\nexport function generateSecureId(prefix: string = ''): string {\n  const timestamp = Date.now().toString(36);\n  const randomPart = Math.random().toString(36).substr(2, 9);\n  return `${prefix}${timestamp}${randomPart}`.toUpperCase();\n}\n\nexport function isValidDate(dateString: string): boolean {\n  const date = new Date(dateString);\n  return !isNaN(date.getTime());\n}\n\nexport function formatError(error: any): string {\n  if (error.message) return error.message;\n  if (typeof error === 'string') return error;\n  return 'An unexpected error occurred';\n}\n\nexport function logSecurityEvent(event: string, details: any) {\n  console.warn(`üö® SECURITY EVENT: ${event}`, {\n    timestamp: new Date().toISOString(),\n    ...details\n  });\n}\n","path":null,"size_bytes":1493,"size_tokens":null},"shared/schema.ts":{"content":"import { pgTable, serial, varchar, text, numeric, boolean, timestamp, integer, jsonb, date } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Branches table\nexport const branches = pgTable(\"branches\", {\n  id: serial(\"id\").primaryKey(),\n  branchCode: varchar(\"branch_code\", { length: 20 }).unique().notNull(),\n  name: varchar(\"name\", { length: 200 }).notNull(),\n  address: text(\"address\"),\n  phone: varchar(\"phone\", { length: 20 }),\n  email: varchar(\"email\", { length: 100 }),\n  managerName: varchar(\"manager_name\", { length: 100 }),\n  isHeadOffice: boolean(\"is_head_office\").default(false),\n  isActive: boolean(\"is_active\").default(true),\n  settings: jsonb(\"settings\"), // Branch-specific settings\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Users table\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey(),\n  email: varchar(\"email\", { length: 255 }).unique(),\n  password: varchar(\"password\", { length: 255 }),\n  firstName: varchar(\"first_name\", { length: 100 }),\n  lastName: varchar(\"last_name\", { length: 100 }),\n  profileImageUrl: varchar(\"profile_image_url\", { length: 500 }),\n  role: varchar(\"role\", { length: 20 }).notNull().default(\"staff\"), // super_admin, admin, manager, supervisor, marketer, staff\n  branchId: integer(\"branch_id\"), // Branch assignment\n  canAccessAllBranches: boolean(\"can_access_all_branches\").default(false), // For super admins and some admins\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Product Categories table\nexport const categories = pgTable(\"categories\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  description: text(\"description\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Products table\nexport const products = pgTable(\"products\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 200 }).notNull(),\n  description: text(\"description\"),\n  categoryId: integer(\"category_id\"),\n  price: numeric(\"price\", { precision: 10, scale: 2 }).notNull(),\n  cost: numeric(\"cost\", { precision: 10, scale: 2 }).notNull(),\n  margin: numeric(\"margin\", { precision: 5, scale: 2 }).notNull(),\n  netWeight: numeric(\"net_weight\", { precision: 10, scale: 2 }).default(\"0\"),\n  sku: varchar(\"sku\", { length: 50 }).unique(),\n  unit: varchar(\"unit\", { length: 50 }),\n  unitId: integer(\"unit_id\"),\n  branchId: integer(\"branch_id\"), // Branch-specific products\n  isGlobal: boolean(\"is_global\").default(false), // Available across all branches\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Inventory Categories\nexport const inventoryCategories = pgTable(\"inventory_categories\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  description: text(\"description\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Inventory Items table\nexport const inventoryItems = pgTable(\"inventory_items\", {\n  id: serial(\"id\").primaryKey(),\n  invCode: varchar(\"inv_code\", { length: 50 }).unique(),\n  name: varchar(\"name\", { length: 200 }).notNull(),\n  currentStock: numeric(\"current_stock\", { precision: 10, scale: 2 }).notNull(),\n  openingStock: numeric(\"opening_stock\", { precision: 10, scale: 2 }).default(\"0\"),\n  purchasedQuantity: numeric(\"purchased_quantity\", { precision: 10, scale: 2 }).default(\"0\"),\n  consumedQuantity: numeric(\"consumed_quantity\", { precision: 10, scale: 2 }).default(\"0\"),\n  closingStock: numeric(\"closing_stock\", { precision: 10, scale: 2 }).default(\"0\"),\n  minLevel: numeric(\"min_level\", { precision: 10, scale: 2 }).notNull(),\n  unit: varchar(\"unit\", { length: 50 }).notNull(),\n  unitId: integer(\"unit_id\"), // Primary unit ID\n  secondaryUnitId: integer(\"secondary_unit_id\"), // Secondary unit ID\n  conversionRate: numeric(\"conversion_rate\", { precision: 15, scale: 6 }).default(\"1\"), // How many primary units = 1 secondary unit\n  costPerUnit: numeric(\"cost_per_unit\", { precision: 10, scale: 2 }).notNull(),\n  supplier: varchar(\"supplier\", { length: 200 }),\n  categoryId: integer(\"category_id\"),\n  branchId: integer(\"branch_id\"), // Branch-specific inventory\n  isIngredient: boolean(\"is_ingredient\").default(false),\n  notes: text(\"notes\"),\n  lastRestocked: timestamp(\"last_restocked\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Product Ingredients table\nexport const productIngredients = pgTable(\"product_ingredients\", {\n  id: serial(\"id\").primaryKey(),\n  productId: integer(\"product_id\").notNull(),\n  inventoryItemId: integer(\"inventory_item_id\").notNull(),\n  quantity: numeric(\"quantity\", { precision: 10, scale: 2 }).notNull(),\n  unit: varchar(\"unit\", { length: 50 }).notNull(),\n  unitId: integer(\"unit_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Units table\nexport const units = pgTable(\"units\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 50 }).notNull().unique(),\n  abbreviation: varchar(\"abbreviation\", { length: 10 }).notNull(),\n  type: varchar(\"type\", { length: 20 }).notNull(),\n  baseUnit: varchar(\"base_unit\", { length: 100 }), // The base unit for conversion (e.g., 'gram' for weight)\n  conversionFactor: numeric(\"conversion_factor\", { precision: 15, scale: 6 }).default(\"1\"), // How many base units = 1 of this unit\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Unit Conversions table - for complex conversions between different unit types\nexport const unitConversions = pgTable(\"unit_conversions\", {\n  id: serial(\"id\").primaryKey(),\n  fromUnitId: integer(\"from_unit_id\").notNull(),\n  toUnitId: integer(\"to_unit_id\").notNull(),\n  conversionFactor: numeric(\"conversion_factor\", { precision: 15, scale: 6 }).notNull(),\n  formula: text(\"formula\"), // Optional formula for complex conversions\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Customers table\nexport const customers = pgTable(\"customers\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  email: varchar(\"email\", { length: 100 }),\n  phone: varchar(\"phone\", { length: 20 }),\n  address: text(\"address\"),\n  openingBalance: numeric(\"opening_balance\", { precision: 12, scale: 2 }).default(\"0\"),\n  currentBalance: numeric(\"current_balance\", { precision: 12, scale: 2 }).default(\"0\"),\n  totalOrders: integer(\"total_orders\").default(0),\n  totalSpent: numeric(\"total_spent\", { precision: 12, scale: 2 }).default(\"0\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Parties (Suppliers/Creditors) table\nexport const parties = pgTable(\"parties\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 200 }).notNull(),\n  type: varchar(\"type\", { length: 50 }).notNull(), // supplier, creditor, both\n  contactPerson: varchar(\"contact_person\", { length: 100 }),\n  email: varchar(\"email\", { length: 100 }),\n  phone: varchar(\"phone\", { length: 20 }),\n  address: text(\"address\"),\n  taxId: varchar(\"tax_id\", { length: 50 }),\n  notes: text(\"notes\"),\n  openingBalance: numeric(\"opening_balance\", { precision: 12, scale: 2 }).default(\"0\"),\n  currentBalance: numeric(\"current_balance\", { precision: 12, scale: 2 }).default(\"0\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Ledger Transactions table\nexport const ledgerTransactions = pgTable(\"ledger_transactions\", {\n  id: serial(\"id\").primaryKey(),\n  customerOrPartyId: integer(\"customer_or_party_id\").notNull(),\n  entityType: varchar(\"entity_type\", { length: 20 }).notNull(), // 'customer' or 'party'\n  transactionDate: timestamp(\"transaction_date\").notNull(),\n  description: text(\"description\").notNull(),\n  referenceNumber: varchar(\"reference_number\", { length: 100 }),\n  debitAmount: numeric(\"debit_amount\", { precision: 12, scale: 2 }).default(\"0\"),\n  creditAmount: numeric(\"credit_amount\", { precision: 12, scale: 2 }).default(\"0\"),\n  runningBalance: numeric(\"running_balance\", { precision: 12, scale: 2 }).notNull(),\n  transactionType: varchar(\"transaction_type\", { length: 50 }).notNull(), // 'sale', 'purchase', 'payment_received', 'payment_sent', 'adjustment'\n  relatedOrderId: integer(\"related_order_id\"),\n  relatedPurchaseId: integer(\"related_purchase_id\"),\n  paymentMethod: varchar(\"payment_method\", { length: 50 }),\n  notes: text(\"notes\"),\n  createdBy: varchar(\"created_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Orders table\nexport const orders = pgTable(\"orders\", {\n  id: serial(\"id\").primaryKey(),\n  customerName: varchar(\"customer_name\", { length: 200 }).notNull(),\n  customerId: integer(\"customer_id\"),\n  customerEmail: varchar(\"customer_email\", { length: 100 }),\n  customerPhone: varchar(\"customer_phone\", { length: 20 }),\n  totalAmount: numeric(\"total_amount\", { precision: 12, scale: 2 }).notNull(),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"pending\"),\n  paymentMethod: varchar(\"payment_method\", { length: 50 }).notNull(),\n  deliveryDate: timestamp(\"delivery_date\"),\n  branchId: integer(\"branch_id\"), // Branch where order was created\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Order Items table\nexport const orderItems = pgTable(\"order_items\", {\n  id: serial(\"id\").primaryKey(),\n  orderId: integer(\"order_id\").notNull(),\n  productId: integer(\"product_id\").notNull(),\n  quantity: integer(\"quantity\").notNull(),\n  unit: varchar(\"unit\", { length: 50 }), // Unit name/abbreviation\n  unitId: integer(\"unit_id\"), // Reference to units table\n  unitPrice: numeric(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  totalPrice: numeric(\"total_price\", { precision: 10, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Sales table\nexport const sales = pgTable(\"sales\", {\n  id: serial(\"id\").primaryKey(),\n  customerName: varchar(\"customer_name\", { length: 200 }).notNull(),\n  customerId: integer(\"customer_id\"),\n  customerEmail: varchar(\"customer_email\", { length: 100 }),\n  customerPhone: varchar(\"customer_phone\", { length: 20 }),\n  totalAmount: numeric(\"total_amount\", { precision: 12, scale: 2 }).notNull(),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"pending\"),\n  paymentMethod: varchar(\"payment_method\", { length: 50 }).notNull(),\n  saleDate: timestamp(\"sale_date\").defaultNow(),\n  branchId: integer(\"branch_id\"), // Branch where sale occurred\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Sale Items table\nexport const saleItems = pgTable(\"sale_items\", {\n  id: serial(\"id\").primaryKey(),\n  saleId: integer(\"sale_id\").notNull(),\n  productId: integer(\"product_id\").notNull(),\n  quantity: integer(\"quantity\").notNull(),\n  unit: varchar(\"unit\", { length: 50 }), // Unit name/abbreviation\n  unitId: integer(\"unit_id\"), // Reference to units table\n  unitPrice: numeric(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  totalPrice: numeric(\"total_price\", { precision: 10, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n\n// Purchases table\nexport const purchases = pgTable(\"purchases\", {\n  id: serial(\"id\").primaryKey(),\n  supplierName: varchar(\"supplier_name\", { length: 200 }).notNull(),\n  partyId: integer(\"party_id\"),\n  totalAmount: numeric(\"total_amount\", { precision: 12, scale: 2 }).notNull(),\n  paymentMethod: varchar(\"payment_method\", { length: 50 }).notNull(),\n  status: varchar(\"status\", { length: 50 }).notNull().default(\"pending\"),\n  purchaseDate: timestamp(\"purchase_date\").defaultNow(),\n  invoiceNumber: varchar(\"invoice_number\", { length: 100 }),\n  branchId: integer(\"branch_id\"), // Branch where purchase was made\n  notes: text(\"notes\"),\n  createdBy: varchar(\"created_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Purchase Items table\nexport const purchaseItems = pgTable(\"purchase_items\", {\n  id: serial(\"id\").primaryKey(),\n  purchaseId: integer(\"purchase_id\").notNull(),\n  inventoryItemId: integer(\"inventory_item_id\").notNull(),\n  quantity: numeric(\"quantity\", { precision: 10, scale: 2 }).notNull(),\n  unitPrice: numeric(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  totalPrice: numeric(\"total_price\", { precision: 10, scale: 2 }).notNull(),\n  unitId: integer(\"unit_id\"), // Reference to units table\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Enhanced Production Schedule table\nexport const productionSchedule = pgTable(\"production_schedule\", {\n  id: serial(\"id\").primaryKey(),\n\n  // Schedule Information\n  scheduleDate: date(\"schedule_date\").notNull(),\n  shift: varchar(\"shift\", { length: 20 }).default(\"Morning\"), // Morning, Afternoon, Night\n  plannedBy: varchar(\"planned_by\", { length: 100 }),\n  approvedBy: varchar(\"approved_by\", { length: 100 }),\n  status: varchar(\"status\", { length: 50 }).default(\"draft\").notNull(), // draft, scheduled, in_progress, completed, cancelled\n  branchId: integer(\"branch_id\"), // Branch where production is scheduled\n\n  // Product Details\n  productId: integer(\"product_id\").references(() => products.id).notNull(),\n  productCode: varchar(\"product_code\", { length: 50 }),\n  batchNo: varchar(\"batch_no\", { length: 50 }),\n\n  // Quantities\n  totalQuantity: numeric(\"total_quantity\", { precision: 10, scale: 2 }).notNull(),\n  unitType: varchar(\"unit_type\", { length: 50 }).default(\"kg\"),\n  actualQuantityPackets: numeric(\"actual_quantity_packets\", { precision: 10, scale: 2 }),\n\n  // Production Details\n  priority: varchar(\"priority\", { length: 20 }).default(\"medium\"), // high, medium, low\n  productionStartTime: timestamp(\"production_start_time\"),\n  productionEndTime: timestamp(\"production_end_time\"),\n  assignedTo: varchar(\"assigned_to\").references(() => users.id),\n  notes: text(\"notes\"),\n\n  // Legacy fields for compatibility\n  quantity: numeric(\"quantity\", { precision: 10, scale: 2 }).notNull(),\n  actualQuantity: numeric(\"actual_quantity\", { precision: 10, scale: 2 }),\n  scheduledDate: date(\"scheduled_date\").notNull(),\n  startTime: timestamp(\"start_time\"),\n  endTime: timestamp(\"end_time\"),\n\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Production Schedule History table\nexport const productionScheduleHistory = pgTable(\"production_schedule_history\", {\n  id: serial(\"id\").primaryKey(),\n  originalScheduleId: integer(\"original_schedule_id\"),\n  productId: integer(\"product_id\").notNull(),\n  productName: varchar(\"product_name\", { length: 200 }),\n  productCode: varchar(\"product_code\", { length: 50 }),\n  batchNo: varchar(\"batch_no\", { length: 50 }),\n  totalQuantity: numeric(\"total_quantity\", { precision: 10, scale: 2 }),\n  unitType: varchar(\"unit_type\", { length: 50 }),\n  actualQuantityPackets: numeric(\"actual_quantity_packets\", { precision: 10, scale: 2 }),\n  priority: varchar(\"priority\", { length: 20 }),\n  productionStartTime: timestamp(\"production_start_time\"),\n  productionEndTime: timestamp(\"production_end_time\"),\n  assignedTo: varchar(\"assigned_to\"),\n  notes: text(\"notes\"),\n  status: varchar(\"status\", { length: 50 }),\n  scheduleDate: date(\"schedule_date\"),\n  shift: varchar(\"shift\", { length: 20 }),\n  plannedBy: varchar(\"planned_by\", { length: 100 }),\n  approvedBy: varchar(\"approved_by\", { length: 100 }),\n  closedAt: timestamp(\"closed_at\").defaultNow(),\n  closedBy: varchar(\"closed_by\", { length: 100 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Inventory Transactions table\nexport const inventoryTransactions = pgTable(\"inventory_transactions\", {\n  id: serial(\"id\").primaryKey(),\n  inventoryItemId: integer(\"inventory_item_id\").notNull(),\n  type: varchar(\"type\", { length: 50 }).notNull(), // in, out, adjustment\n  quantity: numeric(\"quantity\", { precision: 10, scale: 2 }).notNull(),\n  reason: varchar(\"reason\", { length: 200 }),\n  reference: varchar(\"reference\", { length: 100 }),\n  createdBy: varchar(\"created_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Expenses table\nexport const expenses = pgTable(\"expenses\", {\n  id: serial(\"id\").primaryKey(),\n  description: text(\"description\").notNull(),\n  amount: numeric(\"amount\", { precision: 12, scale: 2 }).notNull(),\n  category: varchar(\"category\", { length: 100 }).notNull(),\n  date: timestamp(\"date\").notNull(),\n  paymentMethod: varchar(\"payment_method\", { length: 50 }).notNull(),\n  vendor: varchar(\"vendor\", { length: 200 }),\n  receipt: varchar(\"receipt\", { length: 500 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Assets table\nexport const assets = pgTable(\"assets\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  category: varchar(\"category\", { length: 50 }).notNull(),\n  purchaseDate: timestamp(\"purchase_date\"),\n  purchasePrice: numeric(\"purchase_price\", { precision: 12, scale: 2 }),\n  currentValue: numeric(\"current_value\", { precision: 12, scale: 2 }),\n  description: text(\"description\"),\n  location: varchar(\"location\", { length: 100 }),\n  condition: varchar(\"condition\", { length: 50 }).default(\"good\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Permissions table\nexport const permissions = pgTable(\"permissions\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 100 }).notNull().unique(),\n  resource: varchar(\"resource\", { length: 100 }).notNull(), // e.g., 'products', 'orders', 'dashboard'\n  action: varchar(\"action\", { length: 50 }).notNull(), // 'read', 'write', 'read_write'\n  description: text(\"description\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Role Permissions table\nexport const rolePermissions = pgTable(\"role_permissions\", {\n  id: serial(\"id\").primaryKey(),\n  role: varchar(\"role\", { length: 20 }).notNull(),\n  permissionId: integer(\"permission_id\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User Permissions table (for individual user overrides)\nexport const userPermissions = pgTable(\"user_permissions\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull(),\n  permissionId: integer(\"permission_id\").notNull(),\n  granted: boolean(\"granted\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Settings table\nexport const settings = pgTable(\"settings\", {\n  id: serial(\"id\").primaryKey(),\n  key: varchar(\"key\", { length: 100 }).notNull().unique(),\n  value: text(\"value\").notNull(),\n  type: varchar(\"type\", { length: 50 }).notNull().default(\"string\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Sessions table\nexport const sessions = pgTable(\"sessions\", {\n  sid: varchar(\"sid\").primaryKey(),\n  sess: jsonb(\"sess\").notNull(),\n  expire: timestamp(\"expire\").notNull(),\n});\n\n// Login logs table for tracking user authentication\nexport const loginLogs = pgTable(\"login_logs\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull(),\n  email: varchar(\"email\", { length: 255 }).notNull(),\n  ipAddress: varchar(\"ip_address\", { length: 45 }).notNull(),\n  userAgent: text(\"user_agent\"),\n  status: varchar(\"status\", { length: 20 }).notNull(), // 'success' or 'failed'\n  loginTime: timestamp(\"login_time\").defaultNow(),\n  location: varchar(\"location\", { length: 200 }),\n  deviceType: varchar(\"device_type\", { length: 50 }),\n});\n\n// Audit logs table for tracking all user actions\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull(),\n  userEmail: varchar(\"user_email\", { length: 255 }).notNull(),\n  userName: varchar(\"user_name\", { length: 200 }).notNull(),\n  action: varchar(\"action\", { length: 100 }).notNull(), // 'CREATE', 'UPDATE', 'DELETE', 'LOGIN', 'LOGOUT', etc.\n  resource: varchar(\"resource\", { length: 100 }).notNull(), // 'staff', 'product', 'order', 'settings', etc.\n  resourceId: varchar(\"resource_id\", { length: 100 }), // ID of the affected resource\n  details: jsonb(\"details\"), // Additional details about the action\n  oldValues: jsonb(\"old_values\"), // Previous values (for updates)\n  newValues: jsonb(\"new_values\"), // New values (for creates/updates)\n  ipAddress: varchar(\"ip_address\", { length: 45 }).notNull(),\n  userAgent: text(\"user_agent\"),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n  status: varchar(\"status\", { length: 20 }).default(\"success\"), // 'success', 'failed', 'error'\n  errorMessage: text(\"error_message\"),\n});\n\n// Sales Returns table\nexport const salesReturns = pgTable(\"sales_returns\", {\n  id: serial(\"id\").primaryKey(),\n  serialNumber: integer(\"serial_number\").notNull(), // Daily auto-incremented S.N\n  productId: integer(\"product_id\").notNull(),\n  productName: varchar(\"product_name\", { length: 200 }).notNull(),\n  quantity: numeric(\"quantity\", { precision: 10, scale: 2 }).notNull(),\n  unitId: integer(\"unit_id\").notNull(),\n  unitName: varchar(\"unit_name\", { length: 50 }).notNull(),\n  ratePerUnit: numeric(\"rate_per_unit\", { precision: 10, scale: 2 }).notNull(),\n  amount: numeric(\"amount\", { precision: 12, scale: 2 }).notNull(), // quantity √ó rate\n  returnDate: date(\"return_date\").notNull(), // Date when return was recorded\n  saleId: integer(\"sale_id\"), // Reference to original sale (optional)\n  customerId: integer(\"customer_id\"), // Reference to customer who returned\n  returnReason: varchar(\"return_reason\", { length: 100 }).default(\"damaged\"), // damaged, expired, wrong_product, customer_request\n  isDayClosed: boolean(\"is_day_closed\").default(false),\n  branchId: integer(\"branch_id\"),\n  notes: text(\"notes\"),\n  createdBy: varchar(\"created_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Daily Sales Return Summary table\nexport const dailySalesReturnSummary = pgTable(\"daily_sales_return_summary\", {\n  id: serial(\"id\").primaryKey(),\n  summaryDate: date(\"summary_date\").notNull(),\n  totalItems: integer(\"total_items\").notNull(),\n  totalQuantity: numeric(\"total_quantity\", { precision: 10, scale: 2 }).notNull(),\n  totalLoss: numeric(\"total_loss\", { precision: 12, scale: 2 }).notNull(),\n  isDayClosed: boolean(\"is_day_closed\").default(false),\n  closedBy: varchar(\"closed_by\"),\n  closedAt: timestamp(\"closed_at\"),\n  branchId: integer(\"branch_id\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Purchase Returns table\nexport const purchaseReturns = pgTable(\"purchase_returns\", {\n  id: serial(\"id\").primaryKey(),\n  serialNumber: integer(\"serial_number\").notNull(), // Daily auto-incremented S.N\n  inventoryItemId: integer(\"inventory_item_id\").notNull(),\n  inventoryItemName: varchar(\"inventory_item_name\", { length: 200 }).notNull(),\n  quantity: numeric(\"quantity\", { precision: 10, scale: 2 }).notNull(),\n  unitId: integer(\"unit_id\").notNull(),\n  unitName: varchar(\"unit_name\", { length: 50 }).notNull(),\n  ratePerUnit: numeric(\"rate_per_unit\", { precision: 10, scale: 2 }).notNull(),\n  amount: numeric(\"amount\", { precision: 12, scale: 2 }).notNull(), // quantity √ó rate\n  returnDate: date(\"return_date\").notNull(), // Date when return was recorded\n  purchaseId: integer(\"purchase_id\"), // Reference to original purchase (optional)\n  partyId: integer(\"party_id\"), // Reference to supplier/party\n  returnReason: varchar(\"return_reason\", { length: 100 }).default(\"damaged\"), // damaged, expired, wrong_item, quality_issue\n  isDayClosed: boolean(\"is_day_closed\").default(false),\n  branchId: integer(\"branch_id\"),\n  notes: text(\"notes\"),\n  createdBy: varchar(\"created_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Daily Purchase Return Summary table\nexport const dailyPurchaseReturnSummary = pgTable(\"daily_purchase_return_summary\", {\n  id: serial(\"id\").primaryKey(),\n  summaryDate: date(\"summary_date\").notNull(),\n  totalItems: integer(\"total_items\").notNull(),\n  totalQuantity: numeric(\"total_quantity\", { precision: 10, scale: 2 }).notNull(),\n  totalLoss: numeric(\"total_loss\", { precision: 12, scale: 2 }).notNull(),\n  isDayClosed: boolean(\"is_day_closed\").default(false),\n  closedBy: varchar(\"closed_by\"),\n  closedAt: timestamp(\"closed_at\"),\n  branchId: integer(\"branch_id\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Staff management tables\nexport const staff = pgTable(\"staff\", {\n  id: serial(\"id\").primaryKey(),\n  staffId: varchar(\"staff_id\", { length: 50 }).unique().notNull(),\n  firstName: varchar(\"first_name\", { length: 100 }).notNull(),\n  lastName: varchar(\"last_name\", { length: 100 }).notNull(),\n  email: varchar(\"email\", { length: 255 }).unique(),\n  phone: varchar(\"phone\", { length: 20 }),\n  address: text(\"address\"),\n  dateOfBirth: timestamp(\"date_of_birth\"),\n  hireDate: timestamp(\"hire_date\").notNull(),\n  position: varchar(\"position\", { length: 100 }).notNull(),\n  department: varchar(\"department\", { length: 100 }).notNull(),\n  employmentType: varchar(\"employment_type\", { length: 50 }).notNull(), // full-time, part-time, contract\n  salary: numeric(\"salary\", { precision: 12, scale: 2 }),\n  hourlyRate: numeric(\"hourly_rate\", { precision: 8, scale: 2 }),\n  bankAccount: varchar(\"bank_account\", { length: 100 }),\n  emergencyContact: varchar(\"emergency_contact\", { length: 200 }),\n  emergencyPhone: varchar(\"emergency_phone\", { length: 20 }),\n  citizenshipNumber: varchar(\"citizenship_number\", { length: 50 }),\n  panNumber: varchar(\"pan_number\", { length: 50 }),\n  profilePhoto: varchar(\"profile_photo\", { length: 500 }),\n  identityCardUrl: varchar(\"identity_card_url\", { length: 500 }),\n  agreementPaperUrl: varchar(\"agreement_paper_url\", { length: 500 }),\n  documents: jsonb(\"documents\"), // Store document URLs/paths\n  status: varchar(\"status\", { length: 20 }).default(\"active\"), // active, inactive, terminated\n  terminationDate: timestamp(\"termination_date\"),\n  terminationReason: text(\"termination_reason\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const attendance = pgTable(\"attendance\", {\n  id: serial(\"id\").primaryKey(),\n  staffId: integer(\"staff_id\").notNull(),\n  date: timestamp(\"date\").notNull(),\n  clockIn: timestamp(\"clock_in\"),\n  clockOut: timestamp(\"clock_out\"),\n  breakStart: timestamp(\"break_start\"),\n  breakEnd: timestamp(\"break_end\"),\n  totalHours: numeric(\"total_hours\", { precision: 4, scale: 2 }),\n  overtimeHours: numeric(\"overtime_hours\", { precision: 4, scale: 2 }),\n  status: varchar(\"status\", { length: 20 }).default(\"present\"), // present, absent, late, half-day, sick, vacation\n  notes: text(\"notes\"),\n  approvedBy: varchar(\"approved_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const salaryPayments = pgTable(\"salary_payments\", {\n  id: serial(\"id\").primaryKey(),\n  staffId: integer(\"staff_id\").notNull(),\n  payPeriodStart: timestamp(\"pay_period_start\").notNull(),\n  payPeriodEnd: timestamp(\"pay_period_end\").notNull(),\n  basicSalary: numeric(\"basic_salary\", { precision: 12, scale: 2 }).notNull(),\n  overtimePay: numeric(\"overtime_pay\", { precision: 12, scale: 2 }).default(\"0\"),\n  bonus: numeric(\"bonus\", { precision: 12, scale: 2 }).default(\"0\"),\n  allowances: numeric(\"allowances\", { precision: 12, scale: 2 }).default(\"0\"),\n  deductions: numeric(\"deductions\", { precision: 12, scale: 2 }).default(\"0\"),\n  tax: numeric(\"tax\", { precision: 12, scale: 2 }).default(\"0\"),\n  netPay: numeric(\"net_pay\", { precision: 12, scale: 2 }).notNull(),\n  paymentDate: timestamp(\"payment_date\"),\n  paymentMethod: varchar(\"payment_method\", { length: 50 }).default(\"bank_transfer\"),\n  status: varchar(\"status\", { length: 20 }).default(\"pending\"), // pending, paid, cancelled\n  notes: text(\"notes\"),\n  processedBy: varchar(\"processed_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const leaveRequests = pgTable(\"leave_requests\", {\n  id: serial(\"id\").primaryKey(),\n  staffId: integer(\"staff_id\").notNull(),\n  leaveType: varchar(\"leave_type\", { length: 50 }).notNull(), // sick, vacation, personal, maternity, etc.\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\").notNull(),\n  totalDays: integer(\"total_days\").notNull(),\n  reason: text(\"reason\").notNull(),\n  status: varchar(\"status\", { length: 20 }).default(\"pending\"), // pending, approved, rejected\n  appliedDate: timestamp(\"applied_date\").defaultNow(),\n  reviewedBy: varchar(\"reviewed_by\"),\n  reviewedDate: timestamp(\"reviewed_date\"),\n  reviewComments: text(\"review_comments\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const staffSchedules = pgTable(\"staff_schedules\", {\n  id: serial(\"id\").primaryKey(),\n  staffId: integer(\"staff_id\").notNull(),\n  date: timestamp(\"date\").notNull(),\n  shiftStart: timestamp(\"shift_start\").notNull(),\n  shiftEnd: timestamp(\"shift_end\").notNull(),\n  position: varchar(\"position\", { length: 100 }),\n  department: varchar(\"department\", { length: 100 }),\n  isRecurring: boolean(\"is_recurring\").default(false),\n  recurringPattern: varchar(\"recurring_pattern\", { length: 50 }), // daily, weekly, monthly\n  notes: text(\"notes\"),\n  createdBy: varchar(\"created_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Production Schedule Labels table\nexport const productionScheduleLabels = pgTable(\"production_schedule_labels\", {\n  id: serial(\"id\").primaryKey(),\n\n  // Order Information\n  orderId: integer(\"order_id\"),\n  orderNumber: varchar(\"order_number\", { length: 100 }),\n  customerName: varchar(\"customer_name\", { length: 200 }),\n  orderDate: timestamp(\"order_date\"),\n\n  // Product Details\n  productId: integer(\"product_id\"),\n  productSku: varchar(\"product_sku\", { length: 50 }),\n  productName: varchar(\"product_name\", { length: 200 }).notNull(),\n  productDescription: text(\"product_description\"),\n\n  // Target Quantities\n  targetedQuantity: numeric(\"targeted_quantity\", { precision: 10, scale: 2 }).notNull(),\n  unit: varchar(\"unit\", { length: 50 }),\n  unitId: integer(\"unit_id\"),\n\n  // Actual Production Data\n  actualQuantity: numeric(\"actual_quantity\", { precision: 10, scale: 2 }),\n  startDatetime: timestamp(\"start_datetime\"),\n  endDatetime: timestamp(\"end_datetime\"),\n\n  // Labeling and Packaging\n  batchNumber: varchar(\"batch_number\", { length: 100 }),\n  expiryDate: date(\"expiry_date\"),\n  weightVolume: varchar(\"weight_volume\", { length: 100 }),\n  packagingType: varchar(\"packaging_type\", { length: 100 }),\n\n  // Production Status and Tracking\n  status: varchar(\"status\", { length: 50 }).default(\"draft\"), // draft, in_progress, completed, cancelled\n  priority: varchar(\"priority\", { length: 20 }).default(\"normal\"), // low, normal, high, urgent\n  assignedTo: varchar(\"assigned_to\", { length: 100 }),\n  shift: varchar(\"shift\", { length: 50 }),\n\n  // Quality Control\n  qualityCheckPassed: boolean(\"quality_check_passed\").default(false),\n  qualityNotes: text(\"quality_notes\"),\n\n  // Draft/Day-end functionality\n  isDraft: boolean(\"is_draft\").default(true),\n  dayClosed: boolean(\"day_closed\").default(false),\n  dayClosedAt: timestamp(\"day_closed_at\"),\n  dayClosedBy: varchar(\"day_closed_by\", { length: 100 }),\n\n  // Additional Information\n  remarks: text(\"remarks\"),\n  notes: text(\"notes\"),\n  specialInstructions: text(\"special_instructions\"),\n\n  // Audit Trail\n  createdBy: varchar(\"created_by\", { length: 100 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedBy: varchar(\"updated_by\", { length: 100 }),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Stock Batches table - For FIFO batch tracking\nexport const stockBatches = pgTable(\"stock_batches\", {\n  id: serial(\"id\").primaryKey(),\n  purchaseItemId: integer(\"purchase_item_id\").notNull(), // Reference to purchase_items\n  inventoryItemId: integer(\"inventory_item_id\").notNull(), // Reference to inventory_items\n  batchNumber: varchar(\"batch_number\", { length: 100 }), // Supplier batch number\n  quantityReceived: numeric(\"quantity_received\", { precision: 10, scale: 2 }).notNull(),\n  remainingQuantity: numeric(\"remaining_quantity\", { precision: 10, scale: 2 }).notNull(),\n  unitCost: numeric(\"unit_cost\", { precision: 10, scale: 2 }).notNull(), // Cost per unit at purchase\n  expiryDate: date(\"expiry_date\"), // Optional expiry tracking\n  receivedDate: timestamp(\"received_date\").defaultNow(),\n  supplierId: integer(\"supplier_id\"), // Reference to parties table\n  branchId: integer(\"branch_id\"), // Branch where batch is stored\n  isActive: boolean(\"is_active\").default(true),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Stock Batch Consumptions table - Track FIFO consumption in production\nexport const stockBatchConsumptions = pgTable(\"stock_batch_consumptions\", {\n  id: serial(\"id\").primaryKey(),\n  stockBatchId: integer(\"stock_batch_id\").notNull(), // Reference to stock_batches\n  productionScheduleId: integer(\"production_schedule_id\"), // Reference to production_schedule\n  inventoryTransactionId: integer(\"inventory_transaction_id\"), // Reference to inventory_transactions\n  quantityConsumed: numeric(\"quantity_consumed\", { precision: 10, scale: 2 }).notNull(),\n  unitCostAtConsumption: numeric(\"unit_cost_at_consumption\", { precision: 10, scale: 2 }).notNull(),\n  totalCost: numeric(\"total_cost\", { precision: 10, scale: 2 }).notNull(),\n  consumedDate: timestamp(\"consumed_date\").defaultNow(),\n  consumedBy: varchar(\"consumed_by\"), // User who processed the consumption\n  reason: varchar(\"reason\", { length: 100 }), // production, adjustment, sale, etc.\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Daily Inventory Snapshots table - Immutable daily stock snapshots\nexport const dailyInventorySnapshots = pgTable(\"daily_inventory_snapshots\", {\n  id: serial(\"id\").primaryKey(),\n  snapshotDate: date(\"snapshot_date\").notNull(),\n  inventoryItemId: integer(\"inventory_item_id\").notNull(),\n  branchId: integer(\"branch_id\"),\n  openingStock: numeric(\"opening_stock\", { precision: 10, scale: 2 }).notNull(),\n  purchasedQuantity: numeric(\"purchased_quantity\", { precision: 10, scale: 2 }).default(\"0\"),\n  consumedQuantity: numeric(\"consumed_quantity\", { precision: 10, scale: 2 }).default(\"0\"),\n  adjustmentQuantity: numeric(\"adjustment_quantity\", { precision: 10, scale: 2 }).default(\"0\"),\n  closingStock: numeric(\"closing_stock\", { precision: 10, scale: 2 }).notNull(),\n  averageCost: numeric(\"average_cost\", { precision: 10, scale: 2 }).notNull(),\n  lastPurchaseCost: numeric(\"last_purchase_cost\", { precision: 10, scale: 2 }),\n  totalValue: numeric(\"total_value\", { precision: 12, scale: 2 }).notNull(),\n  activeBatches: integer(\"active_batches\").default(0), // Number of active batches\n  isLocked: boolean(\"is_locked\").default(false), // Prevent modifications once day is closed\n  capturedAt: timestamp(\"captured_at\").defaultNow(),\n  capturedBy: varchar(\"captured_by\"), // User who captured the snapshot\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Inventory Cost History table - Track cost changes over time\nexport const inventoryCostHistory = pgTable(\"inventory_cost_history\", {\n  id: serial(\"id\").primaryKey(),\n  inventoryItemId: integer(\"inventory_item_id\").notNull(),\n  branchId: integer(\"branch_id\"),\n  previousCost: numeric(\"previous_cost\", { precision: 10, scale: 2 }),\n  newCost: numeric(\"new_cost\", { precision: 10, scale: 2 }).notNull(),\n  previousAverageCost: numeric(\"previous_average_cost\", { precision: 10, scale: 2 }),\n  newAverageCost: numeric(\"new_average_cost\", { precision: 10, scale: 2 }).notNull(),\n  changeReason: varchar(\"change_reason\", { length: 100 }).notNull(), // purchase, adjustment, revaluation\n  referenceId: integer(\"reference_id\"), // ID of purchase, adjustment, etc.\n  referenceType: varchar(\"reference_type\", { length: 50 }), // purchase_item, inventory_transaction, etc.\n  changeDate: timestamp(\"change_date\").defaultNow(),\n  changedBy: varchar(\"changed_by\"), // User who caused the cost change\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Role Modules table - Store which modules each role has access to\nexport const roleModules = pgTable(\"role_modules\", {\n  id: serial(\"id\").primaryKey(),\n  role: varchar(\"role\", { length: 50 }).notNull(),\n  moduleId: varchar(\"module_id\", { length: 100 }).notNull(),\n  granted: boolean(\"granted\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// User Module Overrides table - Individual user module access overrides\nexport const userModuleOverrides = pgTable(\"user_module_overrides\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\", { length: 255 }).notNull(),\n  moduleId: varchar(\"module_id\", { length: 100 }).notNull(),\n  granted: boolean(\"granted\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Printed Labels table\nexport const printedLabels = pgTable(\"printed_labels\", {\n  id: serial(\"id\").primaryKey(),\n  productId: integer(\"product_id\").notNull(),\n  mfdDate: date(\"mfd_date\").notNull(),\n  expDate: date(\"exp_date\").notNull(),\n  noOfCopies: integer(\"no_of_copies\").notNull(),\n  printedDate: timestamp(\"printed_date\").defaultNow(),\n  printedBy: varchar(\"printed_by\", { length: 100 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Type definitions\nexport type Branch = typeof branches.$inferSelect;\nexport type InsertBranch = typeof branches.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type UpsertUser = typeof users.$inferInsert;\nexport type Product = typeof products.$inferSelect;\nexport type InsertProduct = typeof products.$inferInsert;\nexport type Category = typeof categories.$inferSelect;\nexport type InsertCategory = typeof categories.$inferInsert;\nexport type InventoryCategory = typeof inventoryCategories.$inferSelect;\nexport type InsertInventoryCategory = typeof inventoryCategories.$inferInsert;\nexport type InventoryItem = typeof inventoryItems.$inferSelect;\nexport type InsertInventoryItem = typeof inventoryItems.$inferInsert;\nexport type ProductIngredient = typeof productIngredients.$inferSelect;\nexport type InsertProductIngredient = typeof productIngredients.$inferInsert;\nexport type Unit = typeof units.$inferSelect;\nexport type InsertUnit = typeof units.$inferInsert;\nexport type UnitConversion = typeof unitConversions.$inferSelect;\nexport type InsertUnitConversion = typeof unitConversions.$inferInsert;\nexport type Customer = typeof customers.$inferSelect;\nexport type InsertCustomer = typeof customers.$inferInsert;\nexport type Party = typeof parties.$inferSelect;\nexport type InsertParty = typeof parties.$inferInsert;\nexport type Order = typeof orders.$inferSelect;\nexport type InsertOrder = typeof orders.$inferInsert;\nexport type OrderItem = typeof orderItems.$inferSelect;\nexport type InsertOrderItem = typeof orderItems.$inferInsert;\nexport type Sale = typeof sales.$inferSelect;\nexport type InsertSale = typeof sales.$inferInsert;\nexport type SaleItem = typeof saleItems.$inferSelect;\nexport type InsertSaleItem = typeof saleItems.$inferInsert;\nexport type Purchase = typeof purchases.$inferSelect;\nexport type InsertPurchase = typeof purchases.$inferInsert;\nexport type PurchaseItem = typeof purchaseItems.$inferSelect;\nexport type InsertPurchaseItem = typeof purchaseItems.$inferInsert;\nexport type ProductionScheduleItem = typeof productionSchedule.$inferSelect;\nexport type InsertProductionScheduleItem = typeof productionSchedule.$inferInsert;\nexport type ProductionScheduleHistoryItem = typeof productionScheduleHistory.$inferSelect;\nexport type InsertProductionScheduleHistoryItem = typeof productionScheduleHistory.$inferInsert;\nexport type InventoryTransaction = typeof inventoryTransactions.$inferSelect;\nexport type InsertInventoryTransaction = typeof inventoryTransactions.$inferInsert;\nexport type Expense = typeof expenses.$inferSelect;\nexport type InsertExpense = typeof expenses.$inferInsert;\nexport type Asset = typeof assets.$inferSelect;\nexport type InsertAsset = typeof assets.$inferInsert;\nexport type Permission = typeof permissions.$inferSelect;\nexport type InsertPermission = typeof permissions.$inferInsert;\nexport type RolePermission = typeof rolePermissions.$inferSelect;\nexport type InsertRolePermission = typeof rolePermissions.$inferInsert;\nexport type UserPermission = typeof userPermissions.$inferSelect;\nexport type InsertUserPermission = typeof userPermissions.$inferInsert;\nexport type LedgerTransaction = typeof ledgerTransactions.$inferSelect;\nexport type InsertLedgerTransaction = typeof ledgerTransactions.$inferInsert;\nexport type LoginLog = typeof loginLogs.$inferSelect;\nexport type InsertLoginLog = typeof loginLogs.$inferInsert;\nexport type AuditLog = typeof auditLogs.$inferSelect;\nexport type InsertAuditLog = typeof auditLogs.$inferInsert;\nexport type Staff = typeof staff.$inferSelect;\nexport type InsertStaff = typeof staff.$inferInsert;\nexport type Attendance = typeof attendance.$inferSelect;\nexport type InsertAttendance = typeof attendance.$inferInsert;\nexport type SalaryPayment = typeof salaryPayments.$inferSelect;\nexport type InsertSalaryPayment = typeof salaryPayments.$inferInsert;\nexport type LeaveRequest = typeof leaveRequests.$inferSelect;\nexport type InsertLeaveRequest = typeof leaveRequests.$inferInsert;\nexport type StaffSchedule = typeof staffSchedules.$inferSelect;\nexport type InsertStaffSchedule = typeof staffSchedules.$inferInsert;\nexport type ProductionScheduleLabel = typeof productionScheduleLabels.$inferSelect;\nexport type InsertProductionScheduleLabel = typeof productionScheduleLabels.$inferInsert;\nexport type SalesReturn = typeof salesReturns.$inferSelect;\nexport type InsertSalesReturn = typeof salesReturns.$inferInsert;\nexport type DailySalesReturnSummary = typeof dailySalesReturnSummary.$inferSelect;\nexport type InsertDailySalesReturnSummary = typeof dailySalesReturnSummary.$inferInsert;\nexport type PurchaseReturn = typeof purchaseReturns.$inferSelect;\nexport type InsertPurchaseReturn = typeof purchaseReturns.$inferInsert;\nexport type DailyPurchaseReturnSummary = typeof dailyPurchaseReturnSummary.$inferSelect;\nexport type InsertDailyPurchaseReturnSummary = typeof dailyPurchaseReturnSummary.$inferInsert;\nexport type StockBatch = typeof stockBatches.$inferSelect;\nexport type InsertStockBatch = typeof stockBatches.$inferInsert;\nexport type StockBatchConsumption = typeof stockBatchConsumptions.$inferSelect;\nexport type InsertStockBatchConsumption = typeof stockBatchConsumptions.$inferInsert;\nexport type DailyInventorySnapshot = typeof dailyInventorySnapshots.$inferSelect;\nexport type InsertDailyInventorySnapshot = typeof dailyInventorySnapshots.$inferInsert;\nexport type InventoryCostHistory = typeof inventoryCostHistory.$inferSelect;\nexport type InsertInventoryCostHistory = typeof inventoryCostHistory.$inferInsert;\nexport type RoleModule = typeof roleModules.$inferSelect;\nexport type InsertRoleModule = typeof roleModules.$inferInsert;\nexport type UserModuleOverride = typeof userModuleOverrides.$inferSelect;\nexport type InsertUserModuleOverride = typeof userModuleOverrides.$inferInsert;\n\n// Insert schemas for validation\nexport const insertBranchSchema = createInsertSchema(branches).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true\n});\n\nexport const insertProductSchema = createInsertSchema(products).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCategorySchema = createInsertSchema(categories).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCustomerSchema = createInsertSchema(customers).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPurchaseSchema = createInsertSchema(purchases).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertExpenseSchema = createInsertSchema(expenses).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPermissionSchema = createInsertSchema(permissions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertRolePermissionSchema = createInsertSchema(rolePermissions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserPermissionSchema = createInsertSchema(userPermissions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertLedgerTransactionSchema = createInsertSchema(ledgerTransactions).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertLoginLogSchema = createInsertSchema(loginLogs).omit({\n  id: true,\n  loginTime: true,\n});\n\nexport const insertUnitConversionSchema = createInsertSchema(unitConversions).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertStaffSchema = createInsertSchema(staff).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  staffId: z.string().optional(), // Allow staffId to be optional during creation\n});\n\nexport const insertAttendanceSchema = createInsertSchema(attendance).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertSalaryPaymentSchema = createInsertSchema(salaryPayments).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertLeaveRequestSchema = createInsertSchema(leaveRequests).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertStaffScheduleSchema = createInsertSchema(staffSchedules).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Missing schemas needed by routes.ts\nexport const insertInventoryItemSchema = createInsertSchema(inventoryItems).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertOrderSchema = createInsertSchema(orders).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertProductionScheduleItemSchema = createInsertSchema(productionSchedule).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPartySchema = createInsertSchema(parties).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertAssetSchema = createInsertSchema(assets).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertAuditLogSchema = createInsertSchema(auditLogs).omit({\n  id: true,\n  timestamp: true,\n});\n\n// Insert schemas for sales and saleItems\nexport const insertSaleSchema = createInsertSchema(sales).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertSaleItemSchema = createInsertSchema(saleItems).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSalesReturnSchema = createInsertSchema(salesReturns).omit({\n  id: true,\n  serialNumber: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertDailySalesReturnSummarySchema = createInsertSchema(dailySalesReturnSummary).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPurchaseReturnSchema = createInsertSchema(purchaseReturns).omit({\n  id: true,\n  serialNumber: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertDailyPurchaseReturnSummarySchema = createInsertSchema(dailyPurchaseReturnSummary).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Stock Management Insert Schemas\nexport const insertStockBatchSchema = createInsertSchema(stockBatches).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertStockBatchConsumptionSchema = createInsertSchema(stockBatchConsumptions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertDailyInventorySnapshotSchema = createInsertSchema(dailyInventorySnapshots).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertInventoryCostHistorySchema = createInsertSchema(inventoryCostHistory).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertRoleModuleSchema = createInsertSchema(roleModules).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertUserModuleOverrideSchema = createInsertSchema(userModuleOverrides).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Insert schema for printed labels\nexport const insertPrintedLabelSchema = createInsertSchema(printedLabels).omit({\n  id: true,\n  printedDate: true,\n  createdAt: true,\n});\n\nexport type PrintedLabel = typeof printedLabels.$inferSelect;\nexport type InsertPrintedLabel = z.infer<typeof insertPrintedLabelSchema>;","path":null,"size_bytes":49711,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/hooks/usePricing.ts":{"content":"\nimport { useQuery } from \"@tanstack/react-query\";\n\nexport interface PricingSettings {\n  systemPrice: number;\n  currency: string;\n  description: string;\n  displayEnabled: boolean;\n}\n\nexport function usePricing() {\n  const { data: pricingSettings, isLoading, error } = useQuery({\n    queryKey: [\"/api/pricing\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/pricing\");\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch pricing\");\n      }\n      return response.json() as Promise<PricingSettings>;\n    },\n    staleTime: 5 * 60 * 1000, // 5 minutes\n    cacheTime: 10 * 60 * 1000, // 10 minutes\n  });\n\n  const formatPrice = (price?: number) => {\n    const actualPrice = price || pricingSettings?.systemPrice || 299.99;\n    const currency = pricingSettings?.currency || \"USD\";\n    \n    const currencySymbols: Record<string, string> = {\n      USD: \"$\",\n      EUR: \"‚Ç¨\",\n      GBP: \"¬£\",\n      NPR: \"‚Ç®\",\n      INR: \"‚Çπ\",\n      AUD: \"A$\",\n      CAD: \"C$\",\n    };\n\n    const symbol = currencySymbols[currency] || currency;\n    return `${symbol}${actualPrice.toFixed(2)}`;\n  };\n\n  const formatPriceWithCurrency = (price?: number) => {\n    const actualPrice = price || pricingSettings?.systemPrice || 299.99;\n    const currency = pricingSettings?.currency || \"USD\";\n    return `${currency} ${actualPrice.toFixed(2)}`;\n  };\n\n  return {\n    pricingSettings,\n    isLoading,\n    error,\n    formatPrice,\n    formatPriceWithCurrency,\n    systemPrice: pricingSettings?.systemPrice || 299.99,\n    currency: pricingSettings?.currency || \"USD\",\n    description: pricingSettings?.description || \"Complete Bakery Management System\",\n    displayEnabled: pricingSettings?.displayEnabled !== false,\n  };\n}\n\n// Quick hook for getting just the system price\nexport function useSystemPrice() {\n  const { data: priceData } = useQuery({\n    queryKey: [\"/api/system-price\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/system-price\");\n      if (!response.ok) throw new Error(\"Failed to fetch system price\");\n      return response.json();\n    },\n    staleTime: 5 * 60 * 1000,\n  });\n\n  return priceData?.price || 299.99;\n}\n","path":null,"size_bytes":2154,"size_tokens":null},"server/lib/activityTracker.ts":{"content":"import { Request } from 'express';\nimport { db } from '../db';\nimport { auditLogs } from '@shared/schema';\n\nexport async function trackUserActivity(\n  userId: string,\n  userEmail: string,\n  action: string,\n  resource: string,\n  resourceId: string,\n  details: any,\n  req: any\n) {\n  try {\n    const ipAddress = req.ip || req.connection?.remoteAddress || \"unknown\";\n    const userAgent = req.get(\"User-Agent\") || \"unknown\";\n\n    // Safely get user name with multiple fallbacks\n    let userName = \"Unknown User\";\n    if (req.user) {\n      if (req.user.firstName && req.user.lastName) {\n        userName = `${req.user.firstName} ${req.user.lastName}`;\n      } else if (req.user.firstName) {\n        userName = req.user.firstName;\n      } else if (req.user.lastName) {\n        userName = req.user.lastName;\n      } else if (userEmail) {\n        userName = userEmail.split('@')[0]; // Use email prefix as fallback\n      }\n    } else if (userEmail) {\n      userName = userEmail.split('@')[0]; // Use email prefix as fallback\n    }\n\n    await db.insert(auditLogs).values({\n      userId,\n      userEmail,\n      userName,\n      action,\n      resource,\n      resourceId,\n      details,\n      ipAddress,\n      userAgent,\n      status: \"success\",\n    });\n  } catch (error) {\n    console.error(\"Failed to track user activity:\", error);\n  }\n}","path":null,"size_bytes":1326,"size_tokens":null},"client/src/components/login-footer.tsx":{"content":"import React from \"react\";\nimport { Facebook, Instagram, Mail, MessageCircle } from \"lucide-react\";\nimport MapTech_Logo from \"@/public/company__logo.webp\";\n\nexport default function LoginFooter() {\n  return (\n    <div className=\"mt-4 text-center\">\n      <div className=\"flex items-center justify-center gap-4\">\n        {/* Powered by */}\n        <div className=\"flex items-center text-xs text-gray-500 mr-4\">\n          Powered by{\" \"}\n          <a\n            href=\"https://maptechnepal.com\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"inline-flex items-center gap-1 text-blue-600 hover:text-blue-800 transition-colors ml-1\"\n          >\n            <img\n              src={MapTech_Logo}\n              alt=\"MapTech Nepal\"\n              className=\"h-3 w-auto inline\"\n            />\n          </a>\n        </div>\n\n        {/* Social icons */}\n        <a\n          href=\"mailto:support@maptechnepal.com\"\n          className=\"p-1 text-red-500 hover:text-red-600 transition-colors\"\n          title=\"Email\"\n        >\n          <Mail className=\"w-4 h-4\" />\n        </a>\n        <a\n          href=\"https://wa.me/9779745673009\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"p-1 text-green-500 hover:text-green-600 transition-colors\"\n          title=\"WhatsApp\"\n        >\n          <MessageCircle className=\"w-4 h-4\" />\n        </a>\n        <a\n          href=\"https://www.facebook.com/maptech.np/\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"p-1 text-blue-600 hover:text-blue-700 transition-colors\"\n          title=\"Facebook\"\n        >\n          <Facebook className=\"w-4 h-4\" />\n        </a>\n        <a\n          href=\"https://www.instagram.com/maptech.np/\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"p-1 text-pink-500 hover:text-pink-600 transition-colors\"\n          title=\"Instagram\"\n        >\n          <Instagram className=\"w-4 h-4\" />\n        </a>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":2032,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus:border-blue-500 focus:ring-blue-500/20 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className,\n      )}\n      ref={ref}\n      {...props}\n    />\n  );\n});\nTextarea.displayName = \"Textarea\";\n\nexport { Textarea };\n","path":null,"size_bytes":728,"size_tokens":null},"server/init-complete-system.ts":{"content":"import { db } from \"./db.js\";\nimport { testDatabaseConnection } from \"./db.js\";\nimport {\n  units,\n  permissions,\n  rolePermissions,\n  inventoryCategories,\n  categories,\n  users,\n  auditLogs,\n  loginLogs\n} from \"../shared/schema.js\";\nimport bcrypt from \"bcryptjs\";\nimport { nanoid } from \"nanoid\";\n\nexport async function initializeCompleteSystem() {\n  try {\n    console.log(\"üîÑ Initializing complete system...\");\n\n    // Test database connection first\n    const isConnected = await testDatabaseConnection();\n    if (!isConnected) {\n      throw new Error(\"Database connection failed\");\n    }\n\n    // 1. Initialize Units first (required by many other tables)\n    console.log(\"üìè Initializing units...\");\n    const existingUnits = await db.select().from(units);\n    if (existingUnits.length === 0) {\n      const defaultUnits = [\n        { name: \"Kilogram\", abbreviation: \"kg\", type: \"weight\", baseUnit: \"gram\", conversionFactor: \"1000\", isActive: true },\n        { name: \"Gram\", abbreviation: \"g\", type: \"weight\", baseUnit: \"gram\", conversionFactor: \"1\", isActive: true },\n        { name: \"Pound\", abbreviation: \"lbs\", type: \"weight\", baseUnit: \"gram\", conversionFactor: \"453.592\", isActive: true },\n        { name: \"Ounce\", abbreviation: \"oz\", type: \"weight\", baseUnit: \"gram\", conversionFactor: \"28.3495\", isActive: true },\n\n        { name: \"Liter\", abbreviation: \"L\", type: \"volume\", baseUnit: \"milliliter\", conversionFactor: \"1000\", isActive: true },\n        { name: \"Milliliter\", abbreviation: \"ml\", type: \"volume\", baseUnit: \"milliliter\", conversionFactor: \"1\", isActive: true },\n        { name: \"Cup\", abbreviation: \"cup\", type: \"volume\", baseUnit: \"milliliter\", conversionFactor: \"240\", isActive: true },\n        { name: \"Tablespoon\", abbreviation: \"tbsp\", type: \"volume\", baseUnit: \"milliliter\", conversionFactor: \"15\", isActive: true },\n        { name: \"Teaspoon\", abbreviation: \"tsp\", type: \"volume\", baseUnit: \"milliliter\", conversionFactor: \"5\", isActive: true },\n\n        { name: \"Piece\", abbreviation: \"pcs\", type: \"count\", baseUnit: \"piece\", conversionFactor: \"1\", isActive: true },\n        { name: \"Dozen\", abbreviation: \"dz\", type: \"count\", baseUnit: \"piece\", conversionFactor: \"12\", isActive: true },\n        { name: \"Pack\", abbreviation: \"pack\", type: \"count\", baseUnit: \"piece\", conversionFactor: \"1\", isActive: true },\n        { name: \"Box\", abbreviation: \"box\", type: \"count\", baseUnit: \"piece\", conversionFactor: \"1\", isActive: true },\n        { name: \"Bag\", abbreviation: \"bag\", type: \"count\", baseUnit: \"piece\", conversionFactor: \"1\", isActive: true },\n        { name: \"Bottle\", abbreviation: \"btl\", type: \"count\", baseUnit: \"piece\", conversionFactor: \"1\", isActive: true },\n\n        { name: \"Meter\", abbreviation: \"m\", type: \"length\", baseUnit: \"centimeter\", conversionFactor: \"100\", isActive: true },\n        { name: \"Centimeter\", abbreviation: \"cm\", type: \"length\", baseUnit: \"centimeter\", conversionFactor: \"1\", isActive: true },\n        { name: \"Inch\", abbreviation: \"in\", type: \"length\", baseUnit: \"centimeter\", conversionFactor: \"2.54\", isActive: true },\n\n        { name: \"Celsius\", abbreviation: \"¬∞C\", type: \"temperature\", baseUnit: \"celsius\", conversionFactor: \"1\", isActive: true },\n        { name: \"Fahrenheit\", abbreviation: \"¬∞F\", type: \"temperature\", baseUnit: \"celsius\", conversionFactor: \"1\", isActive: true }\n      ];\n\n      await db.insert(units).values(defaultUnits);\n      console.log(\"‚úÖ Units initialized\");\n    } else {\n      console.log(\"‚úÖ Units already exist\");\n    }\n\n    // 2. Initialize Permissions\n    console.log(\"üîê Initializing permissions...\");\n    const existingPermissions = await db.select().from(permissions).catch(() => []);\n    if (existingPermissions.length === 0) {\n      const defaultPermissions = [\n        // Dashboard permissions\n        { name: \"dashboard_read\", resource: \"dashboard\", action: \"read\", description: \"View dashboard\" },\n        { name: \"dashboard_write\", resource: \"dashboard\", action: \"write\", description: \"Modify dashboard\" },\n\n        // Product permissions\n        { name: \"products_read\", resource: \"products\", action: \"read\", description: \"View products\" },\n        { name: \"products_write\", resource: \"products\", action: \"write\", description: \"Create/edit products\" },\n        { name: \"products_delete\", resource: \"products\", action: \"delete\", description: \"Delete products\" },\n\n        // Inventory permissions\n        { name: \"inventory_read\", resource: \"inventory\", action: \"read\", description: \"View inventory\" },\n        { name: \"inventory_write\", resource: \"inventory\", action: \"write\", description: \"Manage inventory\" },\n        { name: \"inventory_delete\", resource: \"inventory\", action: \"delete\", description: \"Delete inventory items\" },\n\n        // Order permissions\n        { name: \"orders_read\", resource: \"orders\", action: \"read\", description: \"View orders\" },\n        { name: \"orders_write\", resource: \"orders\", action: \"write\", description: \"Create/edit orders\" },\n        { name: \"orders_delete\", resource: \"orders\", action: \"delete\", description: \"Delete orders\" },\n\n        // Purchase permissions\n        { name: \"purchases_read\", resource: \"purchases\", action: \"read\", description: \"View purchases\" },\n        { name: \"purchases_write\", resource: \"purchases\", action: \"write\", description: \"Create/edit purchases\" },\n        { name: \"purchases_delete\", resource: \"purchases\", action: \"delete\", description: \"Delete purchases\" },\n\n        // Customer permissions\n        { name: \"customers_read\", resource: \"customers\", action: \"read\", description: \"View customers\" },\n        { name: \"customers_write\", resource: \"customers\", action: \"write\", description: \"Manage customers\" },\n        { name: \"customers_delete\", resource: \"customers\", action: \"delete\", description: \"Delete customers\" },\n\n        // Staff permissions\n        { name: \"staff_read\", resource: \"staff\", action: \"read\", description: \"View staff\" },\n        { name: \"staff_write\", resource: \"staff\", action: \"write\", description: \"Manage staff\" },\n        { name: \"staff_delete\", resource: \"staff\", action: \"delete\", description: \"Delete staff\" },\n\n        // Financial permissions\n        { name: \"expenses_read\", resource: \"expenses\", action: \"read\", description: \"View expenses\" },\n        { name: \"expenses_write\", resource: \"expenses\", action: \"write\", description: \"Manage expenses\" },\n        { name: \"reports_read\", resource: \"reports\", action: \"read\", description: \"View reports\" },\n\n        // Admin permissions\n        { name: \"admin_users\", resource: \"admin\", action: \"write\", description: \"Manage system users\" },\n        { name: \"admin_settings\", resource: \"admin\", action: \"write\", description: \"Manage system settings\" },\n        { name: \"admin_audit\", resource: \"admin\", action: \"read\", description: \"View audit logs\" },\n\n        // Units permissions\n        { name: \"units_read\", resource: \"units\", action: \"read\", description: \"View units\" },\n        { name: \"units_write\", resource: \"units\", action: \"write\", description: \"Manage units\" },\n        { name: \"units_delete\", resource: \"units\", action: \"delete\", description: \"Delete units\" }\n      ];\n\n      const insertedPermissions = await db.insert(permissions).values(defaultPermissions).returning();\n      console.log(\"‚úÖ Permissions initialized\");\n\n      // 3. Initialize Role Permissions\n      console.log(\"üë• Initializing role permissions...\");\n      const rolePermissionData = [];\n\n      // Super Admin - all permissions\n      insertedPermissions.forEach(permission => {\n        rolePermissionData.push({ role: \"super_admin\", permissionId: permission.id });\n      });\n\n      // Admin - most permissions except super admin functions\n      const adminPermissions = insertedPermissions.filter(p => \n        !p.name.includes(\"admin_users\") && !p.name.includes(\"admin_audit\")\n      );\n      adminPermissions.forEach(permission => {\n        rolePermissionData.push({ role: \"admin\", permissionId: permission.id });\n      });\n\n      // Manager - operational permissions\n      const managerPermissions = insertedPermissions.filter(p => \n        p.name.includes(\"_read\") || \n        p.name.includes(\"orders_\") || \n        p.name.includes(\"inventory_\") || \n        p.name.includes(\"products_\") ||\n        p.name.includes(\"customers_\") ||\n        p.name.includes(\"staff_read\") ||\n        p.name.includes(\"reports_\")\n      );\n      managerPermissions.forEach(permission => {\n        rolePermissionData.push({ role: \"manager\", permissionId: permission.id });\n      });\n\n      // Staff - basic permissions\n      const staffPermissions = insertedPermissions.filter(p => \n        p.name.includes(\"dashboard_read\") ||\n        p.name.includes(\"products_read\") ||\n        p.name.includes(\"inventory_read\") ||\n        p.name.includes(\"orders_read\") ||\n        p.name.includes(\"customers_read\")\n      );\n      staffPermissions.forEach(permission => {\n        rolePermissionData.push({ role: \"staff\", permissionId: permission.id });\n      });\n\n      await db.insert(rolePermissions).values(rolePermissionData);\n      console.log(\"‚úÖ Role permissions initialized\");\n    } else {\n      console.log(\"‚úÖ Permissions already exist\");\n    }\n\n    // 4. Initialize Categories\n    console.log(\"üìÇ Initializing categories...\");\n    const existingCategories = await db.select().from(categories);\n    if (existingCategories.length === 0) {\n      const defaultCategories = [\n        { name: \"Cakes\", description: \"Birthday, wedding, and specialty cakes\" },\n        { name: \"Pastries\", description: \"Croissants, danishes, and sweet pastries\" },\n        { name: \"Bread\", description: \"Fresh baked breads and rolls\" },\n        { name: \"Cookies\", description: \"Assorted cookies and biscuits\" },\n        { name: \"Desserts\", description: \"Puddings, tarts, and specialty desserts\" },\n        { name: \"Beverages\", description: \"Coffee, tea, and other drinks\" }\n      ];\n\n      await db.insert(categories).values(defaultCategories);\n      console.log(\"‚úÖ Categories initialized\");\n    } else {\n      console.log(\"‚úÖ Categories already exist\");\n    }\n\n    // 5. Initialize Inventory Categories\n    console.log(\"üì¶ Initializing inventory categories...\");\n    const existingInvCategories = await db.select().from(inventoryCategories);\n    if (existingInvCategories.length === 0) {\n      const defaultInvCategories = [\n        { name: \"Flour & Grains\", description: \"Basic baking ingredients\", isActive: true },\n        { name: \"Dairy Products\", description: \"Milk, butter, cheese products\", isActive: true },\n        { name: \"Sweeteners\", description: \"Sugar, honey, artificial sweeteners\", isActive: true },\n        { name: \"Spices & Flavoring\", description: \"Vanilla, cinnamon, extracts\", isActive: true },\n        { name: \"Packaging\", description: \"Boxes, bags, wrapping materials\", isActive: true },\n        { name: \"Fruits & Nuts\", description: \"Fresh and dried fruits, nuts\", isActive: true }\n      ];\n\n      await db.insert(inventoryCategories).values(defaultInvCategories);\n      console.log(\"‚úÖ Inventory categories initialized\");\n    } else {\n      console.log(\"‚úÖ Inventory categories already exist\");\n    }\n\n    // 6. Initialize System Users\n    console.log(\"üë§ Initializing system users...\");\n    const existingUsers = await db.select().from(users);\n    if (existingUsers.length === 0) {\n      const defaultUsers = [\n        {\n          email: \"superadmin@bakersoft.com\",\n          firstName: \"Super\",\n          lastName: \"Admin\",\n          role: \"super_admin\",\n          password: await bcrypt.hash(\"admin123\", 10),\n        },\n        {\n          email: \"admin@bakersoft.com\",\n          firstName: \"System\",\n          lastName: \"Admin\",\n          role: \"admin\",\n          password: await bcrypt.hash(\"admin123\", 10),\n        },\n        {\n          email: \"manager@bakersoft.com\",\n          firstName: \"Bakery\",\n          lastName: \"Manager\",\n          role: \"manager\",\n          password: await bcrypt.hash(\"manager123\", 10),\n        },\n        {\n          email: \"staff@bakersoft.com\",\n          firstName: \"Staff\",\n          lastName: \"Member\",\n          role: \"staff\",\n          password: await bcrypt.hash(\"staff123\", 10),\n        },\n      ];\n\n      await db.insert(users).values(defaultUsers);\n      console.log(\"‚úÖ System users initialized\");\n    } else {\n      console.log(\"‚úÖ System users already exist\");\n    }\n\n    console.log(\"\\n\" + \"=\".repeat(60));\n    console.log(\"üéâ COMPLETE SYSTEM INITIALIZATION SUCCESSFUL\");\n    console.log(\"=\".repeat(60));\n    console.log(\"üîë LOGIN CREDENTIALS:\");\n    console.log(\"üìß Super Admin: superadmin@bakersoft.com / admin123\");\n    console.log(\"üìß Admin: admin@bakersoft.com / admin123\");\n    console.log(\"üìß Manager: manager@bakersoft.com / manager123\");\n    console.log(\"üìß Staff: staff@bakersoft.com / staff123\");\n    console.log(\"=\".repeat(60));\n\n  } catch (error) {\n    console.error(\"‚ùå System initialization failed:\", error);\n    throw error;\n  }\n}\n\n// Run initialization if this file is executed directly\nif (import.meta.url === `file://${process.argv[1]}`) {\n  initializeCompleteSystem()\n    .then(() => {\n      console.log(\"‚úÖ Initialization complete\");\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error(\"‚ùå Initialization failed:\", error);\n      process.exit(1);\n    });\n}","path":null,"size_bytes":13310,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/main.tsx":{"content":"import React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { setupAutoTracking } from \"@/lib/activityTracker\";\nimport { initPWA } from \"./lib/pwa\";\n\n// Initialize PWA features\ninitPWA().catch(console.error);\nimport App from \"./App.tsx\";\nimport \"./index.css\";\n\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      retry: (failureCount, error: any) => {\n        // Don't retry on 401/403 errors\n        if (error?.status === 401 || error?.status === 403) {\n          return false;\n        }\n        return failureCount < 3;\n      },\n      staleTime: 1000 * 60 * 5, // 5 minutes\n    },\n  },\n});\n\n// Initialize activity tracking\nsetupAutoTracking();\n\nReactDOM.createRoot(document.getElementById(\"root\")!).render(\n  <React.StrictMode>\n    <QueryClientProvider client={queryClient}>\n      <App />\n      <Toaster />\n    </QueryClientProvider>\n  </React.StrictMode>,\n);","path":null,"size_bytes":1028,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"// src/hooks/useAuth.ts\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\nimport { getQueryFn, apiRequest } from \"@/lib/queryClient\";\n\n/**\n * Custom hook to manage authentication state\n */\nexport function useAuth() {\n  const queryClient = useQueryClient();\n\n  const {\n    data: user,\n    isLoading,\n    error,\n    refetch,\n  } = useQuery<User | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: getQueryFn<User | null>({ on401: \"returnNull\" }),\n    retry: false,\n    staleTime: 1000 * 60 * 10, // 10 minutes\n    gcTime: 1000 * 60 * 60, // 1 hour\n    refetchOnWindowFocus: false,\n    refetchOnMount: true,\n    refetchInterval: false,\n  });\n\n  const logout = async () => {\n    try {\n      await apiRequest(\"POST\", \"/api/auth/logout\", {});\n    } catch (err) {\n      console.warn(\"Network error during logout (proceeding anyway):\", err);\n    } finally {\n      queryClient.setQueryData([\"/api/auth/user\"], null);\n      queryClient.removeQueries({ queryKey: [\"/api/auth/user\"] });\n      window.location.href = \"/login\";\n    }\n  };\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    error,\n    refetch,\n    logout,\n  };\n}\n","path":null,"size_bytes":1199,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"// components/ui/switch.tsx\nimport * as React from \"react\";\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\";\nimport { cn } from \"@/lib/utils\";\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50\",\n\n      // Enhanced unchecked state\n      \"bg-gray-300 dark:bg-gray-700\",\n\n      // Checked state with smoother gradient or brighter color\n      \"data-[state=checked]:bg-gradient-to-r data-[state=checked]:from-blue-500 data-[state=checked]:to-indigo-600\",\n      \"data-[state=checked]:shadow-md data-[state=checked]:shadow-blue-300/50\",\n\n      // Unchecked visual refinement\n      \"data-[state=unchecked]:border data-[state=unchecked]:border-gray-300 dark:data-[state=unchecked]:border-gray-600\",\n\n      // Hover effects\n      \"hover:data-[state=unchecked]:bg-gray-200 dark:hover:data-[state=unchecked]:bg-gray-600\",\n      \"hover:data-[state=checked]:brightness-110\",\n\n      className,\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-white shadow-lg ring-0 transition-transform duration-300 ease-in-out data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\",\n      )}\n    />\n  </SwitchPrimitives.Root>\n));\n\nSwitch.displayName = SwitchPrimitives.Root.displayName;\n\nexport { Switch };\n","path":null,"size_bytes":1811,"size_tokens":null},"client/src/lib/notificationService.ts":{"content":"\n// Notification service for triggering business notifications\nexport class NotificationService {\n  private static instance: NotificationService;\n  \n  static getInstance(): NotificationService {\n    if (!NotificationService.instance) {\n      NotificationService.instance = new NotificationService();\n    }\n    return NotificationService.instance;\n  }\n\n  async triggerNotification(event: string, data: any): Promise<void> {\n    try {\n      await fetch('/api/notifications/trigger', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify({ event, data }),\n      });\n    } catch (error) {\n      console.error('Failed to trigger notification:', error);\n    }\n  }\n\n  // Order notifications\n  async notifyOrderCreated(orderData: any): Promise<void> {\n    await this.triggerNotification('order_created', orderData);\n  }\n\n  async notifyPaymentReceived(paymentData: any): Promise<void> {\n    await this.triggerNotification('payment_received', paymentData);\n  }\n\n  async notifyOrderDelayed(orderData: any): Promise<void> {\n    await this.triggerNotification('order_delayed', orderData);\n  }\n\n  // Production notifications\n  async notifyProductionCompleted(productionData: any): Promise<void> {\n    await this.triggerNotification('production_completed', productionData);\n  }\n\n  async notifyProductionDelayed(productionData: any): Promise<void> {\n    await this.triggerNotification('production_delayed', productionData);\n  }\n\n  async notifyQualityCheckFailed(qcData: any): Promise<void> {\n    await this.triggerNotification('qc_failed', qcData);\n  }\n\n  // Inventory notifications\n  async notifyLowStock(stockData: any): Promise<void> {\n    await this.triggerNotification('low_stock', stockData);\n  }\n\n  async notifyOutOfStock(stockData: any): Promise<void> {\n    await this.triggerNotification('out_of_stock', stockData);\n  }\n\n  async notifyRestockAlert(stockData: any): Promise<void> {\n    await this.triggerNotification('restock_alert', stockData);\n  }\n\n  // Shipping notifications\n  async notifyShipmentDispatched(shipmentData: any): Promise<void> {\n    await this.triggerNotification('shipment_dispatched', shipmentData);\n  }\n\n  async notifyDeliveryFailed(deliveryData: any): Promise<void> {\n    await this.triggerNotification('delivery_failed', deliveryData);\n  }\n\n  async notifyDeliveryCompleted(deliveryData: any): Promise<void> {\n    await this.triggerNotification('delivery_completed', deliveryData);\n  }\n\n  // System notifications\n  async notifySystemAlert(alertData: any): Promise<void> {\n    await this.triggerNotification('system_alert', alertData);\n  }\n\n  async notifyFailedSync(syncData: any): Promise<void> {\n    await this.triggerNotification('failed_sync', syncData);\n  }\n\n  async notifyNewDeviceLogin(loginData: any): Promise<void> {\n    await this.triggerNotification('new_device_login', loginData);\n  }\n}\n\n// Export singleton instance\nexport const notificationService = NotificationService.getInstance();\n","path":null,"size_bytes":3022,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className,\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\";\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\";\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className,\n    )}\n    {...props}\n  />\n));\nCardTitle.displayName = \"CardTitle\";\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\";\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n));\nCardContent.displayName = \"CardContent\";\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n));\nCardFooter.displayName = \"CardFooter\";\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n};\n","path":null,"size_bytes":1888,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\";\nimport * as ToastPrimitives from \"@radix-ui/react-toast\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\nimport { X } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst ToastProvider = ToastPrimitives.Provider;\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className,\n    )}\n    {...props}\n  />\n));\nToastViewport.displayName = ToastPrimitives.Viewport.displayName;\n\nconst toastVariants = cva(\n  \"bg-white group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n);\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  );\n});\nToast.displayName = ToastPrimitives.Root.displayName;\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className,\n    )}\n    {...props}\n  />\n));\nToastAction.displayName = ToastPrimitives.Action.displayName;\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className,\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n));\nToastClose.displayName = ToastPrimitives.Close.displayName;\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n));\nToastTitle.displayName = ToastPrimitives.Title.displayName;\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n));\nToastDescription.displayName = ToastPrimitives.Description.displayName;\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>;\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>;\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n};\n","path":null,"size_bytes":4881,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":971,"size_tokens":null},"server/init-db.ts":{"content":"import { storage } from \"./lib/storage.js\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL environment variable is required. Please create a PostgreSQL database in Replit.\",\n  );\n}\n\nexport async function initializeDatabase() {\n  try {\n    console.log(\"üîÑ Initializing database...\");\n\n    // Only initialize if database is connected\n    await storage.ensureDefaultAdmin();\n\n    // Initialize permissions\n    await storage.initializeDefaultPermissions();\n\n    console.log(\"\\n\" + \"=\".repeat(60));\n    console.log(\"üîë SYSTEM LOGIN CREDENTIALS\");\n    console.log(\"=\".repeat(60));\n    console.log(\"üìß Super Admin: superadmin@bakersoft.com\");\n    console.log(\"üîê Password: superadmin123\");\n    console.log(\"---\");\n    console.log(\"üìß Admin: admin@bakersoft.com\");\n    console.log(\"üîê Password: admin123\");\n    console.log(\"---\");\n    console.log(\"üìß Manager: manager@bakersoft.com\");\n    console.log(\"üîê Password: manager123\");\n    console.log(\"---\");\n    console.log(\"üìß Staff: staff@bakersoft.com\");\n    console.log(\"üîê Password: staff123\");\n    console.log(\"=\".repeat(60));\n  } catch (error) {\n    console.error(\"‚ùå Database initialization failed:\", error);\n  }\n}\n\n// Run initialization if this file is executed directly\nif (import.meta.url === `file://${process.argv[1]}`) {\n  initializeDatabase().catch(console.error);\n}\n","path":null,"size_bytes":1364,"size_tokens":null},"client/src/components/notification-dropdown.tsx":{"content":"\nimport React, { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Bell,\n  BellRing,\n  Package,\n  ShoppingCart,\n  Factory,\n  Truck,\n  AlertTriangle,\n  CheckCheck,\n  Clock,\n  ArrowRight,\n  Trash2,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface Notification {\n  id: string;\n  type: \"order\" | \"production\" | \"inventory\" | \"shipping\" | \"system\";\n  title: string;\n  description: string;\n  timestamp: string;\n  read: boolean;\n  priority: \"low\" | \"medium\" | \"high\" | \"critical\";\n  actionUrl?: string;\n  data?: any;\n}\n\nconst notificationConfig = {\n  order: {\n    icon: ShoppingCart,\n    color: \"text-blue-600\",\n    bgColor: \"bg-blue-50\",\n    borderColor: \"border-blue-200\",\n    label: \"Orders\",\n    emoji: \"üõí\",\n  },\n  production: {\n    icon: Factory,\n    color: \"text-orange-600\",\n    bgColor: \"bg-orange-50\",\n    borderColor: \"border-orange-200\",\n    label: \"Production\",\n    emoji: \"üè≠\",\n  },\n  inventory: {\n    icon: Package,\n    color: \"text-green-600\",\n    bgColor: \"bg-green-50\",\n    borderColor: \"border-green-200\",\n    label: \"Inventory\",\n    emoji: \"üì¶\",\n  },\n  shipping: {\n    icon: Truck,\n    color: \"text-purple-600\",\n    bgColor: \"bg-purple-50\",\n    borderColor: \"border-purple-200\",\n    label: \"Shipping\",\n    emoji: \"üöö\",\n  },\n  system: {\n    icon: AlertTriangle,\n    color: \"text-red-600\",\n    bgColor: \"bg-red-50\",\n    borderColor: \"border-red-200\",\n    label: \"System\",\n    emoji: \"‚öôÔ∏è\",\n  },\n};\n\nconst priorityConfig = {\n  critical: {\n    color: \"bg-red-500\",\n    textColor: \"text-red-700\",\n    label: \"Critical\",\n  },\n  high: {\n    color: \"bg-orange-500\",\n    textColor: \"text-orange-700\",\n    label: \"High\",\n  },\n  medium: {\n    color: \"bg-yellow-500\",\n    textColor: \"text-yellow-700\",\n    label: \"Medium\",\n  },\n  low: {\n    color: \"bg-green-500\",\n    textColor: \"text-green-700\",\n    label: \"Low\",\n  },\n};\n\nexport default function NotificationDropdown() {\n  const [isOpen, setIsOpen] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch notifications with real API\n  const {\n    data: notifications = [],\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: [\"/api/notifications\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/notifications\"),\n    refetchInterval: 30000, // Refresh every 30 seconds\n    refetchIntervalInBackground: true,\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  // Mark notification as read\n  const markAsReadMutation = useMutation({\n    mutationFn: async (notificationId: string) => {\n      return apiRequest(\"PUT\", `/api/notifications/${notificationId}/read`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to mark notification as read\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mark all as read\n  const markAllAsReadMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"PUT\", \"/api/notifications/mark-all-read\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      toast({\n        title: \"Success\",\n        description: \"All notifications marked as read\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to mark all notifications as read\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Send test notification\n  const sendTestNotificationMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", \"/api/notifications/test\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      toast({\n        title: \"Test Notification Sent\",\n        description: \"Check your notifications to see the test message\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to send test notification\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Trigger alert checks\n  const checkAlertsMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", \"/api/notifications/check-alerts\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      toast({\n        title: \"Alert Check Complete\",\n        description: \"System alerts have been checked and updated\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to check system alerts\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Calculate unread count\n  const notificationData = (notifications as Notification[]) || [];\n  const unreadCount = notificationData.filter(\n    (n: Notification) => !n.read,\n  ).length;\n\n  // Sort notifications by priority and timestamp\n  const sortedNotifications = [...notificationData].sort(\n    (a: Notification, b: Notification) => {\n      const priorityOrder = { critical: 4, high: 3, medium: 2, low: 1 };\n\n      // First sort by priority\n      const priorityDiff =\n        priorityOrder[b.priority] - priorityOrder[a.priority];\n      if (priorityDiff !== 0) return priorityDiff;\n\n      // Then by read status (unread first)\n      const readDiff = Number(a.read) - Number(b.read);\n      if (readDiff !== 0) return readDiff;\n\n      // Finally by timestamp (newest first)\n      return new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime();\n    },\n  );\n\n  const formatTimeAgo = (timestamp: string) => {\n    const now = new Date();\n    const time = new Date(timestamp);\n    const diffInSeconds = Math.floor((now.getTime() - time.getTime()) / 1000);\n\n    if (diffInSeconds < 60) return \"Just now\";\n    if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;\n    if (diffInSeconds < 86400)\n      return `${Math.floor(diffInSeconds / 3600)}h ago`;\n    return `${Math.floor(diffInSeconds / 86400)}d ago`;\n  };\n\n  const handleNotificationClick = async (notification: Notification) => {\n    // Mark as read if unread\n    if (!notification.read) {\n      markAsReadMutation.mutate(notification.id);\n    }\n\n    // Navigate to action URL if provided\n    if (notification.actionUrl) {\n      window.location.href = notification.actionUrl;\n    }\n\n    setIsOpen(false);\n  };\n\n  const handleMarkAllAsRead = () => {\n    markAllAsReadMutation.mutate();\n  };\n\n  const handleSendTestNotification = () => {\n    sendTestNotificationMutation.mutate();\n  };\n\n  const handleCheckAlerts = () => {\n    checkAlertsMutation.mutate();\n  };\n\n  const getNotificationIcon = (type: string) => {\n    const config = notificationConfig[type as keyof typeof notificationConfig];\n    const IconComponent = config?.icon || Bell;\n    return <IconComponent className={`h-4 w-4 ${config?.color}`} />;\n  };\n\n  // Critical notifications count for extra highlighting\n  const criticalCount = notificationData.filter(\n    (n: Notification) => !n.read && n.priority === \"critical\",\n  ).length;\n\n  return (\n    <DropdownMenu open={isOpen} onOpenChange={setIsOpen}>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\" size=\"sm\" className=\"relative p-2\">\n          {criticalCount > 0 ? (\n            <BellRing className=\"h-5 w-5 text-red-600 animate-pulse\" />\n          ) : (\n            <Bell className=\"h-5 w-5\" />\n          )}\n          {unreadCount > 0 && (\n            <Badge\n              variant=\"destructive\"\n              className={`absolute -top-1 -right-1 h-5 w-5 text-xs flex items-center justify-center ${\n                criticalCount > 0 ? \"bg-red-600 animate-pulse\" : \"\"\n              }`}\n            >\n              {unreadCount > 99 ? \"99+\" : unreadCount}\n            </Badge>\n          )}\n        </Button>\n      </DropdownMenuTrigger>\n\n      <DropdownMenuContent\n        align=\"end\"\n        className=\"w-96 max-h-[80vh]\"\n        sideOffset={5}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b\">\n          <div className=\"flex items-center gap-2\">\n            <Bell className=\"h-5 w-5\" />\n            <h3 className=\"font-semibold\">Notifications</h3>\n            {unreadCount > 0 && (\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {unreadCount} new\n              </Badge>\n            )}\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleCheckAlerts}\n              disabled={checkAlertsMutation.isPending}\n              className=\"text-xs\"\n              title=\"Check for new alerts\"\n            >\n              <AlertTriangle className=\"h-3 w-3\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleSendTestNotification}\n              disabled={sendTestNotificationMutation.isPending}\n              className=\"text-xs\"\n              title=\"Send test notification\"\n            >\n              Test\n            </Button>\n            {unreadCount > 0 && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleMarkAllAsRead}\n                disabled={markAllAsReadMutation.isPending}\n                className=\"text-xs\"\n              >\n                <CheckCheck className=\"h-3 w-3 mr-1\" />\n                Mark all read\n              </Button>\n            )}\n          </div>\n        </div>\n\n        {/* Loading State */}\n        {isLoading && (\n          <div className=\"p-4 text-center text-muted-foreground\">\n            <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto mb-2\"></div>\n            Loading notifications...\n          </div>\n        )}\n\n        {/* Error State */}\n        {error && (\n          <div className=\"p-4 text-center text-red-600\">\n            <AlertTriangle className=\"h-6 w-6 mx-auto mb-2\" />\n            Failed to load notifications\n          </div>\n        )}\n\n        {/* Notifications List */}\n        {!isLoading && !error && (\n          <ScrollArea className=\"max-h-96\">\n            {sortedNotifications.length === 0 ? (\n              <div className=\"p-8 text-center text-muted-foreground\">\n                <Bell className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p className=\"text-sm\">No notifications</p>\n                <p className=\"text-xs mt-1\">You're all caught up!</p>\n              </div>\n            ) : (\n              <div className=\"p-2\">\n                {sortedNotifications.map((notification: Notification) => {\n                  const config =\n                    notificationConfig[\n                      notification.type as keyof typeof notificationConfig\n                    ];\n                  const priorityStyle = priorityConfig[notification.priority];\n\n                  return (\n                    <DropdownMenuItem\n                      key={notification.id}\n                      className={`flex items-start gap-3 p-3 rounded-lg cursor-pointer transition-all hover:bg-muted/50 ${\n                        !notification.read\n                          ? `${config?.bgColor} ${config?.borderColor} border-l-4`\n                          : \"\"\n                      } ${\n                        notification.priority === \"critical\"\n                          ? \"ring-1 ring-red-200\"\n                          : \"\"\n                      }`}\n                      onClick={() => handleNotificationClick(notification)}\n                    >\n                      <div className=\"flex-shrink-0 mt-1\">\n                        <div\n                          className={`w-8 h-8 rounded-full flex items-center justify-center ${config?.bgColor}`}\n                        >\n                          {getNotificationIcon(notification.type)}\n                        </div>\n                      </div>\n\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-start justify-between gap-2\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2 mb-1\">\n                              <h4\n                                className={`text-sm font-medium truncate ${\n                                  !notification.read ? \"font-semibold\" : \"\"\n                                }`}\n                              >\n                                {notification.title}\n                              </h4>\n                              {!notification.read && (\n                                <div className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0\" />\n                              )}\n                            </div>\n                            <p className=\"text-xs text-muted-foreground line-clamp-2 mb-2\">\n                              {notification.description}\n                            </p>\n                            <div className=\"flex items-center justify-between\">\n                              <div className=\"flex items-center gap-2\">\n                                <div className=\"flex items-center gap-1\">\n                                  <Clock className=\"h-3 w-3 text-muted-foreground\" />\n                                  <span className=\"text-xs text-muted-foreground\">\n                                    {formatTimeAgo(notification.timestamp)}\n                                  </span>\n                                </div>\n                                {notification.priority !== \"low\" && (\n                                  <Badge\n                                    variant=\"outline\"\n                                    className={`text-xs h-4 px-1 ${priorityStyle.textColor}`}\n                                  >\n                                    <div\n                                      className={`w-2 h-2 rounded-full mr-1 ${priorityStyle.color}`}\n                                    />\n                                    {priorityStyle.label}\n                                  </Badge>\n                                )}\n                              </div>\n                              {notification.actionUrl && (\n                                <ArrowRight className=\"h-3 w-3 text-muted-foreground\" />\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </DropdownMenuItem>\n                  );\n                })}\n              </div>\n            )}\n          </ScrollArea>\n        )}\n\n        {/* Footer */}\n        {sortedNotifications.length > 0 && (\n          <>\n            <Separator />\n            <div className=\"p-2\">\n              <Button\n                variant=\"ghost\"\n                className=\"w-full text-sm justify-center\"\n                onClick={() => {\n                  window.location.href = \"/notifications\";\n                  setIsOpen(false);\n                }}\n              >\n                View All Notifications\n              </Button>\n            </div>\n          </>\n        )}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","path":null,"size_bytes":15637,"size_tokens":null},"client/src/components/product-form.tsx":{"content":"import React, { useEffect, useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertProductSchema } from \"@shared/schema\";\nimport {\n  Form,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport MediaLibrary from \"./media-library\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Calculator, Plus, Trash2 } from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { useUnits } from \"@/hooks/useUnits\";\nimport { z } from \"zod\";\n\nconst productFormSchema = insertProductSchema.extend({\n  categoryId: z.string().optional(),\n  unitId: z.string().optional(),\n  price: z.string().min(1, \"Price is required\"),\n  cost: z.string().min(1, \"Cost is required\"),\n  margin: z.string().min(1, \"Margin is required\"),\n  netWeight: z.string().default(\"0\"),\n  // Cost calculator fields\n  batchSize: z.string().default(\"1\"),\n  finishedGoodRequired: z.string().default(\"1\"),\n  productionQuantity: z.string().default(\"1\"),\n  normalLossMfg: z.string().default(\"5\"),\n  normalLossOnSold: z.string().default(\"0\"),\n  mfgAndPackagingCost: z.string().default(\"45\"),\n  overheadCost: z.string().default(\"5\"),\n  ingredients: z\n    .array(\n      z.object({\n        inventoryItemId: z.string().min(1, \"Ingredient is required\"),\n        quantity: z.string().min(1, \"Quantity is required\"),\n      }),\n    )\n    .default([]),\n});\n\ninterface ProductFormProps {\n  product?: any;\n  onSuccess?: () => void;\n}\n\nexport default function ProductForm({ product, onSuccess }: ProductFormProps) {\n  const [showMediaLibrary, setShowMediaLibrary] = useState(false);\n  const [selectedImage, setSelectedImage] = useState<string>(\"\");\n  const [activeTab, setActiveTab] = useState(\"basic\");\n  const [calculations, setCalculations] = useState({\n    subTotalForBatch: 0,\n    totalForProduction: 0,\n    effectiveUnits: 0,\n    rmCostPerUnit: 0,\n    effectiveUnitsProduced: 0,\n    estimatedCostPerUnit: 0,\n    mfgCostPerUnit: 0,\n    overheadCostPerUnit: 0,\n    finalCostPerUnit: 0,\n  });\n  const { toast } = useToast();\n  const { symbol, formatCurrency } = useCurrency();\n\n  const { data: categoriesResponse, isLoading: categoriesLoading } = useQuery({\n    queryKey: [\"categories\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/categories\"),\n  });\n\n  // Handle both response formats: { success: true, data: [...] } and direct array\n  const categories = Array.isArray(categoriesResponse) \n    ? categoriesResponse \n    : (categoriesResponse?.data || []);\n\n  const { data: units = [], isLoading: unitsLoading } = useUnits();\n\n  const { data: inventoryItems = [] } = useQuery({\n    queryKey: [\"/api/inventory/all\"],\n    queryFn: () => apiRequest(\"GET\", \"/api/inventory/all\"),\n  });\n\n  const form = useForm({\n    resolver: zodResolver(productFormSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      categoryId: \"\",\n      unitId: \"\",\n      price: \"\",\n      cost: \"\",\n      margin: \"\",\n      netWeight: \"0\",\n      sku: \"\",\n      batchSize: \"1\",\n      finishedGoodRequired: \"1\",\n      productionQuantity: \"1\",\n      normalLossMfg: \"5\",\n      normalLossOnSold: \"0\",\n      mfgAndPackagingCost: \"45\",\n      overheadCost: \"5\",\n      ingredients: [],\n    },\n  });\n\n  const { fields, append, remove } = useFieldArray({\n    control: form.control,\n    name: \"ingredients\",\n  });\n\n  useEffect(() => {\n    if (product) {\n      form.reset({\n        name: product.name || \"\",\n        description: product.description || \"\",\n        categoryId: product.categoryId?.toString() || \"\",\n        unitId: product.unitId?.toString() || \"\",\n        price: product.price?.toString() || \"\",\n        cost: product.cost?.toString() || \"\",\n        margin: product.margin?.toString() || \"\",\n        netWeight: product.netWeight?.toString() || \"0\",\n        sku: product.sku || \"\",\n        batchSize: \"1\",\n        finishedGoodRequired: \"1\",\n        productionQuantity: \"1\",\n        normalLossMfg: \"5\",\n        normalLossOnSold: \"0\",\n        mfgAndPackagingCost: \"45\",\n        overheadCost: \"5\",\n        ingredients: [],\n      });\n      setSelectedImage(product.imageUrl || \"\");\n    }\n  }, [product, form]);\n\n  const mutation = useMutation({\n    mutationFn: async (data: any) => {\n      const transformedData = {\n        ...data,\n        categoryId: data.categoryId ? parseInt(data.categoryId) : null,\n        unitId: data.unitId ? parseInt(data.unitId) : null,\n        price: data.price.toString(),\n        cost: data.cost.toString(),\n        margin: data.margin.toString(),\n        netWeight: (data.netWeight || \"0\").toString(),\n        imageUrl: selectedImage || null,\n      };\n\n      if (product) {\n        await apiRequest(\"PUT\", `/api/products/${product.id}`, transformedData);\n      } else {\n        await apiRequest(\"POST\", \"/api/products\", transformedData);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"products\"] });\n      // Also refetch immediately to ensure UI updates\n      queryClient.refetchQueries({ queryKey: [\"products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n      toast({\n        title: \"Success\",\n        description: product\n          ? \"Product updated successfully\"\n          : \"Product created successfully\",\n      });\n      onSuccess?.();\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: product\n          ? \"Failed to update product\"\n          : \"Failed to create product\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const calculateMargin = () => {\n    const price = parseFloat(form.getValues(\"price\") || \"0\");\n    const cost = parseFloat(form.getValues(\"cost\") || \"0\");\n\n    if (price > 0 && cost > 0) {\n      const margin = price - cost;\n      form.setValue(\"margin\", margin.toFixed(2));\n    }\n  };\n\n  const calculateCosts = () => {\n    const formData = form.getValues();\n    const ingredients = formData.ingredients || [];\n\n    if (ingredients.length === 0) return;\n\n    const batchSize = parseFloat(formData.batchSize || \"1\");\n    const finishedGoodRequired = parseFloat(\n      formData.finishedGoodRequired || \"1\",\n    );\n    const productionQuantity = parseFloat(formData.productionQuantity || \"1\");\n    const normalLossMfg = parseFloat(formData.normalLossMfg || \"5\");\n    const normalLossOnSold = parseFloat(formData.normalLossOnSold || \"0\");\n    const mfgAndPackagingCost = parseFloat(\n      formData.mfgAndPackagingCost || \"45\",\n    );\n    const overheadCost = parseFloat(formData.overheadCost || \"5\");\n\n    let subTotalForBatch = 0;\n\n    ingredients.forEach((ingredient: any) => {\n      const item = (inventoryItems as any[]).find(\n        (item: any) => item.id.toString() === ingredient.inventoryItemId,\n      );\n      if (item) {\n        const quantity = parseFloat(ingredient.quantity || \"0\");\n        const cost = parseFloat(item.costPerUnit || \"0\");\n        subTotalForBatch += quantity * cost;\n      }\n    });\n\n    const totalForProduction = subTotalForBatch * productionQuantity;\n    const totalForProductionGm = totalForProduction / 1000;\n    const effectiveUnits = batchSize * productionQuantity;\n    const rmCostPerUnit = totalForProduction / effectiveUnits;\n    const effectiveUnitsProduced = effectiveUnits * (1 - normalLossMfg / 100);\n    const estimatedCostPerUnit = totalForProduction / effectiveUnitsProduced;\n    const mfgCostPerUnit = estimatedCostPerUnit * (mfgAndPackagingCost / 100);\n    const overheadCostPerUnit = estimatedCostPerUnit * (overheadCost / 100);\n    const finalCostPerUnit =\n      estimatedCostPerUnit + mfgCostPerUnit + overheadCostPerUnit;\n\n    setCalculations({\n      subTotalForBatch,\n      totalForProduction,\n      effectiveUnits,\n      rmCostPerUnit,\n      effectiveUnitsProduced,\n      estimatedCostPerUnit,\n      mfgCostPerUnit,\n      overheadCostPerUnit,\n      finalCostPerUnit,\n    });\n\n    // Auto-update cost field\n    form.setValue(\"cost\", finalCostPerUnit.toFixed(2));\n  };\n\n  useEffect(() => {\n    calculateCosts();\n  }, [\n    form.watch(\"ingredients\"),\n    form.watch(\"batchSize\"),\n    form.watch(\"productionQuantity\"),\n    form.watch(\"normalLossMfg\"),\n    form.watch(\"mfgAndPackagingCost\"),\n    form.watch(\"overheadCost\"),\n  ]);\n\n  return (\n    <Form {...form}>\n      <form\n        onSubmit={form.handleSubmit((data) => mutation.mutate(data))}\n        className=\"space-y-6\"\n      >\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <TabsContent value=\"basic\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Product Details</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Product Name</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Bread\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"categoryId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Category</FormLabel>\n                        <Select\n                          onValueChange={field.onChange}\n                          value={field.value}\n                        >\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select a category\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {categories.map((category: any) => (\n                              <SelectItem\n                                key={category.id}\n                                value={category.id.toString()}\n                              >\n                                {category.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"unitId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Unit</FormLabel>\n                        <Select\n                          onValueChange={field.onChange}\n                          value={field.value}\n                        >\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select a unit\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {categoriesLoading ? (\n                              <SelectItem value=\"loading\" disabled>\n                                Loading units...\n                              </SelectItem>\n                            ) : Array.isArray(units) && units.length > 0 ? (\n                              units\n                                .filter((unit: any) => unit.isActive)\n                                .map((unit: any) => (\n                                  <SelectItem\n                                    key={unit.id}\n                                    value={unit.id.toString()}\n                                  >\n                                    {unit.name} ({unit.abbreviation})\n                                  </SelectItem>\n                                ))\n                            ) : (\n                              <SelectItem value=\"none\" disabled>\n                                No units available\n                              </SelectItem>\n                            )}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"sku\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>SKU (Optional)</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"350G\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"netWeight\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Net Weight (in grams)</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          step=\"0.01\" \n                          placeholder=\"0\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Product Image */}\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Product Image</label>\n                  <div className=\"flex items-center gap-4\">\n                    {selectedImage ? (\n                      <div className=\"relative\">\n                        <img\n                          src={selectedImage}\n                          alt=\"Product\"\n                          className=\"w-20 h-20 object-cover rounded-lg border\"\n                        />\n                        <Button\n                          type=\"button\"\n                          size=\"sm\"\n                          variant=\"destructive\"\n                          className=\"absolute -top-2 -right-2 h-6 w-6 p-0\"\n                          onClick={() => setSelectedImage(\"\")}\n                        >\n                          √ó\n                        </Button>\n                      </div>\n                    ) : (\n                      <div className=\"w-20 h-20 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center\">\n                        <i className=\"fas fa-image text-gray-400 text-xl\"></i>\n                      </div>\n                    )}\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => setShowMediaLibrary(true)}\n                      className=\"gap-2\"\n                    >\n                      <i className=\"fas fa-upload\"></i>\n                      {selectedImage ? \"Change Image\" : \"Select Image\"}\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"cost\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Cost Price ({symbol})</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            {...field}\n                            onBlur={() => {\n                              field.onBlur();\n                              calculateMargin();\n                            }}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"price\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Selling Price ({symbol})</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            {...field}\n                            onBlur={() => {\n                              field.onBlur();\n                              calculateMargin();\n                            }}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"margin\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Margin Price ({symbol})</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            {...field}\n                            readOnly\n                            className=\"bg-gray-50\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Textarea placeholder=\"Making Process...\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex justify-end space-x-2 pt-4\">\n                  <Button type=\"button\" variant=\"outline\" onClick={onSuccess}>\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\" disabled={mutation.isPending}>\n                    {mutation.isPending && (\n                      <i className=\"fas fa-spinner fa-spin mr-2\"></i>\n                    )}\n                    {product ? \"Update\" : \"Create\"} Product\n                  </Button>\n                </div>\n\n                <MediaLibrary\n                  isOpen={showMediaLibrary}\n                  onClose={() => setShowMediaLibrary(false)}\n                  onSelect={(imageUrl) => setSelectedImage(imageUrl)}\n                />\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </form>\n    </Form>\n  );\n}\n","path":null,"size_bytes":20113,"size_tokens":null},"client/src/hooks/useCurrency.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\nconst CURRENCY_SYMBOLS = {\n  USD: \"$\",\n  EUR: \"‚Ç¨\",\n  GBP: \"¬£\",\n  NPR: \"Rs. \",\n  INR: \"‚Çπ\",\n  CAD: \"C$\",\n  AUD: \"A$\",\n  JPY: \"¬•\",\n  CNY: \"¬•\",\n  KRW: \"‚Ç©\",\n};\n\nexport function useCurrency() {\n  const { data: settings = {} } = useQuery({\n    queryKey: [\"/api/settings\"],\n  });\n\n  const currency = settings.currency || \"NPR\";\n  const symbol =\n    CURRENCY_SYMBOLS[currency as keyof typeof CURRENCY_SYMBOLS] || \"Rs. \";\n\n  const formatCurrency = (amount: number | string) => {\n    const numAmount = typeof amount === \"string\" ? parseFloat(amount) : amount;\n    return `${symbol}${numAmount.toFixed(2)}`;\n  };\n\n  const formatCurrencyWithCommas = (amount: number | string) => {\n    const numAmount = typeof amount === \"string\" ? parseFloat(amount) : amount;\n    return `${symbol}${numAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n  };\n\n  const formatCurrencyInput = (amount: number | string) => {\n    const numAmount = typeof amount === \"string\" ? parseFloat(amount) : amount;\n    if (isNaN(numAmount)) return \"\";\n    return numAmount.toFixed(2);\n  };\n\n  const parseCurrency = (value: string) => {\n    const cleanValue = value.replace(/[^\\d.-]/g, \"\");\n    return parseFloat(cleanValue) || 0;\n  };\n\n  return {\n    currency,\n    symbol,\n    formatCurrency,\n    formatCurrencyWithCommas,\n    formatCurrencyInput,\n    parseCurrency,\n  };\n}\n","path":null,"size_bytes":1432,"size_tokens":null},"client/src/pages/sales-returns.tsx":{"content":"\"use client\";\n\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { LoadingSpinner } from \"@/components/ui/loading-spinner\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { format } from \"date-fns\";\nimport { useUnits } from \"@/hooks/useUnits\";\n\ninterface SalesReturn {\n  id: number;\n  serialNumber: number;\n  productId: number;\n  productName: string;\n  quantity: number;\n  unitId: number;\n  unitName: string;\n  ratePerUnit: number;\n  amount: number;\n  returnDate: string;\n  saleId?: number;\n  customerId?: number;\n  returnReason: string;\n  isDayClosed: boolean;\n  notes?: string;\n  createdAt: string;\n}\n\ninterface DailySalesReturnSummary {\n  summaryDate: string;\n  totalItems: number;\n  totalQuantity: number;\n  totalLoss: number;\n  isDayClosed: boolean;\n  closedBy?: string;\n  closedAt?: string;\n}\n\nexport default function SalesReturns() {\n  const [selectedDate, setSelectedDate] = useState(\n    format(new Date(), \"yyyy-MM-dd\"),\n  );\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingReturn, setEditingReturn] = useState<SalesReturn | null>(null);\n  const [formData, setFormData] = useState({\n    productId: \"\",\n    quantity: \"\",\n    unitId: \"\",\n    ratePerUnit: \"\",\n    returnReason: \"damaged\",\n    customerId: \"\",\n    saleId: \"\",\n    notes: \"\",\n  });\n\n  const { toast } = useToast();\n  const { formatCurrency } = useCurrency();\n  const queryClient = useQueryClient();\n  const { units: fetchedUnits = [] } = useUnits(); // Use the hook to get units\n\n  // Fetch products\n  const { data: products = [], isLoading: productsLoading } = useQuery({\n    queryKey: [\"products\"],\n    queryFn: async () => {\n      try {\n        const res = await apiRequest(\"GET\", \"/api/products\");\n        return Array.isArray(res) ? res : (res?.data || res?.products || []);\n      } catch (error) {\n        console.error(\"Failed to fetch products:\", error);\n        return [];\n      }\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Fetch customers\n  const { data: customers = [] } = useQuery({\n    queryKey: [\"customers\"],\n    queryFn: async () => {\n      try {\n        const res = await apiRequest(\"GET\", \"/api/customers\");\n        console.log(\"Customers response:\", res);\n        if (Array.isArray(res)) return res;\n        if (res?.data && Array.isArray(res.data)) return res.data;\n        if (res?.customers && Array.isArray(res.customers)) return res.customers;\n        return [];\n      } catch (error) {\n        console.error(\"Failed to fetch customers:\", error);\n        return [];\n      }\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Fetch sales returns for selected date\n  const { data: salesReturns = [], isLoading: salesReturnsLoading } =\n    useQuery({\n      queryKey: [\"sales-returns\", selectedDate],\n      queryFn: async () => {\n        try {\n          const res = await apiRequest(\n            \"GET\",\n            `/api/sales-returns?date=${selectedDate}`,\n          );\n          return res?.data || [];\n        } catch (error) {\n          console.error(\"Failed to fetch sales returns:\", error);\n          return [];\n        }\n      },\n      retry: (failureCount, error) =>\n        !isUnauthorizedError(error) && failureCount < 3,\n    });\n\n  // Fetch daily summary\n  const { data: dailySummary } = useQuery({\n    queryKey: [\"sales-returns-summary\", selectedDate],\n    queryFn: async () => {\n      try {\n        const res = await apiRequest(\n          \"GET\",\n          `/api/sales-returns/summary/${selectedDate}`,\n        );\n        return res?.data || null;\n      } catch (error) {\n        console.error(\"Failed to fetch daily summary:\", error);\n        return null;\n      }\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Define helper functions first\n  const handleSuccess = (msg: string) => {\n    setIsDialogOpen(false);\n    resetForm();\n    queryClient.invalidateQueries({ queryKey: [\"sales-returns\"] });\n    queryClient.invalidateQueries({ queryKey: [\"sales-returns-summary\"] });\n    toast({ title: \"Success\", description: msg });\n  };\n\n  const handleError = (\n    error: unknown,\n    variables: any,\n    context: unknown,\n  ) => {\n    console.error(\"Mutation error:\", error);\n\n    let message = \"Failed to process request.\";\n\n    if (error && typeof error === \"object\") {\n      const err = error as Record<string, any>;\n      if (err.response?.data?.message) {\n        message = err.response.data.message;\n      } else if (err.message) {\n        message = err.message;\n      }\n    }\n\n    if (isUnauthorizedError(error)) {\n      toast({\n        title: \"Session Expired\",\n        description: \"Redirecting to login...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => (window.location.href = \"/login\"), 1000);\n      return;\n    }\n\n    toast({\n      title: \"Error\",\n      description: message,\n      variant: \"destructive\",\n    });\n  };\n\n  // Create mutation\n  const createMutation = useMutation({\n    mutationFn: (data: any) => apiRequest(\"POST\", \"/api/sales-returns\", data),\n    onSuccess: () => {\n      handleSuccess(\"Sales return entry created successfully\");\n    },\n    onError: handleError,\n  });\n\n  // Update mutation\n  const updateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) =>\n      apiRequest(\"PUT\", `/api/sales-returns/${id}`, data),\n    onSuccess: () => {\n      handleSuccess(\"Sales return entry updated successfully\");\n    },\n    onError: handleError,\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) =>\n      apiRequest(\"DELETE\", `/api/sales-returns/${id}`),\n    onSuccess: () => {\n      handleSuccess(\"Sales return entry deleted successfully\");\n    },\n    onError: handleError,\n  });\n\n  // Close day mutation\n  const closeDayMutation = useMutation({\n    mutationFn: (date: string) =>\n      apiRequest(\"POST\", \"/api/sales-returns/close-day\", { date }),\n    onSuccess: () => {\n      handleSuccess(\"Day closed successfully.\");\n    },\n    onError: handleError,\n  });\n\n  // Reopen day mutation\n  const reopenDayMutation = useMutation({\n    mutationFn: (date: string) =>\n      apiRequest(\"POST\", \"/api/sales-returns/reopen-day\", { date }),\n    onSuccess: () => {\n      handleSuccess(\"Day reopened successfully.\");\n    },\n    onError: handleError,\n  });\n\n  const isDayClosed = dailySummary?.isDayClosed || false;\n  const canModify = !isDayClosed;\n\n  // Calculate amount\n  const calculatedAmount = useMemo(() => {\n    const qty = parseFloat(formData.quantity) || 0;\n    const rate = parseFloat(formData.ratePerUnit) || 0;\n    return qty * rate;\n  }, [formData.quantity, formData.ratePerUnit]);\n\n  const resetForm = () => {\n    setFormData({\n      productId: \"\",\n      quantity: \"\",\n      unitId: \"\",\n      ratePerUnit: \"\",\n      returnReason: \"damaged\",\n      customerId: \"\",\n      saleId: \"\",\n      notes: \"\",\n    });\n    setEditingReturn(null);\n  };\n\n  const handleEdit = (returnItem: SalesReturn) => {\n    setEditingReturn(returnItem);\n    setFormData({\n      productId: returnItem.productId.toString(),\n      quantity: returnItem.quantity.toString(),\n      unitId: returnItem.unitId.toString(),\n      ratePerUnit: returnItem.ratePerUnit.toString(),\n      returnReason: returnItem.returnReason,\n      customerId: returnItem.customerId?.toString() || \"\",\n      saleId: returnItem.saleId?.toString() || \"\",\n      notes: returnItem.notes || \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (\n      !formData.productId ||\n      !formData.quantity ||\n      !formData.unitId ||\n      !formData.ratePerUnit\n    ) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fill all required fields.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const selectedProduct = products.find(\n      (p) => p.id.toString() === formData.productId,\n    );\n    const selectedUnit = fetchedUnits.find((u) => u.id.toString() === formData.unitId); // Use fetchedUnits\n\n    if (!selectedProduct || !selectedUnit) {\n      toast({\n        title: \"Invalid Selection\",\n        description: \"Please select valid product and unit.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const payload = {\n      productId: parseInt(formData.productId),\n      productName: selectedProduct.name,\n      quantity: parseFloat(formData.quantity),\n      unitId: parseInt(formData.unitId),\n      unitName: selectedUnit.name,\n      ratePerUnit: parseFloat(formData.ratePerUnit),\n      returnDate: selectedDate,\n      returnReason: formData.returnReason,\n      customerId: formData.customerId ? parseInt(formData.customerId) : null,\n      saleId: formData.saleId ? parseInt(formData.saleId) : null,\n      notes: formData.notes,\n    };\n\n    if (editingReturn) {\n      updateMutation.mutate({ id: editingReturn.id, data: payload });\n    } else {\n      createMutation.mutate(payload);\n    }\n  };\n\n  const handleDelete = (id: number) => {\n    deleteMutation.mutate(id);\n  };\n\n  return (\n    <div className=\"p-6 space-y-6 max-w-7xl mx-auto\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600 mt-1\">\n            {format(new Date(selectedDate), \"EEEE, MMMM do, yyyy\")}\n          </p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <Input\n            type=\"date\"\n            value={selectedDate}\n            onChange={(e) => setSelectedDate(e.target.value)}\n            className=\"w-auto border-gray-300\"\n          />\n          {canModify && (\n            <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n              <DialogTrigger asChild>\n                <Button\n                  onClick={() => {\n                    resetForm();\n                  }}\n                  className=\"bg-red-600 hover:bg-red-700 text-white\"\n                >\n                  + Add Sales Return\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-2xl\">\n                <DialogHeader>\n                  <DialogTitle>\n                    {editingReturn ? \"Edit\" : \"Add\"} Sales Return\n                  </DialogTitle>\n                </DialogHeader>\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <Label>Product *</Label>\n                      <Select\n                        value={formData.productId}\n                        onValueChange={(val) => {\n                          const product = products.find((p) => p.id.toString() === val);\n                          setFormData((prev) => ({ \n                            ...prev, \n                            productId: val,\n                            unitId: product?.unitId?.toString() || \"\",\n                            ratePerUnit: product?.price?.toString() || \"0\", // Using sales price\n                          }));\n                        }}\n                        disabled={productsLoading}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select product\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {products.map((p) => (\n                            <SelectItem key={p.id} value={p.id.toString()}>\n                              {p.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label>Unit *</Label>\n                      <Select\n                        value={formData.unitId}\n                        onValueChange={(val) =>\n                          setFormData((prev) => ({ ...prev, unitId: val }))\n                        }\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select unit\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {fetchedUnits.map((u) => ( // Use fetchedUnits\n                            <SelectItem key={u.id} value={u.id.toString()}>\n                              {u.name} ({u.abbreviation})\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label>Quantity *</Label>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        min=\"0\"\n                        value={formData.quantity}\n                        onChange={(e) =>\n                          setFormData((prev) => ({\n                            ...prev,\n                            quantity: e.target.value,\n                          }))\n                        }\n                        required\n                      />\n                    </div>\n\n                    <div>\n                      <Label>Rate per Unit *</Label>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        min=\"0\"\n                        value={formData.ratePerUnit}\n                        onChange={(e) =>\n                          setFormData((prev) => ({\n                            ...prev,\n                            ratePerUnit: e.target.value,\n                          }))\n                        }\n                        required\n                      />\n                    </div>\n\n                    <div>\n                      <Label>Return Reason</Label>\n                      <Select\n                        value={formData.returnReason}\n                        onValueChange={(val) =>\n                          setFormData((prev) => ({ ...prev, returnReason: val }))\n                        }\n                      >\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"damaged\">Damaged</SelectItem>\n                          <SelectItem value=\"expired\">Expired</SelectItem>\n                          <SelectItem value=\"wrong_product\">Wrong Product</SelectItem>\n                          <SelectItem value=\"customer_request\">Customer Request</SelectItem>\n                          <SelectItem value=\"quality_issue\">Quality Issue</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label>Customer (Optional)</Label>\n                      <Select\n                        value={formData.customerId}\n                        onValueChange={(val) =>\n                          setFormData((prev) => ({ ...prev, customerId: val }))\n                        }\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select customer\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {customers.map((c) => (\n                            <SelectItem key={c.id} value={c.id.toString()}>\n                              {c.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n\n                  <div>\n                    <Label>Calculated Amount</Label>\n                    <div className=\"p-3 bg-red-50 rounded-lg border border-red-200\">\n                      <span className=\"text-lg font-semibold text-red-700\">\n                        {formatCurrency(calculatedAmount)}\n                      </span>\n                    </div>\n                  </div>\n\n                  <div>\n                    <Label>Notes</Label>\n                    <Textarea\n                      value={formData.notes}\n                      onChange={(e) =>\n                        setFormData((prev) => ({\n                          ...prev,\n                          notes: e.target.value,\n                        }))\n                      }\n                      rows={3}\n                      placeholder=\"Optional details...\"\n                    />\n                  </div>\n\n                  <div className=\"flex justify-end gap-2 pt-4\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => setIsDialogOpen(false)}\n                    >\n                      Cancel\n                    </Button>\n                    <Button\n                      type=\"submit\"\n                      disabled={\n                        createMutation.isPending || updateMutation.isPending\n                      }\n                    >\n                      {createMutation.isPending || updateMutation.isPending\n                        ? \"Saving...\"\n                        : \"Save\"}\n                    </Button>\n                  </div>\n                </form>\n              </DialogContent>\n            </Dialog>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total Items</p>\n                <p className=\"text-xl font-bold\">\n                  {dailySummary?.totalItems || 0}\n                </p>\n              </div>\n              <svg\n                className=\"w-8 h-8 text-blue-500\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth=\"2\"\n                  d=\"M20 7l-8-4-8 4m16 0v10l-8 4-8-4V7\"\n                />\n              </svg>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total Quantity</p>\n                <p className=\"text-xl font-bold\">\n                  {dailySummary?.totalQuantity || 0}\n                </p>\n              </div>\n              <svg\n                className=\"w-8 h-8 text-orange-500\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth=\"2\"\n                  d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"\n                />\n              </svg>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total Loss</p>\n                <p className=\"text-xl font-bold text-red-600\">\n                  {formatCurrency(dailySummary?.totalLoss || 0)}\n                </p>\n              </div>\n              <svg\n                className=\"w-8 h-8 text-red-500\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth=\"2\"\n                  d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\"\n                />\n              </svg>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Status</p>\n                <Badge variant={isDayClosed ? \"destructive\" : \"default\"}>\n                  {isDayClosed ? \"Closed\" : \"Open\"}\n                </Badge>\n              </div>\n              {isDayClosed ? (\n                <svg\n                  className=\"w-8 h-8 text-red-500\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth=\"2\"\n                    d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"\n                  />\n                </svg>\n              ) : (\n                <svg\n                  className=\"w-8 h-8 text-green-500\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth=\"2\"\n                    d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"\n                  />\n                </svg>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Day Management */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"font-semibold\">Day Status</h3>\n              <p className=\"text-sm text-gray-600\">\n                {isDayClosed\n                  ? \"This day is closed. No new entries allowed.\"\n                  : \"You can add or edit sales returns.\"}\n              </p>\n            </div>\n            <div className=\"flex gap-2\">\n              {!isDayClosed ? (\n                <AlertDialog>\n                  <AlertDialogTrigger asChild>\n                    <Button\n                      variant=\"destructive\"\n                      disabled={salesReturns.length === 0}\n                    >\n                      üîí Close Day\n                    </Button>\n                  </AlertDialogTrigger>\n                  <AlertDialogContent>\n                    <AlertDialogHeader>\n                      <AlertDialogTitle>Close Day?</AlertDialogTitle>\n                      <AlertDialogDescription>\n                        Are you sure you want to close this day? You won't be\n                        able to add more entries unless reopened.\n                        <br />\n                        <strong>\n                          Total Loss:{\" \"}\n                          {formatCurrency(dailySummary?.totalLoss || 0)}\n                        </strong>\n                      </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                      <AlertDialogCancel>Cancel</AlertDialogCancel>\n                      <AlertDialogAction\n                        onClick={() => closeDayMutation.mutate(selectedDate)}\n                      >\n                        {closeDayMutation.isPending\n                          ? \"Closing...\"\n                          : \"Yes, Close\"}\n                      </AlertDialogAction>\n                    </AlertDialogFooter>\n                  </AlertDialogContent>\n                </AlertDialog>\n              ) : (\n                <AlertDialog>\n                  <AlertDialogTrigger asChild>\n                    <Button variant=\"outline\">üîì Reopen Day</Button>\n                  </AlertDialogTrigger>\n                  <AlertDialogContent>\n                    <AlertDialogHeader>\n                      <AlertDialogTitle>Reopen Day?</AlertDialogTitle>\n                      <AlertDialogDescription>\n                        This will allow adding or editing sales return entries\n                        again.\n                      </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                      <AlertDialogCancel>Cancel</AlertDialogCancel>\n                      <AlertDialogAction\n                        onClick={() => reopenDayMutation.mutate(selectedDate)}\n                      >\n                        {reopenDayMutation.isPending\n                          ? \"Reopening...\"\n                          : \"Yes, Reopen\"}\n                      </AlertDialogAction>\n                    </AlertDialogFooter>\n                  </AlertDialogContent>\n                </AlertDialog>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Sales Returns Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>\n            Sales Returns{\" \"}\n            <Badge variant=\"secondary\">{salesReturns.length} items</Badge>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {salesReturnsLoading ? (\n            <LoadingSpinner message=\"Loading...\" />\n          ) : salesReturns.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500\">\n              No sales returns recorded.\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>S.N</TableHead>\n                  <TableHead>Product</TableHead>\n                  <TableHead className=\"text-right\">Qty</TableHead>\n                  <TableHead>Unit</TableHead>\n                  <TableHead className=\"text-right\">Rate</TableHead>\n                  <TableHead className=\"text-right\">Amount</TableHead>\n                  <TableHead>Reason</TableHead>\n                  <TableHead>Notes</TableHead>\n                  {canModify && <TableHead>Actions</TableHead>}\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {salesReturns.map((item) => (\n                  <TableRow key={item.id}>\n                    <TableCell>{item.serialNumber}</TableCell>\n                    <TableCell className=\"font-medium\">\n                      {item.productName}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {item.quantity}\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant=\"outline\">{item.unitName}</Badge>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.ratePerUnit)}\n                    </TableCell>\n                    <TableCell className=\"text-right font-medium text-red-600\">\n                      {formatCurrency(item.amount)}\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant=\"secondary\">\n                        {item.returnReason.replace('_', ' ')}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>{item.notes || \"‚Äî\"}</TableCell>\n                    {canModify && (\n                      <TableCell>\n                        <div className=\"flex gap-2\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => handleEdit(item)}\n                          >\n                            ‚úèÔ∏è\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => handleDelete(item.id)}\n                            disabled={deleteMutation.isPending}\n                          >\n                            üóëÔ∏è\n                          </Button>\n                        </div>\n                      </TableCell>\n                    )}\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","path":null,"size_bytes":29573,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/pages/expenses.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport SearchBar from \"@/components/search-bar\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n  usePagination,\n} from \"@/components/ui/pagination\";\n\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Plus, Search, Edit, Trash2, Receipt } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\n\nexport default function Expenses() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [categoryFilter, setCategoryFilter] = useState(\"all\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingExpense, setEditingExpense] = useState<any>(null);\n  const [selectedCategory, setSelectedCategory] = useState(\"\");\n  const { toast } = useToast();\n  const { formatCurrency, formatCurrencyWithCommas } = useCurrency();\n\n  const resetForm = () => {\n    setEditingExpense(null);\n    setSelectedCategory(\"\");\n  };\n\n  // Close dialog handler\n  const handleDialogClose = (open: boolean) => {\n    setIsDialogOpen(open);\n    if (!open) {\n      resetForm();\n    }\n  };\n\n  // ‚úÖ Fixed: Add queryFn and correct queryKey\n  const {\n    data: expenses = [],\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: [\"expenses\"], // ‚úÖ Meaningful key\n    queryFn: () => apiRequest(\"GET\", \"/api/expenses\"), // ‚úÖ Fetch data\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n      } else {\n        toast({\n          title: \"Error\",\n          description: \"Failed to load expenses.\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: any) => apiRequest(\"POST\", \"/api/expenses\", data),\n    onSuccess: (response) => {\n      queryClient.invalidateQueries({ queryKey: [\"expenses\"] });\n      setIsDialogOpen(false);\n      setEditingExpense(null);\n      resetForm();\n      const expenseData = response?.data || response;\n      toast({ title: \"Success\", description: `Expense \"${expenseData.title}\" added successfully` });\n    },\n    onError: (error) => {\n      handleError(error, \"Failed to save expense\");\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) =>\n      apiRequest(\"PUT\", `/api/expenses/${id}`, data),\n    onSuccess: (response) => {\n      queryClient.invalidateQueries({ queryKey: [\"expenses\"] });\n      setIsDialogOpen(false);\n      setEditingExpense(null);\n      resetForm();\n      const expenseData = response?.data || response;\n      toast({ title: \"Success\", description: `Expense \"${expenseData.title}\" updated successfully` });\n    },\n    onError: (error) => {\n      handleError(error, \"Failed to update expense\");\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/expenses/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"expenses\"] });\n      toast({ title: \"Success\", description: \"Expense deleted successfully\" });\n    },\n    onError: (error) => {\n      handleError(error, \"Failed to delete expense\");\n    },\n  });\n\n  // Reuse error handling\n  function handleError(error: any, message: string) {\n    if (isUnauthorizedError(error)) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"Session expired. Redirecting to login...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => (window.location.href = \"/api/login\"), 500);\n      return;\n    }\n    toast({ title: \"Error\", description: message, variant: \"destructive\" });\n  }\n\n  const handleSave = (e: React.FormEvent) => {\n    e.preventDefault();\n    const form = e.target as HTMLFormElement;\n    const formData = new FormData(form);\n\n    const title = (formData.get(\"title\") as string)?.trim();\n    const amountStr = formData.get(\"amount\") as string;\n    const amount = parseFloat(amountStr);\n    const category = selectedCategory?.trim();\n    const dateValue = formData.get(\"date\") as string;\n    const description = (formData.get(\"description\") as string)?.trim();\n\n    if (!title || !category || !amountStr || isNaN(amount) || amount <= 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fill all required fields correctly.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const data = {\n      title,\n      category,\n      amount: amount.toString(),\n      date: dateValue || new Date().toISOString().split('T')[0],\n      description: description || null,\n      paymentMethod: \"cash\",\n    };\n\n    if (editingExpense) {\n      updateMutation.mutate({ id: editingExpense.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const categories = [\n    \"utilities\",\n    \"rent\",\n    \"supplies\",\n    \"marketing\",\n    \"maintenance\",\n    \"equipment\",\n    \"travel\",\n    \"office\",\n    \"other\",\n  ];\n\n  // ‚úÖ Safely filter\n  const filteredExpenses = Array.isArray(expenses)\n    ? expenses.filter((expense: any) => {\n        const matchesSearch =\n          expense.title?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n          expense.description\n            ?.toLowerCase()\n            .includes(searchQuery.toLowerCase());\n        const matchesCategory =\n          categoryFilter === \"all\" || expense.category === categoryFilter;\n        return matchesSearch && matchesCategory;\n      })\n    : [];\n\n  // Add sorting\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredExpenses,\n    \"title\",\n  );\n\n  // Pagination\n  const {\n    currentItems,\n    currentPage,\n    totalPages,\n    pageSize,\n    setPageSize,\n    goToPage,\n    totalItems,\n  } = usePagination(sortedData, 10);\n\n  const getCategoryBadge = (category: string) => {\n    const variants: Record<\n      string,\n      \"default\" | \"secondary\" | \"destructive\" | \"outline\"\n    > = {\n      utilities: \"default\",\n      rent: \"secondary\",\n      supplies: \"outline\",\n      marketing: \"default\",\n      maintenance: \"destructive\",\n      equipment: \"secondary\",\n      travel: \"outline\",\n      office: \"default\",\n      other: \"outline\",\n    };\n    return variants[category] || \"outline\";\n  };\n\n  // Sync selectedCategory when editing\n  useEffect(() => {\n    if (editingExpense) {\n      setSelectedCategory(editingExpense.category);\n    } else {\n      setSelectedCategory(\"\");\n    }\n  }, [editingExpense]);\n\n  if (error && isUnauthorizedError(error)) {\n    toast({\n      title: \"Unauthorized\",\n      description: \"Session expired. Redirecting to login...\",\n      variant: \"destructive\",\n    });\n    setTimeout(() => {\n      window.location.href = \"/api/login\";\n    }, 500);\n    return null;\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600\">\n            Track and manage your business expenses\n          </p>\n        </div>\n        <Dialog\n          open={isDialogOpen}\n          onOpenChange={handleDialogClose}\n        >\n          <DialogTrigger asChild>\n            <Button\n              onClick={() => setEditingExpense(null)}\n              className=\"w-full sm:w-auto\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Expense\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl mx-auto max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Receipt className=\"h-5 w-5\" />\n                {editingExpense ? \"Edit Expense\" : \"Add New Expense\"}\n              </DialogTitle>\n              <DialogDescription>\n                {editingExpense\n                  ? \"Update expense information\"\n                  : \"Record a new business expense with detailed information\"}\n              </DialogDescription>\n            </DialogHeader>\n            <form onSubmit={handleSave} className=\"space-y-6\">\n              {/* Basic Information */}\n              <div className=\"space-y-4\">\n                <h3 className=\"text-lg font-medium\">Expense Details</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"expense-title\">Expense Title *</Label>\n                    <Input\n                      id=\"expense-title\"\n                      name=\"title\"\n                      placeholder=\"e.g. Office Supplies, Electricity Bill\"\n                      defaultValue={editingExpense?.title || \"\"}\n                      required\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"expense-category\">Category *</Label>\n                    <Select\n                      value={selectedCategory}\n                      onValueChange={setSelectedCategory}\n                    >\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select Category\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {categories.map((category) => (\n                          <SelectItem key={category} value={category}>\n                            {category.charAt(0).toUpperCase() +\n                              category.slice(1)}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <input\n                      type=\"hidden\"\n                      name=\"category\"\n                      value={selectedCategory}\n                      required\n                    />\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"expense-amount\">\n                      Amount ({formatCurrency}) *\n                    </Label>\n                    <Input\n                      id=\"expense-amount\"\n                      name=\"amount\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      placeholder=\"0.00\"\n                      defaultValue={editingExpense?.amount || \"\"}\n                      required\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"expense-date\">Date *</Label>\n                    <Input\n                      id=\"expense-date\"\n                      name=\"date\"\n                      type=\"date\"\n                      defaultValue={\n                        editingExpense?.date\n                          ? new Date(editingExpense.date)\n                              .toISOString()\n                              .split(\"T\")[0]\n                          : new Date().toISOString().split(\"T\")[0]\n                      }\n                      required\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Additional Information */}\n              <div className=\"space-y-4\">\n                <div>\n                  <Label htmlFor=\"expense-description\">Description</Label>\n                  <Textarea\n                    id=\"expense-description\"\n                    name=\"description\"\n                    placeholder=\"Additional notes about this expense...\"\n                    defaultValue={editingExpense?.description || \"\"}\n                    rows={3}\n                  />\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                  className=\"w-full sm:w-auto\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={\n                    createMutation.isPending || updateMutation.isPending\n                  }\n                  className=\"w-full sm:w-auto\"\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? editingExpense\n                      ? \"Updating...\"\n                      : \"Saving...\"\n                    : editingExpense\n                      ? \"Update Expense\"\n                      : \"Save Expense\"}\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Expenses List */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n            <CardTitle>Expenses List</CardTitle>\n            <div className=\"flex flex-col sm:flex-row gap-2 w-full sm:w-auto\">\n              <div className=\"w-full sm:w-64\">\n                <SearchBar\n                  placeholder=\"Search expenses...\"\n                  value={searchQuery}\n                  onChange={setSearchQuery}\n                  className=\"w-full\"\n                />\n              </div>\n              <Select value={categoryFilter} onValueChange={setCategoryFilter}>\n                <SelectTrigger className=\"w-full sm:w-48\">\n                  <SelectValue placeholder=\"All Categories\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Categories</SelectItem>\n                  {categories.map((category) => (\n                    <SelectItem key={category} value={category}>\n                      {category.charAt(0).toUpperCase() + category.slice(1)}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"title\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Expense\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"category\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                      className=\"hidden sm:table-cell\"\n                    >\n                      Category\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"amount\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Amount\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"date\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                      className=\"hidden md:table-cell\"\n                    >\n                      Date\n                    </SortableTableHeader>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {sortedData.length > 0 ? (\n                    sortedData.map((expense: any) => (\n                      <TableRow key={expense.id}>\n                        <TableCell>\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center\">\n                              <Receipt className=\"h-4 w-4 text-primary\" />\n                            </div>\n                            <div>\n                              <div className=\"font-medium\">{expense.title}</div>\n                              <div className=\"text-sm text-muted-foreground sm:hidden\">\n                                {expense.category}\n                              </div>\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"hidden sm:table-cell\">\n                          <Badge variant={getCategoryBadge(expense.category)}>\n                            {expense.category?.charAt(0).toUpperCase() +\n                              expense.category?.slice(1)}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"font-medium\">\n                            {formatCurrency(parseFloat(expense.amount || 0))}\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"hidden md:table-cell\">\n                          {new Date(expense.date).toLocaleDateString()}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex space-x-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => {\n                                setEditingExpense(expense);\n                                setSelectedCategory(expense.category || \"\");\n                                setIsDialogOpen(true);\n                              }}\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <DeleteConfirmationDialog\n                              trigger={\n                                <Button variant=\"ghost\" size=\"sm\">\n                                  <Trash2 className=\"h-4 w-4\" />\n                                </Button>\n                              }\n                              title=\"Delete Expense\"\n                              itemName={expense.title || \"this expense\"}\n                              onConfirm={() =>\n                                deleteMutation.mutate(expense.id)\n                              }\n                              isLoading={deleteMutation.isPending}\n                            />\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  ) : (\n                    <TableRow>\n                      <TableCell colSpan={5} className=\"text-center py-8\">\n                        <Receipt className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                        <h3 className=\"text-lg font-semibold text-muted-foreground mb-2\">\n                          No expenses found\n                        </h3>\n                        <p className=\"text-muted-foreground mb-4\">\n                          {searchQuery || categoryFilter !== \"all\"\n                            ? \"Try adjusting your search criteria\"\n                            : \"Start by adding your first expense\"}\n                        </p>\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n\n          {/* Pagination */}\n          <div className=\"flex flex-col sm:flex-row justify-between items-center gap-4 mt-4\">\n            <PaginationInfo\n              currentPage={currentPage}\n              totalPages={totalPages}\n              totalItems={totalItems}\n            />\n            <div className=\"flex items-center gap-4\">\n              <PageSizeSelector\n                pageSize={pageSize}\n                onPageSizeChange={setPageSize}\n              />\n              <Pagination\n                currentPage={currentPage}\n                totalPages={totalPages}\n                onPageChange={goToPage}\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","path":null,"size_bytes":21559,"size_tokens":null},"client/src/components/layout-wrapper.tsx":{"content":"\nimport React from \"react\";\n\ninterface LayoutWrapperProps {\n  children: React.ReactNode;\n  title?: string;\n  description?: string;\n  className?: string;\n}\n\nexport default function LayoutWrapper({ \n  children, \n  title, \n  description, \n  className = \"\" \n}: LayoutWrapperProps) {\n  return (\n    <div className={`min-h-full ${className}`}>\n      <div className=\"px-4 py-6 sm:px-6 lg:px-8\">\n        {(title || description) && (\n          <div className=\"mb-8\">\n            {title && (\n              <h1 className=\"text-3xl font-bold tracking-tight text-gray-900 mb-2\">\n                {title}\n              </h1>\n            )}\n            {description && (\n              <p className=\"text-lg text-gray-600\">\n                {description}\n              </p>\n            )}\n          </div>\n        )}\n        <div className=\"space-y-6\">\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":902,"size_tokens":null},"client/src/pages/attendance.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Plus, Clock, Edit, Trash2, CalendarDays, Timer } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport SearchBar from \"@/components/search-bar\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { format } from \"date-fns\";\n\nexport default function AttendanceManagement() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedStaff, setSelectedStaff] = useState<string>(\"all\");\n  const [startDate, setStartDate] = useState(\"\");\n  const [endDate, setEndDate] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingRecord, setEditingRecord] = useState<any>(null);\n  const [formData, setFormData] = useState({\n    staffId: \"\",\n    date: \"\",\n    clockIn: \"\",\n    clockOut: \"\",\n    breakStart: \"\",\n    breakEnd: \"\",\n    status: \"present\",\n    notes: \"\",\n  });\n\n  const { toast } = useToast();\n\n  // Set default date range (current week)\n  useEffect(() => {\n    const today = new Date();\n    const startOfWeek = new Date(today);\n    startOfWeek.setDate(today.getDate() - today.getDay());\n    const endOfWeek = new Date(today);\n    endOfWeek.setDate(today.getDate() + (6 - today.getDay()));\n\n    setStartDate(startOfWeek.toISOString().split(\"T\")[0]);\n    setEndDate(endOfWeek.toISOString().split(\"T\")[0]);\n  }, []);\n\n  const { data: staff = [] } = useQuery({\n    queryKey: [\"/api/staff\"],\n  });\n\n  const { data: attendance = [], isLoading } = useQuery({\n    queryKey: [\"/api/attendance\", selectedStaff, startDate, endDate],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (selectedStaff && selectedStaff !== \"all\")\n        params.append(\"staffId\", selectedStaff);\n      if (startDate) params.append(\"startDate\", startDate);\n      if (endDate) params.append(\"endDate\", endDate);\n\n      const result = await apiRequest(\n        \"GET\",\n        `/api/attendance?${params.toString()}`,\n      );\n      return Array.isArray(result) ? result : [];\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      await apiRequest(\"POST\", \"/api/attendance\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Attendance record created successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance\"] });\n      setIsDialogOpen(false);\n      resetForm();\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: any) => {\n      await apiRequest(\"PUT\", `/api/attendance/${editingRecord?.id}`, data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Attendance record updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance\"] });\n      setIsDialogOpen(false);\n      resetForm();\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/attendance/${id}`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Attendance record deleted successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance\"] });\n    },\n  });\n\n  const clockInMutation = useMutation({\n    mutationFn: async (staffId: number) => {\n      await apiRequest(\"POST\", \"/api/attendance/clock-in\", { staffId });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Clocked in successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to clock in\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const clockOutMutation = useMutation({\n    mutationFn: async (staffId: number) => {\n      await apiRequest(\"POST\", \"/api/attendance/clock-out\", { staffId });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Clocked out successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to clock out\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      staffId: \"\",\n      date: \"\",\n      clockIn: \"\",\n      clockOut: \"\",\n      breakStart: \"\",\n      breakEnd: \"\",\n      status: \"present\",\n      notes: \"\",\n    });\n    setEditingRecord(null);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!formData.staffId || !formData.date) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const submitData = { ...formData };\n    if (submitData.clockIn && submitData.clockOut) {\n      const clockIn = new Date(`${submitData.date}T${submitData.clockIn}`);\n      const clockOut = new Date(`${submitData.date}T${submitData.clockOut}`);\n      const hours = (clockOut.getTime() - clockIn.getTime()) / (1000 * 60 * 60);\n      submitData.totalHours = hours.toString();\n    }\n\n    if (editingRecord) {\n      updateMutation.mutate(submitData);\n    } else {\n      createMutation.mutate(submitData);\n    }\n  };\n\n  const handleEdit = (record: any) => {\n    setEditingRecord(record);\n    const date = new Date(record.date);\n    setFormData({\n      staffId: record.staffId?.toString() || \"\",\n      date: format(date, \"yyyy-MM-dd\"),\n      clockIn: record.clockIn ? format(new Date(record.clockIn), \"HH:mm\") : \"\",\n      clockOut: record.clockOut\n        ? format(new Date(record.clockOut), \"HH:mm\")\n        : \"\",\n      breakStart: record.breakStart\n        ? format(new Date(record.breakStart), \"HH:mm\")\n        : \"\",\n      breakEnd: record.breakEnd\n        ? format(new Date(record.breakEnd), \"HH:mm\")\n        : \"\",\n      status: record.status || \"present\",\n      notes: record.notes || \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = async (id: number) => {\n    if (\n      window.confirm(\"Are you sure you want to delete this attendance record?\")\n    ) {\n      deleteMutation.mutate(id);\n    }\n  };\n\n  const handleClockIn = (staffId: number) => {\n    clockInMutation.mutate(staffId);\n  };\n\n  const handleClockOut = (staffId: number) => {\n    clockOutMutation.mutate(staffId);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const statusConfig = {\n      present: { variant: \"default\" as const, label: \"Present\" },\n      absent: { variant: \"destructive\" as const, label: \"Absent\" },\n      late: { variant: \"secondary\" as const, label: \"Late\" },\n      \"half-day\": { variant: \"outline\" as const, label: \"Half Day\" },\n      sick: { variant: \"secondary\" as const, label: \"Sick\" },\n      vacation: { variant: \"outline\" as const, label: \"Vacation\" },\n    };\n\n    const config =\n      statusConfig[status as keyof typeof statusConfig] || statusConfig.present;\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  const filteredAttendance = (\n    Array.isArray(attendance) ? attendance : []\n  ).filter((record: any) =>\n    record.staffName?.toLowerCase().includes(searchQuery.toLowerCase()),\n  );\n\n  const todaysAttendance = (Array.isArray(attendance) ? attendance : []).filter(\n    (record: any) => {\n      const recordDate = new Date(record.date);\n      const today = new Date();\n      return recordDate.toDateString() === today.toDateString();\n    },\n  );\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n        <div>\n          <p className=\"text-muted-foreground\">\n            Track staff attendance and working hours\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={() => resetForm()}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Attendance Record\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>\n                {editingRecord\n                  ? \"Edit Attendance Record\"\n                  : \"Add Attendance Record\"}\n              </DialogTitle>\n            </DialogHeader>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"staffId\">Staff Member *</Label>\n                <Select\n                  value={formData.staffId}\n                  onValueChange={(value) =>\n                    setFormData({ ...formData, staffId: value })\n                  }\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select staff member\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {staff.map((member: any) => (\n                      <SelectItem key={member.id} value={member.id.toString()}>\n                        {member.firstName} {member.lastName} - {member.position}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label htmlFor=\"date\">Date *</Label>\n                <Input\n                  id=\"date\"\n                  type=\"date\"\n                  value={formData.date}\n                  onChange={(e) =>\n                    setFormData({ ...formData, date: e.target.value })\n                  }\n                  required\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"clockIn\">Clock In</Label>\n                  <Input\n                    id=\"clockIn\"\n                    type=\"time\"\n                    value={formData.clockIn}\n                    onChange={(e) =>\n                      setFormData({ ...formData, clockIn: e.target.value })\n                    }\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"clockOut\">Clock Out</Label>\n                  <Input\n                    id=\"clockOut\"\n                    type=\"time\"\n                    value={formData.clockOut}\n                    onChange={(e) =>\n                      setFormData({ ...formData, clockOut: e.target.value })\n                    }\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"breakStart\">Break Start</Label>\n                  <Input\n                    id=\"breakStart\"\n                    type=\"time\"\n                    value={formData.breakStart}\n                    onChange={(e) =>\n                      setFormData({ ...formData, breakStart: e.target.value })\n                    }\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"breakEnd\">Break End</Label>\n                  <Input\n                    id=\"breakEnd\"\n                    type=\"time\"\n                    value={formData.breakEnd}\n                    onChange={(e) =>\n                      setFormData({ ...formData, breakEnd: e.target.value })\n                    }\n                  />\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"status\">Status</Label>\n                <Select\n                  value={formData.status}\n                  onValueChange={(value) =>\n                    setFormData({ ...formData, status: value })\n                  }\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"present\">Present</SelectItem>\n                    <SelectItem value=\"absent\">Absent</SelectItem>\n                    <SelectItem value=\"late\">Late</SelectItem>\n                    <SelectItem value=\"half-day\">Half Day</SelectItem>\n                    <SelectItem value=\"sick\">Sick</SelectItem>\n                    <SelectItem value=\"vacation\">Vacation</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label htmlFor=\"notes\">Notes</Label>\n                <Textarea\n                  id=\"notes\"\n                  value={formData.notes}\n                  onChange={(e) =>\n                    setFormData({ ...formData, notes: e.target.value })\n                  }\n                  placeholder=\"Optional notes\"\n                />\n              </div>\n\n              <div className=\"flex justify-end space-x-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={\n                    createMutation.isPending || updateMutation.isPending\n                  }\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? \"Saving...\"\n                    : editingRecord\n                      ? \"Update\"\n                      : \"Create\"}\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Quick Clock In/Out */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Timer className=\"h-5 w-5\" />\n            Quick Clock In/Out\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {staff.map((member: any) => {\n              const todayRecord = todaysAttendance.find(\n                (record: any) => record.staffId === member.id,\n              );\n              return (\n                <div key={member.id} className=\"border rounded-lg p-4\">\n                  <div className=\"font-medium\">\n                    {member.firstName} {member.lastName}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    {member.position}\n                  </div>\n                  <div className=\"mt-2 space-x-2\">\n                    {!todayRecord || !todayRecord.clockIn ? (\n                      <Button\n                        size=\"sm\"\n                        onClick={() => handleClockIn(member.id)}\n                        disabled={clockInMutation.isPending}\n                      >\n                        Clock In\n                      </Button>\n                    ) : !todayRecord.clockOut ? (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => handleClockOut(member.id)}\n                        disabled={clockOutMutation.isPending}\n                      >\n                        Clock Out\n                      </Button>\n                    ) : (\n                      <Badge variant=\"default\">Complete</Badge>\n                    )}\n                  </div>\n                  {todayRecord && (\n                    <div className=\"text-xs text-muted-foreground mt-1\">\n                      {todayRecord.clockIn &&\n                        `In: ${format(new Date(todayRecord.clockIn), \"HH:mm\")}`}\n                      {todayRecord.clockOut &&\n                        ` Out: ${format(new Date(todayRecord.clockOut), \"HH:mm\")}`}\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            <div>\n              <Label htmlFor=\"staffFilter\">Staff Member</Label>\n              <Select value={selectedStaff} onValueChange={setSelectedStaff}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"All staff\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All staff</SelectItem>\n                  {staff.map((member: any) => (\n                    <SelectItem key={member.id} value={member.id.toString()}>\n                      {member.firstName} {member.lastName}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"startDate\">Start Date</Label>\n              <Input\n                id=\"startDate\"\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => setStartDate(e.target.value)}\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"endDate\">End Date</Label>\n              <Input\n                id=\"endDate\"\n                type=\"date\"\n                value={endDate}\n                onChange={(e) => setEndDate(e.target.value)}\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"search\">Search</Label>\n              <SearchBar\n                placeholder=\"Search attendance...\"\n                value={searchQuery}\n                onChange={setSearchQuery}\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Attendance Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <CalendarDays className=\"h-5 w-5\" />\n            Attendance Records ({filteredAttendance.length})\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto\"></div>\n              <p className=\"text-muted-foreground mt-2\">\n                Loading attendance...\n              </p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Staff Member</TableHead>\n                    <TableHead>Clock In</TableHead>\n                    <TableHead>Clock Out</TableHead>\n                    <TableHead>Break</TableHead>\n                    <TableHead>Total Hours</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredAttendance.map((record: any) => (\n                    <TableRow key={record.id}>\n                      <TableCell>\n                        {format(new Date(record.date), \"MMM dd, yyyy\")}\n                      </TableCell>\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">{record.staffName}</div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            {record.staffPosition}\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {record.clockIn\n                          ? format(new Date(record.clockIn), \"HH:mm\")\n                          : \"-\"}\n                      </TableCell>\n                      <TableCell>\n                        {record.clockOut\n                          ? format(new Date(record.clockOut), \"HH:mm\")\n                          : \"-\"}\n                      </TableCell>\n                      <TableCell>\n                        {record.breakStart && record.breakEnd ? (\n                          <div className=\"text-sm\">\n                            {format(new Date(record.breakStart), \"HH:mm\")} -{\" \"}\n                            {format(new Date(record.breakEnd), \"HH:mm\")}\n                          </div>\n                        ) : (\n                          \"-\"\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {record.totalHours\n                          ? `${parseFloat(record.totalHours).toFixed(2)}h`\n                          : \"-\"}\n                      </TableCell>\n                      <TableCell>{getStatusBadge(record.status)}</TableCell>\n                      <TableCell>\n                        <div className=\"flex space-x-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(record)}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleDelete(record.id)}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":22377,"size_tokens":null},"client/src/pages/ingredients.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport SearchBar from \"@/components/search-bar\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Plus,\n  Search,\n  Edit,\n  Trash2,\n  Package,\n  AlertTriangle,\n  ChevronDown,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { useUnits } from \"@/hooks/useUnits\"; // Import useUnits\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport {\n  Pagination,\n  PaginationInfo,\n  PageSizeSelector,\n  usePagination,\n} from \"@/components/ui/pagination\";\n\nexport default function Ingredients() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingItem, setEditingItem] = useState<any>(null);\n  const [showAdditionalDetails, setShowAdditionalDetails] = useState(false);\n  const { toast } = useToast();\n  const { symbol } = useCurrency();\n\n  const {\n    data: items = [],\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: [\"/api/inventory\"],\n    retry: (failureCount, error) => {\n      if (isUnauthorizedError(error)) return false;\n      return failureCount < 3;\n    },\n  });\n\n  // Use the useUnits hook to fetch units\n  const { units = [], isLoading: unitsLoading, error: unitsError } = useUnits();\n\n  const { data: categories = [] } = useQuery({\n    queryKey: [\"/api/inventory-categories\"],\n  });\n\n  // Filter only active units for the dropdown\n  // The useUnits hook now ensures units is always an array, so Array.isArray check is implicitly handled.\n  const activeUnits = Array.isArray(units)\n    ? units.filter((unit: any) => unit.isActive !== false) // show unless explicitly inactive\n    : [];\n\n  // Filter ingredients (items that can be used as ingredients)\n  // Ensure items is an array before filtering to prevent runtime errors\n  const ingredients = Array.isArray(items)\n    ? items.filter(\n        (item: any) =>\n          item.name &&\n          (item.group === \"raw-materials\" ||\n            item.group === \"ingredients\" ||\n            !item.group ||\n            item.name.toLowerCase().includes(\"flour\") ||\n            item.name.toLowerCase().includes(\"sugar\") ||\n            item.name.toLowerCase().includes(\"butter\") ||\n            item.name.toLowerCase().includes(\"milk\") ||\n            item.name.toLowerCase().includes(\"egg\") ||\n            item.name.toLowerCase().includes(\"chocolate\") ||\n            item.name.toLowerCase().includes(\"vanilla\") ||\n            item.name.toLowerCase().includes(\"salt\") ||\n            item.name.toLowerCase().includes(\"baking\")),\n      )\n    : [];\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      console.log(\"Creating ingredient:\", data);\n\n      if (!data.name?.trim()) {\n        throw new Error(\"Ingredient name is required\");\n      }\n      if (!data.unitId && !data.unit) {\n        throw new Error(\"Measuring unit is required\");\n      }\n      if (\n        isNaN(parseFloat(data.costPerUnit)) ||\n        parseFloat(data.costPerUnit) < 0\n      ) {\n        throw new Error(\"Valid cost per unit is required\");\n      }\n      if (\n        isNaN(parseFloat(data.currentStock)) ||\n        parseFloat(data.currentStock) < 0\n      ) {\n        throw new Error(\"Valid current stock is required\");\n      }\n\n      // Set group to 'ingredients' for better categorization\n      const ingredientData = {\n        ...data,\n        group: data.group || \"ingredients\",\n        name: data.name.trim(),\n        unit: data.unit || \"pcs\",\n        defaultPrice: data.defaultPrice || data.costPerUnit,\n        openingQuantity: data.openingQuantity || data.currentStock,\n        openingRate: data.openingRate || data.costPerUnit,\n        openingValue:\n          parseFloat(data.currentStock || \"0\") *\n          parseFloat(data.costPerUnit || \"0\"),\n        supplier: data.supplier?.trim() || null,\n        company: data.company?.trim() || null,\n        location: data.location?.trim() || null,\n        notes: data.notes?.trim() || null,\n        dateAdded: new Date().toISOString(),\n        lastRestocked: new Date().toISOString(),\n      };\n\n      return apiRequest(\"POST\", \"/api/inventory\", ingredientData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/low-stock\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n      setIsDialogOpen(false);\n      toast({\n        title: \"Success\",\n        description: \"Ingredient added successfully\",\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to add ingredient\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: { id: number; values: any }) => {\n      console.log(\"Updating ingredient:\", data);\n      return apiRequest(\"PUT\", `/api/inventory/${data.id}`, data.values);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/low-stock\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n      setIsDialogOpen(false);\n      setEditingItem(null);\n      toast({\n        title: \"Success\",\n        description: \"Ingredient updated successfully\",\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update ingredient\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/inventory/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n      toast({\n        title: \"Success\",\n        description: \"Ingredient deleted successfully\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete ingredient\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSave = (e: React.FormEvent) => {\n    e.preventDefault();\n    const formData = new FormData(e.target as HTMLFormElement);\n\n    const name = formData.get(\"name\") as string;\n    const unitId = formData.get(\"unitId\") as string;\n    const costPerUnit = formData.get(\"costPerUnit\") as string;\n    const currentStock = formData.get(\"currentStock\") as string;\n\n    // Client-side validation\n    if (!name?.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Ingredient name is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!unitId) {\n      toast({\n        title: \"Error\",\n        description: \"Measuring unit is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Get the selected unit details\n    const selectedUnit = (units as any[]).find(\n      (u: any) => u.id.toString() === unitId,\n    );\n\n    const data = {\n      name: name.trim(),\n      unitId: parseInt(unitId),\n      unit: selectedUnit ? selectedUnit.abbreviation : \"pcs\",\n      costPerUnit: parseFloat(costPerUnit || \"0\"),\n      currentStock: parseFloat(currentStock || \"0\"),\n      minLevel: parseFloat((formData.get(\"minLevel\") as string) || \"0\"),\n      defaultPrice: parseFloat(\n        (formData.get(\"defaultPrice\") as string) || costPerUnit || \"0\",\n      ),\n      categoryId: null, // Add categoryId for proper database insertion\n      group: (formData.get(\"group\") as string) || \"ingredients\",\n      supplier: (formData.get(\"supplier\") as string)?.trim() || null,\n      company: (formData.get(\"company\") as string)?.trim() || null,\n      location: (formData.get(\"location\") as string)?.trim() || null,\n      notes: (formData.get(\"notes\") as string)?.trim() || null,\n      isIngredient: true, // Mark as ingredient for proper categorization\n    };\n\n    if (editingItem) {\n      updateMutation.mutate({ id: editingItem.id, values: data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const filteredIngredients = ingredients.filter((ingredient: any) => {\n    return (\n      ingredient.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      ingredient.supplier?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      ingredient.group?.toLowerCase().includes(searchQuery.toLowerCase())\n    );\n  });\n\n  // Add sorting functionality\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredIngredients,\n    \"name\",\n  );\n\n  // Add pagination functionality\n  const {\n    currentItems,\n    currentPage,\n    totalPages,\n    pageSize,\n    setPageSize,\n    goToPage,\n    totalItems,\n  } = usePagination(sortedData, 10);\n\n\n  const getStockBadge = (item: any) => {\n    const currentStock = parseFloat(item.currentStock || 0);\n    const minLevel = parseFloat(item.minLevel || 0);\n\n    if (currentStock <= minLevel) {\n      return { variant: \"destructive\" as const, text: \"Low Stock\" };\n    } else if (currentStock <= minLevel * 1.5) {\n      return { variant: \"secondary\" as const, text: \"Warning\" };\n    }\n    return { variant: \"default\" as const, text: \"In Stock\" };\n  };\n\n  // Get unit name by ID\n  const getUnitName = (unitId: number) => {\n    // Ensure units is an array before calling find\n    if (!Array.isArray(units) || !unitId) return \"Unknown Unit\";\n    const unit = units.find((u: any) => u.id === unitId);\n    return unit ? `${unit.name} (${unit.abbreviation})` : \"Unknown Unit\";\n  };\n\n  if (error && isUnauthorizedError(error)) {\n    toast({\n      title: \"Unauthorized\",\n      description: \"You are logged out. Logging in again...\",\n      variant: \"destructive\",\n    });\n    setTimeout(() => {\n      window.location.href = \"/api/login\";\n    }, 500);\n    return null;\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600\">\n            Manage your baking ingredients and raw materials\n          </p>\n        </div>\n        <Dialog\n          open={isDialogOpen}\n          onOpenChange={(open) => {\n            setIsDialogOpen(open);\n            if (!open) {\n              setEditingItem(null);\n              setShowAdditionalDetails(false);\n            }\n          }}\n        >\n          <DialogTrigger asChild>\n            <Button\n              onClick={() => setEditingItem(null)}\n              className=\"w-full sm:w-auto\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Ingredient\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl mx-auto max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle className=\"text-center text-lg font-semibold\">\n                {editingItem ? \"Edit Ingredient\" : \"Add New Ingredient\"}\n              </DialogTitle>\n              <DialogDescription>\n                {editingItem\n                  ? \"Update the ingredient details below\"\n                  : \"Add a new ingredient to your inventory for use in recipes\"}\n              </DialogDescription>\n            </DialogHeader>\n            <form onSubmit={handleSave} className=\"space-y-4\">\n              {/* First Row - Ingredient Name and Measuring Unit */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"name\" className=\"text-sm font-medium\">\n                    Ingredient Name <span className=\"text-red-500\">*</span>\n                  </Label>\n                  <Input\n                    id=\"name\"\n                    name=\"name\"\n                    placeholder=\"e.g., All Purpose Flour\"\n                    defaultValue={editingItem?.name || \"\"}\n                    required\n                    className=\"mt-1\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"unitId\" className=\"text-sm font-medium\">\n                    Measuring Unit <span className=\"text-red-500\">*</span>\n                  </Label>\n                  <Select\n                      name=\"unitId\"\n                      defaultValue={editingItem?.unitId?.toString() || \"\"}\n                      required\n                      disabled={unitsLoading}\n                    >\n                      <SelectTrigger className=\"mt-1\">\n                        <SelectValue \n                          placeholder={\n                            unitsLoading \n                              ? \"Loading units...\" \n                              : unitsError \n                                ? \"Error loading units\"\n                                : \"Select unit of measurement\"\n                          } \n                        />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {unitsLoading ? (\n                          <SelectItem value=\"loading\" disabled>\n                            Loading units...\n                          </SelectItem>\n                        ) : unitsError ? (\n                          <SelectItem value=\"error\" disabled>\n                            Error loading units. Please refresh.\n                          </SelectItem>\n                        ) : activeUnits.length > 0 ? (\n                          activeUnits.map((unit: any) => {\n                            if (!unit || !unit.id) return null;\n                            return (\n                              <SelectItem key={unit.id} value={unit.id.toString()}>\n                                {unit.name} ({unit.abbreviation || unit.unit || \"unit\"})\n                              </SelectItem>\n                            );\n                          }).filter(Boolean)\n                        ) : (\n                          <SelectItem value=\"none\" disabled>\n                            No units available. Please add one in settings.\n                          </SelectItem>\n                        )}\n                      </SelectContent>\n                    </Select>\n                </div>\n              </div>\n\n              {/* Second Row - Current Stock and Cost */}\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"currentStock\" className=\"text-sm font-medium\">\n                    Current Stock <span className=\"text-red-500\">*</span>\n                  </Label>\n                  <Input\n                    id=\"currentStock\"\n                    name=\"currentStock\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    min=\"0\"\n                    placeholder=\"0\"\n                    defaultValue={editingItem?.currentStock || \"\"}\n                    required\n                    className=\"mt-1\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"costPerUnit\" className=\"text-sm font-medium\">\n                    Cost per Unit <span className=\"text-red-500\">*</span>\n                  </Label>\n                  <div className=\"relative mt-1\">\n                    <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground\">\n                      {symbol}\n                    </span>\n                    <Input\n                      id=\"costPerUnit\"\n                      name=\"costPerUnit\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      placeholder=\"0\"\n                      defaultValue={editingItem?.costPerUnit || \"\"}\n                      required\n                      className=\"pl-8\"\n                    />\n                  </div>\n                </div>\n                <div>\n                  <Label htmlFor=\"minLevel\" className=\"text-sm font-medium\">\n                    Minimum Level\n                  </Label>\n                  <Input\n                    id=\"minLevel\"\n                    name=\"minLevel\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    min=\"0\"\n                    placeholder=\"0\"\n                    defaultValue={editingItem?.minLevel || \"\"}\n                    className=\"mt-1\"\n                  />\n                </div>\n              </div>\n\n              {/* Third Row - Default Price and Group */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"defaultPrice\" className=\"text-sm font-medium\">\n                    Default Price\n                  </Label>\n                  <div className=\"relative mt-1\">\n                    <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground\">\n                      {symbol}\n                    </span>\n                    <Input\n                      id=\"defaultPrice\"\n                      name=\"defaultPrice\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      placeholder=\"0\"\n                      defaultValue={editingItem?.defaultPrice || \"\"}\n                      className=\"pl-8\"\n                    />\n                  </div>\n                </div>\n                <div>\n                  <Label htmlFor=\"group\" className=\"text-sm font-medium\">\n                    Category\n                  </Label>\n                  <Select\n                    name=\"group\"\n                    defaultValue={editingItem?.group || \"ingredients\"}\n                  >\n                    <SelectTrigger className=\"mt-1\">\n                      <SelectValue placeholder=\"Select ingredient category\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"ingredients\">Ingredients</SelectItem>\n                      <SelectItem value=\"raw-materials\">\n                        Raw Materials\n                      </SelectItem>\n                      <SelectItem value=\"flour\">Flour & Grains</SelectItem>\n                      <SelectItem value=\"dairy\">Dairy Products</SelectItem>\n                      <SelectItem value=\"sweeteners\">Sweeteners</SelectItem>\n                      <SelectItem value=\"spices\">\n                        Spices & Seasonings\n                      </SelectItem>\n                      <SelectItem value=\"leavening\">\n                        Leavening Agents\n                      </SelectItem>\n                      <SelectItem value=\"extracts\">\n                        Extracts & Flavoring\n                      </SelectItem>\n                      <SelectItem value=\"chocolate\">\n                        Chocolate & Cocoa\n                      </SelectItem>\n                      <SelectItem value=\"nuts\">Nuts & Seeds</SelectItem>\n                      <SelectItem value=\"fruits\">\n                        Fruits & Dried Fruits\n                      </SelectItem>\n                      <SelectItem value=\"packaging\">\n                        Packaging Materials\n                      </SelectItem>\n                      <SelectItem value=\"other\">Other</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              {/* Additional Details Toggle */}\n              <div>\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  onClick={() =>\n                    setShowAdditionalDetails(!showAdditionalDetails)\n                  }\n                  className=\"text-blue-600 p-0 h-auto font-normal\"\n                >\n                  Additional Details{\" \"}\n                  <ChevronDown\n                    className={`h-4 w-4 ml-1 transition-transform ${\n                      showAdditionalDetails ? \"rotate-180\" : \"\"\n                    }`}\n                  />\n                </Button>\n              </div>\n\n              {/* Additional Details Section */}\n              {showAdditionalDetails && (\n                <div className=\"space-y-4 p-4 border rounded-lg bg-gray-50\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <Label htmlFor=\"supplier\" className=\"text-sm font-medium\">\n                        Supplier\n                      </Label>\n                      <Input\n                        id=\"supplier\"\n                        name=\"supplier\"\n                        placeholder=\"Supplier name\"\n                        defaultValue={editingItem?.supplier || \"\"}\n                        className=\"mt-1\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"company\" className=\"text-sm font-medium\">\n                        Brand/Company\n                      </Label>\n                      <Input\n                        id=\"company\"\n                        name=\"company\"\n                        placeholder=\"Brand or company name\"\n                        defaultValue={editingItem?.company || \"\"}\n                        className=\"mt-1\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <Label htmlFor=\"location\" className=\"text-sm font-medium\">\n                        Storage Location\n                      </Label>\n                      <Input\n                        id=\"location\"\n                        name=\"location\"\n                        placeholder=\"Storage location\"\n                        defaultValue={editingItem?.location || \"\"}\n                        className=\"mt-1\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"notes\" className=\"text-sm font-medium\">\n                        Notes\n                      </Label>\n                      <Input\n                        id=\"notes\"\n                        name=\"notes\"\n                        placeholder=\"Additional notes\"\n                        defaultValue={editingItem?.notes || \"\"}\n                        className=\"mt-1\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Action Buttons */}\n              <div className=\"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2 pt-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                  className=\"w-full sm:w-auto\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={\n                    createMutation.isPending || updateMutation.isPending\n                  }\n                  className=\"w-full sm:w-auto bg-primary hover:bg-primary/90\"\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? \"Saving...\"\n                    : editingItem\n                      ? \"Update Ingredient\"\n                      : \"Add Ingredient\"}\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n            <CardTitle>Ingredients Inventory</CardTitle>\n            <div className=\"w-full sm:w-64\">\n              <SearchBar\n                placeholder=\"Search ingredients...\"\n                value={searchQuery}\n                onChange={setSearchQuery}\n                className=\"w-full\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"name\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Ingredient\n                    </SortableTableHeader>\n                    <TableHead>Unit</TableHead>\n                    <SortableTableHeader\n                      sortKey=\"currentStock\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Current Stock\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"minLevel\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Min Level\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"costPerUnit\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Cost/Unit\n                    </SortableTableHeader>\n                    <TableHead className=\"hidden md:table-cell\">\n                      Category\n                    </TableHead>\n                    <TableHead className=\"hidden lg:table-cell\">\n                      Supplier\n                    </TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {currentItems.length > 0 ? (\n                    currentItems.map((item: any) => {\n                      const stockInfo = getStockBadge(item);\n                      return (\n                        <TableRow key={item.id}>\n                          <TableCell>\n                            <div className=\"flex items-center space-x-3\">\n                              <div className=\"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center\">\n                                <Package className=\"h-5 w-5 text-primary\" />\n                              </div>\n                              <div>\n                                <div className=\"font-medium\">{item.name}</div>\n                                <div className=\"text-sm text-muted-foreground\">\n                                  {item.company || \"No brand\"}\n                                </div>\n                              </div>\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <span className=\"text-sm\">\n                              {getUnitName(item.unitId)}\n                            </span>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"font-medium\">\n                              {parseFloat(item.currentStock || 0).toFixed(2)}\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"text-sm text-muted-foreground\">\n                              {parseFloat(item.minLevel || 0).toFixed(2)}\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"font-medium\">\n                              {symbol}\n                              {parseFloat(item.costPerUnit || 0).toFixed(2)}\n                            </div>\n                          </TableCell>\n                          <TableCell className=\"hidden md:table-cell\">\n                            {item.group ? (\n                              <Badge variant=\"outline\" className=\"capitalize\">\n                                {item.group.replace(\"-\", \" \")}\n                              </Badge>\n                            ) : (\n                              <span className=\"text-muted-foreground\">-</span>\n                            )}\n                          </TableCell>\n                          <TableCell className=\"hidden lg:table-cell\">\n                            <div className=\"text-sm\">\n                              {item.supplier || \"No supplier\"}\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant={stockInfo.variant}>\n                              {stockInfo.text}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex space-x-1\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  setEditingItem(item);\n                                  setIsDialogOpen(true);\n                                }}\n                                className=\"text-blue-600 hover:text-blue-800 focus:outline-none\"\n                                title=\"Edit\"\n                              >\n                                <Edit className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => deleteMutation.mutate(item.id)}\n                                disabled={deleteMutation.isPending}\n                                className=\"text-red-600 hover:text-red-800 focus:outline-none\"\n                                title=\"Delete\"\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      );\n                    })\n                  ) : (\n                    <TableRow>\n                      <TableCell colSpan={9} className=\"text-center py-8\">\n                        <div className=\"flex flex-col items-center\">\n                          <Package className=\"h-12 w-12 text-muted-foreground mb-4\" />\n                          <h3 className=\"text-lg font-semibold text-muted-foreground mb-2\">\n                            No ingredients found\n                          </h3>\n                          <p className=\"text-muted-foreground mb-4\">\n                            {searchQuery\n                              ? \"Try adjusting your search criteria\"\n                              : \"Start by adding your first ingredient\"}\n                          </p>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n\n          {/* Pagination Controls */}\n          {filteredIngredients.length > 0 && (\n            <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 mt-4\">\n              <PaginationInfo\n                currentPage={currentPage}\n                totalPages={totalPages}\n                totalItems={totalItems}\n              />\n              <div className=\"flex items-center gap-4\">\n                <PageSizeSelector\n                  pageSize={pageSize}\n                  onPageSizeChange={setPageSize}\n                  options={[10, 20, 50, 100]}\n                />\n                <Pagination\n                  currentPage={currentPage}\n                  totalPages={totalPages}\n                  onPageChange={goToPage}\n                />\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","path":null,"size_bytes":33758,"size_tokens":null},"client/src/components/ui/delete-confirmation-dialog.tsx":{"content":"import { AlertTriangle } from \"lucide-react\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\n\ninterface DeleteConfirmationDialogProps {\n  trigger: React.ReactNode;\n  title?: string;\n  description?: string;\n  itemName?: string;\n  onConfirm: () => void;\n  isLoading?: boolean;\n}\n\nexport function DeleteConfirmationDialog({\n  trigger,\n  title = \"Are you absolutely sure?\",\n  description,\n  itemName,\n  onConfirm,\n  isLoading = false,\n}: DeleteConfirmationDialogProps) {\n  const defaultDescription = itemName\n    ? `This action cannot be undone. This will permanently delete \"${itemName}\" and remove all associated data from our servers.`\n    : \"This action cannot be undone. This will permanently delete this item and remove all associated data from our servers.\";\n\n  return (\n    <AlertDialog>\n      <AlertDialogTrigger asChild>{trigger}</AlertDialogTrigger>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <div className=\"flex items-center gap-2\">\n            <AlertTriangle className=\"h-5 w-5 text-destructive\" />\n            <AlertDialogTitle>{title}</AlertDialogTitle>\n          </div>\n          <AlertDialogDescription>\n            {description || defaultDescription}\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isLoading}>Cancel</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isLoading}\n            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n          >\n            {isLoading ? \"Deleting...\" : \"Delete\"}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n","path":null,"size_bytes":1910,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/pages/purchase-returns.tsx":{"content":"\"use client\";\n\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { LoadingSpinner } from \"@/components/ui/loading-spinner\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { format } from \"date-fns\";\nimport { useUnits } from \"@/hooks/useUnits\"; // Added import\n\ninterface PurchaseReturn {\n  id: number;\n  serialNumber: number;\n  inventoryItemId: number;\n  inventoryItemName: string;\n  quantity: number;\n  unitId: number;\n  unitName: string;\n  ratePerUnit: number;\n  amount: number;\n  returnDate: string;\n  purchaseId?: number;\n  partyId?: number;\n  returnReason: string;\n  isDayClosed: boolean;\n  notes?: string;\n  createdAt: string;\n}\n\ninterface DailyPurchaseReturnSummary {\n  summaryDate: string;\n  totalItems: number;\n  totalQuantity: number;\n  totalLoss: number;\n  isDayClosed: boolean;\n  closedBy?: string;\n  closedAt?: string;\n}\n\nexport default function PurchaseReturns() {\n  const [selectedDate, setSelectedDate] = useState(\n    format(new Date(), \"yyyy-MM-dd\"),\n  );\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingReturn, setEditingReturn] = useState<PurchaseReturn | null>(\n    null,\n  );\n  const [formData, setFormData] = useState({\n    inventoryItemId: \"\",\n    quantity: \"\",\n    unitId: \"\",\n    ratePerUnit: \"\",\n    returnReason: \"damaged\",\n    partyId: \"\",\n    purchaseId: \"\",\n    notes: \"\",\n  });\n\n  const { toast } = useToast();\n  const { formatCurrency } = useCurrency();\n  const queryClient = useQueryClient();\n\n  // Fetch inventory items\n  const { data: inventoryItems = [], isLoading: inventoryLoading } = useQuery({\n    queryKey: [\"inventory\"],\n    queryFn: async () => {\n      try {\n        const res = await apiRequest(\"GET\", \"/api/inventory\");\n        console.log(\"Inventory items response:\", res);\n        if (Array.isArray(res)) return res;\n        if (res?.items && Array.isArray(res.items)) return res.items;\n        if (res?.data && Array.isArray(res.data)) return res.data;\n        return [];\n      } catch (error) {\n        console.error(\"Failed to fetch inventory items:\", error);\n        return [];\n      }\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Fetch parties (suppliers)\n  const { data: parties = [] } = useQuery({\n    queryKey: [\"parties\"],\n    queryFn: async () => {\n      try {\n        const res = await apiRequest(\"GET\", \"/api/parties\");\n        console.log(\"Parties response:\", res);\n        if (Array.isArray(res)) return res;\n        if (res?.parties && Array.isArray(res.parties)) return res.parties;\n        if (res?.data && Array.isArray(res.data)) return res.data;\n        return [];\n      } catch (error) {\n        console.error(\"Failed to fetch parties:\", error);\n        return [];\n      }\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Fetch units\n  const { data: units = [] } = useQuery({\n    queryKey: [\"units\"],\n    queryFn: async () => {\n      try {\n        const res = await apiRequest(\"GET\", \"/api/units\");\n        let allUnits = [];\n        if (Array.isArray(res)) {\n          allUnits = res;\n        } else if (res?.data && Array.isArray(res.data)) {\n          allUnits = res.data;\n        }\n        return allUnits.filter(\n          (unit: any) =>\n            unit.isActive && (unit.type === \"weight\" || unit.type === \"count\" || unit.type === \"volume\"),\n        );\n      } catch (error) {\n        console.error(\"Failed to fetch units:\", error);\n        return [];\n      }\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Fetch purchase returns for selected date\n  const { data: purchaseReturns = [], isLoading: purchaseReturnsLoading } =\n    useQuery({\n      queryKey: [\"purchase-returns\", selectedDate],\n      queryFn: async () => {\n        try {\n          const res = await apiRequest(\n            \"GET\",\n            `/api/purchase-returns?date=${selectedDate}`,\n          );\n          // Ensure res.data is always an array, fallback to empty array if not found or not an array\n          return Array.isArray(res?.data) ? res.data : [];\n        } catch (error) {\n          console.error(\"Failed to fetch purchase returns:\", error);\n          return [];\n        }\n      },\n      retry: (failureCount, error) =>\n        !isUnauthorizedError(error) && failureCount < 3,\n    });\n\n  // Fetch daily summary\n  const { data: dailySummary } = useQuery({\n    queryKey: [\"purchase-returns-summary\", selectedDate],\n    queryFn: async () => {\n      try {\n        const res = await apiRequest(\n          \"GET\",\n          `/api/purchase-returns/summary/${selectedDate}`,\n        );\n        // Return the data if it's an object, otherwise null\n        return typeof res === 'object' && res !== null && !Array.isArray(res) ? res.data || null : null;\n      } catch (error) {\n        console.error(\"Failed to fetch daily summary:\", error);\n        return null;\n      }\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  // Define helper functions\n  const handleSuccess = (msg: string) => {\n    setIsDialogOpen(false);\n    resetForm();\n    queryClient.invalidateQueries({ queryKey: [\"purchase-returns\"] });\n    queryClient.invalidateQueries({ queryKey: [\"purchase-returns-summary\"] });\n    toast({ title: \"Success\", description: msg });\n  };\n\n  const handleError = (error: unknown, variables: any, context: unknown) => {\n    console.error(\"Mutation error:\", error);\n\n    let message = \"Failed to process request.\";\n\n    if (error && typeof error === \"object\") {\n      const err = error as Record<string, any>;\n      if (err.response?.data?.message) {\n        message = err.response.data.message;\n      } else if (err.message) {\n        message = err.message;\n      }\n    }\n\n    if (isUnauthorizedError(error)) {\n      toast({\n        title: \"Session Expired\",\n        description: \"Redirecting to login...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => (window.location.href = \"/login\"), 1000);\n      return;\n    }\n\n    toast({\n      title: \"Error\",\n      description: message,\n      variant: \"destructive\",\n    });\n  };\n\n  // Create mutation\n  const createMutation = useMutation({\n    mutationFn: (data: any) =>\n      apiRequest(\"POST\", \"/api/purchase-returns\", data),\n    onSuccess: () => {\n      handleSuccess(\"Purchase return entry created successfully\");\n    },\n    onError: handleError,\n  });\n\n  // Update mutation\n  const updateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) =>\n      apiRequest(\"PUT\", `/api/purchase-returns/${id}`, data),\n    onSuccess: () => {\n      handleSuccess(\"Purchase return entry updated successfully\");\n    },\n    onError: handleError,\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) =>\n      apiRequest(\"DELETE\", `/api/purchase-returns/${id}`),\n    onSuccess: () => {\n      handleSuccess(\"Purchase return entry deleted successfully\");\n    },\n    onError: handleError,\n  });\n\n  // Close day mutation\n  const closeDayMutation = useMutation({\n    mutationFn: (date: string) =>\n      apiRequest(\"POST\", \"/api/purchase-returns/close-day\", { date }),\n    onSuccess: () => {\n      handleSuccess(\"Day closed successfully.\");\n    },\n    onError: handleError,\n  });\n\n  // Reopen day mutation\n  const reopenDayMutation = useMutation({\n    mutationFn: (date: string) =>\n      apiRequest(\"POST\", \"/api/purchase-returns/reopen-day\", { date }),\n    onSuccess: () => {\n      handleSuccess(\"Day reopened successfully.\");\n    },\n    onError: handleError,\n  });\n\n  const isDayClosed = dailySummary?.isDayClosed || false;\n  const canModify = !isDayClosed;\n\n  // Calculate amount\n  const calculatedAmount = useMemo(() => {\n    const qty = parseFloat(formData.quantity) || 0;\n    const rate = parseFloat(formData.ratePerUnit) || 0;\n    return qty * rate;\n  }, [formData.quantity, formData.ratePerUnit]);\n\n  const resetForm = () => {\n    setFormData({\n      inventoryItemId: \"\",\n      quantity: \"\",\n      unitId: \"\",\n      ratePerUnit: \"\",\n      returnReason: \"damaged\",\n      partyId: \"\",\n      purchaseId: \"\",\n      notes: \"\",\n    });\n    setEditingReturn(null);\n  };\n\n  const handleEdit = (returnItem: PurchaseReturn) => {\n    setEditingReturn(returnItem);\n    setFormData({\n      inventoryItemId: returnItem.inventoryItemId.toString(),\n      quantity: returnItem.quantity.toString(),\n      unitId: returnItem.unitId.toString(),\n      ratePerUnit: returnItem.ratePerUnit.toString(),\n      returnReason: returnItem.returnReason,\n      partyId: returnItem.partyId?.toString() || \"\",\n      purchaseId: returnItem.purchaseId?.toString() || \"\",\n      notes: returnItem.notes || \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (\n      !formData.inventoryItemId ||\n      !formData.quantity ||\n      !formData.unitId ||\n      !formData.ratePerUnit\n    ) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fill all required fields.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const selectedItem = inventoryItems.find(\n      (item) => item.id.toString() === formData.inventoryItemId,\n    );\n    const selectedUnit = units.find((u) => u.id.toString() === formData.unitId);\n\n    if (!selectedItem || !selectedUnit) {\n      toast({\n        title: \"Invalid Selection\",\n        description: \"Please select valid inventory item and unit.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const payload = {\n      inventoryItemId: parseInt(formData.inventoryItemId),\n      inventoryItemName: selectedItem.name,\n      quantity: parseFloat(formData.quantity),\n      unitId: parseInt(formData.unitId),\n      unitName: selectedUnit.name,\n      ratePerUnit: parseFloat(formData.ratePerUnit),\n      returnDate: selectedDate,\n      returnReason: formData.returnReason,\n      partyId: formData.partyId ? parseInt(formData.partyId) : null,\n      purchaseId: formData.purchaseId ? parseInt(formData.purchaseId) : null,\n      notes: formData.notes,\n    };\n\n    if (editingReturn) {\n      updateMutation.mutate({ id: editingReturn.id, data: payload });\n    } else {\n      createMutation.mutate(payload);\n    }\n  };\n\n  const handleDelete = (id: number) => {\n    deleteMutation.mutate(id);\n  };\n\n  return (\n    <div className=\"p-6 space-y-6 max-w-7xl mx-auto\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600 mt-1\">\n            {format(new Date(selectedDate), \"EEEE, MMMM do, yyyy\")}\n          </p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <Input\n            type=\"date\"\n            value={selectedDate}\n            onChange={(e) => setSelectedDate(e.target.value)}\n            className=\"w-auto border-gray-300\"\n          />\n          {canModify && (\n            <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n              <DialogTrigger asChild>\n                <Button\n                  onClick={() => {\n                    resetForm();\n                  }}\n                  className=\"bg-orange-600 hover:bg-orange-700 text-white\"\n                >\n                  + Add Purchase Return\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-2xl\">\n                <DialogHeader>\n                  <DialogTitle>\n                    {editingReturn ? \"Edit\" : \"Add\"} Purchase Return\n                  </DialogTitle>\n                </DialogHeader>\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <Label>Inventory Item *</Label>\n                      <Select\n                        value={formData.inventoryItemId}\n                        onValueChange={(val) => {\n                          const item = inventoryItems.find((i) => i.id.toString() === val);\n                          setFormData((prev) => ({\n                            ...prev,\n                            inventoryItemId: val,\n                            unitId: item?.unitId?.toString() || \"\",\n                            ratePerUnit: item?.costPerUnit?.toString() || \"0\",\n                          }));\n                        }}\n                        disabled={inventoryLoading}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select item\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {inventoryItems.map((item) => (\n                            <SelectItem\n                              key={item.id}\n                              value={item.id.toString()}\n                            >\n                              {item.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label>Unit *</Label>\n                      <Select\n                        value={formData.unitId}\n                        onValueChange={(val) =>\n                          setFormData((prev) => ({ ...prev, unitId: val }))\n                        }\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select unit\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {units.map((u) => (\n                            <SelectItem key={u.id} value={u.id.toString()}>\n                              {u.name} ({u.abbreviation})\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label>Quantity *</Label>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        min=\"0\"\n                        value={formData.quantity}\n                        onChange={(e) =>\n                          setFormData((prev) => ({\n                            ...prev,\n                            quantity: e.target.value,\n                          }))\n                        }\n                        required\n                      />\n                    </div>\n\n                    <div>\n                      <Label>Rate per Unit *</Label>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        min=\"0\"\n                        value={formData.ratePerUnit}\n                        onChange={(e) =>\n                          setFormData((prev) => ({\n                            ...prev,\n                            ratePerUnit: e.target.value,\n                          }))\n                        }\n                        required\n                      />\n                    </div>\n\n                    <div>\n                      <Label>Return Reason</Label>\n                      <Select\n                        value={formData.returnReason}\n                        onValueChange={(val) =>\n                          setFormData((prev) => ({\n                            ...prev,\n                            returnReason: val,\n                          }))\n                        }\n                      >\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"damaged\">Damaged</SelectItem>\n                          <SelectItem value=\"expired\">Expired</SelectItem>\n                          <SelectItem value=\"wrong_item\">Wrong Item</SelectItem>\n                          <SelectItem value=\"quality_issue\">\n                            Quality Issue\n                          </SelectItem>\n                          <SelectItem value=\"overorder\">Over Order</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label>Supplier (Optional)</Label>\n                      <Select\n                        value={formData.partyId}\n                        onValueChange={(val) =>\n                          setFormData((prev) => ({ ...prev, partyId: val }))\n                        }\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select supplier\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {parties\n                            .filter(\n                              (p) => p.type === \"supplier\" || p.type === \"both\",\n                            )\n                            .map((p) => (\n                              <SelectItem key={p.id} value={p.id.toString()}>\n                                {p.name}\n                              </SelectItem>\n                            ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n\n                  <div>\n                    <Label>Calculated Amount</Label>\n                    <div className=\"p-3 bg-orange-50 rounded-lg border border-orange-200\">\n                      <span className=\"text-lg font-semibold text-orange-700\">\n                        {formatCurrency(calculatedAmount)}\n                      </span>\n                    </div>\n                  </div>\n\n                  <div>\n                    <Label>Notes</Label>\n                    <Textarea\n                      value={formData.notes}\n                      onChange={(e) =>\n                        setFormData((prev) => ({\n                          ...prev,\n                          notes: e.target.value,\n                        }))\n                      }\n                      rows={3}\n                      placeholder=\"Optional details...\"\n                    />\n                  </div>\n\n                  <div className=\"flex justify-end gap-2 pt-4\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => setIsDialogOpen(false)}\n                    >\n                      Cancel\n                    </Button>\n                    <Button\n                      type=\"submit\"\n                      disabled={\n                        createMutation.isPending || updateMutation.isPending\n                      }\n                    >\n                      {createMutation.isPending || updateMutation.isPending\n                        ? \"Saving...\"\n                        : \"Save\"}\n                    </Button>\n                  </div>\n                </form>\n              </DialogContent>\n            </Dialog>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total Items</p>\n                <p className=\"text-xl font-bold\">\n                  {dailySummary?.totalItems || 0}\n                </p>\n              </div>\n              <svg\n                className=\"w-8 h-8 text-blue-500\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth=\"2\"\n                  d=\"M20 7l-8-4-8 4m16 0v10l-8 4-8-4V7\"\n                />\n              </svg>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total Quantity</p>\n                <p className=\"text-xl font-bold\">\n                  {dailySummary?.totalQuantity || 0}\n                </p>\n              </div>\n              <svg\n                className=\"w-8 h-8 text-orange-500\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth=\"2\"\n                  d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"\n                />\n              </svg>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total Loss</p>\n                <p className=\"text-xl font-bold text-orange-600\">\n                  {formatCurrency(dailySummary?.totalLoss || 0)}\n                </p>\n              </div>\n              <svg\n                className=\"w-8 h-8 text-red-500\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth=\"2\"\n                  d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\"\n                />\n              </svg>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Status</p>\n                <Badge variant={isDayClosed ? \"destructive\" : \"default\"}>\n                  {isDayClosed ? \"Closed\" : \"Open\"}\n                </Badge>\n              </div>\n              {isDayClosed ? (\n                <svg\n                  className=\"w-8 h-8 text-red-500\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth=\"2\"\n                    d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"\n                  />\n                </svg>\n              ) : (\n                <svg\n                  className=\"w-8 h-8 text-green-500\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth=\"2\"\n                    d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"\n                  />\n                </svg>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Day Management */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"font-semibold\">Day Status</h3>\n              <p className=\"text-sm text-gray-600\">\n                {isDayClosed\n                  ? \"This day is closed. No new entries allowed.\"\n                  : \"You can add or edit purchase returns.\"}\n              </p>\n            </div>\n            <div className=\"flex gap-2\">\n              {!isDayClosed ? (\n                <AlertDialog>\n                  <AlertDialogTrigger asChild>\n                    <Button\n                      variant=\"destructive\"\n                      disabled={purchaseReturns.length === 0}\n                    >\n                      üîí Close Day\n                    </Button>\n                  </AlertDialogTrigger>\n                  <AlertDialogContent>\n                    <AlertDialogHeader>\n                      <AlertDialogTitle>Close Day?</AlertDialogTitle>\n                      <AlertDialogDescription>\n                        Are you sure you want to close this day? You won't be\n                        able to add more entries unless reopened.\n                        <br />\n                        <strong>\n                          Total Loss:{\" \"}\n                          {formatCurrency(dailySummary?.totalLoss || 0)}\n                        </strong>\n                      </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                      <AlertDialogCancel>Cancel</AlertDialogCancel>\n                      <AlertDialogAction\n                        onClick={() => closeDayMutation.mutate(selectedDate)}\n                      >\n                        {closeDayMutation.isPending\n                          ? \"Closing...\"\n                          : \"Yes, Close\"}\n                      </AlertDialogAction>\n                    </AlertDialogFooter>\n                  </AlertDialogContent>\n                </AlertDialog>\n              ) : (\n                <AlertDialog>\n                  <AlertDialogTrigger asChild>\n                    <Button variant=\"outline\">üîì Reopen Day</Button>\n                  </AlertDialogTrigger>\n                  <AlertDialogContent>\n                    <AlertDialogHeader>\n                      <AlertDialogTitle>Reopen Day?</AlertDialogTitle>\n                      <AlertDialogDescription>\n                        This will allow adding or editing purchase return\n                        entries again.\n                      </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                      <AlertDialogCancel>Cancel</AlertDialogCancel>\n                      <AlertDialogAction\n                        onClick={() => reopenDayMutation.mutate(selectedDate)}\n                      >\n                        {reopenDayMutation.isPending\n                          ? \"Reopening...\"\n                          : \"Yes, Reopen\"}\n                      </AlertDialogAction>\n                    </AlertDialogFooter>\n                  </AlertDialogContent>\n                </AlertDialog>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Purchase Returns Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>\n            Purchase Returns{\" \"}\n            <Badge variant=\"secondary\">{purchaseReturns.length} items</Badge>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {purchaseReturnsLoading ? (\n            <LoadingSpinner message=\"Loading...\" />\n          ) : purchaseReturns.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500\">\n              No purchase returns recorded.\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>S.N</TableHead>\n                  <TableHead>Item</TableHead>\n                  <TableHead className=\"text-right\">Qty</TableHead>\n                  <TableHead>Unit</TableHead>\n                  <TableHead className=\"text-right\">Rate</TableHead>\n                  <TableHead className=\"text-right\">Amount</TableHead>\n                  <TableHead>Reason</TableHead>\n                  <TableHead>Notes</TableHead>\n                  {canModify && <TableHead>Actions</TableHead>}\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {purchaseReturns.map((item) => (\n                  <TableRow key={item.id}>\n                    <TableCell>{item.serialNumber}</TableCell>\n                    <TableCell className=\"font-medium\">\n                      {item.inventoryItemName}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {item.quantity}\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant=\"outline\">{item.unitName}</Badge>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.ratePerUnit)}\n                    </TableCell>\n                    <TableCell className=\"text-right font-medium text-orange-600\">\n                      {formatCurrency(item.amount)}\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant=\"secondary\">\n                        {item.returnReason.replace(\"_\", \" \")}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>{item.notes || \"‚Äî\"}</TableCell>\n                    {canModify && (\n                      <TableCell>\n                        <div className=\"flex gap-2\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => handleEdit(item)}\n                          >\n                            ‚úèÔ∏è\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => handleDelete(item.id)}\n                            disabled={deleteMutation.isPending}\n                          >\n                            üóëÔ∏è\n                          </Button>\n                        </div>\n                      </TableCell>\n                    )}\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","path":null,"size_bytes":31385,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/admin-user-management.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport {\n  Plus,\n  Edit,\n  Trash2,\n  Users,\n  Activity,\n  Shield,\n  Settings,\n  Eye,\n  Pencil,\n  AlertTriangle,\n  CheckCircle,\n  Info,\n  X,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useAllPermissions, useRolePermissions } from \"@/hooks/usePermissions\";\nimport { useRoleAccess } from \"@/hooks/useRoleAccess\";\nimport AuditLogs from \"@/pages/LoginLogs\";\nimport {\n  SYSTEM_MODULES,\n  getModulesByCategory,\n  type SystemModule,\n} from \"../../../shared/modules\";\n\nexport default function AdminUserManagement() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingUser, setEditingUser] = useState<any>(null);\n  const [selectedRole, setSelectedRole] = useState<string>(\"admin\");\n  const [selectedModules, setSelectedModules] = useState<Set<string>>(\n    new Set(),\n  );\n  const [userData, setUserData] = useState({\n    email: \"\",\n    password: \"\",\n    firstName: \"\",\n    lastName: \"\",\n    role: \"staff\",\n  });\n  const { toast } = useToast();\n  const { isSuperAdmin } = useRoleAccess();\n  // Removed useQueryClient as queryClient is imported directly from lib/queryClient\n\n  const {\n    data: users = [],\n    isLoading,\n    error,\n  } = useQuery<any[]>({\n    queryKey: [\"/api/admin/users\"],\n  });\n\n  const filteredUsers = isSuperAdmin()\n    ? users\n    : users.filter((user) => user.role !== \"super_admin\");\n\n  const groupPermissionsByResource = (permissions: any[]) => {\n    const grouped = permissions.reduce((acc: any, perm: any) => {\n      if (!acc[perm.resource]) {\n        acc[perm.resource] = [];\n      }\n      acc[perm.resource].push(perm);\n      return acc;\n    }, {});\n    return grouped;\n  };\n\n  const { data: allPermissions = [] } = useAllPermissions();\n  const { data: rolePermissions = [], refetch: refetchRolePermissions } =\n    useRolePermissions(selectedRole);\n\n  // Fetch modules for specific role\n  const { data: currentRoleModulesResponse, isLoading: currentRoleLoading } =\n    useQuery({\n      queryKey: [\"admin\", \"role-modules\", selectedRole],\n      queryFn: async () => {\n        const response = await fetch(`/api/admin/role-modules/${selectedRole}`);\n        if (!response.ok) {\n          throw new Error(\"Failed to fetch role modules\");\n        }\n        return response.json();\n      },\n      enabled: !!selectedRole,\n    });\n\n  // Update selected modules when role changes\n  useEffect(() => {\n    if (\n      currentRoleModulesResponse?.success &&\n      currentRoleModulesResponse.data\n    ) {\n      const grantedModules = currentRoleModulesResponse.data\n        .filter((rm: any) => rm.granted)\n        .map((rm: any) => rm.moduleId);\n      setSelectedModules(new Set(grantedModules));\n    } else {\n      // Clear selection if no data\n      setSelectedModules(new Set());\n    }\n  }, [currentRoleModulesResponse, selectedRole]);\n\n  const updateRolePermissionsMutation = useMutation({\n    mutationFn: async ({\n      role,\n      permissionIds,\n    }: {\n      role: string;\n      permissionIds: number[];\n    }) => {\n      return apiRequest(\"PUT\", `/api/permissions/role/${role}`, {\n        permissionIds,\n      });\n    },\n    onSuccess: () => {\n      toast({ title: \"Role permissions updated successfully\" });\n      refetchRolePermissions();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to update permissions\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update role modules mutation\n  const updateRoleModulesMutation = useMutation({\n    mutationFn: async ({\n      role,\n      moduleIds,\n    }: {\n      role: string;\n      moduleIds: string[];\n    }) => {\n      // Ensure moduleIds is a proper array before sending\n      const properModuleIds = Array.isArray(moduleIds) ? moduleIds : Array.from(moduleIds);\n      \n      console.log(\"Sending request to update role modules:\", {\n        role,\n        moduleIds: properModuleIds,\n        isArray: Array.isArray(properModuleIds),\n      });\n\n      const payload = { \n        role, \n        moduleIds: properModuleIds \n      };\n      \n      console.log(\"Request payload:\", JSON.stringify(payload, null, 2));\n\n      const response = await fetch(\"/api/admin/role-modules\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(payload),\n      });\n\n      console.log(\"Response status:\", response.status);\n\n      if (!response.ok) {\n        const contentType = response.headers.get(\"content-type\");\n        if (contentType && contentType.includes(\"application/json\")) {\n          const error = await response.json();\n          throw new Error(error.message || \"Failed to update role modules\");\n        } else {\n          const text = await response.text();\n          console.error(\"Non-JSON response:\", text);\n          throw new Error(\n            \"Server returned an invalid response. Please check the server logs.\",\n          );\n        }\n      }\n\n      return response.json();\n    },\n    onSuccess: async (data) => {\n      // Invalidate all role-modules queries\n      await queryClient.invalidateQueries({\n        queryKey: [\"admin\", \"role-modules\"],\n      });\n\n      // Specifically refetch the current role's modules\n      await queryClient.refetchQueries({\n        queryKey: [\"admin\", \"role-modules\", selectedRole],\n      });\n\n      // Invalidate user modules cache\n      await queryClient.invalidateQueries({ queryKey: [\"user\", \"modules\"] });\n\n      toast({\n        title: \"Modules Updated\",\n        description: `Successfully updated modules for ${data.data.role}`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update role modules\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"POST\", \"/api/admin/users\", data);\n    },\n    onSuccess: async (result) => {\n      // Wait for data to be refetched and confirmed\n      await queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      await queryClient.refetchQueries({ queryKey: [\"/api/admin/users\"] });\n\n      setIsDialogOpen(false);\n      setEditingUser(null);\n      setUserData({\n        email: \"\",\n        password: \"\",\n        firstName: \"\",\n        lastName: \"\",\n        role: \"staff\",\n      });\n\n      // Show success only after data is confirmed\n      toast({\n        title: \"Success\",\n        description: `User '${result.data.firstName} ${result.data.lastName}' created successfully and assigned role: '${result.data.role}'`,\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create user\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      return await apiRequest(\"PUT\", `/api/admin/users/${id}`, data);\n    },\n    onSuccess: async (result) => {\n      // Wait for data to be refetched and confirmed\n      await queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      await queryClient.refetchQueries({ queryKey: [\"/api/admin/users\"] });\n\n      setIsDialogOpen(false);\n      setEditingUser(null);\n      setUserData({\n        email: \"\",\n        password: \"\",\n        firstName: \"\",\n        lastName: \"\",\n        role: \"staff\",\n      });\n\n      // Show success only after data is confirmed\n      toast({\n        title: \"Success\",\n        description: `User '${result.data.firstName} ${result.data.lastName}' updated successfully`,\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update user\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"DELETE\", `/api/admin/users/${id}`, undefined);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Success\",\n        description: \"User deleted successfully\",\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete user\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSave = (e: React.FormEvent) => {\n    e.preventDefault();\n    const formData = new FormData(e.target as HTMLFormElement);\n    const data = {\n      email: formData.get(\"email\") as string,\n      firstName: formData.get(\"firstName\") as string,\n      lastName: formData.get(\"lastName\") as string,\n      role: formData.get(\"role\") as string,\n      ...((!editingUser || formData.get(\"password\")) && {\n        password: formData.get(\"password\") as string,\n      }),\n    };\n\n    if (editingUser) {\n      updateMutation.mutate({ id: editingUser.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const handleEditUser = (user: any) => {\n    setEditingUser(user);\n    setUserData({\n      email: user.email,\n      password: \"\",\n      firstName: user.firstName,\n      lastName: user.lastName,\n      role: user.role,\n    });\n    setIsDialogOpen(true);\n  };\n\n  const getRoleBadgeVariant = (role: string) => {\n    const variants: Record<\n      string,\n      \"default\" | \"secondary\" | \"destructive\" | \"outline\"\n    > = {\n      super_admin: \"destructive\",\n      admin: \"destructive\",\n      manager: \"default\",\n      supervisor: \"secondary\",\n      marketer: \"outline\",\n      staff: \"outline\",\n    };\n    return variants[role] || \"outline\";\n  };\n\n  const handleDeleteUser = async (userId: string) => {\n    if (confirm(\"Are you sure you want to delete this user?\")) {\n      deleteMutation.mutate(userId);\n    }\n  };\n\n  const handleModuleToggle = (moduleId: string, checked: boolean) => {\n    const newSelected = new Set(selectedModules);\n    if (checked) {\n      newSelected.add(moduleId);\n    } else {\n      newSelected.delete(moduleId);\n    }\n    setSelectedModules(newSelected);\n  };\n\n  const handleCategoryToggle = (category: string, checked: boolean) => {\n    const categoryModules = getModulesByCategory(category);\n    const newSelected = new Set(selectedModules);\n\n    categoryModules.forEach((module) => {\n      if (checked) {\n        newSelected.add(module.id);\n      } else {\n        newSelected.delete(module.id);\n      }\n    });\n\n    setSelectedModules(newSelected);\n  };\n\n  const handleSaveRoleModules = () => {\n    // Ensure we convert Set to proper Array\n    const moduleIds = Array.from(selectedModules);\n    console.log('Saving role modules:', { role: selectedRole, moduleIds, isArray: Array.isArray(moduleIds) });\n    updateRoleModulesMutation.mutate({ role: selectedRole, moduleIds });\n  };\n\n  const getCategoryModules = (category: string) => {\n    return getModulesByCategory(category);\n  };\n\n  const isCategoryFullySelected = (category: string) => {\n    const categoryModules = getCategoryModules(category);\n    return (\n      categoryModules.length > 0 &&\n      categoryModules.every((module) => selectedModules.has(module.id))\n    );\n  };\n\n  const isCategoryPartiallySelected = (category: string) => {\n    const categoryModules = getCategoryModules(category);\n    return (\n      categoryModules.some((module) => selectedModules.has(module.id)) &&\n      !isCategoryFullySelected(category)\n    );\n  };\n\n  const getModuleStats = () => {\n    const totalAvailable = SYSTEM_MODULES.length;\n    const selected = selectedModules.size;\n    return { selected, totalAvailable };\n  };\n\n  const handlePermissionChange = (permissionId: number, checked: boolean) => {\n    const currentPermissionIds = rolePermissions.map((p: any) => p.id);\n    let newPermissionIds;\n\n    if (checked) {\n      newPermissionIds = [...currentPermissionIds, permissionId];\n    } else {\n      newPermissionIds = currentPermissionIds.filter(\n        (id: number) => id !== permissionId,\n      );\n    }\n\n    updateRolePermissionsMutation.mutate({\n      role: selectedRole,\n      permissionIds: newPermissionIds,\n    });\n  };\n\n  if (error) {\n    if (\n      isUnauthorizedError(error) ||\n      error.message.includes(\"403\") ||\n      error.message.includes(\"404\")\n    ) {\n      return (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center text-muted-foreground\">\n              <Users className=\"h-12 w-12 mx-auto mb-4 text-gray-400\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Access Denied</h3>\n              <p>You don't have permission to access user management.</p>\n              <p className=\"text-sm mt-2\">\n                Contact your administrator for access.\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      );\n    }\n\n    return (\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"text-center text-red-600\">\n            <p>Error loading user management: {error.message}</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const validRoles = [\n    ...(isSuperAdmin() ? [{ value: \"super_admin\", label: \"Super Admin\" }] : []),\n    { value: \"admin\", label: \"Admin\" },\n    { value: \"manager\", label: \"Manager\" },\n    { value: \"supervisor\", label: \"Supervisor\" },\n    { value: \"marketer\", label: \"Marketer\" },\n    { value: \"staff\", label: \"Staff\" },\n  ];\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-muted-foreground\">\n            Manage users, permissions, and monitor system activities\n          </p>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"users\" className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"users\" className=\"flex items-center gap-2\">\n            <Users className=\"h-4 w-4\" />\n            User Management\n          </TabsTrigger>\n          <TabsTrigger value=\"permissions\" className=\"flex items-center gap-2\">\n            <Settings className=\"h-4 w-4\" />\n            Role Permissions\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"users\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Users className=\"h-5 w-5\" />\n                    User Management\n                  </CardTitle>\n                  <CardDescription>\n                    Manage users and their roles\n                  </CardDescription>\n                </div>\n                <Dialog\n                  open={isDialogOpen}\n                  onOpenChange={(open) => {\n                    setIsDialogOpen(open);\n                    if (!open) {\n                      setEditingUser(null);\n                      setUserData({\n                        email: \"\",\n                        password: \"\",\n                        firstName: \"\",\n                        lastName: \"\",\n                        role: \"staff\",\n                      });\n                    }\n                  }}\n                >\n                  <DialogTrigger asChild>\n                    <Button disabled={!isSuperAdmin()}>\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Add User\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>\n                        {editingUser ? \"Edit User\" : \"Create New User\"}\n                      </DialogTitle>\n                      <DialogDescription>\n                        {editingUser\n                          ? \"Update user information\"\n                          : \"Add a new user to the system\"}\n                      </DialogDescription>\n                    </DialogHeader>\n                    <form onSubmit={handleSave} className=\"space-y-4\">\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                          <Label htmlFor=\"firstName\">First Name</Label>\n                          <Input\n                            id=\"firstName\"\n                            name=\"firstName\"\n                            defaultValue={userData.firstName}\n                            placeholder=\"Enter first name\"\n                            required\n                          />\n                        </div>\n                        <div>\n                          <Label htmlFor=\"lastName\">Last Name</Label>\n                          <Input\n                            id=\"lastName\"\n                            name=\"lastName\"\n                            defaultValue={userData.lastName}\n                            placeholder=\"Enter last name\"\n                            required\n                          />\n                        </div>\n                      </div>\n                      <div>\n                        <Label htmlFor=\"email\">Email</Label>\n                        <Input\n                          id=\"email\"\n                          name=\"email\"\n                          type=\"email\"\n                          defaultValue={userData.email}\n                          placeholder=\"Enter email address\"\n                          required\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"password\">\n                          {editingUser\n                            ? \"Password (leave blank to keep current)\"\n                            : \"Password\"}\n                        </Label>\n                        <Input\n                          id=\"password\"\n                          name=\"password\"\n                          type=\"password\"\n                          placeholder=\"Enter password\"\n                          required={!editingUser}\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"role\">Role</Label>\n                        <Select name=\"role\" defaultValue={userData.role}>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select role\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {validRoles.map((role) => (\n                              <SelectItem key={role.value} value={role.value}>\n                                {role.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"flex justify-end space-x-2\">\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          onClick={() => setIsDialogOpen(false)}\n                        >\n                          Cancel\n                        </Button>\n                        <Button\n                          type=\"submit\"\n                          disabled={\n                            createMutation.isPending || updateMutation.isPending\n                          }\n                        >\n                          {editingUser ? \"Update User\" : \"Create User\"}\n                        </Button>\n                      </div>\n                    </form>\n                  </DialogContent>\n                </Dialog>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                Showing {filteredUsers.length} users\n              </p>\n            </CardHeader>\n            <CardContent>\n              {isLoading ? (\n                <div className=\"flex justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Name</TableHead>\n                        <TableHead>Email</TableHead>\n                        <TableHead>Role</TableHead>\n                        <TableHead>Created</TableHead>\n                        <TableHead className=\"text-right\">Actions</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {filteredUsers.map((user: any) => (\n                        <TableRow key={user.id}>\n                          <TableCell className=\"font-medium\">\n                            {user.firstName} {user.lastName}\n                          </TableCell>\n                          <TableCell>{user.email}</TableCell>\n                          <TableCell>\n                            <Badge variant={getRoleBadgeVariant(user.role)}>\n                              {user.role}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            {new Date(user.createdAt).toLocaleDateString()}\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <div className=\"flex items-center justify-end space-x-2\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => handleEditUser(user)}\n                                disabled={\n                                  user.role === \"super_admin\" && !isSuperAdmin()\n                                }\n                                className=\"text-blue-600 hover:text-blue-800 focus:outline-none\"\n                                title=\"Edit\"\n                              >\n                                <Pencil className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => handleDeleteUser(user.id)}\n                                disabled={\n                                  user.role === \"super_admin\" && !isSuperAdmin()\n                                }\n                                className=\"text-red-600 hover:text-red-800 focus:outline-none\"\n                                title=\"Delete\"\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                  {filteredUsers.length === 0 && (\n                    <div className=\"text-center py-8\">\n                      <Users className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                      <h3 className=\"text-lg font-semibold text-muted-foreground mb-2\">\n                        No users found\n                      </h3>\n                      <p className=\"text-muted-foreground mb-4\">\n                        Start by adding your first user\n                      </p>\n                      <Button\n                        onClick={() => setIsDialogOpen(true)}\n                        disabled={!isSuperAdmin()}\n                      >\n                        <Plus className=\"h-4 w-4 mr-2\" />\n                        Add User\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"permissions\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n                <div>\n                  <CardTitle>Module Access Management</CardTitle>\n                  <CardDescription>\n                    Configure which system modules and features each role can\n                    access\n                  </CardDescription>\n                </div>\n                <div className=\"flex items-center gap-4\">\n                  <Select value={selectedRole} onValueChange={setSelectedRole}>\n                    <SelectTrigger className=\"w-[200px]\">\n                      <SelectValue placeholder=\"Select a role\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {validRoles.map((role) => (\n                        <SelectItem key={role.value} value={role.value}>\n                          {role.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {selectedRole && (\n                <>\n                  <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                    <div>\n                      <h3 className=\"font-medium\">\n                        {\n                          validRoles.find((r) => r.value === selectedRole)\n                            ?.label\n                        }\n                      </h3>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Configure module access and permissions for this role\n                      </p>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"text-lg font-semibold\">\n                        {getModuleStats().selected} /{\" \"}\n                        {getModuleStats().totalAvailable}\n                      </div>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Modules assigned\n                      </p>\n                    </div>\n                  </div>\n\n                  {selectedRole === \"super_admin\" && (\n                    <Alert>\n                      <Info className=\"h-4 w-4\" />\n                      <AlertDescription>\n                        Super Admin role has automatic access to all system\n                        modules and cannot be modified.\n                      </AlertDescription>\n                    </Alert>\n                  )}\n\n                  {currentRoleLoading ? (\n                    <div className=\"text-center py-8\">\n                      <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto mb-2\"></div>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Loading current permissions...\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-6\">\n                      {/* Individual Module List */}\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        {SYSTEM_MODULES.map((module: SystemModule) => {\n                          const isSelected = selectedModules.has(module.id);\n                          const categoryIcon = {\n                            core: <Shield className=\"h-4 w-4\" />,\n                            finance: <Activity className=\"h-4 w-4\" />,\n                            inventory: <Settings className=\"h-4 w-4\" />,\n                            crm: <Users className=\"h-4 w-4\" />,\n                            hr: <Users className=\"h-4 w-4\" />,\n                            analytics: <Activity className=\"h-4 w-4\" />,\n                            administration: <Shield className=\"h-4 w-4\" />,\n                            operations: <Settings className=\"h-4 w-4\" />,\n                          }[module.category] || (\n                            <Settings className=\"h-4 w-4\" />\n                          );\n\n                          return (\n                            <Card\n                              key={module.id}\n                              className={`transition-all ${isSelected ? \"border-primary bg-primary/5\" : \"hover:border-muted-foreground/50\"}`}\n                            >\n                              <CardContent className=\"p-4\">\n                                <div className=\"flex items-start space-x-3\">\n                                  <Checkbox\n                                    id={`module-${module.id}`}\n                                    checked={isSelected}\n                                    onCheckedChange={(checked) =>\n                                      handleModuleToggle(\n                                        module.id,\n                                        checked as boolean,\n                                      )\n                                    }\n                                    disabled={selectedRole === \"super_admin\"}\n                                    className=\"mt-1\"\n                                  />\n                                  <div className=\"flex-1 min-w-0\">\n                                    <div className=\"flex items-center gap-2 mb-1\">\n                                      {categoryIcon}\n                                      <label\n                                        htmlFor={`module-${module.id}`}\n                                        className=\"text-sm font-semibold leading-none cursor-pointer peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                                      >\n                                        {module.name}\n                                      </label>\n                                    </div>\n                                    <p className=\"text-xs text-muted-foreground mb-2\">\n                                      {module.description}\n                                    </p>\n                                    <div className=\"flex flex-wrap gap-1\">\n                                      {module.routes\n                                        .slice(0, 3)\n                                        .map((route, index) => (\n                                          <Badge\n                                            key={index}\n                                            variant=\"outline\"\n                                            className=\"text-xs font-mono\"\n                                          >\n                                            {route}\n                                          </Badge>\n                                        ))}\n                                      {module.routes.length > 3 && (\n                                        <Badge\n                                          variant=\"outline\"\n                                          className=\"text-xs\"\n                                        >\n                                          +{module.routes.length - 3} more\n                                        </Badge>\n                                      )}\n                                    </div>\n                                  </div>\n                                </div>\n                              </CardContent>\n                            </Card>\n                          );\n                        })}\n                      </div>\n\n                      {selectedRole !== \"super_admin\" && (\n                        <div className=\"flex items-center justify-between pt-4 border-t\">\n                          <div className=\"text-sm text-muted-foreground\">\n                            <strong>{selectedModules.size}</strong> of{\" \"}\n                            <strong>{SYSTEM_MODULES.length}</strong> modules\n                            selected\n                          </div>\n                          <div className=\"flex items-center space-x-3\">\n                            <Button\n                              variant=\"outline\"\n                              onClick={() => {\n                                if (\n                                  currentRoleModulesResponse?.success &&\n                                  currentRoleModulesResponse.data\n                                ) {\n                                  const grantedModules =\n                                    currentRoleModulesResponse.data\n                                      .filter((rm: any) => rm.granted)\n                                      .map((rm: any) => rm.moduleId);\n                                  setSelectedModules(new Set(grantedModules));\n                                }\n                              }}\n                            >\n                              <X className=\"h-4 w-4 mr-2\" />\n                              Reset Changes\n                            </Button>\n                            <Button\n                              onClick={handleSaveRoleModules}\n                              disabled={updateRoleModulesMutation.isPending}\n                            >\n                              {updateRoleModulesMutation.isPending ? (\n                                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                              ) : (\n                                <CheckCircle className=\"h-4 w-4 mr-2\" />\n                              )}\n                              Save Module Access for{\" \"}\n                              {\n                                validRoles.find((r) => r.value === selectedRole)\n                                  ?.label\n                              }\n                            </Button>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\nfunction SecurityMonitor() {\n  const { data: securityMetrics } = useQuery({\n    queryKey: [\"/api/security/comprehensive-metrics\"],\n    queryFn: () => apiRequest(\"/api/security/comprehensive-metrics\", \"GET\"),\n  });\n\n  const { data: securityAlerts } = useQuery({\n    queryKey: [\"/api/security/alerts\"],\n    queryFn: () => apiRequest(\"/api/security/alerts\", \"GET\"),\n  });\n\n  const { data: recentFailedLogins } = useQuery({\n    queryKey: [\"/api/login-logs/analytics\"],\n    queryFn: () => apiRequest(\"/api/login-logs/analytics\", \"GET\"),\n  });\n\n  const { data: suspiciousActivities } = useQuery({\n    queryKey: [\"/api/audit-logs/suspicious\"],\n    queryFn: () => apiRequest(\"/api/audit-logs?status=failed&limit=20\", \"GET\"),\n  });\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Security Overview */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"text-2xl font-bold text-red-600\">\n                  {recentFailedLogins?.failedLoginsLast24h || 0}\n                </div>\n                <p className=\"text-sm text-muted-foreground\">\n                  Failed Logins (24h)\n                </p>\n              </div>\n              <Shield className=\"h-8 w-8 text-red-500\" />\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"text-2xl font-bold text-orange-600\">\n                  {securityAlerts?.totalActive || 0}\n                </div>\n                <p className=\"text-sm text-muted-foreground\">Active Threats</p>\n              </div>\n              <Activity className=\"h-8 w-8 text-orange-500\" />\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"text-2xl font-bold text-green-600\">\n                  {securityMetrics?.riskScore || 0}%\n                </div>\n                <p className=\"text-sm text-muted-foreground\">Risk Score</p>\n              </div>\n              <Users className=\"h-8 w-8 text-green-500\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Recent Failed Logins */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Shield className=\"h-5 w-5 text-red-500\" />\n            Recent Failed Login Attempts\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {recentFailedLogins?.recentFailedLogins?.length > 0 ? (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Email</TableHead>\n                    <TableHead>IP Address</TableHead>\n                    <TableHead>Location</TableHead>\n                    <TableHead>Time</TableHead>\n                    <TableHead>Device</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {recentFailedLogins.recentFailedLogins.map((log: any) => (\n                    <TableRow key={log.id}>\n                      <TableCell className=\"font-medium\">{log.email}</TableCell>\n                      <TableCell className=\"font-mono text-sm\">\n                        {log.ipAddress}\n                      </TableCell>\n                      <TableCell>{log.location || \"Unknown\"}</TableCell>\n                      <TableCell>\n                        {new Date(log.loginTime).toLocaleString()}\n                      </TableCell>\n                      <TableCell>{log.deviceType || \"Unknown\"}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Shield className=\"h-12 w-12 text-green-500 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold text-green-700 mb-2\">\n                All Clear!\n              </h3>\n              <p className=\"text-muted-foreground\">\n                No failed login attempts in the last 24 hours\n              </p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Suspicious Activities */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Activity className=\"h-5 w-5 text-orange-500\" />\n            Recent Failed Operations\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {suspiciousActivities?.auditLogs?.length > 0 ? (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>User</TableHead>\n                    <TableHead>Action</TableHead>\n                    <TableHead>Resource</TableHead>\n                    <TableHead>IP Address</TableHead>\n                    <TableHead>Time</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {suspiciousActivities.auditLogs.map((log: any) => (\n                    <TableRow key={log.id}>\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">{log.userName}</div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            {log.userEmail}\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"destructive\">{log.action}</Badge>\n                      </TableCell>\n                      <TableCell className=\"capitalize\">\n                        {log.resource.replace(\"_\", \" \")}\n                      </TableCell>\n                      <TableCell className=\"font-mono text-sm\">\n                        {log.ipAddress}\n                      </TableCell>\n                      <TableCell>\n                        {new Date(log.timestamp).toLocaleString()}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Activity className=\"h-12 w-12 text-green-500 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold text-green-700 mb-2\">\n                All Operations Successful!\n              </h3>\n              <p className=\"text-muted-foreground\">\n                No failed operations detected recently\n              </p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Security Alerts */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <AlertTriangle className=\"h-5 w-5 text-red-500\" />\n            Active Security Alerts\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {securityAlerts?.activeAlerts?.length > 0 ||\n          securityAlerts?.dashboardAlerts?.length > 0 ? (\n            <div className=\"space-y-4\">\n              {/* Active Alerts */}\n              {securityAlerts?.activeAlerts?.map((alert: any) => (\n                <div\n                  key={alert.id}\n                  className=\"border border-red-200 rounded-lg p-4 bg-red-50\"\n                >\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <Badge\n                          variant=\"destructive\"\n                          className={`${\n                            alert.severity === \"HIGH\"\n                              ? \"bg-red-600\"\n                              : alert.severity === \"MEDIUM\"\n                                ? \"bg-orange-600\"\n                                : \"bg-yellow-600\"\n                          }`}\n                        >\n                          {alert.severity}\n                        </Badge>\n                        <span className=\"font-semibold text-red-800\">\n                          {alert.title}\n                        </span>\n                      </div>\n                      <p className=\"text-sm text-red-700 mb-2\">\n                        {alert.description}\n                      </p>\n                      <div className=\"flex items-center gap-4 text-xs text-red-600\">\n                        <span>User: {alert.userEmail}</span>\n                        <span>IP: {alert.ipAddress}</span>\n                        <span>\n                          Time: {new Date(alert.timestamp).toLocaleString()}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n\n              {/* Dashboard Alerts */}\n              {securityAlerts?.dashboardAlerts?.map((alert: any) => (\n                <div\n                  key={alert.id}\n                  className=\"border border-orange-200 rounded-lg p-4 bg-orange-50\"\n                >\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <Badge\n                          variant=\"secondary\"\n                          className={`${\n                            alert.severity === \"HIGH\"\n                              ? \"bg-red-600\"\n                              : alert.severity === \"MEDIUM\"\n                                ? \"bg-orange-600\"\n                                : \"bg-yellow-600\"\n                          }`}\n                        >\n                          {alert.severity}\n                        </Badge>\n                        <span className=\"font-semibold text-orange-800\">\n                          {alert.title}\n                        </span>\n                      </div>\n                      <p className=\"text-sm text-orange-700 mb-2\">\n                        {alert.description}\n                      </p>\n                      <div className=\"flex items-center gap-4 text-xs text-orange-600\">\n                        <span>User: {alert.userEmail}</span>\n                        <span>IP: {alert.ipAddress}</span>\n                        <span>\n                          Time: {new Date(alert.timestamp).toLocaleString()}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <CheckCircle className=\"h-12 w-12 text-green-500 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold text-green-700 mb-2\">\n                System Secure\n              </h3>\n              <p className=\"text-muted-foreground\">\n                No active security threats detected\n              </p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":47315,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\";\n\nimport * as React from \"react\";\nimport * as SelectPrimitive from \"@radix-ui/react-select\";\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst Select = SelectPrimitive.Root;\n\nconst SelectGroup = SelectPrimitive.Group;\n\nconst SelectValue = SelectPrimitive.Value;\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className,\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n));\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName;\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className,\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n));\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName;\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className,\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n));\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName;\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative  z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className,\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\"\n            ? \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n            : \"\",\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n));\nSelectContent.displayName = SelectPrimitive.Content.displayName;\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n));\nSelectLabel.displayName = SelectPrimitive.Label.displayName;\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors duration-100\",\n\n      // ‚úÖ Hover: mouse over\n      \"hover:bg-orange-100\",\n\n      // ‚úÖ Focus/Highlight: keyboard navigation or pointer focus\n      \"data-[highlighted]:bg-orange-100 \",\n\n      // ‚úÖ Selected value indicator (visual only ‚Äî no \"checked\" state)\n      // Use a checkmark icon to show which item is currently selected\n      \"pl-8\", // Make space for indicator\n\n      // ‚ùå Remove: data-[state=checked] ‚Äî it doesn't exist on Select.Item\n      // \"data-[state=checked]:bg-orange-100 data-[state=checked]:text-orange-800\"\n\n      className,\n    )}\n    {...props}\n  >\n    {/* Checkmark indicator (only visible when selected) */}\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n));\nSelectItem.displayName = SelectPrimitive.Item.displayName;\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n));\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName;\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n};\n","path":null,"size_bytes":6155,"size_tokens":null},"client/src/components/install-prompt.tsx":{"content":"\nimport React, { useState } from 'react';\nimport { usePWAInstall } from '@/hooks/usePWAInstall';\nimport { Button } from '@/components/ui/button';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { useToast } from '@/hooks/use-toast';\nimport {\n  Download,\n  Smartphone,\n  X,\n  CheckCircle2,\n  Info,\n  ExternalLink,\n} from 'lucide-react';\n\nexport function InstallPrompt() {\n  const { isInstallable, isInstalled, installApp, getInstallInstructions, canPromptInstall } = usePWAInstall();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [showInstructions, setShowInstructions] = useState(false);\n  const { toast } = useToast();\n\n  const handleInstall = async () => {\n    if (canPromptInstall) {\n      const success = await installApp();\n      if (success) {\n        toast({\n          title: 'App Installed!',\n          description: 'BakerSoft has been added to your home screen.',\n        });\n        setIsDialogOpen(false);\n      } else {\n        toast({\n          title: 'Installation Cancelled',\n          description: 'You can install the app later from your browser menu.',\n          variant: 'destructive',\n        });\n      }\n    } else {\n      setShowInstructions(true);\n    }\n  };\n\n  if (isInstalled) {\n    return (\n      <Card className=\"border-green-200 bg-green-50\">\n        <CardContent className=\"flex items-center gap-3 p-4\">\n          <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n          <div>\n            <p className=\"font-medium text-green-800\">App Installed</p>\n            <p className=\"text-sm text-green-600\">BakerSoft is installed on your device</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!isInstallable && !canPromptInstall) {\n    return null;\n  }\n\n  const instructions = getInstallInstructions();\n\n  return (\n    <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" className=\"gap-2\">\n          <Download className=\"h-4 w-4\" />\n          Install App\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Smartphone className=\"h-5 w-5\" />\n            Install BakerSoft\n          </DialogTitle>\n          <DialogDescription>\n            Install BakerSoft on your device for the best experience\n          </DialogDescription>\n        </DialogHeader>\n\n        {!showInstructions ? (\n          <div className=\"space-y-4\">\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-medium\">Quick Install</h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Add BakerSoft to your home screen for offline access\n                    </p>\n                  </div>\n                  <Badge variant=\"secondary\">PWA</Badge>\n                </div>\n              </CardContent>\n            </Card>\n\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                <span>Offline Access</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                <span>Fast Loading</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                <span>Native Feel</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                <span>Push Notifications</span>\n              </div>\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-base flex items-center gap-2\">\n                  <Info className=\"h-4 w-4\" />\n                  Install Instructions for {instructions.browser}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"pt-2\">\n                <ol className=\"space-y-2 text-sm\">\n                  {instructions.steps.map((step, index) => (\n                    <li key={index} className=\"flex gap-2\">\n                      <span className=\"flex-shrink-0 w-5 h-5 bg-primary text-primary-foreground rounded-full text-xs flex items-center justify-center\">\n                        {index + 1}\n                      </span>\n                      <span>{step}</span>\n                    </li>\n                  ))}\n                </ol>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        <DialogFooter className=\"flex-col sm:flex-col gap-2\">\n          {!showInstructions ? (\n            <div className=\"flex gap-2 w-full\">\n              <Button onClick={handleInstall} className=\"flex-1\">\n                <Download className=\"h-4 w-4 mr-2\" />\n                {canPromptInstall ? 'Install Now' : 'Show Instructions'}\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowInstructions(true)}\n                className=\"flex-1\"\n              >\n                <Info className=\"h-4 w-4 mr-2\" />\n                Manual Steps\n              </Button>\n            </div>\n          ) : (\n            <div className=\"flex gap-2 w-full\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowInstructions(false)}\n                className=\"flex-1\"\n              >\n                Back\n              </Button>\n              <Button onClick={() => setIsDialogOpen(false)} className=\"flex-1\">\n                Close\n              </Button>\n            </div>\n          )}\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":6304,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/pages/transactions.tsx":{"content":"import { useState, useMemo, startTransition } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport SearchBar from \"@/components/search-bar\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Search,\n  Filter,\n  Download,\n  Eye,\n  Calendar,\n  FileText,\n  Users,\n  TrendingUp,\n  AlertCircle,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { format } from \"date-fns\";\n\n// Assume useTableSort and usePagination are custom hooks providing sorting and pagination logic\n// Example stubs:\nconst useTableSort = (data: any[], defaultSortColumn: string) => {\n  const [sortConfig, setSortConfig] = useState({\n    key: defaultSortColumn,\n    direction: \"ascending\",\n  });\n\n  const sortedData = useMemo(() => {\n    let sortableItems = [...data];\n    if (sortConfig.key !== null) {\n      sortableItems.sort((a, b) => {\n        if (a[sortConfig.key] < b[sortConfig.key]) {\n          return sortConfig.direction === \"ascending\" ? -1 : 1;\n        }\n        if (a[sortConfig.key] > b[sortConfig.key]) {\n          return sortConfig.direction === \"ascending\" ? 1 : -1;\n        }\n        return 0;\n      });\n    }\n    return sortableItems;\n  }, [data, sortConfig]);\n\n  const requestSort = (key: string) => {\n    let direction = \"ascending\";\n    if (sortConfig.key === key && sortConfig.direction === \"ascending\") {\n      direction = \"descending\";\n    }\n    setSortConfig({ key, direction });\n  };\n\n  return { sortedData, sortConfig, requestSort };\n};\n\nconst usePagination = (data: any[], initialPageSize: number) => {\n  const [pageSize, setPageSize] = useState(initialPageSize);\n  const [currentPage, setCurrentPage] = useState(1);\n  const totalItems = data.length;\n  const totalPages = Math.ceil(totalItems / pageSize);\n\n  const currentItems = useMemo(() => {\n    const startIndex = (currentPage - 1) * pageSize;\n    const endIndex = startIndex + pageSize;\n    return data.slice(startIndex, endIndex);\n  }, [data, currentPage, pageSize]);\n\n  const goToPage = (page: number) => {\n    if (page >= 1 && page <= totalPages) {\n      setCurrentPage(page);\n    }\n  };\n\n  return {\n    currentItems,\n    currentPage,\n    totalPages,\n    pageSize,\n    setPageSize,\n    goToPage,\n    totalItems,\n  };\n};\n\n// Assume SortableTableHeader, PaginationInfo, PageSizeSelector, Pagination are UI components\nconst SortableTableHeader = ({\n  children,\n  sortKey,\n  sortConfig,\n  onSort,\n  className,\n}: any) => {\n  const isSorted = sortConfig.key === sortKey;\n  const icon =\n    sortConfig.key === sortKey\n      ? sortConfig.direction === \"ascending\"\n        ? \" ‚ñ≤\"\n        : \" ‚ñº\"\n      : \"\";\n  return (\n    <TableHead className={className}>\n      <Button\n        variant=\"ghost\"\n        className=\"p-0 h-auto\"\n        onClick={() => onSort(sortKey)}\n      >\n        {children}\n        {isSorted && <span className=\"ml-1\">{icon}</span>}\n      </Button>\n    </TableHead>\n  );\n};\n\nconst PaginationInfo = ({ currentPage, totalPages, totalItems }: any) => (\n  <div className=\"text-sm text-muted-foreground\">\n    Page {currentPage} of {totalPages} ({totalItems} items)\n  </div>\n);\n\nconst PageSizeSelector = ({ pageSize, onPageSizeChange, options }: any) => (\n  <Select\n    value={pageSize.toString()}\n    onValueChange={(val) => onPageSizeChange(parseInt(val))}\n  >\n    <SelectTrigger className=\"w-[100px]\">\n      <SelectValue placeholder=\"Page Size\" />\n    </SelectTrigger>\n    <SelectContent>\n      {options.map((size: number) => (\n        <SelectItem key={size} value={size.toString()}>\n          Show {size}\n        </SelectItem>\n      ))}\n    </SelectContent>\n  </Select>\n);\n\nconst Pagination = ({ currentPage, totalPages, onPageChange }: any) => (\n  <div className=\"flex items-center gap-2\">\n    <Button\n      variant=\"outline\"\n      size=\"sm\"\n      onClick={() => onPageChange(currentPage - 1)}\n      disabled={currentPage === 1}\n    >\n      Previous\n    </Button>\n    <Button\n      variant=\"outline\"\n      size=\"sm\"\n      onClick={() => onPageChange(currentPage + 1)}\n      disabled={currentPage === totalPages}\n    >\n      Next\n    </Button>\n  </div>\n);\n\ninterface Transaction {\n  id: string;\n  entryDate: string;\n  txnDate: string;\n  txnNo: string;\n  particular: string;\n  txnType: string;\n  parties: string;\n  pmtMode: string;\n  amount: number;\n  status: string;\n  entryBy: string;\n  category: string;\n}\n\ninterface SupplierTransaction {\n  id: number;\n  supplierId: number;\n  supplierName: string;\n  purchaseId: number;\n  date: string;\n  invoiceNumber?: string;\n  items: string;\n  totalAmount: number;\n  amountPaid: number;\n  outstanding: number;\n  runningBalance: number;\n  paymentStatus: \"Paid\" | \"Partial\" | \"Due\";\n  paymentMethod: string;\n  transactionType: \"Purchase\" | \"Payment\";\n}\n\ninterface SupplierLedger {\n  supplierId: number;\n  supplierName: string;\n  totalPurchases: number;\n  totalPaid: number;\n  totalOutstanding: number;\n  currentBalance: number;\n  transactions: SupplierTransaction[];\n}\n\nexport default function Transactions() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [typeFilter, setTypeFilter] = useState(\"all\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [dateRange, setDateRange] = useState(\"30\");\n  const [activeTab, setActiveTab] = useState(\"all\");\n  const [supplierLedgerOpen, setSupplierLedgerOpen] = useState(false);\n  const [selectedSupplier, setSelectedSupplier] =\n    useState<SupplierLedger | null>(null);\n  const [supplierFilter, setSupplierFilter] = useState(\"all\");\n  const [supplierDateRange, setSupplierDateRange] = useState(\"all\");\n  const [supplierPaymentStatus, setSupplierPaymentStatus] = useState(\"all\");\n  const { toast } = useToast();\n  const { formatCurrency } = useCurrency();\n\n  // Fetch all data sources\n  const { data: orders = [] } = useQuery({\n    queryKey: [\"/api/orders\"],\n  });\n\n  const { data: sales = [] } = useQuery({\n    queryKey: [\"/api/sales\"],\n  });\n\n  const { data: purchases = [] } = useQuery({\n    queryKey: [\"/api/purchases\"],\n  });\n\n  const { data: expenses = [] } = useQuery({\n    queryKey: [\"/api/expenses\"],\n  });\n\n  // Fetch parties (suppliers)\n  const { data: suppliers = [] } = useQuery({\n    queryKey: [\"parties\"],\n    queryFn: async () => {\n      try {\n        const res = await apiRequest(\"GET\", \"/api/parties\");\n        const partiesData = Array.isArray(res)\n          ? res\n          : res.parties || res.data || [];\n        return Array.isArray(partiesData) ? partiesData : [];\n      } catch (error) {\n        console.error(\"Failed to fetch parties:\", error);\n        return [];\n      }\n    },\n    retry: (failureCount, error) =>\n      !isUnauthorizedError(error) && failureCount < 3,\n  });\n\n  const { data: supplierLedgers = [] } = useQuery({\n    queryKey: [\"/api/supplier-ledgers\"],\n  });\n\n  // Combine all transactions\n  const allTransactions = useMemo(() => {\n    const transactions: Transaction[] = [];\n    let counter = 1;\n\n    // Add sales transactions\n    sales.forEach((sale: any) => {\n      transactions.push({\n        id: `S-${sale.id}`,\n        entryDate: format(new Date(sale.createdAt), \"yyyy-MM-dd\"),\n        txnDate: format(\n          new Date(sale.saleDate || sale.createdAt),\n          \"yyyy-MM-dd\",\n        ),\n        txnNo: `INV-${sale.id}`,\n        particular: sale.customerName || \"Walk-in Customer\",\n        txnType: \"Sales\",\n        parties: sale.customerName || \"-\",\n        pmtMode: sale.paymentMethod || \"Cash\",\n        amount: parseFloat(sale.totalAmount),\n        status: \"Paid\",\n        entryBy: sale.createdBy || \"System\",\n        category: \"Income\",\n      });\n    });\n\n    // Add purchase transactions\n    purchases.forEach((purchase: any) => {\n      transactions.push({\n        id: `P-${purchase.id}`,\n        entryDate: format(new Date(purchase.createdAt), \"yyyy-MM-dd\"),\n        txnDate: format(\n          new Date(purchase.purchaseDate || purchase.createdAt),\n          \"yyyy-MM-dd\",\n        ),\n        txnNo: `PUR-${purchase.id}`,\n        particular: purchase.supplierName || \"Supplier\",\n        txnType: \"Purchase\",\n        parties: purchase.supplierName || \"-\",\n        pmtMode: purchase.paymentMethod || \"Cash\",\n        amount: parseFloat(purchase.totalAmount),\n        status: purchase.status === \"completed\" ? \"Paid\" : \"Pending\",\n        entryBy: purchase.createdBy || \"System\",\n        category: \"Expense\",\n      });\n    });\n\n    // Add order transactions (as income when completed)\n    orders.forEach((order: any) => {\n      if (order.status === \"completed\") {\n        transactions.push({\n          id: `O-${order.id}`,\n          entryDate: format(new Date(order.createdAt), \"yyyy-MM-dd\"),\n          txnDate: format(\n            new Date(order.orderDate || order.createdAt),\n            \"yyyy-MM-dd\",\n          ),\n          txnNo: `ORD-${order.id}`,\n          particular: order.customerName,\n          txnType: \"Sales\",\n          parties: order.customerName || \"-\",\n          pmtMode: \"Cash\",\n          amount: parseFloat(order.totalAmount),\n          status: \"Paid\",\n          entryBy: order.createdBy || \"System\",\n          category: \"Income\",\n        });\n      }\n    });\n\n    // Add expense transactions\n    expenses.forEach((expense: any) => {\n      transactions.push({\n        id: `E-${expense.id}`,\n        entryDate: format(new Date(expense.createdAt), \"yyyy-MM-dd\"),\n        txnDate: format(\n          new Date(expense.date || expense.createdAt),\n          \"yyyy-MM-dd\",\n        ),\n        txnNo: `EXP-${expense.id}`,\n        particular: expense.description || expense.category,\n        txnType: \"Expense\",\n        parties: expense.vendor || \"-\",\n        pmtMode: expense.paymentMethod || \"Cash\",\n        amount: parseFloat(expense.amount),\n        status: \"Paid\",\n        entryBy: expense.createdBy || \"System\",\n        category: \"Expense\",\n      });\n    });\n\n    // Sort by date (newest first)\n    return transactions.sort(\n      (a, b) => new Date(b.txnDate).getTime() - new Date(a.txnDate).getTime(),\n    );\n  }, [orders, sales, purchases, expenses]);\n\n  // Filter transactions\n  const filteredTransactions = useMemo(() => {\n    let filtered = allTransactions;\n\n    // Date range filter\n    if (dateRange !== \"all\") {\n      const days = parseInt(dateRange);\n      const cutoffDate = new Date();\n      cutoffDate.setDate(cutoffDate.getDate() - days);\n      filtered = filtered.filter((txn) => new Date(txn.txnDate) >= cutoffDate);\n    }\n\n    // Search filter\n    if (searchTerm) {\n      filtered = filtered.filter(\n        (txn) =>\n          txn.particular.toLowerCase().includes(searchTerm.toLowerCase()) ||\n          txn.txnNo.toLowerCase().includes(searchTerm.toLowerCase()) ||\n          txn.parties.toLowerCase().includes(searchTerm.toLowerCase()),\n      );\n    }\n\n    // Type filter\n    if (typeFilter !== \"all\") {\n      filtered = filtered.filter(\n        (txn) => txn.txnType.toLowerCase() === typeFilter.toLowerCase(),\n      );\n    }\n\n    // Status filter\n    if (statusFilter !== \"all\") {\n      filtered = filtered.filter(\n        (txn) => txn.status.toLowerCase() === statusFilter.toLowerCase(),\n      );\n    }\n\n    return filtered;\n  }, [allTransactions, searchTerm, typeFilter, statusFilter, dateRange]);\n\n  // Add sorting functionality\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    allTransactions,\n    \"txnDate\",\n  );\n\n  // Add pagination functionality\n  const {\n    currentItems,\n    currentPage,\n    totalPages,\n    pageSize,\n    setPageSize,\n    goToPage,\n    totalItems,\n  } = usePagination(sortedData, 15);\n\n  // Calculate summary stats\n  const stats = useMemo(() => {\n    const sales = filteredTransactions\n      .filter((t) => t.category === \"Income\")\n      .reduce((sum, t) => sum + t.amount, 0);\n    const purchases = filteredTransactions\n      .filter((t) => t.txnType === \"Purchase\")\n      .reduce((sum, t) => sum + t.amount, 0);\n    const income = filteredTransactions\n      .filter((t) => t.category === \"Income\")\n      .reduce((sum, t) => sum + t.amount, 0);\n    const expenses = filteredTransactions\n      .filter((t) => t.category === \"Expense\")\n      .reduce((sum, t) => sum + t.amount, 0);\n    const paymentIn = filteredTransactions\n      .filter((t) => t.category === \"Income\")\n      .reduce((sum, t) => sum + t.amount, 0);\n    const paymentOut = filteredTransactions\n      .filter((t) => t.category === \"Expense\")\n      .reduce((sum, t) => sum + t.amount, 0);\n\n    return { sales, purchases, income, expenses, paymentIn, paymentOut };\n  }, [filteredTransactions]);\n\n  // Process supplier ledger data\n  const processedSupplierLedgers = useMemo(() => {\n    const ledgerMap = new Map<number, SupplierLedger>();\n\n    // Initialize ledgers for all suppliers\n    suppliers.forEach((supplier: any) => {\n      ledgerMap.set(supplier.id, {\n        supplierId: supplier.id,\n        supplierName: supplier.name,\n        totalPurchases: 0,\n        totalPaid: 0,\n        totalOutstanding: 0,\n        currentBalance: 0,\n        transactions: [],\n      });\n    });\n\n    // Process purchases\n    purchases.forEach((purchase: any) => {\n      if (!purchase.partyId) return;\n\n      const ledger = ledgerMap.get(purchase.partyId);\n      if (!ledger) return;\n\n      const totalAmount = parseFloat(purchase.totalAmount || \"0\");\n      const amountPaid = purchase.status === \"completed\" ? totalAmount : 0;\n      const outstanding = totalAmount - amountPaid;\n\n      const transaction: SupplierTransaction = {\n        id: purchase.id,\n        supplierId: purchase.partyId,\n        supplierName: purchase.supplierName,\n        purchaseId: purchase.id,\n        date: purchase.purchaseDate || purchase.createdAt,\n        invoiceNumber: purchase.invoiceNumber,\n        items:\n          purchase.items\n            ?.map((item: any) => item.inventoryItemName)\n            .join(\", \") || \"N/A\",\n        totalAmount,\n        amountPaid,\n        outstanding,\n        runningBalance: 0, // Will be calculated\n        paymentStatus:\n          purchase.status === \"completed\"\n            ? \"Paid\"\n            : outstanding > 0\n              ? amountPaid > 0\n                ? \"Partial\"\n                : \"Due\"\n              : \"Paid\",\n        paymentMethod: purchase.paymentMethod || \"Cash\",\n        transactionType: \"Purchase\",\n      };\n\n      ledger.transactions.push(transaction);\n      ledger.totalPurchases += totalAmount;\n      ledger.totalPaid += amountPaid;\n      ledger.totalOutstanding += outstanding;\n    });\n\n    // Calculate running balances and current balance for each supplier\n    ledgerMap.forEach((ledger) => {\n      let runningBalance = 0;\n\n      // Sort transactions by date\n      ledger.transactions.sort(\n        (a, b) => new Date(a.date).getTime() - new Date(b.date).getTime(),\n      );\n\n      // Calculate running balance\n      ledger.transactions.forEach((transaction) => {\n        if (transaction.transactionType === \"Purchase\") {\n          runningBalance += transaction.outstanding; // Debit (increases payable)\n        }\n        transaction.runningBalance = runningBalance;\n      });\n\n      ledger.currentBalance = runningBalance;\n    });\n\n    return Array.from(ledgerMap.values()).filter(\n      (ledger) => ledger.transactions.length > 0,\n    );\n  }, [purchases, suppliers]);\n\n  // Filter supplier ledgers\n  const filteredSupplierLedgers = useMemo(() => {\n    let filtered = processedSupplierLedgers;\n\n    if (searchTerm) {\n      filtered = filtered.filter((ledger) =>\n        ledger.supplierName.toLowerCase().includes(searchTerm.toLowerCase()),\n      );\n    }\n\n    if (supplierFilter !== \"all\") {\n      filtered = filtered.filter(\n        (ledger) => ledger.supplierId.toString() === supplierFilter,\n      );\n    }\n\n    if (supplierPaymentStatus !== \"all\") {\n      filtered = filtered.filter((ledger) => {\n        return ledger.transactions.some(\n          (t) =>\n            t.paymentStatus.toLowerCase() ===\n            supplierPaymentStatus.toLowerCase(),\n        );\n      });\n    }\n\n    if (supplierDateRange !== \"all\") {\n      const days = parseInt(supplierDateRange);\n      const cutoffDate = new Date();\n      cutoffDate.setDate(cutoffDate.getDate() - days);\n\n      filtered = filtered\n        .map((ledger) => ({\n          ...ledger,\n          transactions: ledger.transactions.filter(\n            (t) => new Date(t.date) >= cutoffDate,\n          ),\n        }))\n        .filter((ledger) => ledger.transactions.length > 0);\n    }\n\n    return filtered;\n  }, [\n    processedSupplierLedgers,\n    searchTerm,\n    supplierFilter,\n    supplierPaymentStatus,\n    supplierDateRange,\n  ]);\n\n  const handleSupplierLedgerView = (ledger: SupplierLedger) => {\n    setSelectedSupplier(ledger);\n    setSupplierLedgerOpen(true);\n  };\n\n  const getPaymentStatusBadge = (status: string, balance: number) => {\n    if (balance > 0) {\n      return (\n        <Badge variant=\"destructive\" className=\"bg-red-100 text-red-800\">\n          üî¥ Due\n        </Badge>\n      );\n    } else if (balance < 0) {\n      return (\n        <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-800\">\n          üîµ Advance\n        </Badge>\n      );\n    } else {\n      return (\n        <Badge variant=\"default\" className=\"bg-green-100 text-green-800\">\n          üü¢ Paid\n        </Badge>\n      );\n    }\n  };\n\n  const exportSupplierLedger = (ledger?: SupplierLedger) => {\n    const dataToExport = ledger ? [ledger] : filteredSupplierLedgers;\n\n    const csvContent = [\n      [\n        \"Supplier\",\n        \"Date\",\n        \"Invoice\",\n        \"Items\",\n        \"Total Amount\",\n        \"Amount Paid\",\n        \"Outstanding\",\n        \"Running Balance\",\n        \"Payment Status\",\n      ].join(\",\"),\n      ...dataToExport.flatMap((ledger) =>\n        ledger.transactions.map((txn) =>\n          [\n            ledger.supplierName,\n            format(new Date(txn.date), \"yyyy-MM-dd\"),\n            txn.invoiceNumber || \"N/A\",\n            `\"${txn.items.replace(/\"/g, '\"\"')}\"`, // Properly escape quotes in items\n            txn.totalAmount,\n            txn.amountPaid,\n            txn.outstanding,\n            txn.runningBalance,\n            txn.paymentStatus,\n          ].join(\",\"),\n        ),\n      ),\n    ].join(\"\\n\");\n\n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `supplier-ledger-${format(new Date(), \"yyyy-MM-dd\")}.csv`;\n    a.click();\n    window.URL.revokeObjectURL(url);\n\n    toast({\n      title: \"Export Successful\",\n      description: \"Supplier ledger exported to CSV file\",\n    });\n  };\n\n  const exportTransactions = () => {\n    const csvContent = [\n      [\n        \"SN\",\n        \"Entry Date\",\n        \"TXN Date\",\n        \"TXN No\",\n        \"Particular\",\n        \"TXN Type\",\n        \"Parties\",\n        \"PMT Mode\",\n        \"Amount\",\n        \"Status\",\n        \"Entry By\",\n      ].join(\",\"),\n      ...filteredTransactions.map((txn, index) =>\n        [\n          index + 1,\n          txn.entryDate,\n          txn.txnDate,\n          txn.txnNo,\n          `\"${txn.particular.replace(/\"/g, '\"\"')}\"`, // Properly escape quotes\n          txn.txnType,\n          `\"${txn.parties.replace(/\"/g, '\"\"')}\"`, // Properly escape quotes\n          txn.pmtMode,\n          txn.amount,\n          txn.status,\n          txn.entryBy,\n        ].join(\",\"),\n      ),\n    ].join(\"\\n\");\n\n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `transactions-${format(new Date(), \"yyyy-MM-dd\")}.csv`;\n    a.click();\n    window.URL.revokeObjectURL(url);\n\n    toast({\n      title: \"Export Successful\",\n      description: \"Transactions exported to CSV file\",\n    });\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600\">\n            All financial transactions and supplier ledgers in one place\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          {activeTab === \"supplier\" && (\n            <Button onClick={() => exportSupplierLedger()} variant=\"outline\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export Ledger\n            </Button>\n          )}\n          <Button onClick={exportTransactions} variant=\"outline\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export Transactions\n          </Button>\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"all\">All Transactions</TabsTrigger>\n          <TabsTrigger value=\"supplier\">Supplier Ledger</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"all\" className=\"space-y-6\">\n          {/* Summary Cards */}\n          <div className=\"grid grid-cols-2 md:grid-cols-6 gap-4\">\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm font-medium text-muted-foreground\">\n                  Sales\n                </div>\n                <div className=\"text-lg font-bold text-green-600\">\n                  {formatCurrency(stats.sales)}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm font-medium text-muted-foreground\">\n                  Purchase\n                </div>\n                <div className=\"text-lg font-bold text-red-600\">\n                  {formatCurrency(stats.purchases)}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm font-medium text-muted-foreground\">\n                  Income\n                </div>\n                <div className=\"text-lg font-bold text-green-600\">\n                  {formatCurrency(stats.income)}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm font-medium text-muted-foreground\">\n                  Expense\n                </div>\n                <div className=\"text-lg font-bold text-red-600\">\n                  {formatCurrency(stats.expenses)}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm font-medium text-muted-foreground\">\n                  Payment In\n                </div>\n                <div className=\"text-lg font-bold text-green-600\">\n                  {formatCurrency(stats.paymentIn)}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm font-medium text-muted-foreground\">\n                  Payment Out\n                </div>\n                <div className=\"text-lg font-bold text-red-600\">\n                  {formatCurrency(stats.paymentOut)}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Filters */}\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex flex-col sm:flex-row gap-4\">\n                <div className=\"flex-1\">\n                  <SearchBar\n                    placeholder=\"Search transactions...\"\n                    value={searchTerm}\n                    onChange={setSearchTerm}\n                    className=\"w-full\"\n                  />\n                </div>\n                <Select value={typeFilter} onValueChange={setTypeFilter}>\n                  <SelectTrigger className=\"w-[150px]\">\n                    <SelectValue placeholder=\"Transaction Type\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Types</SelectItem>\n                    <SelectItem value=\"sales\">Sales</SelectItem>\n                    <SelectItem value=\"purchase\">Purchase</SelectItem>\n                    <SelectItem value=\"expense\">Expense</SelectItem>\n                  </SelectContent>\n                </Select>\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\n                  <SelectTrigger className=\"w-[130px]\">\n                    <SelectValue placeholder=\"Status\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Status</SelectItem>\n                    <SelectItem value=\"paid\">Paid</SelectItem>\n                    <SelectItem value=\"pending\">Pending</SelectItem>\n                  </SelectContent>\n                </Select>\n                <Select value={dateRange} onValueChange={setDateRange}>\n                  <SelectTrigger className=\"w-[130px]\">\n                    <SelectValue placeholder=\"Date Range\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"7\">Last 7 days</SelectItem>\n                    <SelectItem value=\"30\">Last 30 days</SelectItem>\n                    <SelectItem value=\"90\">Last 90 days</SelectItem>\n                    <SelectItem value=\"all\">All time</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Transactions Table */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center justify-between\">\n                <span>Transaction History</span>\n                <Badge variant=\"secondary\">\n                  {filteredTransactions.length} transactions\n                </Badge>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"overflow-x-auto\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"w-12\">SN</TableHead>\n                      <SortableTableHeader\n                        sortKey=\"txnDate\"\n                        sortConfig={sortConfig}\n                        onSort={requestSort}\n                      >\n                        TXN Date\n                      </SortableTableHeader>\n                      <SortableTableHeader\n                        sortKey=\"txnNo\"\n                        sortConfig={sortConfig}\n                        onSort={requestSort}\n                      >\n                        TXN No\n                      </SortableTableHeader>\n                      <SortableTableHeader\n                        sortKey=\"particular\"\n                        sortConfig={sortConfig}\n                        onSort={requestSort}\n                      >\n                        Particular\n                      </SortableTableHeader>\n                      <SortableTableHeader\n                        sortKey=\"txnType\"\n                        sortConfig={sortConfig}\n                        onSort={requestSort}\n                      >\n                        TXN Type\n                      </SortableTableHeader>\n                      <SortableTableHeader\n                        sortKey=\"parties\"\n                        sortConfig={sortConfig}\n                        onSort={requestSort}\n                      >\n                        Parties\n                      </SortableTableHeader>\n                      <SortableTableHeader\n                        sortKey=\"pmtMode\"\n                        sortConfig={sortConfig}\n                        onSort={requestSort}\n                      >\n                        PMT Mode\n                      </SortableTableHeader>\n                      <SortableTableHeader\n                        sortKey=\"amount\"\n                        sortConfig={sortConfig}\n                        onSort={requestSort}\n                        className=\"text-right\"\n                      >\n                        Amount\n                      </SortableTableHeader>\n                      <SortableTableHeader\n                        sortKey=\"status\"\n                        sortConfig={sortConfig}\n                        onSort={requestSort}\n                      >\n                        Status\n                      </SortableTableHeader>\n                      <TableHead>Entry By</TableHead>\n                      <TableHead className=\"w-12\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {currentItems.length > 0 ? (\n                      currentItems.map((transaction, index) => (\n                        <TableRow key={transaction.id}>\n                          <TableCell className=\"font-medium\">\n                            {index + 1}\n                          </TableCell>\n\n                          <TableCell>{transaction.txnDate}</TableCell>\n                          <TableCell>\n                            <Badge\n                              variant=\"outline\"\n                              className=\"font-mono text-xs\"\n                            >\n                              {transaction.txnNo}\n                            </Badge>\n                          </TableCell>\n                          <TableCell className=\"font-medium\">\n                            {transaction.particular}\n                          </TableCell>\n                          <TableCell>\n                            <Badge\n                              variant={\n                                transaction.txnType === \"Sales\"\n                                  ? \"default\"\n                                  : transaction.txnType === \"Purchase\"\n                                    ? \"secondary\"\n                                    : \"destructive\"\n                              }\n                            >\n                              {transaction.txnType}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>{transaction.parties}</TableCell>\n                          <TableCell>\n                            <Badge variant=\"outline\">\n                              {transaction.pmtMode}\n                            </Badge>\n                          </TableCell>\n                          <TableCell className=\"text-right font-medium\">\n                            <span\n                              className={\n                                transaction.category === \"Income\"\n                                  ? \"text-green-600\"\n                                  : \"text-red-600\"\n                              }\n                            >\n                              {formatCurrency(transaction.amount)}\n                            </span>\n                          </TableCell>\n                          <TableCell>\n                            <Badge\n                              variant={\n                                transaction.status === \"Paid\"\n                                  ? \"default\"\n                                  : \"secondary\"\n                              }\n                              className={\n                                transaction.status === \"Paid\"\n                                  ? \"bg-green-100 text-green-800\"\n                                  : \"bg-yellow-100 text-yellow-800\"\n                              }\n                            >\n                              {transaction.status}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center gap-1\">\n                              <div className=\"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center\">\n                                <span className=\"text-xs text-blue-600 font-medium\">\n                                  {transaction.entryBy.charAt(0).toUpperCase()}\n                                </span>\n                              </div>\n                              <span className=\"text-sm\">\n                                {transaction.entryBy}\n                              </span>\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <Button variant=\"ghost\" size=\"sm\">\n                              <Eye className=\"h-4 w-4\" />\n                            </Button>\n                          </TableCell>\n                        </TableRow>\n                      ))\n                    ) : (\n                      <TableRow>\n                        <TableCell colSpan={11} className=\"text-center py-8\">\n                          <Calendar className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                          <p>No transactions found matching your criteria</p>\n                        </TableCell>\n                      </TableRow>\n                    )}\n                  </TableBody>\n                </Table>\n              </div>\n\n              {/* Pagination Controls */}\n              {allTransactions.length > 0 && (\n                <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 mt-4\">\n                  <PaginationInfo\n                    currentPage={currentPage}\n                    totalPages={totalPages}\n                    totalItems={totalItems}\n                  />\n                  <div className=\"flex items-center gap-4\">\n                    <PageSizeSelector\n                      pageSize={pageSize}\n                      onPageSizeChange={setPageSize}\n                      options={[10, 15, 25, 50]}\n                    />\n                    <Pagination\n                      currentPage={currentPage}\n                      totalPages={totalPages}\n                      onPageChange={goToPage}\n                    />\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"supplier\" className=\"space-y-6\">\n          {/* Supplier Summary Cards */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm font-medium text-muted-foreground\">\n                  Total Suppliers\n                </div>\n                <div className=\"text-lg font-bold\">\n                  {filteredSupplierLedgers.length}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm font-medium text-muted-foreground\">\n                  Total Purchases\n                </div>\n                <div className=\"text-lg font-bold text-blue-600\">\n                  {formatCurrency(\n                    filteredSupplierLedgers.reduce(\n                      (sum, ledger) => sum + ledger.totalPurchases,\n                      0,\n                    ),\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm font-medium text-muted-foreground\">\n                  Total Outstanding\n                </div>\n                <div className=\"text-lg font-bold text-red-600\">\n                  {formatCurrency(\n                    filteredSupplierLedgers.reduce(\n                      (sum, ledger) => sum + Math.max(0, ledger.currentBalance),\n                      0,\n                    ),\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"text-sm font-medium text-muted-foreground\">\n                  Advance Paid\n                </div>\n                <div className=\"text-lg font-bold text-green-600\">\n                  {formatCurrency(\n                    Math.abs(\n                      filteredSupplierLedgers.reduce(\n                        (sum, ledger) =>\n                          sum + Math.min(0, ledger.currentBalance),\n                        0,\n                      ),\n                    ),\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Supplier Filters */}\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex flex-col sm:flex-row gap-4\">\n                <div className=\"flex-1\">\n                  <SearchBar\n                    placeholder=\"Search supplier ledgers...\"\n                    value={searchTerm}\n                    onChange={setSearchTerm}\n                    className=\"w-full\"\n                  />\n                </div>\n                <Select\n                  value={supplierFilter}\n                  onValueChange={setSupplierFilter}\n                >\n                  <SelectTrigger className=\"w-[200px]\">\n                    <SelectValue placeholder=\"All Suppliers\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Suppliers</SelectItem>\n                    {suppliers.map((supplier: any) => (\n                      <SelectItem\n                        key={supplier.id}\n                        value={supplier.id.toString()}\n                      >\n                        {supplier.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <Select\n                  value={supplierPaymentStatus}\n                  onValueChange={setSupplierPaymentStatus}\n                >\n                  <SelectTrigger className=\"w-[150px]\">\n                    <SelectValue placeholder=\"Payment Status\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Status</SelectItem>\n                    <SelectItem value=\"paid\">Paid</SelectItem>\n                    <SelectItem value=\"partial\">Partial</SelectItem>\n                    <SelectItem value=\"due\">Due</SelectItem>\n                  </SelectContent>\n                </Select>\n                <Select\n                  value={supplierDateRange}\n                  onValueChange={setSupplierDateRange}\n                >\n                  <SelectTrigger className=\"w-[150px]\">\n                    <SelectValue placeholder=\"Date Range\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"30\">Last 30 days</SelectItem>\n                    <SelectItem value=\"90\">Last 90 days</SelectItem>\n                    <SelectItem value=\"365\">Last year</SelectItem>\n                    <SelectItem value=\"all\">All time</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Supplier Ledger Table */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center justify-between\">\n                <span>Supplier Ledgers</span>\n                <Badge variant=\"secondary\">\n                  {filteredSupplierLedgers.length} suppliers\n                </Badge>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"overflow-x-auto\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Supplier Name</TableHead>\n                      <TableHead className=\"text-right\">\n                        Total Purchases\n                      </TableHead>\n                      <TableHead className=\"text-right\">Amount Paid</TableHead>\n                      <TableHead className=\"text-right\">Outstanding</TableHead>\n                      <TableHead className=\"text-right\">\n                        Current Balance\n                      </TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredSupplierLedgers.length > 0 ? (\n                      filteredSupplierLedgers.map((ledger) => (\n                        <TableRow key={ledger.supplierId}>\n                          <TableCell className=\"font-medium\">\n                            <div className=\"flex items-center gap-2\">\n                              <Users className=\"h-4 w-4 text-blue-500\" />\n                              {ledger.supplierName}\n                            </div>\n                          </TableCell>\n                          <TableCell className=\"text-right font-medium\">\n                            {formatCurrency(ledger.totalPurchases)}\n                          </TableCell>\n                          <TableCell className=\"text-right text-green-600\">\n                            {formatCurrency(ledger.totalPaid)}\n                          </TableCell>\n                          <TableCell className=\"text-right text-red-600\">\n                            {formatCurrency(ledger.totalOutstanding)}\n                          </TableCell>\n                          <TableCell className=\"text-right font-medium\">\n                            <span\n                              className={\n                                ledger.currentBalance > 0\n                                  ? \"text-red-600\"\n                                  : ledger.currentBalance < 0\n                                    ? \"text-blue-600\"\n                                    : \"text-green-600\"\n                              }\n                            >\n                              {formatCurrency(Math.abs(ledger.currentBalance))}\n                            </span>\n                          </TableCell>\n                          <TableCell>\n                            {getPaymentStatusBadge(\"\", ledger.currentBalance)}\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex gap-2\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => handleSupplierLedgerView(ledger)}\n                                title=\"View Ledger Details\"\n                              >\n                                <FileText className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => exportSupplierLedger(ledger)}\n                                title=\"Export Ledger\"\n                              >\n                                <Download className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))\n                    ) : (\n                      <TableRow>\n                        <TableCell colSpan={7} className=\"text-center py-8\">\n                          <div className=\"flex flex-col items-center text-muted-foreground\">\n                            <AlertCircle className=\"h-12 w-12 mb-4 opacity-50\" />\n                            <p>No supplier ledgers found</p>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    )}\n                  </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Supplier Ledger Detail Dialog */}\n      <Dialog open={supplierLedgerOpen} onOpenChange={setSupplierLedgerOpen}>\n        <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              {selectedSupplier?.supplierName} - Transaction Ledger\n            </DialogTitle>\n            <DialogDescription>\n              Complete transaction history and balance details\n            </DialogDescription>\n          </DialogHeader>\n\n          {selectedSupplier && (\n            <div className=\"space-y-6\">\n              {/* Supplier Summary */}\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"text-sm font-medium text-muted-foreground\">\n                      Total Purchases\n                    </div>\n                    <div className=\"text-lg font-bold text-blue-600\">\n                      {formatCurrency(selectedSupplier.totalPurchases)}\n                    </div>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"text-sm font-medium text-muted-foreground\">\n                      Amount Paid\n                    </div>\n                    <div className=\"text-lg font-bold text-green-600\">\n                      {formatCurrency(selectedSupplier.totalPaid)}\n                    </div>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"text-sm font-medium text-muted-foreground\">\n                      Outstanding\n                    </div>\n                    <div className=\"text-lg font-bold text-red-600\">\n                      {formatCurrency(selectedSupplier.totalOutstanding)}\n                    </div>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"text-sm font-medium text-muted-foreground\">\n                      Current Balance\n                    </div>\n                    <div\n                      className={`text-lg font-bold ${selectedSupplier.currentBalance > 0 ? \"text-red-600\" : selectedSupplier.currentBalance < 0 ? \"text-blue-600\" : \"text-green-600\"}`}\n                    >\n                      {formatCurrency(\n                        Math.abs(selectedSupplier.currentBalance),\n                      )}\n                      {selectedSupplier.currentBalance > 0 && \" (Due)\"}\n                      {selectedSupplier.currentBalance < 0 && \" (Advance)\"}\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Transaction History */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Transaction History</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Date</TableHead>\n                          <TableHead>Invoice #</TableHead>\n                          <TableHead>Items</TableHead>\n                          <TableHead className=\"text-right\">\n                            Total Amount\n                          </TableHead>\n                          <TableHead className=\"text-right\">\n                            Amount Paid\n                          </TableHead>\n                          <TableHead className=\"text-right\">\n                            Outstanding\n                          </TableHead>\n                          <TableHead className=\"text-right\">\n                            Running Balance\n                          </TableHead>\n                          <TableHead>Status</TableHead>\n                          <TableHead>Payment Method</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {selectedSupplier.transactions.map((transaction) => (\n                          <TableRow key={transaction.id}>\n                            <TableCell>\n                              {format(new Date(transaction.date), \"dd/MM/yyyy\")}\n                            </TableCell>\n                            <TableCell>\n                              <Badge\n                                variant=\"outline\"\n                                className=\"font-mono text-xs\"\n                              >\n                                {transaction.invoiceNumber ||\n                                  `PUR-${transaction.purchaseId}`}\n                              </Badge>\n                            </TableCell>\n                            <TableCell\n                              className=\"max-w-xs truncate\"\n                              title={transaction.items}\n                            >\n                              {transaction.items}\n                            </TableCell>\n                            <TableCell className=\"text-right font-medium\">\n                              {formatCurrency(transaction.totalAmount)}\n                            </TableCell>\n                            <TableCell className=\"text-right text-green-600\">\n                              {formatCurrency(transaction.amountPaid)}\n                            </TableCell>\n                            <TableCell className=\"text-right text-red-600\">\n                              {formatCurrency(transaction.outstanding)}\n                            </TableCell>\n                            <TableCell className=\"text-right font-medium\">\n                              <span\n                                className={\n                                  transaction.runningBalance > 0\n                                    ? \"text-red-600\"\n                                    : transaction.runningBalance < 0\n                                      ? \"text-blue-600\"\n                                      : \"text-green-600\"\n                                }\n                              >\n                                {formatCurrency(\n                                  Math.abs(transaction.runningBalance),\n                                )}\n                              </span>\n                            </TableCell>\n                            <TableCell>\n                              {getPaymentStatusBadge(\n                                transaction.paymentStatus,\n                                transaction.runningBalance,\n                              )}\n                            </TableCell>\n                            <TableCell>\n                              <Badge variant=\"outline\">\n                                {transaction.paymentMethod}\n                              </Badge>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":51719,"size_tokens":null},"client/src/components/protected-page.tsx":{"content":"\nimport { ReactNode, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useRoleAccess } from \"@/hooks/useRoleAccess\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Shield, AlertTriangle } from \"lucide-react\";\n\ninterface ProtectedPageProps {\n  children: ReactNode;\n  resource: string;\n  action?: 'read' | 'write' | 'read_write';\n  fallback?: ReactNode;\n}\n\nexport function ProtectedPage({ \n  children, \n  resource, \n  action = 'read', \n  fallback \n}: ProtectedPageProps) {\n  const [, setLocation] = useLocation();\n  const { canAccessPage, isSuperAdmin, canBypassAllRestrictions } = useRoleAccess();\n\n  // Super Admin bypasses ALL page restrictions immediately - no checks\n  if (isSuperAdmin() || canBypassAllRestrictions()) {\n    return <>{children}</>;\n  }\n\n  const hasAccess = canAccessPage(resource, action);\n\n  // Redirect to unauthorized page if no access\n  useEffect(() => {\n    if (!hasAccess) {\n      setLocation(\"/unauthorized\");\n    }\n  }, [hasAccess, resource, action, setLocation]);\n\n  if (!hasAccess) {\n    return fallback || (\n      <div className=\"flex items-center justify-center min-h-[400px] p-6\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center space-y-4\">\n              <div className=\"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center\">\n                <Shield className=\"h-8 w-8 text-red-600\" />\n              </div>\n              <div>\n                <h3 className=\"text-lg font-semibold text-gray-900\">Access Denied</h3>\n                <p className=\"text-gray-500 mt-2\">\n                  You don't have permission to access this page.\n                  Contact your administrator for access.\n                </p>\n              </div>\n              <div className=\"flex items-center justify-center text-sm text-amber-600 bg-amber-50 p-2 rounded-lg\">\n                <AlertTriangle className=\"h-4 w-4 mr-2\" />\n                Required: {action.replace('_', ' & ')} access to {resource.replace('_', ' ')}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return <>{children}</>;\n}\n","path":null,"size_bytes":2205,"size_tokens":null},"client/src/pages/landing.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { SystemPriceLarge, SystemPriceBadge } from \"@/components/dynamic-price-display\";\nimport {\n  Shield,\n  Package,\n  Users,\n  BarChart3,\n  Clock,\n  Zap,\n  Check,\n  Star,\n  Award,\n  Truck,\n  Coffee,\n} from \"lucide-react\";\n\nexport default function Landing() {\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-[#F5F5DC] to-[#D2B48C]\">\n      <Card className=\"w-full max-w-md mx-4 shadow-lg\">\n        <CardHeader className=\"text-center\">\n          <div className=\"w-16 h-16 bg-[#8B4513] rounded-lg flex items-center justify-center mx-auto mb-4\">\n            <i className=\"fas fa-bread-slice text-white text-2xl\"></i>\n          </div>\n          <CardTitle className=\"text-3xl font-bold text-[#8B4513]\">\n            Mero BakeSoft\n          </CardTitle>\n          <p className=\"text-[#8B4513]/80 mt-2\">\n            Professional Bakery Management System\n          </p>\n        </CardHeader>\n\n        <CardContent className=\"text-center space-y-6\">\n          <div className=\"space-y-2\">\n            <p className=\"text-gray-600\">\n              Streamline your bakery operations with our comprehensive management system\n            </p>\n            <ul className=\"text-sm text-gray-500 space-y-1\">\n              <li>‚Ä¢ Product & Inventory Management</li>\n              <li>‚Ä¢ Order Processing & Tracking</li>\n              <li>‚Ä¢ Production Scheduling</li>\n              <li>‚Ä¢ Sales Analytics & Reports</li>\n            </ul>\n          </div>\n\n          <Button \n            onClick={() => window.location.href = '/api/login'}\n            className=\"w-full bg-[#8B4513] hover:bg-[#A0522D] text-white\"\n            size=\"lg\"\n          >\n            <i className=\"fas fa-sign-in-alt mr-2\"></i>\n            Sign In to Continue\n          </Button>\n\n          <p className=\"text-xs text-gray-500\">\n            Secure authentication powered by Replit\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","path":null,"size_bytes":2091,"size_tokens":null},"server/localAuth.ts":{"content":"import passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./lib/storage\";\nimport bcrypt from \"bcrypt\";\nimport { db } from \"./db\";\nimport { loginLogs } from \"../shared/schema\";\n\n// Utility function to log login attempts\nasync function logLoginAttempt(userId: string, email: string, ipAddress: string, userAgent: string | undefined, status: 'success' | 'failed', location?: string) {\n  try {\n    const deviceType = userAgent ? detectDeviceType(userAgent) : 'Unknown';\n\n    await db.insert(loginLogs).values({\n      userId,\n      email,\n      ipAddress,\n      userAgent: userAgent || null,\n      status,\n      location: location || null,\n      deviceType,\n    });\n  } catch (error) {\n    console.error('Failed to log login attempt:', error);\n  }\n}\n\n// Simple device detection from user agent\nfunction detectDeviceType(userAgent: string): string {\n  if (userAgent.includes('Mobile')) return 'Mobile';\n  if (userAgent.includes('Tablet')) return 'Tablet';\n  if (userAgent.includes('Windows')) return 'Desktop - Windows';\n  if (userAgent.includes('Mac')) return 'Desktop - Mac';\n  if (userAgent.includes('Linux')) return 'Desktop - Linux';\n  return 'Unknown';\n}\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET || \"bakery-management-secret-key-2024\",\n    store: sessionStore,\n    resave: true,\n    saveUninitialized: false,\n    rolling: true,\n    cookie: {\n      httpOnly: true,\n      secure: false, // Set to false for development\n      maxAge: sessionTtl,\n      sameSite: 'lax'\n    },\n    name: 'bakery.sid'\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  try {\n    console.log(\"üîß Setting up authentication...\");\n\n    app.use(getSession());\n    app.use(passport.initialize());\n    app.use(passport.session());\n\n    // Configure local strategy\n    passport.use(new LocalStrategy({\n      usernameField: 'email',\n      passwordField: 'password',\n      passReqToCallback: true\n    }, async (req, email, password, done) => {\n      try {\n        const user = await storage.getUserByEmail(email);\n        if (!user) {\n          // Log failed login attempt\n          const clientIP = (Array.isArray(req.headers['x-forwarded-for']) \n                          ? req.headers['x-forwarded-for'][0] \n                          : req.headers['x-forwarded-for']?.split(',')[0]) ||\n                          req.headers['x-real-ip'] ||\n                          req.connection.remoteAddress ||\n                          req.socket.remoteAddress ||\n                          '127.0.0.1';\n          const userAgent = req.get('User-Agent') || '';\n          const location = clientIP === '127.0.0.1' || clientIP === '::1' ||\n                          clientIP.startsWith('192.168.') || clientIP.startsWith('10.') ||\n                          clientIP.startsWith('172.') ? 'Local Network' : 'External';\n\n          await logLoginAttempt('unknown', email, clientIP, userAgent, 'failed', location);\n\n          console.warn('üö® Failed Login Attempt:', {\n            email,\n            ip: clientIP,\n            userAgent: userAgent,\n            timestamp: new Date().toISOString(),\n          });\n\n          return done(null, false, { message: 'Invalid email or password' });\n        }\n\n        if (!user.password) {\n          // Log failed login attempt\n          const clientIP = (Array.isArray(req.headers['x-forwarded-for']) \n                          ? req.headers['x-forwarded-for'][0] \n                          : req.headers['x-forwarded-for']?.split(',')[0]) ||\n                          req.headers['x-real-ip'] ||\n                          req.connection.remoteAddress ||\n                          req.socket.remoteAddress ||\n                          '127.0.0.1';\n          const userAgent = req.get('User-Agent') || '';\n          const location = clientIP === '127.0.0.1' || clientIP === '::1' ||\n                          clientIP.startsWith('192.168.') || clientIP.startsWith('10.') ||\n                          clientIP.startsWith('172.') ? 'Local Network' : 'External';\n\n          await logLoginAttempt(user.id, email, clientIP, userAgent, 'failed', location);\n\n          console.warn('üö® Failed Login Attempt:', {\n            email,\n            ip: clientIP,\n            userAgent: userAgent,\n            timestamp: new Date().toISOString(),\n          });\n\n          return done(null, false, { message: 'Invalid email or password' });\n        }\n\n        const isValidPassword = await bcrypt.compare(password, user.password);\n        if (!isValidPassword) {\n          // Log failed login attempt\n          const clientIP = (Array.isArray(req.headers['x-forwarded-for']) \n                          ? req.headers['x-forwarded-for'][0] \n                          : req.headers['x-forwarded-for']?.split(',')[0]) ||\n                          req.headers['x-real-ip'] ||\n                          req.connection.remoteAddress ||\n                          req.socket.remoteAddress ||\n                          '127.0.0.1';\n          const userAgent = req.get('User-Agent') || '';\n          const location = clientIP === '127.0.0.1' || clientIP === '::1' ||\n                          clientIP.startsWith('192.168.') || clientIP.startsWith('10.') ||\n                          clientIP.startsWith('172.') ? 'Local Network' : 'External';\n\n          await logLoginAttempt(user.id, email, clientIP, userAgent, 'failed', location);\n\n          console.warn('üö® Failed Login Attempt:', {\n            email,\n            ip: clientIP,\n            userAgent: userAgent,\n            timestamp: new Date().toISOString(),\n          });\n\n          return done(null, false, { message: 'Invalid email or password' });\n        }\n\n        // Enhanced login logging with geolocation and device tracking\n        try {\n          const clientIP = (Array.isArray(req.headers['x-forwarded-for']) \n                          ? req.headers['x-forwarded-for'][0] \n                          : req.headers['x-forwarded-for']?.split(',')[0]) ||\n                          req.headers['x-real-ip'] ||\n                          req.connection.remoteAddress ||\n                          req.socket.remoteAddress ||\n                          '127.0.0.1';\n\n          // Enhanced device detection\n          const userAgent = req.get('User-Agent') || '';\n\n          // Basic geolocation (in production, use proper IP geolocation service)\n          const location = clientIP === '127.0.0.1' || clientIP === '::1' ||\n                          clientIP.startsWith('192.168.') || clientIP.startsWith('10.') ||\n                          clientIP.startsWith('172.') ? 'Local Network' : 'External';\n\n          await logLoginAttempt(user?.id || 'unknown', email, clientIP, userAgent, user ? 'success' : 'failed', location);\n\n          // Log security events for failed attempts\n          if (!user) {\n            console.warn('üö® Failed Login Attempt:', {\n              email,\n              ip: clientIP,\n              userAgent: userAgent,\n              timestamp: new Date().toISOString(),\n            });\n          }\n        } catch (logError) {\n          console.error('Failed to log login attempt:', logError);\n        }\n        return done(null, user);\n      } catch (error) {\n        console.error('‚ùå Login error:', error);\n        return done(error);\n      }\n    }));\n\n    // Serialize user for session\n    passport.serializeUser((user: any, done) => {\n      done(null, user.id);\n    });\n\n    // Deserialize user from session\n    passport.deserializeUser(async (id: string, done) => {\n      try {\n        const user = await storage.getUserById(id);\n        if (user) {\n          done(null, user);\n        } else {\n          done(null, false);\n        }\n      } catch (error) {\n        console.error('Deserialization error:', error);\n        done(error);\n      }\n    });\n\n    // Login route\n    app.post(\"/api/auth/login\", (req, res, next) => {\n        console.log('Login attempt for:', req.body.email);\n        \n        passport.authenticate('local', (err: any, user: any, info: any) => {\n          if (err) {\n            console.error('Authentication error:', err);\n            return res.status(500).json({ message: 'Authentication failed' });\n          }\n          \n          if (!user) {\n            console.log('Authentication failed:', info?.message);\n            return res.status(401).json({ message: info?.message || 'Invalid credentials' });\n          }\n\n          // Log the user in\n          req.logIn(user, (err) => {\n            if (err) {\n              console.error('Login error:', err);\n              return res.status(500).json({ message: 'Login failed' });\n            }\n\n            console.log('User logged in successfully:', user.email);\n            \n            // Set session data explicitly\n            (req.session as any).userId = user.id;\n            (req.session as any).user = user;\n            \n            // Save session and wait for it\n            req.session.save((err) => {\n              if (err) {\n                console.error('Session save error:', err);\n                return res.status(500).json({ message: 'Session creation failed' });\n              }\n              \n              console.log('Session saved successfully for user:', user.email);\n              console.log('Session ID:', req.sessionID);\n              \n              // Return user data (excluding password)\n              const { password: _, ...userWithoutPassword } = user;\n              res.json({ \n                success: true,\n                message: 'Login successful',\n                user: userWithoutPassword,\n                sessionId: req.sessionID\n              });\n            });\n          });\n        })(req, res, next);\n      });\n\n    // Logout route\n    app.post(\"/api/auth/logout\", async (req, res) => {\n        const user = req.user;\n        const clientIP = req.headers['x-forwarded-for']?.toString().split(',')[0] ||\n                        req.headers['x-real-ip']?.toString() ||\n                        req.connection.remoteAddress ||\n                        req.socket.remoteAddress ||\n                        '127.0.0.1';\n\n        try {\n          // Log logout before destroying session\n          if (user) {\n            await storage.logLogout((user as any).id, (user as any).email, `${(user as any).firstName || ''} ${(user as any).lastName || ''}`.trim(), clientIP);\n          }\n\n          req.logout((err) => {\n            if (err) {\n              console.error(\"Logout error:\", err);\n              return res.status(500).json({ message: \"Logout failed\" });\n            }\n            \n            req.session.destroy((err) => {\n              if (err) {\n                console.error(\"Session destroy error:\", err);\n                return res.status(500).json({ message: \"Logout failed\" });\n              }\n              \n              res.clearCookie('connect.sid');\n              res.json({ message: \"Logged out successfully\" });\n            });\n          });\n        } catch (error) {\n          console.error(\"Logout error:\", error);\n          res.status(500).json({ message: \"Logout failed\" });\n        }\n      });\n\n    // Add user authentication check endpoint\n    app.get(\"/api/auth/user\", (req, res) => {\n      if (req.isAuthenticated() && req.user) {\n        const { password: _, ...userWithoutPassword } = req.user as any;\n        res.json(userWithoutPassword);\n      } else {\n        res.status(401).json({ message: 'Not authenticated' });\n      }\n    });\n\n  } catch (error) {\n    console.error(\"‚ùå Authentication setup failed:\", error);\n    throw error;\n  }\n}\n\nexport const isAuthenticated: RequestHandler = (req, res, next) => {\n  if (req.isAuthenticated() && req.user) {\n    return next();\n  }\n  \n  res.status(401).json({ message: 'Authentication required' });\n};","path":null,"size_bytes":12175,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0, 0%, 100%);\n  --foreground: hsl(222.2, 84%, 4.9%);\n  --muted: hsl(210, 40%, 98%);\n  --muted-foreground: hsl(215.4, 16.3%, 46.9%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(222.2, 84%, 4.9%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(222.2, 84%, 4.9%);\n  --border: hsl(214.3, 31.8%, 91.4%);\n  --input: hsl(214.3, 31.8%, 91.4%);\n  --primary: hsl(221.2, 83.2%, 53.3%);\n  --primary-foreground: hsl(210, 40%, 98%);\n  --secondary: hsl(210, 40%, 96%);\n  --secondary-foreground: hsl(222.2, 84%, 4.9%);\n  --accent: hsl(210, 40%, 96%);\n  --accent-foreground: hsl(222.2, 84%, 4.9%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(210, 40%, 98%);\n  --ring: hsl(221.2, 83.2%, 53.3%);\n  --radius: 0.5rem;\n\n  /* Sidebar colors */\n  --sidebar-background: hsl(0, 0%, 98%);\n  --sidebar-foreground: hsl(240, 5.3%, 26.1%);\n  --sidebar-primary: hsl(240, 5.9%, 10%);\n  --sidebar-primary-foreground: hsl(0, 0%, 98%);\n  --sidebar-accent: hsl(240, 4.8%, 95.9%);\n  --sidebar-accent-foreground: hsl(240, 5.9%, 10%);\n  --sidebar-border: hsl(220, 13%, 91%);\n  --sidebar-ring: hsl(217.2, 91.2%, 59.8%);\n\n  /* Chart colors */\n  --chart-1: 12 74 110;\n  --chart-2: 173 109 244;\n  --chart-3: 22 163 74;\n  --chart-4: 249 115 22;\n  --chart-5: 239 68 68;\n}\n\n\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground text-sm;\n  }\n}\n\n/* Custom bakery-themed styles */\n.bakery-gradient {\n  background: linear-gradient(135deg, var(--bakery-cream) 0%, var(--bakery-tan) 100%);\n}\n\n.bakery-shadow {\n  box-shadow: 0 4px 6px -1px rgba(139, 69, 19, 0.1), 0 2px 4px -1px rgba(139, 69, 19, 0.06);\n}\n\n.nav-item.active {\n  background-color: var(--bakery-brown);\n  color: white;\n}\n\n.nav-item:hover {\n  background-color: rgba(139, 69, 19, 0.1);\n}\n\n/* Active Section Highlight */\n.collapsible-content-active {\n  border-color: red;\n  /* Highlight the active section */\n}\n\n/* New Badge */\n.new-badge {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  padding: 2px 6px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  color: #16a34a;\n  background-color: #ecfefe;\n  border-radius: 0.375rem;\n}\n\n/* Bullet Point */\n.bullet-point {\n  width: 2px;\n  height: 2px;\n  background-color: #ccc;\n  border-radius: 50%;\n  margin-right: 8px;\n}\n\n@layer base {\n  * {\n    @apply border-gray-200;\n  }\n\n  body {\n    font-family: \"Inter\", -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n    line-height: 1.6;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n    overflow-x: hidden;\n  }\n\n  /* Enhanced focus styles */\n  button:focus-visible {\n    outline: 2px solid hsl(var(--primary));\n    outline-offset: 2px;\n    border-radius: 8px;\n    transition: outline 0.2s ease;\n  }\n\n  input:focus,\n  textarea:focus,\n  select:focus {\n    outline: none;\n    box-shadow: 0 0 0 3px hsla(var(--primary), 0.1), 0 0 0 1px hsl(var(--primary));\n    transform: translateY(-1px);\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  /* Enhanced scrollbar */\n  ::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  ::-webkit-scrollbar-track {\n    background: rgba(241, 245, 249, 0.6);\n    /* Light gray background */\n    border-radius: 12px;\n    margin: 4px;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: linear-gradient(135deg, rgb(150, 150, 150, 0.4), rgb(150, 150, 150, 0.6));\n    /* Orange gradient */\n    border-radius: 12px;\n    border: 2px solid rgba(241, 245, 249, 0.8);\n    transition: background 0.3s ease;\n  }\n\n  ::-webkit-scrollbar-thumb:hover {\n    background: linear-gradient(135deg, rgb(150, 150, 150, 0.6), rgb(150, 150, 150, 0.8));\n    /* Darker on hover */\n  }\n\n\n  /* Enhanced loading animations */\n  @keyframes pulse-subtle {\n\n    0%,\n    100% {\n      opacity: 1;\n      transform: scale(1);\n    }\n\n    50% {\n      opacity: 0.8;\n      transform: scale(1.02);\n    }\n  }\n\n  @keyframes bounce-gentle {\n\n    0%,\n    100% {\n      transform: translateY(0);\n    }\n\n    50% {\n      transform: translateY(-4px);\n    }\n  }\n\n  @keyframes fade-in-up {\n    0% {\n      opacity: 0;\n      transform: translateY(20px);\n    }\n\n    100% {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  @keyframes slide-in-right {\n    0% {\n      opacity: 0;\n      transform: translateX(30px);\n    }\n\n    100% {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n\n  @keyframes scale-in {\n    0% {\n      opacity: 0;\n      transform: scale(0.95);\n    }\n\n    100% {\n      opacity: 1;\n      transform: scale(1);\n    }\n  }\n\n  .animate-pulse-subtle {\n    animation: pulse-subtle 2s ease-in-out infinite;\n  }\n\n  .animate-bounce-gentle {\n    animation: bounce-gentle 2s ease-in-out infinite;\n  }\n\n  .animate-fade-in-up {\n    animation: fade-in-up 0.6s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .animate-slide-in-right {\n    animation: slide-in-right 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .animate-scale-in {\n    animation: scale-in 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  /* Gradient text animation */\n  @keyframes gradient-shift {\n    0% {\n      background-position: 0% 50%;\n    }\n\n    50% {\n      background-position: 100% 50%;\n    }\n\n    100% {\n      background-position: 0% 50%;\n    }\n  }\n\n  .gradient-text {\n    background: linear-gradient(-45deg, hsl(var(--primary)), #8b5cf6, #06b6d4, #10b981);\n    background-size: 400% 400%;\n    animation: gradient-shift 4s ease infinite;\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n  }\n\n  /* Enhanced card hover effects */\n  .card-hover {\n    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n    will-change: transform, box-shadow;\n  }\n\n  .card-hover:hover {\n    transform: translateY(-6px) scale(1.02);\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.12),\n      0 0 0 1px rgba(255, 255, 255, 0.05),\n      0 8px 16px -4px rgba(0, 0, 0, 0.1);\n  }\n\n  /* Enhanced button effects */\n  .btn-ripple {\n    position: relative;\n    overflow: hidden;\n    transform-style: preserve-3d;\n  }\n\n  .btn-ripple::before {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 0;\n    height: 0;\n    border-radius: 50%;\n    background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, transparent 70%);\n    transform: translate(-50%, -50%);\n    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1), height 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n    pointer-events: none;\n  }\n\n  .btn-ripple:active::before {\n    width: 300px;\n    height: 300px;\n  }\n\n  /* Enhanced dropdown animations */\n  .dropdown-content {\n    animation-duration: 0.3s;\n    animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);\n    animation-fill-mode: both;\n  }\n\n  .dropdown-enter {\n    animation-name: dropdown-enter;\n  }\n\n  .dropdown-exit {\n    animation-name: dropdown-exit;\n  }\n\n  @keyframes dropdown-enter {\n    from {\n      opacity: 0;\n      transform: scale(0.95) translateY(-8px);\n    }\n\n    to {\n      opacity: 1;\n      transform: scale(1) translateY(0);\n    }\n  }\n\n  @keyframes dropdown-exit {\n    from {\n      opacity: 1;\n      transform: scale(1) translateY(0);\n    }\n\n    to {\n      opacity: 0;\n      transform: scale(0.95) translateY(-8px);\n    }\n  }\n\n  /* Dropdown item animations */\n  .dropdown-item {\n    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n    position: relative;\n    overflow: hidden;\n  }\n\n  .dropdown-item::before {\n    content: '';\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    width: 0;\n    background: linear-gradient(90deg, hsl(var(--primary) / 0.1) 0%, hsl(var(--primary) / 0.05) 100%);\n    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: -1;\n  }\n\n  .dropdown-item:hover::before {\n    width: 100%;\n  }\n\n  .dropdown-item:hover {\n    transform: translateX(4px);\n    background: linear-gradient(90deg, hsl(var(--primary) / 0.08) 0%, hsl(var(--primary) / 0.03) 100%);\n  }\n\n  /* Sidebar specific animations */\n  .sidebar-item {\n    position: relative;\n    overflow: hidden;\n  }\n\n  .sidebar-item::before {\n    content: '';\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    width: 3px;\n    background: hsl(var(--primary));\n    transform: scaleY(0);\n    transform-origin: bottom;\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .sidebar-item.active::before,\n  .sidebar-item:hover::before {\n    transform: scaleY(1);\n  }\n\n  /* Floating elements animation */\n  @keyframes float {\n\n    0%,\n    100% {\n      transform: translateY(0px);\n    }\n\n    50% {\n      transform: translateY(-10px);\n    }\n  }\n\n  .animate-float {\n    animation: float 3s ease-in-out infinite;\n  }\n\n  /* Page transition effects */\n  .page-transition-enter {\n    opacity: 0;\n    transform: translateX(20px);\n  }\n\n  .page-transition-enter-active {\n    opacity: 1;\n    transform: translateX(0);\n    transition: opacity 0.3s ease, transform 0.3s ease;\n  }\n\n  .page-transition-exit {\n    opacity: 1;\n    transform: translateX(0);\n  }\n\n  .page-transition-exit-active {\n    opacity: 0;\n    transform: translateX(-20px);\n    transition: opacity 0.3s ease, transform 0.3s ease;\n  }\n\n  /* Print styles */\n  @media print {\n    .no-print {\n      display: none !important;\n    }\n\n    body {\n      background: white !important;\n    }\n\n    .card-hover {\n      box-shadow: none !important;\n      transform: none !important;\n    }\n\n    * {\n      transition: none !important;\n      animation: none !important;\n    }\n  }\n\n  /* Smooth scrolling for main content */\n  .main-content {\n    scroll-behavior: smooth;\n  }\n\n  /* Custom scrollbar for main content */\n  .main-content::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  .main-content::-webkit-scrollbar-track {\n    background: transparent;\n  }\n\n  .main-content::-webkit-scrollbar-thumb {\n    background: rgba(0, 0, 0, 0.1);\n    border-radius: 3px;\n  }\n\n  .main-content::-webkit-scrollbar-thumb:hover {\n    background: rgba(0, 0, 0, 0.2);\n  }\n\n  /* Smooth transitions for interactive elements */\n  button,\n  a,\n  input,\n  textarea,\n  select {\n    transition: all 0.2s ease-in-out;\n  }\n\n  /* Enhanced button hover effects */\n  button:hover {\n    transform: translateY(-1px);\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n  }\n\n  button:active {\n    transform: translateY(0);\n  }\n\n  /* Mobile optimizations */\n  @media (max-width: 768px) {\n    .card-hover:hover {\n      transform: translateY(-2px) scale(1.01);\n    }\n\n    input:focus,\n    textarea:focus,\n    select:focus {\n      transform: none;\n    }\n\n    .animate-float {\n      animation: none;\n    }\n\n    /* Reduce button hover effects on mobile */\n    button:hover {\n      transform: none;\n      box-shadow: none;\n    }\n  }\n\n  /* Reduced motion preferences */\n  @media (prefers-reduced-motion: reduce) {\n    * {\n      animation-duration: 0.01ms !important;\n      animation-iteration-count: 1 !important;\n      transition-duration: 0.01ms !important;\n    }\n\n    .card-hover:hover {\n      transform: none;\n    }\n  }\n}\n\n.invoice-item-row {\n  transition: background-color 0.2s ease;\n}\n.invoice-item-row:hover {\n  background-color: #f9fafb;\n}","path":null,"size_bytes":11167,"size_tokens":null},"client/src/components/pricing-settings.tsx":{"content":"\nimport React, { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Banknote, Settings, Eye, Save, RefreshCw } from \"lucide-react\";\n\nexport function PricingSettings() {\n  const { toast } = useToast();\n  const [isEditing, setIsEditing] = useState(false);\n\n  // Fetch current pricing settings\n  const { data: pricingSettings, isLoading, refetch } = useQuery({\n    queryKey: [\"/api/pricing\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/pricing\");\n      if (!response.ok) throw new Error(\"Failed to fetch pricing\");\n      return response.json();\n    },\n  });\n\n  // Update pricing mutation\n  const updatePricingMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await fetch(\"/api/pricing\", {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to update pricing\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/pricing\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/system-price\"] });\n      toast({\n        title: \"Success\",\n        description: \"Pricing settings updated successfully\",\n      });\n      setIsEditing(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update pricing settings\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSave = async (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    const formData = new FormData(event.target as HTMLFormElement);\n    \n    const data = {\n      systemPrice: parseFloat(formData.get(\"systemPrice\") as string),\n      currency: formData.get(\"currency\") as string,\n      description: formData.get(\"description\") as string,\n      displayEnabled: formData.get(\"displayEnabled\") === \"on\",\n    };\n\n    // Validate price\n    if (isNaN(data.systemPrice) || data.systemPrice <= 0) {\n      toast({\n        title: \"Invalid Price\",\n        description: \"Please enter a valid price greater than 0\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    updatePricingMutation.mutate(data);\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-center\">\n            <RefreshCw className=\"h-6 w-6 animate-spin mr-2\" />\n            Loading pricing settings...\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const settings = pricingSettings || {\n    systemPrice: 299.99,\n    currency: \"USD\",\n    description: \"Complete Bakery Management System\",\n    displayEnabled: true,\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Banknote className=\"h-5 w-5\" />\n          System Pricing Settings\n        </CardTitle>\n        <CardDescription>\n          Configure the pricing for your bakery management system\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        {!isEditing ? (\n          <div className=\"space-y-4\">\n            {/* Current Settings Display */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium text-gray-500\">\n                  System Price\n                </Label>\n                <div className=\"flex items-center gap-2\">\n                  <Badge variant=\"outline\" className=\"text-lg font-bold\">\n                    {settings.currency} {settings.systemPrice.toFixed(2)}\n                  </Badge>\n                  {settings.displayEnabled && (\n                    <Badge variant=\"secondary\">\n                      <Eye className=\"h-3 w-3 mr-1\" />\n                      Visible\n                    </Badge>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium text-gray-500\">\n                  Currency\n                </Label>\n                <div className=\"text-sm\">{settings.currency}</div>\n              </div>\n\n              <div className=\"space-y-2 md:col-span-2\">\n                <Label className=\"text-sm font-medium text-gray-500\">\n                  Description\n                </Label>\n                <div className=\"text-sm\">{settings.description}</div>\n              </div>\n            </div>\n\n            <Separator />\n\n            <div className=\"flex justify-between items-center\">\n              <div>\n                <p className=\"text-sm text-gray-600\">\n                  This price will be displayed across all system components\n                </p>\n              </div>\n              <Button onClick={() => setIsEditing(true)}>\n                <Settings className=\"h-4 w-4 mr-2\" />\n                Edit Pricing\n              </Button>\n            </div>\n          </div>\n        ) : (\n          <form onSubmit={handleSave} className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"systemPrice\">System Price *</Label>\n                <Input\n                  id=\"systemPrice\"\n                  name=\"systemPrice\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0\"\n                  defaultValue={settings.systemPrice}\n                  required\n                  placeholder=\"299.99\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"currency\">Currency</Label>\n                <Select name=\"currency\" defaultValue={settings.currency}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"USD\">USD ($)</SelectItem>\n                    <SelectItem value=\"EUR\">EUR (‚Ç¨)</SelectItem>\n                    <SelectItem value=\"GBP\">GBP (¬£)</SelectItem>\n                    <SelectItem value=\"NPR\">NPR (‚Ç®)</SelectItem>\n                    <SelectItem value=\"INR\">INR (‚Çπ)</SelectItem>\n                    <SelectItem value=\"AUD\">AUD (A$)</SelectItem>\n                    <SelectItem value=\"CAD\">CAD (C$)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2 md:col-span-2\">\n                <Label htmlFor=\"description\">Description</Label>\n                <Textarea\n                  id=\"description\"\n                  name=\"description\"\n                  defaultValue={settings.description}\n                  placeholder=\"Complete Bakery Management System\"\n                  rows={2}\n                />\n              </div>\n\n              <div className=\"space-y-2 md:col-span-2\">\n                <div className=\"flex items-center space-x-2\">\n                  <Switch\n                    id=\"displayEnabled\"\n                    name=\"displayEnabled\"\n                    defaultChecked={settings.displayEnabled}\n                  />\n                  <Label htmlFor=\"displayEnabled\">\n                    Display pricing across the system\n                  </Label>\n                </div>\n                <p className=\"text-xs text-gray-500\">\n                  When enabled, the system price will be visible in components and pages\n                </p>\n              </div>\n            </div>\n\n            <Separator />\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setIsEditing(false)}\n                disabled={updatePricingMutation.isPending}\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={updatePricingMutation.isPending}\n              >\n                {updatePricingMutation.isPending ? (\n                  <>\n                    <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\n                    Saving...\n                  </>\n                ) : (\n                  <>\n                    <Save className=\"h-4 w-4 mr-2\" />\n                    Save Pricing\n                  </>\n                )}\n              </Button>\n            </div>\n          </form>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":9270,"size_tokens":null},"client/src/public/sw.js":{"content":"// Service Worker for Push Notifications\n// Cache disabled - no caching will be performed\nconst CACHE_NAME = null;\n\n// Install event\nself.addEventListener('install', (event) => {\n  console.log('Service Worker installed - caching disabled');\n  self.skipWaiting();\n});\n\n// Activate event - clear any existing caches\nself.addEventListener('activate', (event) => {\n  console.log('Service Worker activated - clearing all caches');\n  event.waitUntil(\n    caches.keys().then((cacheNames) => {\n      return Promise.all(\n        cacheNames.map((cacheName) => {\n          return caches.delete(cacheName);\n        })\n      );\n    }).then(() => self.clients.claim())\n  );\n});\n\n// Push event\nself.addEventListener('push', (event) => {\n  console.log('Push received:', event);\n  \n  if (!event.data) {\n    console.log('No push data');\n    return;\n  }\n\n  const data = event.data.json();\n  const options = {\n    body: data.body,\n    icon: '/favicon.ico',\n    badge: '/favicon.ico',\n    vibrate: [100, 50, 100],\n    data: {\n      dateOfArrival: Date.now(),\n      primaryKey: data.id || 1,\n      url: data.url || '/'\n    },\n    actions: [\n      {\n        action: 'view',\n        title: 'View',\n        icon: '/favicon.ico'\n      },\n      {\n        action: 'close',\n        title: 'Close',\n        icon: '/favicon.ico'\n      }\n    ]\n  };\n\n  event.waitUntil(\n    self.registration.showNotification(data.title, options)\n  );\n});\n\n// Notification click event\nself.addEventListener('notificationclick', (event) => {\n  console.log('Notification clicked:', event);\n  event.notification.close();\n\n  if (event.action === 'close') {\n    return;\n  }\n\n  const url = event.notification.data.url || '/';\n  \n  event.waitUntil(\n    self.clients.matchAll({\n      type: 'window',\n      includeUncontrolled: true\n    }).then((clients) => {\n      // Check if there's already a window/tab open with the target URL\n      for (const client of clients) {\n        if (client.url === url && 'focus' in client) {\n          return client.focus();\n        }\n      }\n      \n      // If not, open a new window/tab\n      if (self.clients.openWindow) {\n        return self.clients.openWindow(url);\n      }\n    })\n  );\n});","path":null,"size_bytes":2168,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2263,"size_tokens":null},"client/src/pages/assets.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport SearchBar from \"@/components/search-bar\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Plus, Search, Edit, Trash2, Package } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\n\nexport default function Assets() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [categoryFilter, setCategoryFilter] = useState(\"all\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingAsset, setEditingAsset] = useState<any>(null);\n\n  // Form state\n  const [formData, setFormData] = useState({\n    name: \"\",\n    category: \"\",\n    description: \"\",\n    location: \"\",\n    condition: \"good\",\n    purchaseDate: \"\",\n    purchasePrice: \"\",\n    currentValue: \"\",\n  });\n\n  const { toast } = useToast();\n\n  const {\n    data: assets = [],\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: [\"/api/assets\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: any) => apiRequest(\"POST\", \"/api/assets\", data),\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/assets\"] });\n      resetForm();\n      setIsDialogOpen(false);\n      toast({ title: \"Success\", description: `Asset \"${data.name}\" created successfully` });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to create asset\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) =>\n      apiRequest(\"PUT\", `/api/assets/${id}`, data),\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/assets\"] });\n      resetForm();\n      setIsDialogOpen(false);\n      toast({ title: \"Success\", description: `Asset \"${data.name}\" updated successfully` });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to update asset\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/assets/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/assets\"] });\n      toast({ title: \"Success\", description: \"Asset deleted successfully\" });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete asset\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      name: \"\",\n      category: \"\",\n      description: \"\",\n      location: \"\",\n      condition: \"good\",\n      purchaseDate: \"\",\n      purchasePrice: \"\",\n      currentValue: \"\",\n    });\n    setEditingAsset(null);\n  };\n\n  const handleInputChange = (field: string, value: string) => {\n    setFormData((prev) => ({ ...prev, [field]: value }));\n  };\n\n  const handleSave = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!formData.name.trim()) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Asset name is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!formData.category) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Category is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const data = {\n      name: formData.name.trim(),\n      category: formData.category,\n      description: formData.description.trim() || null,\n      location: formData.location.trim() || null,\n      condition: formData.condition || \"good\",\n      purchaseDate: formData.purchaseDate || null,\n      purchasePrice: formData.purchasePrice || null,\n      currentValue: formData.currentValue || null,\n    };\n\n    if (editingAsset) {\n      updateMutation.mutate({ id: editingAsset.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const handleEdit = (asset: any) => {\n    setEditingAsset(asset);\n    setFormData({\n      name: asset.name || \"\",\n      category: asset.category || \"\",\n      description: asset.description || \"\",\n      location: asset.location || \"\",\n      condition: asset.condition || \"good\",\n      purchaseDate: asset.purchaseDate\n        ? new Date(asset.purchaseDate).toISOString().split(\"T\")[0]\n        : \"\",\n      purchasePrice: asset.purchasePrice ? asset.purchasePrice.toString() : \"\",\n      currentValue: asset.currentValue ? asset.currentValue.toString() : \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleAddNew = () => {\n    resetForm();\n    setIsDialogOpen(true);\n  };\n\n  const categories = [\n    \"equipment\",\n    \"furniture\",\n    \"vehicle\",\n    \"computer\",\n    \"tools\",\n    \"other\",\n  ];\n  const conditions = [\"excellent\", \"good\", \"fair\", \"poor\"];\n\n  const filteredAssets = (assets as any[]).filter((asset: any) => {\n    const matchesSearch =\n      asset.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      asset.description?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      asset.location?.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesCategory =\n      categoryFilter === \"all\" || asset.category === categoryFilter;\n    return matchesSearch && matchesCategory;\n  });\n\n  // Add sorting functionality\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredAssets,\n    \"name\",\n  );\n\n  const getConditionBadge = (condition: string) => {\n    const variants: Record<\n      string,\n      \"default\" | \"secondary\" | \"destructive\" | \"outline\"\n    > = {\n      excellent: \"default\",\n      good: \"secondary\",\n      fair: \"outline\",\n      poor: \"destructive\",\n    };\n    return variants[condition] || \"outline\";\n  };\n\n  if (error) {\n    if (isUnauthorizedError(error)) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return null;\n    }\n    console.error(\"Error loading assets:\", error);\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6 space-y-6\">\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <p className=\"text-gray-600\">Track and manage your business assets</p>\n        </div>\n        <Dialog\n          open={isDialogOpen}\n          onOpenChange={(open) => {\n            setIsDialogOpen(open);\n            if (!open) {\n              resetForm();\n            }\n          }}\n        >\n          <DialogTrigger asChild>\n            <Button onClick={handleAddNew} className=\"w-full sm:w-auto\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Asset\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl mx-auto max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Package className=\"h-5 w-5\" />\n                {editingAsset ? \"Edit Asset\" : \"Add New Asset\"}\n              </DialogTitle>\n              <DialogDescription>\n                {editingAsset\n                  ? \"Update asset information\"\n                  : \"Create a new asset record with detailed information\"}\n              </DialogDescription>\n            </DialogHeader>\n            <form onSubmit={handleSave} className=\"space-y-6\">\n              {/* Basic Information */}\n              <div className=\"space-y-4\">\n                <h3 className=\"text-lg font-medium\">Basic Information</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"asset-name\">Asset Name *</Label>\n                    <Input\n                      id=\"asset-name\"\n                      placeholder=\"e.g. Office Laptop, Kitchen Mixer\"\n                      value={formData.name}\n                      onChange={(e) =>\n                        handleInputChange(\"name\", e.target.value)\n                      }\n                      required\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"asset-category\">Category *</Label>\n                    <Select\n                      value={formData.category}\n                      onValueChange={(value) =>\n                        handleInputChange(\"category\", value)\n                      }\n                    >\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select Category\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {categories.map((category) => (\n                          <SelectItem key={category} value={category}>\n                            {category.charAt(0).toUpperCase() +\n                              category.slice(1)}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"asset-location\">Location</Label>\n                    <Input\n                      id=\"asset-location\"\n                      placeholder=\"e.g. Main Office, Kitchen\"\n                      value={formData.location}\n                      onChange={(e) =>\n                        handleInputChange(\"location\", e.target.value)\n                      }\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"asset-condition\">Condition</Label>\n                    <Select\n                      value={formData.condition}\n                      onValueChange={(value) =>\n                        handleInputChange(\"condition\", value)\n                      }\n                    >\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select Condition\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {conditions.map((condition) => (\n                          <SelectItem key={condition} value={condition}>\n                            {condition.charAt(0).toUpperCase() +\n                              condition.slice(1)}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n\n              {/* Financial Information */}\n              <div className=\"space-y-4\">\n                <h3 className=\"text-lg font-medium\">Financial Information</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div>\n                    <Label htmlFor=\"purchase-date\">Purchase Date</Label>\n                    <Input\n                      id=\"purchase-date\"\n                      type=\"date\"\n                      value={formData.purchaseDate}\n                      onChange={(e) =>\n                        handleInputChange(\"purchaseDate\", e.target.value)\n                      }\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"purchase-price\">Purchase Price (Rs.)</Label>\n                    <Input\n                      id=\"purchase-price\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      placeholder=\"0.00\"\n                      value={formData.purchasePrice}\n                      onChange={(e) =>\n                        handleInputChange(\"purchasePrice\", e.target.value)\n                      }\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"current-value\">Current Value (Rs.)</Label>\n                    <Input\n                      id=\"current-value\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      placeholder=\"0.00\"\n                      value={formData.currentValue}\n                      onChange={(e) =>\n                        handleInputChange(\"currentValue\", e.target.value)\n                      }\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Description */}\n              <div className=\"space-y-4\">\n                <div>\n                  <Label htmlFor=\"asset-description\">Description</Label>\n                  <Textarea\n                    id=\"asset-description\"\n                    placeholder=\"Additional notes about the asset...\"\n                    value={formData.description}\n                    onChange={(e) =>\n                      handleInputChange(\"description\", e.target.value)\n                    }\n                    rows={3}\n                  />\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                  className=\"w-full sm:w-auto\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={\n                    createMutation.isPending || updateMutation.isPending\n                  }\n                  className=\"w-full sm:w-auto\"\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? editingAsset\n                      ? \"Updating...\"\n                      : \"Creating...\"\n                    : editingAsset\n                      ? \"Update Asset\"\n                      : \"Create Asset\"}\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n            <div className=\"flex flex-col sm:flex-row gap-2 w-full sm:w-auto\">\n              <div className=\"w-full sm:w-64\">\n                <SearchBar\n                  placeholder=\"Search assets...\"\n                  value={searchQuery}\n                  onChange={setSearchQuery}\n                  className=\"w-full\"\n                />\n              </div>\n              <Select value={categoryFilter} onValueChange={setCategoryFilter}>\n                <SelectTrigger className=\"w-full sm:w-48\">\n                  <SelectValue placeholder=\"All Categories\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Categories</SelectItem>\n                  {categories.map((category) => (\n                    <SelectItem key={category} value={category}>\n                      {category.charAt(0).toUpperCase() + category.slice(1)}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableTableHeader\n                      sortKey=\"name\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Asset\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"category\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                      className=\"hidden sm:table-cell\"\n                    >\n                      Category\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"location\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                      className=\"hidden md:table-cell\"\n                    >\n                      Location\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"condition\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                    >\n                      Condition\n                    </SortableTableHeader>\n                    <SortableTableHeader\n                      sortKey=\"currentValue\"\n                      sortConfig={sortConfig}\n                      onSort={requestSort}\n                      className=\"hidden lg:table-cell\"\n                    >\n                      Value\n                    </SortableTableHeader>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {sortedData.map((asset: any) => (\n                    <TableRow key={asset.id}>\n                      <TableCell>\n                        <div className=\"flex items-center space-x-3\">\n                          <div className=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center\">\n                            <Package className=\"h-4 w-4 text-primary\" />\n                          </div>\n                          <div>\n                            <div className=\"font-medium\">{asset.name}</div>\n                            <div className=\"text-sm text-muted-foreground sm:hidden\">\n                              {asset.category}\n                            </div>\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"hidden sm:table-cell\">\n                        <Badge variant=\"outline\">\n                          {asset.category?.charAt(0).toUpperCase() +\n                            asset.category?.slice(1)}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"hidden md:table-cell\">\n                        {asset.location || \"N/A\"}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={getConditionBadge(asset.condition)}>\n                          {asset.condition?.charAt(0).toUpperCase() +\n                            asset.condition?.slice(1)}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"hidden lg:table-cell\">\n                        <div className=\"text-sm\">\n                          {asset.currentValue && (\n                            <div className=\"font-medium\">\n                              ${parseFloat(asset.currentValue).toFixed(2)}\n                            </div>\n                          )}\n                          {asset.purchasePrice && (\n                            <div className=\"text-muted-foreground\">\n                              Purchased: $\n                              {parseFloat(asset.purchasePrice).toFixed(2)}\n                            </div>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex space-x-1\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(asset)}\n                            className=\"text-blue-600 hover:text-blue-800 focus:outline-none\"\n                            title=\"Edit\"\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <DeleteConfirmationDialog\n                            trigger={\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"text-red-600 hover:text-red-800 focus:outline-none\"\n                                title=\"Delete\"\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            }\n                            title=\"Delete Asset\"\n                            itemName={asset.name}\n                            onConfirm={() => deleteMutation.mutate(asset.id)}\n                            isLoading={deleteMutation.isPending}\n                          />\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              {filteredAssets.length === 0 && (\n                <div className=\"text-center py-8\">\n                  <Package className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold text-muted-foreground mb-2\">\n                    No assets found\n                  </h3>\n                  <p className=\"text-muted-foreground mb-4\">\n                    {searchQuery || categoryFilter !== \"all\"\n                      ? \"Try adjusting your search criteria\"\n                      : \"Start by adding your first asset\"}\n                  </p>\n                </div>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":23570,"size_tokens":null},"client/src/pages/database.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Database, Table, Activity, HardDrive } from \"lucide-react\";\nimport { ProtectedRoute } from \"@/components/protected-route\";\n\nexport default function DatabaseManager() {\n  return (\n    <ProtectedRoute resource=\"database\" action=\"read_write\">\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div>\n            <p className=\"text-muted-foreground\">\n              Monitor and manage database operations\n            </p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Table className=\"h-5 w-5\" />\n                Tables\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">25</div>\n              <p className=\"text-sm text-muted-foreground\">Total tables</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Activity className=\"h-5 w-5\" />\n                Connections\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">5</div>\n              <p className=\"text-sm text-muted-foreground\">\n                Active connections\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <HardDrive className=\"h-5 w-5\" />\n                Storage\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">2.4GB</div>\n              <p className=\"text-sm text-muted-foreground\">Database size</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Query Performance</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">98%</div>\n              <p className=\"text-sm text-muted-foreground\">Avg performance</p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </ProtectedRoute>\n  );\n}\n","path":null,"size_bytes":2409,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import EnhancedDashboard from \"@/components/enhanced-dashboard\";\n\nexport default function Dashboard() {\n  return <EnhancedDashboard />;\n}\n","path":null,"size_bytes":138,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"server/index.ts":{"content":"import express from \"express\";\nimport fileUpload from \"express-fileupload\";\nimport { createServer } from \"http\";\nimport { setupVite, serveStatic } from \"./vite\";\nimport { setupAuth } from \"./localAuth\";\nimport { initializeDatabase } from \"./init-db\";\nimport router from \"./routes\";\nimport { initializeUnits } from \"./init-units\";\nimport { securityMonitor } from \"./securityMonitor\";\nimport { alertService } from \"./alertService\";\nimport path from \"path\";\nimport { storage } from \"./lib/storage\";\nimport fs from \"fs\";\nimport { logger } from \"./lib/logger\";\nimport { requestLogger, errorLogger } from \"./middleware/requestLogger\";\n\nconst app = express();\n\n// Trust proxy for production\napp.set(\"trust proxy\", 1);\n\n// Parse JSON bodies\napp.use(express.json({ limit: \"10mb\" }));\napp.use(express.urlencoded({ extended: true, limit: \"10mb\" }));\n\n// Request logging middleware - log all incoming requests\napp.use(requestLogger);\n\n// File upload middleware\napp.use(\n  fileUpload({\n    limits: { fileSize: 5 * 1024 * 1024 }, // 5MB limit\n    useTempFiles: true,\n    tempFileDir: \"/tmp/\",\n    createParentPath: true,\n  }),\n);\n\nasync function startServer() {\n  try {\n    // Setup authentication first\n    await setupAuth(app);\n\n    // API Routes - ensure all API routes are properly mounted\n    app.use(\"/api\", router);\n\n    // Handle static file serving for uploads\n    app.use(\n      \"/uploads\",\n      express.static(path.join(process.cwd(), \"public\", \"uploads\")),\n    );\n\n    // Serve Service Worker with correct MIME type\n    app.get(\"/sw.js\", (req, res) => {\n      const swPath = path.join(process.cwd(), \"public\", \"sw.js\");\n      if (fs.existsSync(swPath)) {\n        res.setHeader(\"Content-Type\", \"application/javascript\");\n        res.setHeader(\"Service-Worker-Allowed\", \"/\");\n        res.sendFile(swPath);\n      } else {\n        res.status(404).send(\"Service Worker not found\");\n      }\n    });\n\n    // Serve manifest.json with correct MIME type\n    app.get(\"/manifest.json\", (req, res) => {\n      const manifestPath = path.join(process.cwd(), \"public\", \"manifest.json\");\n      if (fs.existsSync(manifestPath)) {\n        res.setHeader(\"Content-Type\", \"application/json\");\n        res.sendFile(manifestPath);\n      } else {\n        res.status(404).send(\"Manifest not found\");\n      }\n    });\n\n    // Serve favicon with correct MIME type\n    app.get(\"/favicon-icon.png\", (req, res) => {\n      const faviconPath = path.join(\n        process.cwd(),\n        \"public\",\n        \"favicon-icon.png\",\n      );\n      if (fs.existsSync(faviconPath)) {\n        res.setHeader(\"Content-Type\", \"image/jpeg\");\n        res.sendFile(faviconPath);\n      } else {\n        res.status(404).send(\"Favicon not found\");\n      }\n    });\n\n    // Error logging middleware\n    app.use(errorLogger);\n\n    // Global error handler for express\n    app.use((error: any, req: any, res: any, next: any) => {\n      logger.error(\"Express Error\", error, {\n        module: 'EXPRESS',\n        details: {\n          url: req.originalUrl,\n          method: req.method,\n          body: req.body,\n          query: req.query,\n          userId: (req as any).user?.id,\n        }\n      });\n\n      // If it's an API route, return JSON\n      if (req.originalUrl && req.originalUrl.startsWith(\"/api/\")) {\n        return res.status(500).json({\n          error: \"Internal server error\",\n          message: error.message || \"An unexpected error occurred\",\n          success: false,\n        });\n      }\n\n      // For non-API routes, you might want to render an error page\n      res.status(500).send(\"Internal Server Error\");\n    });\n\n    const server = createServer(app);\n\n    const port = parseInt(process.env.PORT || \"5000\");\n\n    if (process.env.NODE_ENV === \"development\") {\n      await setupVite(app, server);\n    } else {\n      serveStatic(app);\n    }\n\n    // Start the server FIRST to open the port immediately\n    server.listen(port, \"0.0.0.0\", () => {\n      logger.divider('SERVER STARTED');\n      logger.success(`Server running on http://0.0.0.0:${port}`, { module: 'SERVER' });\n      \n      // Initialize database in the background after server is running\n      (async () => {\n        let dbConnected = false;\n        let retryCount = 0;\n        const maxRetries = 3;\n\n        // Retry database connection\n        while (!dbConnected && retryCount < maxRetries) {\n          try {\n            logger.info(\"Initializing database...\", { module: 'DATABASE' });\n            await initializeDatabase();\n            dbConnected = true;\n            logger.success(\"Database initialized successfully\", { module: 'DATABASE' });\n          } catch (error) {\n            retryCount++;\n            logger.error(`Database connection attempt ${retryCount}/${maxRetries} failed`, error as Error, { module: 'DATABASE' });\n            if (retryCount < maxRetries) {\n              logger.info(`Retrying in 5 seconds...`, { module: 'DATABASE' });\n              await new Promise((resolve) => setTimeout(resolve, 5000));\n            }\n          }\n        }\n\n        if (!dbConnected) {\n          logger.error(\"Database connection failed - starting in limited mode\", undefined, { module: 'DATABASE' });\n          return;\n        }\n\n        // Initialize default units only if database is connected\n        try {\n          await initializeUnits();\n          logger.success(\"Units initialized successfully\", { module: 'UNITS' });\n        } catch (error) {\n          logger.warn(\"Unit initialization failed\", {\n            module: 'UNITS',\n            details: { error: (error as Error).message }\n          });\n        }\n\n        // Initialize security monitoring\n        try {\n          // Connect security monitor to alert service\n          securityMonitor.onAlert(async (alert) => {\n            await alertService.sendAlert(alert);\n          });\n          logger.success(\"Security monitoring initialized\", { module: 'SECURITY' });\n        } catch (error) {\n          logger.warn(\"Security monitoring initialization failed\", {\n            module: 'SECURITY',\n            details: { error: (error as Error).message }\n          });\n        }\n\n        // Initialize default pricing settings\n        try {\n          logger.info(\"Initializing pricing settings...\", { module: 'PRICING' });\n          const currentPrice = await storage.getSystemPrice();\n          logger.success(`System price initialized: $${currentPrice}`, { module: 'PRICING' });\n        } catch (error) {\n          logger.warn(\"Pricing settings initialization failed\", {\n            module: 'PRICING',\n            details: { error: (error as Error).message }\n          });\n        }\n\n        logger.divider('SYSTEM READY');\n      })();\n    });\n  } catch (error) {\n    logger.error(\"Failed to start server\", error as Error, { module: 'SERVER' });\n    process.exit(1);\n  }\n}\n\nstartServer();\n","path":null,"size_bytes":6778,"size_tokens":null},"client/src/pages/day-book.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { CalendarIcon, Download, History, TrendingUp } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/hooks/useCurrency\";\nimport { format } from \"date-fns\";\n\ninterface DayBookEntry {\n  category: string;\n  bankAccount: number;\n  counter: number;\n  ownerAccount: number;\n  total: number;\n  creditDue: number;\n}\n\nexport default function DayBook() {\n  const [selectedDate, setSelectedDate] = useState(\n    format(new Date(), \"yyyy-MM-dd\"),\n  );\n  const { toast } = useToast();\n  const { formatCurrency } = useCurrency();\n\n  const { data: orders = [] } = useQuery({\n    queryKey: [\"/api/orders\"],\n  });\n\n  const { data: expenses = [] } = useQuery({\n    queryKey: [\"/api/expenses\"],\n  });\n\n  const { data: bills = [] } = useQuery({\n    queryKey: [\"/api/bills\"],\n  });\n\n  // Calculate day book entries based on actual data\n  const calculateDayBookEntries = (): DayBookEntry[] => {\n    const selectedDateObj = new Date(selectedDate);\n    const startOfDay = new Date(selectedDateObj);\n    startOfDay.setHours(0, 0, 0, 0);\n    const endOfDay = new Date(selectedDateObj);\n    endOfDay.setHours(23, 59, 59, 999);\n\n    // Filter data for selected date\n    const dayOrders = orders.filter((order: any) => {\n      const orderDate = new Date(order.orderDate || order.createdAt);\n      return orderDate >= startOfDay && orderDate <= endOfDay;\n    });\n\n    const dayExpenses = expenses.filter((expense: any) => {\n      const expenseDate = new Date(expense.date || expense.createdAt);\n      return expenseDate >= startOfDay && expenseDate <= endOfDay;\n    });\n\n    const dayBills = bills.filter((bill: any) => {\n      const billDate = new Date(bill.billDate || bill.createdAt);\n      return billDate >= startOfDay && billDate <= endOfDay;\n    });\n\n    // Calculate receipts\n    const completedOrders = dayOrders.filter(\n      (order: any) => order.status === \"completed\",\n    );\n    const paidBills = dayBills.filter((bill: any) => bill.status === \"paid\");\n\n    const netSales = completedOrders.reduce(\n      (sum: number, order: any) => sum + parseFloat(order.totalAmount || 0),\n      0,\n    );\n    const purchaseReturn = 0; // Placeholder - implement if you have purchase returns\n    const paymentIn = paidBills.reduce(\n      (sum: number, bill: any) => sum + parseFloat(bill.totalAmount || 0),\n      0,\n    );\n    const income = 0; // Placeholder - implement based on your income tracking\n\n    // Calculate payments\n    const purchases = dayExpenses\n      .filter((expense: any) => expense.category === \"purchase\")\n      .reduce(\n        (sum: number, expense: any) => sum + parseFloat(expense.amount || 0),\n        0,\n      );\n\n    const salesReturn = 0; // Placeholder - implement if you have sales returns\n    const paymentOut = dayExpenses\n      .filter((expense: any) => expense.category !== \"purchase\")\n      .reduce(\n        (sum: number, expense: any) => sum + parseFloat(expense.amount || 0),\n        0,\n      );\n\n    const expensesTotal = dayExpenses.reduce(\n      (sum: number, expense: any) => sum + parseFloat(expense.amount || 0),\n      0,\n    );\n\n    // For now, we'll distribute amounts across accounts (you can modify this logic based on your business rules)\n    const entries: DayBookEntry[] = [\n      // Receipts\n      {\n        category: \"Net Sales\",\n        bankAccount: netSales * 0.7, // 70% to bank\n        counter: netSales * 0.3, // 30% to counter\n        ownerAccount: 0,\n        total: netSales,\n        creditDue: 0,\n      },\n      {\n        category: \"Purchase Return\",\n        bankAccount: 0,\n        counter: 0,\n        ownerAccount: 0,\n        total: purchaseReturn,\n        creditDue: 0,\n      },\n      {\n        category: \"Payment In\",\n        bankAccount: paymentIn,\n        counter: 0,\n        ownerAccount: 0,\n        total: paymentIn,\n        creditDue: 0,\n      },\n      {\n        category: \"Income\",\n        bankAccount: income,\n        counter: 0,\n        ownerAccount: 0,\n        total: income,\n        creditDue: 0,\n      },\n      // Payments\n      {\n        category: \"Purchase\",\n        bankAccount: purchases * 0.8,\n        counter: 0,\n        ownerAccount: purchases * 0.2,\n        total: purchases,\n        creditDue: 0,\n      },\n      {\n        category: \"Sales Return\",\n        bankAccount: 0,\n        counter: 0,\n        ownerAccount: 0,\n        total: salesReturn,\n        creditDue: 0,\n      },\n      {\n        category: \"Payment Out\",\n        bankAccount: paymentOut,\n        counter: 0,\n        ownerAccount: 0,\n        total: paymentOut,\n        creditDue: 0,\n      },\n      {\n        category: \"Expenses\",\n        bankAccount: expensesTotal * 0.6,\n        counter: expensesTotal * 0.4,\n        ownerAccount: 0,\n        total: expensesTotal,\n        creditDue: 0,\n      },\n    ];\n\n    return entries;\n  };\n\n  const dayBookEntries = calculateDayBookEntries();\n\n  // Calculate totals\n  const totalReceipts = dayBookEntries.slice(0, 4).reduce(\n    (sum, entry) => ({\n      bankAccount: sum.bankAccount + entry.bankAccount,\n      counter: sum.counter + entry.counter,\n      ownerAccount: sum.ownerAccount + entry.ownerAccount,\n      total: sum.total + entry.total,\n    }),\n    { bankAccount: 0, counter: 0, ownerAccount: 0, total: 0 },\n  );\n\n  const totalPayments = dayBookEntries.slice(4, 8).reduce(\n    (sum, entry) => ({\n      bankAccount: sum.bankAccount + entry.bankAccount,\n      counter: sum.counter + entry.counter,\n      ownerAccount: sum.ownerAccount + entry.ownerAccount,\n      total: sum.total + entry.total,\n    }),\n    { bankAccount: 0, counter: 0, ownerAccount: 0, total: 0 },\n  );\n\n  const netReceipt = {\n    bankAccount: totalReceipts.bankAccount - totalPayments.bankAccount,\n    counter: totalReceipts.counter - totalPayments.counter,\n    ownerAccount: totalReceipts.ownerAccount - totalPayments.ownerAccount,\n    total: totalReceipts.total - totalPayments.total,\n  };\n\n  const handleExport = () => {\n    toast({\n      title: \"Export Started\",\n      description:\n        \"Day book report is being generated and will download shortly.\",\n    });\n  };\n\n  const handleCloseDay = () => {\n    toast({\n      title: \"Day Closed\",\n      description: `Day book for ${format(new Date(selectedDate), \"dd/MM/yyyy\")} has been closed.`,\n    });\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-gray-600\">\n            Daily transaction summary and calculations\n          </p>\n        </div>\n        <div className=\"flex space-x-3\">\n          <Button\n            variant=\"outline\"\n            onClick={handleExport}\n            className=\"flex items-center gap-2\"\n          >\n            <Download className=\"h-4 w-4\" />\n            Sales Summary\n          </Button>\n          <Button onClick={handleCloseDay} className=\"flex items-center gap-2\">\n            Close the day\n          </Button>\n          <Button variant=\"outline\" className=\"flex items-center gap-2\">\n            <History className=\"h-4 w-4\" />\n            Daybook History\n          </Button>\n        </div>\n      </div>\n\n      {/* Date Selection */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"flex items-center gap-2\">\n              <CalendarIcon className=\"h-4 w-4\" />\n              <label htmlFor=\"date-select\" className=\"text-sm font-medium\">\n                Select Date:\n              </label>\n            </div>\n            <Input\n              id=\"date-select\"\n              type=\"date\"\n              value={selectedDate}\n              onChange={(e) => setSelectedDate(e.target.value)}\n              className=\"w-48\"\n            />\n            <Badge variant=\"outline\" className=\"ml-auto\">\n              {format(new Date(selectedDate), \"dd MMM yyyy\")}\n            </Badge>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Day Book Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <TrendingUp className=\"h-5 w-5\" />\n            Daily Transaction Summary\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full border-collapse\">\n              <thead>\n                <tr className=\"border-b-2 border-gray-200\">\n                  <th className=\"text-left p-3 font-semibold\">PMT Accounts</th>\n                  <th className=\"text-center p-3 font-semibold\">\n                    Bank Account\n                  </th>\n                  <th className=\"text-center p-3 font-semibold\">Counter</th>\n                  <th className=\"text-center p-3 font-semibold\">\n                    Owner's Account\n                  </th>\n                  <th className=\"text-center p-3 font-semibold\">Total</th>\n                  <th className=\"text-center p-3 font-semibold\">Credit(Due)</th>\n                </tr>\n              </thead>\n              <tbody>\n                {/* Receipts Section */}\n                <tr>\n                  <td\n                    colSpan={6}\n                    className=\"bg-blue-50 p-2 font-semibold text-blue-800\"\n                  >\n                    Receipts\n                  </td>\n                </tr>\n                {dayBookEntries.slice(0, 4).map((entry, index) => (\n                  <tr\n                    key={`receipt-${index}`}\n                    className=\"border-b hover:bg-gray-50\"\n                  >\n                    <td className=\"p-3\">{entry.category}</td>\n                    <td className=\"p-3 text-center\">\n                      {formatCurrency(entry.bankAccount)}\n                    </td>\n                    <td className=\"p-3 text-center\">\n                      {formatCurrency(entry.counter)}\n                    </td>\n                    <td className=\"p-3 text-center\">\n                      {formatCurrency(entry.ownerAccount)}\n                    </td>\n                    <td className=\"p-3 text-center font-medium\">\n                      {formatCurrency(entry.total)}\n                    </td>\n                    <td className=\"p-3 text-center\">\n                      {formatCurrency(entry.creditDue)}\n                    </td>\n                  </tr>\n                ))}\n\n                {/* Total Receipts */}\n                <tr className=\"border-b-2 border-blue-200 bg-blue-50 font-semibold\">\n                  <td className=\"p-3\">Total Receipts [A]</td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(totalReceipts.bankAccount)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(totalReceipts.counter)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(totalReceipts.ownerAccount)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(totalReceipts.total)}\n                  </td>\n                  <td className=\"p-3 text-center\">-</td>\n                </tr>\n\n                {/* Payments Section */}\n                <tr>\n                  <td\n                    colSpan={6}\n                    className=\"bg-red-50 p-2 font-semibold text-red-800\"\n                  >\n                    Payments\n                  </td>\n                </tr>\n                {dayBookEntries.slice(4, 8).map((entry, index) => (\n                  <tr\n                    key={`payment-${index}`}\n                    className=\"border-b hover:bg-gray-50\"\n                  >\n                    <td className=\"p-3\">{entry.category}</td>\n                    <td className=\"p-3 text-center\">\n                      {formatCurrency(entry.bankAccount)}\n                    </td>\n                    <td className=\"p-3 text-center\">\n                      {formatCurrency(entry.counter)}\n                    </td>\n                    <td className=\"p-3 text-center\">\n                      {formatCurrency(entry.ownerAccount)}\n                    </td>\n                    <td className=\"p-3 text-center font-medium\">\n                      {formatCurrency(entry.total)}\n                    </td>\n                    <td className=\"p-3 text-center\">\n                      {formatCurrency(entry.creditDue)}\n                    </td>\n                  </tr>\n                ))}\n\n                {/* Total Payments */}\n                <tr className=\"border-b-2 border-red-200 bg-red-50 font-semibold\">\n                  <td className=\"p-3\">Total Payments [B]</td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(totalPayments.bankAccount)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(totalPayments.counter)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(totalPayments.ownerAccount)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(totalPayments.total)}\n                  </td>\n                  <td className=\"p-3 text-center\">-</td>\n                </tr>\n\n                {/* Net Receipt */}\n                <tr className=\"border-b-2 border-green-300 bg-green-50 font-bold text-green-800\">\n                  <td className=\"p-3\">Net Receipt [C = A - B]</td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(netReceipt.bankAccount)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(netReceipt.counter)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(netReceipt.ownerAccount)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(netReceipt.total)}\n                  </td>\n                  <td className=\"p-3 text-center\">-</td>\n                </tr>\n\n                {/* Opening Balance */}\n                <tr className=\"border-b hover:bg-gray-50\">\n                  <td className=\"p-3\">Opening balance (D)</td>\n                  <td className=\"p-3 text-center\">{formatCurrency(0)}</td>\n                  <td className=\"p-3 text-center\">{formatCurrency(5715)}</td>\n                  <td className=\"p-3 text-center\">{formatCurrency(645)}</td>\n                  <td className=\"p-3 text-center\">{formatCurrency(6360)}</td>\n                  <td className=\"p-3 text-center\">-</td>\n                </tr>\n\n                {/* Closing Balance */}\n                <tr className=\"border-b-2 border-gray-400 bg-gray-100 font-bold\">\n                  <td className=\"p-3\">Closing Balance [E = C + D]</td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(netReceipt.bankAccount)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(netReceipt.counter + 5715)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(netReceipt.ownerAccount + 645)}\n                  </td>\n                  <td className=\"p-3 text-center\">\n                    {formatCurrency(netReceipt.total + 6360)}\n                  </td>\n                  <td className=\"p-3 text-center\">-</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <h3 className=\"text-lg font-semibold text-green-600\">\n                Total Receipts\n              </h3>\n              <p className=\"text-3xl font-bold text-green-800\">\n                {formatCurrency(totalReceipts.total)}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <h3 className=\"text-lg font-semibold text-red-600\">\n                Total Payments\n              </h3>\n              <p className=\"text-3xl font-bold text-red-800\">\n                {formatCurrency(totalPayments.total)}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <h3 className=\"text-lg font-semibold text-blue-600\">\n                Net Receipt\n              </h3>\n              <p\n                className={`text-3xl font-bold ${netReceipt.total >= 0 ? \"text-blue-800\" : \"text-red-800\"}`}\n              >\n                {formatCurrency(netReceipt.total)}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":17345,"size_tokens":null},"client/src/components/profile-editor.tsx":{"content":"\nimport { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { User, Edit } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\n\ninterface ProfileEditorProps {\n  user: any;\n}\n\nexport default function ProfileEditor({ user }: ProfileEditorProps) {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [profileData, setProfileData] = useState({\n    firstName: user?.firstName || \"\",\n    lastName: user?.lastName || \"\",\n    email: user?.email || \"\",\n    currentPassword: \"\",\n    newPassword: \"\",\n    confirmPassword: \"\",\n  });\n  const { toast } = useToast();\n\n  const updateMutation = useMutation({\n    mutationFn: (data: any) => apiRequest(\"PUT\", \"/api/profile\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      setIsDialogOpen(false);\n      setProfileData(prev => ({\n        ...prev,\n        currentPassword: \"\",\n        newPassword: \"\",\n        confirmPassword: \"\",\n      }));\n      toast({ title: \"Success\", description: \"Profile updated successfully\" });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to update profile\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSave = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (profileData.newPassword && profileData.newPassword !== profileData.confirmPassword) {\n      toast({\n        title: \"Error\",\n        description: \"New passwords don't match\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const data: any = {\n      firstName: profileData.firstName,\n      lastName: profileData.lastName,\n      email: profileData.email,\n    };\n\n    if (profileData.newPassword) {\n      data.currentPassword = profileData.currentPassword;\n      data.newPassword = profileData.newPassword;\n    }\n\n    updateMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n      <DialogTrigger asChild>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => {\n            setProfileData({\n              firstName: user?.firstName || \"\",\n              lastName: user?.lastName || \"\",\n              email: user?.email || \"\",\n              currentPassword: \"\",\n              newPassword: \"\",\n              confirmPassword: \"\",\n            });\n          }}\n        >\n          <Edit className=\"h-4 w-4 mr-2\" />\n          Edit Profile\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <User className=\"h-5 w-5\" />\n            Edit Profile\n          </DialogTitle>\n          <DialogDescription>\n            Update your personal information and password\n          </DialogDescription>\n        </DialogHeader>\n        <form onSubmit={handleSave} className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"firstName\">First Name</Label>\n              <Input\n                id=\"firstName\"\n                value={profileData.firstName}\n                onChange={(e) => setProfileData({ ...profileData, firstName: e.target.value })}\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"lastName\">Last Name</Label>\n              <Input\n                id=\"lastName\"\n                value={profileData.lastName}\n                onChange={(e) => setProfileData({ ...profileData, lastName: e.target.value })}\n                required\n              />\n            </div>\n          </div>\n          <div>\n            <Label htmlFor=\"email\">Email</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              value={profileData.email}\n              onChange={(e) => setProfileData({ ...profileData, email: e.target.value })}\n              required\n            />\n          </div>\n          <div className=\"border-t pt-4\">\n            <h4 className=\"text-sm font-medium mb-3\">Change Password (Optional)</h4>\n            <div className=\"space-y-3\">\n              <div>\n                <Label htmlFor=\"currentPassword\">Current Password</Label>\n                <Input\n                  id=\"currentPassword\"\n                  type=\"password\"\n                  value={profileData.currentPassword}\n                  onChange={(e) => setProfileData({ ...profileData, currentPassword: e.target.value })}\n                  placeholder=\"Enter current password\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"newPassword\">New Password</Label>\n                <Input\n                  id=\"newPassword\"\n                  type=\"password\"\n                  value={profileData.newPassword}\n                  onChange={(e) => setProfileData({ ...profileData, newPassword: e.target.value })}\n                  placeholder=\"Enter new password\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"confirmPassword\">Confirm New Password</Label>\n                <Input\n                  id=\"confirmPassword\"\n                  type=\"password\"\n                  value={profileData.confirmPassword}\n                  onChange={(e) => setProfileData({ ...profileData, confirmPassword: e.target.value })}\n                  placeholder=\"Confirm new password\"\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"flex justify-end space-x-2\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setIsDialogOpen(false)}\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={updateMutation.isPending}\n            >\n              Update Profile\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":6774,"size_tokens":null},"client/src/components/enhanced-production-schedule.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport React from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Calendar,\n  Clock,\n  Package,\n  Scale,\n  Target,\n  Plus,\n  Edit,\n  Trash2,\n  Minus,\n} from \"lucide-react\";\nimport { format, addDays, startOfDay } from \"date-fns\";\n\nconst productionScheduleSchema = z.object({\n  scheduledDate: z.string().min(1, \"Please select a date\"),\n  priority: z.enum([\"low\", \"medium\", \"high\"], {\n    required_error: \"Please select priority\",\n  }),\n  notes: z.string().optional(),\n  products: z\n    .array(\n      z.object({\n        productId: z.number().min(1, \"Please select a product\"),\n        targetQuantity: z.number().min(1, \"Target amount must be at least 1\"),\n        unit: z.enum([\"kg\", \"packets\"], {\n          required_error: \"Please select a unit\",\n        }),\n      }),\n    )\n    .min(1, \"At least one product is required\"),\n});\n\ntype ProductionScheduleData = z.infer<typeof productionScheduleSchema>;\n\ninterface ProductionItem {\n  id: number;\n  productId: number;\n  productName: string;\n  scheduledDate: string;\n  targetQuantity: number;\n  unit: \"kg\" | \"packets\";\n  targetPackets?: number;\n  packetsPerKg?: number;\n  priority: \"low\" | \"medium\" | \"high\";\n  status: string;\n  notes?: string;\n  assignedTo?: string;\n}\n\nexport default function EnhancedProductionSchedule() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedDate, setSelectedDate] = useState(\n    format(new Date(), \"yyyy-MM-dd\"),\n  );\n  const [editingItem, setEditingItem] = useState<ProductionItem | null>(null);\n\n  const { data: products = [] } = useQuery({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: productionSchedule = [] } = useQuery({\n    queryKey: [\"/api/production-schedule\", selectedDate],\n  });\n\n  const { data: todaySchedule = [] } = useQuery({\n    queryKey: [\"/api/production-schedule/today\"],\n  });\n\n  const form = useForm<ProductionScheduleData>({\n    resolver: zodResolver(productionScheduleSchema),\n    defaultValues: {\n      scheduledDate: selectedDate,\n      priority: \"medium\",\n      notes: \"\",\n      products: [{ productId: 0, targetQuantity: 1, unit: \"kg\" }],\n    },\n  });\n\n  const { fields, append, remove } = useFieldArray({\n    control: form.control,\n    name: \"products\",\n  });\n\n  const createScheduleMutation = useMutation({\n    mutationFn: async (data: ProductionScheduleData) => {\n      const response = await fetch(\"/api/production-schedule\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error(\"Failed to create schedule item\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/production-schedule\"] });\n      form.reset({\n        scheduledDate: selectedDate,\n        priority: \"medium\",\n        notes: \"\",\n        products: [{ productId: 0, targetQuantity: 1, unit: \"kg\" }],\n      });\n      toast({\n        title: \"Schedule Created\",\n        description: \"Production schedule items have been added successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Creation Failed\",\n        description: \"Failed to create production schedule items.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateScheduleMutation = useMutation({\n    mutationFn: async ({\n      id,\n      data,\n    }: {\n      id: number;\n      data: Partial<ProductionScheduleData>;\n    }) => {\n      const response = await fetch(`/api/production-schedule/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error(\"Failed to update schedule item\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/production-schedule\"] });\n      setEditingItem(null);\n      toast({\n        title: \"Schedule Updated\",\n        description: \"Production schedule item has been updated successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update production schedule item.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteScheduleMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await fetch(`/api/production-schedule/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!response.ok) throw new Error(\"Failed to delete schedule item\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/production-schedule\"] });\n      toast({\n        title: \"Schedule Deleted\",\n        description: \"Production schedule item has been removed.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Deletion Failed\",\n        description: \"Failed to delete production schedule item.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const calculatePackets = (productId: number, targetKg: number): number => {\n    const product = products.find((p: any) => p.id === productId);\n    if (!product || !product.packetsPerKg) return 0;\n    return Math.ceil(targetKg * product.packetsPerKg);\n  };\n\n  const onSubmit = async (data: ProductionScheduleData) => {\n    try {\n      // Create multiple schedule items, one for each product\n      for (const product of data.products) {\n        const scheduleData = {\n          productId: product.productId,\n          scheduledDate: data.scheduledDate,\n          targetQuantity: product.targetQuantity,\n          unit: product.unit,\n          targetPackets:\n            product.unit === \"kg\"\n              ? calculatePackets(product.productId, product.targetQuantity)\n              : product.targetQuantity,\n          priority: data.priority,\n          notes: data.notes,\n        };\n\n        const response = await fetch(\"/api/production-schedule\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(scheduleData),\n        });\n\n        if (!response.ok) throw new Error(\"Failed to create schedule item\");\n      }\n\n      queryClient.invalidateQueries({ queryKey: [\"/api/production-schedule\"] });\n      form.reset({\n        scheduledDate: selectedDate,\n        priority: \"medium\",\n        notes: \"\",\n        products: [{ productId: 0, targetQuantity: 1, unit: \"kg\" }],\n      });\n\n      toast({\n        title: \"Schedule Created\",\n        description: \"Production schedule items have been added successfully.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Creation Failed\",\n        description: \"Failed to create production schedule items.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleEdit = (item: ProductionItem) => {\n    setEditingItem(item);\n    form.reset({\n      scheduledDate: item.scheduledDate,\n      priority: item.priority,\n      notes: item.notes || \"\",\n      products: [\n        {\n          productId: item.productId,\n          targetQuantity: item.targetQuantity,\n          unit: item.unit,\n        },\n      ],\n    });\n  };\n\n  const cancelEdit = () => {\n    setEditingItem(null);\n    form.reset({\n      scheduledDate: selectedDate,\n      priority: \"medium\",\n      notes: \"\",\n      products: [{ productId: 0, targetQuantity: 1, unit: \"kg\" }],\n    });\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case \"high\":\n        return \"bg-red-100 text-red-800\";\n      case \"medium\":\n        return \"bg-yellow-100 text-yellow-800\";\n      case \"low\":\n        return \"bg-green-100 text-green-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"bg-green-100 text-green-800\";\n      case \"in_progress\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"pending\":\n        return \"bg-gray-100 text-gray-800\";\n      case \"delayed\":\n        return \"bg-red-100 text-red-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  useEffect(() => {\n    form.setValue(\"scheduledDate\", selectedDate);\n  }, [selectedDate, form]);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Today's Schedule Overview */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5\" />\n            Today's Production Schedule\n          </CardTitle>\n          <CardDescription>\n            {format(new Date(), \"EEEE, MMMM do, yyyy\")}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {todaySchedule.length === 0 ? (\n            <p className=\"text-gray-500 text-center py-4\">\n              No production scheduled for today\n            </p>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {todaySchedule.map((item: ProductionItem) => (\n                <div key={item.id} className=\"p-4 border rounded-lg\">\n                  <div className=\"flex justify-between items-start mb-2\">\n                    <h4 className=\"font-semibold\">{item.productName}</h4>\n                    <Badge className={getPriorityColor(item.priority)}>\n                      {item.priority}\n                    </Badge>\n                  </div>\n                  <div className=\"space-y-1 text-sm text-gray-600\">\n                    <div className=\"flex items-center gap-2\">\n                      <Target className=\"h-4 w-4\" />\n                      <span>\n                        {item.targetQuantity} {item.unit}\n                      </span>\n                      {item.unit === \"kg\" && item.targetPackets && (\n                        <span className=\"text-gray-400\">\n                          ({item.targetPackets} packets)\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Clock className=\"h-4 w-4\" />\n                      <Badge className={getStatusColor(item.status)}>\n                        {item.status.replace(\"_\", \" \")}\n                      </Badge>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Schedule Management */}\n      <div className=\"space-y-6\">\n        {/* Add/Edit Schedule Form */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Plus className=\"h-5 w-5\" />\n              {editingItem\n                ? \"Edit Schedule Item\"\n                : \"Add Multiple Products to Schedule\"}\n            </CardTitle>\n            <CardDescription>\n              Schedule multiple products for production on the same date\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                <div>\n                  <Label>Scheduled Date</Label>\n                  <Input\n                    type=\"date\"\n                    {...form.register(\"scheduledDate\")}\n                    min={format(new Date(), \"yyyy-MM-dd\")}\n                  />\n                  {form.formState.errors.scheduledDate && (\n                    <p className=\"text-sm text-red-600 mt-1\">\n                      {form.formState.errors.scheduledDate.message}\n                    </p>\n                  )}\n                </div>\n\n                <div>\n                  <Label>Priority</Label>\n                  <Select\n                    value={form.watch(\"priority\")}\n                    onValueChange={(value: \"low\" | \"medium\" | \"high\") =>\n                      form.setValue(\"priority\", value)\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"low\">Low Priority</SelectItem>\n                      <SelectItem value=\"medium\">Medium Priority</SelectItem>\n                      <SelectItem value=\"high\">High Priority</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div>\n                  <Label>Notes (Optional)</Label>\n                  <Textarea\n                    {...form.register(\"notes\")}\n                    placeholder=\"Additional notes or instructions\"\n                  />\n                </div>\n              </div>\n              {/* Products Section */}\n              <div className=\"overflow-x-auto rounded-lg border border-gray-200 shadow-sm\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50 text-sm font-semibold text-gray-700 uppercase tracking-wider\">\n                    <tr>\n                      <th scope=\"col\" className=\"px-6 py-3 text-left\">\n                        Product\n                      </th>\n                      <th scope=\"col\" className=\"px-6 py-3 text-left\">\n                        Target Amount\n                      </th>\n                      <th scope=\"col\" className=\"px-6 py-3 text-left\">\n                        Unit\n                      </th>\n                      <th scope=\"col\" className=\"px-6 py-3 text-left\">\n                        Estimated Packets\n                      </th>\n                      <th scope=\"col\" className=\"px-6 py-3 text-right\">\n                        Actions\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-100 text-sm text-gray-700\">\n                    {fields.map((field, index) => (\n                      <tr\n                        key={field.id}\n                        className=\"hover:bg-gray-50 transition-colors\"\n                      >\n                        {/* Product Select */}\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <Select\n                            value={\n                              form\n                                .watch(`products.${index}.productId`)\n                                ?.toString() || \"\"\n                            }\n                            onValueChange={(value) =>\n                              form.setValue(\n                                `products.${index}.productId`,\n                                parseInt(value),\n                              )\n                            }\n                          >\n                            <SelectTrigger className=\"w-full sm:w-[240px] h-9\">\n                              <SelectValue placeholder=\"Select product\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {products.map((product: any) => (\n                                <SelectItem\n                                  key={product.id}\n                                  value={product.id.toString()}\n                                >\n                                  {product.name}\n                                  {product.packetsPerKg && (\n                                    <span className=\"text-gray-500 ml-2\">\n                                      ({product.packetsPerKg} packets/kg)\n                                    </span>\n                                  )}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </td>\n\n                        {/* Target Quantity Input */}\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <Input\n                            type=\"number\"\n                            step=\"0.1\"\n                            {...form.register(\n                              `products.${index}.targetQuantity`,\n                              {\n                                valueAsNumber: true,\n                              },\n                            )}\n                            placeholder=\"Enter amount\"\n                            className=\"w-28 h-9 px-2\"\n                          />\n                        </td>\n\n                        {/* Unit Select */}\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <Select\n                            value={form.watch(`products.${index}.unit`)}\n                            onValueChange={(value: \"kg\" | \"packets\") =>\n                              form.setValue(`products.${index}.unit`, value)\n                            }\n                          >\n                            <SelectTrigger className=\"h-9 w-[140px]\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"kg\">\n                                <div className=\"flex items-center gap-2\">\n                                  <Scale className=\"h-4 w-4\" />\n                                  Kilograms (kg)\n                                </div>\n                              </SelectItem>\n                              <SelectItem value=\"packets\">\n                                <div className=\"flex items-center gap-2\">\n                                  <Package className=\"h-4 w-4\" />\n                                  Packets\n                                </div>\n                              </SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </td>\n\n                        {/* Estimated Packets Column */}\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          {form.watch(`products.${index}.unit`) === \"kg\" &&\n                          form.watch(`products.${index}.productId`) &&\n                          form.watch(`products.${index}.targetQuantity`) ? (\n                            <div className=\"flex items-center gap-1 text-blue-700 text-sm\">\n                              <Package className=\"h-4 w-4\" />\n                              {calculatePackets(\n                                form.watch(`products.${index}.productId`),\n                                form.watch(`products.${index}.targetQuantity`),\n                              )}\n                            </div>\n                          ) : (\n                            <span className=\"text-gray-400\">‚Äî</span>\n                          )}\n                        </td>\n\n                        {/* Actions */}\n                        <td className=\"px-6 py-4 whitespace-nowrap text-right space-x-2\">\n                          {fields.length > 1 && (\n                            <Button\n                              type=\"button\"\n                              variant=\"destructive\"\n                              size=\"sm\"\n                              onClick={() => remove(index)}\n                              className=\"p-1 h-9 w-9 flex items-center justify-center\"\n                              title=\"Remove\"\n                            >\n                              <Minus className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                        </td>\n                      </tr>\n                    ))}\n\n                    {/* Add Product Button Row */}\n                    <tr>\n                      <td colSpan={5} className=\"px-6 py-4 text-right border-t\">\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() =>\n                            append({\n                              productId: 0,\n                              targetQuantity: 1,\n                              unit: \"kg\",\n                            })\n                          }\n                          className=\"flex items-center gap-1 px-3 h-9 hover:shadow\"\n                        >\n                          <Plus className=\"h-4 w-4\" />\n                          Add Product\n                        </Button>\n                      </td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n\n              <div className=\"w-full flex justify-end\">\n                <div className=\"flex gap-2\">\n                  <Button\n                    type=\"submit\"\n                    disabled={\n                      createScheduleMutation.isPending ||\n                      updateScheduleMutation.isPending\n                    }\n                    className=\"flex-1\"\n                  >\n                    {editingItem ? \"Update Schedule\" : \"Add to Schedule\"}\n                  </Button>\n                  {editingItem && (\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={cancelEdit}\n                      className=\"text-red-600 hover:text-red-800 focus:outline-none\"\n                    >\n                      Cancel\n                    </Button>\n                  )}\n                </div>\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":22127,"size_tokens":null},"client/src/pages/unauthorized.tsx":{"content":"\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Shield, ArrowLeft, AlertTriangle } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function Unauthorized() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 p-6\">\n      <Card className=\"w-full max-w-md\">\n        <CardContent className=\"pt-6\">\n          <div className=\"text-center space-y-6\">\n            <div className=\"mx-auto w-20 h-20 bg-red-100 rounded-full flex items-center justify-center\">\n              <Shield className=\"h-10 w-10 text-red-600\" />\n            </div>\n            \n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                Access Denied\n              </h1>\n              <p className=\"text-gray-600\">\n                You don't have permission to access this page.\n              </p>\n            </div>\n\n            <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\n              <div className=\"flex items-start gap-3\">\n                <AlertTriangle className=\"h-5 w-5 text-amber-600 mt-0.5\" />\n                <div className=\"text-left\">\n                  <p className=\"text-sm font-medium text-amber-900\">\n                    Current Role: {user?.role || 'Unknown'}\n                  </p>\n                  <p className=\"text-xs text-amber-700 mt-1\">\n                    Contact your administrator to request access to this module.\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex flex-col gap-3\">\n              <Button \n                onClick={() => setLocation(\"/\")}\n                className=\"w-full\"\n              >\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Back to Dashboard\n              </Button>\n              \n              <Button \n                variant=\"outline\"\n                onClick={() => window.history.back()}\n                className=\"w-full\"\n              >\n                Go Back\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":2312,"size_tokens":null},"server/middleware/requestLogger.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { logger } from '../lib/logger';\n\ndeclare global {\n  namespace Express {\n    interface Request {\n      startTime?: number;\n      requestId?: string;\n    }\n  }\n}\n\nfunction generateRequestId(): string {\n  return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\nexport function requestLogger(req: Request, res: Response, next: NextFunction): void {\n  req.startTime = Date.now();\n  req.requestId = generateRequestId();\n\n  const userId = (req as any).user?.id || (req as any).session?.passport?.user || 'anonymous';\n  \n  // Disable verbose incoming request logging for performance\n  // Only log if explicitly needed for debugging\n  const shouldLogIncoming = false; // Change to true only when debugging\n  \n  if (shouldLogIncoming && req.method !== 'GET') {\n    logger.debug(`Incoming request`, {\n      module: 'HTTP',\n      details: {\n        requestId: req.requestId,\n        method: req.method,\n        path: req.path,\n      }\n    });\n  }\n\n  const originalSend = res.send;\n  res.send = function(body: any): Response {\n    const duration = req.startTime ? Date.now() - req.startTime : 0;\n    \n    logger.request(\n      req.method,\n      req.path,\n      res.statusCode,\n      duration,\n      userId !== 'anonymous' ? userId : undefined\n    );\n\n    if (res.statusCode >= 400) {\n      let errorMessage = 'Unknown error';\n      try {\n        if (typeof body === 'string') {\n          const parsed = JSON.parse(body);\n          errorMessage = parsed.error || parsed.message || body;\n        } else if (typeof body === 'object') {\n          errorMessage = body.error || body.message || JSON.stringify(body);\n        }\n      } catch {\n        errorMessage = typeof body === 'string' ? body : String(body);\n      }\n      \n      logger.error(`Request failed: ${errorMessage}`, undefined, {\n        module: 'HTTP',\n        details: {\n          requestId: req.requestId,\n          statusCode: res.statusCode,\n          path: req.path,\n          method: req.method,\n        }\n      });\n    }\n\n    return originalSend.call(this, body);\n  };\n\n  next();\n}\n\nfunction sanitizeBody(body: Record<string, unknown>): Record<string, unknown> {\n  const sensitiveFields = ['password', 'confirmPassword', 'token', 'secret', 'apiKey', 'accessToken'];\n  const sanitized: Record<string, unknown> = {};\n  \n  for (const [key, value] of Object.entries(body)) {\n    if (sensitiveFields.some(field => key.toLowerCase().includes(field.toLowerCase()))) {\n      sanitized[key] = '[REDACTED]';\n    } else if (typeof value === 'object' && value !== null) {\n      sanitized[key] = sanitizeBody(value as Record<string, unknown>);\n    } else {\n      sanitized[key] = value;\n    }\n  }\n  \n  return sanitized;\n}\n\nexport function errorLogger(err: Error, req: Request, res: Response, next: NextFunction): void {\n  const duration = req.startTime ? Date.now() - req.startTime : 0;\n  const userId = (req as any).user?.id || (req as any).session?.passport?.user || 'anonymous';\n\n  logger.error(`Unhandled error in ${req.method} ${req.path}`, err, {\n    module: 'HTTP',\n    userId,\n    details: {\n      requestId: req.requestId,\n      duration: `${duration}ms`,\n      stack: err.stack,\n    }\n  });\n\n  next(err);\n}\n\nexport function activityLogger(\n  action: string,\n  module: string,\n  userId?: string,\n  details?: Record<string, unknown>\n): void {\n  logger.activity(action, {\n    module,\n    userId,\n    details,\n  });\n}\n","path":null,"size_bytes":3450,"size_tokens":null},"server/lib/logger.ts":{"content":"type LogLevel = 'INFO' | 'WARN' | 'ERROR' | 'DEBUG' | 'SUCCESS' | 'ACTIVITY';\n\ninterface LogOptions {\n  module?: string;\n  userId?: string;\n  action?: string;\n  details?: Record<string, unknown>;\n}\n\nconst colors = {\n  reset: '\\x1b[0m',\n  bright: '\\x1b[1m',\n  dim: '\\x1b[2m',\n  red: '\\x1b[31m',\n  green: '\\x1b[32m',\n  yellow: '\\x1b[33m',\n  blue: '\\x1b[34m',\n  magenta: '\\x1b[35m',\n  cyan: '\\x1b[36m',\n  white: '\\x1b[37m',\n};\n\nconst levelColors: Record<LogLevel, string> = {\n  INFO: colors.blue,\n  WARN: colors.yellow,\n  ERROR: colors.red,\n  DEBUG: colors.magenta,\n  SUCCESS: colors.green,\n  ACTIVITY: colors.cyan,\n};\n\nconst levelIcons: Record<LogLevel, string> = {\n  INFO: '‚ÑπÔ∏è',\n  WARN: '‚ö†Ô∏è',\n  ERROR: '‚ùå',\n  DEBUG: 'üîç',\n  SUCCESS: '‚úÖ',\n  ACTIVITY: 'üìù',\n};\n\nfunction formatTimestamp(): string {\n  return new Date().toLocaleTimeString('en-US', {\n    hour: '2-digit',\n    minute: '2-digit',\n    second: '2-digit',\n    hour12: true,\n  });\n}\n\nfunction formatMessage(level: LogLevel, message: string, options?: LogOptions): string {\n  const timestamp = formatTimestamp();\n  const icon = levelIcons[level];\n  const color = levelColors[level];\n  const module = options?.module ? `[${options.module}]` : '';\n  const userId = options?.userId ? `(User: ${options.userId})` : '';\n  const action = options?.action ? `Action: ${options.action}` : '';\n  \n  let formattedMessage = `${color}${timestamp} ${icon} ${level}${colors.reset} ${module} ${message}`;\n  \n  if (userId) {\n    formattedMessage += ` ${colors.dim}${userId}${colors.reset}`;\n  }\n  \n  if (action) {\n    formattedMessage += ` ${colors.cyan}[${action}]${colors.reset}`;\n  }\n  \n  return formattedMessage;\n}\n\nclass Logger {\n  private showDebug: boolean;\n\n  constructor() {\n    // Disable debug logging for better performance\n    this.showDebug = process.env.DEBUG === 'true';\n  }\n\n  info(message: string, options?: LogOptions): void {\n    console.log(formatMessage('INFO', message, options));\n    if (options?.details) {\n      console.log('   Details:', JSON.stringify(options.details, null, 2));\n    }\n  }\n\n  warn(message: string, options?: LogOptions): void {\n    console.warn(formatMessage('WARN', message, options));\n    if (options?.details) {\n      console.warn('   Details:', JSON.stringify(options.details, null, 2));\n    }\n  }\n\n  error(message: string, error?: Error | unknown, options?: LogOptions): void {\n    console.error(formatMessage('ERROR', message, options));\n    if (error) {\n      if (error instanceof Error) {\n        console.error(`   Error: ${error.message}`);\n        if (error.stack && this.showDebug) {\n          console.error(`   Stack: ${error.stack}`);\n        }\n      } else {\n        console.error('   Error:', error);\n      }\n    }\n    if (options?.details) {\n      console.error('   Details:', JSON.stringify(options.details, null, 2));\n    }\n  }\n\n  debug(message: string, options?: LogOptions): void {\n    if (this.showDebug) {\n      console.log(formatMessage('DEBUG', message, options));\n      if (options?.details) {\n        console.log('   Details:', JSON.stringify(options.details, null, 2));\n      }\n    }\n  }\n\n  success(message: string, options?: LogOptions): void {\n    console.log(formatMessage('SUCCESS', message, options));\n    if (options?.details) {\n      console.log('   Details:', JSON.stringify(options.details, null, 2));\n    }\n  }\n\n  activity(message: string, options?: LogOptions): void {\n    console.log(formatMessage('ACTIVITY', message, options));\n    if (options?.details) {\n      console.log('   Details:', JSON.stringify(options.details, null, 2));\n    }\n  }\n\n  request(method: string, path: string, statusCode?: number, duration?: number, userId?: string): void {\n    const status = statusCode \n      ? (statusCode >= 400 ? colors.red : statusCode >= 300 ? colors.yellow : colors.green)\n      : colors.white;\n    \n    const durationStr = duration ? `${duration}ms` : '';\n    const userStr = userId ? `(User: ${userId})` : '';\n    \n    console.log(\n      `${colors.cyan}${formatTimestamp()}${colors.reset} ` +\n      `${colors.bright}${method}${colors.reset} ${path} ` +\n      `${status}${statusCode || ''}${colors.reset} ` +\n      `${colors.dim}${durationStr} ${userStr}${colors.reset}`\n    );\n  }\n\n  api(endpoint: string, action: string, success: boolean, details?: Record<string, unknown>): void {\n    const icon = success ? '‚úÖ' : '‚ùå';\n    const color = success ? colors.green : colors.red;\n    console.log(\n      `${colors.cyan}${formatTimestamp()}${colors.reset} ` +\n      `${color}${icon} API${colors.reset} ` +\n      `[${endpoint}] ${action}`\n    );\n    if (details) {\n      console.log('   Details:', JSON.stringify(details, null, 2));\n    }\n  }\n\n  db(operation: string, table: string, success: boolean, recordCount?: number, error?: Error): void {\n    const icon = success ? 'üíæ' : '‚ùå';\n    const color = success ? colors.green : colors.red;\n    const countStr = recordCount !== undefined ? `(${recordCount} records)` : '';\n    \n    console.log(\n      `${colors.cyan}${formatTimestamp()}${colors.reset} ` +\n      `${color}${icon} DB${colors.reset} ` +\n      `${operation} on ${table} ${countStr}`\n    );\n    \n    if (!success && error) {\n      console.error(`   Error: ${error.message}`);\n    }\n  }\n\n  auth(action: string, email: string, success: boolean, reason?: string): void {\n    const icon = success ? 'üîê' : 'üö´';\n    const color = success ? colors.green : colors.red;\n    \n    console.log(\n      `${colors.cyan}${formatTimestamp()}${colors.reset} ` +\n      `${color}${icon} AUTH${colors.reset} ` +\n      `${action} - ${email} ${success ? 'SUCCESS' : 'FAILED'}` +\n      (reason ? ` (${reason})` : '')\n    );\n  }\n\n  security(event: string, severity: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL', details?: Record<string, unknown>): void {\n    const severityColors = {\n      LOW: colors.yellow,\n      MEDIUM: colors.yellow,\n      HIGH: colors.red,\n      CRITICAL: colors.red + colors.bright,\n    };\n    \n    console.warn(\n      `${colors.cyan}${formatTimestamp()}${colors.reset} ` +\n      `${severityColors[severity]}üö® SECURITY [${severity}]${colors.reset} ` +\n      `${event}`\n    );\n    \n    if (details) {\n      console.warn('   Details:', JSON.stringify(details, null, 2));\n    }\n  }\n\n  divider(title?: string): void {\n    const line = '='.repeat(60);\n    if (title) {\n      console.log(`\\n${line}\\n${title}\\n${line}`);\n    } else {\n      console.log(line);\n    }\n  }\n}\n\nexport const logger = new Logger();\nexport default logger;\n","path":null,"size_bytes":6479,"size_tokens":null},"client/src/components/pwa-install-banner.tsx":{"content":"\nimport React, { useState, useEffect } from 'react';\nimport { usePWAInstall } from '@/hooks/usePWAInstall';\nimport { Button } from '@/components/ui/button';\nimport { X, Smartphone, Download } from 'lucide-react';\n\nexport function PWAInstallBanner() {\n  const { isInstallable, isInstalled, installApp, canPromptInstall } = usePWAInstall();\n  const [isDismissed, setIsDismissed] = useState(false);\n\n  useEffect(() => {\n    // Check if banner was previously dismissed\n    const dismissed = localStorage.getItem('pwa-banner-dismissed');\n    if (dismissed) {\n      const dismissTime = parseInt(dismissed);\n      const daysPassed = (Date.now() - dismissTime) / (1000 * 60 * 60 * 24);\n      // Show banner again after 7 days\n      if (daysPassed < 7) {\n        setIsDismissed(true);\n      }\n    }\n  }, []);\n\n  const handleDismiss = () => {\n    setIsDismissed(true);\n    localStorage.setItem('pwa-banner-dismissed', Date.now().toString());\n  };\n\n  const handleInstall = async () => {\n    if (canPromptInstall) {\n      const success = await installApp();\n      if (success) {\n        setIsDismissed(true);\n      }\n    }\n  };\n\n  // Don't show if already installed, dismissed, or not installable\n  if (isInstalled || isDismissed || !isInstallable) {\n    return null;\n  }\n\n  return (\n    <div className=\"w-full bg-gradient-to-r from-blue-50 to-blue-100 border-b border-blue-200 shadow-sm\">\n      <div className=\"max-w-7xl mx-auto px-4 py-3\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3 flex-1\">\n            <div className=\"flex-shrink-0 w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center\">\n              <Smartphone className=\"h-5 w-5 text-white\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <h3 className=\"font-semibold text-sm text-gray-900\">\n                Install BakerSoft App\n              </h3>\n              <p className=\"text-xs text-gray-600\">\n                Add to your home screen for quick access and push notifications\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {canPromptInstall && (\n              <Button\n                onClick={handleInstall}\n                size=\"sm\"\n                className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 text-sm font-medium rounded-lg shadow-sm\"\n              >\n                <Download className=\"h-4 w-4 mr-2\" />\n                Install\n              </Button>\n            )}\n            <Button\n              onClick={handleInstall}\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"text-gray-600 hover:text-gray-800 text-sm px-3\"\n            >\n              Not now\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={handleDismiss}\n              className=\"text-gray-500 hover:text-gray-700 h-8 w-8\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3093,"size_tokens":null},"client/src/components/pwa-install-popup.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { usePWAInstall } from \"@/hooks/usePWAInstall\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { X, Download } from \"lucide-react\";\n\nimport BakerSoftIcon from \"@/public/favicon-icon2.png\";\n\nexport function PWAInstallPopup() {\n  const { isInstallable, isInstalled, installApp, canPromptInstall } =\n    usePWAInstall();\n  const [isDismissed, setIsDismissed] = useState(false);\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    // Check if popup was previously dismissed\n    const dismissed = localStorage.getItem(\"pwa-popup-dismissed\");\n    if (dismissed) {\n      const dismissTime = parseInt(dismissed);\n      const daysPassed = (Date.now() - dismissTime) / (1000 * 60 * 60 * 24);\n      // Show popup again after 7 days\n      if (daysPassed < 7) {\n        setIsDismissed(true);\n        return;\n      }\n    }\n\n    // Show popup after 3 seconds delay\n    if (isInstallable && !isInstalled) {\n      const timer = setTimeout(() => {\n        setIsVisible(true);\n      }, 3000);\n      return () => clearTimeout(timer);\n    }\n  }, [isInstallable, isInstalled]);\n\n  const handleDismiss = () => {\n    setIsVisible(false);\n    setIsDismissed(true);\n    localStorage.setItem(\"pwa-popup-dismissed\", Date.now().toString());\n  };\n\n  const handleNotNow = () => {\n    setIsVisible(false);\n    // Don't set permanent dismiss, will show again on next visit\n  };\n\n  const handleInstall = async () => {\n    if (canPromptInstall) {\n      const success = await installApp();\n      if (success) {\n        setIsVisible(false);\n        setIsDismissed(true);\n      }\n    }\n  };\n\n  // Don't show if already installed, dismissed, or not installable\n  if (!isVisible || isInstalled || isDismissed || !isInstallable) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed bottom-6 right-6 z-50 animate-in slide-in-from-bottom-5 duration-500\">\n      <Card className=\"w-[380px] border-blue-200 bg-gradient-to-br from-blue-50 to-white shadow-2xl\">\n        <div className=\"p-5\">\n          <div className=\"flex items-start gap-4\">\n            {/* Icon */}\n            <div className=\"flex-shrink-0 w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n              <img\n                src={BakerSoftIcon}\n                alt=\"BakerSoft Logo\"\n                className=\"h-6 w-6 object-contain rounded\"\n                loading=\"lazy\"\n              />\n            </div>\n\n            {/* Content */}\n            <div className=\"flex-1 min-w-0\">\n              <div className=\"flex items-start justify-between mb-2\">\n                <h3 className=\"font-semibold text-gray-900 text-base\">\n                  Install BakerSoft App\n                </h3>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={handleDismiss}\n                  className=\"h-6 w-6 -mt-1 -mr-2 text-gray-400 hover:text-gray-600\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n\n              <p className=\"text-sm text-gray-600 mb-4\">\n                Add to your home screen for quick access and push notifications\n              </p>\n\n              {/* Action Buttons */}\n              <div className=\"flex items-center gap-3\">\n                <Button\n                  onClick={handleInstall}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white shadow-md flex items-center gap-2 px-4 py-2\"\n                  size=\"sm\"\n                >\n                  <Download className=\"h-4 w-4\" />\n                  Install\n                </Button>\n                <Button\n                  onClick={handleNotNow}\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"text-gray-600 hover:text-gray-800\"\n                >\n                  Not now\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":4041,"size_tokens":null},"client/src/lib/form-validation.ts":{"content":"\n/**\n * Form Validation Utilities\n * Provides consistent validation rules and error handling across all forms\n */\n\nexport interface ValidationRule {\n  required?: boolean;\n  minLength?: number;\n  maxLength?: number;\n  pattern?: RegExp;\n  min?: number;\n  max?: number;\n  custom?: (value: any) => string | null;\n}\n\nexport interface FieldValidation {\n  [key: string]: ValidationRule;\n}\n\nexport const validateField = (\n  value: any,\n  rules: ValidationRule,\n  fieldName: string\n): string | null => {\n  // Required check\n  if (rules.required && (!value || (typeof value === 'string' && !value.trim()))) {\n    return `${fieldName} is required`;\n  }\n\n  // Skip other validations if value is empty and not required\n  if (!value && !rules.required) {\n    return null;\n  }\n\n  const stringValue = String(value).trim();\n\n  // Min length check\n  if (rules.minLength && stringValue.length < rules.minLength) {\n    return `${fieldName} must be at least ${rules.minLength} characters`;\n  }\n\n  // Max length check\n  if (rules.maxLength && stringValue.length > rules.maxLength) {\n    return `${fieldName} must not exceed ${rules.maxLength} characters`;\n  }\n\n  // Pattern check\n  if (rules.pattern && !rules.pattern.test(stringValue)) {\n    return `${fieldName} format is invalid`;\n  }\n\n  // Min value check (for numbers)\n  if (rules.min !== undefined && Number(value) < rules.min) {\n    return `${fieldName} must be at least ${rules.min}`;\n  }\n\n  // Max value check (for numbers)\n  if (rules.max !== undefined && Number(value) > rules.max) {\n    return `${fieldName} must not exceed ${rules.max}`;\n  }\n\n  // Custom validation\n  if (rules.custom) {\n    return rules.custom(value);\n  }\n\n  return null;\n};\n\nexport const validateForm = (\n  data: Record<string, any>,\n  validationRules: FieldValidation,\n  fieldNames?: Record<string, string>\n): Record<string, string> => {\n  const errors: Record<string, string> = {};\n\n  Object.keys(validationRules).forEach((field) => {\n    const displayName = fieldNames?.[field] || field;\n    const error = validateField(data[field], validationRules[field], displayName);\n    if (error) {\n      errors[field] = error;\n    }\n  });\n\n  return errors;\n};\n\n// Common validation patterns\nexport const VALIDATION_PATTERNS = {\n  email: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\n  phone: /^[\\d\\s\\-\\+\\(\\)]+$/,\n  alphanumeric: /^[a-zA-Z0-9]+$/,\n  alphanumericWithSpaces: /^[a-zA-Z0-9\\s]+$/,\n  numeric: /^\\d+$/,\n  decimal: /^\\d+\\.?\\d*$/,\n  url: /^https?:\\/\\/.+/,\n};\n\n// Common validation rules\nexport const COMMON_RULES = {\n  email: {\n    required: true,\n    pattern: VALIDATION_PATTERNS.email,\n    maxLength: 100,\n  },\n  phone: {\n    pattern: VALIDATION_PATTERNS.phone,\n    minLength: 10,\n    maxLength: 20,\n  },\n  name: {\n    required: true,\n    minLength: 2,\n    maxLength: 100,\n  },\n  description: {\n    maxLength: 500,\n  },\n  price: {\n    required: true,\n    min: 0,\n    custom: (value: any) => {\n      if (isNaN(Number(value))) {\n        return \"Price must be a valid number\";\n      }\n      return null;\n    },\n  },\n  quantity: {\n    required: true,\n    min: 0,\n    custom: (value: any) => {\n      if (isNaN(Number(value))) {\n        return \"Quantity must be a valid number\";\n      }\n      return null;\n    },\n  },\n};\n\n// Error message mapper for server errors\nexport const mapServerError = (error: any): { message: string; errors?: Record<string, string> } => {\n  // Validation errors\n  if (error?.response?.data?.errors) {\n    return {\n      message: \"Please fix the errors below\",\n      errors: error.response.data.errors,\n    };\n  }\n\n  // Duplicate entry\n  if (error?.message?.includes(\"already exists\") || error?.message?.includes(\"duplicate\")) {\n    return {\n      message: error.message || \"This entry already exists\",\n      errors: {},\n    };\n  }\n\n  // Generic error\n  return {\n    message: error?.response?.data?.message || error?.message || \"An error occurred\",\n    errors: {},\n  };\n};\n","path":null,"size_bytes":3890,"size_tokens":null},"client/src/pages/product-categories.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport SearchBar from \"@/components/search-bar\";\nimport { useTableSort } from \"@/hooks/useTableSort\";\nimport { SortableTableHeader } from \"@/components/ui/sortable-table-header\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Edit, Trash2, Tags, Loader2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { DeleteConfirmationDialog } from \"@/components/ui/delete-confirmation-dialog\";\nimport type { Category } from \"@shared/schema\";\n\nexport default function ProductCategories() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingCategory, setEditingCategory] = useState<Category | null>(null);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    description: \"\",\n    isActive: true,\n  });\n  const { toast } = useToast();\n\n  const {\n    data: categoriesResponse,\n    isLoading,\n    error,\n    refetch: refetchCategories,\n  } = useQuery<{ success: boolean; data: Category[] } | Category[]>({\n    queryKey: [\"/api/categories\"],\n  });\n\n  // Handle both response formats: { success: true, data: [...] } and direct array\n  const categories: Category[] = Array.isArray(categoriesResponse) \n    ? categoriesResponse \n    : ((categoriesResponse as { success: boolean; data: Category[] })?.data || []);\n\n  const filteredCategories = useMemo(() => {\n    if (!searchQuery.trim()) return categories;\n\n    return categories.filter(\n      (category: Category) =>\n        category.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        category.description?.toLowerCase().includes(searchQuery.toLowerCase())\n    );\n  }, [categories, searchQuery]);\n\n  const { sortedData, sortConfig, requestSort } = useTableSort(\n    filteredCategories,\n    \"name\"\n  );\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      console.log(\"Creating category with data:\", data);\n      const response = await apiRequest(\"POST\", \"/api/categories\", data);\n      console.log(\"Create category response:\", response);\n      return response;\n    },\n    onSuccess: (response) => {\n      console.log(\"Category created successfully:\", response);\n      queryClient.invalidateQueries({ queryKey: [\"/api/categories\"] });\n      refetchCategories();\n      setIsDialogOpen(false);\n      resetForm();\n      setFieldErrors({});\n      toast({\n        title: \"‚úÖ Success\",\n        description: `Category \"${response?.data?.name || 'Category'}\" created successfully`,\n      });\n    },\n    onError: (error: any) => {\n      console.error(\"Create category error:\", error);\n      \n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => (window.location.href = \"/api/login\"), 500);\n        return;\n      }\n\n      // Handle validation errors from server\n      if (error?.response?.data?.errors) {\n        setFieldErrors(error.response.data.errors);\n        toast({\n          title: \"‚ùå Validation Error\",\n          description: \"Please check the form for errors\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Handle duplicate name error\n      if (error?.message?.includes(\"already exists\") || error?.message?.includes(\"duplicate\")) {\n        setFieldErrors({ name: \"A category with this name already exists\" });\n        toast({\n          title: \"‚ùå Duplicate Category\",\n          description: \"A category with this name already exists. Please use a different name.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Generic error\n      const errorMessage = error?.response?.data?.message || error?.message || \"Failed to create category\";\n      toast({\n        title: \"‚ùå Error\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: { id: number; values: any }) => {\n      const response = await apiRequest(\n        \"PATCH\",\n        `/api/categories/${data.id}`,\n        data.values\n      );\n      return response;\n    },\n    onSuccess: (response) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/categories\"] });\n      refetchCategories();\n      setIsDialogOpen(false);\n      resetForm();\n      toast({\n        title: \"Success\",\n        description: `Category \"${response.data.name}\" updated successfully`,\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => (window.location.href = \"/api/login\"), 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Failed to update category\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/categories/${id}`);\n      return response;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/categories\"] });\n      refetchCategories();\n      toast({\n        title: \"Success\",\n        description: \"Category deleted successfully\",\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => (window.location.href = \"/api/login\"), 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Failed to delete category\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const toggleActiveMutation = useMutation({\n    mutationFn: async (data: { id: number; isActive: boolean }) => {\n      const response = await apiRequest(\"PATCH\", `/api/categories/${data.id}`, {\n        isActive: data.isActive,\n      });\n      return response;\n    },\n    onSuccess: (response) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/categories\"] });\n      refetchCategories();\n      toast({\n        title: \"Success\",\n        description: `Category \"${response.data.name}\" ${\n          response.data.isActive ? \"activated\" : \"deactivated\"\n        } successfully`,\n      });\n    },\n    onError: (error: any) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"Session expired. Redirecting to login...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => (window.location.href = \"/api/login\"), 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Failed to update status\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      name: \"\",\n      description: \"\",\n      isActive: true,\n    });\n    setEditingCategory(null);\n  };\n\n  const handleOpenDialog = (category?: Category) => {\n    if (category) {\n      setEditingCategory(category);\n      setFormData({\n        name: category.name,\n        description: category.description || \"\",\n        isActive: category.isActive ?? true,\n      });\n    } else {\n      resetForm();\n    }\n    setIsDialogOpen(true);\n  };\n\n  const [fieldErrors, setFieldErrors] = useState<Record<string, string>>({});\n\n  const validateForm = () => {\n    const errors: Record<string, string> = {};\n    \n    if (!formData.name.trim()) {\n      errors.name = \"Category name is required\";\n    } else if (formData.name.trim().length < 2) {\n      errors.name = \"Category name must be at least 2 characters\";\n    } else if (formData.name.trim().length > 100) {\n      errors.name = \"Category name must not exceed 100 characters\";\n    }\n\n    setFieldErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!validateForm()) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fix the errors below before submitting\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    console.log(\"Submitting category form:\", formData);\n\n    if (editingCategory) {\n      console.log(\"Updating category:\", editingCategory.id);\n      updateMutation.mutate({\n        id: editingCategory.id,\n        values: formData,\n      });\n    } else {\n      console.log(\"Creating new category\");\n      createMutation.mutate(formData);\n    }\n  };\n\n  const handleDelete = (category: Category) => {\n    deleteMutation.mutate(category.id);\n  };\n\n  const handleToggleActive = (category: Category) => {\n    toggleActiveMutation.mutate({\n      id: category.id,\n      isActive: !category.isActive,\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <p className=\"text-destructive\">Failed to load categories</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 md:p-6 space-y-6\">\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-4 space-y-0 pb-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-primary/10 rounded-lg\">\n              <Tags className=\"h-6 w-6 text-primary\" />\n            </div>\n            <div>\n              <CardTitle data-testid=\"text-page-title\">Product Categories</CardTitle>\n              <CardDescription>\n                Manage product categories for organizing your products\n              </CardDescription>\n            </div>\n          </div>\n          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogTrigger asChild>\n              <Button\n                onClick={() => handleOpenDialog()}\n                data-testid=\"button-add-category\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Category\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-[425px]\">\n              <DialogHeader>\n                <DialogTitle>\n                  {editingCategory ? \"Edit Category\" : \"Add New Category\"}\n                </DialogTitle>\n                <DialogDescription>\n                  {editingCategory\n                    ? \"Update the category details below.\"\n                    : \"Fill in the details to create a new product category.\"}\n                </DialogDescription>\n              </DialogHeader>\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"name\">Category Name *</Label>\n                  <Input\n                    id=\"name\"\n                    placeholder=\"Enter category name\"\n                    value={formData.name}\n                    onChange={(e) => {\n                      setFormData({ ...formData, name: e.target.value });\n                      if (fieldErrors.name) {\n                        setFieldErrors({ ...fieldErrors, name: \"\" });\n                      }\n                    }}\n                    className={fieldErrors.name ? \"border-red-500 focus-visible:ring-red-500\" : \"\"}\n                    aria-invalid={!!fieldErrors.name}\n                    aria-describedby={fieldErrors.name ? \"name-error\" : undefined}\n                    data-testid=\"input-category-name\"\n                    disabled={createMutation.isPending || updateMutation.isPending}\n                  />\n                  {fieldErrors.name && (\n                    <p id=\"name-error\" className=\"text-sm text-red-600\" role=\"alert\">\n                      {fieldErrors.name}\n                    </p>\n                  )}\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\">Description</Label>\n                  <Textarea\n                    id=\"description\"\n                    placeholder=\"Enter category description\"\n                    value={formData.description}\n                    onChange={(e) =>\n                      setFormData({ ...formData, description: e.target.value })\n                    }\n                    rows={3}\n                    data-testid=\"input-category-description\"\n                    disabled={createMutation.isPending || updateMutation.isPending}\n                  />\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Switch\n                    id=\"isActive\"\n                    checked={formData.isActive}\n                    onCheckedChange={(checked) =>\n                      setFormData({ ...formData, isActive: checked })\n                    }\n                    data-testid=\"switch-category-active\"\n                  />\n                  <Label htmlFor=\"isActive\">Active</Label>\n                </div>\n                <div className=\"flex justify-end gap-2 pt-4\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => {\n                      setIsDialogOpen(false);\n                      resetForm();\n                    }}\n                    data-testid=\"button-cancel\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={\n                      createMutation.isPending || updateMutation.isPending\n                    }\n                    data-testid=\"button-submit\"\n                    aria-busy={createMutation.isPending || updateMutation.isPending}\n                  >\n                    {createMutation.isPending || updateMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" aria-hidden=\"true\" />\n                        {editingCategory ? \"Updating...\" : \"Creating...\"}\n                      </>\n                    ) : editingCategory ? (\n                      \"Update Category\"\n                    ) : (\n                      \"Create Category\"\n                    )}\n                  </Button>\n                </div>\n              </form>\n            </DialogContent>\n          </Dialog>\n        </CardHeader>\n        <CardContent>\n          <div className=\"mb-4\">\n            <SearchBar\n              value={searchQuery}\n              onChange={setSearchQuery}\n              placeholder=\"Search categories...\"\n              data-testid=\"input-search-categories\"\n            />\n          </div>\n\n          <div className=\"rounded-md border\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <SortableTableHeader\n                    sortKey=\"name\"\n                    sortConfig={sortConfig}\n                    onSort={requestSort}\n                    data-testid=\"header-name\"\n                  >\n                    Name\n                  </SortableTableHeader>\n                  <TableHead>Description</TableHead>\n                  <SortableTableHeader\n                    sortKey=\"isActive\"\n                    sortConfig={sortConfig}\n                    onSort={requestSort}\n                    data-testid=\"header-status\"\n                  >\n                    Status\n                  </SortableTableHeader>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {sortedData.length === 0 ? (\n                  <TableRow>\n                    <TableCell\n                      colSpan={4}\n                      className=\"text-center py-8 text-muted-foreground\"\n                    >\n                      {searchQuery\n                        ? \"No categories found matching your search\"\n                        : \"No categories found. Click 'Add Category' to create one.\"}\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  sortedData.map((category: Category) => (\n                    <TableRow key={category.id} data-testid={`row-category-${category.id}`}>\n                      <TableCell className=\"font-medium\" data-testid={`text-category-name-${category.id}`}>\n                        {category.name}\n                      </TableCell>\n                      <TableCell\n                        className=\"max-w-xs truncate text-muted-foreground\"\n                        title={category.description || \"\"}\n                        data-testid={`text-category-description-${category.id}`}\n                      >\n                        {category.description || \"-\"}\n                      </TableCell>\n                      <TableCell>\n                        <Badge\n                          variant={category.isActive ? \"default\" : \"secondary\"}\n                          className=\"cursor-pointer\"\n                          onClick={() => handleToggleActive(category)}\n                          data-testid={`badge-status-${category.id}`}\n                        >\n                          {category.isActive ? \"Active\" : \"Inactive\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleOpenDialog(category)}\n                            data-testid={`button-edit-${category.id}`}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <DeleteConfirmationDialog\n                            title=\"Delete Category\"\n                            description={`Are you sure you want to delete \"${category.name}\"? This action cannot be undone.`}\n                            onConfirm={() => handleDelete(category)}\n                            trigger={\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                disabled={deleteMutation.isPending}\n                                data-testid={`button-delete-${category.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                              </Button>\n                            }\n                          />\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))\n                )}\n              </TableBody>\n            </Table>\n          </div>\n\n          <div className=\"mt-4 text-sm text-muted-foreground\">\n            Showing {sortedData.length} of {categories.length} categories\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":20116,"size_tokens":null},"client/src/lib/bs-date-converter.ts":{"content":"// BS (Bikram Sambat) Date Conversion Utility\n// Using NepaliFunctions library for accurate conversion\n\nexport interface BSDate {\n  year: number;\n  month: number;\n  day: number;\n}\n\nexport interface ADDate {\n  year: number;\n  month: number;\n  day: number;\n}\n\n// Declare global NepaliFunctions to avoid TypeScript errors\ndeclare global {\n  interface Window {\n    NepaliFunctions?: {\n      AD2BS: (adDate: { year: number; month: number; day: number }) => BSDate;\n      BS2AD: (bsDate: BSDate) => ADDate;\n    };\n  }\n}\n\n// Function to load the NepaliFunctions library\nconst loadNepaliFunctions = (): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    // Check if already loaded\n    if (window.NepaliFunctions) {\n      resolve();\n      return;\n    }\n\n    // Create script element\n    const script = document.createElement('script');\n    script.src = 'https://nepalidatepicker.sajanmaharjan.com.np/v5/nepali.datepicker/js/nepali.datepicker.v5.0.4.min.js';\n\n    script.onload = () => {\n      console.log('Nepali date picker script loaded successfully');\n      // Wait a bit for the library to initialize\n      setTimeout(() => {\n        if (window.NepaliFunctions) {\n          resolve();\n        } else {\n          reject(new Error('NepaliFunctions not available after loading'));\n        }\n      }, 100);\n    };\n\n    script.onerror = () => {\n      console.error('Failed to load Nepali date picker script');\n      reject(new Error('Failed to load NepaliFunctions library'));\n    };\n\n    document.head.appendChild(script);\n  });\n};\n\n// Function to convert AD date to BS using NepaliFunctions\nfunction convertADtoBSInternal(adDateStr: string | Date): string {\n  try {\n    if (!adDateStr || adDateStr === \"NULL\" || !window.NepaliFunctions) return \"-\";\n\n    const adDate = new Date(adDateStr);\n    if (isNaN(adDate.getTime())) return \"-\";\n\n    const bsDateObj = window.NepaliFunctions.AD2BS({\n      year: adDate.getFullYear(),\n      month: adDate.getMonth() + 1,\n      day: adDate.getDate()\n    });\n\n    return `${bsDateObj.year}-${String(bsDateObj.month).padStart(2, \"0\")}-${String(bsDateObj.day).padStart(2, \"0\")}`;\n  } catch (err) {\n    console.error(\"BS conversion error:\", err);\n    return \"-\";\n  }\n}\n\nexport const convertADtoBS = async (adDateStr: string | Date): Promise<string> => {\n  try {\n    if (!adDateStr || adDateStr === \"NULL\") return \"-\";\n\n    // Ensure NepaliFunctions is loaded\n    if (!window.NepaliFunctions) {\n      await loadNepaliFunctions();\n    }\n\n    return convertADtoBSInternal(adDateStr);\n  } catch (err) {\n    console.error(\"BS conversion error:\", err);\n    return \"-\";\n  }\n};\n\nexport const formatDateWithBS = async (adDate: string | Date, showBS: boolean = true): Promise<string> => {\n  const adFormatted = new Date(adDate).toLocaleDateString(\"en-US\", {\n    year: \"numeric\",\n    month: \"long\",\n    day: \"numeric\",\n  });\n\n  if (!showBS) {\n    return adFormatted;\n  }\n\n  try {\n    const bsDate = await convertADtoBS(adDate);\n    if (bsDate === \"-\") {\n      return adFormatted;\n    }\n    return `${adFormatted} (${bsDate} BS)`;\n  } catch (error) {\n    console.error('Error formatting date with BS:', error);\n    return adFormatted;\n  }\n};\n\nexport const formatDateTimeWithBS = async (adDateTime: string | Date, showBS: boolean = true): Promise<string> => {\n  const adFormatted = new Date(adDateTime).toLocaleString(\"en-US\", {\n    year: \"numeric\",\n    month: \"long\",\n    day: \"numeric\",\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  });\n\n  if (!showBS) {\n    return adFormatted;\n  }\n\n  try {\n    const bsDate = await convertADtoBS(adDateTime);\n    if (bsDate === \"-\") {\n      return adFormatted;\n    }\n    return `${adFormatted} (${bsDate} BS)`;\n  } catch (error) {\n    console.error('Error formatting datetime with BS:', error);\n    return adFormatted;\n  }\n};\n\n// Utility function to preload the library\nexport const preloadNepaliFunctions = async (): Promise<void> => {\n  try {\n    await loadNepaliFunctions();\n    console.log('NepaliFunctions library preloaded successfully');\n  } catch (error) {\n    console.error('Failed to preload NepaliFunctions library:', error);\n  }\n};","path":null,"size_bytes":4108,"size_tokens":null},"client/src/pages/label-editor.tsx":{"content":"import { useState, useEffect, useRef, useCallback, useMemo } from \"react\"; // ‚úÖ Added useMemo\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  FileText,\n  FolderOpen,\n  Save,\n  Printer,\n  Undo2,\n  Redo2,\n  Scissors,\n  Copy,\n  Clipboard,\n  ZoomIn,\n  ZoomOut,\n  Search,\n  Bold,\n  Italic,\n  Underline,\n  Strikethrough,\n  AlignLeft,\n  AlignCenter,\n  AlignRight,\n  AlignJustify,\n  Type,\n  Image,\n  Square,\n  Circle,\n  Minus,\n  ArrowRight,\n  QrCode,\n  Barcode,\n  Grid3X3,\n  Trash2,\n  Move,\n  Maximize2,\n  RotateCw,\n  FlipHorizontal,\n  FlipVertical,\n  Layers,\n  Lock,\n  Unlock,\n  Eye,\n  EyeOff,\n  ChevronDown,\n  Palette,\n  PenTool,\n  MousePointer,\n  Hand,\n  Plus,\n  Download,\n  Upload,\n  Settings,\n  HelpCircle,\n  MoreHorizontal,\n  Triangle,\n  Star,\n  Hexagon,\n  PaintBucket,\n  Pipette,\n  Eraser,\n  LayoutGrid,\n  Home,\n} from \"lucide-react\";\n\ninterface LabelElement {\n  id: string;\n  type:\n    | \"text\"\n    | \"barcode\"\n    | \"qrcode\"\n    | \"image\"\n    | \"line\"\n    | \"rectangle\"\n    | \"ellipse\"\n    | \"triangle\"\n    | \"star\";\n  label: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  rotation: number;\n  fontSize: number;\n  fontFamily: string;\n  fontWeight: \"normal\" | \"bold\";\n  fontStyle: \"normal\" | \"italic\";\n  textDecoration: \"none\" | \"underline\" | \"line-through\";\n  textAlign: \"left\" | \"center\" | \"right\" | \"justify\";\n  verticalAlign: \"top\" | \"middle\" | \"bottom\";\n  content: string;\n  color: string;\n  backgroundColor: string;\n  borderColor: string;\n  borderWidth: number;\n  borderStyle: \"solid\" | \"dashed\" | \"dotted\" | \"none\";\n  opacity: number;\n  visible: boolean;\n  locked: boolean;\n  zIndex: number;\n}\n\ninterface LabelTemplate {\n  id?: number;\n  name: string;\n  width: number;\n  height: number;\n  unit: \"mm\" | \"px\" | \"in\" | \"cm\";\n  elements: LabelElement[];\n  margins: { top: number; right: number; bottom: number; left: number };\n  gridEnabled: boolean;\n  gridSize: number;\n  snapToGrid: boolean;\n  backgroundColor: string;\n  isDefault?: boolean;\n}\n\nconst FONTS = [\n  \"Arial\",\n  \"Arial Black\",\n  \"Comic Sans MS\",\n  \"Courier New\",\n  \"Georgia\",\n  \"Impact\",\n  \"Lucida Console\",\n  \"Lucida Sans Unicode\",\n  \"Palatino Linotype\",\n  \"Tahoma\",\n  \"Times New Roman\",\n  \"Trebuchet MS\",\n  \"Verdana\",\n  \"4BARCODE Font 3\",\n  \"Code 39\",\n  \"Code 128\",\n  \"EAN-13\",\n];\n\nconst FONT_SIZES = [\n  4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 18, 20, 22, 24, 26, 28, 36, 48, 72,\n];\n\nconst LINE_WIDTHS = [0.25, 0.5, 1, 1.5, 2, 2.5, 3, 4, 5, 6];\n\nconst COLORS = [\n  \"#000000\",\n  \"#333333\",\n  \"#666666\",\n  \"#999999\",\n  \"#CCCCCC\",\n  \"#FFFFFF\",\n  \"#FF0000\",\n  \"#FF6600\",\n  \"#FFCC00\",\n  \"#00FF00\",\n  \"#00CCFF\",\n  \"#0000FF\",\n  \"#9900FF\",\n  \"#FF00FF\",\n  \"#FF6699\",\n  \"#CC9966\",\n  \"#663300\",\n  \"#006600\",\n];\n\nconst createDefaultElement = (\n  type: LabelElement[\"type\"],\n  id: string,\n): LabelElement => ({\n  id,\n  type,\n  label: `New ${type}`,\n  x: 50,\n  y: 50,\n  width:\n    type === \"line\"\n      ? 150\n      : type === \"barcode\"\n        ? 150\n        : type === \"qrcode\"\n          ? 80\n          : 100,\n  height:\n    type === \"line\"\n      ? 2\n      : type === \"barcode\"\n        ? 40\n        : type === \"qrcode\"\n          ? 80\n          : type === \"text\"\n            ? 24\n            : 60,\n  rotation: 0,\n  fontSize: 12,\n  fontFamily: \"Arial\",\n  fontWeight: \"normal\",\n  fontStyle: \"normal\",\n  textDecoration: \"none\",\n  textAlign: \"left\",\n  verticalAlign: \"middle\",\n  content: type === \"text\" ? \"Text\" : \"\",\n  color: \"#000000\",\n  backgroundColor: \"transparent\",\n  borderColor: \"#000000\",\n  borderWidth:\n    type === \"line\" ? 1 : type === \"rectangle\" || type === \"ellipse\" ? 1 : 0,\n  borderStyle: \"solid\",\n  opacity: 100,\n  visible: true,\n  locked: false,\n  zIndex: 0,\n});\n\nconst defaultElements: LabelElement[] = [\n  {\n    ...createDefaultElement(\"text\", \"product-name\"),\n    label: \"Product Name\",\n    x: 0.2,\n    y: 0.2,\n    width: 3.6,\n    height: 0.8,\n    fontSize: 6,\n    fontWeight: \"bold\",\n    textAlign: \"center\",\n    content: \"Product\",\n  },\n  {\n    ...createDefaultElement(\"text\", \"price\"),\n    label: \"Price\",\n    x: 0.2,\n    y: 1.1,\n    width: 3.6,\n    height: 0.7,\n    fontSize: 5,\n    textAlign: \"center\",\n    content: \"Rs. 100\",\n  },\n  {\n    ...createDefaultElement(\"text\", \"weight\"),\n    label: \"Weight\",\n    x: 0.2,\n    y: 1.9,\n    width: 3.6,\n    height: 0.6,\n    fontSize: 4,\n    textAlign: \"center\",\n    content: \"500g\",\n  },\n];\n\nconst DEFAULT_TEMPLATE_ID = \"default_4x3mm\";\nconst DEFAULT_TEMPLATE_NAME = \"Default 4x3mm Label\";\n\ntype ToolType =\n  | \"select\"\n  | \"pan\"\n  | \"text\"\n  | \"rectangle\"\n  | \"ellipse\"\n  | \"line\"\n  | \"triangle\"\n  | \"star\"\n  | \"image\"\n  | \"barcode\"\n  | \"qrcode\";\n\nexport default function LabelEditor() {\n  const { toast } = useToast();\n  const canvasRef = useRef<HTMLDivElement>(null);\n  const [templateName, setTemplateName] = useState(DEFAULT_TEMPLATE_NAME);\n  const [labelWidth, setLabelWidth] = useState(4);\n  const [labelHeight, setLabelHeight] = useState(3);\n  const [unit, setUnit] = useState<\"mm\" | \"px\" | \"in\" | \"cm\">(\"mm\");\n  const [currentTemplateId, setCurrentTemplateId] = useState<string | number | undefined>(DEFAULT_TEMPLATE_ID);\n  const [elements, setElements] = useState<LabelElement[]>(defaultElements);\n  const [selectedElements, setSelectedElements] = useState<string[]>([]);\n  const [activeTool, setActiveTool] = useState<ToolType>(\"select\");\n  const [zoom, setZoom] = useState(100);\n  const [gridEnabled, setGridEnabled] = useState(true);\n  const [snapToGrid, setSnapToGrid] = useState(true);\n  const [gridSize, setGridSize] = useState(0.5);\n  const [showRulers, setShowRulers] = useState(true);\n  const [canvasBackground, setCanvasBackground] = useState(\"#FFFFFF\");\n  const [isDragging, setIsDragging] = useState(false);\n  const [isResizing, setIsResizing] = useState(false);\n  const [isPanning, setIsPanning] = useState(false);\n  const [resizeHandle, setResizeHandle] = useState<string | null>(null);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n  const [elementStart, setElementStart] = useState({\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n  });\n  const [panOffset, setPanOffset] = useState({ x: 0, y: 0 });\n  const [panStart, setPanStart] = useState({ x: 0, y: 0 });\n  const canvasContainerRef = useRef<HTMLDivElement>(null);\n  const [history, setHistory] = useState<LabelElement[][]>([defaultElements]);\n  const [historyIndex, setHistoryIndex] = useState(0);\n  const [clipboard, setClipboard] = useState<LabelElement[]>([]);\n  const [currentFont, setCurrentFont] = useState(\"Arial\");\n  const [currentFontSize, setCurrentFontSize] = useState(12);\n  const [currentColor, setCurrentColor] = useState(\"#000000\");\n  const [currentBgColor, setCurrentBgColor] = useState(\"transparent\");\n  const [currentBorderColor, setCurrentBorderColor] = useState(\"#000000\");\n  const [currentBorderWidth, setCurrentBorderWidth] = useState(1);\n  const [settingsOpen, setSettingsOpen] = useState(false);\n  const [templatesListOpen, setTemplatesListOpen] = useState(false);\n  const [savedTemplates, setSavedTemplates] = useState<LabelTemplate[]>([]);\n\n  // ‚úÖ Dynamic zoom factor to keep preview consistent regardless of physical size\n  const [manualZoomAdjusted, setManualZoomAdjusted] = useState(false);\n  \n  // Track container size for auto-zoom recalculation\n  const [containerSize, setContainerSize] = useState({ width: 0, height: 0 });\n  \n  // ResizeObserver to track container size changes\n  useEffect(() => {\n    const container = canvasContainerRef.current;\n    if (!container) return;\n    \n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        const { width, height } = entry.contentRect;\n        setContainerSize({ width, height });\n      }\n    });\n    \n    resizeObserver.observe(container);\n    return () => resizeObserver.disconnect();\n  }, []);\n\n  // ‚úÖ FIXED: effectiveDesignScale must be defined BEFORE autoZoomFactor\n  const effectiveDesignScale = useMemo(() => {\n    switch (unit) {\n      case \"mm\":\n        return 10; // 1mm ‚Üí 10px (e.g., 4mm = 40px)\n      case \"cm\":\n        return 40; // 1cm ‚Üí 40px\n      case \"in\":\n        return 96; // 1in = 96px\n      case \"px\":\n      default:\n        return 1;\n    }\n  }, [unit]);\n\n  const autoZoomFactor = useMemo(() => {\n    // Use tracked container size for reliable recalculation\n    const availableWidth = containerSize.width - 80; // padding\n    const availableHeight = containerSize.height - 80; // padding\n    \n    if (availableWidth <= 0 || availableHeight <= 0) return 100;\n    \n    // Calculate actual canvas dimensions in pixels\n    const canvasWidthPx = labelWidth * effectiveDesignScale;\n    const canvasHeightPx = labelHeight * effectiveDesignScale;\n    \n    // Calculate zoom to fit both width and height\n    const zoomToFitWidth = (availableWidth / canvasWidthPx) * 100;\n    const zoomToFitHeight = (availableHeight / canvasHeightPx) * 100;\n    \n    // Use the smaller zoom to ensure it fits in both dimensions\n    const calculatedZoom = Math.min(zoomToFitWidth, zoomToFitHeight);\n    \n    // Ensure minimum readable size (50%) and maximum (400%)\n    return Math.max(50, Math.min(400, calculatedZoom));\n  }, [labelWidth, labelHeight, effectiveDesignScale, containerSize]);\n\n  // Use manual zoom if user adjusted it, otherwise use auto-zoom\n  const effectiveZoom = useMemo(() => {\n    return manualZoomAdjusted ? zoom : autoZoomFactor;\n  }, [zoom, autoZoomFactor, manualZoomAdjusted]);\n\n  const selected = elements.filter((el) => selectedElements.includes(el.id));\n  const singleSelected = selected.length === 1 ? selected[0] : null;\n\n  const pushHistory = useCallback(\n    (newElements: LabelElement[]) => {\n      const newHistory = history.slice(0, historyIndex + 1);\n      newHistory.push(newElements);\n      setHistory(newHistory);\n      setHistoryIndex(newHistory.length - 1);\n    },\n    [history, historyIndex],\n  );\n\n  const undo = useCallback(() => {\n    if (historyIndex > 0) {\n      setHistoryIndex(historyIndex - 1);\n      setElements(history[historyIndex - 1]);\n    }\n  }, [historyIndex, history]);\n\n  const redo = useCallback(() => {\n    if (historyIndex < history.length - 1) {\n      setHistoryIndex(historyIndex + 1);\n      setElements(history[historyIndex + 1]);\n    }\n  }, [historyIndex, history]);\n\n  const updateElement = useCallback(\n    (id: string, updates: Partial<LabelElement>) => {\n      setElements((prev) => {\n        const newElements = prev.map((el) =>\n          el.id === id ? { ...el, ...updates } : el,\n        );\n        pushHistory(newElements);\n        return newElements;\n      });\n    },\n    [pushHistory],\n  );\n\n  const updateSelectedElements = useCallback(\n    (updates: Partial<LabelElement>) => {\n      if (selectedElements.length === 0) return;\n      setElements((prev) => {\n        const newElements = prev.map((el) =>\n          selectedElements.includes(el.id) ? { ...el, ...updates } : el,\n        );\n        pushHistory(newElements);\n        return newElements;\n      });\n    },\n    [selectedElements, pushHistory],\n  );\n\n  const addElement = useCallback(\n    (type: LabelElement[\"type\"]) => {\n      const newId = `element-${Date.now()}`;\n      const newElement = createDefaultElement(type, newId);\n      newElement.zIndex = elements.length;\n      setElements((prev) => {\n        const newElements = [...prev, newElement];\n        pushHistory(newElements);\n        return newElements;\n      });\n      setSelectedElements([newId]);\n      setActiveTool(\"select\");\n    },\n    [elements.length, pushHistory],\n  );\n\n  const deleteSelected = useCallback(() => {\n    if (selectedElements.length === 0) return;\n    setElements((prev) => {\n      const newElements = prev.filter(\n        (el) => !selectedElements.includes(el.id),\n      );\n      pushHistory(newElements);\n      return newElements;\n    });\n    setSelectedElements([]);\n  }, [selectedElements, pushHistory]);\n\n  const copySelected = useCallback(() => {\n    const copied = elements.filter((el) => selectedElements.includes(el.id));\n    setClipboard(copied);\n    toast({\n      title: \"Copied\",\n      description: `${copied.length} element(s) copied to clipboard`,\n    });\n  }, [elements, selectedElements, toast]);\n\n  const cutSelected = useCallback(() => {\n    copySelected();\n    deleteSelected();\n  }, [copySelected, deleteSelected]);\n\n  const paste = useCallback(() => {\n    if (clipboard.length === 0) return;\n    const newElements = clipboard.map((el) => ({\n      ...el,\n      id: `element-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      x: el.x + 20,\n      y: el.y + 20,\n      zIndex: elements.length,\n    }));\n    setElements((prev) => {\n      const updated = [...prev, ...newElements];\n      pushHistory(updated);\n      return updated;\n    });\n    setSelectedElements(newElements.map((el) => el.id));\n  }, [clipboard, elements.length, pushHistory]);\n\n  const duplicateSelected = useCallback(() => {\n    if (selectedElements.length === 0) return;\n    const toDuplicate = elements.filter((el) =>\n      selectedElements.includes(el.id),\n    );\n    const duplicated = toDuplicate.map((el) => ({\n      ...el,\n      id: `element-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      x: el.x + 20,\n      y: el.y + 20,\n      zIndex: elements.length,\n    }));\n    setElements((prev) => {\n      const updated = [...prev, ...duplicated];\n      pushHistory(updated);\n      return updated;\n    });\n    setSelectedElements(duplicated.map((el) => el.id));\n  }, [elements, selectedElements, pushHistory]);\n\n  const bringToFront = useCallback(() => {\n    if (selectedElements.length === 0) return;\n    setElements((prev) => {\n      const maxZ = Math.max(...prev.map((el) => el.zIndex));\n      const newElements = prev.map((el) =>\n        selectedElements.includes(el.id) ? { ...el, zIndex: maxZ + 1 } : el,\n      );\n      pushHistory(newElements);\n      return newElements;\n    });\n  }, [selectedElements, pushHistory]);\n\n  const sendToBack = useCallback(() => {\n    if (selectedElements.length === 0) return;\n    setElements((prev) => {\n      const minZ = Math.min(...prev.map((el) => el.zIndex));\n      const newElements = prev.map((el) =>\n        selectedElements.includes(el.id) ? { ...el, zIndex: minZ - 1 } : el,\n      );\n      pushHistory(newElements);\n      return newElements;\n    });\n  }, [selectedElements, pushHistory]);\n\n  const alignElements = useCallback(\n    (alignment: \"left\" | \"center\" | \"right\" | \"top\" | \"middle\" | \"bottom\") => {\n      if (selectedElements.length < 2) return;\n      const selectedEls = elements.filter((el) =>\n        selectedElements.includes(el.id),\n      );\n      let updates: { [id: string]: Partial<LabelElement> } = {};\n      switch (alignment) {\n        case \"left\":\n          const minX = Math.min(...selectedEls.map((el) => el.x));\n          selectedEls.forEach((el) => {\n            updates[el.id] = { x: minX };\n          });\n          break;\n        case \"center\":\n          const avgCenterX =\n            selectedEls.reduce((sum, el) => sum + el.x + el.width / 2, 0) /\n            selectedEls.length;\n          selectedEls.forEach((el) => {\n            updates[el.id] = { x: avgCenterX - el.width / 2 };\n          });\n          break;\n        case \"right\":\n          const maxRight = Math.max(\n            ...selectedEls.map((el) => el.x + el.width),\n          );\n          selectedEls.forEach((el) => {\n            updates[el.id] = { x: maxRight - el.width };\n          });\n          break;\n        case \"top\":\n          const minY = Math.min(...selectedEls.map((el) => el.y));\n          selectedEls.forEach((el) => {\n            updates[el.id] = { y: minY };\n          });\n          break;\n        case \"middle\":\n          const avgCenterY =\n            selectedEls.reduce((sum, el) => sum + el.y + el.height / 2, 0) /\n            selectedEls.length;\n          selectedEls.forEach((el) => {\n            updates[el.id] = { y: avgCenterY - el.height / 2 };\n          });\n          break;\n        case \"bottom\":\n          const maxBottom = Math.max(\n            ...selectedEls.map((el) => el.y + el.height),\n          );\n          selectedEls.forEach((el) => {\n            updates[el.id] = { y: maxBottom - el.height };\n          });\n          break;\n      }\n      setElements((prev) => {\n        const newElements = prev.map((el) =>\n          updates[el.id] ? { ...el, ...updates[el.id] } : el,\n        );\n        pushHistory(newElements);\n        return newElements;\n      });\n    },\n    [elements, selectedElements, pushHistory],\n  );\n\n  const handleCanvasMouseDown = useCallback(\n    (e: React.MouseEvent) => {\n      if (activeTool === \"pan\") {\n        setIsPanning(true);\n        setPanStart({\n          x: e.clientX - panOffset.x,\n          y: e.clientY - panOffset.y,\n        });\n        return;\n      }\n      if (activeTool !== \"select\") return;\n      const rect = canvasRef.current?.getBoundingClientRect();\n      if (!rect) return;\n      // ‚úÖ FIXED: scale mouse coords using effectiveDesignScale and effectiveZoom\n      const x =\n        (e.clientX - rect.left) /\n        ((effectiveZoom / 100) * effectiveDesignScale);\n      const y =\n        (e.clientY - rect.top) / ((effectiveZoom / 100) * effectiveDesignScale);\n      const clickedElement = [...elements]\n        .sort((a, b) => b.zIndex - a.zIndex)\n        .find(\n          (el) =>\n            el.visible &&\n            !el.locked &&\n            x >= el.x &&\n            x <= el.x + el.width &&\n            y >= el.y &&\n            y <= el.y + el.height,\n        );\n      if (clickedElement) {\n        if (e.shiftKey) {\n          setSelectedElements((prev) =>\n            prev.includes(clickedElement.id)\n              ? prev.filter((id) => id !== clickedElement.id)\n              : [...prev, clickedElement.id],\n          );\n        } else if (!selectedElements.includes(clickedElement.id)) {\n          setSelectedElements([clickedElement.id]);\n        }\n        setIsDragging(true);\n        setDragStart({ x: e.clientX, y: e.clientY });\n        setElementStart({\n          x: clickedElement.x,\n          y: clickedElement.y,\n          width: clickedElement.width,\n          height: clickedElement.height,\n        });\n      } else {\n        setSelectedElements([]);\n      }\n    },\n    [\n      activeTool,\n      elements,\n      effectiveZoom,\n      selectedElements,\n      panOffset,\n      effectiveDesignScale,\n    ], // ‚úÖ dependency added\n  );\n\n  const handleCanvasMouseMove = useCallback(\n    (e: React.MouseEvent) => {\n      if (isPanning) {\n        setPanOffset({\n          x: e.clientX - panStart.x,\n          y: e.clientY - panStart.y,\n        });\n        return;\n      }\n      if (!isDragging && !isResizing) return;\n      // ‚úÖ FIXED: scale dx/dy using effectiveDesignScale and effectiveZoom\n      const dx =\n        (e.clientX - dragStart.x) /\n        (effectiveZoom / 100) /\n        effectiveDesignScale;\n      const dy =\n        (e.clientY - dragStart.y) /\n        (effectiveZoom / 100) /\n        effectiveDesignScale;\n\n      if (isDragging && singleSelected) {\n        let newX = elementStart.x + dx;\n        let newY = elementStart.y + dy;\n        if (snapToGrid) {\n          newX = Math.round(newX / gridSize) * gridSize;\n          newY = Math.round(newY / gridSize) * gridSize;\n        }\n        newX = Math.max(0, Math.min(labelWidth - singleSelected.width, newX));\n        newY = Math.max(0, Math.min(labelHeight - singleSelected.height, newY));\n        setElements((prev) =>\n          prev.map((el) =>\n            el.id === singleSelected.id ? { ...el, x: newX, y: newY } : el,\n          ),\n        );\n      }\n      if (isResizing && singleSelected && resizeHandle) {\n        let newWidth = elementStart.width;\n        let newHeight = elementStart.height;\n        let newX = elementStart.x;\n        let newY = elementStart.y;\n        if (resizeHandle.includes(\"e\"))\n          newWidth = Math.max(10, elementStart.width + dx);\n        if (resizeHandle.includes(\"w\")) {\n          newWidth = Math.max(10, elementStart.width - dx);\n          newX = elementStart.x + dx;\n        }\n        if (resizeHandle.includes(\"s\"))\n          newHeight = Math.max(10, elementStart.height + dy);\n        if (resizeHandle.includes(\"n\")) {\n          newHeight = Math.max(10, elementStart.height - dy);\n          newY = elementStart.y + dy;\n        }\n        setElements((prev) =>\n          prev.map((el) =>\n            el.id === singleSelected.id\n              ? { ...el, x: newX, y: newY, width: newWidth, height: newHeight }\n              : el,\n          ),\n        );\n      }\n    },\n    [\n      isPanning,\n      panStart,\n      isDragging,\n      isResizing,\n      dragStart,\n      elementStart,\n      effectiveZoom,\n      snapToGrid,\n      gridSize,\n      labelWidth,\n      labelHeight,\n      singleSelected,\n      resizeHandle,\n      effectiveDesignScale, // ‚úÖ dependency added\n    ],\n  );\n\n  const handleCanvasMouseUp = useCallback(() => {\n    if (isDragging || isResizing) {\n      pushHistory(elements);\n    }\n    setIsDragging(false);\n    setIsResizing(false);\n    setIsPanning(false);\n    setResizeHandle(null);\n  }, [isDragging, isResizing, elements, pushHistory]);\n\n  const handleResizeStart = useCallback(\n    (e: React.MouseEvent, handle: string) => {\n      e.stopPropagation();\n      if (!singleSelected) return;\n      setIsResizing(true);\n      setResizeHandle(handle);\n      setDragStart({ x: e.clientX, y: e.clientY });\n      setElementStart({\n        x: singleSelected.x,\n        y: singleSelected.y,\n        width: singleSelected.width,\n        height: singleSelected.height,\n      });\n    },\n    [singleSelected],\n  );\n\n  const saveTemplate = useCallback(() => {\n    const template: LabelTemplate = {\n      name: templateName,\n      width: labelWidth,\n      height: labelHeight,\n      unit,\n      elements,\n      margins: { top: 2, right: 2, bottom: 2, left: 2 },\n      gridEnabled,\n      gridSize,\n      snapToGrid,\n      backgroundColor: canvasBackground,\n    };\n    const timestamp = Date.now();\n    localStorage.setItem(\n      `labelTemplate_${timestamp}`,\n      JSON.stringify(template),\n    );\n    localStorage.setItem(\"labelTemplate\", JSON.stringify(template)); // Keep default\n    loadSavedTemplates();\n    toast({\n      title: \"Template Saved\",\n      description: \"Your label template has been saved successfully\",\n    });\n  }, [\n    templateName,\n    labelWidth,\n    labelHeight,\n    unit,\n    elements,\n    gridEnabled,\n    gridSize,\n    snapToGrid,\n    canvasBackground,\n    toast,\n  ]);\n\n  const loadTemplate = useCallback(() => {\n    const saved = localStorage.getItem(\"labelTemplate\");\n    if (saved) {\n      try {\n        const template: LabelTemplate = JSON.parse(saved);\n        setTemplateName(template.name);\n        setLabelWidth(template.width);\n        setLabelHeight(template.height);\n        setUnit(template.unit);\n        setElements(template.elements);\n        setGridEnabled(template.gridEnabled ?? true);\n        setGridSize(template.gridSize ?? 0.5);\n        setSnapToGrid(template.snapToGrid ?? true);\n        setCanvasBackground(template.backgroundColor ?? \"#FFFFFF\");\n        setHistory([template.elements]);\n        setHistoryIndex(0);\n        setManualZoomAdjusted(false);\n        setPanOffset({ x: 0, y: 0 });\n        toast({\n          title: \"Template Loaded\",\n          description: \"Template loaded successfully\",\n        });\n      } catch (e) {\n        toast({\n          title: \"Load Failed\",\n          description: \"Failed to load template\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  }, [toast]);\n\n  const exportTemplate = useCallback(() => {\n    const template: LabelTemplate = {\n      name: templateName,\n      width: labelWidth,\n      height: labelHeight,\n      unit,\n      elements,\n      margins: { top: 2, right: 2, bottom: 2, left: 2 },\n      gridEnabled,\n      gridSize,\n      snapToGrid,\n      backgroundColor: canvasBackground,\n    };\n    const blob = new Blob([JSON.stringify(template, null, 2)], {\n      type: \"application/json\",\n    });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `${templateName.replace(/\\s+/g, \"-\")}.json`;\n    a.click();\n    URL.revokeObjectURL(url);\n  }, [\n    templateName,\n    labelWidth,\n    labelHeight,\n    unit,\n    elements,\n    gridEnabled,\n    gridSize,\n    snapToGrid,\n    canvasBackground,\n  ]);\n\n  const importTemplate = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      const file = e.target.files?.[0];\n      if (!file) return;\n      const reader = new FileReader();\n      reader.onload = (event) => {\n        try {\n          const template: LabelTemplate = JSON.parse(\n            event.target?.result as string,\n          );\n          setTemplateName(template.name);\n          setLabelWidth(template.width);\n          setLabelHeight(template.height);\n          setUnit(template.unit);\n          setElements(template.elements);\n          setGridEnabled(template.gridEnabled ?? true);\n          setGridSize(template.gridSize ?? 10);\n          setSnapToGrid(template.snapToGrid ?? true);\n          setCanvasBackground(template.backgroundColor ?? \"#FFFFFF\");\n          setHistory([template.elements]);\n          setHistoryIndex(0);\n          toast({\n            title: \"Template Imported\",\n            description: \"Template loaded successfully\",\n          });\n        } catch {\n          toast({\n            title: \"Import Failed\",\n            description: \"Invalid template file\",\n            variant: \"destructive\",\n          });\n        }\n      };\n      reader.readAsText(file);\n      e.target.value = \"\";\n    },\n    [toast],\n  );\n\n  const newTemplate = useCallback(() => {\n    setTemplateName(DEFAULT_TEMPLATE_NAME);\n    setLabelWidth(4);\n    setLabelHeight(3);\n    setUnit(\"mm\");\n    setElements(defaultElements);\n    setSelectedElements([]);\n    setHistory([defaultElements]);\n    setHistoryIndex(0);\n    setGridSize(0.5);\n    setManualZoomAdjusted(false);\n    setPanOffset({ x: 0, y: 0 });\n    setCurrentTemplateId(DEFAULT_TEMPLATE_ID);\n    toast({\n      title: \"New Template\",\n      description: \"Reset to default 4x3mm template\",\n    });\n  }, [toast]);\n\n  const printLabel = useCallback(() => {\n    const printWindow = window.open(\"\", \"_blank\");\n    if (!printWindow) {\n      toast({\n        title: \"Print Failed\",\n        description: \"Please allow pop-ups\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    let elementsHtml = elements\n      .filter((el) => el.visible)\n      .map((el) => {\n        const style = `\n        position: absolute;\n        left: ${el.x}px;\n        top: ${el.y}px;\n        width: ${el.width}px;\n        height: ${el.height}px;\n        font-family: ${el.fontFamily};\n        font-size: ${el.fontSize}px;\n        font-weight: ${el.fontWeight};\n        font-style: ${el.fontStyle};\n        text-decoration: ${el.textDecoration};\n        text-align: ${el.textAlign};\n        color: ${el.color};\n        background-color: ${el.backgroundColor};\n        border: ${el.borderWidth}px ${el.borderStyle} ${el.borderColor};\n        opacity: ${el.opacity / 100};\n        transform: rotate(${el.rotation}deg);\n        display: flex;\n        align-items: ${el.verticalAlign === \"top\" ? \"flex-start\" : el.verticalAlign === \"bottom\" ? \"flex-end\" : \"center\"};\n        overflow: hidden;\n      `;\n        if (el.type === \"text\") {\n          return `<div style=\"${style}\">${el.content}</div>`;\n        } else if (el.type === \"barcode\") {\n          return `<div style=\"${style}; background: repeating-linear-gradient(90deg, black, black 2px, white 2px, white 4px);\"></div>`;\n        } else if (el.type === \"qrcode\") {\n          return `<div style=\"${style}; background: linear-gradient(45deg, #000 25%, transparent 25%), linear-gradient(-45deg, #000 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #000 75%), linear-gradient(-45deg, transparent 75%, #000 75%); background-size: 8px 8px;\"></div>`;\n        } else if (el.type === \"rectangle\") {\n          return `<div style=\"${style}\"></div>`;\n        } else if (el.type === \"ellipse\") {\n          return `<div style=\"${style}; border-radius: 50%;\"></div>`;\n        } else if (el.type === \"line\") {\n          return `<div style=\"${style}; background: ${el.color};\"></div>`;\n        } else if (el.type === \"image\") {\n          return el.content\n            ? `<div style=\"${style}\"><img src=\"${el.content}\" style=\"max-width: 100%; max-height: 100%; object-fit: contain;\" /></div>`\n            : `<div style=\"${style}; background: #f0f0f0; display: flex; align-items: center; justify-content: center;\">Image</div>`;\n        } else if (el.type === \"triangle\") {\n          return `<div style=\"${style}\"><div style=\"width: 0; height: 0; border-left: ${el.width / 2}px solid transparent; border-right: ${el.width / 2}px solid transparent; border-bottom: ${el.height}px solid ${el.backgroundColor || el.color};\"></div></div>`;\n        } else if (el.type === \"star\") {\n          return `<div style=\"${style}; font-size: ${el.height}px; line-height: 1;\">&#9733;</div>`;\n        }\n        return \"\";\n      })\n      .join(\"\");\n    printWindow.document.write(`\n      <html>\n        <head>\n          <title>Label - ${templateName}</title>\n          <style>\n            @page { size: ${labelWidth}px ${labelHeight}px; margin: 0; }\n            body { margin: 0; padding: 0; }\n            .label { \n              width: ${labelWidth}px; \n              height: ${labelHeight}px; \n              position: relative;\n              background: ${canvasBackground};\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"label\">${elementsHtml}</div>\n        </body>\n      </html>\n    `);\n    printWindow.document.close();\n    setTimeout(() => printWindow.print(), 250);\n  }, [\n    elements,\n    templateName,\n    labelWidth,\n    labelHeight,\n    canvasBackground,\n    toast,\n  ]);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (\n        e.target instanceof HTMLInputElement ||\n        e.target instanceof HTMLTextAreaElement\n      )\n        return;\n      if (e.ctrlKey || e.metaKey) {\n        switch (e.key.toLowerCase()) {\n          case \"z\":\n            e.preventDefault();\n            e.shiftKey ? redo() : undo();\n            break;\n          case \"y\":\n            e.preventDefault();\n            redo();\n            break;\n          case \"c\":\n            e.preventDefault();\n            copySelected();\n            break;\n          case \"x\":\n            e.preventDefault();\n            cutSelected();\n            break;\n          case \"v\":\n            e.preventDefault();\n            paste();\n            break;\n          case \"d\":\n            e.preventDefault();\n            duplicateSelected();\n            break;\n          case \"s\":\n            e.preventDefault();\n            saveTemplate();\n            break;\n          case \"a\":\n            e.preventDefault();\n            setSelectedElements(elements.map((el) => el.id));\n            break;\n        }\n      } else {\n        switch (e.key) {\n          case \"Delete\":\n          case \"Backspace\":\n            if (selectedElements.length > 0) {\n              e.preventDefault();\n              deleteSelected();\n            }\n            break;\n          case \"Escape\":\n            setSelectedElements([]);\n            setActiveTool(\"select\");\n            break;\n        }\n      }\n    };\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [\n    undo,\n    redo,\n    copySelected,\n    cutSelected,\n    paste,\n    duplicateSelected,\n    saveTemplate,\n    deleteSelected,\n    elements,\n    selectedElements,\n  ]);\n\n  useEffect(() => {\n    loadTemplate();\n    loadSavedTemplates();\n  }, []);\n\n  // Auto-adjust zoom when container resizes\n  useEffect(() => {\n    if (!canvasContainerRef.current) return;\n    \n    const resizeObserver = new ResizeObserver(() => {\n      if (!manualZoomAdjusted) {\n        // Force recalculation of auto-zoom\n        setZoom(prev => prev); // Triggers useMemo recalculation\n      }\n    });\n    \n    resizeObserver.observe(canvasContainerRef.current);\n    \n    return () => resizeObserver.disconnect();\n  }, [manualZoomAdjusted]);\n\n  const loadSavedTemplates = () => {\n    try {\n      const templates: LabelTemplate[] = [];\n      \n      const defaultTemplate: LabelTemplate = {\n        id: 0,\n        name: DEFAULT_TEMPLATE_NAME,\n        width: 4,\n        height: 3,\n        unit: \"mm\",\n        elements: defaultElements,\n        margins: { top: 0, right: 0, bottom: 0, left: 0 },\n        gridEnabled: true,\n        gridSize: 0.5,\n        snapToGrid: true,\n        backgroundColor: \"#FFFFFF\",\n        isDefault: true,\n      };\n      templates.push(defaultTemplate);\n      \n      for (let i = 0; i < localStorage.length; i++) {\n        const key = localStorage.key(i);\n        if (key?.startsWith(\"labelTemplate_\")) {\n          const template = JSON.parse(localStorage.getItem(key) || \"{}\");\n          templates.push({\n            ...template,\n            id: parseInt(key.replace(\"labelTemplate_\", \"\")),\n            isDefault: false,\n          });\n        }\n      }\n      setSavedTemplates(templates);\n    } catch (e) {\n      console.error(\"Failed to load saved templates:\", e);\n    }\n  };\n\n  const loadTemplateForEditing = useCallback(\n    (template: LabelTemplate) => {\n      setTemplateName(template.name);\n      setLabelWidth(template.width);\n      setLabelHeight(template.height);\n      setUnit(template.unit);\n      setElements(template.elements);\n      setGridEnabled(template.gridEnabled ?? true);\n      setGridSize(template.gridSize ?? 0.5);\n      setSnapToGrid(template.snapToGrid ?? true);\n      setCanvasBackground(template.backgroundColor ?? \"#FFFFFF\");\n      setHistory([template.elements]);\n      setHistoryIndex(0);\n      setTemplatesListOpen(false);\n      setManualZoomAdjusted(false); // Always reset to fit-to-screen\n      setPanOffset({ x: 0, y: 0 });\n      setCurrentTemplateId(template.isDefault ? DEFAULT_TEMPLATE_ID : template.id);\n      toast({\n        title: \"Template Loaded\",\n        description: `Editing \"${template.name}\"`,\n      });\n    },\n    [toast],\n  );\n\n  const ToolbarButton = ({\n    icon: Icon,\n    label,\n    onClick,\n    active,\n    disabled,\n  }: {\n    icon: any;\n    label: string;\n    onClick: () => void;\n    active?: boolean;\n    disabled?: boolean;\n  }) => (\n    <Tooltip>\n      <TooltipTrigger asChild>\n        <Button\n          size=\"icon\"\n          variant={active ? \"default\" : \"ghost\"}\n          onClick={onClick}\n          disabled={disabled}\n          className=\"h-7 w-7\"\n          data-testid={`button-${label.toLowerCase().replace(/\\s+/g, \"-\")}`}\n        >\n          <Icon className=\"h-4 w-4\" />\n        </Button>\n      </TooltipTrigger>\n      <TooltipContent side=\"bottom\">\n        <p>{label}</p>\n      </TooltipContent>\n    </Tooltip>\n  );\n\n  const ToolbarSeparator = () => (\n    <Separator orientation=\"vertical\" className=\"h-6 mx-1\" />\n  );\n\n  const renderElement = (el: LabelElement) => {\n    const isSelected = selectedElements.includes(el.id);\n    const baseStyle: React.CSSProperties = {\n      position: \"absolute\",\n      left: el.x,\n      top: el.y,\n      width: el.width,\n      height: el.height,\n      transform: `rotate(${el.rotation}deg)`,\n      opacity: el.opacity / 100,\n      cursor: el.locked\n        ? \"not-allowed\"\n        : activeTool === \"select\"\n          ? \"move\"\n          : \"default\",\n      zIndex: el.zIndex,\n      display: el.visible ? \"flex\" : \"none\",\n      alignItems:\n        el.verticalAlign === \"top\"\n          ? \"flex-start\"\n          : el.verticalAlign === \"bottom\"\n            ? \"flex-end\"\n            : \"center\",\n      justifyContent:\n        el.textAlign === \"center\"\n          ? \"center\"\n          : el.textAlign === \"right\"\n            ? \"flex-end\"\n            : \"flex-start\",\n    };\n\n    const renderContent = () => {\n      switch (el.type) {\n        case \"text\":\n          return (\n            <div\n              style={{\n                width: \"100%\",\n                height: \"100%\",\n                fontFamily: el.fontFamily,\n                fontSize: el.fontSize,\n                fontWeight: el.fontWeight,\n                fontStyle: el.fontStyle,\n                textDecoration: el.textDecoration,\n                textAlign: el.textAlign,\n                color: el.color,\n                backgroundColor: el.backgroundColor,\n                display: \"flex\",\n                alignItems:\n                  el.verticalAlign === \"top\"\n                    ? \"flex-start\"\n                    : el.verticalAlign === \"bottom\"\n                      ? \"flex-end\"\n                      : \"center\",\n                overflow: \"hidden\",\n                padding: \"2px\",\n              }}\n            >\n              {el.content}\n            </div>\n          );\n        case \"barcode\":\n          return (\n            <div\n              style={{\n                width: \"100%\",\n                height: \"100%\",\n                background:\n                  \"repeating-linear-gradient(90deg, #000 0px, #000 2px, #fff 2px, #fff 4px)\",\n                display: \"flex\",\n                alignItems: \"flex-end\",\n                justifyContent: \"center\",\n                paddingBottom: 2,\n              }}\n            >\n              <span\n                style={{ fontSize: 8, background: \"#fff\", padding: \"0 4px\" }}\n              >\n                BARCODE\n              </span>\n            </div>\n          );\n        case \"qrcode\":\n          return (\n            <div\n              style={{\n                width: \"100%\",\n                height: \"100%\",\n                background: `\n                  linear-gradient(45deg, #000 25%, transparent 25%),\n                  linear-gradient(-45deg, #000 25%, transparent 25%),\n                  linear-gradient(45deg, transparent 75%, #000 75%),\n                  linear-gradient(-45deg, transparent 75%, #000 75%)\n                `,\n                backgroundSize: \"8px 8px\",\n                backgroundPosition: \"0 0, 0 4px, 4px -4px, -4px 0px\",\n              }}\n            />\n          );\n        case \"rectangle\":\n          return (\n            <div\n              style={{\n                width: \"100%\",\n                height: \"100%\",\n                backgroundColor: el.backgroundColor,\n                border: `${el.borderWidth}px ${el.borderStyle} ${el.borderColor}`,\n              }}\n            />\n          );\n        case \"ellipse\":\n          return (\n            <div\n              style={{\n                width: \"100%\",\n                height: \"100%\",\n                backgroundColor: el.backgroundColor,\n                border: `${el.borderWidth}px ${el.borderStyle} ${el.borderColor}`,\n                borderRadius: \"50%\",\n              }}\n            />\n          );\n        case \"line\":\n          return (\n            <div\n              style={{\n                width: \"100%\",\n                height: el.borderWidth || 2,\n                backgroundColor: el.color,\n              }}\n            />\n          );\n        case \"triangle\":\n          return (\n            <div\n              style={{\n                width: 0,\n                height: 0,\n                borderLeft: `${el.width / 2}px solid transparent`,\n                borderRight: `${el.width / 2}px solid transparent`,\n                borderBottom: `${el.height}px solid ${\n                  el.backgroundColor || el.color\n                }`,\n              }}\n            />\n          );\n        case \"star\":\n          return (\n            <div\n              style={{ fontSize: el.height, color: el.color, lineHeight: 1 }}\n            >\n              &#9733;\n            </div>\n          );\n        case \"image\":\n          return (\n            <div\n              style={{\n                width: \"100%\",\n                height: \"100%\",\n                backgroundColor: el.backgroundColor || \"#f0f0f0\",\n                border: `${el.borderWidth}px ${el.borderStyle} ${el.borderColor}`,\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n                overflow: \"hidden\",\n              }}\n            >\n              {el.content ? (\n                <img\n                  src={el.content}\n                  alt=\"Label image\"\n                  style={{\n                    maxWidth: \"100%\",\n                    maxHeight: \"100%\",\n                    objectFit: \"contain\",\n                  }}\n                />\n              ) : (\n                <div className=\"flex flex-col items-center justify-center text-gray-400 text-xs\">\n                  <Image className=\"h-8 w-8 mb-1\" />\n                  <span>Image</span>\n                </div>\n              )}\n            </div>\n          );\n        default:\n          return null;\n      }\n    };\n\n    return (\n      <div\n        key={el.id}\n        style={baseStyle}\n        onMouseDown={(e) => {\n          if (el.locked) return;\n          e.stopPropagation();\n          if (e.shiftKey) {\n            setSelectedElements((prev) =>\n              prev.includes(el.id)\n                ? prev.filter((id) => id !== el.id)\n                : [...prev, el.id],\n            );\n          } else if (!selectedElements.includes(el.id)) {\n            setSelectedElements([el.id]);\n          }\n          setIsDragging(true);\n          setDragStart({ x: e.clientX, y: e.clientY });\n          setElementStart({\n            x: el.x,\n            y: el.y,\n            width: el.width,\n            height: el.height,\n          });\n        }}\n        className={`${isSelected ? \"ring-2 ring-blue-500\" : \"\"}`}\n        data-testid={`element-${el.id}`}\n      >\n        {renderContent()}\n        {isSelected && !el.locked && (\n          <>\n            <div\n              className=\"absolute -top-1 -left-1 w-2 h-2 bg-blue-500 cursor-nw-resize\"\n              onMouseDown={(e) => handleResizeStart(e, \"nw\")}\n            />\n            <div\n              className=\"absolute -top-1 -right-1 w-2 h-2 bg-blue-500 cursor-ne-resize\"\n              onMouseDown={(e) => handleResizeStart(e, \"ne\")}\n            />\n            <div\n              className=\"absolute -bottom-1 -left-1 w-2 h-2 bg-blue-500 cursor-sw-resize\"\n              onMouseDown={(e) => handleResizeStart(e, \"sw\")}\n            />\n            <div\n              className=\"absolute -bottom-1 -right-1 w-2 h-2 bg-blue-500 cursor-se-resize\"\n              onMouseDown={(e) => handleResizeStart(e, \"se\")}\n            />\n            <div\n              className=\"absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-500 cursor-n-resize\"\n              onMouseDown={(e) => handleResizeStart(e, \"n\")}\n            />\n            <div\n              className=\"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-500 cursor-s-resize\"\n              onMouseDown={(e) => handleResizeStart(e, \"s\")}\n            />\n            <div\n              className=\"absolute top-1/2 -left-1 -translate-y-1/2 w-2 h-2 bg-blue-500 cursor-w-resize\"\n              onMouseDown={(e) => handleResizeStart(e, \"w\")}\n            />\n            <div\n              className=\"absolute top-1/2 -right-1 -translate-y-1/2 w-2 h-2 bg-blue-500 cursor-e-resize\"\n              onMouseDown={(e) => handleResizeStart(e, \"e\")}\n            />\n          </>\n        )}\n      </div>\n    );\n  };\n\n  return (\n    <div\n      className=\"h-full flex flex-col bg-gray-100\"\n      data-testid=\"label-editor-page\"\n    >\n      {/* Main Toolbar Row 1 - File Operations */}\n      <div className=\"bg-white border-b px-2 py-1 flex items-center gap-1 flex-wrap\">\n        <ToolbarButton icon={FileText} label=\"New\" onClick={newTemplate} />\n        <label>\n          <ToolbarButton icon={FolderOpen} label=\"Open\" onClick={() => {}} />\n          <input\n            type=\"file\"\n            accept=\".json\"\n            onChange={importTemplate}\n            className=\"hidden\"\n            data-testid=\"input-import-file\"\n          />\n        </label>\n        <ToolbarButton icon={Save} label=\"Save\" onClick={saveTemplate} />\n        <Dialog open={templatesListOpen} onOpenChange={setTemplatesListOpen}>\n          <DialogTrigger asChild>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              className=\"h-7 w-7\"\n              data-testid=\"button-templates\"\n            >\n              <FolderOpen className=\"h-4 w-4\" />\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>Saved Templates</DialogTitle>\n            </DialogHeader>\n            <ScrollArea className=\"h-96\">\n              <div className=\"space-y-2\">\n                {savedTemplates.length === 0 ? (\n                  <p className=\"text-center text-gray-500 py-8\">\n                    No saved templates\n                  </p>\n                ) : (\n                  savedTemplates.map((template) => (\n                    <div\n                      key={template.id}\n                      className=\"flex items-center justify-between p-3 border rounded hover:bg-gray-50\"\n                    >\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <p className=\"font-medium\">{template.name}</p>\n                          {template.isDefault && (\n                            <span className=\"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded\">\n                              Default\n                            </span>\n                          )}\n                        </div>\n                        <p className=\"text-sm text-gray-500\">\n                          {template.width} √ó {template.height} {template.unit}\n                        </p>\n                        <p className=\"text-xs text-gray-400 mt-1\">\n                          {template.elements.length} elements\n                        </p>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"default\"\n                          onClick={() => loadTemplateForEditing(template)}\n                          title=\"Load template for editing\"\n                        >\n                          Edit\n                        </Button>\n                        {!template.isDefault && (\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            className=\"text-red-600 border-red-300 hover:bg-red-50 hover:border-red-400\"\n                            onClick={() => {\n                              localStorage.removeItem(\n                                `labelTemplate_${template.id}`,\n                              );\n                              loadSavedTemplates();\n                              toast({\n                                title: \"Template Deleted\",\n                                description: `\"${template.name}\" has been removed`,\n                              });\n                            }}\n                          >\n                            Delete\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </ScrollArea>\n          </DialogContent>\n        </Dialog>\n        <ToolbarButton\n          icon={Download}\n          label=\"Export\"\n          onClick={exportTemplate}\n        />\n        <ToolbarButton icon={Printer} label=\"Print\" onClick={printLabel} />\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={Undo2}\n          label=\"Undo (Ctrl+Z)\"\n          onClick={undo}\n          disabled={historyIndex <= 0}\n        />\n        <ToolbarButton\n          icon={Redo2}\n          label=\"Redo (Ctrl+Y)\"\n          onClick={redo}\n          disabled={historyIndex >= history.length - 1}\n        />\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={Scissors}\n          label=\"Cut (Ctrl+X)\"\n          onClick={cutSelected}\n          disabled={selectedElements.length === 0}\n        />\n        <ToolbarButton\n          icon={Copy}\n          label=\"Copy (Ctrl+C)\"\n          onClick={copySelected}\n          disabled={selectedElements.length === 0}\n        />\n        <ToolbarButton\n          icon={Clipboard}\n          label=\"Paste (Ctrl+V)\"\n          onClick={paste}\n          disabled={clipboard.length === 0}\n        />\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={ZoomOut}\n          label=\"Zoom Out\"\n          onClick={() => {\n            setManualZoomAdjusted(true);\n            setZoom(Math.max(50, effectiveZoom - 25));\n          }}\n        />\n        <span className=\"text-xs w-12 text-center\">\n          {Math.round(effectiveZoom)}%\n        </span>\n        <ToolbarButton\n          icon={ZoomIn}\n          label=\"Zoom In\"\n          onClick={() => {\n            setManualZoomAdjusted(true);\n            setZoom(Math.min(400, effectiveZoom + 25));\n          }}\n        />\n        <ToolbarButton\n          icon={Maximize2}\n          label=\"Auto Fit\"\n          onClick={() => {\n            setManualZoomAdjusted(false);\n            setPanOffset({ x: 0, y: 0 });\n          }}\n        />\n        <ToolbarButton\n          icon={Home}\n          label=\"Reset View\"\n          onClick={() => {\n            setManualZoomAdjusted(false);\n            setZoom(100);\n            setPanOffset({ x: 0, y: 0 });\n          }}\n        />\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={MousePointer}\n          label=\"Select Tool\"\n          onClick={() => setActiveTool(\"select\")}\n          active={activeTool === \"select\"}\n        />\n        <ToolbarButton\n          icon={Hand}\n          label=\"Pan Tool\"\n          onClick={() => setActiveTool(\"pan\")}\n          active={activeTool === \"pan\"}\n        />\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={Type}\n          label=\"Add Text\"\n          onClick={() => addElement(\"text\")}\n        />\n        <ToolbarButton\n          icon={Barcode}\n          label=\"Add Barcode\"\n          onClick={() => addElement(\"barcode\")}\n        />\n        <ToolbarButton\n          icon={QrCode}\n          label=\"Add QR Code\"\n          onClick={() => addElement(\"qrcode\")}\n        />\n        <ToolbarButton\n          icon={Image}\n          label=\"Add Image\"\n          onClick={() => addElement(\"image\")}\n        />\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={Square}\n          label=\"Add Rectangle\"\n          onClick={() => addElement(\"rectangle\")}\n        />\n        <ToolbarButton\n          icon={Circle}\n          label=\"Add Ellipse\"\n          onClick={() => addElement(\"ellipse\")}\n        />\n        <ToolbarButton\n          icon={Minus}\n          label=\"Add Line\"\n          onClick={() => addElement(\"line\")}\n        />\n        <ToolbarButton\n          icon={Triangle}\n          label=\"Add Triangle\"\n          onClick={() => addElement(\"triangle\")}\n        />\n        <ToolbarButton\n          icon={Star}\n          label=\"Add Star\"\n          onClick={() => addElement(\"star\")}\n        />\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={Grid3X3}\n          label=\"Toggle Grid\"\n          onClick={() => setGridEnabled(!gridEnabled)}\n          active={gridEnabled}\n        />\n        <ToolbarButton\n          icon={LayoutGrid}\n          label=\"Snap to Grid\"\n          onClick={() => setSnapToGrid(!snapToGrid)}\n          active={snapToGrid}\n        />\n        <div className=\"flex-1\" />\n        <Dialog open={settingsOpen} onOpenChange={setSettingsOpen}>\n          <DialogTrigger asChild>\n            <Button size=\"sm\" variant=\"ghost\" data-testid=\"button-settings\">\n              <Settings className=\"h-4 w-4 mr-1\" /> Page Setup\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Label Settings</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label>Template Name</Label>\n                <Input\n                  value={templateName}\n                  onChange={(e) => setTemplateName(e.target.value)}\n                  data-testid=\"input-template-name\"\n                />\n              </div>\n              <div className=\"grid grid-cols-3 gap-2\">\n                <div>\n                  <Label>Width</Label>\n                  <Input\n                    type=\"number\"\n                    value={labelWidth}\n                    onChange={(e) => {\n                      setLabelWidth(Number(e.target.value));\n                      setManualZoomAdjusted(false); // Reset to auto-zoom\n                      setPanOffset({ x: 0, y: 0 }); // Center the view\n                    }}\n                    data-testid=\"input-label-width\"\n                  />\n                </div>\n                <div>\n                  <Label>Height</Label>\n                  <Input\n                    type=\"number\"\n                    value={labelHeight}\n                    onChange={(e) => {\n                      setLabelHeight(Number(e.target.value));\n                      setManualZoomAdjusted(false); // Reset to auto-zoom\n                      setPanOffset({ x: 0, y: 0 }); // Center the view\n                    }}\n                    data-testid=\"input-label-height\"\n                  />\n                </div>\n                <div>\n                  <Label>Unit</Label>\n                  <Select\n                    value={unit}\n                    onValueChange={(v: any) => {\n                      setUnit(v);\n                      setManualZoomAdjusted(false); // Reset to auto-zoom\n                      setPanOffset({ x: 0, y: 0 }); // Center the view\n                    }}\n                  >\n                    <SelectTrigger data-testid=\"select-unit\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"px\">Pixels</SelectItem>\n                      <SelectItem value=\"mm\">Millimeters</SelectItem>\n                      <SelectItem value=\"cm\">Centimeters</SelectItem>\n                      <SelectItem value=\"in\">Inches</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div>\n                <Label>Grid Size</Label>\n                <Input\n                  type=\"number\"\n                  value={gridSize}\n                  onChange={(e) => setGridSize(Number(e.target.value))}\n                  data-testid=\"input-grid-size\"\n                />\n              </div>\n              <Separator className=\"my-4\" />\n              <div>\n                <Label>Canvas Background</Label>\n                <div className=\"flex gap-1 mt-2\">\n                  <Input\n                    type=\"color\"\n                    value={canvasBackground}\n                    onChange={(e) => setCanvasBackground(e.target.value)}\n                    className=\"w-12 h-9 p-1\"\n                    data-testid=\"input-canvas-bg\"\n                  />\n                  <Input\n                    value={canvasBackground}\n                    onChange={(e) => setCanvasBackground(e.target.value)}\n                    className=\"flex-1\"\n                  />\n                </div>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Main Toolbar Row 2 - Text Formatting */}\n      <div className=\"bg-white border-b px-2 py-1 flex items-center gap-1 flex-wrap\">\n        <Select\n          value={singleSelected?.fontFamily || currentFont}\n          onValueChange={(v) => {\n            setCurrentFont(v);\n            updateSelectedElements({ fontFamily: v });\n          }}\n        >\n          <SelectTrigger className=\"w-40 h-7 text-xs\" data-testid=\"select-font\">\n            <SelectValue placeholder=\"Font\" />\n          </SelectTrigger>\n          <SelectContent>\n            {FONTS.map((font) => (\n              <SelectItem key={font} value={font} style={{ fontFamily: font }}>\n                {font}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n        <Select\n          value={String(singleSelected?.fontSize || currentFontSize)}\n          onValueChange={(v) => {\n            setCurrentFontSize(Number(v));\n            updateSelectedElements({ fontSize: Number(v) });\n          }}\n        >\n          <SelectTrigger\n            className=\"w-16 h-7 text-xs\"\n            data-testid=\"select-font-size\"\n          >\n            <SelectValue placeholder=\"Size\" />\n          </SelectTrigger>\n          <SelectContent>\n            {FONT_SIZES.map((size) => (\n              <SelectItem key={size} value={String(size)}>\n                {size}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={Bold}\n          label=\"Bold\"\n          onClick={() =>\n            updateSelectedElements({\n              fontWeight:\n                singleSelected?.fontWeight === \"bold\" ? \"normal\" : \"bold\",\n            })\n          }\n          active={singleSelected?.fontWeight === \"bold\"}\n          disabled={!singleSelected || singleSelected.type !== \"text\"}\n        />\n        <ToolbarButton\n          icon={Italic}\n          label=\"Italic\"\n          onClick={() =>\n            updateSelectedElements({\n              fontStyle:\n                singleSelected?.fontStyle === \"italic\" ? \"normal\" : \"italic\",\n            })\n          }\n          active={singleSelected?.fontStyle === \"italic\"}\n          disabled={!singleSelected || singleSelected.type !== \"text\"}\n        />\n        <ToolbarButton\n          icon={Underline}\n          label=\"Underline\"\n          onClick={() =>\n            updateSelectedElements({\n              textDecoration:\n                singleSelected?.textDecoration === \"underline\"\n                  ? \"none\"\n                  : \"underline\",\n            })\n          }\n          active={singleSelected?.textDecoration === \"underline\"}\n          disabled={!singleSelected || singleSelected.type !== \"text\"}\n        />\n        <ToolbarButton\n          icon={Strikethrough}\n          label=\"Strikethrough\"\n          onClick={() =>\n            updateSelectedElements({\n              textDecoration:\n                singleSelected?.textDecoration === \"line-through\"\n                  ? \"none\"\n                  : \"line-through\",\n            })\n          }\n          active={singleSelected?.textDecoration === \"line-through\"}\n          disabled={!singleSelected || singleSelected.type !== \"text\"}\n        />\n        <ToolbarSeparator />\n        <Popover>\n          <PopoverTrigger asChild>\n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              className=\"h-7 px-2 gap-1\"\n              data-testid=\"button-text-color\"\n            >\n              <Type className=\"h-4 w-4\" />\n              <div\n                className=\"w-4 h-2 border\"\n                style={{\n                  backgroundColor: singleSelected?.color || currentColor,\n                }}\n              />\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-auto p-2\">\n            <div className=\"grid grid-cols-6 gap-1\">\n              {COLORS.map((color) => (\n                <button\n                  key={color}\n                  className=\"w-6 h-6 rounded border hover:scale-110 transition-transform\"\n                  style={{ backgroundColor: color }}\n                  onClick={() => {\n                    setCurrentColor(color);\n                    updateSelectedElements({ color });\n                  }}\n                  data-testid={`color-${color}`}\n                />\n              ))}\n            </div>\n            <Input\n              type=\"color\"\n              value={singleSelected?.color || currentColor}\n              onChange={(e) => {\n                setCurrentColor(e.target.value);\n                updateSelectedElements({ color: e.target.value });\n              }}\n              className=\"w-full h-8 mt-2\"\n              data-testid=\"input-custom-color\"\n            />\n          </PopoverContent>\n        </Popover>\n        <Popover>\n          <PopoverTrigger asChild>\n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              className=\"h-7 px-2 gap-1\"\n              data-testid=\"button-bg-color\"\n            >\n              <PaintBucket className=\"h-4 w-4\" />\n              <div\n                className=\"w-4 h-2 border\"\n                style={{\n                  backgroundColor:\n                    singleSelected?.backgroundColor || currentBgColor,\n                }}\n              />\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-auto p-2\">\n            <div className=\"grid grid-cols-6 gap-1\">\n              <button\n                className=\"w-6 h-6 rounded border hover:scale-110 transition-transform bg-white relative overflow-hidden\"\n                onClick={() => {\n                  setCurrentBgColor(\"transparent\");\n                  updateSelectedElements({\n                    backgroundColor: \"transparent\",\n                  });\n                }}\n              >\n                <div\n                  className=\"absolute inset-0 bg-gradient-to-br from-transparent via-red-500 to-transparent transform rotate-45\"\n                  style={{ height: \"1px\", top: \"50%\" }}\n                />\n              </button>\n              {COLORS.slice(1).map((color) => (\n                <button\n                  key={color}\n                  className=\"w-6 h-6 rounded border hover:scale-110 transition-transform\"\n                  style={{ backgroundColor: color }}\n                  onClick={() => {\n                    setCurrentBgColor(color);\n                    updateSelectedElements({ backgroundColor: color });\n                  }}\n                />\n              ))}\n            </div>\n          </PopoverContent>\n        </Popover>\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={AlignLeft}\n          label=\"Align Left\"\n          onClick={() => updateSelectedElements({ textAlign: \"left\" })}\n          active={singleSelected?.textAlign === \"left\"}\n          disabled={!singleSelected || singleSelected.type !== \"text\"}\n        />\n        <ToolbarButton\n          icon={AlignCenter}\n          label=\"Align Center\"\n          onClick={() => updateSelectedElements({ textAlign: \"center\" })}\n          active={singleSelected?.textAlign === \"center\"}\n          disabled={!singleSelected || singleSelected.type !== \"text\"}\n        />\n        <ToolbarButton\n          icon={AlignRight}\n          label=\"Align Right\"\n          onClick={() => updateSelectedElements({ textAlign: \"right\" })}\n          active={singleSelected?.textAlign === \"right\"}\n          disabled={!singleSelected || singleSelected.type !== \"text\"}\n        />\n        <ToolbarButton\n          icon={AlignJustify}\n          label=\"Justify\"\n          onClick={() => updateSelectedElements({ textAlign: \"justify\" })}\n          active={singleSelected?.textAlign === \"justify\"}\n          disabled={!singleSelected || singleSelected.type !== \"text\"}\n        />\n        <ToolbarSeparator />\n        <Popover>\n          <PopoverTrigger asChild>\n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              className=\"h-7 px-2 gap-1\"\n              data-testid=\"button-border\"\n            >\n              <Square className=\"h-4 w-4\" />\n              <ChevronDown className=\"h-3 w-3\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-48 p-2\">\n            <div className=\"space-y-2\">\n              <div>\n                <Label className=\"text-xs\">Border Width</Label>\n                <Select\n                  value={String(\n                    singleSelected?.borderWidth || currentBorderWidth,\n                  )}\n                  onValueChange={(v) => {\n                    setCurrentBorderWidth(Number(v));\n                    updateSelectedElements({ borderWidth: Number(v) });\n                  }}\n                >\n                  <SelectTrigger className=\"h-7\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {LINE_WIDTHS.map((w) => (\n                      <SelectItem key={w} value={String(w)}>\n                        {w} pt\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label className=\"text-xs\">Border Style</Label>\n                <Select\n                  value={singleSelected?.borderStyle || \"solid\"}\n                  onValueChange={(v: any) =>\n                    updateSelectedElements({ borderStyle: v })\n                  }\n                >\n                  <SelectTrigger className=\"h-7\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"solid\">Solid</SelectItem>\n                    <SelectItem value=\"dashed\">Dashed</SelectItem>\n                    <SelectItem value=\"dotted\">Dotted</SelectItem>\n                    <SelectItem value=\"none\">None</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label className=\"text-xs\">Border Color</Label>\n                <Input\n                  type=\"color\"\n                  value={singleSelected?.borderColor || currentBorderColor}\n                  onChange={(e) => {\n                    setCurrentBorderColor(e.target.value);\n                    updateSelectedElements({ borderColor: e.target.value });\n                  }}\n                  className=\"w-full h-8\"\n                />\n              </div>\n            </div>\n          </PopoverContent>\n        </Popover>\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={Layers}\n          label=\"Bring to Front\"\n          onClick={bringToFront}\n          disabled={selectedElements.length === 0}\n        />\n        <ToolbarButton\n          icon={Layers}\n          label=\"Send to Back\"\n          onClick={sendToBack}\n          disabled={selectedElements.length === 0}\n        />\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={singleSelected?.locked ? Lock : Unlock}\n          label={singleSelected?.locked ? \"Unlock\" : \"Lock\"}\n          onClick={() =>\n            updateSelectedElements({ locked: !singleSelected?.locked })\n          }\n          disabled={!singleSelected}\n        />\n        <ToolbarButton\n          icon={singleSelected?.visible ? Eye : EyeOff}\n          label={singleSelected?.visible ? \"Hide\" : \"Show\"}\n          onClick={() =>\n            updateSelectedElements({ visible: !singleSelected?.visible })\n          }\n          disabled={!singleSelected}\n        />\n        <ToolbarButton\n          icon={Trash2}\n          label=\"Delete\"\n          onClick={deleteSelected}\n          disabled={selectedElements.length === 0}\n        />\n        <ToolbarSeparator />\n        <ToolbarButton\n          icon={FlipHorizontal}\n          label=\"Flip Horizontal\"\n          onClick={() => {}}\n          disabled={!singleSelected}\n        />\n        <ToolbarButton\n          icon={FlipVertical}\n          label=\"Flip Vertical\"\n          onClick={() => {}}\n          disabled={!singleSelected}\n        />\n        <ToolbarButton\n          icon={RotateCw}\n          label=\"Rotate 90¬∞\"\n          onClick={() =>\n            updateSelectedElements({\n              rotation: (singleSelected?.rotation || 0) + 90,\n            })\n          }\n          disabled={!singleSelected}\n        />\n      </div>\n\n      {/* Main Content Area */}\n      <div className=\"flex-1 flex overflow-hidden\">\n        {/* Canvas Area */}\n        <div\n          ref={canvasContainerRef}\n          className=\"flex-1 overflow-hidden p-4 flex items-center justify-center bg-gray-50\"\n        >\n          <div\n            className=\"relative shadow-2xl\"\n            style={{\n              width: labelWidth * effectiveDesignScale * (effectiveZoom / 100),\n              height: labelHeight * effectiveDesignScale * (effectiveZoom / 100),\n              transform: `translate(${panOffset.x}px, ${panOffset.y}px)`,\n              transformOrigin: \"center\",\n            }}\n          >\n            {/* Canvas */}\n            <div\n              ref={canvasRef}\n              className=\"absolute inset-0 overflow-hidden\"\n              style={{\n                backgroundColor: canvasBackground,\n                backgroundImage: gridEnabled\n                  ? `linear-gradient(to right, rgba(0,0,0,0.05) 1px, transparent 1px), linear-gradient(to bottom, rgba(0,0,0,0.05) 1px, transparent 1px)`\n                  : \"none\",\n                backgroundSize: gridEnabled\n                  ? `${gridSize * effectiveDesignScale}px ${gridSize * effectiveDesignScale}px`\n                  : \"auto\",\n                backgroundPosition: \"0 0\",\n                width: labelWidth * effectiveDesignScale,\n                height: labelHeight * effectiveDesignScale,\n                transform: `scale(${effectiveZoom / 100})`,\n                transformOrigin: \"top left\",\n                cursor:\n                  activeTool === \"select\"\n                    ? \"default\"\n                    : activeTool === \"pan\"\n                      ? isPanning\n                        ? \"grabbing\"\n                        : \"grab\"\n                      : \"crosshair\",\n              }}\n              onMouseDown={handleCanvasMouseDown}\n              onMouseMove={handleCanvasMouseMove}\n              onMouseUp={handleCanvasMouseUp}\n              onMouseLeave={handleCanvasMouseUp}\n              data-testid=\"canvas-area\"\n            >\n              {elements.sort((a, b) => a.zIndex - b.zIndex).map(renderElement)}\n            </div>\n          </div>\n        </div>\n\n        {/* Properties Panel */}\n        <div className=\"w-64 bg-white border-l overflow-y-auto\">\n          <div className=\"p-3 border-b\">\n            <h3 className=\"font-semibold text-sm\">Properties</h3>\n          </div>\n          {singleSelected ? (\n            <ScrollArea className=\"h-full\">\n              <div className=\"p-3 space-y-4\">\n                <div>\n                  <Label className=\"text-xs\">Label</Label>\n                  <Input\n                    value={singleSelected.label}\n                    onChange={(e) =>\n                      updateElement(singleSelected.id, {\n                        label: e.target.value,\n                      })\n                    }\n                    className=\"h-8\"\n                    data-testid=\"input-element-label\"\n                  />\n                </div>\n                {singleSelected.type === \"text\" && (\n                  <div>\n                    <Label className=\"text-xs\">Content</Label>\n                    <Input\n                      value={singleSelected.content}\n                      onChange={(e) =>\n                        updateElement(singleSelected.id, {\n                          content: e.target.value,\n                        })\n                      }\n                      className=\"h-8\"\n                      data-testid=\"input-element-content\"\n                    />\n                  </div>\n                )}\n                {singleSelected.type === \"image\" && (\n                  <div>\n                    <Label className=\"text-xs\">Image URL</Label>\n                    <Input\n                      value={singleSelected.content}\n                      onChange={(e) =>\n                        updateElement(singleSelected.id, {\n                          content: e.target.value,\n                        })\n                      }\n                      placeholder=\"Enter image URL...\"\n                      className=\"h-8\"\n                      data-testid=\"input-image-url\"\n                    />\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Paste an image URL or leave empty for placeholder\n                    </p>\n                  </div>\n                )}\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <div>\n                    <Label className=\"text-xs\">X</Label>\n                    <Input\n                      type=\"number\"\n                      value={Math.round(singleSelected.x)}\n                      onChange={(e) =>\n                        updateElement(singleSelected.id, {\n                          x: Number(e.target.value),\n                        })\n                      }\n                      className=\"h-8\"\n                      data-testid=\"input-element-x\"\n                    />\n                  </div>\n                  <div>\n                    <Label className=\"text-xs\">Y</Label>\n                    <Input\n                      type=\"number\"\n                      value={Math.round(singleSelected.y)}\n                      onChange={(e) =>\n                        updateElement(singleSelected.id, {\n                          y: Number(e.target.value),\n                        })\n                      }\n                      className=\"h-8\"\n                      data-testid=\"input-element-y\"\n                    />\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <div>\n                    <Label className=\"text-xs\">Width</Label>\n                    <Input\n                      type=\"number\"\n                      value={Math.round(singleSelected.width)}\n                      onChange={(e) =>\n                        updateElement(singleSelected.id, {\n                          width: Number(e.target.value),\n                        })\n                      }\n                      className=\"h-8\"\n                      data-testid=\"input-element-width\"\n                    />\n                  </div>\n                  <div>\n                    <Label className=\"text-xs\">Height</Label>\n                    <Input\n                      type=\"number\"\n                      value={Math.round(singleSelected.height)}\n                      onChange={(e) =>\n                        updateElement(singleSelected.id, {\n                          height: Number(e.target.value),\n                        })\n                      }\n                      className=\"h-8\"\n                      data-testid=\"input-element-height\"\n                    />\n                  </div>\n                </div>\n                <div>\n                  <Label className=\"text-xs\">Rotation (¬∞)</Label>\n                  <Input\n                    type=\"number\"\n                    value={singleSelected.rotation}\n                    onChange={(e) =>\n                      updateElement(singleSelected.id, {\n                        rotation: Number(e.target.value),\n                      })\n                    }\n                    className=\"h-8\"\n                    data-testid=\"input-element-rotation\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-xs\">Opacity (%)</Label>\n                  <Input\n                    type=\"number\"\n                    min={0}\n                    max={100}\n                    value={singleSelected.opacity}\n                    onChange={(e) =>\n                      updateElement(singleSelected.id, {\n                        opacity: Number(e.target.value),\n                      })\n                    }\n                    className=\"h-8\"\n                    data-testid=\"input-element-opacity\"\n                  />\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Checkbox\n                    checked={singleSelected.visible}\n                    onCheckedChange={(checked) =>\n                      updateElement(singleSelected.id, { visible: !!checked })\n                    }\n                    data-testid=\"checkbox-visible\"\n                  />\n                  <Label className=\"text-xs\">Visible</Label>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Checkbox\n                    checked={singleSelected.locked}\n                    onCheckedChange={(checked) =>\n                      updateElement(singleSelected.id, { locked: !!checked })\n                    }\n                    data-testid=\"checkbox-locked\"\n                  />\n                  <Label className=\"text-xs\">Locked</Label>\n                </div>\n              </div>\n            </ScrollArea>\n          ) : (\n            <div className=\"p-4 text-center text-gray-500 text-sm\">\n              Select an element to edit its properties\n            </div>\n          )}\n\n          {/* Elements List */}\n          <div className=\"border-t\">\n            <div className=\"p-3 border-b\">\n              <h3 className=\"font-semibold text-sm\">\n                Elements ({elements.length})\n              </h3>\n            </div>\n            <ScrollArea className=\"h-48\">\n              <div className=\"p-2 space-y-1\">\n                {elements\n                  .sort((a, b) => b.zIndex - a.zIndex)\n                  .map((el) => (\n                    <div\n                      key={el.id}\n                      className={`flex items-center gap-2 p-2 rounded cursor-pointer text-sm ${\n                        selectedElements.includes(el.id)\n                          ? \"bg-orange-100\"\n                          : \"hover:bg-orange-100\"\n                      }`}\n                      onClick={() => setSelectedElements([el.id])}\n                      data-testid={`list-element-${el.id}`}\n                    >\n                      {el.type === \"text\" && <Type className=\"h-3 w-3\" />}\n                      {el.type === \"barcode\" && <Barcode className=\"h-3 w-3\" />}\n                      {el.type === \"qrcode\" && <QrCode className=\"h-3 w-3\" />}\n                      {el.type === \"rectangle\" && (\n                        <Square className=\"h-3 w-3\" />\n                      )}\n                      {el.type === \"ellipse\" && <Circle className=\"h-3 w-3\" />}\n                      {el.type === \"line\" && <Minus className=\"h-3 w-3\" />}\n                      {el.type === \"triangle\" && (\n                        <Triangle className=\"h-3 w-3\" />\n                      )}\n                      {el.type === \"star\" && <Star className=\"h-3 w-3\" />}\n                      {el.type === \"image\" && <Image className=\"h-3 w-3\" />}\n                      <span className=\"flex-1 truncate\">{el.label}</span>\n                      {el.locked && <Lock className=\"h-3 w-3 text-gray-400\" />}\n                      {!el.visible && (\n                        <EyeOff className=\"h-3 w-3 text-gray-400\" />\n                      )}\n                    </div>\n                  ))}\n              </div>\n            </ScrollArea>\n          </div>\n        </div>\n      </div>\n\n      {/* Status Bar */}\n      <div className=\"bg-gray-100 dark:bg-gray-800 border-t px-4 py-1 flex items-center gap-4 text-xs text-gray-600 dark:text-gray-400\">\n        <span>\n          Page Size: {labelWidth} √ó {labelHeight} {unit}\n        </span>\n        <span>\n          Canvas: {Math.round(labelWidth * effectiveDesignScale)} √ó {Math.round(labelHeight * effectiveDesignScale)} px\n        </span>\n        <span>\n          View: {Math.round(effectiveZoom)}% {manualZoomAdjusted ? \"(manual)\" : \"(fit-to-screen)\"}\n        </span>\n        <span>Elements: {elements.length}</span>\n        <span>Selected: {selectedElements.length}</span>\n        {singleSelected && (\n          <span>\n            Position: ({Math.round(singleSelected.x)},{\" \"}\n            {Math.round(singleSelected.y)}) {unit}\n          </span>\n        )}\n        <div className=\"flex-1\" />\n        <span>\n          Grid: {gridEnabled ? \"On\" : \"Off\"} ({gridSize} {unit})\n        </span>\n        <span>Snap: {snapToGrid ? \"On\" : \"Off\"}</span>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":80763,"size_tokens":null}},"version":2}